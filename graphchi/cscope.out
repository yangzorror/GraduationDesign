cscope 15 $HOME/GraduationDesign/graphchi               0001259933
	@example_apps/application_template.cpp

32 
	~<¡ršg
>

34 
	~"g¿phchi_basic_šşudes.hµ
"

36 
usšg
 
Çme¥aû
 
	gg¿phchi
;

42 
my_v”‹x_ty³
 
	tV”‹xD©aTy³
;

43 
my_edge_ty³
 
	tEdgeD©aTy³
;

49 
	gMyG¿phChiProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

55 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

57 ià(
	ggšfo
.
	g™”©iÚ
 == 0) {

67 
i
=0; 
	gi
 < 
	gv”‹x
.
num_šedges
(); i++) {

73 
	gi
=0; i < 
	gv”‹x
.
num_ou‹dges
(); i++) {

79 
	gi
=0; i < 
	gv”‹x
.
num_edges
(); i++) {

90 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

96 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

102 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

108 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

113 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

116 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

120 
m‘rics
 
	`m
("my-application-name");

123 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

124 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 4);

125 
boŞ
 
scheduËr
 = 
	`g‘_İtiÚ_št
("scheduler", 0);

128 
nsh¬ds
 = 
cÚv”t_if_nÙexi¡s
<
EdgeD©aTy³
>(
f’ame
,

129 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"));

132 
MyG¿phChiProg¿m
 
´og¿m
;

133 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
, 
nsh¬ds
, 
scheduËr
, 
m
);

134 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

137 
	`m‘rics_»pÜt
(
m
);

139 
	}
}

	@example_apps/communitydetection.cpp

47 
	~<cm©h
>

48 
	~<m­
>

49 
	~<¡ršg
>

51 
	~"g¿phchi_basic_šşudes.hµ
"

52 
	~"ut/Ïb–ª®ysis.hµ
"

54 
usšg
 
Çme¥aû
 
	gg¿phchi
;

66 
	sbidœeùiÚ®_Ïb–
 {

67 
vid_t
 
	msm®Ër_Úe
;

68 
vid_t
 
	mÏrg”_Úe
;

71 
	gvid_t
 & 
	$ÃighbÜ_Ïb–
(
bidœeùiÚ®_Ïb–
 & 
bidœ
, 
vid_t
 
myid
, vid_ˆ
nbid
) {

72 ià(
myid
 < 
nbid
) {

73  
bidœ
.
Ïrg”_Úe
;

75  
bidœ
.
sm®Ër_Úe
;

77 
	}
}

79 
	gvid_t
 & 
	$my_Ïb–
(
bidœeùiÚ®_Ïb–
 & 
bidœ
, 
vid_t
 
myid
, vid_ˆ
nbid
) {

80 ià(
myid
 < 
nbid
) {

81  
bidœ
.
sm®Ër_Úe
;

83  
bidœ
.
Ïrg”_Úe
;

85 
	}
}

88 
vid_t
 
	tV”‹xD©aTy³
;

89 
bidœeùiÚ®_Ïb–
 
	tEdgeD©aTy³
;

95 
	gCommun™yD‘eùiÚProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

100 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

102 
as£¹
(
gcÚ‹xt
.
scheduËr
 !ğ
NULL
);

103 
vid_t
 
	gÃwÏb–
;

104 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0) {

106 
vid_t
 
fœ¡Ïb–
 = 
v”‹x
.
id
();

107 
	gv”‹x
.
£t_d©a
(
fœ¡Ïb–
);

109 
	gÃwÏb–
 = 
fœ¡Ïb–
;

112 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
v”‹x
.
id
());

115 ià(
	gv”‹x
.
num_edges
() == 0) ;

121 
	g¡d
::
m­
<
vid_t
, > 
	gcouÁs
;

122 
	gmaxcouÁ
=0;

123 
vid_t
 
	gmaxÏb–
=0;

125 
	gi
=0; i < 
	gv”‹x
.
num_edges
(); i++) {

129 
bidœeùiÚ®_Ïb–
 
	gedg–ab–
 = 
v”‹x
.
edge
(
i
)->
g‘_d©a
();

130 
vid_t
 
	gnbÏb–
 = 
ÃighbÜ_Ïb–
(
edg–ab–
, 
v”‹x
.
id
(), v”‹x.
edge
(
i
)->
v”‹x_id
());

133 
	g¡d
::
m­
<
vid_t
, >::
™”©Ü
 
exi¡šg
 = 
couÁs
.
fšd
(
nbÏb–
);

134 
	gÃwcouÁ
 = 0;

135 if(
	gexi¡šg
 =ğ
couÁs
.
’d
()) {

137 
couÁs
.
š£¹
(
¡d
::
·œ
<
vid_t
,>(
nbÏb–
, 1));

138 
	gÃwcouÁ
 = 1;

141 
	gexi¡šg
->
	g£cÚd
++;

142 
	gÃwcouÁ
 = 
exi¡šg
->
£cÚd
;

146 ià(
	gÃwcouÁ
 > 
	gmaxcouÁ
 || (maxcouÁ =ğ
ÃwcouÁ
 && 
nbÏb–
 > 
maxÏb–
)) {

147 
maxÏb–
 = 
nbÏb–
;

148 
	gmaxcouÁ
 = 
ÃwcouÁ
;

151 
	gÃwÏb–
 = 
maxÏb–
;

156 ià(
	gÃwÏb–
 !ğ
v”‹x
.
g‘_d©a
(è|| 
gcÚ‹xt
.
™”©iÚ
 == 0) {

157 
v”‹x
.
£t_d©a
(
ÃwÏb–
);

158 
	gi
=0; i<
	gv”‹x
.
num_edges
(); i++) {

159 
bidœeùiÚ®_Ïb–
 
	gÏb–s_Ú_edge
 = 
v”‹x
.
edge
(
i
)->
g‘_d©a
();

160 
my_Ïb–
(
Ïb–s_Ú_edge
, 
v”‹x
.
id
(), v”‹x.
edge
(
i
)->
v”‹x_id
()èğ
ÃwÏb–
;

161 
	gv”‹x
.
edge
(
i
)->
£t_d©a
(
Ïb–s_Ú_edge
);

164 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 > 0)

165 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
v”‹x
.
edge
(
i
)->
v”‹x_id
());

175 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
šfo
) {

181 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

187 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

193 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

198 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

201 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

205 
m‘rics
 
	`m
("community-detection");

208 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

209 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 10);

210 
boŞ
 
scheduËr
 = 
Œue
;

213 
nsh¬ds
 = 
cÚv”t_if_nÙexi¡s
<
EdgeD©aTy³
>(
f’ame
, 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"));

215 ià(
	`g‘_İtiÚ_št
("onlyresult", 0) == 0) {

217 
Commun™yD‘eùiÚProg¿m
 
´og¿m
;

218 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
, 
nsh¬ds
, 
scheduËr
, 
m
);

219 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

223 
m
.
	`¡¬t_time
("label-analysis");

225 
ª®yze_Ïb–s
<
vid_t
>(
f’ame
);

227 
m
.
	`¡İ_time
("label-analysis");

230 
	`m‘rics_»pÜt
(
m
);

232 
	}
}

	@example_apps/connectedcomponents.cpp

47 
	~<cm©h
>

48 
	~<¡ršg
>

50 
	~"g¿phchi_basic_šşudes.hµ
"

51 
	~"ut/Ïb–ª®ysis.hµ
"

53 
usšg
 
Çme¥aû
 
	gg¿phchi
;

61 
vid_t
 
	tV”‹xD©aTy³
;

62 
vid_t
 
	tEdgeD©aTy³
;

68 
	gCÚÃùedCompÚ’tsProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

76 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

78 
as£¹
(
gcÚ‹xt
.
scheduËr
 !ğ
NULL
);

80 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0) {

81 
v”‹x
.
£t_d©a
(v”‹x.
id
());

82 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
v”‹x
.
id
());

86 
vid_t
 
	gcurmš
 = 
v”‹x
.
g‘_d©a
();

87 
	gi
=0; i < 
	gv”‹x
.
num_edges
(); i++) {

88 
vid_t
 
	gnbÏb–
 = 
v”‹x
.
edge
(
i
)->
g‘_d©a
();

89 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 =ğ0è
nbÏb–
 = 
v”‹x
.
edge
(
i
)->
v”‹x_id
();

90 
	gcurmš
 = 
¡d
::
mš
(
nbÏb–
, 
curmš
);

94 
	gv”‹x
.
£t_d©a
(
curmš
);

102 
vid_t
 
	gÏb–
 = 
v”‹x
.
g‘_d©a
();

104 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 > 0) {

105 
	gi
=0; i < 
	gv”‹x
.
num_edges
(); i++) {

106 ià(
	gÏb–
 < 
	gv”‹x
.
edge
(
i
)->
g‘_d©a
()) {

107 
	gv”‹x
.
edge
(
i
)->
£t_d©a
(
Ïb–
);

109 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
v”‹x
.
edge
(
i
)->
v”‹x_id
());

112 } ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0) {

113 
i
=0; 
	gi
 < 
	gv”‹x
.
num_ou‹dges
(); i++) {

114 
	gv”‹x
.
ou‹dge
(
i
)->
£t_d©a
(
Ïb–
);

121 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
šfo
) {

127 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

133 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

139 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

144 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

147 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

151 
m‘rics
 
	`m
("connected-components");

154 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

155 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 10);

156 
boŞ
 
scheduËr
 = 
Œue
;

159 
nsh¬ds
 = (è
cÚv”t_if_nÙexi¡s
<
EdgeD©aTy³
>(
f’ame
, 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"));

161 ià(
	`g‘_İtiÚ_št
("onlyresult", 0) == 0) {

163 
CÚÃùedCompÚ’tsProg¿m
 
´og¿m
;

164 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
, 
nsh¬ds
, 
scheduËr
, 
m
);

165 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

169 
m
.
	`¡¬t_time
("label-analysis");

171 
ª®yze_Ïb–s
<
vid_t
>(
f’ame
);

173 
m
.
	`¡İ_time
("label-analysis");

176 
	`m‘rics_»pÜt
(
m
);

178 
	}
}

	@example_apps/convert_to_adjacency.cpp

29 
	~<io¡»am
>

31 
	~"g¿phchi_basic_šşudes.hµ
"

33 
usšg
 
Çme¥aû
 
	gg¿phchi
;

39 
boŞ
 
	tV”‹xD©aTy³
;

40 
boŞ
 
	tEdgeD©aTy³
;

42 
FILE
 * 
	gf
;

44 
	#MODE_ADJLIST
 0

	)

45 
	#MODE_CASSOVARY_ADJ
 1

	)

47 
	gmode
;

49 
	gAdjCÚv”‹r
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

55 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

56 ià(
	gv”‹x
.
id
(è% 10000 =ğ0è
¡d
::
cout
 << 
v”‹x
.id(è<< std::
’dl
;

57 
	gmode
) {

58 
	gMODE_ADJLIST
: {

59 
årštf
(
f
, "%d %d", 
v”‹x
.
id
(), v”‹x.
num_ou‹dges
());

60 
	gi
=0; i<
	gv”‹x
.
num_ou‹dges
(); i++)

61 
årštf
(
f
, " %d", 
v”‹x
.
ou‹dge
(
i
)->
v”‹x_id
());

62 
årštf
(
f
, "\n");

65 
	gMODE_CASSOVARY_ADJ
: {

66 
årštf
(
f
, "%d %d\n", 
v”‹x
.
id
(), v”‹x.
num_ou‹dges
());

67 
	gi
=0; i<
	gv”‹x
.
num_ou‹dges
(); i++)

68 
årštf
(
f
, "%d\n", 
v”‹x
.
ou‹dge
(
i
)->
v”‹x_id
());

77 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

83 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

89 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

95 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

100 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

103 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

107 
m‘rics
 
	`m
("adjconverter");

110 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

113 
nsh¬ds
 = 
cÚv”t_if_nÙexi¡s
<
EdgeD©aTy³
>(
f’ame
,

114 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"));

115 
mode
 = 
	`g‘_İtiÚ_št
("mode", 0);

116 
¡d
::
¡ršg
 
outfe
 = 
f’ame
 + ".adj";

117 
f
 = 
	`fİ’
(
outfe
.
	`c_¡r
(), "w");

120 
AdjCÚv”‹r
 
´og¿m
;

121 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
, 
nsh¬ds
, 
çl£
, 
m
);

122 
’gše
.
	`£t_exec_th»ads
(1);

123 
’gše
.
	`run
(
´og¿m
, 1);

125 
	`fşo£
(
f
);

128 
	`m‘rics_»pÜt
(
m
);

130 
	}
}

	@example_apps/demotools/create_streaminggraph_demofiles.cpp

9 
	~<veùÜ
>

10 
	~<¡dio.h
>

11 
	~<¡dlib.h
>

12 
	~<io¡»am
>

13 
	~<as£¹.h
>

15 
	~<¡ršg.h
>

16 
	~<¡ršg
>

17 
	~<”ºo.h
>

18 
	~<®gÜ™hm
>

19 
	~<™”©Ü
>

21 
	sedge
 {

22 
	mäom
;

23 
	mto
;

28 
	$FIXLINE
(* 
s
) {

29 
Ën
 = (è
	`¡¾’
(
s
)-1;

30 if(
s
[
Ën
] == '\n') s[len] = 0;

31 
	}
}

33 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

34 ià(
¬gc
 != 3) {

35 
¡d
::
cout
 << "U§ge: [šputfe-edg–i¡] [¡»am-edges-³r-ba£-edges] [max-ba£-id]" << std::
’dl
;

37 cÚ¡ * 
šput
 = 
¬gv
[1];

38 
¡»am_edges_³r_ba£_edges
 = 
	`©oi
(
¬gv
[2]);

39 
maxba£id
 = 
	`©oi
(
¬gv
[3]);

40 
¡d
::
cout
 << "Proûssšg: " << 
šput
 << std::
’dl
;

42 
FILE
 * 
šf
 = 
	`fİ’
(
šput
, "r");

44 
¡d
::
veùÜ
<
edge
> 
ba£_edges
;

45 
¡d
::
veùÜ
<
edge
> 
¡»am_edges
;

46 
ba£_edges
.
	`»£rve
(1e6);

47 
¡»am_edges
.
	`»£rve
(1e6);

49 ià(
šf
 =ğ
NULL
) {

50 
¡d
::
cout
 << "Could‚Ù†ßd :" << 
šput
 << "ƒ¼Ü: " << 
	`¡»¼Ü
(
”ºo
è<< std::
’dl
;

52 
	`as£¹
(
šf
 !ğ
NULL
);

54 
¡d
::
cout
 << "R—dšg iÀedgli¡ fÜm©!" << std::
’dl
;

55 
s
[1024];

56 
	`fg‘s
(
s
, 1024, 
šf
è!ğ
NULL
) {

57 
	`FIXLINE
(
s
);

58 ià(
s
[0] == '#') ;

59 ià(
s
[0] == '%') ;

60 
d–ims
[] = "\t ";

61 * 
t
;

62 
t
 = 
	`¡¹ok
(
s
, 
d–ims
);

63 
edge
 
e
;

64 
e
.
äom
 = 
	`©oi
(
t
);

65 
t
 = 
	`¡¹ok
(
NULL
, 
d–ims
);

66 
e
.
to
 = 
	`©oi
(
t
);

67 ià(
¡d
::
	`¿nd
(è% 
¡»am_edges_³r_ba£_edges
 =ğ0 && 
e
.
äom
 <ğ
maxba£id
 &&ƒ.
to
 <ğmaxba£idè
ba£_edges
.
	`push_back
(e);

68 
¡»am_edges
.
	`push_back
(
e
);

70 
	`fşo£
(
šf
);

72 
¡d
::
cout
 << "Numb” oàedge š ba£: " << 
ba£_edges
.
	`size
(è<< std::
’dl
;

73 
¡d
::
cout
 << "Numb” oàedge tØ¡»am: " << 
¡»am_edges
.
	`size
(è<< std::
’dl
;

75 
¡d
::
¡ršg
 
ba£_fe_Çme
 = std::
	`¡ršg
(
šput
) + "_base";

76 
¡d
::
¡ršg
 
¡»am_fe_Çme
 = std::
	`¡ršg
(
šput
) + "_stream";

78 
FILE
 * 
ba£f
 = 
	`fİ’
(
ba£_fe_Çme
.
	`c_¡r
(), "w");

80 
¡d
::
veùÜ
<
edge
>::
™”©Ü
 
™
=
ba£_edges
.
	`begš
();

81 
™
 !ğ
ba£_edges
.
	`’d
(); ++it) {

82 
	`årštf
(
ba£f
, "%u %u\n", 
™
->
äom
, it->
to
);

85 
	`fşo£
(
ba£f
);

88 
¡d
::
	`¿ndom_shufæe
(
¡»am_edges
.
	`begš
(), sŒ—m_edges.
	`’d
());

91 
FILE
 * 
¡rmf
 = 
	`fİ’
(
¡»am_fe_Çme
.
	`c_¡r
(), "w");

92 
¡d
::
veùÜ
<
edge
>::
™”©Ü
 
™
=
¡»am_edges
.
	`begš
();

93 
™
 !ğ
¡»am_edges
.
	`’d
(); ++it) {

94 
	`årštf
(
¡rmf
, "%u %u\n", 
™
->
äom
, it->
to
);

96 
	`fşo£
(
¡rmf
);

98 
	}
}

	@example_apps/inmemconncomps.cpp

40 
	~<cm©h
>

41 
	~<¡ršg
>

43 
	~"g¿phchi_basic_šşudes.hµ
"

44 
	~"ut/Ïb–ª®ysis.hµ
"

46 
usšg
 
Çme¥aû
 
	gg¿phchi
;

54 
vid_t
 
	tV”‹xD©aTy³
;

55 
vid_t
 
	tEdgeD©aTy³
;

61 
	gCÚÃùedCompÚ’tsProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

63 
V”‹xD©aTy³
 * 
	gv”‹x_v®ues
;

65 
vid_t
 
ÃighbÜ_v®ue
(
g¿phchi_edge
<
EdgeD©aTy³
> * 
edge
) {

66  
	gv”‹x_v®ues
[
edge
->
v”‹x_id
()];

69 
£t_d©a
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
vid_t
 
v®ue
) {

70 
	gv”‹x_v®ues
[
v”‹x
.
id
()] = 
v®ue
;

71 
	gv”‹x
.
£t_d©a
(
v®ue
);

80 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

82 
as£¹
(
gcÚ‹xt
.
scheduËr
 !ğ
NULL
);

85 
vid_t
 
	gcurmš
 = 
v”‹x
.
g‘_d©a
();

86 
	gi
=0; i < 
	gv”‹x
.
num_edges
(); i++) {

87 
vid_t
 
	gnbÏb–
 = 
ÃighbÜ_v®ue
(
v”‹x
.
edge
(
i
));

88 
	gcurmš
 = 
¡d
::
mš
(
nbÏb–
, 
curmš
);

92 ià(
	gv”‹x
.
g‘_d©a
(è!ğ
curmš
) {

93 
vid_t
 
ÃwÏb–
 = 
curmš
;

95 
	gi
=0; i < 
	gv”‹x
.
num_edges
(); i++) {

96 ià(
	gÃwÏb–
 < 
ÃighbÜ_v®ue
(
v”‹x
.
edge
(
i
))) {

98 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
v”‹x
.
edge
(
i
)->
v”‹x_id
());

102 
£t_d©a
(
v”‹x
, 
curmš
);

108 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
ùx
) {

109 ià(
	g™”©iÚ
 == 0) {

111 
v”‹x_v®ues
 = 
Ãw
 
V”‹xD©aTy³
[
ùx
.
nv”tiûs
];

112 
	gi
=0; i < ()
	gùx
.
	gnv”tiûs
; i++) {

113 
	gv”‹x_v®ues
[
i
] = i;

121 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

127 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

133 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

138 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

141 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

145 
m‘rics
 
	`m
("connected-components-inmem");

148 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

149 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 10);

150 
boŞ
 
scheduËr
 = 
Œue
;

153 
nsh¬ds
 = (è
cÚv”t_if_nÙexi¡s
<
EdgeD©aTy³
>(
f’ame
, 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"));

155 ià(
	`g‘_İtiÚ_št
("onlyresult", 0) == 0) {

157 
CÚÃùedCompÚ’tsProg¿m
 
´og¿m
;

158 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
, 
nsh¬ds
, 
scheduËr
, 
m
);

159 
’gše
.
	`£t_modif›s_šedges
(
çl£
);

160 
’gše
.
	`£t_modif›s_ou‹dges
(
çl£
);

162 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

166 
m
.
	`¡¬t_time
("label-analysis");

168 
ª®yze_Ïb–s
<
vid_t
>(
f’ame
);

170 
m
.
	`¡İ_time
("label-analysis");

173 
	`m‘rics_»pÜt
(
m
);

175 
	}
}

	@example_apps/matrix_factorization/als.hpp

32 #iâdeà
DEF_ALSHPP


33 
	#DEF_ALSHPP


	)

35 
	~<as£¹.h
>

36 
	~<cm©h
>

37 
	~<”ºo.h
>

38 
	~<¡ršg
>

39 
	~<¡dšt.h
>

41 
	~"m©rixm¬k‘/mmio.h
"

42 
	~"m©rixm¬k‘/mmio.c
"

44 
	~"­i/chif’ames.hµ
"

45 
	~"­i/v”‹x_agg»g©Ü.hµ
"

46 
	~"´•roûssšg/sh¬d”.hµ
"

49 
	~"Eig’/D’£
"

50 
	#EIGEN_YES_I_KNOW_SPARSE_MODULE_IS_NOT_STABLE_YET


	)

51 
	~"Eig’/S·r£
"

52 
	~"Eig’/ChŞesky
"

53 
	~"Eig’/Eig’v®ues
"

54 
	~"Eig’/SVD
"

55 
usšg
 
Çme¥aû
 
	gEig’
;

58 
M©rixXd
 
	tm©
;

59 
VeùÜXd
 
	tvec
;

60 
VeùÜXi
 
	tivec
;

61 
M©rixXi
 
	tim©
;

62 
	gS·r£VeùÜ
<> 
	t¥¬£_vec
;

64 
usšg
 
Çme¥aû
 
	gg¿phchi
;

67 #iâdeà
NLATENT


68 
	#NLATENT
 5

70 

	)

71 
	gLAMBDA
 = 0.065;

74 
	grm£
=0.0;

75 
mu‹x
 
	grm£lock
;

80 
vid_t
 
	gmax_Ëá_v”‹x
 =0 ;

81 
vid_t
 
	gmax_right_v”‹x
 = 0;

83 
	sÏ‹Ávec_t
 {

84 
	md
[
NLATENT
];

86 
Ï‹Ávec_t
() {

89 
š™
() {

90 
	mk
=0; k < 
	mNLATENT
; k++è
	md
[
k
] = 0.001 * (
¡d
::
¿nd
() % 1000);

93 & 
	mİ”©Ü
[] (
	midx
) {

94  
	md
[
idx
];

96 
boŞ
 
	mİ”©Ü
!=(cÚ¡ 
Ï‹Ávec_t
 &
Ùh
) const {

97 
i
=0; 
	mi
<
	mNLATENT
; i++è{ ià(
	md
[i] !ğ
Ùh
.
d
[i]è 
Œue
; }

98  
	mçl£
;

101 
dÙ
(
Ï‹Ávec_t
 &
Ùh
) const {

102 
	mx
=0;

103 
	mi
=0; i<
	mNLATENT
; i++è
	mx
+ğ
Ùh
.
d
[
i
]*d[i];

104  
	mx
;

111 
	s®s_çùÜ_ªd_weight
 {

112 
Ï‹Ávec_t
 
	mçùÜ
;

113 
	mweight
;

115 
®s_çùÜ_ªd_weight
() {}

117 
®s_çùÜ_ªd_weight
(
obs
) {

118 
	mweight
 = 
obs
;

119 
	mçùÜ
.
š™
();

130 
	g‹m¶©e
 <
ty³Çme
 
	g®s_edge_ty³
>

131 
cÚv”t_m©rixm¬k‘_fÜ_ALS
(
¡d
::
¡ršg
 
ba£_f’ame
) {

133 
»t_code
;

134 
MM_ty³code
 
	gm©code
;

135 
FILE
 *
	gf
;

136 
ušt
 
	gM
, 
	gN
;

137 
size_t
 
	gnz
;

142 
	gnsh¬ds
;

143 ià((
	gnsh¬ds
 = 
fšd_sh¬ds
<
®s_edge_ty³
>(
ba£_f’ame
, 
g‘_İtiÚ_¡ršg
("nshards", "auto")))) {

144 ià(
	gcheck_Üigfe_modifiÿtiÚ_—¾›r
<
	g®s_edge_ty³
>(
	gba£_f’ame
, 
	gnsh¬ds
)) {

145 
log¡»am
(
LOG_INFO
è<< "F" << 
	gba£_f’ame
 << " wa ®»ady…»´oûs£d, wÚ'ˆdØ™‡gaš. " << 
	g¡d
::
’dl
;

146 
log¡»am
(
LOG_INFO
è<< "Iàthi i nÙ iÁ’ded,…Ëa£ d–‘thsh¬d fe ªdry‡gaš. " << 
	g¡d
::
’dl
;

147  
	gnsh¬ds
;

151 
	gsh¬d”
<
	g®s_edge_ty³
> 
sh¬d”obj
(
ba£_f’ame
);

152 
	gsh¬d”obj
.
¡¬t_´•roûssšg
();

155 ià((
	gf
 = 
fİ’
(
ba£_f’ame
.
c_¡r
(), "r")è=ğ
NULL
) {

156 
log¡»am
(
LOG_ERROR
è<< "Could‚Ù o³Àfe: " << 
ba£_f’ame
 << ",ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

157 
ex™
(1);

161 ià(
mm_»ad_bªÃr
(
f
, &
m©code
) != 0)

163 
log¡»am
(
LOG_ERROR
è<< "Could‚Ù…roûs M©rix M¬k‘ bªÃr. Fe: " << 
ba£_f’ame
 << 
¡d
::
’dl
;

164 
log¡»am
(
LOG_ERROR
è<< "M©rix mu¡ bšhM©rix M¬k‘ fÜm©. " << 
	g¡d
::
’dl
;

165 
ex™
(1);

172 ià(
mm_is_com¶ex
(
m©code
è|| !
mm_is_¥¬£
(matcode))

174 
log¡»am
(
LOG_ERROR
è<< "SÜry,hi ­¶iÿtiÚ dÛ nÙ suµÜˆcom¶ex v®ue ªd„equœe ¨¥¬£ m©rix." << 
	g¡d
::
’dl
;

175 
log¡»am
(
LOG_ERROR
è<< "M¬k‘ M¬k‘y³: " << 
mm_ty³code_to_¡r
(
m©code
è<< 
	g¡d
::
’dl
;

176 
ex™
(1);

181 ià((
	g»t_code
 = 
mm_»ad_mtx_üd_size
(
f
, &
M
, &
N
, &
nz
)) !=0) {

182 
log¡»am
(
LOG_ERROR
è<< "Faed„—dšg m©rix size:ƒ¼Ü=" << 
»t_code
 << 
¡d
::
’dl
;

183 
ex™
(1);

187 
log¡»am
(
LOG_INFO
) << "Startingo„ead matrix-market input. Matrix dimensions: "

188 << 
	gM
 << " x " << 
	gN
 << ",‚Ú-z”os: " << 
	gnz
 << 
	g¡d
::
’dl
;

190 ià(
	gM
 < 5 || 
	gN
 < 5 || 
	gnz
 < 10) {

191 
log¡»am
(
LOG_ERROR
è<< "Fi su¥iciou¦y sm®l. Som‘hšg wrÚg? Fe: " << 
	gba£_f’ame
 << 
	g¡d
::
’dl
;

192 
as£¹
(
M
 < 5 || 
N
 < 5 || 
nz
 < 10);

196 ià(!
	gsh¬d”obj
.
´•roûs£d_fe_exi¡s
()) {

197 
size_t
 
	gi
=0; i<
	gnz
; i++)

199 
ušt
 
	gI
, 
	gJ
;

200 
	gv®
;

201 
	grc
 = 
fsÿnf
(
f
, "%u %u %lg\n", &
I
, &
J
, &
v®
);

202 ià(
	grc
 != 3)

203 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†še: " << 
i
 << 
¡d
::
’dl
;

204 
	gI
--;

205 
	gJ
--;

207 
	gsh¬d”obj
.
´•roûssšg_add_edge
(
I
, 
M
 + 
J
, 
®s_edge_ty³
(()
v®
));

209 
	gsh¬d”obj
.
’d_´•roûssšg
();

212 
log¡»am
(
LOG_INFO
è<< "M©rix‡Ì—dy…»´oûs£d, ju¡„uÀsh¬d”." << 
	g¡d
::
’dl
;

214 ià(
	gf
 !=
¡dš
è
fşo£
(
f
);

217 
log¡»am
(
LOG_INFO
è<< "Now c»©šg sh¬ds." << 
	g¡d
::
’dl
;

220 
	gnsh¬ds
 = 
sh¬d”obj
.
execu‹_sh¬dšg
(
g‘_İtiÚ_¡ršg
("nshards", "auto"));

222  
	gnsh¬ds
;

225 
	gMMOuu‰”
 : 
public
 
VC®lback
<
Ï‹Ávec_t
> {

226 
FILE
 * 
outf
;

227 
MMOuu‰”
(
¡d
::
¡ršg
 
âame
, 
vid_t
 
nv”tiûs
) {

228 
MM_ty³code
 
	gm©code
;

229 
mm_š™Ÿlize_ty³code
(&
m©code
);

230 
mm_£t_m©rix
(&
m©code
);

231 
mm_£t_¬¿y
(&
m©code
);

232 
mm_£t_»®
(&
m©code
);

234 
	goutf
 = 
fİ’
(
âame
.
c_¡r
(), "w");

235 
as£¹
(
outf
 !ğ
NULL
);

236 
mm_wr™e_bªÃr
(
outf
, 
m©code
);

237 
mm_wr™e_mtx_¬¿y_size
(
outf
, 
nv”tiûs
, 
NLATENT
);

240 
ÿÎback
(
vid_t
 
v”‹x_id
, 
Ï‹Ávec_t
 &
vec
) {

241 
	gi
=0; i < 
	gNLATENT
; i++) {

242 
årštf
(
outf
, "%lf\n", 
vec
.
d
[
i
]);

246 ~
MMOuu‰”
() {

247 ià(
	goutf
 !ğ
NULL
è
fşo£
(
outf
);

252 
ouut_®s_»suÉ
(
¡d
::
¡ršg
 
f’ame
, 
vid_t
 
numv”tiûs
, vid_ˆ
max_Ëá_v”‹x
) {

253 
MMOuu‰”
 
mmouut_Ëá
(
f’ame
 + "_U.mm", 
max_Ëá_v”‹x
 + 1);

254 
	gfÜ—ch_v”tiûs
<
	gÏ‹Ávec_t
>(
	gf’ame
, 0, 
	gmax_Ëá_v”‹x
 + 1, 
	gmmouut_Ëá
);

257 
MMOuu‰”
 
mmouut_right
(
f’ame
 + "_V.mm", 
numv”tiûs
 - 
max_Ëá_v”‹x
 - 1);

258 
	gfÜ—ch_v”tiûs
<
	gÏ‹Ávec_t
>(
	gf’ame
, 
	gmax_Ëá_v”‹x
 + 1, 
	gnumv”tiûs
-1, 
	gmmouut_right
);

259 
log¡»am
(
LOG_INFO
è<< "ALS ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 + "_U.mm" <<

260 ", " << 
	gf’ame
 + "_V.mm" << 
	g¡d
::
’dl
;

	@example_apps/matrix_factorization/als_edgefactors.cpp

61 
	~<¡ršg
>

62 
	~<®gÜ™hm
>

64 
	~"g¿phchi_basic_šşudes.hµ
"

67 
	~"®s.hµ
"

69 
usšg
 
Çme¥aû
 
	gg¿phchi
;

75 
Ï‹Ávec_t
 
	tV”‹xD©aTy³
;

76 
®s_çùÜ_ªd_weight
 
	tEdgeD©aTy³
;

83 
	gALSEdgeFaùÜsProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

84 
mu‹x
 
	glock
;

87 
vœtu®
 
£t_Ï‹Á_çùÜ
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
Ï‹Ávec_t
 &
çù
) {

88 
	gv”‹x
.
£t_d©a
(
çù
);

89 
	gi
=0; i < 
	gv”‹x
.
num_edges
(); i++) {

90 
®s_çùÜ_ªd_weight
 
	gçùwght
 = 
v”‹x
.
edge
(
i
)->
g‘_d©a
();

91 
	gçùwght
.
	gçùÜ
 = 
çù
;

92 
	gv”‹x
.
edge
(
i
)->
£t_d©a
(
çùwght
);

100 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

101 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0) {

106 
Ï‹Ávec_t
 
Ï‹Áçc
;

107 
	gÏ‹Áçc
.
š™
();

108 
£t_Ï‹Á_çùÜ
(
v”‹x
, 
Ï‹Áçc
);

110 
m©
 
XtX
(
NLATENT
, NLATENT);

111 
	gXtX
.
£tZ”o
();

112 
vec
 
Xty
(
NLATENT
);

113 
	gXty
.
£tZ”o
();

116 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

117 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
().
weight
;

118 
Ï‹Ávec_t
 
	gnbr_Ï‹Á
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
().
çùÜ
;

119 
	gi
=0; i<
	gNLATENT
; i++) {

120 
Xty
(
i
è+ğ
nbr_Ï‹Á
[i] * 
ob£rv©iÚ
;

121 
	gj
=
i
; j < 
	gNLATENT
; j++) {

122 
XtX
(
j
,
i
è+ğ
nbr_Ï‹Á
[i] *‚br_latent[j];

128 
	gi
=0; i <
	gNLATENT
; i++)

129 
	gj
=
i
 + 1; j< 
	gNLATENT
; j++è
XtX
(i,
j
) = XtX(j,i);

132 
	gi
=0; i < 
	gNLATENT
; i++è
XtX
(
i
,iè+ğ(
LAMBDA
è* 
v”‹x
.
num_edges
();

135 
vec
 
	gveş©’t
 = 
XtX
.
ldÉ
().
sŞve
(
Xty
);

139 
Ï‹Ávec_t
 
	gÃwÏ‹Á
;

140 
	gi
=0; i < 
	gNLATENT
; i++è
	gÃwÏ‹Á
[
i
] = 
veş©’t
[i];

143 
	gsq”rÜ
 = 0;

144 
boŞ
 
	gcompu‹_rm£
 = (
gcÚ‹xt
.
™”©iÚ
 =ğgcÚ‹xt.
num_™”©iÚs
-1 && 
v”‹x
.
num_ou‹dges
() == 0);

145 ià(
	gcompu‹_rm£
) {

146 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

148 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
().
weight
;

149 
Ï‹Ávec_t
 
	gnbr_Ï‹Á
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
().
çùÜ
;

150 
	g´ediùiÚ
 = 
nbr_Ï‹Á
.
dÙ
(
ÃwÏ‹Á
);

151 
	gsq”rÜ
 +ğ(
´ediùiÚ
 - 
ob£rv©iÚ
) * (prediction - observation);

154 
	grm£lock
.
lock
();

155 
	grm£
 +ğ
sq”rÜ
;

156 
	grm£lock
.
uÆock
();

158 ià(
	gv”‹x
.
id
() % 5000 == 1) {

159 
log¡»am
(
LOG_DEBUG
è<< "Compu‹d RMSE fÜ : " << 
v”‹x
.
id
(è<< 
¡d
::
’dl
;

163 
£t_Ï‹Á_çùÜ
(
v”‹x
, 
ÃwÏ‹Á
);

165 ià(
	gv”‹x
.
id
() % 100000 == 1) {

166 
¡d
::
cout
 << 
gcÚ‹xt
.
™”©iÚ
 << ": " << 
v”‹x
.
id
(è<< std::
’dl
;

174 ià(
	gv”‹x
.
num_ou‹dges
() > 0) {

176 ià(
	gv”‹x
.
id
(è> 
	gmax_Ëá_v”‹x
) {

177 
	glock
.
lock
();

178 
	gmax_Ëá_v”‹x
 = 
¡d
::
max
(
v”‹x
.
id
(), 
max_Ëá_v”‹x
);

179 
	glock
.
uÆock
();

182 ià(
	gv”‹x
.
id
(è> 
	gmax_right_v”‹x
) {

183 
	glock
.
lock
();

184 
	gmax_right_v”‹x
 = 
¡d
::
max
(
v”‹x
.
id
(), 
max_right_v”‹x
);

185 
	glock
.
uÆock
();

194 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

200 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

206 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

212 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

217 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

220 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

224 
m‘rics
 
	`m
("als-edgefactors");

227 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

228 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 6);

229 
boŞ
 
scheduËr
 = 
çl£
;

232 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘_fÜ_ALS
<
®s_çùÜ_ªd_weight
>(
f’ame
);

235 
ALSEdgeFaùÜsProg¿m
 
´og¿m
;

236 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
, 
nsh¬ds
, 
scheduËr
, 
m
);

237 
’gše
.
	`£t_’abË_d‘”mši¡ic_·¿Î–ism
(
çl£
);

238 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

241 
ŒašRMSE
 = 
	`sq¹
(
rm£
 / (1.0 * 
’gše
.
	`num_edges
()));

242 
m
.
	`£t
("Œaš_rm£", 
ŒašRMSE
);

243 
m
.
	`£t
("Ï‹Á_dim’siÚ", 
NLATENT
);

244 
¡d
::
cout
 << "L©’ˆçùÜ dim’siÚ: " << 
NLATENT
 << " -¿š RMSE: " << 
ŒašRMSE
 << std::
’dl
;

247 
vid_t
 
numv”tiûs
 = 
’gše
.
	`num_v”tiûs
();

248 
	`as£¹
(
numv”tiûs
 =ğ
max_right_v”‹x
 + 1);

249 
	`ouut_®s_»suÉ
(
f’ame
, 
numv”tiûs
, 
max_Ëá_v”‹x
);

253 
	`m‘rics_»pÜt
(
m
);

255 
	}
}

	@example_apps/matrix_factorization/als_vertices_inmem.cpp

61 
	~<¡ršg
>

62 
	~<®gÜ™hm
>

64 
	~"g¿phchi_basic_šşudes.hµ
"

67 
	~"®s.hµ
"

69 
usšg
 
Çme¥aû
 
	gg¿phchi
;

75 
Ï‹Ávec_t
 
	tV”‹xD©aTy³
;

76 
	tEdgeD©aTy³
;

82 
	gALSV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

83 
mu‹x
 
	glock
;

84 
	g¡d
::
veùÜ
<
Ï‹Ávec_t
> 
Ï‹Á_çùÜs_šmem
;

87 
vœtu®
 
£t_Ï‹Á_çùÜ
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
Ï‹Ávec_t
 &
çù
) {

88 
	gv”‹x
.
£t_d©a
(
çù
);

89 
	gÏ‹Á_çùÜs_šmem
[
v”‹x
.
id
()] = 
çù
;

95 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

96 ià(
	g™”©iÚ
 == 0) {

97 
Ï‹Á_çùÜs_šmem
.
»size
(
gcÚ‹xt
.
nv”tiûs
);

104 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

105 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0) {

110 
Ï‹Ávec_t
 
Ï‹Áçc
;

111 
	gÏ‹Áçc
.
š™
();

112 
£t_Ï‹Á_çùÜ
(
v”‹x
, 
Ï‹Áçc
);

114 
m©
 
XtX
(
NLATENT
, NLATENT);

115 
	gXtX
.
£tZ”o
();

116 
vec
 
Xty
(
NLATENT
);

117 
	gXty
.
£tZ”o
();

120 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

121 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

122 
	gÏ‹Ávec_t
 & 
	gnbr_Ï‹Á
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

123 
	gi
=0; i<
	gNLATENT
; i++) {

124 
Xty
(
i
è+ğ
nbr_Ï‹Á
[i] * 
ob£rv©iÚ
;

125 
	gj
=
i
; j < 
	gNLATENT
; j++) {

126 
XtX
(
j
,
i
è+ğ
nbr_Ï‹Á
[i] *‚br_latent[j];

132 
	gi
=0; i <
	gNLATENT
; i++)

133 
	gj
=
i
 + 1; j< 
	gNLATENT
; j++è
XtX
(i,
j
) = XtX(j,i);

136 
	gi
=0; i < 
	gNLATENT
; i++è
XtX
(
i
,iè+ğ(
LAMBDA
è* 
v”‹x
.
num_edges
();

139 
vec
 
	gveş©’t
 = 
XtX
.
ldÉ
().
sŞve
(
Xty
);

143 
Ï‹Ávec_t
 
	gÃwÏ‹Á
;

144 
	gi
=0; i < 
	gNLATENT
; i++è
	gÃwÏ‹Á
[
i
] = 
veş©’t
[i];

147 
	gsq”rÜ
 = 0;

148 
boŞ
 
	gcompu‹_rm£
 = (
gcÚ‹xt
.
™”©iÚ
 =ğgcÚ‹xt.
num_™”©iÚs
-1 && 
v”‹x
.
num_ou‹dges
() == 0);

149 ià(
	gcompu‹_rm£
) {

150 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

152 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

153 
	gÏ‹Ávec_t
 & 
	gnbr_Ï‹Á
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

154 
	g´ediùiÚ
 = 
nbr_Ï‹Á
.
dÙ
(
ÃwÏ‹Á
);

155 
	gsq”rÜ
 +ğ(
´ediùiÚ
 - 
ob£rv©iÚ
) * (prediction - observation);

158 
	grm£lock
.
lock
();

159 
	grm£
 +ğ
sq”rÜ
;

160 
	grm£lock
.
uÆock
();

162 ià(
	gv”‹x
.
id
() % 5000 == 1) {

163 
log¡»am
(
LOG_DEBUG
è<< "Compu‹d RMSE fÜ : " << 
v”‹x
.
id
(è<< 
¡d
::
’dl
;

167 
£t_Ï‹Á_çùÜ
(
v”‹x
, 
ÃwÏ‹Á
);

169 ià(
	gv”‹x
.
id
() % 100000 == 1) {

170 
¡d
::
cout
 << 
gcÚ‹xt
.
™”©iÚ
 << ": " << 
v”‹x
.
id
(è<< std::
’dl
;

178 ià(
	gv”‹x
.
num_ou‹dges
() > 0) {

180 ià(
	gv”‹x
.
id
(è> 
	gmax_Ëá_v”‹x
) {

181 
	glock
.
lock
();

182 
	gmax_Ëá_v”‹x
 = 
¡d
::
max
(
v”‹x
.
id
(), 
max_Ëá_v”‹x
);

183 
	glock
.
uÆock
();

186 ià(
	gv”‹x
.
id
(è> 
	gmax_right_v”‹x
) {

187 
	glock
.
lock
();

188 
	gmax_right_v”‹x
 = 
¡d
::
max
(
v”‹x
.
id
(), 
max_right_v”‹x
);

189 
	glock
.
uÆock
();

200 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

206 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

212 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

217 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

220 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

224 
m‘rics
 
	`m
("als-inmemory-factors");

227 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

228 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 6);

229 
boŞ
 
scheduËr
 = 
çl£
;

232 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘_fÜ_ALS
<>(
f’ame
);

235 
ALSV”tiûsInMemProg¿m
 
´og¿m
;

236 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
, 
nsh¬ds
, 
scheduËr
, 
m
);

237 
’gše
.
	`£t_modif›s_šedges
(
çl£
);

238 
’gše
.
	`£t_modif›s_ou‹dges
(
çl£
);

239 
’gše
.
	`£t_’abË_d‘”mši¡ic_·¿Î–ism
(
çl£
);

241 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

244 
ŒašRMSE
 = 
	`sq¹
(
rm£
 / (1.0 * 
’gše
.
	`num_edges
()));

245 
m
.
	`£t
("Œaš_rm£", 
ŒašRMSE
);

246 
m
.
	`£t
("Ï‹Á_dim’siÚ", 
NLATENT
);

247 
¡d
::
cout
 << "L©’ˆçùÜ dim’siÚ: " << 
NLATENT
 << " -¿š RMSE: " << 
ŒašRMSE
 << std::
’dl
;

250 
vid_t
 
numv”tiûs
 = 
’gše
.
	`num_v”tiûs
();

251 
	`as£¹
(
numv”tiûs
 =ğ
max_right_v”‹x
 + 1);

252 
	`ouut_®s_»suÉ
(
f’ame
, 
numv”tiûs
, 
max_Ëá_v”‹x
);

256 
	`m‘rics_»pÜt
(
m
);

258 
	}
}

	@example_apps/matrix_factorization/graphlab_gas/als_graphlab.cpp

32 
	~<¡ršg
>

33 
	~<®gÜ™hm
>

35 
	~"../m©rixm¬k‘/mmio.h
"

36 
	~"../m©rixm¬k‘/mmio.c
"

37 
	~"g¿phchi_basic_šşudes.hµ
"

38 
	~"­i/g¿phÏb2_1_GAS_­i/g¿phÏb.hµ
"

40 
	~"®s_v”‹x_´og¿m.hµ
"

42 
usšg
 
Çme¥aû
 
	gg¿phchi
;

43 
usšg
 
Çme¥aû
 
	gg¿phÏb
;

46 
cÚv”t_m©rixm¬k‘_fÜ_ALS_g¿phÏb
(
¡d
::
¡ršg
 
f’ame
);

48 
size_t
 
	gv”‹x_d©a
::
NLATENT
 = 5;

49 
	g®s_v”‹x_´og¿m
::
TOLERANCE
 = 1e-3;

50 
	g®s_v”‹x_´og¿m
::
LAMBDA
 = 0.01;

51 
size_t
 
	g®s_v”‹x_´og¿m
::
MAX_UPDATES
 = -1;

53 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

56 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

60 
m‘rics
 
	`m
("als-graphlab");

64 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

65 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 4);

68 
nsh¬ds
 = 
	`cÚv”t_m©rixm¬k‘_fÜ_ALS_g¿phÏb
(
f’ame
);

71 
¡d
::
veùÜ
<
v”‹x_d©a
> * 
v”tiûs
 =

72 
run_g¿phÏb_v”‹x´og¿m
<
®s_v”‹x_´og¿m
>(
f’ame
, 
nsh¬ds
, 
n™”s
, 
çl£
, 
m
, false, false);

75 
”rÜ_agg»g©Ü
 
fš®_”rÜ
 =

76 
run_g¿phÏb_edge_agg»g©Ü
<
®s_v”‹x_´og¿m
, 
”rÜ_agg»g©Ü
>(
f’ame
, 
nsh¬ds
,

77 
”rÜ_agg»g©Ü
::
m­
,ƒ¼Ü_agg»g©Ü::
fš®ize
, 
v”tiûs
, 
m
);

79 
¡d
::
cout
 << "Fš®¿šƒ¼Ü: " << 
fš®_”rÜ
.
Œaš_”rÜ
 << std::
’dl
;

82 
d–‘e
 
v”tiûs
;

84 
	`m‘rics_»pÜt
(
m
);

86 
	}
}

94 
cÚv”t_m©rixm¬k‘_fÜ_ALS_g¿phÏb
(
¡d
::
¡ršg
 
ba£_f’ame
) {

96 
»t_code
;

97 
MM_ty³code
 
	gm©code
;

98 
FILE
 *
	gf
;

99 
	gM
, 
	gN
, 
	gnz
;

104 
	gnsh¬ds
;

105 ià((
	gnsh¬ds
 = 
fšd_sh¬ds
<
edge_d©a
>(
ba£_f’ame
, 
g‘_İtiÚ_¡ršg
("nshards", "auto")))) {

106 
log¡»am
(
LOG_INFO
è<< "F" << 
	gba£_f’ame
 << " wa ®»ady…»´oûs£d, wÚ'ˆdØ™‡gaš. " << 
	g¡d
::
’dl
;

107 
log¡»am
(
LOG_INFO
è<< "Iàthi i nÙ iÁ’ded,…Ëa£ d–‘thsh¬d fe ªdry‡gaš. " << 
	g¡d
::
’dl
;

108  
	gnsh¬ds
;

111 
	gsh¬d”
<
	gedge_d©a
> 
sh¬d”obj
(
ba£_f’ame
);

112 
	gsh¬d”obj
.
¡¬t_´•roûssšg
();

115 ià((
	gf
 = 
fİ’
(
ba£_f’ame
.
c_¡r
(), "r")è=ğ
NULL
) {

116 
log¡»am
(
LOG_ERROR
è<< "Could‚Ù o³Àfe: " << 
ba£_f’ame
 << ",ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

117 
ex™
(1);

121 ià(
mm_»ad_bªÃr
(
f
, &
m©code
) != 0)

123 
log¡»am
(
LOG_ERROR
è<< "Could‚Ù…roûs M©rix M¬k‘ bªÃr. Fe: " << 
ba£_f’ame
 << 
¡d
::
’dl
;

124 
log¡»am
(
LOG_ERROR
è<< "M©rix mu¡ bšhM©rix M¬k‘ fÜm©. " << 
	g¡d
::
’dl
;

125 
ex™
(1);

132 ià(
mm_is_com¶ex
(
m©code
è|| !
mm_is_¥¬£
(matcode))

134 
log¡»am
(
LOG_ERROR
è<< "SÜry,hi ­¶iÿtiÚ dÛ nÙ suµÜˆcom¶ex v®ue ªd„equœe ¨¥¬£ m©rix." << 
	g¡d
::
’dl
;

135 
log¡»am
(
LOG_ERROR
è<< "M¬k‘ M¬k‘y³: " << 
mm_ty³code_to_¡r
(
m©code
è<< 
	g¡d
::
’dl
;

136 
ex™
(1);

141 ià((
	g»t_code
 = 
mm_»ad_mtx_üd_size
(
f
, &
M
, &
N
, &
nz
)) !=0) {

142 
log¡»am
(
LOG_ERROR
è<< "Faed„—dšg m©rix size:ƒ¼Ü=" << 
»t_code
 << 
¡d
::
’dl
;

143 
ex™
(1);

147 
log¡»am
(
LOG_INFO
) << "Startingo„ead matrix-market input. Matrix dimensions: "

148 << 
	gM
 << " x " << 
	gN
 << ",‚Ú-z”os: " << 
	gnz
 << 
	g¡d
::
’dl
;

150 ià(
	gM
 < 5 || 
	gN
 < 5 || 
	gnz
 < 10) {

151 
log¡»am
(
LOG_ERROR
è<< "Fi su¥iciou¦y sm®l. Som‘hšg wrÚg? Fe: " << 
	gba£_f’ame
 << 
	g¡d
::
’dl
;

152 
as£¹
(
M
 < 5 || 
N
 < 5 || 
nz
 < 10);

156 ià(!
	gsh¬d”obj
.
´•roûs£d_fe_exi¡s
()) {

157 
	gi
=0; i<
	gnz
; i++)

159 
	gI
, 
	gJ
;

160 
	gv®
;

161 
fsÿnf
(
f
, "%d %d %lg\n", &
I
, &
J
, &
v®
);

162 
	gI
--;

163 
	gJ
--;

166 
	gsh¬d”obj
.
´•roûssšg_add_edge
(
I
, 
M
 + 
J
, 
edge_d©a
(
v®
,ƒdge_d©a::
TRAIN
));

168 
	gsh¬d”obj
.
’d_´•roûssšg
();

171 
log¡»am
(
LOG_INFO
è<< "M©rix‡Ì—dy…»´oûs£d, ju¡„uÀsh¬d”." << 
	g¡d
::
’dl
;

173 ià(
	gf
 !=
¡dš
è
fşo£
(
f
);

176 
log¡»am
(
LOG_INFO
è<< "Now c»©šg sh¬ds." << 
	g¡d
::
’dl
;

179 
	gnsh¬ds
 = 
sh¬d”obj
.
execu‹_sh¬dšg
(
g‘_İtiÚ_¡ršg
("nshards", "auto"));

181  
	gnsh¬ds
;

	@example_apps/matrix_factorization/graphlab_gas/als_vertex_program.hpp

25 #iâdeà
ALS_VERTEX_PROGRAM_HPP


26 
	#ALS_VERTEX_PROGRAM_HPP


	)

40 
	~<Eig’/D’£
>

47 
	gEig’
::
	tVeùÜXd
 
	tvec_ty³
;

48 
	gEig’
::
	tM©rixXd
 
	tm©_ty³
;

63 
	sv”‹x_d©a
 {

68 
size_t
 
	mNLATENT
;

70 
ušt32_t
 
	mnupd©es
;

72 
	m»sidu®
;

74 
vec_ty³
 
	mçùÜ
;

79 
v”‹x_d©a
(è: 
nupd©es
(0), 
»sidu®
(1è{ 
¿ndomize
(); }

81 
¿ndomize
(è{ 
	mçùÜ
.
»size
(
NLATENT
); faùÜ.
£tRªdom
(); }

98 
	gedge_d©a
 : 
public
 
g¿phÏb
::
IS_POD_TYPE
 {

107 
	ed©a_rŞe_ty³
 { 
TRAIN
, 
	gVALIDATE
, 
	gPREDICT
 };

110 
	gobs
;

113 
d©a_rŞe_ty³
 
	grŞe
;

116 
edge_d©a
(
obs
 = 0, 
d©a_rŞe_ty³
 
rŞe
 = 
PREDICT
) :

117 
obs
(obs), 
rŞe
(role) { }

126 
	gg¿phÏb
::
	tdi¡ribu‹d_g¿ph
<
	tv”‹x_d©a
, 
	tedge_d©a
> 
	tg¿ph_ty³
;

133 
šlše
 
	gg¿ph_ty³
::
v”‹x_ty³


134 
g‘_Ùh”_v”‹x
(
g¿ph_ty³
::
edge_ty³
& 
edge
,

135 cÚ¡ 
g¿ph_ty³
::
v”‹x_ty³
& 
v”‹x
) {

136  
v”‹x
.
id
(è=ğ
edge
.
sourû
().id()?ƒdge.
rg‘
() :ƒdge.source();

143 
exŒaù_l2_”rÜ
(cÚ¡ 
g¿ph_ty³
::
edge_ty³
 & 
edge
) {

144 cÚ¡ 
´ed
 =

145 
edge
.
sourû
().
d©a
().
çùÜ
.
dÙ
Ódge.
rg‘
().data().factor);

146  (
	gedge
.
d©a
().
	gobs
 - 
	g´ed
) * (edge.data().obs -…red);

195 şas 
	cg©h”_ty³
 {

196 
	mpublic
:

201 
m©_ty³
 
XtX
;

206 
vec_ty³
 
	mXy
;

209 
	$g©h”_ty³
() { }

215 
	$g©h”_ty³
(cÚ¡ 
vec_ty³
& 
X
, cÚ¡ 
y
) :

216 
	`XtX
(
X
.
	`size
(), X.size()), 
	`Xy
(X.
	$size
()) {

217 
XtX
.
ŒŸnguÏrV›w
<
Eig’
::
Uµ”
>(èğ
X
 * X.
	`Œª¥o£
();

218 
Xy
 = 
X
 * 
y
;

219 
	}
}

231 
	gg©h”_ty³
& 
	gİ”©Ü
+=(cÚ¡ 
g©h”_ty³
& 
Ùh”
) {

232 if(
Ùh”
.
Xy
.
size
() == 0) {

233 
ASSERT_EQ
(
Ùh”
.
XtX
.
rows
(), 0);

234 
ASSERT_EQ
(
Ùh”
.
XtX
.
cŞs
(), 0);

236 if(
	gXy
.
size
() == 0) {

237 
ASSERT_EQ
(
XtX
.
rows
(), 0);

238 
ASSERT_EQ
(
XtX
.
cŞs
(), 0);

239 
	gXtX
 = 
Ùh”
.
XtX
; 
	gXy
 = oth”.
Xy
;

241 
	gXtX
.
	gŒŸnguÏrV›w
<
	gEig’
::
Uµ”
>(è+ğ
Ùh”
.
XtX
;

242 
	gXy
 +ğ
Ùh”
.
Xy
;

245  *
	gthis
;

255 
şass
 
	g®s_v”‹x_´og¿m
 :

256 
public
 
g¿phÏb
::
iv”‹x_´og¿m
<
g¿ph_ty³
, 
	gg©h”_ty³
,

257 
	gg¿phÏb
::
mes§ges
::
sum_´iÜ™y
>,

258 
public
 
	gg¿phÏb
::
IS_POD_TYPE
 {

259 
public
:

261 
TOLERANCE
;

262 
	gLAMBDA
;

263 
size_t
 
	gMAX_UPDATES
;

266 
edge_dœ_ty³
 
g©h”_edges
(
icÚ‹xt_ty³
& 
cÚ‹xt
,

267 cÚ¡ 
v”‹x_ty³
& 
v”‹x
) const {

268  
	gg¿phÏb
::
ALL_EDGES
;

272 
g©h”_ty³
 
g©h”
(
icÚ‹xt_ty³
& 
cÚ‹xt
, cÚ¡ 
v”‹x_ty³
& 
v”‹x
,

273 
edge_ty³
& 
edge
) const {

274 if(
	gedge
.
d©a
().
	grŞe
 =ğ
edge_d©a
::
TRAIN
) {

275 cÚ¡ 
v”‹x_ty³
 
Ùh”_v”‹x
 = 
g‘_Ùh”_v”‹x
(
edge
, 
v”‹x
);

276  
g©h”_ty³
(
Ùh”_v”‹x
.
d©a
().
çùÜ
, 
edge
.d©a().
obs
);

277 }  
g©h”_ty³
();

281 
­¶y
(
icÚ‹xt_ty³
& 
cÚ‹xt
, 
v”‹x_ty³
& 
v”‹x
,

282 cÚ¡ 
g©h”_ty³
& 
sum
) {

284 
	gv”‹x_d©a
& 
	gvd©a
 = 
v”‹x
.
d©a
();

287 if(
	gsum
.
	gXy
.
size
(è=ğ0è{ 
vd©a
.
»sidu®
 = 0; ++
	gvd©a
.
	gnupd©es
; ; }

288 
m©_ty³
 
	gXtX
 = 
sum
.
XtX
;

289 
vec_ty³
 
	gXy
 = 
sum
.
Xy
;

291 
	gi
 = 0; i < 
	gXtX
.
rows
(); ++iè
XtX
(
i
,iè+ğ
LAMBDA
;

293 cÚ¡ 
vec_ty³
 
	gŞd_çùÜ
 = 
vd©a
.
çùÜ
;

294 
	gvd©a
.
	gçùÜ
 = 
XtX
.
£lçdjoštV›w
<
Eig’
::
Uµ”
>().
ldÉ
().
sŞve
(
Xy
);

296 
	gvd©a
.
	g»sidu®
 = (
vd©a
.
çùÜ
 - 
Şd_çùÜ
).
cwi£Abs
().
sum
(è/ 
XtX
.
rows
();

297 ++
	gvd©a
.
	gnupd©es
;

301 
edge_dœ_ty³
 
sÿ‰”_edges
(
icÚ‹xt_ty³
& 
cÚ‹xt
,

302 cÚ¡ 
v”‹x_ty³
& 
v”‹x
) const {

303  
	gg¿phÏb
::
ALL_EDGES
;

307 
sÿ‰”
(
icÚ‹xt_ty³
& 
cÚ‹xt
, cÚ¡ 
v”‹x_ty³
& 
v”‹x
,

308 
edge_ty³
& 
edge
) const {

327 
	gg¿phÏb
::
em±y
 
sigÇl_Ëá
(
icÚ‹xt_ty³
& 
cÚ‹xt
,

328 
v”‹x_ty³
& 
v”‹x
) {

329 if(
	gv”‹x
.
num_out_edges
(è> 0è
	gcÚ‹xt
.
sigÇl
(
v”‹x
);

330  
	gg¿phÏb
::
em±y
();

336 
	g”rÜ_agg»g©Ü
 : 
public
 
g¿phÏb
::
IS_POD_TYPE
 {

337 
®s_v”‹x_´og¿m
::
	ticÚ‹xt_ty³
 icontext_type;

338 
	gg¿ph_ty³
::
	tedge_ty³
ƒdge_type;

339 
	gŒaš_”rÜ
, 
	gv®id©iÚ_”rÜ
;

340 
size_t
 
	gÁ¿š
, 
	gnv®id©iÚ
;

341 
”rÜ_agg»g©Ü
() :

342 
Œaš_”rÜ
(0), 
v®id©iÚ_”rÜ
(0), 
Á¿š
(0), 
nv®id©iÚ
(0) { }

343 
	g”rÜ_agg»g©Ü
& 
	gİ”©Ü
+=(cÚ¡ 
”rÜ_agg»g©Ü
& 
Ùh”
) {

344 
Œaš_”rÜ
 +ğ
Ùh”
.train_error;

345 
	gv®id©iÚ_”rÜ
 +ğ
Ùh”
.
v®id©iÚ_”rÜ
;

346 
	gÁ¿š
 +ğ
Ùh”
.
Á¿š
;

347 
	gnv®id©iÚ
 +ğ
Ùh”
.
nv®id©iÚ
;

348  *
	gthis
;

350 
”rÜ_agg»g©Ü
 
m­
(
icÚ‹xt_ty³
& 
cÚ‹xt
, cÚ¡ 
g¿ph_ty³
::
edge_ty³
& 
edge
) {

351 
”rÜ_agg»g©Ü
 
agg
;

352 if(
	gedge
.
d©a
().
	grŞe
 =ğ
edge_d©a
::
TRAIN
) {

353 
agg
.
Œaš_”rÜ
 = 
exŒaù_l2_”rÜ
(
edge
); 
	gagg
.
	gÁ¿š
 = 1;

354 } if(
	gedge
.
d©a
().
	grŞe
 =ğ
edge_d©a
::
VALIDATE
) {

355 
agg
.
v®id©iÚ_”rÜ
 = 
exŒaù_l2_”rÜ
(
edge
); 
	gagg
.
	gnv®id©iÚ
 = 1;

357  
	gagg
;

359 
fš®ize
(
icÚ‹xt_ty³
& 
cÚ‹xt
, 
”rÜ_agg»g©Ü
& 
agg
) {

360 
ASSERT_GT
(
agg
.
Á¿š
, 0);

361 
	gagg
.
	gŒaš_”rÜ
 = 
¡d
::
sq¹
(
agg
.
Œaš_”rÜ
 /‡gg.
Á¿š
);

362 
	gcÚ‹xt
.
cout
(è<< cÚ‹xt.
–­£d_£cÚds
(è<< "\t" << 
	gagg
.
	gŒaš_”rÜ
;

363 if(
	gagg
.
	gnv®id©iÚ
 > 0) {

364 cÚ¡ 
	gv®id©iÚ_”rÜ
 =

365 
¡d
::
sq¹
(
agg
.
v®id©iÚ_”rÜ
 /‡gg.
nv®id©iÚ
);

366 
	gcÚ‹xt
.
cout
(è<< "\t" << 
	gv®id©iÚ_”rÜ
;

368 
	gcÚ‹xt
.
cout
(è<< 
	g¡d
::
’dl
;

373 
	s´ediùiÚ_§v”
 {

374 
	mg¿ph_ty³
::
	tv”‹x_ty³
 vertex_type;

375 
	mg¿ph_ty³
::
	tedge_ty³
ƒdge_type;

376 
	m¡d
::
¡ršg
 
§ve_v”‹x
(cÚ¡ 
v”‹x_ty³
& 
v”‹x
) const {

379 
	m¡d
::
¡ršg
 
§ve_edge
(cÚ¡ 
edge_ty³
& 
edge
) const {

380 
¡d
::
¡ršg¡»am
 
¡rm
;

381 cÚ¡ 
	m´ediùiÚ
 =

382 
edge
.
sourû
().
d©a
().
çùÜ
.
dÙ
Ódge.
rg‘
().data().factor);

383 
	m¡rm
 << 
	medge
.
sourû
().
id
() << '\t'

384 << 
	medge
.
rg‘
().
id
() << '\t'

385 << 
	m´ediùiÚ
 << '\n';

386  
	m¡rm
.
¡r
();

	@example_apps/matrix_factorization/matrixmarket/mmio.c

10 
	~<¡dio.h
>

11 
	~<¡ršg.h
>

12 
	~<¡dlib.h
>

13 
	~<ùy³.h
>

15 
	~"mmio.h
"

17 
	$mm_»ad_unsymm‘ric_¥¬£
(cÚ¡ *
âame
, *
M_
, *
N_
, *
nz_
,

18 **
v®_
, **
I_
, **
J_
)

20 
FILE
 *
f
;

21 
MM_ty³code
 
m©code
;

22 
ušt
 
M
, 
N
;

23 
size_t
 
nz
, 
i
;

24 *
v®
;

25 *
I
, *
J
;

27 ià((
f
 = 
	`fİ’
(
âame
, "r")è=ğ
NULL
)

31 ià(
	`mm_»ad_bªÃr
(
f
, &
m©code
) != 0)

33 
	`´štf
("mm_read_unsymetric: Could‚ot…rocess Matrix Market banner ");

34 
	`´štf
(" iÀf[%s]\n", 
âame
);

40 iàĞ!(
	`mm_is_»®
(
m©code
è&& 
	`mm_is_m©rix
(matcode) &&

41 
	`mm_is_¥¬£
(
m©code
)))

43 
	`årštf
(
¡d”r
, "Sorry,his‡pplication does‚ot support ");

44 
	`årštf
(
¡d”r
, "Market Marketype: [%s]\n",

45 
	`mm_ty³code_to_¡r
(
m©code
));

51 ià(
	`mm_»ad_mtx_üd_size
(
f
, &
M
, &
N
, &
nz
) !=0)

53 
	`årštf
(
¡d”r
, "read_unsymmetric_sparse(): could‚ot…arse matrix size.\n");

57 *
M_
 = 
M
;

58 *
N_
 = 
N
;

59 *
nz_
 = 
nz
;

63 
I
 = (*è
	`m®loc
(
nz
 * ());

64 
J
 = (*è
	`m®loc
(
nz
 * ());

65 
v®
 = (*è
	`m®loc
(
nz
 * ());

67 *
v®_
 = 
v®
;

68 *
I_
 = 
I
;

69 *
J_
 = 
J
;

75 
i
=0; i<
nz
; i++)

77 
rc
 = 
	`fsÿnf
(
f
, "%d %d %lg\n", &
I
[
i
], &
J
[i], &
v®
[i]);

78 ià(
rc
 != 3)

79 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad iÅuˆrow: " << 
i
 << 
¡d
::
’dl
;

80 
I
[
i
]--;

81 
J
[
i
]--;

83 
	`fşo£
(
f
);

86 
	}
}

88 
	$mm_is_v®id
(
MM_ty³code
 
m©code
)

90 ià(!
	`mm_is_m©rix
(
m©code
))  0;

91 ià(
	`mm_is_d’£
(
m©code
è&& 
	`mm_is_·‰”n
(matcode))  0;

92 ià(
	`mm_is_»®
(
m©code
è&& 
	`mm_is_h”m™Ÿn
(matcode))  0;

93 ià(
	`mm_is_·‰”n
(
m©code
è&& (
	`mm_is_h”m™Ÿn
(matcode) ||

94 
	`mm_is_skew
(
m©code
)))  0;

96 
	}
}

98 
	$mm_»ad_bªÃr
(
FILE
 *
f
, 
MM_ty³code
 *
m©code
)

100 
lše
[
MM_MAX_LINE_LENGTH
];

101 
bªÃr
[
MM_MAX_TOKEN_LENGTH
];

102 
mtx
[
MM_MAX_TOKEN_LENGTH
];

103 
üd
[
MM_MAX_TOKEN_LENGTH
];

104 
d©a_ty³
[
MM_MAX_TOKEN_LENGTH
];

105 
¡Üage_scheme
[
MM_MAX_TOKEN_LENGTH
];

106 *
p
;

109 
	`mm_ş—r_ty³code
(
m©code
);

111 ià(
	`fg‘s
(
lše
, 
MM_MAX_LINE_LENGTH
, 
f
è=ğ
NULL
)

112  
MM_PREMATURE_EOF
;

114 ià(
	`ssÿnf
(
lše
, "% % % % %s", 
bªÃr
, 
mtx
, 
üd
, 
d©a_ty³
,

115 
¡Üage_scheme
) != 5)

116  
MM_PREMATURE_EOF
;

118 
p
=
mtx
; *p!='\0'; *p=
	`tŞow”
(*p),p++);

119 
p
=
üd
; *p!='\0'; *p=
	`tŞow”
(*p),p++);

120 
p
=
d©a_ty³
; *p!='\0'; *p=
	`tŞow”
(*p),p++);

121 
p
=
¡Üage_scheme
; *p!='\0'; *p=
	`tŞow”
(*p),p++);

124 ià(
	`¡ºcmp
(
bªÃr
, 
M©rixM¬k‘BªÃr
, 
	`¡¾’
(MatrixMarketBanner)) != 0)

125  
MM_NO_HEADER
;

128 ià(
	`¡rcmp
(
mtx
, 
MM_MTX_STR
) != 0)

129  
MM_UNSUPPORTED_TYPE
;

130 
	`mm_£t_m©rix
(
m©code
);

137 ià(
	`¡rcmp
(
üd
, 
MM_SPARSE_STR
) == 0)

138 
	`mm_£t_¥¬£
(
m©code
);

140 ià(
	`¡rcmp
(
üd
, 
MM_DENSE_STR
) == 0)

141 
	`mm_£t_d’£
(
m©code
);

143  
MM_UNSUPPORTED_TYPE
;

148 ià(
	`¡rcmp
(
d©a_ty³
, 
MM_REAL_STR
) == 0)

149 
	`mm_£t_»®
(
m©code
);

151 ià(
	`¡rcmp
(
d©a_ty³
, 
MM_COMPLEX_STR
) == 0)

152 
	`mm_£t_com¶ex
(
m©code
);

154 ià(
	`¡rcmp
(
d©a_ty³
, 
MM_PATTERN_STR
) == 0)

155 
	`mm_£t_·‰”n
(
m©code
);

157 ià(
	`¡rcmp
(
d©a_ty³
, 
MM_INT_STR
) == 0)

158 
	`mm_£t_š‹g”
(
m©code
);

160  
MM_UNSUPPORTED_TYPE
;

165 ià(
	`¡rcmp
(
¡Üage_scheme
, 
MM_GENERAL_STR
) == 0)

166 
	`mm_£t_g’”®
(
m©code
);

168 ià(
	`¡rcmp
(
¡Üage_scheme
, 
MM_SYMM_STR
) == 0)

169 
	`mm_£t_symm‘ric
(
m©code
);

171 ià(
	`¡rcmp
(
¡Üage_scheme
, 
MM_HERM_STR
) == 0)

172 
	`mm_£t_h”m™Ÿn
(
m©code
);

174 ià(
	`¡rcmp
(
¡Üage_scheme
, 
MM_SKEW_STR
) == 0)

175 
	`mm_£t_skew
(
m©code
);

177  
MM_UNSUPPORTED_TYPE
;

181 
	}
}

183 
	$mm_wr™e_mtx_üd_size
(
FILE
 *
f
, 
ušt
 
M
, ušˆ
N
, 
size_t
 
nz
)

185 ià(
	`årštf
(
f
, "%u %u %Îu\n", 
M
, 
N
, ()
nz
) != 3)

186  
MM_COULD_NOT_WRITE_FILE
;

189 
	}
}

191 
	$mm_»ad_mtx_üd_size
(
FILE
 *
f
, 
ušt
 *
M
, ušˆ*
N
, 
size_t
 *
nz
 )

193 
lše
[
MM_MAX_LINE_LENGTH
];

194 
num_™ems_»ad
;

197 *
M
 = *
N
 = *
nz
 = 0;

202 ià(
	`fg‘s
(
lše
,
MM_MAX_LINE_LENGTH
,
f
è=ğ
NULL
)

203  
MM_PREMATURE_EOF
;

204 }
lše
[0] == '%');

207 ià(
	`ssÿnf
(
lše
, "%u %u %Îu", 
M
, 
N
, (*)
nz
) == 3)

213 
num_™ems_»ad
 = 
	`fsÿnf
(
f
, "%u %u %ld", 
M
, 
N
, 
nz
);

214 ià(
num_™ems_»ad
 =ğ
EOF
è 
MM_PREMATURE_EOF
;

216 
num_™ems_»ad
 != 3);

219 
	}
}

222 
	$mm_»ad_mtx_¬¿y_size
(
FILE
 *
f
, 
ušt
 *
M
, ušˆ*
N
)

224 
lše
[
MM_MAX_LINE_LENGTH
];

225 
num_™ems_»ad
;

227 *
M
 = *
N
 = 0;

232 ià(
	`fg‘s
(
lše
,
MM_MAX_LINE_LENGTH
,
f
è=ğ
NULL
)

233  
MM_PREMATURE_EOF
;

234 }
lše
[0] == '%');

237 ià(
	`ssÿnf
(
lše
, "%u %u", 
M
, 
N
) == 2)

243 
num_™ems_»ad
 = 
	`fsÿnf
(
f
, "%u %u", 
M
, 
N
);

244 ià(
num_™ems_»ad
 =ğ
EOF
è 
MM_PREMATURE_EOF
;

246 
num_™ems_»ad
 != 2);

249 
	}
}

251 
	$mm_wr™e_mtx_¬¿y_size
(
FILE
 *
f
, 
ušt
 
M
, ušˆ
N
)

253 ià(
	`årštf
(
f
, "%u %u\n", 
M
, 
N
) != 2)

254  
MM_COULD_NOT_WRITE_FILE
;

257 
	}
}

267 
	$mm_»ad_mtx_üd_d©a
(
FILE
 *
f
, 
ušt
 
M
, ušˆ
N
, 
size_t
 
nz
, ušˆ
I
[], ušˆ
J
[],

268 
v®
[], 
MM_ty³code
 
m©code
)

270 
size_t
 
i
;

271 ià(
	`mm_is_com¶ex
(
m©code
))

273 
i
=0; i<
nz
; i++)

274 ià(
	`fsÿnf
(
f
, "%u %u %lg %lg", &
I
[
i
], &
J
[i], &
v®
[2*i], &val[2*i+1])

275 !ğ4è 
MM_PREMATURE_EOF
;

277 ià(
	`mm_is_»®
(
m©code
))

279 
i
=0; i<
nz
; i++)

281 ià(
	`fsÿnf
(
f
, "%u %u %lg\n", &
I
[
i
], &
J
[i], &
v®
[i])

282 !ğ3è 
MM_PREMATURE_EOF
;

287 ià(
	`mm_is_·‰”n
(
m©code
))

289 
i
=0; i<
nz
; i++)

290 ià(
	`fsÿnf
(
f
, "%u %u", &
I
[
i
], &
J
[i])

291 !ğ2è 
MM_PREMATURE_EOF
;

294  
MM_UNSUPPORTED_TYPE
;

298 
	}
}

300 
	$mm_»ad_mtx_üd_’Œy
(
FILE
 *
f
, *
I
, *
J
,

301 *
»®
, *
imag
, 
MM_ty³code
 
m©code
)

303 ià(
	`mm_is_com¶ex
(
m©code
))

305 ià(
	`fsÿnf
(
f
, "%d %d %lg %lg", 
I
, 
J
, 
»®
, 
imag
)

306 !ğ4è 
MM_PREMATURE_EOF
;

308 ià(
	`mm_is_»®
(
m©code
))

310 ià(
	`fsÿnf
(
f
, "%d %d %lg\n", 
I
, 
J
, 
»®
)

311 !ğ3è 
MM_PREMATURE_EOF
;

315 ià(
	`mm_is_·‰”n
(
m©code
))

317 ià(
	`fsÿnf
(
f
, "%d %d", 
I
, 
J
è!ğ2è 
MM_PREMATURE_EOF
;

320  
MM_UNSUPPORTED_TYPE
;

324 
	}
}

335 
	$mm_»ad_mtx_üd
(*
âame
, 
ušt
 *
M
, ušˆ*
N
, 
size_t
 *
nz
, ušˆ**
I
, ušˆ**
J
,

336 **
v®
, 
MM_ty³code
 *
m©code
)

338 
»t_code
;

339 
FILE
 *
f
;

341 ià(
	`¡rcmp
(
âame
, "¡dš"è=ğ0è
f
=
¡dš
;

343 ià((
f
 = 
	`fİ’
(
âame
, "r")è=ğ
NULL
)

344  
MM_COULD_NOT_READ_FILE
;

347 ià((
»t_code
 = 
	`mm_»ad_bªÃr
(
f
, 
m©code
)) != 0)

348  
»t_code
;

350 ià(!(
	`mm_is_v®id
(*
m©code
è&& 
	`mm_is_¥¬£
(*matcode) &&

351 
	`mm_is_m©rix
(*
m©code
)))

352  
MM_UNSUPPORTED_TYPE
;

354 ià((
»t_code
 = 
	`mm_»ad_mtx_üd_size
(
f
, 
M
, 
N
, 
nz
)) != 0)

355  
»t_code
;

358 *
I
 = (
ušt
 *è
	`m®loc
(*
nz
 * (uint));

359 *
J
 = (
ušt
 *è
	`m®loc
(*
nz
 * (uint));

360 *
v®
 = 
NULL
;

362 ià(
	`mm_is_com¶ex
(*
m©code
))

364 *
v®
 = (*è
	`m®loc
(*
nz
 * 2 * ());

365 
»t_code
 = 
	`mm_»ad_mtx_üd_d©a
(
f
, *
M
, *
N
, *
nz
, *
I
, *
J
, *
v®
,

366 *
m©code
);

367 ià(
»t_code
 != 0) „et_code;

369 ià(
	`mm_is_»®
(*
m©code
))

371 *
v®
 = (*è
	`m®loc
(*
nz
 * ());

372 
»t_code
 = 
	`mm_»ad_mtx_üd_d©a
(
f
, *
M
, *
N
, *
nz
, *
I
, *
J
, *
v®
,

373 *
m©code
);

374 ià(
»t_code
 != 0) „et_code;

377 ià(
	`mm_is_·‰”n
(*
m©code
))

379 
»t_code
 = 
	`mm_»ad_mtx_üd_d©a
(
f
, *
M
, *
N
, *
nz
, *
I
, *
J
, *
v®
,

380 *
m©code
);

381 ià(
»t_code
 != 0) „et_code;

384 ià(
f
 !ğ
¡dš
è
	`fşo£
(f);

386 
	}
}

388 
	$mm_wr™e_bªÃr
(
FILE
 *
f
, 
MM_ty³code
 
m©code
)

390 *
¡r
 = 
	`mm_ty³code_to_¡r
(
m©code
);

391 
»t_code
;

393 
»t_code
 = 
	`årštf
(
f
, "% %s\n", 
M©rixM¬k‘BªÃr
, 
¡r
);

394 
	`ä“
(
¡r
);

395 ià(
»t_code
 !=2 )

396  
MM_COULD_NOT_WRITE_FILE
;

399 
	}
}

401 
	$mm_wr™e_mtx_üd
(
âame
[], 
M
, 
N
, 
nz
, 
I
[], 
J
[],

402 
v®
[], 
MM_ty³code
 
m©code
)

404 
FILE
 *
f
;

405 
i
;

407 ià(
	`¡rcmp
(
âame
, "stdout") == 0)

408 
f
 = 
¡dout
;

410 ià((
f
 = 
	`fİ’
(
âame
, "w")è=ğ
NULL
)

411  
MM_COULD_NOT_WRITE_FILE
;

414 
	`årštf
(
f
, "% ", 
M©rixM¬k‘BªÃr
);

415 
	`årštf
(
f
, "%s\n", 
	`mm_ty³code_to_¡r
(
m©code
));

418 
	`årštf
(
f
, "%d %d %d\n", 
M
, 
N
, 
nz
);

421 ià(
	`mm_is_·‰”n
(
m©code
))

422 
i
=0; i<
nz
; i++)

423 
	`årštf
(
f
, "%d %d\n", 
I
[
i
], 
J
[i]);

425 ià(
	`mm_is_»®
(
m©code
))

426 
i
=0; i<
nz
; i++)

427 
	`årštf
(
f
, "%d %d %20.16g\n", 
I
[
i
], 
J
[i], 
v®
[i]);

429 ià(
	`mm_is_com¶ex
(
m©code
))

430 
i
=0; i<
nz
; i++)

431 
	`årštf
(
f
, "%d %d %20.16g %20.16g\n", 
I
[
i
], 
J
[i], 
v®
[2*i],

432 
v®
[2*
i
+1]);

435 ià(
f
 !ğ
¡dout
è
	`fşo£
(f);

436  
MM_UNSUPPORTED_TYPE
;

439 ià(
f
 !=
¡dout
è
	`fşo£
(f);

442 
	}
}

450 *
	$mm_¡rdup
(cÚ¡ *
s
)

452 
Ën
 = 
	`¡¾’
(
s
);

453 *
s2
 = (*è
	`m®loc
((
Ën
+1)*());

454  
	`¡rıy
(
s2
, 
s
);

455 
	}
}

457 *
	$mm_ty³code_to_¡r
(
MM_ty³code
 
m©code
)

459 
bufãr
[
MM_MAX_LINE_LENGTH
];

460 *
ty³s
[4];

461 *
	`mm_¡rdup
(const *);

464 ià(
	`mm_is_m©rix
(
m©code
))

465 
ty³s
[0] = (*)
MM_MTX_STR
;

467  
NULL
;

470 ià(
	`mm_is_¥¬£
(
m©code
))

471 
ty³s
[1] = (*)
MM_SPARSE_STR
;

473 ià(
	`mm_is_d’£
(
m©code
))

474 
ty³s
[1] = (*)
MM_DENSE_STR
;

476  
NULL
;

479 ià(
	`mm_is_»®
(
m©code
))

480 
ty³s
[2] = (*)
MM_REAL_STR
;

482 ià(
	`mm_is_com¶ex
(
m©code
))

483 
ty³s
[2] = (*)
MM_COMPLEX_STR
;

485 ià(
	`mm_is_·‰”n
(
m©code
))

486 
ty³s
[2] = (*)
MM_PATTERN_STR
;

488 ià(
	`mm_is_š‹g”
(
m©code
))

489 
ty³s
[2] = (*)
MM_INT_STR
;

491  
NULL
;

495 ià(
	`mm_is_g’”®
(
m©code
))

496 
ty³s
[3] = (*)
MM_GENERAL_STR
;

498 ià(
	`mm_is_symm‘ric
(
m©code
))

499 
ty³s
[3] = (*)
MM_SYMM_STR
;

501 ià(
	`mm_is_h”m™Ÿn
(
m©code
))

502 
ty³s
[3] = (*)
MM_HERM_STR
;

504 ià(
	`mm_is_skew
(
m©code
))

505 
ty³s
[3] = (*)
MM_SKEW_STR
;

507  
NULL
;

509 
	`¥rštf
(
bufãr
,"% % % %s", 
ty³s
[0],ypes[1],ypes[2],ypes[3]);

510  
	`mm_¡rdup
(
bufãr
);

512 
	}
}

	@example_apps/matrix_factorization/matrixmarket/mmio.h

9 #iâdeà
MM_IO_H


10 
	#MM_IO_H


	)

12 
	#MM_MAX_LINE_LENGTH
 1025

	)

13 
	#M©rixM¬k‘BªÃr
 "%%M©rixM¬k‘"

	)

14 
	#MM_MAX_TOKEN_LENGTH
 64

	)

16 
	tMM_ty³code
[4];

18 *
mm_ty³code_to_¡r
(
MM_ty³code
 
m©code
);

20 
mm_»ad_bªÃr
(
FILE
 *
f
, 
MM_ty³code
 *
m©code
);

21 
mm_»ad_mtx_üd_size
(
FILE
 *
f
, 
ušt
 *
M
, ušˆ*
N
, 
size_t
 *
nz
);

22 
mm_»ad_mtx_¬¿y_size
(
FILE
 *
f
, 
ušt
 *
M
, ušˆ*
N
);

24 
mm_wr™e_bªÃr
(
FILE
 *
f
, 
MM_ty³code
 
m©code
);

25 
mm_wr™e_mtx_üd_size
(
FILE
 *
f
, 
ušt
 
M
, ušˆ
N
, 
size_t
 
nz
);

26 
mm_wr™e_mtx_¬¿y_size
(
FILE
 *
f
, 
ušt
 
M
, ušˆ
N
);

31 
	#mm_is_m©rix
(
ty³code
è(Ñy³code)[0]=='M')

	)

33 
	#mm_is_¥¬£
(
ty³code
è(Ñy³code)[1]=='C')

	)

34 
	#mm_is_coÜdš©e
(
ty³code
)(Ñy³code)[1]=='C')

	)

35 
	#mm_is_d’£
(
ty³code
è(Ñy³code)[1]=='A')

	)

36 
	#mm_is_¬¿y
(
ty³code
è(Ñy³code)[1]=='A')

	)

38 
	#mm_is_com¶ex
(
ty³code
è(Ñy³code)[2]=='C')

	)

39 
	#mm_is_»®
(
ty³code
è(Ñy³code)[2]=='R')

	)

40 
	#mm_is_·‰”n
(
ty³code
è(Ñy³code)[2]=='P')

	)

41 
	#mm_is_š‹g”
(
ty³code
è(Ñy³code)[2]=='I')

	)

43 
	#mm_is_symm‘ric
(
ty³code
)(Ñy³code)[3]=='S')

	)

44 
	#mm_is_g’”®
(
ty³code
è(Ñy³code)[3]=='G')

	)

45 
	#mm_is_skew
(
ty³code
è(Ñy³code)[3]=='K')

	)

46 
	#mm_is_h”m™Ÿn
(
ty³code
)(Ñy³code)[3]=='H')

	)

48 
mm_is_v®id
(
MM_ty³code
 
m©code
);

53 
	#mm_£t_m©rix
(
ty³code
è((*ty³code)[0]='M')

	)

54 
	#mm_£t_coÜdš©e
(
ty³code
è((*ty³code)[1]='C')

	)

55 
	#mm_£t_¬¿y
(
ty³code
è((*ty³code)[1]='A')

	)

56 
	#mm_£t_d’£
(
ty³code
è
	`mm_£t_¬¿y
Ñy³code)

	)

57 
	#mm_£t_¥¬£
(
ty³code
è
	`mm_£t_coÜdš©e
Ñy³code)

	)

59 
	#mm_£t_com¶ex
(
ty³code
)((*ty³code)[2]='C')

	)

60 
	#mm_£t_»®
(
ty³code
è((*ty³code)[2]='R')

	)

61 
	#mm_£t_·‰”n
(
ty³code
)((*ty³code)[2]='P')

	)

62 
	#mm_£t_š‹g”
(
ty³code
)((*ty³code)[2]='I')

	)

65 
	#mm_£t_symm‘ric
(
ty³code
)((*ty³code)[3]='S')

	)

66 
	#mm_£t_g’”®
(
ty³code
)((*ty³code)[3]='G')

	)

67 
	#mm_£t_skew
(
ty³code
è((*ty³code)[3]='K')

	)

68 
	#mm_£t_h”m™Ÿn
(
ty³code
)((*ty³code)[3]='H')

	)

70 
	#mm_ş—r_ty³code
(
ty³code
) ((*typecode)[0]=(*typecode)[1]= \

71 (*
ty³code
)[2]=' ',(*ty³code)[3]='G')

	)

73 
	#mm_š™Ÿlize_ty³code
(
ty³code
è
	`mm_ş—r_ty³code
Ñy³code)

	)

79 
	#MM_COULD_NOT_READ_FILE
 11

	)

80 
	#MM_PREMATURE_EOF
 12

	)

81 
	#MM_NOT_MTX
 13

	)

82 
	#MM_NO_HEADER
 14

	)

83 
	#MM_UNSUPPORTED_TYPE
 15

	)

84 
	#MM_LINE_TOO_LONG
 16

	)

85 
	#MM_COULD_NOT_WRITE_FILE
 17

	)

104 
	#MM_MTX_STR
 "m©rix"

	)

105 
	#MM_ARRAY_STR
 "¬¿y"

	)

106 
	#MM_DENSE_STR
 "¬¿y"

	)

107 
	#MM_COORDINATE_STR
 "coÜdš©e"

	)

108 
	#MM_SPARSE_STR
 "coÜdš©e"

	)

109 
	#MM_COMPLEX_STR
 "com¶ex"

	)

110 
	#MM_REAL_STR
 "»®"

	)

111 
	#MM_INT_STR
 "š‹g”"

	)

112 
	#MM_GENERAL_STR
 "g’”®"

	)

113 
	#MM_SYMM_STR
 "symm‘ric"

	)

114 
	#MM_HERM_STR
 "h”m™Ÿn"

	)

115 
	#MM_SKEW_STR
 "skew-symm‘ric"

	)

116 
	#MM_PATTERN_STR
 "·‰”n"

	)

121 
mm_wr™e_mtx_üd
(
âame
[], 
ušt
 
M
, ušˆ
N
, 
size_t
 
nz
, ušˆ
I
[], ušˆ
J
[],

122 
v®
[], 
MM_ty³code
 
m©code
);

123 
mm_»ad_mtx_üd_d©a
(
FILE
 *
f
, 
ušt
 
M
, ušˆ
N
, 
size_t
 
nz
, ušˆ
I
[], ušˆ
J
[],

124 
v®
[], 
MM_ty³code
 
m©code
);

125 
mm_»ad_mtx_üd_’Œy
(
FILE
 *
f
, 
ušt
 *
I
, ušˆ*
J
, *
»®
, *
img
,

126 
MM_ty³code
 
m©code
);

128 
mm_»ad_unsymm‘ric_¥¬£
(cÚ¡ *
âame
, 
ušt
 *
M_
, ušˆ*
N_
, 
size_t
 *
nz_
,

129 **
v®_
, 
ušt
 **
I_
, ušˆ**
J_
);

	@example_apps/pagerank.cpp

30 
	~<¡ršg
>

31 
	~<f¡»am
>

32 
	~<cm©h
>

34 
	~"g¿phchi_basic_šşudes.hµ
"

35 
	~"ut/tİli¡.hµ
"

37 
usšg
 
Çme¥aû
 
	gg¿phchi
;

39 
	#THRESHOLD
 1e-1

	)

40 
	#RANDOMRESETPROB
 0.15

	)

43 
	tV”‹xD©aTy³
;

44 
	tEdgeD©aTy³
;

46 
	gPag”ªkProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

51 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
šfo
) {

57 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

63 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

70 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

71 
	gsum
=0;

72 ià(
	ggšfo
.
	g™”©iÚ
 == 0) {

77 
i
=0; 
	gi
 < 
	gv
.
num_ou‹dges
(); i++) {

78 
	gg¿phchi_edge
<> * 
	gedge
 = 
v
.
ou‹dge
(
i
);

79 
	gedge
->
£t_d©a
(1.0 / 
v
.
num_ou‹dges
());

81 
	gv
.
£t_d©a
(
RANDOMRESETPROB
);

85 
	gi
=0; i < 
	gv
.
num_šedges
(); i++) {

86 
	gv®
 = 
v
.
šedge
(
i
)->
g‘_d©a
();

87 
	gsum
 +ğ
v®
;

91 
	g·g”ªk
 = 
RANDOMRESETPROB
 + (1 - RANDOMRESETPROBè* 
sum
;

95 ià(
	gv
.
num_ou‹dges
() > 0) {

96 
	g·g”ªkcÚt
 = 
·g”ªk
 / 
v
.
num_ou‹dges
();

97 
	gi
=0; i < 
	gv
.
num_ou‹dges
(); i++) {

98 
	gg¿phchi_edge
<> * 
	gedge
 = 
v
.
ou‹dge
(
i
);

99 
	gedge
->
£t_d©a
(
·g”ªkcÚt
);

105 
	ggšfo
.
log_chªge
(
¡d
::
abs
(
·g”ªk
 - 
v
.
g‘_d©a
()));

108 
	gv
.
£t_d©a
(
·g”ªk
);

114 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

115 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

116 
m‘rics
 
	`m
("pagerank");

119 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

120 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 4);

121 
boŞ
 
scheduËr
 = 
çl£
;

122 
Áİ
 = 
	`g‘_İtiÚ_št
("top", 20);

125 
nsh¬ds
 = 
cÚv”t_if_nÙexi¡s
<
EdgeD©aTy³
>(
f’ame
, 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"));

128 
g¿phchi_’gše
<, > 
	`’gše
(
f’ame
, 
nsh¬ds
, 
scheduËr
, 
m
);

129 
’gše
.
	`£t_modif›s_šedges
(
çl£
);

130 
Pag”ªkProg¿m
 
´og¿m
;

131 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

134 
¡d
::
veùÜ
< 
v”‹x_v®ue
<> > 
tİ
 = 
g‘_tİ_v”tiûs
<>(
f’ame
, 
Áİ
);

135 
¡d
::
cout
 << "Pršˆtİ " << 
Áİ
 << " v”tiûs:" << std::
’dl
;

136 
i
=0; i < ()
tİ
.
	`size
(); i++) {

137 
¡d
::
cout
 << (
i
+1è<< ". " << 
tİ
[i].
v”‹x
 << "\t" <<İ[i].
v®ue
 << std::
’dl
;

140 
	`m‘rics_»pÜt
(
m
);

142 
	}
}

	@example_apps/pagerank_functional.cpp

34 
	#RANDOMRESETPROB
 0.15

	)

36 
	~<¡ršg
>

37 
	~<f¡»am
>

38 
	~<cm©h
>

40 
	~"g¿phchi_basic_šşudes.hµ
"

41 
	~"­i/funùiÚ®/funùiÚ®_­i.hµ
"

42 
	~"g¿phchi_basic_šşudes.hµ
"

43 
	~"ut/tİli¡.hµ
"

45 
usšg
 
Çme¥aû
 
	gg¿phchi
;

47 
	g·g”ªk_k”Ãl
 : 
public
 
funùiÚ®_k”Ãl
<, > {

50 
š™Ÿl_v®ue
(
g¿phchi_cÚ‹xt
 &
šfo
, 
v”‹x_šfo
& 
myv”‹x
) {

55 
»£t
() {

61 
İ_ÃighbÜv®
(
g¿phchi_cÚ‹xt
 &
šfo
, 
v”‹x_šfo
& 
myv”‹x
, 
vid_t
 
nbid
, 
nbv®
) {

62  
	gnbv®
;

66 
¶us
(
curv®
, 
tßdd
) {

67  
	gcurv®
 + 
	gtßdd
;

71 
compu‹_v”‹xv®ue
(
g¿phchi_cÚ‹xt
 &
gšfo
, 
v”‹x_šfo
& 
myv”‹x
, 
nbv®sum
) {

72 
as£¹
(
gšfo
.
nv”tiûs
 > 0);

73  
	gRANDOMRESETPROB
 / 
	ggšfo
.
	gnv”tiûs
 + (1 - RANDOMRESETPROBè* 
	gnbv®sum
;

77 
v®ue_to_ÃighbÜ
(
g¿phchi_cÚ‹xt
 &
šfo
, 
v”‹x_šfo
& 
myv”‹x
, 
vid_t
 
nbid
, 
myv®
) {

78 
as£¹
(
myv”‹x
.
outdeg»e
 > 0);

79  
	gmyv®
 / 
	gmyv”‹x
.
	goutdeg»e
;

84 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

85 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

86 
m‘rics
 
	`m
("pagerank");

88 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

89 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 4);

90 
boŞ
 
Úlytİ
 = 
	`g‘_İtiÚ_št
("onlytop", 0);

91 
Áİ
 = 
	`g‘_İtiÚ_št
("top", 20);

92 
¡d
::
¡ršg
 
mode
 = 
	`g‘_İtiÚ_¡ršg
("mode", "semisync");

94 ià(
Úlytİ
 == 0) {

96 ià(
mode
 == "semisync") {

97 
	`log¡»am
(
LOG_INFO
è<< "RuÂšg…ag”ªk iÀ£mi-synchrÚou mode." << 
¡d
::
’dl
;

98 
run_funùiÚ®_unweigh‹d_£misynchrÚous
<
·g”ªk_k”Ãl
>(
f’ame
, 
n™”s
, 
m
);

99 } ià(
mode
 == "sync") {

100 
	`log¡»am
(
LOG_INFO
è<< "RuÂšg…ag”ªk iÀ(bulkèsynchrÚou mode." << 
¡d
::
’dl
;

101 
run_funùiÚ®_unweigh‹d_synchrÚous
<
·g”ªk_k”Ãl
>(
f’ame
, 
n™”s
, 
m
);

103 
	`log¡»am
(
LOG_ERROR
è<< "ModÃed tØbe™h” '£misync' o¸'sync'." << 
¡d
::
’dl
;

104 
	`as£¹
(
çl£
);

107 
	`m‘rics_»pÜt
(
m
);

111 
¡d
::
veùÜ
< 
v”‹x_v®ue
<> > 
tİ
 = 
g‘_tİ_v”tiûs
<>(
f’ame
, 
Áİ
);

112 
¡d
::
cout
 << "Pršˆtİ 20 v”tiûs: " << std::
’dl
;

113 
i
=0; i < (è
tİ
.
	`size
(); i++) {

114 
¡d
::
cout
 << (
i
+1è<< ". " << 
tİ
[i].
v”‹x
 << "\t" <<İ[i].
v®ue
 << std::
’dl
;

117 
	}
}

	@example_apps/randomwalks.cpp

39 
	#DYNAMICEDATA
 1

	)

41 
	~<¡ršg
>

43 
	~"g¿phchi_basic_šşudes.hµ
"

44 
	~"­i/dyÇmicd©a/chiveùÜ.hµ
"

45 
	~"ut/tİli¡.hµ
"

47 
usšg
 
Çme¥aû
 
	gg¿phchi
;

53 
	tV”‹xD©aTy³
;

54 
	gchiveùÜ
<
	tvid_t
> 
	tEdgeD©aTy³
;

57 
	gRªdomW®kProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

59 
w®ks_³r_sourû
() {

63 
boŞ
 
is_sourû
(
vid_t
 
v
) {

64  (
	gv
 % 50 == 0);

70 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
 > &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

71 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0) {

73 ià(
is_sourû
(
v”‹x
.
id
())) {

74 
i
=0; 
	gi
 < 
w®ks_³r_sourû
(); i++) {

76 
	gg¿phchi_edge
<
	gEdgeD©aTy³
> * 
	gou‹dge
 = 
v”‹x
.
¿ndom_ou‹dge
();

77 ià(
	gou‹dge
 !ğ
NULL
) {

78 
chiveùÜ
<
vid_t
> * 
eveùÜ
 = 
ou‹dge
->
g‘_veùÜ
();

80 
	geveùÜ
->
add
(
v”‹x
.
id
());

81 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
ou‹dge
->
v”‹x_id
());

85 
	gv”‹x
.
£t_d©a
(0);

88 
	gnum_w®ks
 = 0;

89 
	gi
=0; i < 
	gv”‹x
.
num_šedges
(); i++) {

90 
	gg¿phchi_edge
<
	gEdgeD©aTy³
> * 
	gedge
 = 
v”‹x
.
šedge
(
i
);

91 
	gchiveùÜ
<
	gvid_t
> * 
	gšveùÜ
 = 
edge
->
g‘_veùÜ
();

92 
	gj
=0; j < 
	gšveùÜ
->
size
(); j++) {

94 
vid_t
 
	gw®k
 = 
šveùÜ
->
g‘
(
j
);

96 
	gg¿phchi_edge
<
	gEdgeD©aTy³
> * 
	gou‹dge
 = 
v”‹x
.
¿ndom_ou‹dge
();

97 ià(
	gou‹dge
 !ğ
NULL
) {

98 
chiveùÜ
<
vid_t
> * 
outveùÜ
 = 
ou‹dge
->
g‘_veùÜ
();

100 
	goutveùÜ
->
add
(
w®k
);

101 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
ou‹dge
->
v”‹x_id
());

103 
	gnum_w®ks
 ++;

106 
	gšveùÜ
->
ş—r
();

109 
	gv”‹x
.
£t_d©a
(
v”‹x
.
g‘_d©a
(è+ 
num_w®ks
);

116 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

122 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

128 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

134 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

141 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

144 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

148 
m‘rics
 
	`m
("randomwalk");

151 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

152 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 4);

153 
boŞ
 
scheduËr
 = 
Œue
;

156 
boŞ
 
´“xi¡šg_sh¬ds
;

157 
nsh¬ds
 = 
cÚv”t_if_nÙexi¡s
<
vid_t
>(
f’ame
, 
	`g‘_İtiÚ_¡ršg
("nsh¬ds", "auto"), 
´“xi¡šg_sh¬ds
);

160 
RªdomW®kProg¿m
 
´og¿m
;

161 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
, 
nsh¬ds
, 
scheduËr
, 
m
);

162 ià(
´“xi¡šg_sh¬ds
) {

163 
’gše
.
	`»š™Ÿlize_edge_d©a
(0);

165 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

168 
Áİ
 = 20;

169 
¡d
::
veùÜ
< 
v”‹x_v®ue
<
V”‹xD©aTy³
> > 
tİ
 = 
g‘_tİ_v”tiûs
<V”‹xD©aTy³>(
f’ame
, 
Áİ
);

170 
¡d
::
cout
 << "Pršˆtİ 20 v”tiûs: " << std::
’dl
;

171 
i
=0; i < (è
tİ
.
	`size
(); i++) {

172 
¡d
::
cout
 << (
i
+1è<< ". " << 
tİ
[i].
v”‹x
 << "\t" <<İ[i].
v®ue
 << std::
’dl
;

176 
	`m‘rics_»pÜt
(
m
);

178 
	}
}

	@example_apps/streaming_pagerank.cpp

33 
	~<¡ršg
>

34 
	~<f¡»am
>

35 
	~<cm©h
>

37 
	~"g¿phchi_basic_šşudes.hµ
"

38 
	~"’gše/dyÇmic_g¿phs/g¿phchi_dyÇmicg¿ph_’gše.hµ
"

39 
	~"ut/tİli¡.hµ
"

42 
	~"h‰·dmš/chi_h‰·dmš.hµ
"

43 
	~"h‰·dmš/¶Ù‹r.hµ
"

45 
usšg
 
Çme¥aû
 
	gg¿phchi
;

47 
	#THRESHOLD
 1e-1f

	)

48 
	#RANDOMRESETPROB
 0.15f

	)

50 
	#DEMO
 1

	)

52 
	tV”‹xD©aTy³
;

53 
	tEdgeD©aTy³
;

55 
	gg¿phchi_dyÇmicg¿ph_’gše
<, > * 
	gdyng¿ph_’gše
;

56 
	g¡d
::
¡ršg
 
¡»amšg_g¿ph_fe
;

58 
	g¡d
::
¡ršg
 
g‘Çme
(
vid_t
 
v
);

59 
	g¡d
::
¡ršg
 
	$g‘Çme
(
vid_t
 
u£rid
) {

60 #ifdeà
DEMO


62 
f
 = 
	`İ’
("/U£rs/akyrŞa/g¿phs/tw™‹r_Çmes.d©", 
O_RDONLY
);

63 ià(
f
 < 0)  "n/a";

64 
s
[16];

66 
size_t
 
idx
 = 
u£rid
 * 16;

67 
	`´—da
(
f
, 
s
, 16, 
idx
);

68 
	`şo£
(
f
);

69 
s
[15] = '\0';

71  
¡d
::
	`¡ršg
(
s
);

75 
	}
}

78 
Pag”ªkProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

83 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

89 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

90 #ifdeà
DEMO


91 
	g¡d
::
veùÜ
< 
v”‹x_v®ue
<> > 
tİ
 = 
g‘_tİ_v”tiûs
<>(
gcÚ‹xt
.
f’ame
, 20);

93 
	gi
=0; i < (è
	gtİ
.
size
(); i++) {

94 
	gv”‹x_v®ue
<> 
	gvv
 = 
tİ
[
i
];

95 
	g¡d
::
cout
 << (
i
+1è<< ". " << 
vv
.
v”‹x
 << " " << 
g‘Çme
(vv.v”‹xè<< ": " << vv.
v®ue
 << 
¡d
::
’dl
;

99 
	gi
=0; i < (è
	gtİ
.
size
(); i++) {

100 
	gv”‹x_v®ue
<> 
	gvv
 = 
tİ
[
i
];

101 
	g¡d
::
¡ršg¡»am
 
ss
;

102 
	gss
 << "¿nk" << 
	gi
;

103 
	g¡d
::
¡ršg¡»am
 
sv
;

104 
	gsv
 << 
	gvv
.
	gv”‹x
 << ":" << 
g‘Çme
(
vv
.
v”‹x
è<< ":" << vv.
	gv®ue
<< "";

105 
	gdyng¿ph_’gše
->
£t_jsÚ
(
ss
.
¡r
(), 
sv
.str());

113 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

114 #ifdeà
DEMO


115 
upd©e_¶Ùd©a
(
dyng¿ph_’gše
);

123 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

124 
	gsum
=0;

125 ià(
	ggšfo
.
	g™”©iÚ
 == 0) {

127 
i
=0; 
	gi
 < 
	gv
.
num_ou‹dges
(); i++) {

128 
	gg¿phchi_edge
<> * 
	gedge
 = 
v
.
ou‹dge
(
i
);

129 
	gedge
->
£t_d©a
(1.0à/ 
v
.
num_ou‹dges
());

130 ià(
	ggšfo
.
	gscheduËr
 !ğ
NULL
)

131 
gšfo
.
scheduËr
->
add_sk
(
edge
->
v”‹x_id
());

133 
	gv
.
£t_d©a
(
RANDOMRESETPROB
);

136 ià(
	ggšfo
.
	gscheduËr
 !ğ
NULL
)

137 
gšfo
.
scheduËr
->
add_sk
(
v
.
id
());

140 
	gi
=0; i < 
	gv
.
num_šedges
(); i++) {

141 
	gv®
 = 
v
.
šedge
(
i
)->
g‘_d©a
();

142 
	gsum
 +ğ
v®
;

146 
	g·g”ªk
 = 
RANDOMRESETPROB
 + (1 - RANDOMRESETPROBè* 
sum
;

147 
	gŞdv®ue
 = 
v
.
g‘_d©a
();

148 
	gd–
 = (è
çbs
(
Şdv®ue
 - 
·g”ªk
);

149 
boŞ
 
	gsignifiÿÁ_chªge
 = (
d–
 >ğ
THRESHOLD
);

151 ià(
	gv
.
num_ou‹dges
() > 0) {

152 
	g·g”ªkcÚt
 = 
·g”ªk
/
v
.
num_ou‹dges
();

153 
	gi
=0; i < 
	gv
.
num_ou‹dges
(); i++) {

154 
	gg¿phchi_edge
<> * 
	gedge
 = 
v
.
ou‹dge
(
i
);

158 ià(
	ggšfo
.
	gscheduËr
 !ğ
NULL
) {

159 ià(
signifiÿÁ_chªge
) {

160 
gšfo
.
scheduËr
->
add_sk
(
edge
->
v”‹x_id
());

163 
	gedge
->
£t_d©a
(
·g”ªkcÚt
);

166 
	gv
.
£t_d©a
(
·g”ªk
);

169 
	ggšfo
.
log_chªge
(
d–
);

176 şas 
	cIÁ”v®TİReque¡
 : 
public
 
cu¡om_»que¡_hªdËr
 {

177 
public
:

178 
vœtu®
 
¡d
::
¡ršg
 
	$hªdË
(cÚ¡ * 
»q
) {

179 cÚ¡ * 
sh¬dnum_¡r
 = &
»q
[
	`¡¾’
("/ajax/shardpagerank")];

180 
sh¬dnum
 = 
	`©oi
(
sh¬dnum_¡r
);

181 
	`log¡»am
(
LOG_DEBUG
è<< "Reque¡ed sh¬d…ag”ªk: " << 
sh¬dnum_¡r
 << 
¡d
::
’dl
;

182 ià(
sh¬dnum
 >ğ0 && sh¬dnum < 
dyng¿ph_’gše
->
	`g‘_nsh¬ds
()) {

183 
vid_t
 
äomvid
 = 
dyng¿ph_’gše
->
	`g‘_š‹rv®_¡¬t
(
sh¬dnum
);

184 
vid_t
 
tovid
 = 
dyng¿ph_’gše
->
	`g‘_š‹rv®_’d
(
sh¬dnum
);

186 
¡d
::
veùÜ
< 
v”‹x_v®ue
<> > 
tİ
 =

187 
g‘_tİ_v”tiûs
<>(
dyng¿ph_’gše
->
	`g‘_cÚ‹xt
().
f’ame
, 10,

188 
äomvid
, 
tovid
 + 1);

191 
¡d
::
¡ršg¡»am
 
ss
;

192 
ss
 << "{";

193 
i
=0; i < (è
tİ
.
	`size
(); i++) {

194 
v”‹x_v®ue
<> 
vv
 = 
tİ
[
i
];

195 ià(
i
 > 0è
ss
 << ",";

196 
ss
 << "\"¿nk" << 
i
 << "\": \"" << 
vv
.
v”‹x
 << ":" << 
	`g‘Çme
(vv.v”‹xè<< ":" << vv.
v®ue
<< "\"";

198 
ss
 << "}";

199 
¡d
::
cout
 << 
ss
.
	`¡r
();

200  
ss
.
	`¡r
();

204 
vœtu®
 
boŞ
 
	$»¥Úds_to
(cÚ¡ * 
»q
) {

205  (
	`¡ºcmp
(
»q
, "/ajax/shardpagerank", 19) == 0);

206 
	}
}

210 
boŞ
 
	gruÂšg
 = 
Œue
;

212 * 
¶Ù‹r_th»ad
(* 
šfo
);

213 * 
	$¶Ù‹r_th»ad
(* 
šfo
) {

215 
	`u¦“p
(1000000 * 10);

216 
	`š™_¶Ùs
(
dyng¿ph_’gše
);

218 
ruÂšg
) {

220 
	`d¿w¶Ùs
();

221 
	`u¦“p
(1000000 * 10);

223  
NULL
;

224 
	}
}

230 * 
dyÇmic_g¿ph_»ad”
(* 
šfo
);

231 * 
	$dyÇmic_g¿ph_»ad”
(* 
šfo
) {

232 
¡d
::
cout
 << "S¹ sË•šg..." << std::
’dl
;

233 
	`u¦“p
(50000);

234 
¡d
::
cout
 << "End sË•šg..." << std::
’dl
;

236 
edges_³r_£c
 = 
	`g‘_İtiÚ_št
("edges_per_sec", 100000);

238 
	`log¡»am
(
LOG_INFO
è<< "GošgØ¡»am from: " << 
¡»amšg_g¿ph_fe
 << 
¡d
::
’dl
;

239 
FILE
 * 
f
 = 
	`fİ’
(
¡»amšg_g¿ph_fe
.
	`c_¡r
(), "r");

240 ià(
f
 =ğ
NULL
) {

241 
	`log¡»am
(
LOG_ERROR
è<< "Could‚Ù o³ÀffÜ sŒ—mšg: " << 
¡»amšg_g¿ph_fe
 <<

242 "ƒ¼Ü: " << 
	`¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

244 
	`as£¹
(
f
 !ğ
NULL
);

246 
	`log¡»am
(
LOG_INFO
è<< "SŒ—mšg s³ed c­³d‡t: " << 
edges_³r_£c
 << "ƒdges/£c." << 
¡d
::
’dl
;

248 
size_t
 
c
 = 0;

249 
size_t
 
šge¡ed
 = 0;

251 
timev®
 
Ï¡
, 
now
;

252 
	`g‘timeofday
(&
Ï¡
, 
NULL
);

254 
vid_t
 
äom
;

255 
vid_t
 
to
;

256 
s
[1024];

258 
	`fg‘s
(
s
, 1024, 
f
è!ğ
NULL
) {

259 
	`FIXLINE
(
s
);

261 
d–ims
[] = "\t ";

262 * 
t
;

263 
t
 = 
	`¡¹ok
(
s
, 
d–ims
);

264 
äom
 = 
	`©oi
(
t
);

265 
t
 = 
	`¡¹ok
(
NULL
, 
d–ims
);

266 
to
 = 
	`©oi
(
t
);

268 ià(
äom
 =ğ
to
) {

273 
boŞ
 
sucûss
=
çl£
;

274 !
sucûss
) {

275 
sucûss
 = 
dyng¿ph_’gše
->
	`add_edge
(
äom
, 
to
, 0.0f);

277 
dyng¿ph_’gše
->
	`add_sk
(
äom
);

278 
šge¡ed
++;

280 ià(++
c
 % 
edges_³r_£c
 == 0) {

281 
¡d
::
cout
 << "SŒ—m s³ed check...." << std::
’dl
;

282 
sšûÏ¡
;

283 
¥“d
;

287 
	`g‘timeofday
(&
now
, 
NULL
);

288 
sšûÏ¡
 = 
now
.
tv_£c
-
Ï¡
.tv_£c+ (()Òow.
tv_u£c
-last.tv_usec))/1.0E6;

289 
	`u¦“p
(20000);

290 
¥“d
 = (
c
 / 
sšûÏ¡
);

291 } 
¥“d
 > 
edges_³r_£c
);

292 
dyng¿ph_’gše
->
	`£t_jsÚ
("šge¡¥“d", 
¥“d
);

293 
	`log¡»am
(
LOG_INFO
è<< "SŒ—m s³ed checkƒnded.... S³ed‚ow:" << 
¥“d
 << "ƒdges/£c" << 
¡d
::
’dl
;

294 
dyng¿ph_’gše
->
	`£t_jsÚ
("šge¡edges", 
šge¡ed
);

296 ià(
c
 % 1000 == 0) {

297 
	`£t_šge¡ed_edges
(
šge¡ed
);

302 
	`fşo£
(
f
);

303 
dyng¿ph_’gše
->
	`fšish_aá”_™”s
(10);

304  
NULL
;

305 
	}
}

308 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

309 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

310 
m‘rics
 
	`m
("streaming-pagerank");

313 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

314 
n™”s
 = 100000;

316 
boŞ
 
scheduËr
 = 
Œue
;

317 
Áİ
 = 
	`g‘_İtiÚ_št
("top", 20);

320 
nsh¬ds
 = 
cÚv”t_if_nÙexi¡s
<
EdgeD©aTy³
>(
f’ame
, 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"));

323 
¡»amšg_g¿ph_fe
 = 
	`g‘_İtiÚ_¡ršg_š‹¿ùive
("streaming_graph_file",

327 
dyng¿ph_’gše
 = 
Ãw
 
g¿phchi_dyÇmicg¿ph_’gše
<, >(
f’ame
, 
nsh¬ds
, 
scheduËr
, 
m
);

328 
dyng¿ph_’gše
->
	`£t_modif›s_šedges
(
çl£
);

331 
±h»ad_t
 
¡¹h»ad
;

332 
»t
 = 
	`±h»ad_ü—‹
(&
¡¹h»ad
, 
NULL
, 
dyÇmic_g¿ph_»ad”
, NULL);

333 
	`as£¹
(
»t
>=0);

336 
¡¬t_h‰·dmš
< 
g¿phchi_dyÇmicg¿ph_’gše
<, > >(
dyng¿ph_’gše
);

337 
	`»gi¡”_h‰p_»que¡_hªdËr
(
Ãw
 
	`IÁ”v®TİReque¡
());

339 
±h»ad_t
 
¶Ù‹¹hr
;

340 
»t
 = 
	`±h»ad_ü—‹
(&
¶Ù‹¹hr
, 
NULL
, 
¶Ù‹r_th»ad
, NULL);

341 
	`as£¹
(
»t
>=0);

344 
Pag”ªkProg¿m
 
´og¿m
;

345 
dyng¿ph_’gše
->
	`run
(
´og¿m
, 
n™”s
);

348 
ruÂšg
 = 
çl£
;

351 
¡d
::
veùÜ
< 
v”‹x_v®ue
<> > 
tİ
 = 
g‘_tİ_v”tiûs
<>(
f’ame
, 
Áİ
);

352 
¡d
::
cout
 << "Pršˆtİ " << 
Áİ
 << " v”tiûs:" << std::
’dl
;

353 
i
=0; i < ()
tİ
.
	`size
(); i++) {

354 
¡d
::
cout
 << (
i
+1è<< ". " << 
tİ
[i].
v”‹x
 << "\t" <<İ[i].
v®ue
 << std::
’dl
;

357 
	`m‘rics_»pÜt
(
m
);

359 
	}
}

	@example_apps/trianglecounting.cpp

48 
	~<¡ršg
>

49 
	~<veùÜ
>

55 
	#SUPPORT_DELETIONS
 1

	)

58 
	~"g¿phchi_basic_šşudes.hµ
"

59 
	~"’gše/dyÇmic_g¿phs/g¿phchi_dyÇmicg¿ph_’gše.hµ
"

61 
usšg
 
Çme¥aû
 
	gg¿phchi
;

69 
ušt32_t
 
	tV”‹xD©aTy³
;

70 
ušt32_t
 
	tEdgeD©aTy³
;

76 
şass
 
	gOuutV”‹xC®lback
 : 
public
 
VC®lback
<
V”‹xD©aTy³
> {

77 
public
:

78 
vœtu®
 
ÿÎback
(
vid_t
 
v”‹x_id
, 
V”‹xD©aTy³
 &
v®ue
) {

79 ià(
	gv®ue
 > 0)

80 
	g¡d
::
cout
 << 
v”‹x_id
 << " " << 
v®ue
 << 
¡d
::
’dl
;

88 
	gg¿bbed_edges
 = 0;

92 
šlše
 
boŞ
 
	$fšdadj_lš—r
(
vid_t
 * 
d©achunk
, 
size_t
 
n
, vid_ˆ
rg‘
) {

93 
i
=0; i<()
n
; i++) {

94 ià(
d©achunk
[
i
] =ğ
rg‘
è 
Œue
;

95 ià(
d©achunk
[
i
] > 
rg‘
è 
çl£
;

97  
çl£
;

98 
	}
}

101 
šlše
 
boŞ
 
	$fšdadj
(
vid_t
 * 
d©achunk
, 
size_t
 
n
, vid_ˆ
rg‘
) {

102 ià(
n
<32è 
	`fšdadj_lš—r
(
d©achunk
,‚, 
rg‘
);

103 
size_t
 
lo
 = 0;

104 
size_t
 
hi
 = 
n
;

105 
size_t
 
m
 = 
lo
 + (
hi
-lo)/2;

106 
hi
>
lo
) {

107 
vid_t
 
‘o
 = 
d©achunk
[
m
];

108 ià(
rg‘
 =ğ
‘o
) {

109  
Œue
;

111 ià(
rg‘
 > 
‘o
) {

112 
lo
 = 
m
+1;

114 
hi
 = 
m
;

116 
m
 = 
lo
 + (
hi
-lo)/2;

118  
çl£
;

119 
	}
}

123 
	sd’£_adj
 {

124 
	mcouÁ
;

125 
vid_t
 * 
	madjli¡
;

127 
d’£_adj
(è{ 
	madjli¡
 = 
NULL
; }

128 
d’£_adj
(
_couÁ
, 
vid_t
 * 
_adjli¡
è: 
couÁ
(_couÁ), 
adjli¡
(_adjlist) {

135 şas 
	cadjli¡_cÚš”
 {

136 
	m¡d
::
veùÜ
<
d’£_adj
> 
adjs
;

137 
mu‹x
 
	mm
;

138 
	mpublic
:

139 
vid_t
 
pivÙ_¡
, 
	mpivÙ_’
;

141 
	$adjli¡_cÚš”
() {

142 
pivÙ_¡
 = 0;

143 
pivÙ_’
 = 0;

146 
	$ş—r
() {

147 
¡d
::
veùÜ
<
d’£_adj
>::
™”©Ü
 
™
=
adjs
.
	`begš
(); iˆ!ğadjs.
	`’d
(); ++it) {

148 ià(
™
->
adjli¡
 !ğ
NULL
) {

149 
	`ä“
(
™
->
adjli¡
);

150 
™
->
adjli¡
 = 
NULL
;

153 
adjs
.
	`ş—r
();

154 
pivÙ_¡
 = 
pivÙ_’
;

155 
	}
}

160 
	$ex‹nd_pivÙ¿nge
(
vid_t
 
’
) {

161 
	`as£¹
(
’
>=
pivÙ_’
);

162 
pivÙ_’
 = 
’
;

163 
adjs
.
	`»size
(
pivÙ_’
 - 
pivÙ_¡
);

164 
	}
}

169 
g¿b_adj
(
g¿phchi_v”‹x
<
ušt32_t
, ušt32_t> &
v
) {

170 if(
is_pivÙ
(
v
.
id
())) {

171 
	gncouÁ
 = 
v
.
num_edges
();

173 
	gv
.
sÜt_edges_šdœeù
();

176 
	gaùcouÁ
 = 0;

177 
vid_t
 
	gÏ¡vid
 = 0;

178 
	gi
=0; i<
	gncouÁ
; i++) {

179 ià(
	gv
.
edge
(
i
)->
	gv”‹xid
 > v.
id
(è&& v.edge(i)->v”‹xid !ğ
Ï¡vid
)

180 
aùcouÁ
++;

181 
	gÏ¡vid
 = 
v
.
edge
(
i
)->
v”‹x_id
();

186 
d’£_adj
 
	gdadj
 = d’£_adj(
aùcouÁ
, (
vid_t
*è
ÿÎoc
((vid_t),‡ctcount));

187 
	gaùcouÁ
 = 0;

188 
	gÏ¡vid
 = 0;

189 
	gi
=0; i<
	gncouÁ
; i++) {

190 ià(
	gv
.
edge
(
i
)->
	gv”‹xid
 > v.
id
(è&& v.edge(i)->v”‹xid !ğ
Ï¡vid
) {

191 
dadj
.
adjli¡
[
aùcouÁ
++] = 
v
.
edge
(
i
)->
v”‹x_id
();

193 
	gÏ¡vid
 = 
v
.
edge
(
i
)->
v”‹x_id
();

195 
as£¹
(
dadj
.
couÁ
 =ğ
aùcouÁ
);

196 
	gadjs
[
v
.
id
(è- 
pivÙ_¡
] = 
dadj
;

197 
as£¹
(
v
.
id
(è- 
pivÙ_¡
 < 
adjs
.
size
());

198 
__sync_add_ªd_ãtch
(&
g¿bbed_edges
, 
aùcouÁ
);

199  
	gaùcouÁ
;

204 
	$acouÁ
(
vid_t
 
pivÙ
) {

205  
adjs
[
pivÙ
 - 
pivÙ_¡
].
couÁ
;

206 
	}
}

212 
š‹r£ùiÚ_size
(
g¿phchi_v”‹x
<
ušt32_t
, ušt32_t> &
v
, 
vid_t
 
pivÙ
, 
¡¬t_i
) {

213 
as£¹
(
is_pivÙ
(
pivÙ
));

214 
	gcouÁ
 = 0;

215 ià(
	gpivÙ
 > 
	gv
.
id
()) {

216 
	gd’£_adj
 &
	gdadj
 = 
adjs
[
pivÙ
 - 
pivÙ_¡
];

217 
	gvc
 = 
v
.
num_edges
();

223 ià(
	gdadj
.
	gcouÁ
 < 32 * (
	gvc
 - 
	g¡¬t_i
)) {

225 
as£¹
(
v
.
edge
(
¡¬t_i
)->
v”‹x_id
(è=ğ
pivÙ
);

226 
	gi1
 = 0;

227 
	gi2
 = 
¡¬t_i
+1;

228 
	gÃdges
 = 
v
.
num_edges
();

230 
	gi1
 < 
	gdadj
.
	gcouÁ
 && 
	gi2
 < 
	gÃdges
) {

231 
vid_t
 
	gd¡
 = 
v
.
edge
(
i2
)->
v”‹xid
;

232 
vid_t
 
	ga
 = 
dadj
.
adjli¡
[
i1
];

233 ià(
	ga
 =ğ
d¡
) {

235 
v
.
edge
(
i2
)->
£t_d©a
(v.edge(i2)->
g‘_d©a
() + 1);

236 
	gcouÁ
++;

237 
	gi1
++; 
	gi2
++;

240 
	gi1
 +ğ
a
 < 
d¡
;

241 
	gi2
 +ğ
a
 > 
d¡
;

248 
vid_t
 
	gÏ¡vid
 = 0;

249 
	gi
=
¡¬t_i
+1; i < 
	gvc
; i++) {

250 
vid_t
 
	gnb
 = 
v
.
edge
(
i
)->
v”‹xid
;

251 ià(
	gnb
 > 
	gpivÙ
 &&‚b !ğ
Ï¡vid
) {

252 
m©ch
 = 
fšdadj
(
dadj
.
adjli¡
, dadj.
couÁ
, 
nb
);

253 
	gcouÁ
 +ğ
m©ch
;

254 ià(
	gm©ch
 > 0) {

256 
	gv
.
edge
(
i
)->
£t_d©a
(
v
.edge(i)->
g‘_d©a
() + 1);

259 
	gÏ¡vid
 = 
nb
;

263  
	gcouÁ
;

266 
šlše
 
boŞ
 
	$is_pivÙ
(
vid_t
 
vid
) {

267  
vid
 >ğ
pivÙ_¡
 && vid < 
pivÙ_’
;

268 
	}
}

271 
adjli¡_cÚš”
 * 
	gadjcÚš”
;

279 
	gTrŸngËCouÁšgProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

285 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

287 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0) {

288 
adjcÚš”
->
g¿b_adj
(
v
);

290 
ušt32_t
 
	gŞdcouÁ
 = 
v
.
g‘_d©a
();

291 
ušt32_t
 
	gÃwcouÁs
 = 0;

293 
	gv
.
sÜt_edges_šdœeù
();

295 
vid_t
 
	gÏ¡vid
 = 0;

302 
	gi
=0; i<
	gv
.
num_edges
(); i++) {

303 
	gg¿phchi_edge
<
	gušt32_t
> * 
	ge
 = 
v
.
edge
(
i
);

304 ià(
	ge
->
	gv”‹xid
 > 
	gv
.
id
(è&&ƒ->v”‹xid >ğ
adjcÚš”
->
pivÙ_¡
) {

305 
as£¹
(!
is_d–‘ed_edge_v®ue
(
e
->
g‘_d©a
()));

306 ià(
	ge
->
	gv”‹xid
 !ğ
Ï¡vid
) {

307 ià(
adjcÚš”
->
is_pivÙ
(
e
->
v”‹xid
)) {

308 
ušt32_t
 
pivÙ_ŒŸngË_couÁ
 = 
adjcÚš”
->
š‹r£ùiÚ_size
(
v
, 
e
->
v”‹xid
, 
i
);

309 
	gÃwcouÁs
 +ğ
pivÙ_ŒŸngË_couÁ
;

312 ià(
	gpivÙ_ŒŸngË_couÁ
 =ğ0 && 
e
->
g‘_d©a
() == 0) {

314 
v
.
»move_edge
(
i
);

317 
	ge
->
£t_d©a
(
e
->
g‘_d©a
(è+ 
pivÙ_ŒŸngË_couÁ
);

323 
	gÏ¡vid
 = 
e
->
v”‹xid
;

325 
as£¹
(
ÃwcouÁs
 >= 0);

328 ià(
	gÃwcouÁs
 > 0) {

329 
	gv
.
£t_d©a
(
ŞdcouÁ
 + 
ÃwcouÁs
);

336 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0) {

337 
ÃwcouÁs
 = 0;

339 
	gi
=0; i < 
	gv
.
num_edges
(); i++) {

340 
	gg¿phchi_edge
<
	gušt32_t
> * 
	ge
 = 
v
.
edge
(
i
);

341 ià(
	ge
->
	gv”‹xid
 < 
	gv
.
id
()) {

342 
	gÃwcouÁs
 +ğ
e
->
g‘_d©a
();

343 
	ge
->
£t_d©a
(0);

346 ià(
	gv
.
id
(è< 
	gadjcÚš”
->
	gpivÙ_¡
 && 
	ge
->
	gv”‹xid
 <‡djcontainer->pivot_st) {

347 
	gv
.
»move_edge
(
i
);

351 
	gv
.
£t_d©a
(
v
.
g‘_d©a
(è+ 
ÃwcouÁs
);

359 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

360 
	ggcÚ‹xt
.
	gscheduËr
->
»move_sks
(0, (è
gcÚ‹xt
.
nv”tiûs
 - 1);

361 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0) {

364 
vid_t
 
i
=
adjcÚš”
->
pivÙ_¡
; 
	gi
 < 
	gadjcÚš”
->
	gpivÙ_’
; i++) {

365 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
i
);

367 
	gg¿bbed_edges
 = 0;

368 
	gadjcÚš”
->
ş—r
();

371 
log¡»am
(
LOG_INFO
è<< "Now…ivÙs: " << 
	gadjcÚš”
->
	gpivÙ_¡
 << " " <<‡djcÚš”->
	gpivÙ_’
 << 
	g¡d
::
’dl
;

372 
vid_t
 
	gi
=0; i < 
	ggcÚ‹xt
.
	gnv”tiûs
; i++) {

373 ià(
	gi
 < 
	gadjcÚš”
->
	gpivÙ_’
) {

374 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
i
);

384 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

394 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

395 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0) {

396 ià(
adjcÚš”
->
pivÙ_¡
 <ğ
wšdow_’
) {

397 
size_t
 
max_g¿b_edges
 = 
g‘_İtiÚ_lÚg
("membudget_mb", 1024) * 1024 * 1024 / 8;

398 ià(
	gg¿bbed_edges
 < 
	gmax_g¿b_edges
 * 0.8) {

399 
log¡»am
(
LOG_DEBUG
è<< "Wšdow in™, g¿bbed: " << 
	gg¿bbed_edges
 << "ƒdges" << 
	g¡d
::
’dl
;

400 
vid_t
 
	gvid
=
wšdow_¡
; vid <ğ
wšdow_’
; vid++) {

401 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
vid
);

403 
	gadjcÚš”
->
ex‹nd_pivÙ¿nge
(
wšdow_’
 + 1);

404 ià(
	gwšdow_’
 =ğ
gcÚ‹xt
.
nv”tiûs
) {

406 
gcÚ‹xt
.
£t_Ï¡_™”©iÚ
(gcÚ‹xt.
™”©iÚ
 + 3);

409 
	g¡d
::
cout
 << "ToØmªyƒdges,‡Ì—dy g¿bbed: " << 
g¿bbed_edges
 << 
¡d
::
’dl
;

419 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

427 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

430 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

434 
m‘rics
 
	`m
("triangle-counting");

436 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

437 
n™”s
 = 100000;

438 
boŞ
 
scheduËr
 = 
Œue
;

442 
Ord”ByDeg»e
<
EdgeD©aTy³
> * 
Üd”ByDeg»eP»´oûssÜ
 = 
Ãw
 OrderByDegree<EdgeDataType> ();

443 
nsh¬ds
 = 
cÚv”t_if_nÙexi¡s
<
EdgeD©aTy³
>(
f’ame
,

444 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"),

445 
Üd”ByDeg»eP»´oûssÜ
);

448 
adjcÚš”
 = 
Ãw
 
	`adjli¡_cÚš”
();

453 
TrŸngËCouÁšgProg¿m
 
´og¿m
;

454 
g¿phchi_dyÇmicg¿ph_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
 + 
Üd”ByDeg»eP»´oûssÜ
->
	`g‘Suffix
(),

455 
nsh¬ds
, 
scheduËr
, 
m
);

456 
’gše
.
	`£t_’abË_d‘”mši¡ic_·¿Î–ism
(
çl£
);

460 
’gše
.
	`£t_membudg‘_mb
(
¡d
::
	`mš
(
	`g‘_İtiÚ_št
("membudget_mb", 1024), 1024));

461 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

464 
	`m‘rics_»pÜt
(
m
);

467 
size_t
 
ÁrŸngËs
 = 
sum_v”tiûs
<
vid_t
, size_t>(
f’ame
 + "_degÜd", 0, (vid_t)
’gše
.
	`num_v”tiûs
());

468 
¡d
::
cout
 << "Numb” oàŒŸngËs: " << 
ÁrŸngËs
 / 3 << "(" <<‚ŒŸngË << ")" << std::
’dl
;

472 
size_t
 
ex³ùed
 = 
	`g‘_İtiÚ_lÚg
("assertequals", 0);

473 ià(
ex³ùed
 > 0) {

474 
¡d
::
cout
 << "Te¡šgh»suÉ i a ex³ùed: " << (
ÁrŸngËs
 / 3è<< " vs. " << 
ex³ùed
 << std::
’dl
;

475 
	`as£¹
(
ex³ùed
 =ğ
ÁrŸngËs
 / 3);

483 
	}
}

	@graphlab_toolkit_ports/lda/cgs_lda.cpp

10 
	~<¡ršg
>

11 
	~<®gÜ™hm
>

13 
	~"g¿phchi_basic_šşudes.hµ
"

14 
	~"­i/g¿phÏb2_1_GAS_­i/g¿phÏb.hµ
"

16 
	~"cgs_lda_v”‹x´og¿m.hµ
"

18 
usšg
 
Çme¥aû
 
	gg¿phchi
;

19 
usšg
 
Çme¥aû
 
	gg¿phÏb
;

21 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

24 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

28 
m‘rics
 
	`m
("LDA-graphlab");

32 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

33 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 4);

36 
nsh¬ds
 = 
cÚv”t_if_nÙexi¡s
<
edge_d©a
>(
f’ame
, 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"));

39 
¡d
::
veùÜ
<
v”‹x_d©a
> * 
v”tiûs
 =

40 
run_g¿phÏb_v”‹x´og¿m
<
cgs_lda_v”‹x_´og¿m
>(
f’ame
, 
nsh¬ds
, 
n™”s
, 
çl£
, 
m
, false, false);

43 
d–‘e
 
v”tiûs
;

45 
	`m‘rics_»pÜt
(
m
);

47 
	}
}

	@graphlab_toolkit_ports/lda/cgs_lda_vertexprogram.hpp

36 
	~<veùÜ
>

37 
	~<£t
>

38 
	~<®gÜ™hm
>

40 
	~"ut/©omic.hµ
"

42 
	~<boo¡/m©h/¥ecŸl_funùiÚs/gamma.hµ
>

43 
	~<veùÜ
>

44 
	~<®gÜ™hm
>

45 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

46 
	~<boo¡/cÚfig/w¬nšg_di§bË.hµ
>

47 
	~<boo¡/¥œ™/šşude/qi.hµ
>

48 
	~<boo¡/¥œ™/šşude/phÛnix_cÜe.hµ
>

49 
	~<boo¡/¥œ™/šşude/phÛnix_İ”©Ü.hµ
>

50 
	~<boo¡/¥œ™/šşude/phÛnix_¡l.hµ
>

51 
	~<boo¡/io¡»ams/¡»am.hµ
>

52 
	~<boo¡/io¡»ams/f‹ršg_¡»am.hµ
>

53 
	~<boo¡/io¡»ams/šput_£qu’û.hµ
>

58 
	tcouÁ_ty³
;

71 
	g¡d
::
	tveùÜ
< 
	tg¿phchi
::
	t©omic
<
	tcouÁ_ty³
> > 
	tçùÜ_ty³
;

78 
šlše
 
	gçùÜ_ty³
& 
	gİ”©Ü
+=(
çùÜ_ty³
& 
lv®ue
,

79 cÚ¡ 
	gçùÜ_ty³
& 
	grv®ue
) {

80 if(!
	grv®ue
.
em±y
()) {

81 if(
	glv®ue
.
em±y
()èlv®uğ
rv®ue
;

83 
size_t
 
	gt
 = 0; < 
	glv®ue
.
size
(); ++tèlv®ue[
t
] +ğ
rv®ue
[t];

86  
	glv®ue
;

99 
ušt16_t
 
	ttİic_id_ty³
;

103 
	#NULL_TOPIC
 (
	`tİic_id_ty³
(-1))

	)

105 
	#NTOPICS
 20

	)

114 
ušt16_t
 
	tassignm’t_ty³
[
NTOPICS
];

124 
	gALPHA
 = 1;

130 
	gBETA
 = 0.1;

139 
size_t
 
	gNWORDS
 = 0;

144 
size_t
 
	gNDOCS
 = 0;

149 
size_t
 
	gNTOKENS
 = 0;

156 
size_t
 
	gTOPK
 = 5;

161 
size_t
 
	gINTERVAL
 = 10;

167 
çùÜ_ty³
 
	gGLOBAL_TOPIC_COUNT
;

173 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
DICTIONARY
;

179 
size_t
 
	gMAX_COUNT
 = 100;

186 
	gBURNIN
 = -1;

200 
	sv”‹x_d©a
 {

202 
ušt32_t
 
	mnupd©es
;

204 
ušt32_t
 
	mnchªges
;

206 
çùÜ_ty³
 
	mçùÜ
;

207 
v”‹x_d©a
(è: 
nupd©es
(0), 
nchªges
(0), 
çùÜ
(
NTOPICS
) { }

215 
	sedge_d©a
 {

217 
ušt16_t
 
	mnchªges
;

219 
assignm’t_ty³
 
	massignm’t
;

220 
edge_d©a
(
size_t
 
Áok’s
 = 0è: 
nchªges
(0) {

221 
i
=0; 
	mi
<
	mNTOPICS
; i++è
	massignm’t
[i] = 0;

225 
	gg¿phÏb
::
	tdi¡ribu‹d_g¿ph
<
	tv”‹x_d©a
, 
	tedge_d©a
> 
	tg¿ph_ty³
;

227 
	$·r£
(
edge_d©a
 &
x
, cÚ¡ * 
s
) {

228 
size_t
 
couÁ
 = 
	`©Ş
(
s
);

229 
couÁ
 = 
¡d
::
	`mš
(couÁ, 
MAX_COUNT
);

230 
x
 = (
	`edge_d©a
(
couÁ
));

231 
	}
}

239 
boŞ
 
•¬£r
(
edge_d©a
& 
ed
, cÚ¡ 
¡d
::
¡ršg
& 
lše
){

240 cÚ¡ 
BASE
 = 10;

241 * 
	gÃxt_ch¬_±r
 = 
NULL
;

242 
size_t
 
	gcouÁ
 = 
¡¹oul
(
lše
.
c_¡r
(), &
Ãxt_ch¬_±r
, 
BASE
);

243 if(
	gÃxt_ch¬_±r
 ==
NULL
è 
çl£
;

246 
	gcouÁ
 = 
¡d
::
mš
(
couÁ
, 
MAX_COUNT
);

247 
	ged
 = (
edge_d©a
(
couÁ
));

248  
	gŒue
;

254 
boŞ
 
v·r£r
(
v”‹x_d©a
& 
vd
, cÚ¡ 
¡d
::
¡ršg
& 
lše
){

255 
vd
 = 
v”‹x_d©a
();

256  
	gŒue
;

273 
šlše
 
boŞ
 
is_wÜd
(cÚ¡ 
g¿ph_ty³
::
v”‹x_ty³
& 
v”‹x
) {

274  
v”‹x
.
num_š_edges
() > 0 ? 1 : 0;

284 
šlše
 
boŞ
 
is_doc
(cÚ¡ 
g¿ph_ty³
::
v”‹x_ty³
& 
v”‹x
) {

285  
v”‹x
.
num_out_edges
() > 0 ? 1 : 0;

291 
šlše
 
size_t
 
couÁ_tok’s
(cÚ¡ 
g¿ph_ty³
::
edge_ty³
& 
edge
) {

292  
edge
.
d©a
().
assignm’t
.
size
();

299 
šlše
 
	gg¿ph_ty³
::
v”‹x_ty³


300 
g‘_Ùh”_v”‹x
(cÚ¡ 
g¿ph_ty³
::
edge_ty³
& 
edge
,

301 cÚ¡ 
g¿ph_ty³
::
v”‹x_ty³
& 
v”‹x
) {

302  
v”‹x
.
id
(è=ğ
edge
.
sourû
().id()?ƒdge.
rg‘
() :ƒdge.source();

319 
	sg©h”_ty³
 {

320 
çùÜ_ty³
 
	mçùÜ
;

321 
ušt32_t
 
	mnchªges
;

322 
g©h”_ty³
(è: 
nchªges
(0) { };

323 
g©h”_ty³
(
ušt32_t
 
nchªges
è: 
çùÜ
(
NTOPICS
),‚changes(nchanges) { };

324 
	mg©h”_ty³
& 
	mİ”©Ü
+=(cÚ¡ 
g©h”_ty³
& 
Ùh”
) {

325 
çùÜ
 +ğ
Ùh”
.factor;

326 
	mnchªges
 +ğ
Ùh”
.
nchªges
;

327  *
	mthis
;

343 
şass
 
	gcgs_lda_v”‹x_´og¿m
 :

344 
public
 
g¿phÏb
::
iv”‹x_´og¿m
<
g¿ph_ty³
, 
	gg©h”_ty³
> {

345 
	gpublic
:

351 
boŞ
 
DISABLE_SAMPLING
;

354 
edge_dœ_ty³
 
g©h”_edges
(
icÚ‹xt_ty³
& 
cÚ‹xt
,

355 cÚ¡ 
v”‹x_ty³
& 
v”‹x
) const {

356  
	gg¿phÏb
::
ALL_EDGES
;

362 
g©h”_ty³
 
g©h”
(
icÚ‹xt_ty³
& 
cÚ‹xt
, cÚ¡ 
v”‹x_ty³
& 
v”‹x
,

363 
edge_ty³
& 
edge
) const {

364 
g©h”_ty³
 
»t
(
edge
.
d©a
().
nchªges
);

365 cÚ¡ 
	gassignm’t_ty³
& 
	gassignm’t
 = 
edge
.
d©a
().
assignm’t
;

366 
fÜ—ch
(
tİic_id_ty³
 
asg
, 
assignm’t
) {

367 if(
	gasg
 !ğ
NULL_TOPIC
è++
»t
.
çùÜ
[
asg
];

369  
	g»t
;

378 
­¶y
(
icÚ‹xt_ty³
& 
cÚ‹xt
, 
v”‹x_ty³
& 
v”‹x
,

379 cÚ¡ 
g©h”_ty³
& 
sum
) {

380 cÚ¡ 
size_t
 
	gnum_ÃighbÜs
 = 
v”‹x
.
num_š_edges
(è+ v”‹x.
num_out_edges
();

381 
ASSERT_GT
(
num_ÃighbÜs
, 0);

383 
	gv”‹x_d©a
& 
	gvd©a
 = 
v”‹x
.
d©a
();

384 
ASSERT_EQ
(
sum
.
çùÜ
.
size
(), 
NTOPICS
);

385 
ASSERT_EQ
(
vd©a
.
çùÜ
.
size
(), 
NTOPICS
);

386 
	gvd©a
.
	gnupd©es
++;

387 
	gvd©a
.
	gnchªges
 = 
sum
.
nchªges
;

388 
	gvd©a
.
	gçùÜ
 = 
sum
.
çùÜ
;

397 
edge_dœ_ty³
 
sÿ‰”_edges
(
icÚ‹xt_ty³
& 
cÚ‹xt
,

398 cÚ¡ 
v”‹x_ty³
& 
v”‹x
) const {

399  (
	gDISABLE_SAMPLING
 || (
	gBURNIN
 > 0 && 
	gcÚ‹xt
.
–­£d_£cÚds
() > BURNIN))?

400 
	gg¿phÏb
::
NO_EDGES
 : 
g¿phÏb
::
ALL_EDGES
;

418 
sÿ‰”
(
icÚ‹xt_ty³
& 
cÚ‹xt
, cÚ¡ 
v”‹x_ty³
& 
v”‹x
,

419 
edge_ty³
& 
edge
) const {

420 
	gçùÜ_ty³
& 
	gdoc_tİic_couÁ
 = 
is_doc
(
edge
.
sourû
()) ?

421 
edge
.
sourû
().
d©a
().
çùÜ
 :ƒdge.
rg‘
().data().factor;

422 
	gçùÜ_ty³
& 
	gwÜd_tİic_couÁ
 = 
is_wÜd
(
edge
.
sourû
()) ?

423 
edge
.
sourû
().
d©a
().
çùÜ
 :ƒdge.
rg‘
().data().factor;

424 
ASSERT_EQ
(
doc_tİic_couÁ
.
size
(), 
NTOPICS
);

425 
ASSERT_EQ
(
wÜd_tİic_couÁ
.
size
(), 
NTOPICS
);

427 
	g¡d
::
veùÜ
<> 
´ob
(
NTOPICS
);

428 
	gassignm’t_ty³
& 
	gassignm’t
 = 
edge
.
d©a
().
assignm’t
;

429 
	gedge
.
d©a
().
	gnchªges
 = 0;

430 
fÜ—ch
(
tİic_id_ty³
& 
asg
, 
assignm’t
) {

431 cÚ¡ 
tİic_id_ty³
 
	gŞd_asg
 = 
asg
;

432 if(
	gasg
 !ğ
NULL_TOPIC
) {

433 --
doc_tİic_couÁ
[
asg
];

434 --
	gwÜd_tİic_couÁ
[
asg
];

435 --
	gGLOBAL_TOPIC_COUNT
[
asg
];

437 
size_t
 
	gt
 = 0; < 
	gNTOPICS
; ++t) {

438 cÚ¡ 
	gn_dt
 =

439 
¡d
::
max
(
couÁ_ty³
(
doc_tİic_couÁ
[
t
]), count_type(0));

440 cÚ¡ 
	gn_wt
 =

441 
¡d
::
max
(
couÁ_ty³
(
wÜd_tİic_couÁ
[
t
]), count_type(0));

442 cÚ¡ 
	gn_t
 =

443 
¡d
::
max
(
couÁ_ty³
(
GLOBAL_TOPIC_COUNT
[
t
]), count_type(0));

444 
	g´ob
[
t
] = (
ALPHA
 + 
n_dt
è* (
BETA
 + 
n_wt
è/ (BETA * 
NWORDS
 + 
n_t
);

446 
	gasg
 = 
g¿phÏb
::
¿ndom
::
muÉšomŸl
(
´ob
);

448 ++
	gdoc_tİic_couÁ
[
asg
];

449 ++
	gwÜd_tİic_couÁ
[
asg
];

450 ++
	gGLOBAL_TOPIC_COUNT
[
asg
];

451 if(
	gasg
 !ğ
Şd_asg
) {

452 ++
edge
.
d©a
().
nchªges
;

456 
	gcÚ‹xt
.
sigÇl
(
g‘_Ùh”_v”‹x
(
edge
, 
v”‹x
));

462 
boŞ
 
	gcgs_lda_v”‹x_´og¿m
::
DISABLE_SAMPLING
 = 
çl£
;

469 
	gcgs_lda_v”‹x_´og¿m
::
	ticÚ‹xt_ty³
 icontext_type;

484 şas 
	ctİk_agg»g©Ü
 {

485 
	m¡d
::
	t·œ
<, 
	tg¿phÏb
::
	tv”‹x_id_ty³
> 
	tcw_·œ_ty³
;

486 
	m´iv©e
:

487 
¡d
::
veùÜ
< std::
£t
<
cw_·œ_ty³
> > 
tİ_wÜds
;

488 
size_t
 
	mnchªges
, 
	mnupd©es
;

489 
	mpublic
:

490 
	$tİk_agg»g©Ü
(
size_t
 
nchªges
 = 0, size_ˆ
nupd©es
 = 0) :

491 
	`nchªges
(
nchªges
), 
	$nupd©es
(
nupd©es
) { }

493 
tİk_agg»g©Ü
& 
İ”©Ü
+=(cÚ¡İk_agg»g©Ü& 
Ùh”
) {

494 
nchªges
 +ğ
Ùh”
.nchanges;

495 
nupd©es
 +ğ
Ùh”
.nupdates;

496 if(
Ùh”
.
tİ_wÜds
.
	`em±y
()è *
this
;

497 if(
tİ_wÜds
.
	`em±y
()ètİ_wÜds.
	`»size
(
NTOPICS
);

498 
size_t
 
i
 = 0; i < 
tİ_wÜds
.
	`size
(); ++i) {

500 
tİ_wÜds
[
i
].
	`š£¹
(
Ùh”
.tİ_wÜds[i].
	`begš
(),

501 
Ùh”
.
tİ_wÜds
[
i
].
	`’d
());

503 
tİ_wÜds
[
i
].
	`size
(è> 
TOPK
)

504 
tİ_wÜds
[
i
].
	`”a£
Ñİ_wÜds[i].
	`begš
());

506  *
this
;

507 
	}
}

509 
tİk_agg»g©Ü
 
m­
(
icÚ‹xt_ty³
& 
cÚ‹xt
,

510 cÚ¡ 
g¿ph_ty³
::
v”‹x_ty³
& 
v”‹x
) {

511 
tİk_agg»g©Ü
 
»t_v®ue
;

512 cÚ¡ 
	gv”‹x_d©a
& 
	gvd©a
 = 
v”‹x
.
d©a
();

513 
	g»t_v®ue
.
	gnchªges
 = 
vd©a
.
nchªges
;

514 
	g»t_v®ue
.
	gnupd©es
 = 
vd©a
.
nupd©es
;

515 if(
is_wÜd
(
v”‹x
)) {

516 cÚ¡ 
	gg¿phÏb
::
v”‹x_id_ty³
 
wÜdid
 = 
v”‹x
.
id
();

517 
	g»t_v®ue
.
	gtİ_wÜds
.
»size
(
vd©a
.
çùÜ
.
size
());

518 
size_t
 
	gi
 = 0; i < 
	gvd©a
.
	gçùÜ
.
size
(); ++i) {

519 cÚ¡ 
cw_·œ_ty³
 
·œ
(
vd©a
.
çùÜ
[
i
], 
wÜdid
);

520 
	g»t_v®ue
.
	gtİ_wÜds
[
i
].
š£¹
(
·œ
);

523  
	g»t_v®ue
;

527 
	$fš®ize
(
icÚ‹xt_ty³
& 
cÚ‹xt
,

528 cÚ¡ 
tİk_agg»g©Ü
& 
tÙ®
) {

529 if(
cÚ‹xt
.
	`´ocid
() != 0) ;

530 
size_t
 
i
 = 0; i < 
tÙ®
.
tİ_wÜds
.
	`size
(); ++i) {

531 
¡d
::
cout
 << "Tİiø" << 
i
 << ": ";

532 
	`»v_fÜ—ch
(
cw_·œ_ty³
 
·œ
, 
tÙ®
.
tİ_wÜds
[
i
]) {

534 
¡d
::
cout
 << 
DICTIONARY
[
·œ
.
£cÚd
]

535 << "(" << 
·œ
.
fœ¡
 << ")" << ", ";

538 
¡d
::
cout
 << std::
’dl
;

541 
¡d
::
cout
 << "\nNumb” oàtok’ chªges: " << 
tÙ®
.
nchªges
 << std::
’dl
;

542 
¡d
::
cout
 << "\nNumb” oàupd©es: " << 
tÙ®
.
nupd©es
 << std::
’dl
;

543 
	}
}

554 
	sglob®_couÁs_agg»g©Ü
 {

555 
	mg¿ph_ty³
::
	tv”‹x_ty³
 vertex_type;

556 
çùÜ_ty³
 
m­
(
icÚ‹xt_ty³
& 
cÚ‹xt
, cÚ¡ 
v”‹x_ty³
& 
v”‹x
) {

557  
	mv”‹x
.
d©a
().
	mçùÜ
;

560 
fš®ize
(
icÚ‹xt_ty³
& 
cÚ‹xt
, cÚ¡ 
çùÜ_ty³
& 
tÙ®
) {

561 
size_t
 
	msum
 = 0;

562 
size_t
 
	mt
 = 0; < 
	mtÙ®
.
size
(); ++t) {

563 
	mGLOBAL_TOPIC_COUNT
[
t
] =

564 
¡d
::
max
(
couÁ_ty³
(
tÙ®
[
t
]/2), count_type(0));

565 
	msum
 +ğ
GLOBAL_TOPIC_COUNT
[
t
];

567 
	mcÚ‹xt
.
cout
(è<< "TÙ® Tok’s: " << 
	msum
 << 
	m¡d
::
’dl
;

586 şas 
	clik–ihood_agg»g©Ü
 : 
public
 
g¿phÏb
::
IS_POD_TYPE
 {

587 
g¿ph_ty³
::
	tv”‹x_ty³
 vertex_type;

588 
	mlik_wÜds_giv’_tİics
;

589 
	mlik_tİics
;

590 
	mpublic
:

591 
	$lik–ihood_agg»g©Ü
(è: 
	`lik_wÜds_giv’_tİics
(0), 
	$lik_tİics
(0) { }

593 
lik–ihood_agg»g©Ü
& 
İ”©Ü
+=(cÚ¡†ik–ihood_agg»g©Ü& 
Ùh”
) {

594 
lik_wÜds_giv’_tİics
 +ğ
Ùh”
.lik_words_given_topics;

595 
lik_tİics
 +ğ
Ùh”
.lik_topics;

596  *
this
;

597 
	}
}

599 
lik–ihood_agg»g©Ü


600 
	$m­
(
icÚ‹xt_ty³
& 
cÚ‹xt
, cÚ¡ 
v”‹x_ty³
& 
v”‹x
) {

601 
usšg
 
boo¡
::
m©h
::
lgamma
;

602 cÚ¡ 
çùÜ_ty³
& 
çùÜ
 = 
v”‹x
.
	`d©a
().factor;

603 
	`ASSERT_EQ
(
çùÜ
.
	`size
(), 
NTOPICS
);

604 
lik–ihood_agg»g©Ü
 
»t
;

605 if(
	`is_wÜd
(
v”‹x
)) {

606 
size_t
 
t
 = 0; < 
NTOPICS
; ++t) {

607 cÚ¡ 
v®ue
 = 
¡d
::
	`max
(
	`couÁ_ty³
(
çùÜ
[
t
]), count_type(0));

608 
»t
.
lik_wÜds_giv’_tİics
 +ğ
	`lgamma
(
v®ue
 + 
BETA
);

610 } { 
	`ASSERT_TRUE
(
	`is_doc
(
v”‹x
));

611 
Áok’s_š_doc
 = 0;

612 
size_t
 
t
 = 0; < 
NTOPICS
; ++t) {

613 cÚ¡ 
v®ue
 = 
¡d
::
	`max
(
	`couÁ_ty³
(
çùÜ
[
t
]), count_type(0));

614 
»t
.
lik_tİics
 +ğ
	`lgamma
(
v®ue
 + 
ALPHA
);

615 
Áok’s_š_doc
 +ğ
çùÜ
[
t
];

617 
»t
.
lik_tİics
 -ğ
	`lgamma
(
Áok’s_š_doc
 + 
NTOPICS
 * 
ALPHA
);

619  
»t
;

620 
	}
}

622 
	$fš®ize
(
icÚ‹xt_ty³
& 
cÚ‹xt
, cÚ¡ 
lik–ihood_agg»g©Ü
& 
tÙ®
) {

623 
usšg
 
boo¡
::
m©h
::
lgamma
;

625 
d’omš©Ü
 = 0;

626 
size_t
 
t
 = 0; < 
NTOPICS
; ++t) {

627 
d’omš©Ü
 +ğ
	`lgamma
(
GLOBAL_TOPIC_COUNT
[
t
] + 
NWORDS
 * 
BETA
);

630 cÚ¡ 
lik_wÜds_giv’_tİics
 =

631 
NTOPICS
 * (
	`lgamma
(
NWORDS
 * 
BETA
) - NWORDS *†gamma(BETA)) -

632 
d’omš©Ü
 + 
tÙ®
.
lik_wÜds_giv’_tİics
;

634 cÚ¡ 
lik_tİics
 =

635 
NDOCS
 * (
	`lgamma
(
NTOPICS
 * 
ALPHA
) - NTOPICS *†gamma(ALPHA)) +

636 
tÙ®
.
lik_tİics
;

638 cÚ¡ 
lik
 = 
lik_wÜds_giv’_tİics
 + 
lik_tİics
;

639 
cÚ‹xt
.
	`cout
(è<< "Lik–ihood: " << 
lik
 << 
¡d
::
’dl
;

640 
	}
}

650 
	ssigÇl_Úly
 {

655 
	mg¿phÏb
::
em±y


656 
docs
(
icÚ‹xt_ty³
& 
cÚ‹xt
, cÚ¡ 
g¿ph_ty³
::
v”‹x_ty³
& 
v”‹x
) {

657 if(
is_doc
(
v”‹x
)è
cÚ‹xt
.
sigÇl
(vertex);

658  
	mg¿phÏb
::
em±y
();

665 
	mg¿phÏb
::
em±y


666 
wÜds
(
icÚ‹xt_ty³
& 
cÚ‹xt
, cÚ¡ 
g¿ph_ty³
::
v”‹x_ty³
& 
v”‹x
) {

667 if(
is_wÜd
(
v”‹x
)è
cÚ‹xt
.
sigÇl
(vertex);

668  
	mg¿phÏb
::
em±y
();

691 
boŞ
 
lßd_diùiÚ¬y
(cÚ¡ 
¡d
::
¡ršg
& 
âame
) {

694 cÚ¡ 
boŞ
 
gz
 = 
boo¡
::
’ds_w™h
(
âame
, ".gz");

697 
	g¡d
::
cout
 << "İ’šg: " << 
âame
 << 
¡d
::
’dl
;

698 
	g¡d
::
if¡»am
 
š_fe
(
âame
.
c_¡r
(),

699 
¡d
::
ios_ba£
::
š
 | std::ios_ba£::
bš¬y
);

700 
	gboo¡
::
io¡»ams
::
f‹ršg_¡»am
<
boo¡
::io¡»ams::
šput
> 
fš
;

701 
	gfš
.
push
(
š_fe
);

702 if(!
	gfš
.
good
() || !fin.good()) {

703 
log¡»am
(
LOG_ERROR
) << "Error†oading dictionary: "

704 << 
	gâame
 << 
	g¡d
::
’dl
;

705  
	gçl£
;

707 
	g¡d
::
¡ršg
 
‹rm
;

708 
	g¡d
::
cout
 << "Looİšg" << 
¡d
::
’dl
;

709 
	g¡d
::
g‘lše
(
fš
, 
‹rm
).
good
()è
	gDICTIONARY
.
push_back
(term);

710 
	gfš
.
pİ
();

711 
	gš_fe
.
şo£
();

714 
	g¡d
::
cout
 << "DiùiÚ¬y Size: " << 
DICTIONARY
.
size
(è<< 
¡d
::
’dl
;

715  
	gŒue
;

721 
	scouÁ_§v”
 {

722 
boŞ
 
	m§ve_wÜds
;

723 
couÁ_§v”
(
boŞ
 
§ve_wÜds
) : save_words(save_words) { }

724 
g¿ph_ty³
::
	tv”‹x_ty³
 vertex_type;

725 
	mg¿ph_ty³
::
	tedge_ty³
ƒdge_type;

726 
	m¡d
::
¡ršg
 
§ve_v”‹x
(cÚ¡ 
v”‹x_ty³
& 
v”‹x
) const {

729 if((
§ve_wÜds
 && 
is_doc
(
v”‹x
)) ||

730 (!
§ve_wÜds
 && 
is_wÜd
(
v”‹x
)))  "";

732 
	m¡d
::
¡ršg¡»am
 
¡rm
;

733 if(
	m§ve_wÜds
) {

734 cÚ¡ 
	mg¿phÏb
::
v”‹x_id_ty³
 
vid
 = 
v”‹x
.
id
();

735 
	m¡rm
 << 
	mvid
 << '\t';

737 cÚ¡ 
	mg¿phÏb
::
v”‹x_id_ty³
 
vid
 = (-
v”‹x
.
id
()) - 2;

738 
	m¡rm
 << 
	mvid
 << '\t';

740 cÚ¡ 
	mçùÜ_ty³
& 
	mçùÜ
 = 
v”‹x
.
d©a
().
çùÜ
;

741 
size_t
 
	mi
 = 0; i < 
	mçùÜ
.
size
(); ++i) {

742 
	m¡rm
 << 
	mçùÜ
[
i
];

743 if(
	mi
+1 < 
	mçùÜ
.
size
()è
	m¡rm
 << '\t';

745 
	m¡rm
 << '\n';

746  
	m¡rm
.
¡r
();

748 
	m¡d
::
¡ršg
 
§ve_edge
(cÚ¡ 
edge_ty³
& 
edge
) const {

	@src/api/chifilenames.hpp

33 #iâdeà
GRAPHCHI_FILENAMES_DEF


34 
	#GRAPHCHI_FILENAMES_DEF


	)

36 
	~<f¡»am
>

37 
	~<fú.h
>

38 
	~<¡ršg
>

39 
	~<s¡»am
>

40 
	~<¡dlib.h
>

41 
	~<”ºo.h
>

42 
	~<uni¡d.h
>

43 
	~<veùÜ
>

44 
	~<sys/¡©.h
>

46 
	~"g¿phchi_ty³s.hµ
"

47 
	~"logg”/logg”.hµ
"

49 #ifdeà
DYNAMICEDATA


50 
	~"sh¬ds/dyÇmicd©a/dyÇmicblock.hµ
"

53 
Çme¥aû
 
	gg¿phchi
 {

55 #ifdeà
__GNUC__


56 
	#VARIABLE_IS_NOT_USED
 
	`__©Œibu‹__
 ((
unu£d
))

	)

58 
	#VARIABLE_IS_NOT_USED


	)

60 
VARIABLE_IS_NOT_USED
 
g‘_İtiÚ_št
(cÚ¡ *
İtiÚ_Çme
, 
deçuÉ_v®ue
);

65 
	g‹m¶©e
 <
ty³Çme
 
	gV”‹xD©aTy³
>

66 
	g¡d
::
¡ršg
 
f’ame_v”‹x_d©a
(
¡d
::¡ršg 
ba£f’ame
) {

67 
¡d
::
¡ršg¡»am
 
ss
;

68 
	gss
 << 
	gba£f’ame
;

69 
	gss
 << "." << (
	gV”‹xD©aTy³
) << "B.vout";

70  
	gss
.
¡r
();

73 
	g¡d
::
¡ršg
 
f’ame_deg»e_d©a
(
¡d
::¡ršg 
ba£f’ame
) {

74  
ba£f’ame
 + "_degs.bin";

77 
	g¡d
::
¡ršg
 
f’ame_š‹rv®s
(
¡d
::¡ršg 
ba£f’ame
, 
nsh¬ds
) {

78 
	g¡d
::
¡ršg¡»am
 
ss
;

79 
	gss
 << 
	gba£f’ame
;

80 
	gss
 << "." << 
	gnsh¬ds
 << ".intervals";

81  
	gss
.
¡r
();

85 
	g¡d
::
¡ršg
 
VARIABLE_IS_NOT_USED
 
g‘_·¹_¡r
(
p
, 
nsh¬ds
) {

86 
	g·¹¡r
[32];

87 
¥rštf
(
·¹¡r
, ".%d_%d", 
p
, 
nsh¬ds
);

88  
	g¡d
::
¡ršg
(
·¹¡r
);

91 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

92 
	g¡d
::
¡ršg
 
f’ame_sh¬d_ed©a
(
¡d
::¡ršg 
ba£f’ame
, 
p
, 
nsh¬ds
) {

93 
	g¡d
::
¡ršg¡»am
 
ss
;

94 
	gss
 << 
	gba£f’ame
;

95 #ifdeà
DYNAMICEDATA


96 
	gss
 << ".dynamic.";

98 
	gss
 << ".edata.";

100 
	gss
 << "e" << (
	gEdgeD©aTy³
) << "B.";

101 
	gss
 << 
	gp
 << "_" << 
	gnsh¬ds
;

103  
	gss
.
¡r
();

109 
	g¡d
::
¡ršg
 
dœÇme_sh¬d_ed©a_block
(
¡d
::¡ršg 
ed©a_sh¬dÇme
, 
size_t
 
blocksize
) {

110 
	g¡d
::
¡ršg¡»am
 
ss
;

111 
	gss
 << 
	ged©a_sh¬dÇme
;

112 
	gss
 << "_blockdœ_" << 
	gblocksize
;

113  
	gss
.
¡r
();

116 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

117 
size_t
 
g‘_sh¬d_ed©a_fesize
(
¡d
::
¡ršg
 
ed©a_sh¬dÇme
) {

118 
size_t
 
fsize
;

119 
	g¡d
::
¡ršg
 
âame
 = 
ed©a_sh¬dÇme
 + ".size";

120 
	g¡d
::
if¡»am
 
ifs
(
âame
.
c_¡r
());

121 ià(!
	gifs
.
good
()) {

122 
log¡»am
(
LOG_FATAL
è<< "Could‚Ù†ßd " << 
	gâame
 << ". P»´oûssšg fÜgÙ‹n?" << 
	g¡d
::
’dl
;

123 
as£¹
(
ifs
.
good
());

125 
	gifs
 >> 
	gfsize
;

126 
	gifs
.
şo£
();

127  
	gfsize
;

131 
	g¡d
::
¡ršg
 
f’ame_sh¬d_ed©a_block
(
¡d
::¡ršg 
ed©a_sh¬dÇme
, 
blockid
, 
size_t
 
blocksize
) {

132 
	g¡d
::
¡ršg¡»am
 
ss
;

133 
	gss
 << 
dœÇme_sh¬d_ed©a_block
(
ed©a_sh¬dÇme
, 
blocksize
);

134 
	gss
 << "/";

135 
	gss
 << 
	gblockid
;

136  
	gss
.
¡r
();

140 
	g¡d
::
¡ršg
 
f’ame_sh¬d_adj
(
¡d
::¡ršg 
ba£f’ame
, 
p
, 
nsh¬ds
) {

141 
	g¡d
::
¡ršg¡»am
 
ss
;

142 
	gss
 << 
	gba£f’ame
;

143 
	gss
 << ".edata_azv.";

144 
	gss
 << 
	gp
 << "_" << 
	gnsh¬ds
 << ".adj";

145  
	gss
.
¡r
();

151 
	g¡d
::
¡ršg
 
f’ame_cÚfig
();

152 
	g¡d
::
¡ršg
 
f’ame_cÚfig
() {

153 * 
chi_roÙ
 = 
g‘’v
("GRAPHCHI_ROOT");

154 ià(
	gchi_roÙ
 !ğ
NULL
) {

155  
¡d
::
¡ršg
(
chi_roÙ
) + "/conf/graphchi.cnf";

165 
	g¡d
::
¡ršg
 
f’ame_cÚfig_loÿl
();

166 
	g¡d
::
¡ršg
 
f’ame_cÚfig_loÿl
() {

167 * 
chi_roÙ
 = 
g‘’v
("GRAPHCHI_ROOT");

168 ià(
	gchi_roÙ
 !ğ
NULL
) {

169  
¡d
::
¡ršg
(
chi_roÙ
) + "/conf/graphchi.local.cnf";

176 
boŞ
 
fe_exi¡s
(
¡d
::
¡ršg
 
¢ame
);

177 
boŞ
 
fe_exi¡s
(
¡d
::
¡ršg
 
¢ame
) {

178 
Œyf
 = 
İ’
(
¢ame
.
c_¡r
(), 
O_RDONLY
);

179 ià(
	gŒyf
 < 0) {

180  
	gçl£
;

182 
şo£
(
Œyf
);

183  
	gŒue
;

193 
	g‹m¶©e
<
ty³Çme
 
	gEdgeD©aTy³
>

194 
fšd_sh¬ds
(
¡d
::
¡ršg
 
ba£_f’ame
, std::¡ršg 
sh¬d_¡ršg
="auto") {

195 
Œy_sh¬d_num
;

196 
	g¡¬t_num
 = 0;

197 
	gÏ¡_sh¬d_num
 = 2400;

198 ià(
	gsh¬d_¡ršg
 == "auto") {

199 
¡¬t_num
 = 0;

201 
	g¡¬t_num
 = 
©oi
(
sh¬d_¡ršg
.
c_¡r
());

204 ià(
	g¡¬t_num
 > 0) {

205 
	gÏ¡_sh¬d_num
 = 
¡¬t_num
;

207 
size_t
 
	gblocksize
 = 4096 * 1024;

208 
	gblocksize
 % (
	gEdgeD©aTy³
è!ğ0è
blocksize
++;

210 
	gŒy_sh¬d_num
=
¡¬t_num
;ry_sh¬d_num <ğ
Ï¡_sh¬d_num
;ry_shard_num++) {

211 
	g¡d
::
¡ršg
 
Ï¡_sh¬d_Çme
 = 
f’ame_sh¬d_ed©a
<
EdgeD©aTy³
>(
ba£_f’ame
, 
	gŒy_sh¬d_num
 - 1,ry_shard_num);

212 
	g¡d
::
¡ršg
 
Ï¡_block_Çme
 = 
f’ame_sh¬d_ed©a_block
(
Ï¡_sh¬d_Çme
, 0, 
blocksize
);

213 
	gŒyf
 = 
İ’
(
Ï¡_block_Çme
.
c_¡r
(), 
O_RDONLY
);

214 ià(
	gŒyf
 >= 0) {

216 
şo£
(
Œyf
);

218 
	gnsh¬ds_ÿndid©e
 = 
Œy_sh¬d_num
;

219 
boŞ
 
	gsucûss
 = 
Œue
;

222 
	gp
=0;… < 
	gnsh¬ds_ÿndid©e
;…++) {

223 
	g¡d
::
¡ršg
 
¢ame
 = 
f’ame_sh¬d_ed©a_block
(

224 
f’ame_sh¬d_ed©a
<
EdgeD©aTy³
>(
ba£_f’ame
, 
p
, 
nsh¬ds_ÿndid©e
), 0, 
blocksize
);

225 ià(!
fe_exi¡s
(
¢ame
)) {

226 
log¡»am
(
LOG_DEBUG
è<< "Missšg dœeùÜy fe: " << 
	g¢ame
 << 
	g¡d
::
’dl
;

227 
	gsucûss
 = 
çl£
;

231 
	g¢ame
 = 
f’ame_sh¬d_adj
(
ba£_f’ame
, 
p
, 
nsh¬ds_ÿndid©e
);

232 ià(!
fe_exi¡s
(
¢ame
)) {

233 
log¡»am
(
LOG_DEBUG
è<< "Missšg sh¬d fe: " << 
	g¢ame
 << 
	g¡d
::
’dl
;

234 
	gsucûss
 = 
çl£
;

240 
	g¡d
::
¡ršg
 
deg»eâame
 = 
f’ame_deg»e_d©a
(
ba£_f’ame
);

241 ià(!
fe_exi¡s
(
deg»eâame
)) {

242 
log¡»am
(
LOG_ERROR
è<< "Missšg deg»fe: " << 
	gdeg»eâame
 << 
	g¡d
::
’dl
;

243 
log¡»am
(
LOG_ERROR
è<< "You‚“dØ´•roûs (sh¬d”èyou¸fagaš!" << 
	g¡d
::
’dl
;

247 
	g¡d
::
¡ršg
 
š‹rv®âame
 = 
f’ame_š‹rv®s
(
ba£_f’ame
, 
nsh¬ds_ÿndid©e
);

248 ià(!
fe_exi¡s
(
š‹rv®âame
)) {

249 
log¡»am
(
LOG_ERROR
è<< "Missšg iÁ”v® fe: " << 
	gš‹rv®âame
 << 
	g¡d
::
’dl
;

250 
log¡»am
(
LOG_ERROR
è<< "You‚“dØ´•roûs (sh¬d”èyou¸fagaš!" << 
	g¡d
::
’dl
;

254 ià(!
	gsucûss
) {

258 
log¡»am
(
LOG_INFO
è<< "D‘eùed‚umb” oàsh¬ds: " << 
	gnsh¬ds_ÿndid©e
 << 
	g¡d
::
’dl
;

259 
log¡»am
(
LOG_INFO
è<< "TØ¥ecify‡ difã»Á‚umb” oàsh¬ds, u£ commªd-lš·¿m‘” 'nsh¬ds'" << 
	g¡d
::
’dl
;

260  
	gnsh¬ds_ÿndid©e
;

263 ià(
	gÏ¡_sh¬d_num
 =ğ
¡¬t_num
) {

264 
log¡»am
(
LOG_WARNING
è<< "Could‚Ù fšd sh¬d w™h‚sh¬d ğ" << 
¡¬t_num
 << 
¡d
::
’dl
;

265 
log¡»am
(
LOG_WARNING
è<< "PËa£ defš'nsh¬d 0' o¸'nsh¬d auto'Øautom©iÿÎy d‘eù." << 
	g¡d
::
’dl
;

274 
	g‹m¶©e
<
ty³Çme
 
	gEdgeD©aTy³_
>

275 
d–‘e_sh¬ds
(
¡d
::
¡ršg
 
ba£_f’ame
, 
nsh¬ds
) {

276 #ifdeà
DYNAMICEDATA


277 
	tEdgeD©aTy³
;

279 
EdgeD©aTy³_
 
	tEdgeD©aTy³
;

281 
log¡»am
(
LOG_DEBUG
è<< "D–‘šg fe fÜ " << 
	gba£_f’ame
 << " sh¬ds=" << 
	gnsh¬ds
 << 
	g¡d
::
’dl
;

282 
	g¡d
::
¡ršg
 
š‹rv®âame
 = 
f’ame_š‹rv®s
(
ba£_f’ame
, 
nsh¬ds
);

283 ià(
fe_exi¡s
(
š‹rv®âame
)) {

284 
	g”r
 = 
»move
(
š‹rv®âame
.
c_¡r
());

285 ià(
	g”r
 !ğ0è
log¡»am
(
LOG_ERROR
è<< "E¼Ü„emovšg f" << 
š‹rv®âame


286 << ", " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

296 
size_t
 
	gblocksize
 = 4096 * 1024;

297 
	gblocksize
 % (
	gEdgeD©aTy³
è!ğ0è
blocksize
++;

299 
	gp
=0;… < 
	gnsh¬ds
;…++) {

300 
	gblockid
 = 0;

301 
	g¡d
::
¡ršg
 
f’ame_ed©a
 = 
f’ame_sh¬d_ed©a
<
EdgeD©aTy³
>(
ba£_f’ame
, 
	gp
, 
	gnsh¬ds
);

302 
	g¡d
::
¡ršg
 
fsiz’ame
 = 
f’ame_ed©a
 + ".size";

303 ià(
fe_exi¡s
(
fsiz’ame
)) {

304 
	g”r
 = 
»move
(
fsiz’ame
.
c_¡r
());

305 ià(
	g”r
 !ğ0è
log¡»am
(
LOG_ERROR
è<< "E¼Ü„emovšg f" << 
fsiz’ame


306 << ", " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

308 
	gŒue
) {

309 
	g¡d
::
¡ršg
 
block_f’ame
 = 
f’ame_sh¬d_ed©a_block
(
f’ame_ed©a
, 
blockid
, 
blocksize
);

310 
log¡»am
(
LOG_DEBUG
è<< "D–‘šg " << 
	gblock_f’ame
 << "ƒxi¡s: " << 
fe_exi¡s
(
block_f’ame
è<< 
	g¡d
::
’dl
;

311 ià(
fe_exi¡s
(
block_f’ame
)) {

312 
	g”r
 = 
»move
(
block_f’ame
.
c_¡r
());

313 ià(
	g”r
 !ğ0è
log¡»am
(
LOG_ERROR
è<< "E¼Ü„emovšg f" << 
block_f’ame


314 << ", " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

320 #ifdeà
DYNAMICEDATA


321 
d–‘e_block_uncom´es£d_sizefe
(
block_f’ame
);

323 
	gblockid
++;

325 
	g¡d
::
¡ršg
 
dœÇme
 = 
dœÇme_sh¬d_ed©a_block
(
f’ame_ed©a
, 
blocksize
);

326 ià(
fe_exi¡s
(
dœÇme
)) {

327 
	g”r
 = 
»move
(
dœÇme
.
c_¡r
());

328 ià(
	g”r
 !ğ0è
log¡»am
(
LOG_ERROR
è<< "E¼Ü„emovšg dœeùÜy " << 
dœÇme


329 << ", " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

333 
	g¡d
::
¡ršg
 
adjÇme
 = 
f’ame_sh¬d_adj
(
ba£_f’ame
, 
p
, 
nsh¬ds
);

334 
log¡»am
(
LOG_DEBUG
è<< "D–‘šg " << 
	gadjÇme
 << "ƒxi¡s: " << 
fe_exi¡s
(
adjÇme
è<< 
	g¡d
::
’dl
;

336 ià(
fe_exi¡s
(
adjÇme
)) {

337 
	g”r
 = 
»move
(
adjÇme
.
c_¡r
());

338 ià(
	g”r
 !ğ0è
log¡»am
(
LOG_ERROR
è<< "E¼Ü„emovšg f" << 
adjÇme


339 << ", " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

345 
	g¡d
::
¡ršg
 
numv_f’ame
 = 
ba£_f’ame
 + ".numvertices";

346 ià(
fe_exi¡s
(
numv_f’ame
)) {

347 
	g”r
 = 
»move
(
numv_f’ame
.
c_¡r
());

348 ià(
	g”r
 !ğ0è
log¡»am
(
LOG_ERROR
è<< "E¼Ü„emovšg f" << 
numv_f’ame


349 << ", " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

357 
lßd_v”‹x_š‹rv®s
(
¡d
::
¡ršg
 
ba£_f’ame
, 
nsh¬ds
, std::
veùÜ
<¡d::
·œ
<
vid_t
, vid_t> > & 
š‹rv®s
, 
boŞ
 
®lowç
);

358 
lßd_v”‹x_š‹rv®s
(
¡d
::
¡ršg
 
ba£_f’ame
, 
nsh¬ds
, std::
veùÜ
<¡d::
·œ
<
vid_t
, vid_t> > & 
š‹rv®s
, 
boŞ
 
®lowç
=
çl£
) {

359 
¡d
::
¡ršg
 
š‹rv®sF’ame
 = 
f’ame_š‹rv®s
(
ba£_f’ame
, 
nsh¬ds
);

360 
	g¡d
::
if¡»am
 
š‹rv®sF
(
š‹rv®sF’ame
.
c_¡r
());

362 ià(!
	gš‹rv®sF
.
good
()) {

363 ià(
	g®lowç
) ;

364 
log¡»am
(
LOG_ERROR
è<< "Could‚Ù†ßd iÁ”v®s-fe: " << 
	gš‹rv®sF’ame
 << 
	g¡d
::
’dl
;

366 
as£¹
(
š‹rv®sF
.
good
());

368 
	gš‹rv®s
.
ş—r
();

370 
vid_t
 
	g¡
=0, 
	g’
;

371 
	gi
=0; i < 
	gnsh¬ds
; i++) {

372 
as£¹
(!
š‹rv®sF
.
eof
());

373 
	gš‹rv®sF
 >> 
	g’
;

374 
	gš‹rv®s
.
push_back
(
¡d
::
·œ
<
vid_t
,vid_t>(
¡
, 
’
));

375 
	g¡
 = 
’
 + 1;

377 
	gi
=0; i < 
	gnsh¬ds
; i++) {

378 
log¡»am
(
LOG_INFO
è<< "sh¬d: " << 
	gš‹rv®s
[
i
].
	gfœ¡
 << " - " << iÁ”v®s[i].
	g£cÚd
 << 
	g¡d
::
’dl
;

380 
	gš‹rv®sF
.
şo£
();

386 
VARIABLE_IS_NOT_USED
 
size_t
 
g‘_num_v”tiûs
(
¡d
::
¡ršg
 
ba£f’ame
);

387 
VARIABLE_IS_NOT_USED
 
size_t
 
g‘_num_v”tiûs
(
¡d
::
¡ršg
 
ba£f’ame
) {

388 
¡d
::
¡ršg
 
numv_f’ame
 = 
ba£f’ame
 + ".numvertices";

389 
	g¡d
::
if¡»am
 
vfeF
(
numv_f’ame
.
c_¡r
());

390 ià(!
	gvfeF
.
good
()) {

391 
log¡»am
(
LOG_ERROR
è<< "Could‚Ù fšd f" << 
	gnumv_f’ame
 << 
	g¡d
::
’dl
;

392 
log¡»am
(
LOG_ERROR
è<< "Maybyou havŞd sh¬d -…Ëa£„eü—‹." << 
	g¡d
::
’dl
;

393 
as£¹
(
çl£
);

395 
size_t
 
	gn
;

396 
	gvfeF
 >> 
	gn
;

397 
	gvfeF
.
şo£
();

398  
	gn
;

401 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

402 
	g¡d
::
¡ršg
 
´•roûss_f’ame
(
¡d
::¡ršg 
ba£f’ame
) {

403 
¡d
::
¡ršg¡»am
 
ss
;

404 
	gss
 << 
	gba£f’ame
;

405 
	gss
 << "." << (
	gEdgeD©aTy³
) << "B.bin";

406  
	gss
.
¡r
();

416 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

417 
boŞ
 
check_Üigfe_modifiÿtiÚ_—¾›r
(
¡d
::
¡ršg
 
ba£f’ame
, 
nsh¬ds
) {

419 ià(
fe_exi¡s
(
ba£f’ame
è&& 
g‘_İtiÚ_št
("disable-modtime-check", 0) == 0) {

420 
¡©
 
Üig¡©
, 
sh¬d¡©
;

421 
	g”r1
 = 
¡©
(
ba£f’ame
.
c_¡r
(), &
Üig¡©
);

423 
	g¡d
::
¡ršg
 
adjâame
 = 
f’ame_sh¬d_adj
(
ba£f’ame
, 0, 
nsh¬ds
);

424 
	g”r2
 = 
¡©
(
adjâame
.
c_¡r
(), &
sh¬d¡©
);

426 ià(
	g”r1
 !ğ0 || 
”r2
 != 0) {

427 
log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’ checkšg fmodifiÿtiÚimes: " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

428  
	gnsh¬ds
;

431 ià(
	gÜig¡©
.
	g¡_mtime
 > 
	gsh¬d¡©
.st_mtime) {

432 
log¡»am
(
LOG_INFO
è<< "Thšpuˆg¿ph modifiÿtiÚ d©wa Ãw”hª oàthsh¬ds." << 
	g¡d
::
’dl
;

433 
log¡»am
(
LOG_INFO
è<< "GošgØd–‘Şd sh¬d ªd„eü—‹‚ew oÃs. TØdi§bË " << 
	g¡d
::
’dl
;

434 
log¡»am
(
LOG_INFO
è<< "funùiÚ®™y, s³cify --di§bË-modtime-check=1" << 
	g¡d
::
’dl
;

437 
	gd–‘e_sh¬ds
<
	gEdgeD©aTy³
>(
	gba£f’ame
, 
	gnsh¬ds
);

440 
	g¡d
::
¡ršg
 
´•rocfe
 = 
´•roûss_f’ame
<
EdgeD©aTy³
>(
ba£f’ame
);

441 ià(
fe_exi¡s
(
´•rocfe
)) {

442 
log¡»am
(
LOG_DEBUG
è<< "D–‘šg: " << 
	g´•rocfe
 << 
	g¡d
::
’dl
;

443 
	g”r
 = 
»move
(
´•rocfe
.
c_¡r
());

444 ià(
	g”r
 != 0) {

445 
log¡»am
(
LOG_ERROR
è<< "E¼Ü d–‘šg fe: " << 
´•rocfe
 << ", " <<

446 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

449  
	gçl£
;

451  
	gŒue
;

456  
	gŒue
;

	@src/api/dynamicdata/chivector.hpp

30 #iâdeà
DEF_GRAPHCHI_CHIVECTOR


31 
	#DEF_GRAPHCHI_CHIVECTOR


	)

33 
	~<veùÜ
>

34 
	~<¡dšt.h
>

36 
Çme¥aû
 
	gg¿phchi
 {

39 
	#MINCAPACITY
 2

	)

45 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

46 şas 
	cex‹nsiÚ_poŞ
 {

51 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

52 şas 
	cchiveùÜ
 {

54 
ušt16_t
 
	gnsize
;

55 
ušt16_t
 
	gnÿ·c™y
;

56 
T
 * 
	gd©a
;

57 
	g¡d
::
veùÜ
<
T
> * 
ex‹nsiÚs
;

59 
	gpublic
:

60 
T
 
	t–em’t_ty³_t
;

61 
ušt32_t
 
	tsizewÜd_t
;

62 
chiveùÜ
() {

63 
	gex‹nsiÚs
 = 
NULL
;

66 
chiveùÜ
(
ušt16_t
 
sz
, ušt16_ˆ
ÿp
, 
T
 * 
d©­Œ
è: 
d©a
(dataptr) {

67 
nsize
 = 
sz
;

68 
	gnÿ·c™y
 = 
ÿp
;

69 
as£¹
(
ÿp
 >ğ
nsize
);

70 
	gex‹nsiÚs
 = 
NULL
;

73 ~
chiveùÜ
() {

74 ià(
	gex‹nsiÚs
 !ğ
NULL
) {

75 
d–‘e
 
ex‹nsiÚs
;

76 
	gex‹nsiÚs
 = 
NULL
;

80 
wr™e
(
T
 * 
de¡
) {

81 
	gsz
 = (è
this
->
size
();

82 
	gi
=0; i < 
	gsz
; i++) {

83 
	gde¡
[
i
] = 
g‘
(i);

87 
ušt16_t
 
size
() {

88  
	gnsize
;

91 
ušt16_t
 
ÿ·c™y
() {

92  
	gnsize
 > 
	gMINCAPACITY
 ?‚siz: 
MINCAPACITY
;

95 
add
(
T
 
v®
) {

96 
	gnsize
 ++;

97 ià(
	gnsize
 > 
	gnÿ·c™y
) {

98 ià(
	gex‹nsiÚs
 =ğ
NULL
è
ex‹nsiÚs
 = 
Ãw
 
¡d
::
veùÜ
<
T
>();

99 
	gex‹nsiÚs
->
push_back
(
v®
);

101 
	gd©a
[
nsize
 - 1] = 
v®
;

107 
T
 
g‘
(
idx
) {

108 ià(
	gidx
 >ğ
nÿ·c™y
) {

109  (* 
ex‹nsiÚs
)[
idx
 - ()
nÿ·c™y
];

111  
	gd©a
[
idx
];

115 
»move
(
idx
) {

116 
as£¹
(
çl£
);

119 
fšd
(
T
 
v®
) {

120 
as£¹
(
çl£
);

124 
ş—r
() {

125 
	gnsize
 = 0;

	@src/api/functional/functional_api.hpp

33 #iâdeà
GRAPHCHI_FUNCTIONALAPI_DEF


34 
	#GRAPHCHI_FUNCTIONALAPI_DEF


	)

36 
	~<as£¹.h
>

38 
	~"­i/g¿ph_objeùs.hµ
"

39 
	~"­i/g¿phchi_cÚ‹xt.hµ
"

40 
	~"’gše/funùiÚ®/funùiÚ®_’gše.hµ
"

41 
	~"m‘rics/m‘rics.hµ
"

42 
	~"g¿phchi_ty³s.hµ
"

44 
	~"­i/funùiÚ®/funùiÚ®_defs.hµ
"

45 
	~"­i/funùiÚ®/funùiÚ®_£misync.hµ
"

46 
	~"­i/funùiÚ®/funùiÚ®_bulksync.hµ
"

47 
	~"´•roûssšg/cÚv”siÚs.hµ
"

49 
Çme¥aû
 
	gg¿phchi
 {

54 
	g‹m¶©e
 <
ty³Çme
 
	gFV”‹xD©aTy³
,y³Çm
	gFEdgeD©aTy³
>

55 
	sfunùiÚ®_k”Ãl
 {

57 
FV”‹xD©aTy³
 
	tV”‹xD©aTy³
;

58 
FEdgeD©aTy³
 
	tEdgeD©aTy³
;

60 
funùiÚ®_k”Ãl
() {}

63 
vœtu®
 
V”‹xD©aTy³
 
š™Ÿl_v®ue
(
g¿phchi_cÚ‹xt
 &
šfo
, 
v”‹x_šfo
& 
myv”‹x
) = 0;

65 
vœtu®
 
V”‹xD©aTy³
 
»£t
() = 0;

68 
vœtu®
 
EdgeD©aTy³
 
İ_ÃighbÜv®
(
g¿phchi_cÚ‹xt
 &
šfo
, 
v”‹x_šfo
& 
myv”‹x
, 
vid_t
 
nbid
, EdgeD©aTy³ 
nbv®
)= 0;

70 
vœtu®
 
EdgeD©aTy³
 
¶us
(
V”‹xD©aTy³
 
curv®
, EdgeD©aTy³ 
tßdd
) = 0;

72 
vœtu®
 
V”‹xD©aTy³
 
compu‹_v”‹xv®ue
(
g¿phchi_cÚ‹xt
 &
gšfo
, 
v”‹x_šfo
& 
myv”‹x
, 
EdgeD©aTy³
 
nbv®sum
) = 0;

74 
vœtu®
 
EdgeD©aTy³
 
v®ue_to_ÃighbÜ
(
g¿phchi_cÚ‹xt
 &
šfo
, 
v”‹x_šfo
& 
myv”‹x
, 
vid_t
 
nbid
, 
V”‹xD©aTy³
 
myv®
) = 0;

93 
	g‹m¶©e
 <
şass
 
	gKERNEL
>

94 
run_funùiÚ®_unweigh‹d_£misynchrÚous
(
¡d
::
¡ršg
 
f’ame
, 
n™”s
, 
m‘rics
 &
_m
) {

95 
	gFunùiÚ®Prog¿mProxySemisync
<
	gKERNEL
> 
	g´og¿m
;

98 
	gnsh¬ds


99 ğ
cÚv”t_if_nÙexi¡s
<
ty³Çme
 
FunùiÚ®Prog¿mProxySemisync
<
KERNEL
>::
EdgeD©aTy³
>(
f’ame
, 
g‘_İtiÚ_¡ršg
("nshards", "auto"));

100 
	gfunùiÚ®_’gše
<
ty³Çme
 
	gFunùiÚ®Prog¿mProxySemisync
<
	gKERNEL
>::
V”‹xD©aTy³
,

101 
ty³Çme
 
	gFunùiÚ®Prog¿mProxySemisync
<
	gKERNEL
>::
EdgeD©aTy³
,

102 
ty³Çme
 
	gFunùiÚ®Prog¿mProxySemisync
<
	gKERNEL
>::
fv”‹x_t
 >

103 
’gše
(
f’ame
, 
nsh¬ds
, 
çl£
, 
_m
);

106 
	g’gše
.
£t_modif›s_šedges
(
çl£
);

107 
	g’gše
.
£t_modif›s_ou‹dges
(
Œue
);

108 
	g’gše
.
run
(
´og¿m
, 
n™”s
);

122 
	g‹m¶©e
 <
şass
 
	gKERNEL
>

123 
run_funùiÚ®_unweigh‹d_synchrÚous
(
¡d
::
¡ršg
 
f’ame
, 
n™”s
, 
m‘rics
 &
_m
) {

124 
	gFunùiÚ®Prog¿mProxyBulkSync
<
	gKERNEL
> 
	g´og¿m
;

125 
	gnsh¬ds


126 ğ
cÚv”t_if_nÙexi¡s
<
ty³Çme
 
FunùiÚ®Prog¿mProxyBulkSync
<
KERNEL
>::
EdgeD©aTy³
>(
f’ame
, 
g‘_İtiÚ_¡ršg
("nshards", "auto"));

127 
	gfunùiÚ®_’gše
<
ty³Çme
 
	gFunùiÚ®Prog¿mProxyBulkSync
<
	gKERNEL
>::
V”‹xD©aTy³
,

128 
ty³Çme
 
	gFunùiÚ®Prog¿mProxyBulkSync
<
	gKERNEL
>::
EdgeD©aTy³
,

129 
ty³Çme
 
	gFunùiÚ®Prog¿mProxyBulkSync
<
	gKERNEL
>::
fv”‹x_t
 >

130 
’gše
(
f’ame
, 
nsh¬ds
, 
çl£
, 
_m
);

131 
	g’gše
.
£t_modif›s_šedges
(
çl£
);

132 
	g’gše
.
£t_modif›s_ou‹dges
(
Œue
);

133 
	g’gše
.
£t_’abË_d‘”mši¡ic_·¿Î–ism
(
çl£
);

134 
	g’gše
.
run
(
´og¿m
, 
n™”s
);

	@src/api/functional/functional_bulksync.hpp

35 #iâdeà
GRAPHCHI_FUNCTIONAL_BULKSYNC_DEF


36 
	#GRAPHCHI_FUNCTIONAL_BULKSYNC_DEF


	)

38 
	~<as£¹.h
>

41 
	~"­i/g¿ph_objeùs.hµ
"

42 
	~"­i/g¿phchi_cÚ‹xt.hµ
"

43 
	~"­i/funùiÚ®/funùiÚ®_defs.hµ
"

45 
	~"m‘rics/m‘rics.hµ
"

46 
	~"g¿phchi_ty³s.hµ
"

48 
Çme¥aû
 
	gg¿phchi
 {

50 
	g‹m¶©e
 <
ty³Çme
 
	gKERNEL
>

51 
şass
 
	gfunùiÚ®_v”‹x_unweigh‹d_bulksync
 : 
public
 
g¿phchi_v”‹x
<
ty³Çme
 
KERNEL
::
V”‹xD©aTy³
, 
	gPaœCÚš”
<ty³Çm
	gKERNEL
::
EdgeD©aTy³
> > {

52 
public
:

54 
ty³Çme
 
	tKERNEL
::
	tV”‹xD©aTy³
 
	tVT
;

55 
	gPaœCÚš”
<
	tty³Çme
 
	tKERNEL
::
	tEdgeD©aTy³
> 
	tET
;

57 
KERNEL
 
	gk”Ãl
;

59 
VT
 
	gcumv®
;

61 
v”‹x_šfo
 
	gvšfo
;

62 
g¿phchi_cÚ‹xt
 * 
	ggcÚ‹xt
;

64 
funùiÚ®_v”‹x_unweigh‹d_bulksync
(è: 
g¿phchi_v”‹x
<
VT
, 
	gET
> () {}

66 
funùiÚ®_v”‹x_unweigh‹d_bulksync
(
g¿phchi_cÚ‹xt
 &
gšfo
, 
vid_t
 
_id
, 
šdeg
, 
outdeg
) :

67 
g¿phchi_v”‹x
<
VT
, 
	gET
> (
	g_id
, 
	gNULL
, NULL, 
	gšdeg
, 
	goutdeg
) {

68 
	gvšfo
.
	gšdeg»e
 = 
šdeg
;

69 
	gvšfo
.
	goutdeg»e
 = 
outdeg
;

70 
	gvšfo
.
	gv”‹xid
 = 
_id
;

71 
	gcumv®
 = 
k”Ãl
.
»£t
();

72 
	ggcÚ‹xt
 = &
gšfo
;

75 
funùiÚ®_v”‹x_unweigh‹d_bulksync
(
vid_t
 
_id
,

76 
g¿phchi_edge
<
ET
> * 
Œ
,

77 
g¿phchi_edge
<
ET
> * 
İŒ
,

78 
šdeg
,

79 
outdeg
) {

80 
as£¹
(
çl£
);

83 
fœ¡_™”©iÚ
(
g¿phchi_cÚ‹xt
 &
gšfo
) {

84 
	gthis
->
£t_d©a
(
k”Ãl
.
š™Ÿl_v®ue
(
gšfo
, 
všfo
));

85 
	ggcÚ‹xt
 = &
gšfo
;

90 
šlše
 
add_šedge
(
vid_t
 
¤c
, 
ET
 * 
±r
, 
boŞ
 
¥ecŸl_edge
) {

91 ià(
	ggcÚ‹xt
->
	g™”©iÚ
 > 0) {

92 
	gcumv®
 = 
k”Ãl
.
¶us
(
cumv®
, k”Ãl.
İ_ÃighbÜv®
(*
gcÚ‹xt
,

93 
všfo
,

94 
¤c
,

95 
±r
->
Şdv®
(
gcÚ‹xt
->
™”©iÚ
)));

99 
»ady
(
g¿phchi_cÚ‹xt
 &
gšfo
) {

100 
	gthis
->
£t_d©a
(
k”Ãl
.
compu‹_v”‹xv®ue
(*
gcÚ‹xt
, 
všfo
, 
cumv®
));

103 
šlše
 
add_ou‹dge
(
vid_t
 
d¡
, 
ET
 * 
±r
, 
boŞ
 
¥ecŸl_edge
) {

104 
ty³Çme
 
	gKERNEL
::
EdgeD©aTy³
 
Ãwv®
 =

105 
k”Ãl
.
v®ue_to_ÃighbÜ
(*
gcÚ‹xt
, 
všfo
, 
d¡
, 
this
->
g‘_d©a
());

106 
ET
 
	g·œcÚt
 = *
±r
;

107 
	g·œcÚt
.
£t_Ãwv®
(
gcÚ‹xt
->
™”©iÚ
, 
Ãwv®
);

108 *
	g±r
 = 
·œcÚt
;

111 
boŞ
 
computiÚ®_edges
() {

112  
	gŒue
;

119 
boŞ
 
»ad_ou‹dges
() {

120  
	gŒue
;

126 
	g‹m¶©e
 <
ty³Çme
 
	gKERNEL
>

127 
şass
 
	gFunùiÚ®Prog¿mProxyBulkSync
 : 
public
 
G¿phChiProg¿m
<
ty³Çme
 
KERNEL
::
V”‹xD©aTy³
, 
	gPaœCÚš”
<ty³Çm
	gKERNEL
::
EdgeD©aTy³
>, 
	gfunùiÚ®_v”‹x_unweigh‹d_bulksync
<KERNEL> > {

128 
	gpublic
:

130 
ty³Çme
 
	tKERNEL
::
	tV”‹xD©aTy³
 VertexDataType;

131 
	gPaœCÚš”
<
	tty³Çme
 
	tKERNEL
::
	tEdgeD©aTy³
> EdgeDataType;

132 
	gfunùiÚ®_v”‹x_unweigh‹d_bulksync
<
	tKERNEL
> 
	tfv”‹x_t
;

137 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
šfo
) {

143 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

149 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

156 
upd©e
(
fv”‹x_t
 &
v
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

157 ià(
	ggšfo
.
	g™”©iÚ
 == 0) {

158 
v
.
fœ¡_™”©iÚ
(
gšfo
);

160 
	gv
.
»ady
(
gšfo
);

	@src/api/functional/functional_defs.hpp

27 #iâdeà
GRAPHCHI_FUNCTIONALDEFS_DEF


28 
	#GRAPHCHI_FUNCTIONALDEFS_DEF


	)

30 
	~"­i/g¿phchi_´og¿m.hµ
"

32 
Çme¥aû
 
	gg¿phchi
 {

34 
	sv”‹x_šfo
 {

35 
vid_t
 
	gv”‹xid
;

36 
	gšdeg»e
;

37 
	goutdeg»e
;

	@src/api/functional/functional_semisync.hpp

29 #iâdeà
GRAPHCHI_FUNCTIONAL_SEMISYNC_DEF


30 
	#GRAPHCHI_FUNCTIONAL_SEMISYNC_DEF


	)

32 
	~<as£¹.h
>

35 
	~"­i/g¿ph_objeùs.hµ
"

36 
	~"­i/g¿phchi_cÚ‹xt.hµ
"

37 
	~"­i/funùiÚ®/funùiÚ®_defs.hµ
"

39 
	~"m‘rics/m‘rics.hµ
"

40 
	~"g¿phchi_ty³s.hµ
"

42 
Çme¥aû
 
	gg¿phchi
 {

44 
	g‹m¶©e
 <
ty³Çme
 
	gKERNEL
>

45 
şass
 
	gfunùiÚ®_v”‹x_unweigh‹d_£misync
 : 
public
 
g¿phchi_v”‹x
<
ty³Çme
 
KERNEL
::
V”‹xD©aTy³
,y³Çm
	gKERNEL
::
EdgeD©aTy³
> {

46 
public
:

48 
ty³Çme
 
	tKERNEL
::
	tV”‹xD©aTy³
 
	tVT
;

49 
ty³Çme
 
	tKERNEL
::
	tEdgeD©aTy³
 
	tET
;

51 
VT
 
	gcumv®
;

53 
KERNEL
 
	gk”Ãl
;

54 
v”‹x_šfo
 
	gvšfo
;

55 
g¿phchi_cÚ‹xt
 * 
	ggcÚ‹xt
;

57 
funùiÚ®_v”‹x_unweigh‹d_£misync
(è: 
g¿phchi_v”‹x
<
VT
, 
	gET
> () {}

59 
funùiÚ®_v”‹x_unweigh‹d_£misync
(
g¿phchi_cÚ‹xt
 &
gšfo
, 
vid_t
 
_id
, 
šdeg
, 
outdeg
) :

60 
g¿phchi_v”‹x
<
VT
, 
	gET
> (
	g_id
, 
	gNULL
, NULL, 
	gšdeg
, 
	goutdeg
) {

61 
	gvšfo
.
	gšdeg»e
 = 
šdeg
;

62 
	gvšfo
.
	goutdeg»e
 = 
outdeg
;

63 
	gvšfo
.
	gv”‹xid
 = 
_id
;

64 
	gcumv®
 = 
k”Ãl
.
»£t
();

65 
	ggcÚ‹xt
 = &
gšfo
;

68 
funùiÚ®_v”‹x_unweigh‹d_£misync
(
vid_t
 
_id
,

69 
g¿phchi_edge
<
ET
> * 
Œ
,

70 
g¿phchi_edge
<
ET
> * 
İŒ
,

71 
šdeg
,

72 
outdeg
) {

73 
as£¹
(
çl£
);

76 
fœ¡_™”©iÚ
(
g¿phchi_cÚ‹xt
 &
gcÚ‹xt_
) {

77 
	gthis
->
£t_d©a
(
k”Ãl
.
š™Ÿl_v®ue
(
gcÚ‹xt_
, 
všfo
));

82 
šlše
 
add_šedge
(
vid_t
 
¤c
, 
ET
 * 
±r
, 
boŞ
 
¥ecŸl_edge
) {

83 ià(
	ggcÚ‹xt
->
	g™”©iÚ
 > 0) {

84 
	gcumv®
 = 
k”Ãl
.
¶us
(
cumv®
, k”Ãl.
İ_ÃighbÜv®
(*
gcÚ‹xt
, 
všfo
, 
¤c
, *
±r
));

88 
»ady
(
g¿phchi_cÚ‹xt
 &
gcÚ‹xt_
) {

89 
	gthis
->
£t_d©a
(
k”Ãl
.
compu‹_v”‹xv®ue
(
gcÚ‹xt_
, 
všfo
, 
cumv®
));

92 
šlše
 
add_ou‹dge
(
vid_t
 
d¡
, 
ET
 * 
±r
, 
boŞ
 
¥ecŸl_edge
) {

93 *
	g±r
 = 
k”Ãl
.
v®ue_to_ÃighbÜ
(*
gcÚ‹xt
, 
všfo
, 
d¡
, 
this
->
g‘_d©a
());

96 
boŞ
 
computiÚ®_edges
() {

97  
	gŒue
;

101 
boŞ
 
»ad_ou‹dges
() {

102  
	gçl£
;

110 
	g‹m¶©e
 <
ty³Çme
 
	gKERNEL
>

111 
şass
 
	gFunùiÚ®Prog¿mProxySemisync
 : 
public
 
G¿phChiProg¿m
<
ty³Çme
 
KERNEL
::
V”‹xD©aTy³
,y³Çm
	gKERNEL
::
EdgeD©aTy³
, 
	gfunùiÚ®_v”‹x_unweigh‹d_£misync
<KERNEL> > {

112 
	gpublic
:

113 
ty³Çme
 
	tKERNEL
::
	tV”‹xD©aTy³
 VertexDataType;

114 
ty³Çme
 
	tKERNEL
::
	tEdgeD©aTy³
 EdgeDataType;

115 
	gfunùiÚ®_v”‹x_unweigh‹d_£misync
<
	tKERNEL
> 
	tfv”‹x_t
;

120 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
šfo
) {

126 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

132 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

138 
upd©e
(
fv”‹x_t
 &
v
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

139 ià(
	ggšfo
.
	g™”©iÚ
 == 0) {

140 
v
.
fœ¡_™”©iÚ
(
gšfo
);

142 
	gv
.
»ady
(
gšfo
);

	@src/api/graph_objects.hpp

30 #iâdeà
DEF_GRAPHCHI_OBJECTS


31 
	#DEF_GRAPHCHI_OBJECTS


	)

33 
	~<veùÜ
>

34 
	~<as£¹.h
>

35 
	~<omp.h
>

36 
	~<¡ršg.h
>

38 
	~"g¿phchi_ty³s.hµ
"

39 
	~"ut/qsÜt.hµ
"

41 
Çme¥aû
 
	gg¿phchi
 {

47 #ifdeà
__GNUC__


48 
	#VARIABLE_IS_NOT_USED
 
	`__©Œibu‹__
 ((
unu£d
))

	)

50 
	#VARIABLE_IS_NOT_USED


	)

55 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

56 şas 
	cg¿phchi_edge
 {

58 
	gpublic
:

59 
vid_t
 
v”‹xid
;

60 
EdgeD©aTy³
 * 
	gd©a_±r
;

62 
g¿phchi_edge
() {}

63 
g¿phchi_edge
(
vid_t
 
_v”‹xid
, 
EdgeD©aTy³
 * 
ed©a_±r
è: 
v”‹xid
(_v”‹xid), 
d©a_±r
(edata_ptr) {

66 #iâdeà
DYNAMICEDATA


67 
EdgeD©aTy³
 
g‘_d©a
() {

68  * 
	gd©a_±r
;

71 
£t_d©a
(
EdgeD©aTy³
 
x
) {

72 *
	gd©a_±r
 = 
x
;

75 
EdgeD©aTy³
 * 
g‘_veùÜ
() {

76  
	gd©a_±r
;

83 
vid_t
 
v”‹x_id
() {

84  
	gv”‹xid
;

88 } 
__©Œibu‹__
((
·cked
));

90 
	g‹m¶©e
 <
ty³Çme
 
	gET
>

91 
boŞ
 
•Œ_Ëss
(cÚ¡ 
g¿phchi_edge
<
ET
> &
a
, cÚ¡ g¿phchi_edge<ET> &
b
) {

92  
	ga
.
	gv”‹xid
 < 
	gb
.vertexid;

96 #ifdeà
SUPPORT_DELETIONS


106 
šlše
 
boŞ
 
VARIABLE_IS_NOT_USED
 
is_d–‘ed_edge_v®ue
(
v®
);

107 
šlše
 
boŞ
 
VARIABLE_IS_NOT_USED
 
	$is_d–‘ed_edge_v®ue
(
boŞ
 
v®
) {

108  
v®
;

109 
	}
}

111 
šlše
 
boŞ
 
VARIABLE_IS_NOT_USED
 
is_d–‘ed_edge_v®ue
(
v®
);

112 
šlše
 
boŞ
 
VARIABLE_IS_NOT_USED
 
	$is_d–‘ed_edge_v®ue
(
v®
) {

113  0xfffffffà=ğ()
v®
;

114 
	}
}

116 
šlše
 
boŞ
 
VARIABLE_IS_NOT_USED
 
is_d–‘ed_edge_v®ue
(
vid_t
 
v®
);

117 
šlše
 
boŞ
 
VARIABLE_IS_NOT_USED
 
	$is_d–‘ed_edge_v®ue
(
vid_t
 
v®
) {

118  0xffffffffu =ğ
v®
;

119 
	}
}

122 
šlše
 
boŞ
 
VARIABLE_IS_NOT_USED
 
is_d–‘ed_edge_v®ue
(
v®
);

123 
šlše
 
boŞ
 
VARIABLE_IS_NOT_USED
 
	$is_d–‘ed_edge_v®ue
(
v®
) {

124  !(
v®
 < 0 || val > 0);

125 
	}
}

127 
VARIABLE_IS_NOT_USED
 
»move_edgev
(
g¿phchi_edge
<
boŞ
> * 
e
);

128 
VARIABLE_IS_NOT_USED
 
»move_edgev
(
g¿phchi_edge
<
boŞ
> * 
e
) {

129 
	ge
->
£t_d©a
(
Œue
);

132 
VARIABLE_IS_NOT_USED
 
»move_edgev
(
g¿phchi_edge
<
vid_t
> * 
e
);

133 
VARIABLE_IS_NOT_USED
 
»move_edgev
(
g¿phchi_edge
<
vid_t
> * 
e
) {

134 
	ge
->
£t_d©a
(0xffffffff);

137 
VARIABLE_IS_NOT_USED
 
»move_edgev
(
g¿phchi_edge
<> * 
e
);

138 
VARIABLE_IS_NOT_USED
 
»move_edgev
(
g¿phchi_edge
<> * 
e
) {

139 
	ge
->
£t_d©a
(0xffffffff);

145 
	g‹m¶©e
 <
ty³Çme
 
	gV”‹xD©aTy³
,y³Çm
	gEdgeD©aTy³
>

146 şas 
	cš‹º®_g¿phchi_v”‹x
 {

148 
	gpublic
:

149 
šc
;

150 vŞ©
	goutc
;

152 
vid_t
 
	gv”‹xid
;

154 
	g´Ùeùed
:

155 
g¿phchi_edge
<
EdgeD©aTy³
> * 
šedges_±r
;

156 
	gg¿phchi_edge
<
	gEdgeD©aTy³
> * 
	gou‹dges_±r
;

159 
	gpublic
:

160 
boŞ
 
modif›d
;

161 
V”‹xD©aTy³
 * 
	gd©­Œ
;

165 
boŞ
 
	gscheduËd
;

166 
boŞ
 
	g·¿Î–_§ã
;

168 #ifdeà
SUPPORT_DELETIONS


169 
	gd–‘ed_šc
;

170 
	gd–‘ed_outc
;

174 
š‹º®_g¿phchi_v”‹x
(è: 
šc
(0), 
outc
(0) {

175 #ifdeà
SUPPORT_DELETIONS


176 
	gd–‘ed_outc
 = 
d–‘ed_šc
 = 0;

178 
	gd©­Œ
 = 
NULL
;

182 
š‹º®_g¿phchi_v”‹x
(
vid_t
 
_id
, 
g¿phchi_edge
<
EdgeD©aTy³
> * 
Œ
,

183 
g¿phchi_edge
<
EdgeD©aTy³
> * 
İŒ
,

184 
šdeg
,

185 
outdeg
) :

186 
v”‹xid
(
_id
), 
šedges_±r
(
Œ
), 
ou‹dges_±r
(
İŒ
) {

187 
	gšc
 = 0;

188 
	goutc
 = 0;

189 
	gscheduËd
 = 
çl£
;

190 
	gmodif›d
 = 
çl£
;

191 
	g·¿Î–_§ã
 = 
Œue
;

192 
	gd©­Œ
 = 
NULL
;

193 #ifdeà
SUPPORT_DELETIONS


194 
	gd–‘ed_šc
 = 0;

195 
	gd–‘ed_outc
 = 0;

199 
	gvœtu®
 ~
š‹º®_g¿phchi_v”‹x
() {}

202 
vid_t
 
id
() const {

203  
	gv”‹xid
;

206 
num_šedges
() const {

207  
	gšc
;

210 
num_ou‹dges
() const {

211  
	goutc
;

213 
num_edges
() const {

214  
	gšc
 + 
	goutc
;

222 
šlše
 
add_šedge
(
vid_t
 
¤c
, 
EdgeD©aTy³
 * 
±r
, 
boŞ
 
¥ecŸl_edge
) {

223 #ifdeà
SUPPORT_DELETIONS


224 ià(
	gšedges_±r
 !ğ
NULL
 && 
is_d–‘ed_edge_v®ue
(*
±r
)) {

225 
d–‘ed_šc
++;

229 ià(
	gšedges_±r
 !ğ
NULL
)

230 
šedges_±r
[
šc
] = 
g¿phchi_edge
<
EdgeD©aTy³
>(
¤c
, 
	g±r
);

231 
	gšc
++;

232 
as£¹
(
¤c
 !ğ
v”‹xid
);

239 
šlše
 
add_ou‹dge
(
vid_t
 
d¡
, 
EdgeD©aTy³
 * 
±r
, 
boŞ
 
¥ecŸl_edge
) {

240 #ifdeà
SUPPORT_DELETIONS


241 ià(
	gou‹dges_±r
 !ğ
NULL
 && 
is_d–‘ed_edge_v®ue
(*
±r
)) {

242 
d–‘ed_outc
++;

246 
	gi
 = 
__sync_add_ªd_ãtch
(&
outc
, 1);

247 ià(
	gou‹dges_±r
 !ğ
NULL
è
ou‹dges_±r
[
i
-1] = 
g¿phchi_edge
<
EdgeD©aTy³
>(
d¡
, 
	g±r
);

248 
as£¹
(
d¡
 !ğ
v”‹xid
);

254 
	g‹m¶©e
 <
ty³Çme
 
	gV”‹xD©aTy³
,y³Çm
	gEdgeD©aTy³
 >

255 
şass
 
	gg¿phchi_v”‹x
 : 
public
 
š‹º®_g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

257 
	gpublic
:

259 
g¿phchi_v”‹x
(è: 
š‹º®_g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
>() { }

261 
g¿phchi_v”‹x
(
vid_t
 
_id
,

262 
g¿phchi_edge
<
EdgeD©aTy³
> * 
Œ
,

263 
g¿phchi_edge
<
EdgeD©aTy³
> * 
İŒ
,

264 
šdeg
,

265 
outdeg
) :

266 
š‹º®_g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
>(
	g_id
, 
	gŒ
, 
	gİŒ
, 
	gšdeg
, 
	goutdeg
) {}

268 
	gvœtu®
 ~
g¿phchi_v”‹x
() {}

274 
	gg¿phchi_edge
<
	gEdgeD©aTy³
> * 
edge
(
i
) {

275 ià(
	gi
 < 
	gthis
->
	gšc
è 
šedge
(
i
);

276  
ou‹dge
(
i
 - 
this
->
šc
);

280 
	gg¿phchi_edge
<
	gEdgeD©aTy³
> * 
šedge
(
i
) {

281 
as£¹
(
i
 >ğ0 && i < 
this
->
šc
);

282  &
	gthis
->
	gšedges_±r
[
i
];

285 
	gg¿phchi_edge
<
	gEdgeD©aTy³
> * 
ou‹dge
(
i
) {

286 
as£¹
(
i
 >ğ0 && i < 
this
->
outc
);

287  &
	gthis
->
	gou‹dges_±r
[
i
];

290 
	gg¿phchi_edge
<
	gEdgeD©aTy³
> * 
¿ndom_ou‹dge
() {

291 ià(
	gthis
->
	goutc
 =ğ0è 
NULL
;

292  
ou‹dge
((è(
¡d
::
abs
(
¿ndom
()è% 
this
->
outc
));

298 #iâdeà
DYNAMICVERTEXDATA


299 
V”‹xD©aTy³
 
g‘_d©a
() {

300  *(
	gthis
->
	gd©­Œ
);

304 
V”‹xD©aTy³
 * 
g‘_veùÜ
() {

305 
	gthis
->
	gmodif›d
 = 
Œue
;

306  
	gthis
->
	gd©­Œ
;

314 
vœtu®
 
£t_d©a
(
V”‹xD©aTy³
 
d
) {

315 *(
	gthis
->
	gd©­Œ
èğ
d
;

316 
	gthis
->
	gmodif›d
 = 
Œue
;

320 
boŞ
 
computiÚ®_edges
() {

321  
	gçl£
;

323 
boŞ
 
»ad_ou‹dges
() {

324  
	gŒue
;

333 
VARIABLE_IS_NOT_USED
 
sÜt_edges_šdœeù
() {

335 ià(
	gthis
->
	gšc
 !ğ(
this
->
ou‹dges_±r
 -his->
šedges_±r
)) {

337 
memmove
(&
this
->
šedges_±r
[this->
šc
],his->
ou‹dges_±r
,his->
outc
 * (
g¿phchi_edge
<
EdgeD©aTy³
>));

338 
	gthis
->
	gou‹dges_±r
 = &
this
->
šedges_±r
[this->
šc
];

340 
quickSÜt
(
this
->
šedges_±r
, (èÑhis->
šc
 +his->
outc
), 
•Œ_Ëss
<
EdgeD©aTy³
>);

345 #ifdeà
SUPPORT_DELETIONS


346 
VARIABLE_IS_NOT_USED
 
»move_edge
(
i
) {

347 
»move_edgev
(
edge
(
i
));

350 
VARIABLE_IS_NOT_USED
 
»move_šedge
(
i
) {

351 
»move_edgev
(
šedge
(
i
));

354 
VARIABLE_IS_NOT_USED
 
»move_ou‹dge
(
i
) {

355 
»move_edgev
(
ou‹dge
(
i
));

369 
	#HIGHMASK
 (1 + (2147483647 >> 1))

	)

370 
	#CLEARMASK
 (2147483647 >> 1)

	)

371 
šlše
 
vid_t
 
	$Œª¦©e_edge
(
vid_t
 
¿wid
, 
boŞ
 &
is_¥ecŸl
) {

372 
is_¥ecŸl
 = (
¿wid
 & 
HIGHMASK
) != 0;

373  
¿wid
 & 
CLEARMASK
;

374 
	}
}

375 
šlše
 
vid_t
 
	$make_¥ecŸl
(
vid_t
 
¿wid
) {

376  
¿wid
 | 
HIGHMASK
;

377 
	}
}

378 
šlše
 
boŞ
 
	$is_¥ecŸl
(
vid_t
 
¿wid
) {

379  (
¿wid
 & 
HIGHMASK
) != 0;

380 
	}
}

	@src/api/graphchi_context.hpp

32 #iâdeà
DEF_GRAPHCHI_CONTEXT


33 
	#DEF_GRAPHCHI_CONTEXT


	)

35 
	~<veùÜ
>

36 
	~<as£¹.h
>

37 
	~<omp.h
>

38 
	~<sys/time.h
>

40 
	~"g¿phchi_ty³s.hµ
"

41 
	~"­i/ischeduËr.hµ
"

43 
Çme¥aû
 
	gg¿phchi
 {

45 
	sg¿phchi_cÚ‹xt
 {

47 
size_t
 
	gnv”tiûs
;

48 
size_t
 
	gÃdges
;

50 
ischeduËr
 * 
	gscheduËr
;

51 
	g™”©iÚ
;

52 
	gnum_™”©iÚs
;

53 
	gÏ¡_™”©iÚ
;

54 
	gexeùh»ads
;

55 
	g¡d
::
veùÜ
<> 
d–s
;

56 
timev®
 
	g¡¬t
;

57 
	g¡d
::
¡ršg
 
f’ame
;

58 
	gÏ¡_d–sum
;

60 
g¿phchi_cÚ‹xt
(è: 
scheduËr
(
NULL
), 
™”©iÚ
(0), 
Ï¡_™”©iÚ
(-1) {

61 
g‘timeofday
(&
¡¬t
, 
NULL
);

62 
	gÏ¡_d–sum
 = 0.0;

65 
ruÁime
() {

66 
timev®
 
	g’d
;

67 
g‘timeofday
(&
’d
, 
NULL
);

68  
	g’d
.
	gtv_£c
-
	g¡¬t
.tv_£c+ (()Ónd.
	gtv_u£c
-start.tv_usec))/1.0E6;

74 
£t_Ï¡_™”©iÚ
(
_Ï¡_™”©iÚ
) {

75 
	gÏ¡_™”©iÚ
 = 
_Ï¡_™”©iÚ
;

78 
»£t_d–s
(
Áh»ads
) {

79 
	gd–s
 = 
¡d
::
veùÜ
<>(
Áh»ads
, 0.0);

82 
g‘_d–
() {

83 
	gd
 = 0.0;

84 
	gi
=0; i < ()
	gd–s
.
size
(); i++) {

85 
	gd
 +ğ
d–s
[
i
];

87 
	gÏ¡_d–sum
 = 
d
;

88  
	gd
;

91 
šlše
 
boŞ
 
i¢ª
(
x
) {

92  !(
	gx
<0 || x>=0);

101 
log_chªge
(
d–
) {

102 
	gd–s
[
omp_g‘_th»ad_num
()] +ğ
d–
;

103 
as£¹
(
d–
 >= 0);

104 
as£¹
(!
i¢ª
(
d–
));

	@src/api/graphchi_program.hpp

32 #iâdeà
GRAPHCHI_PROGRAM_DEF


33 
	#GRAPHCHI_PROGRAM_DEF


	)

35 
	~"­i/g¿ph_objeùs.hµ
"

36 
	~"­i/g¿phchi_cÚ‹xt.hµ
"

38 
Çme¥aû
 
	gg¿phchi
 {

40 
	g‹m¶©e
 <
ty³Çme
 
	gV”‹xD©aTy³_
,y³Çm
	gEdgeD©aTy³_
,

41 
ty³Çme
 
	gv”‹x_t
 = 
g¿phchi_v”‹x
<
V”‹xD©aTy³_
, 
	gEdgeD©aTy³_
> >

42 şas 
	cG¿phChiProg¿m
 {

44 
	gpublic
:

45 
V”‹xD©aTy³_
 
	tV”‹xD©aTy³
;

46 
EdgeD©aTy³_
 
	tEdgeD©aTy³
;

48 
	gvœtu®
 ~
G¿phChiProg¿m
() {}

53 
vœtu®
 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

59 
vœtu®
 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

65 
vœtu®
 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

71 
vœtu®
 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

77 
vœtu®
 
upd©e
(
v”‹x_t
 &
v
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) = 0;

	@src/api/graphlab2_1_GAS_api/assertions.hpp

58 #iâdeà
_ASSERTIONS_H_


59 
	#_ASSERTIONS_H_


	)

61 
	~<¡d¬g.h
>

62 
	~<¡dlib.h
>

63 
	~<¡dio.h
>

64 #ifdeà
HAVE_UNISTD_H


65 
	~<uni¡d.h
>

67 
	~<¡ršg.h
>

68 
	~<as£¹.h
>

69 
	~<”ºo.h
>

70 
	~<s¡»am
>

71 
	~<ÿs£¹
>

73 
	~"logg”/logg”.hµ
"

74 
	~<boo¡/ty³of/ty³of.hµ
>

76 
	$__´št_back_Œaû
() {

77 
	`log¡»am
(
LOG_ERROR
è<< "G¿phCh˜dÛ nÙ cu¼’y havth_´št_back_Œaû im¶em’tiÚ!" << 
¡d
::
’dl
;

78 
	}
}

84 
	#WRITE_TO_STDERR
(
buf
, 
Ën
è(
	`logbuf
(
LOG_FATAL
, buf,†’))

	)

90 
	#CHECK
(
cÚd™iÚ
) \

92 ià(
	`__butš_ex³ù
(!(
cÚd™iÚ
), 0)) { \

93 
	`log¡»am
(
LOG_ERROR
) \

94 << "Check faed: " << #cÚd™iÚ << 
¡d
::
’dl
; \

95 
	`__´št_back_Œaû
(); \

96 
	`throw
("assertion failure"); \

98 } 0)

	)

103 
	#PCHECK
(
cÚd™iÚ
) \

105 ià(
	`__butš_ex³ù
(!(
cÚd™iÚ
), 0)) { \

106 cÚ¡ 
_PCHECK_”r_no_
 = 
”ºo
; \

107 
	`log¡»am
(
LOG_ERROR
) \

109 << 
	`¡»¼Ü
(
”r_no
è<< 
¡d
::
’dl
; \

110 
	`__´št_back_Œaû
(); \

111 
	`throw
("assertion failure"); \

113 } 0)

	)

121 
	#CHECK_OP
(
İ
, 
v®1
, 
v®2
) \

123 cÚ¡ 
	`ty³of
(
v®1
è
_CHECK_OP_v1_
 = val1; \

124 cÚ¡ 
	`ty³of
(
v®2
è
_CHECK_OP_v2_
 = (typeof(val2))val2; \

125 ià(
	`__butš_ex³ù
(!((
_CHECK_OP_v1_
è
İ
 \

126 (
	`ty³of
(
v®1
))(
_CHECK_OP_v2_
)), 0)) { \

127 
	`log¡»am
(
LOG_ERROR
) \

131 << 
_CHECK_OP_v1_
 \

133 << 
_CHECK_OP_v2_
 << "]" << 
¡d
::
’dl
; \

134 
	`__´št_back_Œaû
(); \

135 
	`throw
("assertion failure"); \

137 } 0)

	)

139 
	#CHECK_EQ
(
v®1
, 
v®2
è
	`CHECK_OP
(==, v®1, v®2)

	)

140 
	#CHECK_NE
(
v®1
, 
v®2
è
	`CHECK_OP
(!=, v®1, v®2)

	)

141 
	#CHECK_LE
(
v®1
, 
v®2
è
	`CHECK_OP
(<=, v®1, v®2)

	)

142 
	#CHECK_LT
(
v®1
, 
v®2
è
	`CHECK_OP
(< , v®1, v®2)

	)

143 
	#CHECK_GE
(
v®1
, 
v®2
è
	`CHECK_OP
(>=, v®1, v®2)

	)

144 
	#CHECK_GT
(
v®1
, 
v®2
è
	`CHECK_OP
(> , v®1, v®2)

	)

147 
	#EXPECT_EQ
(
v®1
, 
v®2
è
	`CHECK_EQ
(v®1, v®2)

	)

148 
	#EXPECT_NE
(
v®1
, 
v®2
è
	`CHECK_NE
(v®1, v®2)

	)

149 
	#EXPECT_LE
(
v®1
, 
v®2
è
	`CHECK_LE
(v®1, v®2)

	)

150 
	#EXPECT_LT
(
v®1
, 
v®2
è
	`CHECK_LT
(v®1, v®2)

	)

151 
	#EXPECT_GE
(
v®1
, 
v®2
è
	`CHECK_GE
(v®1, v®2)

	)

152 
	#EXPECT_GT
(
v®1
, 
v®2
è
	`CHECK_GT
(v®1, v®2)

	)

153 
	#ASSERT_EQ
(
v®1
, 
v®2
è
	`EXPECT_EQ
(v®1, v®2)

	)

154 
	#ASSERT_NE
(
v®1
, 
v®2
è
	`EXPECT_NE
(v®1, v®2)

	)

155 
	#ASSERT_LE
(
v®1
, 
v®2
è
	`EXPECT_LE
(v®1, v®2)

	)

156 
	#ASSERT_LT
(
v®1
, 
v®2
è
	`EXPECT_LT
(v®1, v®2)

	)

157 
	#ASSERT_GE
(
v®1
, 
v®2
è
	`EXPECT_GE
(v®1, v®2)

	)

158 
	#ASSERT_GT
(
v®1
, 
v®2
è
	`EXPECT_GT
(v®1, v®2)

	)

160 
	#EXPECT_TRUE
(
cÚd
è
	`CHECK
(cÚd)

	)

161 
	#EXPECT_FALSE
(
cÚd
è
	`CHECK
(!(cÚd))

	)

162 
	#EXPECT_STREQ
(
a
, 
b
è
	`CHECK
(
	`¡rcmp
×, bè=ğ0)

	)

163 
	#ASSERT_TRUE
(
cÚd
è
	`EXPECT_TRUE
(cÚd)

	)

164 
	#ASSERT_FALSE
(
cÚd
è
	`EXPECT_FALSE
(cÚd)

	)

165 
	#ASSERT_STREQ
(
a
, 
b
è
	`EXPECT_STREQ
×, b)

	)

168 
	#ASSERT_MSG
(
cÚd™iÚ
, 
fmt
, ...) \

170 ià(
	`__butš_ex³ù
(!(
cÚd™iÚ
), 0)) { \

171 
	`log¡»am
(
LOG_ERROR
) \

173 
	`logg”
(
LOG_ERROR
, 
fmt
, ##
__VA_ARGS__
); \

174 
	`__´št_back_Œaû
(); \

175 
	`throw
("assertion failure"); \

177 } 0)

	)

180 
	#CHECK_ERR
(
švoÿtiÚ
è
	`PCHECK
((švoÿtiÚè!ğ-1)

	)

183 #ifdeà
NDEBUG


184 
	#DCHECK_EQ
(
v®1
, 
v®2
)

	)

185 
	#DCHECK_NE
(
v®1
, 
v®2
)

	)

186 
	#DCHECK_LE
(
v®1
, 
v®2
)

	)

187 
	#DCHECK_LT
(
v®1
, 
v®2
)

	)

188 
	#DCHECK_GE
(
v®1
, 
v®2
)

	)

189 
	#DCHECK_GT
(
v®1
, 
v®2
)

	)

190 
	#DASSERT_TRUE
(
cÚd
)

	)

191 
	#DASSERT_FALSE
(
cÚd
)

	)

192 
	#DASSERT_MSG
(
cÚd™iÚ
, 
fmt
, ...)

	)

195 
	#DCHECK_EQ
(
v®1
, 
v®2
è
	`CHECK_EQ
(v®1, v®2)

	)

196 
	#DCHECK_NE
(
v®1
, 
v®2
è
	`CHECK_NE
(v®1, v®2)

	)

197 
	#DCHECK_LE
(
v®1
, 
v®2
è
	`CHECK_LE
(v®1, v®2)

	)

198 
	#DCHECK_LT
(
v®1
, 
v®2
è
	`CHECK_LT
(v®1, v®2)

	)

199 
	#DCHECK_GE
(
v®1
, 
v®2
è
	`CHECK_GE
(v®1, v®2)

	)

200 
	#DCHECK_GT
(
v®1
, 
v®2
è
	`CHECK_GT
(v®1, v®2)

	)

201 
	#DASSERT_TRUE
(
cÚd
è
	`ASSERT_TRUE
(cÚd)

	)

202 
	#DASSERT_FALSE
(
cÚd
è
	`ASSERT_FALSE
(cÚd)

	)

203 
	#DASSERT_MSG
(
cÚd™iÚ
, 
fmt
, ...) \

205 ià(
	`__butš_ex³ù
(!(
cÚd™iÚ
), 0)) { \

206 
	`log¡»am
(
LOG_ERROR
) \

208 
	`logg”
(
LOG_ERROR
, 
fmt
, ##
__VA_ARGS__
); \

209 
	`__´št_back_Œaû
(); \

210 
	`throw
("assertion failure"); \

212 } 0)

	)

217 #ifdeà
ERROR


218 #undeà
ERROR


	@src/api/graphlab2_1_GAS_api/graphchi_graphlabv2_1.hpp

29 #iâdeà
DEF_GRAPHLAB_WRAPPERS


30 
	#DEF_GRAPHLAB_WRAPPERS


	)

32 
	~"g¿phchi_basic_šşudes.hµ
"

34 
usšg
 
Çme¥aû
 
	gg¿phchi
;

37 
Çme¥aû
 
	gg¿phÏb
 {

39 
	sIS_POD_TYPE
 { };

40 
	sem±y
 {};

42 
	eedge_dœ_ty³
 {

48 
	gNO_EDGES
 = 0,

53 
	gIN_EDGES
 = 1,

58 
	gOUT_EDGES
 = 2 ,

65 
	gALL_EDGES
 = 3

69 
vid_t
 
	tv”‹x_id_ty³
;

71 
	g‹m¶©e
<
ty³Çme
 
	gG¿phTy³
,

72 
ty³Çme
 
	gG©h”Ty³
,

73 
ty³Çme
 
	gMes§geTy³
>

74 şas 
	cicÚ‹xt
 {

75 
	gpublic
:

81 
G¿phTy³
 
	tg¿ph_ty³
;

87 
ty³Çme
 
	tg¿ph_ty³
::
	tv”‹x_ty³
 vertex_type;

93 
ty³Çme
 
	tg¿ph_ty³
::
	tv”‹x_id_ty³
 vertex_id_type;

99 
Mes§geTy³
 
	tmes§ge_ty³
;

105 
G©h”Ty³
 
	tg©h”_ty³
;

108 
g¿phchi_cÚ‹xt
 * 
	ggcÚ‹xt
;

112 
	gpublic
:

114 
icÚ‹xt
(
g¿phchi_cÚ‹xt
 * 
gcÚ‹xt
) : gcontext(gcontext) {}

117 
vœtu®
 ~
icÚ‹xt
() { }

124 
vœtu®
 
size_t
 
num_v”tiûs
(ècÚ¡ {  
gcÚ‹xt
->
nv”tiûs
; }

133 
vœtu®
 
size_t
 
num_edges
(ècÚ¡ { 
as£¹
(
çl£
);  0; }

145 
vœtu®
 
size_t
 
´ocid
(ècÚ¡ {  (
	gsize_t
è
omp_g‘_th»ad_num
(); }

161 
vœtu®
 
	g¡d
::
o¡»am
& 
cout
(ècÚ¡ {  
¡d
::cout; }

177 
vœtu®
 
	g¡d
::
o¡»am
& 
û¼
(ècÚ¡ {  
¡d
::cerr; }

190 
vœtu®
 
size_t
 
num_´ocs
(ècÚ¡ {  
	ggcÚ‹xt
->
	gexeùh»ads
; }

197 
vœtu®
 
–­£d_£cÚds
(ècÚ¡ {  
	ggcÚ‹xt
->
ruÁime
(); }

205 
vœtu®
 
™”©iÚ
(ècÚ¡ {  
	ggcÚ‹xt
->
	g™”©iÚ
; }

217 
vœtu®
 
¡İ
() {

218 
	ggcÚ‹xt
->
	gÏ¡_™”©iÚ
 = 
gcÚ‹xt
->
™”©iÚ
;

239 
vœtu®
 
sigÇl
(cÚ¡ 
v”‹x_ty³
& 
v”‹x
,

240 cÚ¡ 
mes§ge_ty³
& 
mes§ge
 = message_type()) {

241 
gcÚ‹xt
->
scheduËr
->
add_sk
(
v”‹x
.
id
());

255 
vœtu®
 
sigÇl_vid
(
v”‹x_id_ty³
 
gvid
,

256 cÚ¡ 
mes§ge_ty³
& 
mes§ge
 = message_type()) {

257 
gcÚ‹xt
->
scheduËr
->
add_sk
(
gvid
);

284 
vœtu®
 
po¡_d–
(cÚ¡ 
v”‹x_ty³
& 
v”‹x
,

285 cÚ¡ 
g©h”_ty³
& 
d–
) {

286 
as£¹
(
çl£
);

297 
vœtu®
 
ş—r_g©h”_ÿche
(cÚ¡ 
v”‹x_ty³
& 
v”‹x
) {

298 
as£¹
(
çl£
);

305 
	g‹m¶©e
 <
ty³Çme
 
	gGLV”‹xD©aTy³
,y³Çm
	gEdgeD©aTy³
>

306 
	gG¿phLabV”‹xW¿µ”
;

308 
	g‹m¶©e
 <
ty³Çme
 
	gGLV”‹xD©aTy³
,y³Çm
	gEdgeD©aTy³
>

309 
	gG¿phLabEdgeW¿µ”
;

313 
	g‹m¶©e
 <
ty³Çme
 
	gv”‹x_d©a
,y³Çm
	gedge_d©a
>

314 
	sdi¡ribu‹d_g¿ph
 {

315 
v”‹x_d©a
 
	tv”‹x_d©a_ty³
;

316 
edge_d©a
 
	tedge_d©a_ty³
;

317 
	gG¿phLabV”‹xW¿µ”
<
	tv”‹x_d©a_ty³
, 
	tedge_d©a_ty³
> 
	tv”‹x_ty³
;

318 
	gG¿phLabEdgeW¿µ”
<
	tv”‹x_d©a_ty³
, 
	tedge_d©a_ty³
> 
	tedge_ty³
;

319 
	gg¿phchi
::
	tvid_t
 
	tv”‹x_id_ty³
;

324 
	g‹m¶©e
<
ty³Çme
 
	gG¿ph
,

325 
ty³Çme
 
	gG©h”Ty³
,y³Çm
	gMes§geTy³
 = 
boŞ
>

326 
	siv”‹x_´og¿m
 {

329 
ty³Çme
 
	tG¿ph
::
	tv”‹x_d©a_ty³
 vertex_data_type;

330 
ty³Çme
 
	tG¿ph
::
	tedge_d©a_ty³
ƒdge_data_type;

331 
G©h”Ty³
 
	tg©h”_ty³
;

332 
Mes§geTy³
 
	tmes§ge_ty³
;

334 
G¿ph
 
	tg¿ph_ty³
;

335 
ty³Çme
 
	tg¿phchi
::
	tvid_t
 
	tv”‹x_id_ty³
;

336 
	gG¿phLabV”‹xW¿µ”
<
	tv”‹x_d©a_ty³
, 
	tedge_d©a_ty³
> 
	tv”‹x_ty³
;

337 
	gG¿phLabEdgeW¿µ”
<
	tv”‹x_d©a_ty³
, 
	tedge_d©a_ty³
> 
	tedge_ty³
;

338 
	gicÚ‹xt
<
	tg¿ph_ty³
, 
	tg©h”_ty³
, 
	tmes§ge_ty³
> 
	ticÚ‹xt_ty³
;

340 
	gg¿phÏb
::
	tedge_dœ_ty³
ƒdge_dir_type;

342 
vœtu®
 
š™
(
icÚ‹xt_ty³
& 
cÚ‹xt
,

343 cÚ¡ 
v”‹x_ty³
& 
v”‹x
,

344 cÚ¡ 
mes§ge_ty³
& 
msg
) { }

350 
vœtu®
 
edge_dœ_ty³
 
g©h”_edges
(
icÚ‹xt_ty³
& 
cÚ‹xt
,

351 cÚ¡ 
v”‹x_ty³
& 
v”‹x
) const {

352  
	gIN_EDGES
;

360 
vœtu®
 
g©h”_ty³
 
g©h”
(
icÚ‹xt_ty³
& 
cÚ‹xt
,

361 cÚ¡ 
v”‹x_ty³
& 
v”‹x
,

362 
edge_ty³
& 
edge
) const {

363 
log¡»am
(
LOG_FATAL
è<< "G©h”‚Ù im¶em’‹d!" << 
	g¡d
::
’dl
;

364  
g©h”_ty³
();

371 
vœtu®
 
­¶y
(
icÚ‹xt_ty³
& 
cÚ‹xt
,

372 
v”‹x_ty³
& 
v”‹x
,

373 cÚ¡ 
g©h”_ty³
& 
tÙ®
) = 0;

379 
vœtu®
 
edge_dœ_ty³
 
sÿ‰”_edges
(
icÚ‹xt_ty³
& 
cÚ‹xt
,

380 cÚ¡ 
v”‹x_ty³
& 
v”‹x
) const {

381  
	gOUT_EDGES
;

389 
vœtu®
 
sÿ‰”
(
icÚ‹xt_ty³
& 
cÚ‹xt
, cÚ¡ 
v”‹x_ty³
& 
v”‹x
,

390 
edge_ty³
& 
edge
) const {

391 
log¡»am
(
LOG_FATAL
è<< "Sÿ‰”‚Ù im¶em’‹d!" << 
	g¡d
::
’dl
;

395 
	g‹m¶©e
 <
ty³Çme
 
	gGLV”‹xD©aTy³
,y³Çm
	gEdgeD©aTy³
>

396 
	sG¿phLabV”‹xW¿µ”
 {

397 
	gg¿phchi_v”‹x
<
	tboŞ
, 
	tEdgeD©aTy³
> 
	tV”‹xTy³
;

398 
GLV”‹xD©aTy³
 
	tv”‹x_d©a_ty³
;

399 
	gG¿phLabV”‹xW¿µ”
<
	tGLV”‹xD©aTy³
, 
	tEdgeD©aTy³
> 
	tv”‹x_ty³
;

401 
	gg¿phchi
::
vid_t
 
v”‹xId
;

402 
V”‹xTy³
 * 
	gv”‹x
;

403 
	g¡d
::
veùÜ
<
GLV”‹xD©aTy³
> * 
v”‹xA¼ay
;

405 
G¿phLabV”‹xW¿µ”
(
g¿phchi
::
vid_t
 
v”‹xId
, 
V”‹xTy³
 * 
v”‹x
,

406 
¡d
::
veùÜ
<
GLV”‹xD©aTy³
> * 
v”‹xA¼ay
): 
v”‹xId
(vertexId),

407 
v”‹x
(v”‹x), 
v”‹xA¼ay
(vertexArray) { }

409 
boŞ
 
	gİ”©Ü
==(
v”‹x_ty³
& 
Ùh”
) const {

410  
v”‹xId
 =ğ
Ùh”
.vertexId;

414 cÚ¡ 
	gv”‹x_d©a_ty³
& 
d©a
() const {

415  (*
	gv”‹xA¼ay
)[
v”‹xId
];

419 
	gv”‹x_d©a_ty³
& 
d©a
() {

420  (*
	gv”‹xA¼ay
)[
v”‹xId
];

424 
size_t
 
num_š_edges
() const {

425 ià(
	gv”‹x
 =ğ
NULL
) {

426 
log¡»am
(
LOG_ERROR
è<< "G¿phCh˜dÛ nÙ suµÜˆaskšg‚eighbÜ v”tiû š/ouˆdeg»es." << 
¡d
::
’dl
;

429  
	gv”‹x
->
num_edges
();

433 
size_t
 
num_out_edges
() const {

434 ià(
	gv”‹x
 =ğ
NULL
) {

435 
log¡»am
(
LOG_ERROR
è<< "G¿phCh˜dÛ nÙ suµÜˆaskšg‚eighbÜ v”tiû š/ouˆdeg»es." << 
¡d
::
’dl
;

438  
	gv”‹x
->
num_ou‹dges
();

442 
	gg¿phchi
::
vid_t
 
id
() const {

443  
v”‹xId
;

449 
	gg¿phchi
::
vid_t
 
loÿl_id
() const {

450  
v”‹xId
;

456 
	g‹m¶©e
 <
ty³Çme
 
	gGLV”‹xD©aTy³
,y³Çm
	gEdgeD©aTy³
>

457 
	sG¿phLabEdgeW¿µ”
 {

458 
	gg¿phchi_v”‹x
<
	tboŞ
, 
	tEdgeD©aTy³
> 
	tV”‹xTy³
;

459 
GLV”‹xD©aTy³
 
	tv”‹x_d©a_ty³
;

460 
EdgeD©aTy³
 
	tedge_d©a_ty³
;

461 
	gG¿phLabV”‹xW¿µ”
<
	tGLV”‹xD©aTy³
, 
	tEdgeD©aTy³
> 
	tv”‹x_ty³
;

463 
	gg¿phchi_edge
<
	gEdgeD©aTy³
> * 
	gedge
;

464 
V”‹xTy³
 * 
	gv”‹x
;

465 
	g¡d
::
veùÜ
<
GLV”‹xD©aTy³
> * 
v”‹xA¼ay
;

466 
boŞ
 
	gis_šedge
;

468 
G¿phLabEdgeW¿µ”
(
g¿phchi_edge
<
EdgeD©aTy³
> * 
edge
, 
V”‹xTy³
 * 
v”‹x
,

469 
¡d
::
veùÜ
<
GLV”‹xD©aTy³
> * 
v”‹xA¼ay
, 
boŞ
 
is_šedge
):

470 
edge
Ódge), 
v”‹x
(v”‹x), 
v”‹xA¼ay
(v”‹xA¼ay), 
is_šedge
(is_inedge) { }

473 
	gpublic
:

486 
v”‹x_ty³
 
sourû
() const {

487 ià(
is_šedge
) {

488  
G¿phLabV”‹xW¿µ”
<
GLV”‹xD©aTy³
, 
	gEdgeD©aTy³
>(
	gv”‹x
->
id
(), v”‹x, 
	gv”‹xA¼ay
);

490  
	gG¿phLabV”‹xW¿µ”
<
	gGLV”‹xD©aTy³
, 
	gEdgeD©aTy³
>(
	gedge
->
v”‹x_id
(), 
	gNULL
, 
	gv”‹xA¼ay
);

506 
v”‹x_ty³
 
rg‘
() const {

507 ià(!
	gis_šedge
) {

508  
	gG¿phLabV”‹xW¿µ”
<
	gGLV”‹xD©aTy³
, 
	gEdgeD©aTy³
>(
	gv”‹x
->
id
(), v”‹x, 
	gv”‹xA¼ay
);

510  
	gG¿phLabV”‹xW¿µ”
<
	gGLV”‹xD©aTy³
, 
	gEdgeD©aTy³
>(
	gedge
->
v”‹x_id
(), 
	gNULL
, 
	gv”‹xA¼ay
);

517 cÚ¡ 
	gedge_d©a_ty³
& 
d©a
(ècÚ¡ {  
	gcÚ¡_ÿ¡
<edge_d©a_ty³&>(*
	gedge
->
	gd©a_±r
); }

522 
	gedge_d©a_ty³
& 
d©a
(è{  *(
	gedge
->
	gd©a_±r
); }

527 
	g‹m¶©e
 <
şass
 
	gG¿phLabV”‹xProg¿m
>

528 
	gG¿phLabW¿µ”
 : 
public
 
G¿phChiProg¿m
<
boŞ
, 
ty³Çme
 
	gG¿phLabV”‹xProg¿m
::
edge_d©a_ty³
> {

529 
boŞ
 
	tV”‹xD©aTy³
;

530 
ty³Çme
 
	tG¿phLabV”‹xProg¿m
::
	tv”‹x_d©a_ty³
 
	tGLV”‹xD©aTy³
;

531 
ty³Çme
 
	tG¿phLabV”‹xProg¿m
::
	tedge_d©a_ty³
 
	tEdgeD©aTy³
;

532 
ty³Çme
 
	tG¿phLabV”‹xProg¿m
::
	tg©h”_ty³
 gather_type;

533 
ty³Çme
 
	tG¿phLabV”‹xProg¿m
::
	tg¿ph_ty³
 graph_type;

534 
ty³Çme
 
	tG¿phLabV”‹xProg¿m
::
	tmes§ge_ty³
 message_type;

536 
	g¡d
::
veùÜ
<
GLV”‹xD©aTy³
> * 
v”‹xInmemÜyA¼ay
;

538 
G¿phLabW¿µ”
() {

539 
	gv”‹xInmemÜyA¼ay
 = 
Ãw
 
¡d
::
veùÜ
<
GLV”‹xD©aTy³
>();

545 
vœtu®
 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

546 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0) {

547 
log¡»am
(
LOG_INFO
è<< "In™Ÿlizv”tiû š memÜy." << 
¡d
::
’dl
;

548 
	gv”‹xInmemÜyA¼ay
->
»size
(
gcÚ‹xt
.
nv”tiûs
);

555 
vœtu®
 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

561 
vœtu®
 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

567 
vœtu®
 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

573 
upd©e
(
g¿phchi_v”‹x
<
boŞ
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

574 
	gg¿phÏb
::
icÚ‹xt
<
g¿ph_ty³
, 
	gg©h”_ty³
, 
	gmes§ge_ty³
> 
glcÚ‹xt
(&
gcÚ‹xt
);

577 
	gG¿phLabV”‹xW¿µ”
<
	gGLV”‹xD©aTy³
, 
	gEdgeD©aTy³
> 
w¿µ”V”‹x
(
v”‹x
.
id
(), &v”‹x, 
v”‹xInmemÜyA¼ay
);

578 
G¿phLabV”‹xProg¿m
 
	gglV”‹xProg¿m
;

581 
	gglV”‹xProg¿m
.
š™
(
glcÚ‹xt
, 
w¿µ”V”‹x
, 
ty³Çme
 
G¿phLabV”‹xProg¿m
::
mes§ge_ty³
());

582 cÚ¡ 
	gG¿phLabV”‹xProg¿m
& 
	gcÚ¡_v´og
 = 
glV”‹xProg¿m
;

585 
edge_dœ_ty³
 
	gg©h”_dœeùiÚ
 = 
cÚ¡_v´og
.
g©h”_edges
(
glcÚ‹xt
, 
w¿µ”V”‹x
);

586 
g©h”_ty³
 
	gsum
;

588 
	gg©h”ed
 = 0;

589 
	gg©h”_dœeùiÚ
) {

590 
	gALL_EDGES
:

591 
IN_EDGES
:

592 
i
=0; 
	gi
 < 
	gv”‹x
.
num_šedges
(); i++) {

593 
	gG¿phLabEdgeW¿µ”
<
	gGLV”‹xD©aTy³
, 
	gEdgeD©aTy³
> 
edgeW¿µ”
(
v”‹x
.
šedge
(
i
), &v”‹x, 
v”‹xInmemÜyA¼ay
, 
Œue
);

594 ià(
	gg©h”ed
 > 0è
	gsum
 +ğ
cÚ¡_v´og
.
g©h”
(
glcÚ‹xt
, 
w¿µ”V”‹x
, 
edgeW¿µ”
);

595 
	gsum
 = 
cÚ¡_v´og
.
g©h”
(
glcÚ‹xt
, 
w¿µ”V”‹x
, 
edgeW¿µ”
);

596 
	gg©h”ed
++;

598 ià(
	gg©h”_dœeùiÚ
 !ğ
ALL_EDGES
)

600 
	gOUT_EDGES
:

601 
i
=0; 
	gi
 < 
	gv”‹x
.
num_ou‹dges
(); i++) {

602 
	gG¿phLabEdgeW¿µ”
<
	gGLV”‹xD©aTy³
, 
	gEdgeD©aTy³
> 
edgeW¿µ”
(
v”‹x
.
ou‹dge
(
i
), &v”‹x, 
v”‹xInmemÜyA¼ay
, 
çl£
);

603 ià(
	gg©h”ed
 > 0è
	gsum
 +ğ
cÚ¡_v´og
.
g©h”
(
glcÚ‹xt
, 
w¿µ”V”‹x
, 
edgeW¿µ”
);

604 
	gsum
 = 
cÚ¡_v´og
.
g©h”
(
glcÚ‹xt
, 
w¿µ”V”‹x
, 
edgeW¿µ”
);

605 
	gg©h”ed
++;

608 
	gNO_EDGES
:

611 
as£¹
(
çl£
);

616 
	gglV”‹xProg¿m
.
­¶y
(
glcÚ‹xt
, 
w¿µ”V”‹x
, 
sum
);

619 
edge_dœ_ty³
 
	gsÿ‰”_dœeùiÚ
 = 
cÚ¡_v´og
.
sÿ‰”_edges
(
glcÚ‹xt
, 
w¿µ”V”‹x
);

621 
	gsÿ‰”_dœeùiÚ
) {

622 
	gALL_EDGES
:

623 
IN_EDGES
:

624 
i
=0; 
	gi
 < 
	gv”‹x
.
num_šedges
(); i++) {

625 
	gG¿phLabEdgeW¿µ”
<
	gGLV”‹xD©aTy³
, 
	gEdgeD©aTy³
> 
edgeW¿µ”
(
v”‹x
.
šedge
(
i
), &v”‹x, 
v”‹xInmemÜyA¼ay
, 
Œue
);

626 
	gcÚ¡_v´og
.
sÿ‰”
(
glcÚ‹xt
, 
w¿µ”V”‹x
, 
edgeW¿µ”
);

628 ià(
	gsÿ‰”_dœeùiÚ
 !ğ
ALL_EDGES
)

630 
	gOUT_EDGES
:

631 
i
=0; 
	gi
 < 
	gv”‹x
.
num_ou‹dges
(); i++) {

632 
	gG¿phLabEdgeW¿µ”
<
	gGLV”‹xD©aTy³
, 
	gEdgeD©aTy³
> 
edgeW¿µ”
(
v”‹x
.
ou‹dge
(
i
), &v”‹x, 
v”‹xInmemÜyA¼ay
, 
çl£
);

633 
	gcÚ¡_v´og
.
sÿ‰”
(
glcÚ‹xt
, 
w¿µ”V”‹x
, 
edgeW¿µ”
);

636 
	gNO_EDGES
:

639 
as£¹
(
çl£
);

648 
	g‹m¶©e
 <
ty³Çme
 
	gG¿phLabV”‹xProg¿m
,y³Çm
	gReduùiÚTy³
,

649 
ty³Çme
 
	gEdgeM­Ty³
,

650 
ty³Çme
 
	gFš®iz”Ty³
>

651 
	gG¿phLabEdgeAgg»g©ÜW¿µ”
 : 
public
 
G¿phChiProg¿m
<
boŞ
, 
ty³Çme
 
	gG¿phLabV”‹xProg¿m
::
edge_d©a_ty³
> {

652 
boŞ
 
	tV”‹xD©aTy³
;

653 
ty³Çme
 
	tG¿phLabV”‹xProg¿m
::
	tv”‹x_d©a_ty³
 
	tGLV”‹xD©aTy³
;

654 
ty³Çme
 
	tG¿phLabV”‹xProg¿m
::
	tedge_d©a_ty³
 
	tEdgeD©aTy³
;

655 
ty³Çme
 
	tG¿phLabV”‹xProg¿m
::
	tedge_ty³
ƒdge_type;

656 
ty³Çme
 
	tG¿phLabV”‹xProg¿m
::
	tg©h”_ty³
 gather_type;

657 
ty³Çme
 
	tG¿phLabV”‹xProg¿m
::
	tg¿ph_ty³
 graph_type;

658 
ty³Çme
 
	tG¿phLabV”‹xProg¿m
::
	tmes§ge_ty³
 message_type;

660 
mu‹x
 
	gm
;

661 
	g¡d
::
veùÜ
<
ReduùiÚTy³
> 
loÿÏggr
;

662 
ReduùiÚTy³
 
	gaggr
;

663 
	g¡d
::
veùÜ
<
GLV”‹xD©aTy³
> * 
v”‹xInmemÜyA¼ay
;

664 
EdgeM­Ty³
 
	gm­_funùiÚ
;

665 
Fš®iz”Ty³
 
	gfš®ize_funùiÚ
;

667 
G¿phLabEdgeAgg»g©ÜW¿µ”
(
EdgeM­Ty³
 
m­_funùiÚ
,

668 
Fš®iz”Ty³
 
fš®ize_funùiÚ
,

669 
¡d
::
veùÜ
<
ty³Çme
 
G¿phLabV”‹xProg¿m
::
v”‹x_d©a_ty³
> * 
v”tiûs
è: 
m­_funùiÚ
(map_function),

670 
fš®ize_funùiÚ
(finalize_function) {

671 
	gv”‹xInmemÜyA¼ay
 = 
v”tiûs
;

677 
vœtu®
 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

678 
	gaggr
 = 
ReduùiÚTy³
();

679 
	gloÿÏggr
.
»size
(
gcÚ‹xt
.
exeùh»ads
);

685 
vœtu®
 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

686 
log¡»am
(
LOG_INFO
è<< "GošgØruÀedge-agg»g©Ü fš®ize." << 
	g¡d
::
’dl
;

688 
	gi
=0; i < ()
	gloÿÏggr
.
size
(); i++) {

689 
	gaggr
 +ğ
loÿÏggr
[
i
];

692 
	gg¿phÏb
::
icÚ‹xt
<
g¿ph_ty³
, 
	gg©h”_ty³
, 
	gmes§ge_ty³
> 
glcÚ‹xt
(&
gcÚ‹xt
);

693 
fš®ize_funùiÚ
(
glcÚ‹xt
, 
aggr
);

699 
vœtu®
 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

705 
vœtu®
 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

711 
upd©e
(
g¿phchi_v”‹x
<
boŞ
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

712 
	gg¿phÏb
::
icÚ‹xt
<
g¿ph_ty³
, 
	gg©h”_ty³
, 
	gmes§ge_ty³
> 
glcÚ‹xt
(&
gcÚ‹xt
);

713 
ReduùiÚTy³
 
	ga
;

714 
	gi
=0; i < 
	gv”‹x
.
num_edges
(); i++) {

715 cÚ¡ 
	gG¿phLabEdgeW¿µ”
<
	gGLV”‹xD©aTy³
, 
	gEdgeD©aTy³
> 
edgeW¿µ”
(
v”‹x
.
edge
(
i
), &v”‹x, 
v”‹xInmemÜyA¼ay
, 
Œue
);

716 
ReduùiÚTy³
 
	gm­³d
 = 
m­_funùiÚ
(
glcÚ‹xt
, 
edgeW¿µ”
);

717 
	ga
 +ğ
m­³d
;

719 
	gloÿÏggr
[
omp_g‘_th»ad_num
()] +ğ
a
;

729 
Çme¥aû
 
	gmes§ges
 {

734 
	gsum_´iÜ™y
 : 
public
 
g¿phÏb
::
IS_POD_TYPE
 {

735 
v®ue
;

736 
sum_´iÜ™y
(cÚ¡ 
v®ue
 = 0) : value(value) { }

737 
´iÜ™y
(ècÚ¡ {  
v®ue
; }

738 
	gsum_´iÜ™y
& 
	gİ”©Ü
+=(cÚ¡ 
sum_´iÜ™y
& 
Ùh”
) {

739 
v®ue
 +ğ
Ùh”
.value;

740  *
	gthis
;

747 
	gmax_´iÜ™y
 : 
public
 
g¿phÏb
::
IS_POD_TYPE
 {

748 
v®ue
;

749 
max_´iÜ™y
(cÚ¡ 
v®ue
 = 0) : value(value) { }

750 
´iÜ™y
(ècÚ¡ {  
v®ue
; }

751 
	gmax_´iÜ™y
& 
	gİ”©Ü
+=(cÚ¡ 
max_´iÜ™y
& 
Ùh”
) {

752 
v®ue
 = 
¡d
::
max
(v®ue, 
Ùh”
.value);

753  *
	gthis
;

765 
	g‹m¶©e
 <
ty³Çme
 
	gG¿phLabV”‹xProg¿m
>

766 
	g¡d
::
veùÜ
<
ty³Çme
 
G¿phLabV”‹xProg¿m
::
v”‹x_d©a_ty³
> *

767 
run_g¿phÏb_v”‹x´og¿m
(
¡d
::
¡ršg
 
ba£_f’ame
, 
nsh¬ds
, 
n™”s
, 
boŞ
 
scheduËr
, 
m‘rics
 & 
_m
,

768 
boŞ
 
modif›s_šedges
=
Œue
, boŞ 
modif›s_ou‹dges
=true) {

769 
g¿phÏb
::
	tG¿phLabW¿µ”
<
	tG¿phLabV”‹xProg¿m
> 
	tGLW¿µ”
;

770 
GLW¿µ”
 
	gw¿µ”Prog¿m
;

771 
	gg¿phchi_’gše
<
	gboŞ
, 
ty³Çme
 
	gGLW¿µ”
::
EdgeD©aTy³
> 
’gše
(
ba£_f’ame
, 
nsh¬ds
, 
scheduËr
, 
_m
);

772 
	g’gše
.
£t_modif›s_šedges
(
modif›s_šedges
);

773 
	g’gše
.
£t_modif›s_ou‹dges
(
modif›s_ou‹dges
);

774 
	g’gše
.
run
(
w¿µ”Prog¿m
, 
n™”s
);

775  
	gw¿µ”Prog¿m
.
	gv”‹xInmemÜyA¼ay
;

778 
	g‹m¶©e
 <
ty³Çme
 
	gG¿phLabV”‹xProg¿m
,y³Çm
	gReduùiÚTy³
,

779 
ty³Çme
 
	gEdgeM­Ty³
,

780 
ty³Çme
 
	gFš®iz”Ty³
>

781 
ReduùiÚTy³
 
run_g¿phÏb_edge_agg»g©Ü
(
¡d
::
¡ršg
 
ba£_f’ame
, 
nsh¬ds
,

782 
EdgeM­Ty³
 
m­_funùiÚ
,

783 
Fš®iz”Ty³
 
fš®ize_funùiÚ
, 
¡d
::
veùÜ
<
ty³Çme
 
G¿phLabV”‹xProg¿m
::
v”‹x_d©a_ty³
> * 
v”tiûs
, 
m‘rics
 & 
_m
) {

784 
	gg¿phÏb
::
	tG¿phLabEdgeAgg»g©ÜW¿µ”
<
	tG¿phLabV”‹xProg¿m
, 
	tReduùiÚTy³
, 
	tEdgeM­Ty³
, 
	tFš®iz”Ty³
> 
	tGLEdgeAggrW¿µ”
;

785 
log¡»am
(
LOG_INFO
è<< "S¹šgƒdgagg»g©Ü." << 
	g¡d
::
’dl
;

786 
GLEdgeAggrW¿µ”
 
glAgg»g©Ü
(
m­_funùiÚ
, 
fš®ize_funùiÚ
, 
v”tiûs
);

787 
	gg¿phchi_’gše
<
	gboŞ
, 
ty³Çme
 
	gGLEdgeAggrW¿µ”
::
EdgeD©aTy³
> 
’gše
(
ba£_f’ame
, 
nsh¬ds
, 
Œue
, 
_m
);

788 
	g’gše
.
£t_modif›s_šedges
(
çl£
);

789 
	g’gše
.
£t_modif›s_ou‹dges
(
çl£
);

790 
	g’gše
.
run
(
glAgg»g©Ü
, 1);

791  
	gglAgg»g©Ü
.
	gaggr
;

	@src/api/graphlab2_1_GAS_api/graphlab.hpp

29 #iâdeà
DEF_GRAPHLAB_GAS_API_V2_1


30 
	#DEF_GRAPHLAB_GAS_API_V2_1


	)

33 
	~"­i/g¿phÏb2_1_GAS_­i/as£¹iÚs.hµ
"

34 
	~"­i/g¿phÏb2_1_GAS_­i/g¿phchi_g¿phÏbv2_1.hµ
"

37 
	~<boo¡/fÜ—ch.hµ
>

38 
	~<¡dšt.h
>

42 #ifdeà
__GNUC__


43 
	#GRAPHLAB_MACROS_INC_LEVEL
 
__INCLUDE_LEVEL__


	)

48 #ifdeà
GRAPHLAB_MACROS


52 
	#GRAPHLAB_MACROS


	)

56 
	#DISALLOW_COPY_AND_ASSIGN
(
Ty³Name
) \

57 
	`Ty³Name
(cÚ¡ 
Ty³Name
&); \

58 
İ”©Ü
=(cÚ¡ 
Ty³Name
&);

	)

64 
	#fÜ—ch
 
BOOST_FOREACH


	)

66 
	#»v_fÜ—ch
 
BOOST_REVERSE_FOREACH


	)

69 
	~"­i/g¿phÏb2_1_GAS_­i/¿ndom.hµ
"

	@src/api/graphlab2_1_GAS_api/random.cpp

24 
	~<±h»ad.h
>

26 
	~<£t
>

27 
	~<io¡»am
>

28 
	~<f¡»am
>

30 
	~<boo¡/¿ndom.hµ
>

31 
	~<boo¡/š‹g”_Œa™s.hµ
>

33 
	~"ut/±h»ad_toŞs.hµ
"

34 
	~"­i/g¿phÏb2_1_GAS_­i/g¿phÏb.hµ
"

38 
Çme¥aû
 
	gg¿phÏb
 {

39 
Çme¥aû
 
	g¿ndom
 {

44 şas 
	cnÚd‘_g’”©Ü
 {

45 
	gpublic
:

46 
nÚd‘_g’”©Ü
& 
glob®
() {

47 
nÚd‘_g’”©Ü
 
glob®_g’
;

48  
	gglob®_g’
;

51 
size_t
 
	t»suÉ_ty³
;

52 
BOOST_STATIC_CONSTANT
(
»suÉ_ty³
, 
mš_v®ue
 =

53 
boo¡
::
š‹g”_Œa™s
<
»suÉ_ty³
>::
cÚ¡_mš
);

54 
BOOST_STATIC_CONSTANT
(
»suÉ_ty³
, 
max_v®ue
 =

55 
boo¡
::
š‹g”_Œa™s
<
»suÉ_ty³
>::
cÚ¡_max
);

56 
»suÉ_ty³
 
mš
 
BOOST_PREVENT_MACRO_SUBSTITUTION
 (ècÚ¡ {  
	gmš_v®ue
; }

57 
»suÉ_ty³
 
max
 
BOOST_PREVENT_MACRO_SUBSTITUTION
 (ècÚ¡ {  
	gmax_v®ue
; }

59 
nÚd‘_g’”©Ü
() {

60 
	gºd_dev
.
İ’
("/dev/u¿ndom", 
¡d
::
ios
::
bš¬y
 | std::ios::
š
);

61 
ASSERT_TRUE
(
ºd_dev
.
good
());

64 ~
nÚd‘_g’”©Ü
(è{ 
	gºd_dev
.
şo£
(); }

66 
»suÉ_ty³
 
İ”©Ü
()() {

68 
»suÉ_ty³
 
»suÉ
(0);

69 
	gmut
.
lock
();

70 
ASSERT_TRUE
(
ºd_dev
.
good
());

71 
	gºd_dev
.
»ad
(
»š‹½»t_ÿ¡
<*>(&
»suÉ
), (
»suÉ_ty³
));

72 
ASSERT_TRUE
(
ºd_dev
.
good
());

73 
	gmut
.
uÆock
();

75  
	g»suÉ
;

77 
	g´iv©e
:

78 
¡d
::
if¡»am
 
ºd_dev
;

79 
mu‹x
 
	gmut
;

92 
	ssourû_»gi¡ry
 {

93 
	g¡d
::
£t
<
g’”©Ü
*> 
g’”©Üs
;

94 
g’”©Ü
 
	gma¡”
;

95 
mu‹x
 
	gmut
;

97 
	gsourû_»gi¡ry
& 
glob®
() {

98 
sourû_»gi¡ry
 
	g»gi¡ry
;

99  
	g»gi¡ry
;

104 
£ed
() {

105 
	gmut
.
lock
();

106 
	gma¡”
.
£ed
();

107 
fÜ—ch
(
g’”©Ü
* g’”©Ü, 
g’”©Üs
) {

108 
ASSERT_TRUE
(
g’”©Ü
 !ğ
NULL
);

109 
	gg’”©Ü
->
£ed
(
ma¡”
);

111 
	gmut
.
uÆock
();

117 
nÚd‘_£ed
() {

118 
	gmut
.
lock
();

119 
	gma¡”
.
nÚd‘_£ed
();

120 
fÜ—ch
(
g’”©Ü
* g’”©Ü, 
g’”©Üs
) {

121 
ASSERT_TRUE
(
g’”©Ü
 !ğ
NULL
);

122 
	gg’”©Ü
->
£ed
(
ma¡”
);

124 
	gmut
.
uÆock
();

131 
time_£ed
() {

132 
	gmut
.
lock
();

133 
	gma¡”
.
time_£ed
();

134 
fÜ—ch
(
g’”©Ü
* g’”©Ü, 
g’”©Üs
) {

135 
ASSERT_TRUE
(
g’”©Ü
 !ğ
NULL
);

136 
	gg’”©Ü
->
£ed
(
ma¡”
);

138 
	gmut
.
uÆock
();

145 
£ed
(cÚ¡ 
size_t
 
numb”
) {

146 
	gmut
.
lock
();

147 
	gma¡”
.
£ed
(
numb”
);

148 
fÜ—ch
(
g’”©Ü
* g’”©Ü, 
g’”©Üs
) {

149 
ASSERT_TRUE
(
g’”©Ü
 !ğ
NULL
);

150 
	gg’”©Ü
->
£ed
(
ma¡”
);

152 
	gmut
.
uÆock
();

159 
»gi¡”_g’”©Ü
(
g’”©Ü
* 
s_±r
) {

160 
ASSERT_TRUE
(
s_±r
 !ğ
NULL
);

161 
	gmut
.
lock
();

162 
	gg’”©Üs
.
š£¹
(
s_±r
);

163 
	gs_±r
->
£ed
(
ma¡”
);

166 
	gmut
.
uÆock
();

172 
uÄegi¡”_sourû
(
g’”©Ü
* 
s_±r
) {

173 
	gmut
.
lock
();

174 
	gg’”©Üs
.
”a£
(
s_±r
);

175 
	gmut
.
uÆock
();

194 
de¡roy_s_d©a
(* 
±r
) {

195 
g’”©Ü
* 
	gs_ºd_±r
 =

196 
»š‹½»t_ÿ¡
<
g’”©Ü
*>(
±r
);

197 if(
	gs_ºd_±r
 !ğ
NULL
) {

198 
sourû_»gi¡ry
::
glob®
().
uÄegi¡”_sourû
(
s_ºd_±r
);

199 
d–‘e
 
	gs_ºd_±r
;

208 
	ss_key_ü—tÜ
 {

209 
±h»ad_key_t
 
	gTLS_RANDOM_SOURCE_KEY
;

210 
s_key_ü—tÜ
(è: 
TLS_RANDOM_SOURCE_KEY
(0) {

211 
±h»ad_key_ü—‹
(&
TLS_RANDOM_SOURCE_KEY
,

212 
de¡roy_s_d©a
);

217 
±h»ad_key_t
 
g‘_¿ndom_sourû_key
() {

218 cÚ¡ 
s_key_ü—tÜ
 
	gkey
;

219  
	gkey
.
	gTLS_RANDOM_SOURCE_KEY
;

222 
±h»ad_key_t
 
__unu£d_š™_keys__
(
g‘_¿ndom_sourû_key
());

237 
	gg’”©Ü
& 
g‘_sourû
() {

239 
g’”©Ü
* 
	gs_ºd_±r
 =

240 
»š‹½»t_ÿ¡
<
g’”©Ü
*>

241 (
±h»ad_g‘¥ecific
(
g‘_¿ndom_sourû_key
()));

243 if(
	gs_ºd_±r
 =ğ
NULL
) {

244 
s_ºd_±r
 = 
Ãw
 
g’”©Ü
();

245 
as£¹
(
s_ºd_±r
 !ğ
NULL
);

247 
	gsourû_»gi¡ry
::
glob®
().
»gi¡”_g’”©Ü
(
s_ºd_±r
);

248 
±h»ad_£t¥ecific
(
g‘_¿ndom_sourû_key
(),

249 
s_ºd_±r
);

252  *
	gs_ºd_±r
;

257 
£ed
(è{ 
	gsourû_»gi¡ry
::
glob®
().seed(); }

259 
nÚd‘_£ed
(è{ 
	gsourû_»gi¡ry
::
glob®
().nondet_seed(); }

261 
time_£ed
(è{ 
	gsourû_»gi¡ry
::
glob®
().time_seed(); }

263 
£ed
(cÚ¡ 
size_t
 
£ed_v®ue
) {

264 
	gsourû_»gi¡ry
::
glob®
().
£ed
(
£ed_v®ue
);

268 
	gg’”©Ü
::
nÚd‘_£ed
() {

270 
nÚd‘_g’”©Ü
& 
nÚd‘_ºd
ÒÚd‘_g’”©Ü::
glob®
());

271 
	gmut
.
lock
();

273 
	g»®_ºg
.
£ed
(
nÚd‘_ºd
());

275 
	gdisü‘e_ºg
.
£ed
(
nÚd‘_ºd
());

277 
	gç¡_disü‘e_ºg
.
£ed
(
nÚd‘_ºd
());

278 
	gmut
.
uÆock
();

282 
pdf2cdf
(
¡d
::
veùÜ
<>& 
pdf
) {

283 
Z
 = 0;

284 
size_t
 
	gi
 = 0; i < 
	gpdf
.
size
(); ++iè
	gZ
 +ğ
pdf
[
i
];

285 
size_t
 
	gi
 = 0; i < 
	gpdf
.
size
(); ++i)

286 
	gpdf
[
i
] = 
pdf
[i]/
Z
 + ((i>0)?…df[i-1] : 0);

	@src/api/graphlab2_1_GAS_api/random.hpp

24 #iâdeà
GRAPHLAB_RANDOM_HPP


25 
	#GRAPHLAB_RANDOM_HPP


	)

27 
	~<c¡dlib
>

28 
	~<¡dšt.h
>

31 
	~<veùÜ
>

32 
	~<lim™s
>

33 
	~<®gÜ™hm
>

35 
	~<boo¡/¿ndom.hµ
>

36 
	~"ut/±h»ad_toŞs.hµ
"

38 
usšg
 
Çme¥aû
 
	gg¿phchi
;

40 
Çme¥aû
 
	gg¿phÏb
 {

48 
Çme¥aû
 
	g¿ndom
 {

56 
Çme¥aû
 
	gdi¡ributiÚs
 {

64 
	g‹m¶©e
<
ty³Çme
 
	gIÁTy³
>

65 
	sunifÜm
 {

66 
	gboo¡
::
	tunifÜm_št
<
	tIÁTy³
> 
	tdi¡ributiÚ_ty³
;

67 
	g‹m¶©e
<
ty³Çme
 
	gR—lRNG
,y³Çm
	gDisü‘eRNG
>

68 
šlše
 
IÁTy³
 
§m¶e
(
R—lRNG
& 
»®_ºg
,

69 
Disü‘eRNG
& 
disü‘e_ºg
,

70 cÚ¡ 
IÁTy³
& 
mš
, cÚ¡ IÁTy³& 
max
) {

71  
di¡ributiÚ_ty³
(
mš
, 
max
)(
	gdisü‘e_ºg
);

74 
	g‹m¶©e
<>

75 
	gunifÜm
<> {

76 
	gboo¡
::
	tunifÜm_»®
<> 
	tdi¡ributiÚ_ty³
;

77 
	g‹m¶©e
<
ty³Çme
 
	gR—lRNG
,y³Çm
	gDisü‘eRNG
>

78 
šlše
 
§m¶e
(
R—lRNG
& 
»®_ºg
,

79 
Disü‘eRNG
& 
disü‘e_ºg
,

80 cÚ¡ & 
mš
, cÚ¡ & 
max
) {

81  
di¡ributiÚ_ty³
(
mš
, 
max
)(
	g»®_ºg
);

84 
	g‹m¶©e
<>

85 
	gunifÜm
<> {

86 
	gboo¡
::
	tunifÜm_»®
<> 
	tdi¡ributiÚ_ty³
;

87 
	g‹m¶©e
<
ty³Çme
 
	gR—lRNG
,y³Çm
	gDisü‘eRNG
>

88 
šlše
 
§m¶e
(
R—lRNG
& 
»®_ºg
,

89 
Disü‘eRNG
& 
disü‘e_ºg
,

90 cÚ¡ & 
mš
, cÚ¡ & 
max
) {

91  
di¡ributiÚ_ty³
(
mš
, 
max
)(
	g»®_ºg
);

101 şas 
	cg’”©Ü
 {

102 
	gpublic
:

104 
boo¡
::
	tÏgged_fibÚacci607
 
	t»®_ºg_ty³
;

105 
	gboo¡
::
	tmt11213b
 
	tdisü‘e_ºg_ty³
;

106 
	gboo¡
::
	t¿nd48
 
	tç¡_disü‘e_ºg_ty³
;

108 
g’”©Ü
() {

109 
time_£ed
();

113 
šlše
 
£ed
() {

114 
	gmut
.
lock
();

115 
	g»®_ºg
.
£ed
();

116 
	gdisü‘e_ºg
.
£ed
();

117 
	gç¡_disü‘e_ºg
.
£ed
();

118 
	gmut
.
uÆock
();

122 
nÚd‘_£ed
();

126 
šlše
 
time_£ed
() {

127 
£ed
(
time
(
NULL
) );

131 
£ed
(
size_t
 
numb”
) {

132 
	gmut
.
lock
();

133 
	gç¡_disü‘e_ºg
.
£ed
(
numb”
);

134 
	g»®_ºg
.
£ed
(
ç¡_disü‘e_ºg
);

135 
	gdisü‘e_ºg
.
£ed
(
ç¡_disü‘e_ºg
);

136 
	gmut
.
uÆock
();

140 
£ed
(
g’”©Ü
& 
Ùh”
){

141 
	gmut
.
lock
();

142 
	g»®_ºg
.
£ed
(
Ùh”
.
»®_ºg
);

143 
	gdisü‘e_ºg
.
£ed
(
Ùh”
.
disü‘e_ºg
);

144 
	gç¡_disü‘e_ºg
.
£ed
(
Ùh”
.
ç¡_disü‘e_ºg
());

145 
	gmut
.
uÆock
();

152 
	g‹m¶©e
<
ty³Çme
 
	gNumTy³
>

153 
šlše
 
NumTy³
 
unifÜm
(cÚ¡ NumTy³ 
mš
, cÚ¡ NumTy³ 
max
) {

154 
	gmut
.
lock
();

155 cÚ¡ 
NumTy³
 
	g»suÉ
 = 
di¡ributiÚs
::
unifÜm
<NumType>::

156 
§m¶e
(
»®_ºg
, 
disü‘e_ºg
, 
mš
, 
max
);

157 
	gmut
.
uÆock
();

158  
	g»suÉ
;

165 
	g‹m¶©e
<
ty³Çme
 
	gNumTy³
>

166 
šlše
 
NumTy³
 
ç¡_unifÜm
(cÚ¡ NumTy³ 
mš
, cÚ¡ NumTy³ 
max
) {

167 
	gmut
.
lock
();

168 cÚ¡ 
NumTy³
 
	g»suÉ
 = 
di¡ributiÚs
::
unifÜm
<NumType>::

169 
§m¶e
(
»®_ºg
, 
ç¡_disü‘e_ºg
, 
mš
, 
max
);

170 
	gmut
.
uÆock
();

171  
	g»suÉ
;

179 
šlše
 
gamma
(cÚ¡ 
®pha
 = (1)) {

180 
boo¡
::
gamma_di¡ributiÚ
<> 
gamma_di¡
(
®pha
);

181 
	gmut
.
lock
();

182 cÚ¡ 
	g»suÉ
 = 
gamma_di¡
(
»®_ºg
);

183 
	gmut
.
uÆock
();

184  
	g»suÉ
;

192 
šlše
 
gaussŸn
(cÚ¡ 
m—n
 = (0),

193 cÚ¡ 
¡dev
 = (1)) {

194 
boo¡
::
nÜm®_di¡ributiÚ
<> 
nÜm®_di¡
(
m—n
,
¡dev
);

195 
	gmut
.
lock
();

196 cÚ¡ 
	g»suÉ
 = 
nÜm®_di¡
(
»®_ºg
);

197 
	gmut
.
uÆock
();

198  
	g»suÉ
;

205 
šlše
 
nÜm®
(cÚ¡ 
m—n
 = (0),

206 cÚ¡ 
¡dev
 = (1)) {

207  
gaussŸn
(
m—n
, 
¡dev
);

211 
šlše
 
boŞ
 
b”nouÎi
(cÚ¡ 
p
 = (0.5)) {

212 
boo¡
::
b”nouÎi_di¡ributiÚ
<> 
di¡
(
p
);

213 
	gmut
.
lock
();

214 cÚ¡ 
»suÉ
(
di¡
(
disü‘e_ºg
));

215 
	gmut
.
uÆock
();

216  
	g»suÉ
;

219 
šlše
 
boŞ
 
ç¡_b”nouÎi
(cÚ¡ 
p
 = (0.5)) {

220 
boo¡
::
b”nouÎi_di¡ributiÚ
<> 
di¡
(
p
);

221 
	gmut
.
lock
();

222 cÚ¡ 
»suÉ
(
di¡
(
ç¡_disü‘e_ºg
));

223 
	gmut
.
uÆock
();

224  
	g»suÉ
;

231 
	g‹m¶©e
<
ty³Çme
 
	gDoubË
>

232 
size_t
 
muÉšomŸl
(cÚ¡ 
¡d
::
veùÜ
<
DoubË
>& 
´b
) {

233 
ASSERT_GT
(
´b
.
size
(),0);

234 ià(
	g´b
.
size
() == 1) {  0; }

235 
DoubË
 
sum
(0);

236 
size_t
 
	gi
 = 0; i < 
	g´b
.
size
(); ++i) {

237 
ASSERT_GE
(
´b
[
i
], 0);

238 
	gsum
 +ğ
´b
[
i
];

240 
ASSERT_GT
(
sum
, 0);

242 cÚ¡ 
DoubË
 
ºd
(
unifÜm
<Double>(0,1));

243 
size_t
 
	gšd
 = 0;

244 
DoubË
 
cumsum
(
´b
[
šd
]/
sum
);

245 
	gºd
 > 
	gcumsum
 && (
	gšd
+1è< 
	g´b
.
size
();

246 
	gcumsum
 +ğ(
´b
[++
šd
]/
sum
));

247  
	gšd
;

256 
	g‹m¶©e
<
ty³Çme
 
	gDoubË
>

257 
šlše
 
size_t
 
muÉšomŸl_cdf
(cÚ¡ 
¡d
::
veùÜ
<
DoubË
>& 
cdf
) {

258  
¡d
::
uµ”_bound
(
cdf
.
begš
(), cdf.
’d
(),

259 
unifÜm
<
DoubË
>(0,1)è- 
	gcdf
.
begš
();

267 
	g‹m¶©e
<
ty³Çme
 
	gT
>

268 
šlše
 
	g¡d
::
veùÜ
<
T
> 
³rmutiÚ
(cÚ¡ 
size_t
 
ÃËms
) {

269 
¡d
::
veùÜ
<
T
> 
³rm
(
ÃËms
);

270 
T
 
	gi
 = 0; i < 
	gÃËms
; ++iè
	g³rm
[
i
] = i;

271 
shufæe
(
³rm
);

272  
	g³rm
;

278 
	g‹m¶©e
<
ty³Çme
 
	gT
>

279 
shufæe
(
¡d
::
veùÜ
<
T
>& 
vec
è{ shufæe(vec.
begš
(), vec.
’d
()); }

284 
	g‹m¶©e
<
ty³Çme
 
	gI‹¿tÜ
>

285 
shufæe
(
I‹¿tÜ
 
begš
, I‹¿tÜ 
’d
) {

286 
	gmut
.
lock
();

287 
shufæe_funùÜ
 
funùÜ
(*
this
);

288 
	g¡d
::
¿ndom_shufæe
(
begš
, 
’d
, 
funùÜ
);

289 
	gmut
.
uÆock
();

292 
	g´iv©e
:

295 
	sshufæe_funùÜ
 {

296 
g’”©Ü
& 
g’
;

297 
šlše
 
shufæe_funùÜ
(
g’”©Ü
& 
g’
) : gen(gen) { }

298 
šlše
 
¡d
::
±rdiff_t
 
İ”©Ü
()(¡d::±rdiff_ˆ
’d
) {

299  
di¡ributiÚs
::
unifÜm
<
±rdiff_t
>::

300 
§m¶e
(
g’
.
»®_ºg
, g’.
ç¡_disü‘e_ºg
, 0, 
’d
-1);

306 
»®_ºg_ty³
 
	g»®_ºg
;

308 
disü‘e_ºg_ty³
 
	gdisü‘e_ºg
;

310 
ç¡_disü‘e_ºg_ty³
 
	gç¡_disü‘e_ºg
;

312 
mu‹x
 
	gmut
;

333 
£ed
();

339 
£ed
(
size_t
 
£ed_v®ue
);

345 
nÚd‘_£ed
();

351 
time_£ed
();

358 
	gg’”©Ü
& 
g‘_sourû
();

365 
	g‹m¶©e
<
ty³Çme
 
	gNumTy³
>

366 
šlše
 
NumTy³
 
unifÜm
(cÚ¡ NumTy³ 
mš
, cÚ¡ NumTy³ 
max
) {

367  
g‘_sourû
().
	gunifÜm
<
	gNumTy³
>(
	gmš
, 
	gmax
);

375 
	g‹m¶©e
<
ty³Çme
 
	gNumTy³
>

376 
šlše
 
NumTy³
 
ç¡_unifÜm
(cÚ¡ NumTy³ 
mš
, cÚ¡ NumTy³ 
max
) {

377  
g‘_sourû
().
	gç¡_unifÜm
<
	gNumTy³
>(
	gmš
, 
	gmax
);

384 
šlše
 
¿nd01
(è{  
	gunifÜm
<>(0, 1); }

390 
šlše
 
¿nd
(è{  
ç¡_unifÜm
(0, 
RAND_MAX
); }

397 
šlše
 
gamma
(cÚ¡ 
®pha
 = (1)) {

398  
g‘_sourû
().
gamma
(
®pha
);

408 
šlše
 
gaussŸn
(cÚ¡ 
m—n
 = (0),

409 cÚ¡ 
¡dev
 = (1)) {

410  
g‘_sourû
().
gaussŸn
(
m—n
, 
¡dev
);

418 
šlše
 
nÜm®
(cÚ¡ 
m—n
 = (0),

419 cÚ¡ 
¡dev
 = (1)) {

420  
g‘_sourû
().
nÜm®
(
m—n
, 
¡dev
);

427 
šlše
 
boŞ
 
b”nouÎi
(cÚ¡ 
p
 = (0.5)) {

428  
g‘_sourû
().
b”nouÎi
(
p
);

435 
šlše
 
boŞ
 
ç¡_b”nouÎi
(cÚ¡ 
p
 = (0.5)) {

436  
g‘_sourû
().
ç¡_b”nouÎi
(
p
);

444 
	g‹m¶©e
<
ty³Çme
 
	gDoubË
>

445 
šlše
 
size_t
 
muÉšomŸl
(cÚ¡ 
¡d
::
veùÜ
<
DoubË
>& 
´b
) {

446  
g‘_sourû
().
muÉšomŸl
(
´b
);

454 
	g‹m¶©e
<
ty³Çme
 
	gDoubË
>

455 
šlše
 
size_t
 
muÉšomŸl_cdf
(cÚ¡ 
¡d
::
veùÜ
<
DoubË
>& 
cdf
) {

456  
g‘_sourû
().
muÉšomŸl_cdf
(
cdf
);

465 
	g‹m¶©e
<
ty³Çme
 
	gT
>

466 
šlše
 
	g¡d
::
veùÜ
<
T
> 
³rmutiÚ
(cÚ¡ 
size_t
 
ÃËms
) {

467  
g‘_sourû
().
³rmutiÚ
<
T
>(
ÃËms
);

475 
	g‹m¶©e
<
ty³Çme
 
	gT
>

476 
šlše
 
shufæe
(
¡d
::
veùÜ
<
T
>& 
vec
) {

477 
g‘_sourû
().
shufæe
(
vec
);

484 
	g‹m¶©e
<
ty³Çme
 
	gI‹¿tÜ
>

485 
šlše
 
shufæe
(
I‹¿tÜ
 
begš
, I‹¿tÜ 
’d
) {

486 
g‘_sourû
().
shufæe
(
begš
, 
’d
);

492 
pdf2cdf
(
¡d
::
veùÜ
<>& 
pdf
);

	@src/api/ischeduler.hpp

30 #iâdeà
DEF_GRAPHCHI_ISCHEDULER


31 
	#DEF_GRAPHCHI_ISCHEDULER


	)

33 
	~"g¿phchi_ty³s.hµ
"

34 
	~"logg”/logg”.hµ
"

36 
Çme¥aû
 
	gg¿phchi
 {

38 şas 
	cischeduËr
 {

39 
	gpublic
:

40 
vœtu®
 ~
ischeduËr
() {}

41 
vœtu®
 
add_sk
(
vid_t
 
vid
) = 0;

42 
vœtu®
 
»move_sks
(
vid_t
 
äomv”‹x
, vid_ˆ
tov”‹x
) = 0;

43 
vœtu®
 
add_sk_to_®l
() = 0;

44 
vœtu®
 
boŞ
 
is_scheduËd
(
vid_t
 
v”‹x
) = 0;

51 şas 
	cnÚ_scheduËr
 : 
public
 
ischeduËr
 {

52 
nw¬nšgs
;

53 
	gpublic
:

54 
nÚ_scheduËr
(è: 
nw¬nšgs
(0) {}

55 
vœtu®
 ~
nÚ_scheduËr
() {}

56 
vœtu®
 
add_sk
(
vid_t
 
vid
) {

57 ià(
nw¬nšgs
++ % 10000 == 0) {

58 
log¡»am
(
LOG_WARNING
è<< "Tr›dØaddaskØscheduËr, buˆschedulšg wa nÙƒÇbËd!" << 
¡d
::
’dl
;

61 
vœtu®
 
»move_sks
(
vid_t
 
äomv”‹x
, vid_ˆ
tov”‹x
) { }

62 
vœtu®
 
add_sk_to_®l
() { }

63 
vœtu®
 
boŞ
 
is_scheduËd
(
vid_t
 
v”‹x
è{  
	gŒue
; }

	@src/api/vertex_aggregator.hpp

33 #iâdeà
DEF_GRAPHCHI_VERTEX_AGGREGATOR


34 
	#DEF_GRAPHCHI_VERTEX_AGGREGATOR


	)

36 
	~<”ºo.h
>

37 
	~<memÜy.h
>

38 
	~<¡ršg
>

40 
	~"g¿phchi_ty³s.hµ
"

41 
	~"­i/chif’ames.hµ
"

42 
	~"io/¡redio.hµ
"

43 
	~"ut/iout.hµ
"

44 
	~"’gše/auxd©a/v”‹x_d©a.hµ
"

46 
Çme¥aû
 
	gg¿phchi
 {

52 
	g‹m¶©e
 <
ty³Çme
 
	gV”‹xD©aTy³
>

53 şas 
	cVC®lback
 {

54 
	gpublic
:

55 
vœtu®
 
ÿÎback
(
vid_t
 
v”‹x_id
, 
V”‹xD©aTy³
 &
v®ue
) = 0;

67 
	g‹m¶©e
 <
ty³Çme
 
	gV”‹xD©aTy³
>

68 
fÜ—ch_v”tiûs
(
¡d
::
¡ršg
 
ba£f’ame
, 
vid_t
 
äomv
, vid_ˆ
tov
, 
VC®lback
<
V”‹xD©aTy³
> &
ÿÎback
) {

69 
	g¡d
::
¡ršg
 
f’ame
 = 
f’ame_v”‹x_d©a
<
V”‹xD©aTy³
>(
ba£f’ame
);

70 
m‘rics
 
m
("foreach");

71 
¡redio
 * 
	giomgr
 = 
Ãw
 sŒedio(
m
);

73 
vid_t
 
	g»adwšdow
 = 1024 * 1024;

74 
size_t
 
	gnumv”tiûs
 = 
g‘_num_v”tiûs
(
ba£f’ame
);

75 
	gv”‹x_d©a_¡Üe
<
	gV”‹xD©aTy³
> * 
	gv”‹xd©a
 =

76 
Ãw
 
v”‹x_d©a_¡Üe
<
V”‹xD©aTy³
>(
ba£f’ame
, 
	gnumv”tiûs
, 
	giomgr
);

78 
vid_t
 
	g¡
 = 
äomv
;

79 
vid_t
 
	g’
 = 0;

80 
	g¡
 <ğ
tov
) {

81 
’
 = 
¡
 + 
»adwšdow
 - 1;

82 ià(
	g’
 >ğ
tov
è
’
 =ov - 1;

84 ià(
	g¡
 < 
	g’
) {

85 
	gv”‹xd©a
->
lßd
(
¡
, 
’
);

86 
vid_t
 
	gv
=
¡
; v<=
’
; v++) {

87 
V”‹xD©aTy³
 * 
	gv±r
 = 
v”‹xd©a
->
v”‹x_d©a_±r
(
v
);

88 
	gÿÎback
.
ÿÎback
(
v
, (
V”‹xD©aTy³
&è*
v±r
);

92 
	g¡
 +ğ
»adwšdow
;

94 
d–‘e
 
	gv”‹xd©a
;

95 
d–‘e
 
	giomgr
;

102 
	g‹m¶©e
 <
ty³Çme
 
	gV”‹xD©aTy³
,y³Çm
	gSumTy³
>

103 
şass
 
	gSumC®lback
 : 
public
 
VC®lback
<
V”‹xD©aTy³
> {

104 
public
:

105 
SumTy³
 
accum
;

106 
SumC®lback
(
SumTy³
 
š™v®
è: 
VC®lback
<
V”‹xD©aTy³
>() {

107 
accum
 = 
š™v®
;

110 
ÿÎback
(
vid_t
 
v”‹x_id
, 
V”‹xD©aTy³
 &
v®ue
) {

111 
	gaccum
 +ğ
v®ue
;

124 
	g‹m¶©e
 <
ty³Çme
 
	gV”‹xD©aTy³
,y³Çm
	gSumTy³
>

125 
SumTy³
 
sum_v”tiûs
(
¡d
::
¡ršg
 
ba£_f’ame
, 
vid_t
 
äomv
, vid_ˆ
tov
) {

126 
	gSumC®lback
<
	gV”‹xD©aTy³
, 
	gSumTy³
> 
sumc
(0);

127 
	gfÜ—ch_v”tiûs
<
	gV”‹xD©aTy³
>(
	gba£_f’ame
, 
	gäomv
, 
	gtov
, 
	gsumc
);

128  
	gsumc
.
	gaccum
;

	@src/engine/auxdata/degree_data.hpp

30 #iâdeà
DEF_GRAPHCHI_DEGREE_DATA


31 
	#DEF_GRAPHCHI_DEGREE_DATA


	)

33 
	~<f¡»am
>

34 
	~<as£¹.h
>

35 
	~<¡ršg
>

36 
	~<¡dlib.h
>

38 
	~"g¿phchi_ty³s.hµ
"

39 
	~"io/¡redio.hµ
"

41 
Çme¥aû
 
	gg¿phchi
 {

44 
	sdeg»e
 {

45 
	gšdeg»e
;

46 
	goutdeg»e
;

50 şas 
	cdeg»e_d©a
 {

53 
	g´Ùeùed
:

55 
vid_t
 
v”‹x_¡
;

56 
vid_t
 
	gv”‹x_’
;

57 
¡redio
 * 
	giomgr
;

60 
deg»e
 * 
	glßded_chunk
;

61 
	g¡d
::
¡ršg
 
f’ame
;

62 
	gfedesc
;

64 
vœtu®
 
İ’_fe
(
¡d
::
¡ršg
 
ba£_f’ame
) {

65 
f’ame
 = 
f’ame_deg»e_d©a
(
ba£_f’ame
);

66 
	giomgr
->
®low_´–ßdšg
(
f’ame
);

67 
	gfedesc
 = 
iomgr
->
İ’_£ssiÚ
(
f’ame
.
c_¡r
(), 
çl£
);

70 
	gpublic
:

76 
deg»e_d©a
(
¡d
::
¡ršg
 
ba£_f’ame
, 
¡redio
 * 
iomgr
è: iomgr(iomgr), 
lßded_chunk
(
NULL
) {

77 
	gv”‹x_¡
 = 
v”‹x_’
 = 0;

78 
İ’_fe
(
ba£_f’ame
);

81 
	gvœtu®
 ~
deg»e_d©a
() {

82 ià(
	glßded_chunk
 !ğ
NULL
) {

83 
iomgr
->
mªaged_»Ëa£
(
fedesc
, &
lßded_chunk
);

85 
	giomgr
->
şo£_£ssiÚ
(
fedesc
);

93 
vœtu®
 
lßd
(
vid_t
 
_v”‹x_¡
, vid_ˆ
_v”‹x_’
) {

94 
as£¹
(
_v”‹x_’
 >ğ
_v”‹x_¡
);

95 
	gv”‹x_¡
 = 
_v”‹x_¡
;

96 
	gv”‹x_’
 = 
_v”‹x_’
;

98 
size_t
 
	gd©asize
 = (
v”‹x_’
 - 
v”‹x_¡
 + 1è* (
deg»e
);

99 
size_t
 
	gd©a¡¬t
 = 
v”‹x_¡
 * (
deg»e
);

101 ià(
	glßded_chunk
 !ğ
NULL
) {

102 
iomgr
->
mªaged_»Ëa£
(
fedesc
, &
lßded_chunk
);

105 
	giomgr
->
mªaged_m®loc
(
fedesc
, &
lßded_chunk
, 
d©asize
, 
d©a¡¬t
);

106 
	giomgr
->
mªaged_´—da_now
(
fedesc
, &
lßded_chunk
, 
d©asize
, 
d©a¡¬t
);

112 
vid_t
 
fœ¡_v”‹x_id
() {

113 
as£¹
(
lßded_chunk
 !ğ
NULL
);

114  
	gv”‹x_¡
;

117 
vœtu®
 
£t_deg»e
(
vid_t
 
v”‹xid
, 
šdeg»e
, 
outdeg»e
) {

118 
as£¹
(
v”‹xid
 >ğ
v”‹x_¡
 && v”‹xid <ğ
v”‹x_’
);

119 
	glßded_chunk
[
v”‹xid
 - 
v”‹x_¡
].
	gšdeg»e
 = 
šdeg»e
;

120 
	glßded_chunk
[
v”‹xid
 - 
v”‹x_¡
].
	goutdeg»e
 = 
outdeg»e
;

123 
vœtu®
 
£t_deg»e
(
vid_t
 
v”‹xid
, 
deg»e
 
d
) {

124 
as£¹
(
v”‹xid
 >ğ
v”‹x_¡
 && v”‹xid <ğ
v”‹x_’
);

125 
	glßded_chunk
[
v”‹xid
 - 
v”‹x_¡
] = 
d
;

128 
šlše
 
deg»e
 
g‘_deg»e
(
vid_t
 
v”‹xid
) {

129 
as£¹
(
v”‹xid
 >ğ
v”‹x_¡
 && v”‹xid <ğ
v”‹x_’
);

130  
	glßded_chunk
[
v”‹xid
 - 
v”‹x_¡
];

133 
§ve
() {

134 
size_t
 
	gd©asize
 = (
v”‹x_’
 - 
v”‹x_¡
 + 1è* (
deg»e
);

135 
size_t
 
	gd©a¡¬t
 = 
v”‹x_¡
 * (
deg»e
);

137 
	giomgr
->
mªaged_pwr™—_now
(
fedesc
, &
lßded_chunk
, 
d©asize
, 
d©a¡¬t
);

140 
’su»_size
(
vid_t
 
maxid
) {

141 
	giomgr
->
Œunÿ‹
(
fedesc
, (1 + 
maxid
è* (
deg»e
));

	@src/engine/auxdata/dynamicdata/vertex_data_dynamic.hpp

36 #iâdeà
DYNAMICVERTEXDATA


37 
	$ERROR
(
DYNAMICVERTEXDATA
 
NEEDS
 
TO
 
BE
 
DEFINED
)

40 #iâdeà
DEF_GRAPHCHI_VERTEXDATA


41 
	#DEF_GRAPHCHI_VERTEXDATA


	)

43 
	~<¡dlib.h
>

44 
	~<¡ršg
>

45 
	~<fú.h
>

46 
	~<”ºo.h
>

47 
	~<sys/¡©.h
>

48 
	~<as£¹.h
>

50 
	~"g¿phchi_ty³s.hµ
"

51 
	~"­i/chif’ames.hµ
"

52 
	~"io/¡redio.hµ
"

53 
	~"ut/iout.hµ
"

54 
	~"­i/dyÇmicd©a/chiveùÜ.hµ
"

55 
	~"sh¬ds/dyÇmicd©a/dyÇmicblock.hµ
"

57 
Çme¥aû
 
g¿phchi
 {

59 
‹m¶©e
 <
ty³Çme
 
V”‹xD©aTy³
>

60 
	svdblock_t
 {

61 
blockid
;

62 
fd
;

63 
ušt8_t
* 
d©a
;

64 
dyÇmicd©a_block
<
V”‹xD©aTy³
> * 
dblock
;

65 
	`vdblock_t
(
bid
è: 
	`blockid
(bid), 
	`d©a
(
NULL
), 
	`dblock
(NULL) {}

68 
‹m¶©e
 <
ty³Çme
 
V”‹xD©aTy³
>

69 şas 
	cv”‹x_d©a_¡Üe
 {

71 
vdblock_t
<
	tV”‹xD©aTy³
> 
	tvdblock
;

72 
´Ùeùed
:

74 
¡redio
 * 
iomgr
;

77 
vid_t
 
v”‹x_¡
;

78 
vid_t
 
v”‹x_’
;

80 
¡d
::
¡ršg
 
dœÇme
;

81 
size_t
 
v”tiû¥”block
;

83 
V”‹xD©aTy³
 * 
lßded_chunk
;

84 
¡d
::
veùÜ
<
vdblock
> 
lßdedblocks
;

87 
public
:

89 
	`v”‹x_d©a_¡Üe
(
¡d
::
¡ršg
 
ba£_f’ame
, 
size_t
 
nv”tiûs
, 
¡redio
 * 
iomgr
è: 
	`iomgr
(iomgr), 
	`lßded_chunk
(
NULL
){

90 
v”‹x_¡
 = 
v”‹x_’
 = 0;

91 
v”tiû¥”block
 = 1024 * 1024;

93 
dœÇme
 = 
f’ame_v”‹x_d©a
<
V”‹xD©aTy³
>(
ba£_f’ame
) + ".dynamic_blockdir";

94 
	`check_size
(
nv”tiûs
);

97 
vœtu®
 ~
	`v”‹x_d©a_¡Üe
() {

98 
iomgr
->
	`wa™_fÜ_wr™es
();

99 
	`»Ëa£blocks
();

103 
	`check_size
(
size_t
 
nv”tiûs
) {

104 
nblocks
 = (
nv”tiûs
 - 1è/ 
v”tiû¥”block
 + 1;

105 
i
=0; i < 
nblocks
; i++) {

106 
	`š™_block
(
i
);

110 
	`ş—r
(
size_t
 
nv”tiûs
) {

111 
nblocks
 = (
nv”tiûs
 - 1è/ 
v”tiû¥”block
 + 1;

112 
i
=0; i < 
nblocks
; i++) {

113 
¡d
::
¡ršg
 
bf’ame
 = 
	`blockf’ame
(
i
);

114 ià(
	`fe_exi¡s
(
bf’ame
)) {

115 
	`»move
(
bf’ame
.
	`c_¡r
());

117 
	`d–‘e_block_uncom´es£d_sizefe
(
bf’ame
);

121 
´iv©e
:

122 
¡d
::
¡ršg
 
	`blockf’ame
(
blockid
) {

123 
¡d
::
¡ršg¡»am
 
ss
;

124 
ss
 << 
dœÇme
;

125 
ss
 << "/";

126 
ss
 << 
blockid
;

127  
ss
.
	`¡r
();

130 
	`»Ëa£blocks
() {

131 
i
=0; i < ()
lßdedblocks
.
	`size
(); i++) {

132 
	`d–‘e
(
lßdedblocks
[
i
].
dblock
);

133 
iomgr
->
	`mªaged_»Ëa£
(
lßdedblocks
[
i
].
fd
, &lßdedblocks[i].
d©a
);

134 
iomgr
->
	`şo£_£ssiÚ
(
lßdedblocks
[
i
].
fd
);

135 
lßdedblocks
[
i
].
d©a
 = 
NULL
;

136 
lßdedblocks
[
i
].
dblock
 = 
NULL
;

138 
lßdedblocks
.
	`ş—r
();

141 
	`š™_block
(
blockid
) {

142 
¡d
::
¡ršg
 
bf’ame
 = 
	`blockf’ame
(
blockid
);

143 ià(!
	`fe_exi¡s
(
bf’ame
)) {

144 
	`mkdœ
(
dœÇme
.
	`c_¡r
(), 0777);

145 
size_t
 
š™size
 = 
v”tiû¥”block
 * (
ty³Çme
 
V”‹xD©aTy³
::
sizewÜd_t
);

146 
f
 = 
	`İ’
(
bf’ame
.
	`c_¡r
(), 
O_RDWR
 | 
O_CREAT
, 
S_IROTH
 | 
S_IWOTH
 | 
S_IWUSR
 | 
S_IRUSR
);

147 
ušt8_t
 * 
z”os
 = (ušt8_ˆ*è
	`ÿÎoc
(
v”tiû¥”block
, (
ty³Çme
 
V”‹xD©aTy³
::
sizewÜd_t
));

148 
	`wr™e_com´es£d
(
f
, 
z”os
, 
š™size
);

149 
	`ä“
(
z”os
);

151 
	`wr™e_block_uncom´es£d_size
(
bf’ame
, 
š™size
);

152 
	`şo£
(
f
);

158 
vdblock
 
	`lßd_block
(
blockid
) {

159 
vdblock
 
	`db
(
blockid
);

161 
¡d
::
¡ršg
 
blockâame
 = 
	`blockf’ame
(
blockid
);

162 
db
.
fd
 = 
iomgr
->
	`İ’_£ssiÚ
(
blockâame
, 
çl£
, 
Œue
);

163 
»®size
 = 
	`g‘_block_uncom´es£d_size
(
blockâame
, -1);

164 
	`as£¹
(
»®size
 > 0);

166 
iomgr
->
	`mªaged_m®loc
(
db
.
fd
, &db.
d©a
, 
»®size
, 0);

167 
iomgr
->
	`mªaged_´—da_now
(
db
.
fd
, &db.
d©a
, 
»®size
, 0);

168 
db
.
dblock
 = 
Ãw
 
dyÇmicd©a_block
<
V”‹xD©aTy³
>(
v”tiû¥”block
, (
ušt8_t
 *)db.
d©a
, 
»®size
);

169  
db
;

172 
	`wr™e_block
(
vdblock
 &
block
) {

173 
»®size
;

174 
ušt8_t
 * 
outd©a
;

175 
block
.
dblock
->
	`wr™e
(&
outd©a
, 
»®size
);

176 
¡d
::
¡ršg
 
blockâame
 = 
	`blockf’ame
(
block
.
blockid
);

177 
iomgr
->
	`mªaged_pwr™—_now
(
block
.
fd
, &
outd©a
, 
»®size
, 0);

178 
	`wr™e_block_uncom´es£d_size
(
blockâame
, 
»®size
);

181 
public
:

188 
vœtu®
 
	`lßd
(
vid_t
 
_v”‹x_¡
, vid_ˆ
_v”‹x_’
) {

189 
	`as£¹
(
_v”‹x_’
 >ğ
_v”‹x_¡
);

190 
v”‹x_¡
 = 
_v”‹x_¡
;

191 
v”‹x_’
 = 
_v”‹x_’
;

193 
	`»Ëa£blocks
();

195 
mš_blockid
 = 
v”‹x_¡
 / 
v”tiû¥”block
;

196 
max_blockid
 = 
v”‹x_’
 / 
v”tiû¥”block
;

197 
i
=
mš_blockid
; i <ğ
max_blockid
; i++) {

198 
lßdedblocks
.
	`push_back
(
	`lßd_block
(
i
));

205 
vœtu®
 
	`§ve
(
boŞ
 
async
=
çl£
) {

206 
i
=0; i < ()
lßdedblocks
.
	`size
(); i++) {

207 
	`wr™e_block
(
lßdedblocks
[
i
]);

215 
vid_t
 
	`fœ¡_v”‹x_id
() {

216  
v”‹x_¡
;

220 
V”‹xD©aTy³
 * 
	`v”‹x_d©a_±r
(
vid_t
 
v”‹xid
) {

221 
blockid
 = 
v”‹xid
 / 
v”tiû¥”block
;

222 
fœ¡lßded
 = 
lßdedblocks
[0].
blockid
;

223 
dyÇmicd©a_block
<
V”‹xD©aTy³
> * 
dynblock
 = 
lßdedblocks
[
blockid
 - 
fœ¡lßded
].
dblock
;

224  
dynblock
->
	`edgevec
(
v”‹xid
 % 
v”tiû¥”block
);

228 
	}
};

	@src/engine/auxdata/vertex_data.hpp

33 #ifdeà
DYNAMICVERTEXDATA


34 
	~"’gše/auxd©a/dyÇmicd©a/v”‹x_d©a_dyÇmic.hµ
"

37 #iâdeà
DEF_GRAPHCHI_VERTEXDATA


38 
	#DEF_GRAPHCHI_VERTEXDATA


	)

40 
	~<¡dlib.h
>

41 
	~<¡ršg
>

42 
	~<as£¹.h
>

44 
	~"g¿phchi_ty³s.hµ
"

45 
	~"­i/chif’ames.hµ
"

46 
	~"io/¡redio.hµ
"

47 
	~"ut/iout.hµ
"

49 
Çme¥aû
 
	gg¿phchi
 {

51 
	g‹m¶©e
 <
ty³Çme
 
	gV”‹xD©aTy³
>

52 şas 
	cv”‹x_d©a_¡Üe
 {

54 
	g´Ùeùed
:

56 
¡redio
 * 
iomgr
;

59 
vid_t
 
	gv”‹x_¡
;

60 
vid_t
 
	gv”‹x_’
;

62 
	g¡d
::
¡ršg
 
f’ame
;

63 
	gfedesc
;

65 
V”‹xD©aTy³
 * 
	glßded_chunk
;

68 
vœtu®
 
İ’_fe
(
¡d
::
¡ršg
 
ba£_f’ame
) {

69 
fedesc
 = 
iomgr
->
İ’_£ssiÚ
(
f’ame
.
c_¡r
(), 
çl£
);

72 
	gpublic
:

74 
v”‹x_d©a_¡Üe
(
¡d
::
¡ršg
 
ba£_f’ame
, 
size_t
 
nv”tiûs
, 
¡redio
 * 
iomgr
è: iomgr(iomgr), 
lßded_chunk
(
NULL
){

75 
	gv”‹x_¡
 = 
v”‹x_’
 = 0;

76 
	gf’ame
 = 
f’ame_v”‹x_d©a
<
V”‹xD©aTy³
>(
ba£_f’ame
);

77 
check_size
(
nv”tiûs
);

78 
	giomgr
->
®low_´–ßdšg
(
f’ame
);

79 
İ’_fe
(
f’ame
);

82 
	gvœtu®
 ~
v”‹x_d©a_¡Üe
() {

83 
	giomgr
->
şo£_£ssiÚ
(
fedesc
);

84 
	giomgr
->
wa™_fÜ_wr™es
();

85 ià(
	glßded_chunk
 !ğ
NULL
) {

86 
iomgr
->
mªaged_»Ëa£
(
fedesc
, &
lßded_chunk
);

90 
check_size
(
size_t
 
nv”tiûs
) {

91 
	gcheck¬¿y_fesize
<
	gV”‹xD©aTy³
>(
	gf’ame
, 
	gnv”tiûs
);

94 
ş—r
(
size_t
 
nv”tiûs
) {

95 
check_size
(0);

96 
check_size
(
nv”tiûs
);

104 
vœtu®
 
lßd
(
vid_t
 
_v”‹x_¡
, vid_ˆ
_v”‹x_’
) {

105 
as£¹
(
_v”‹x_’
 >ğ
_v”‹x_¡
);

106 
	gv”‹x_¡
 = 
_v”‹x_¡
;

107 
	gv”‹x_’
 = 
_v”‹x_’
;

109 
size_t
 
	gd©asize
 = (
v”‹x_’
 - 
v”‹x_¡
 + 1)* (
V”‹xD©aTy³
);

110 
size_t
 
	gd©a¡¬t
 = 
v”‹x_¡
 * (
V”‹xD©aTy³
);

112 ià(
	glßded_chunk
 !ğ
NULL
) {

113 
iomgr
->
mªaged_»Ëa£
(
fedesc
, &
lßded_chunk
);

116 
	giomgr
->
mªaged_m®loc
(
fedesc
, &
lßded_chunk
, 
d©asize
, 
d©a¡¬t
);

117 
	giomgr
->
mªaged_´—da_now
(
fedesc
, &
lßded_chunk
, 
d©asize
, 
d©a¡¬t
);

123 
vœtu®
 
§ve
(
boŞ
 
async
=
çl£
) {

124 
as£¹
(
lßded_chunk
 !ğ
NULL
);

125 
size_t
 
	gd©asize
 = (
v”‹x_’
 - 
v”‹x_¡
 + 1è* (
V”‹xD©aTy³
);

126 
size_t
 
	gd©a¡¬t
 = 
v”‹x_¡
 * (
V”‹xD©aTy³
);

127 ià(
	gasync
) {

128 
	giomgr
->
mªaged_pwr™—_async
(
fedesc
, &
lßded_chunk
, 
d©asize
, 
d©a¡¬t
, 
çl£
);

130 
	giomgr
->
mªaged_pwr™—_now
(
fedesc
, &
lßded_chunk
, 
d©asize
, 
d©a¡¬t
);

138 
vid_t
 
fœ¡_v”‹x_id
() {

139 
as£¹
(
lßded_chunk
 !ğ
NULL
);

140  
	gv”‹x_¡
;

144 
V”‹xD©aTy³
 * 
v”‹x_d©a_±r
(
vid_t
 
v”‹xid
) {

145 
as£¹
(
v”‹xid
 >ğ
v”‹x_¡
 && v”‹xid <ğ
v”‹x_’
);

146  &
	glßded_chunk
[
v”‹xid
 - 
v”‹x_¡
];

	@src/engine/bitset_scheduler.hpp

29 #iâdeà
DEF_GRAPHCHI_BITSETSCHEDULER


30 
	#DEF_GRAPHCHI_BITSETSCHEDULER


	)

32 
	~"g¿phchi_ty³s.hµ
"

33 
	~"­i/ischeduËr.hµ
"

34 
	~"ut/d’£_b™£t.hµ
"

36 
Çme¥aû
 
	gg¿phchi
 {

38 şas 
	cb™£t_scheduËr
 : 
public
 
ischeduËr
 {

39 
´iv©e
:

40 
d’£_b™£t
 
b™£t
;

41 
	gpublic
:

42 
boŞ
 
has_Ãw_sks
;

44 
b™£t_scheduËr
(
nv”tiûs
è: 
b™£t
(nvertices) {

47 
vœtu®
 ~
b™£t_scheduËr
() {}

49 
šlše
 
add_sk
(
vid_t
 
v”‹x
) {

50 
b™£t
.
£t_b™
(
v”‹x
);

51 
	ghas_Ãw_sks
 = 
Œue
;

54 
»size
(
vid_t
 
maxsize
) {

55 
	gb™£t
.
»size
(
maxsize
);

58 
šlše
 
boŞ
 
is_scheduËd
(
vid_t
 
v”‹x
) {

59  
	gb™£t
.
g‘
(
v”‹x
);

62 
šlše
 
»move_sk
(
vid_t
 
v”‹x
) {

63 
	gb™£t
.
ş—r_b™
(
v”‹x
);

66 
»move_sks
(
vid_t
 
äomv”‹x
, vid_ˆ
tov”‹x
) {

67 
	gb™£t
.
ş—r_b™s
(
äomv”‹x
, 
tov”‹x
);

70 
add_sk_to_®l
() {

71 
	ghas_Ãw_sks
 = 
Œue
;

72 
	gb™£t
.
£Î
();

	@src/engine/dynamic_graphs/edgebuffers.hpp

29 #iâdeà
DEF_GRAPHCHI_EDGEBUFFERS


30 
	#DEF_GRAPHCHI_EDGEBUFFERS


	)

32 
	~<¡dlib.h
>

33 
	~<veùÜ
>

36 
Çme¥aû
 
	gg¿phchi
 {

42 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

43 
	sü—‹d_edge
 {

44 
vid_t
 
	g¤c
;

45 
vid_t
 
	gd¡
;

46 
EdgeD©aTy³
 
	gd©a
;

47 
boŞ
 
	gaccouÁed_fÜ_outc
;

48 
boŞ
 
	gaccouÁed_fÜ_šc
;

49 
ü—‹d_edge
(
vid_t
 
¤c
, vid_ˆ
d¡
, 
EdgeD©aTy³
 
_d©a
è: src(¤c), d¡(d¡), 
d©a
(_d©a), 
accouÁed_fÜ_outc
(
çl£
),

50 
accouÁed_fÜ_šc
(
çl£
) {}

53 
	#EDGE_BUFFER_CHUNKSIZE
 65536

	)

59 
	g‹m¶©e
 <
ty³Çme
 
	gET
>

60 şas 
	cedge_bufãr_æ©
 {

62 
	gcouÁ
;

63 
	g¡d
::
veùÜ
<
ü—‹d_edge
<
ET
> *> 
bufs
;

65 
	gpublic
:

67 
edge_bufãr_æ©
(è: 
couÁ
(0) {

70 ~
edge_bufãr_æ©
() {

71 
ş—r
();

74 
ş—r
() {

75 
	gi
=0; i< ()
	gbufs
.
size
(); i++) {

76 
ä“
(
bufs
[
i
]);

78 
	gbufs
.
ş—r
();

79 
	gcouÁ
 = 0;

82 
size
() {

83  
	gcouÁ
;

86 
	gü—‹d_edge
<
	gET
> * 
	gİ”©Ü
[](
	gi
) {

87  &
	gbufs
[
i
 / 
EDGE_BUFFER_CHUNKSIZE
][i % EDGE_BUFFER_CHUNKSIZE];

90 
add
(
vid_t
 
¤c
, vid_ˆ
d¡
, 
ET
 
d©a
) {

91 
add
(
ü—‹d_edge
<
ET
>(
¤c
, 
d¡
, 
d©a
));

94 
add
(
ü—‹d_edge
<
ET
> 
ûdge
) {

95 
	gidx
 = 
couÁ
++;

96 
	gbufidx
 = 
idx
 / 
EDGE_BUFFER_CHUNKSIZE
;

97 ià(
	gbufidx
 =ğ(è
bufs
.
size
()) {

98 
bufs
.
push_back
((
ü—‹d_edge
<
ET
>*)
ÿÎoc
((ü—‹d_edge<ET>), 
EDGE_BUFFER_CHUNKSIZE
));

100 
	gbufs
[
bufidx
][
idx
 % 
EDGE_BUFFER_CHUNKSIZE
] = 
ûdge
;

103 
	g´iv©e
:

105 
edge_bufãr_æ©
(constƒdge_buffer_flat&);

106 
	gedge_bufãr_æ©
& 
	gİ”©Ü
=(cÚ¡ 
edge_bufãr_æ©
&);

	@src/engine/dynamic_graphs/graphchi_dynamicgraph_engine.hpp

31 #iâdeà
GRAPHCHI_DYNAMICGRAPHENGINE_DEF


32 
	#GRAPHCHI_DYNAMICGRAPHENGINE_DEF


	)

34 
	~<¡dlib.h
>

35 
	~<veùÜ
>

37 
	~"’gše/g¿phchi_’gše.hµ
"

38 
	~"’gše/dyÇmic_g¿phs/edgebufãrs.hµ
"

39 
	~"logg”/logg”.hµ
"

42 
Çme¥aû
 
	gg¿phchi
 {

48 
	g‹m¶©e
 <
ty³Çme
 
	gV”‹xD©aTy³
,y³Çm
	gEdgeD©aTy³
,y³Çm
	gsv”‹x_t
 = 
g¿phchi_v”‹x
<
V”‹xD©aTy³
, EdgeDataType> >

49 
şass
 
	gg¿phchi_dyÇmicg¿ph_’gše
 : 
public
 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
, 
	gsv”‹x_t
> {

50 
	gpublic
:

51 
g¿phchi_’gše
<
	tV”‹xD©aTy³
, 
	tEdgeD©aTy³
> 
	tba£_’gše
;

52 
	gedge_bufãr_æ©
<
	tEdgeD©aTy³
> 
	tedge_bufãr
;

54 
g¿phchi_dyÇmicg¿ph_’gše
(
¡d
::
¡ršg
 
ba£_f’ame
, 
nsh¬ds
, 
boŞ
 
£Ëùive_schedulšg
, 
m‘rics
 &
_m
) :

55 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
, 
	gsv”‹x_t
>(
	gba£_f’ame
, 
	gnsh¬ds
, 
	g£Ëùive_schedulšg
, 
	g_m
){

56 
	g_m
.
£t
("engine", "dynamicgraphs");

57 
	gadded_edges
 = 0;

58 
	gmaxsh¬dsize
 = 200 * 1024 * 1024;

61 
	g´Ùeùed
:

66 
¡d
::
veùÜ
< std::veùÜ< 
edge_bufãr
 * > > 
Ãw_edge_bufãrs
;

67 
	g¡d
::
veùÜ
<> 
d–‘ecouÁs
;

68 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
sh¬d_suffiûs
;

70 
vid_t
 
	gmax_v”‹x_id
;

71 
size_t
 
	gmax_edge_bufãr
;

72 
size_t
 
	gÏ¡_comm™
;

73 
size_t
 
	gadded_edges
;

74 
	g¡d
::
¡ršg
 
¡©e
;

75 
size_t
 
	gmaxsh¬dsize
;

76 
size_t
 
	gedges_š_sh¬ds
;

77 
size_t
 
	gÜig_edges
;

82 
mu‹x
 
	gscheduË¾ock
;

83 
mu‹x
 
	gsh¬dlock
;

88 
vœtu®
 
boŞ
 
di§bË_´–ßdšg
() {

89  
	gŒue
;

95 
vœtu®
 
deg»e_d©a
 * 
ü—‹_deg»e_hªdËr
() {

97 
	g¡d
::
¡ršg
 
Üig_deg»e_fe
 = 
f’ame_deg»e_d©a
(
this
->
ba£_f’ame
);

98 
	g¡d
::
¡ršg
 
dynsuffix
 = ".dynamic";

99 
	g¡d
::
¡ršg
 
dyÇmic_deg»e_fe
 = 
f’ame_deg»e_d©a
(
this
->
ba£_f’ame
 + 
dynsuffix
);

100 
ı
(
Üig_deg»e_fe
, 
dyÇmic_deg»e_fe
);

101  
Ãw
 
deg»e_d©a
(
this
->
ba£_f’ame
 + 
dynsuffix
,his->
iomgr
);

103 
vœtu®
 
size_t
 
num_edges
() {

104 
	gsh¬dlock
.
lock
();

105 
size_t
 
	gÃ
 = 0;

106 
	gi
=0; i < 
	gthis
->
	gnsh¬ds
; i++) {

107 
	gÃ
 +ğ
this
->
¦idšg_sh¬ds
[
i
]->
num_edges
();

108 
	gj
=0; j < (è
	gÃw_edge_bufãrs
[
i
].
size
(); j++)

109 
	gÃ
 +ğ
Ãw_edge_bufãrs
[
i
][
j
]->
size
();

111 
	gsh¬dlock
.
uÆock
();

112  
	gÃ
;

115 
	gpublic
:

117 
size_t
 
num_edges_§ã
() {

118  
added_edges
 + 
Üig_edges
;

121 
size_t
 
num_bufã»d_edges
() {

122  
	gadded_edges
 - 
	gÏ¡_comm™
;

125 
	g´Ùeùed
:

126 
š™_bufãrs
() {

127 
max_edge_bufãr
 = 
g‘_İtiÚ_lÚg
("max_edgebufãr_mb", 1000è* 1024 * 1024 / (
	gü—‹d_edge
<
	gEdgeD©aTy³
>);

130 
	g¡d
::
veùÜ
< 
¡d
::veùÜ< 
edge_bufãr
 * > > 
tmp_Ãw_edge_bufãrs
;

131 
	gi
=0; i < 
	gthis
->
	gnsh¬ds
; i++) {

132 
	g¡d
::
veùÜ
<
edge_bufãr
 *> 
sh¬dbufãrs
 = 
¡d
::vector<edge_buffer *>();

133 
	gj
=0; j < 
	gthis
->
	gnsh¬ds
; j++) {

134 
	gsh¬dbufãrs
.
push_back
(
Ãw
 
edge_bufãr
());

136 
	gtmp_Ãw_edge_bufãrs
.
push_back
(
sh¬dbufãrs
);

141 
	gi
 = 0;

142 
ty³Çme
 
	g¡d
::
veùÜ
< 
¡d
::veùÜ< 
edge_bufãr
 * > >::
™”©Ü
 
Şd™
 = 
Ãw_edge_bufãrs
.
begš
();

143 
	gŞd™
 !ğ
Ãw_edge_bufãrs
.
’d
(); ++oldit) {

144 
ty³Çme
 
	g¡d
::
veùÜ
< 
edge_bufãr
 *>::
™”©Ü
 
buf™
 = 
Şd™
->
begš
(); 
	gbuf™
 !ğŞd™->
’d
(); ++bufit) {

145 
	gedge_bufãr
 &
	gbufãr_fÜ_wšdow
 = **
buf™
;

146 
	gebi
 = 0;ƒb˜< 
	gbufãr_fÜ_wšdow
.
size
();ƒbi++ ) {

147 
	gü—‹d_edge
<
	gEdgeD©aTy³
> * 
	gedge
 = 
bufãr_fÜ_wšdow
[
ebi
];

148 
	gsh¬d
 = 
g‘_sh¬d_fÜ
(
edge
->
d¡
);

149 
	g¤csh¬d
 = 
g‘_sh¬d_fÜ
(
edge
->
¤c
);

150 
	gi
++;

151 
	gtmp_Ãw_edge_bufãrs
[
sh¬d
][
¤csh¬d
]->
add
(*
edge
);

153 
d–‘e
 *
	gbuf™
;

157 
	g¡d
::
cout
 << "TRANSFERRED " << 
i
 << " EDGES OVER." << 
¡d
::
’dl
;

159 
	gÃw_edge_bufãrs
 = 
tmp_Ãw_edge_bufãrs
;

167 
size_t
 
ı
(
¡d
::
¡ršg
 
Üigfe
, std::¡ršg 
d¡fe
, 
boŞ
 
z”oout
=
çl£
) {

168 * 
buf
;

169 
	gf
 = 
İ’
(
Üigfe
.
c_¡r
(), 
O_RDONLY
);

170 
size_t
 
	gËn
 = 
»adfuÎ
(
f
, &
buf
);

171 
	g¡d
::
cout
 << "L’gth: " << 
Ën
 << 
¡d
::
’dl
;

172 
	g¡d
::
cout
 << 
Üigfe
 << " ----> " << 
d¡fe
 << 
¡d
::
’dl
;

174 
şo£
(
f
);

175 
»move
(
d¡fe
.
c_¡r
());

176 
	gof
 = 
İ’
(
d¡fe
.
c_¡r
(), 
O_WRONLY
 | 
O_CREAT
, 
S_IROTH
 | 
S_IWOTH
 | 
S_IWUSR
 | 
S_IRUSR
);

177 
as£¹
(
of
 >= 0);

178 ià(
	gz”oout
) {

179 
mem£t
(
buf
, 0, 
Ën
);

181 
wr™—
(
of
, 
buf
, 
Ën
);

183 
as£¹
(
g‘_fesize
(
Üigfe
è=ğg‘_fesize(
d¡fe
));

184 
şo£
(
of
);

185 
ä“
(
buf
);

186  
	gËn
;

190 
ıed©a
(
¡d
::
¡ršg
 
Üigfe
, std::¡ršg 
d¡fe
, 
boŞ
 
z”oout
=
çl£
) {

191 
ı
(
Üigfe
 + ".size", 
d¡fe
 + ".size");

192 
	g¡d
::
¡ršg
 
dœÇme
 = 
dœÇme_sh¬d_ed©a_block
(
d¡fe
, 
ba£_’gše
::
blocksize
);

193 
mkdœ
(
dœÇme
.
c_¡r
(), 0777);

194 
size_t
 
	ged©asize
 = 
g‘_sh¬d_ed©a_fesize
<
EdgeD©aTy³
>(
Üigfe
);

195 
	gnblocks
 = (è((
ed©asize
 / 
ba£_’gše
::
blocksize
) + (edatasize % base_engine::blocksize == 0 ? 0 : 1));

196 
	gi
=0; i < 
	gnblocks
; i++) {

197 
	g¡d
::
¡ršg
 
ÜigblockÇme
 = 
f’ame_sh¬d_ed©a_block
(
Üigfe
, 
i
, 
ba£_’gše
::
blocksize
);

198 
	g¡d
::
¡ršg
 
d¡blockÇme
 = 
f’ame_sh¬d_ed©a_block
(
d¡fe
, 
i
, 
ba£_’gše
::
blocksize
);

199 
ı
(
ÜigblockÇme
, 
d¡blockÇme
);

204 
vœtu®
 
ty³Çme
 
	gba£_’gše
::
memsh¬d_t
 * 
ü—‹_memsh¬d
(
vid_t
 
š‹rv®_¡
, vid_ˆ
š‹rv®_’
) {

205 
	gp
 = 
this
->
exec_š‹rv®
;

206 
	g¡d
::
¡ršg
 
adj_f’ame
 = 
f’ame_sh¬d_adj
(
this
->
ba£_f’ame
, 0, 0è+ ".dyng¿ph" + 
	gsh¬d_suffiûs
[
p
];

207 
	g¡d
::
¡ršg
 
ed©a_f’ame
 = 
f’ame_sh¬d_ed©a
<
EdgeD©aTy³
>(
this
->
ba£_f’ame
, 0, 0è+ ".dyng¿ph" + 
	gsh¬d_suffiûs
[
p
];

208  
Ãw
 
ty³Çme
 
	gba£_’gše
::
memsh¬d_t
(
this
->
iomgr
,

209 
ed©a_f’ame
,

210 
adj_f’ame
,

211 
š‹rv®_¡
,

212 
š‹rv®_’
,

213 
ba£_’gše
::
blocksize
,

214 
this
->
m
);

221 
vœtu®
 
š™Ÿlize_¦idšg_sh¬ds
() {

222 
	g¡©e
 = "initialize-shards";

223 
	gsh¬dlock
.
lock
();

224 ià(
	gthis
->
	g¦idšg_sh¬ds
.
em±y
()) {

225 
	gp
=0;… < 
	gthis
->
	gnsh¬ds
;…++) {

226 
	g¡d
::
¡ršg
 
adj_f’ame
 = 
f’ame_sh¬d_adj
(
this
->
ba£_f’ame
, 0, 0è+ ".dyng¿ph" + 
	gsh¬d_suffiûs
[
p
];

227 
	g¡d
::
¡ršg
 
ed©a_f’ame
 = 
f’ame_sh¬d_ed©a
<
EdgeD©aTy³
>(
this
->
ba£_f’ame
, 0, 0è+ ".dyng¿ph" + 
	gsh¬d_suffiûs
[
p
];

229 
	gthis
->
	g¦idšg_sh¬ds
.
push_back
(

230 
Ãw
 
ty³Çme
 
ba£_’gše
::
¦idšgsh¬d_t
(
this
->
iomgr
, 
ed©a_f’ame
,

231 
adj_f’ame
,

232 
this
->
š‹rv®s
[
p
].
fœ¡
,

233 
this
->
š‹rv®s
[
p
].
£cÚd
,

234 
this
->
blocksize
,

235 
this
->
m
,

236 !
this
->
modif›s_ou‹dges
,

237 
çl£
));

240 
	gp
=0;… < 
	gthis
->
	gnsh¬ds
;…++) {

241 ià(
	gthis
->
	g¦idšg_sh¬ds
[
p
] =ğ
NULL
) {

242 
¡d
::
¡ršg
 
adj_f’ame
 = 
f’ame_sh¬d_adj
(
this
->
ba£_f’ame
, 0, 0è+ ".dyng¿ph" + 
	gsh¬d_suffiûs
[
p
];

243 
	g¡d
::
¡ršg
 
ed©a_f’ame
 = 
f’ame_sh¬d_ed©a
<
EdgeD©aTy³
>(
this
->
ba£_f’ame
, 0, 0è+ ".dyng¿ph" + 
	gsh¬d_suffiûs
[
p
];

245 
	gthis
->
	g¦idšg_sh¬ds
[
p
] = 
Ãw
 
ty³Çme
 
ba£_’gše
::
¦idšgsh¬d_t
(
this
->
iomgr
, 
ed©a_f’ame
,

246 
adj_f’ame
,

247 
this
->
š‹rv®s
[
p
].
fœ¡
,

248 
this
->
š‹rv®s
[
p
].
£cÚd
,

249 
this
->
blocksize
,

250 
this
->
m
,

251 !
this
->
modif›s_ou‹dges
,

252 
çl£
);

256 
	gsh¬dlock
.
uÆock
();

257 
	gedges_š_sh¬ds
 = 
num_edges
();

258 ià(
	gÜig_edges
 =ğ0è
Üig_edges
 = 
edges_š_sh¬ds
;

261 
´•¬e_ş—n_¦©e
() {

262 
log¡»am
(
LOG_INFO
è<< "P»·ršg cËª sÏ‹..." << 
	g¡d
::
’dl
;

263 
	gsh¬d
=0; sh¬d < 
	gthis
->
	gnsh¬ds
; shard++) {

264 
	gsh¬d_suffiûs
.
push_back
(
g‘_·¹_¡r
(
sh¬d
, 
this
->
nsh¬ds
));

266 
	g¡d
::
¡ršg
 
ed©a_f’ame
 = 
f’ame_sh¬d_ed©a
<
EdgeD©aTy³
>(
this
->
ba£_f’ame
, 
	gsh¬d
, 
	gthis
->
	gnsh¬ds
);

267 
	g¡d
::
¡ršg
 
adj_f’ame
 = 
f’ame_sh¬d_adj
(
this
->
ba£_f’ame
, 
sh¬d
,his->
nsh¬ds
);

268 
	g¡d
::
¡ršg
 
de¡_adj
 = 
f’ame_sh¬d_adj
(
this
->
ba£_f’ame
, 0, 0è+ ".dyng¿ph" + 
	gsh¬d_suffiûs
[
sh¬d
];

269 
	g¡d
::
¡ršg
 
de¡_ed©a
 = 
f’ame_sh¬d_ed©a
<
EdgeD©aTy³
>(
this
->
ba£_f’ame
, 0, 0è+ ".dyng¿ph" + 
	gsh¬d_suffiûs
[
sh¬d
];

271 
ıed©a
(
ed©a_f’ame
, 
de¡_ed©a
, 
Œue
);

272 
ı
(
adj_f’ame
, 
de¡_adj
);

276 
g‘_sh¬d_fÜ
(
vid_t
 
d¡
) {

277 
	gi
=0; i < 
	gthis
->
	gnsh¬ds
; i++) {

278 ià(
	gd¡
 >ğ
this
->
š‹rv®s
[
i
].
fœ¡
 && 
d¡
 <ğthis->š‹rv®s[i].
£cÚd
) {

279  
i
;

282  
	gthis
->
	gnsh¬ds
 - 1;

285 
	gpublic
:

286 
boŞ
 
add_edge
(
vid_t
 
¤c
, vid_ˆ
d¡
, 
EdgeD©aTy³
 
ed©a
) {

287 ià(
	g¤c
 =ğ
d¡
) {

288 
log¡»am
(
LOG_WARNING
è<< "WARNING :r›dØadd s–f-edge!" << 
¡d
::
’dl
;

289  
	gŒue
;

291 ià(
	gthis
->
	g™”
 < 1) {

292 
log¡»am
(
LOG_WARNING
è<< "Tr›dØaddƒdgbefÜfœ¡ i‹¿tiÚ ha ·s£d" << 
	g¡d
::
’dl
;

293 
u¦“p
(1000000);

294  
	gçl£
;

296 ià(
	gadded_edges
 - 
	gÏ¡_comm™
 > 1.2 * 
	gmax_edge_bufãr
) {

297 
log¡»am
(
LOG_INFO
è<< "Ov” 20% oàmax bufãr... hŞd on...." << 
	g¡d
::
’dl
;

298 
u¦“p
(1000000);

299  
	gçl£
;

301 
	gthis
->
	gmodifiÿtiÚ_lock
.
lock
();

302 
	gadded_edges
++;

303 
	gsh¬d
 = 
g‘_sh¬d_fÜ
(
d¡
);

304 
	g¤csh¬d
 = 
g‘_sh¬d_fÜ
(
¤c
);

306 
vid_t
 
	g´ev_max_id
 = 
max_v”‹x_id
;

307 
	gmax_v”‹x_id
 = 
¡d
::
max
(
max_v”‹x_id
, 
d¡
);

308 
	gmax_v”‹x_id
 = 
¡d
::
max
(
max_v”‹x_id
, 
¤c
);

311 ià(
	gmax_v”‹x_id
>
	g´ev_max_id
) {

312 
	gthis
->
	gdeg»e_hªdËr
->
’su»_size
(
this
->
max_v”‹x_id
);

315 ià(
	gthis
->
	gscheduËr
 !ğ
NULL
) {

316 
scheduË¾ock
.
lock
();

317 
	gthis
->
	gscheduËr
->
»size
(1 + 
max_v”‹x_id
);

318 
	gscheduË¾ock
.
uÆock
();

323 
	gÃw_edge_bufãrs
[
sh¬d
][
¤csh¬d
]->
add
(
¤c
, 
d¡
, 
ed©a
);

324 
	gthis
->
	gmodifiÿtiÚ_lock
.
uÆock
();

325  
	gŒue
;

328 
add_sk
(
vid_t
 
vid
) {

329 ià(
	gthis
->
	gscheduËr
 !ğ
NULL
) {

330 
this
->
modifiÿtiÚ_lock
.
lock
();

331 
	gthis
->
	gscheduËr
->
add_sk
(
vid
);

332 
	gthis
->
	gmodifiÿtiÚ_lock
.
uÆock
();

336 
	g´Ùeùed
:

337 
šcÜpÜ©e_bufã»d_edges
(
wšdow
, 
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
¡d
::
veùÜ
<
sv”‹x_t
> & 
v”tiûs
) {

339 
nü—‹d
 = 0;

341 
	gsh¬d
=0; sh¬d<
	gthis
->
	gnsh¬ds
; shard++) {

342 
	gedge_bufãr
 &
	gbufãr_fÜ_wšdow
 = *
Ãw_edge_bufãrs
[
sh¬d
][
wšdow
];

343 
	gebi
=0;ƒbi<
	gbufãr_fÜ_wšdow
.
size
();ƒbi++) {

344 
	gü—‹d_edge
<
	gEdgeD©aTy³
> * 
	gedge
 = 
bufãr_fÜ_wšdow
[
ebi
];

345 ià(
	gedge
->
	g¤c
 >ğ
wšdow_¡
 && 
edge
->
¤c
 <ğ
wšdow_’
) {

346 ià(
v”tiûs
[
edge
->
¤c
-
wšdow_¡
].
scheduËd
) {

347 ià(
v”tiûs
[
edge
->
¤c
-
wšdow_¡
].
scheduËd
)

348 
v”tiûs
[
edge
->
¤c
-
wšdow_¡
].
add_ou‹dge
Ódge->
d¡
, &edge->
d©a
, 
çl£
);

349 
	gnü—‹d
++;

356 
	gw
=0; w<
	gthis
->
	gnsh¬ds
; w++) {

357 
	gedge_bufãr
 &
	gbufãr_fÜ_wšdow
 = *
Ãw_edge_bufãrs
[
wšdow
][
w
];

358 
	gebi
=0;ƒbi<
	gbufãr_fÜ_wšdow
.
size
();ƒbi++) {

359 
	gü—‹d_edge
<
	gEdgeD©aTy³
> * 
	gedge
 = 
bufãr_fÜ_wšdow
[
ebi
];

360 ià(
	gedge
->
	gd¡
 >ğ
wšdow_¡
 && 
edge
->
d¡
 <ğ
wšdow_’
) {

361 ià(
v”tiûs
[
edge
->
d¡
 - 
wšdow_¡
].
scheduËd
) {

362 
as£¹
(
edge
->
d©a
 < 1e20);

363 ià(
	gv”tiûs
[
edge
->
d¡
-
wšdow_¡
].
	gscheduËd
)

364 
	gv”tiûs
[
edge
->
d¡
 - 
wšdow_¡
].
add_šedge
Ódge->
¤c
, &edge->
d©a
, 
çl£
);

365 
	gnü—‹d
++;

370 
log¡»am
(
LOG_INFO
è<< "::: U£d " << 
	gnü—‹d
 << " bufã»dƒdges." << 
	g¡d
::
’dl
;

373 
boŞ
 
šcÜpÜ©e_Ãw_edge_deg»es
(
wšdow
, 
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
) {

374 
boŞ
 
	gmodif›d
 = 
çl£
;

376 
	gsh¬d
=0; sh¬d < 
	gthis
->
	gnsh¬ds
; shard++) {

377 
	gedge_bufãr
 &
	gbufãr_fÜ_wšdow
 = *
Ãw_edge_bufãrs
[
sh¬d
][
wšdow
];

378 
	gebi
=0;ƒbi<
	gbufãr_fÜ_wšdow
.
size
();ƒbi++) {

379 
	gü—‹d_edge
<
	gEdgeD©aTy³
> * 
	gedge
 = 
bufãr_fÜ_wšdow
[
ebi
];

380 ià(
	gedge
->
	g¤c
 >ğ
wšdow_¡
 && 
edge
->
¤c
 <ğ
wšdow_’
) {

381 ià(!
edge
->
accouÁed_fÜ_outc
) {

382 
deg»e
 
d
 = 
this
->
deg»e_hªdËr
->
g‘_deg»e
(
edge
->
¤c
);

383 
	gd
.
	goutdeg»e
++;

384 
	gthis
->
	gdeg»e_hªdËr
->
£t_deg»e
(
edge
->
¤c
, 
d
);

386 
	gmodif›d
 = 
Œue
;

387 
	gedge
->
	gaccouÁed_fÜ_outc
 = 
Œue
;

394 
	gw
=0; w < 
	gthis
->
	gnsh¬ds
; w++) {

395 
	gedge_bufãr
 &
	gbufãr_fÜ_wšdow
 = *
Ãw_edge_bufãrs
[
wšdow
][
w
];

396 
	gebi
=0;ƒbi<
	gbufãr_fÜ_wšdow
.
size
();ƒbi++) {

397 
	gü—‹d_edge
<
	gEdgeD©aTy³
> * 
	gedge
 = 
bufãr_fÜ_wšdow
[
ebi
];

398 ià(
	gedge
->
	gd¡
 >ğ
wšdow_¡
 && 
edge
->
d¡
 <ğ
wšdow_’
) {

399 ià(!
edge
->
accouÁed_fÜ_šc
) {

400 
deg»e
 
d
 = 
this
->
deg»e_hªdËr
->
g‘_deg»e
(
edge
->
d¡
);

401 
	gd
.
	gšdeg»e
++;

402 
	gthis
->
	gdeg»e_hªdËr
->
£t_deg»e
(
edge
->
d¡
, 
d
);

403 
	gedge
->
	gaccouÁed_fÜ_šc
 = 
Œue
;

404 
	gmodif›d
 = 
Œue
;

409  
	gmodif›d
;

412 
adju¡_deg»es_fÜ_d–‘ed
(
¡d
::
veùÜ
< 
sv”‹x_t
 > &
v”tiûs
, 
vid_t
 
wšdow_¡
) {

413 #ifdeà
SUPPORT_DELETIONS


415 
boŞ
 
	gsomechªged
 = 
çl£
;

416 
	gi
=0; i < ()
	gv”tiûs
.
size
(); i++) {

417 
	gsv”‹x_t
 &
	gv
 = 
v”tiûs
[
i
];

418 ià(
	gv
.
	gscheduËd
) {

419 
	gthis
->
	gdeg»e_hªdËr
->
£t_deg»e
(
v
.
id
(), v.
šc
, v.
outc
);

420 
	gsomechªged
 = 
somechªged
 || (
v
.
d–‘ed_šc
 + v.
d–‘ed_outc
 > 0);

421 
deg»e
 
	gdeg
 = 
this
->
deg»e_hªdËr
->
g‘_deg»e
(
v
.
id
());

423 ià(!(
	gdeg
.
	gšdeg»e
 >=0 && 
deg
.
outdeg»e
 >= 0)) {

424 
¡d
::
cout
 << "Deg»disü•ªcy: " << 
deg
.
šdeg»e
 << " " << deg.
outdeg»e
 << std::
’dl
;

426 
as£¹
(
deg
.
šdeg»e
 >=0 && deg.
outdeg»e
 >= 0);

429 ià(
	gsomechªged
) {

430 
	gthis
->
	gdeg»e_hªdËr
->
§ve
();

435 
vœtu®
 
vid_t
 
d‘”mše_Ãxt_wšdow
(vid_ˆ
iš‹rv®
, vid_ˆ
äomvid
, vid_ˆ
maxvid
, 
size_t
 
membudg‘
) {

437 
	gthis
->
	gdeg»e_hªdËr
->
lßd
(
äomvid
, 
maxvid
);

438 ià(
šcÜpÜ©e_Ãw_edge_deg»es
(
iš‹rv®
, 
äomvid
, 
maxvid
)) {

439 
	gthis
->
	gdeg»e_hªdËr
->
§ve
();

442 
size_t
 
	gmem»q
 = 0;

443 
	gmax_š‹rv®
 = 
maxvid
 - 
äomvid
;

444 
	gi
=0; i < 
	gmax_š‹rv®
; i++) {

445 
deg»e
 
	gdeg
 = 
this
->
deg»e_hªdËr
->
g‘_deg»e
(
äomvid
 + 
i
);

446 
	gšc
 = 
deg
.
šdeg»e
;

447 
	goutc
 = 
deg
.
outdeg»e
;

450 
	gmem»q
 +ğ(
sv”‹x_t
è+ ((
EdgeD©aTy³
è+ (
vid_t
) +

451 (
g¿phchi_edge
<
EdgeD©aTy³
>))*(
outc
 + 
šc
);

452 ià(
	gmem»q
 > 
	gmembudg‘
) {

453  
	gäomvid
 + 
	gi
 - 1;

456  
	gmaxvid
;

460 
vœtu®
 
lßd_befÜe_upd©es
(
¡d
::
veùÜ
<
sv”‹x_t
> &
v”tiûs
) {

461 
¡©e
 = "load-edges";

463 
	gthis
->
	gba£_’gše
::
lßd_befÜe_upd©es
(
v”tiûs
);

465 #ifdeà
SUPPORT_DELETIONS


466 
	gi
=0; i < ()
	gv”tiûs
.
size
(); i++) {

467 
	gd–‘ecouÁs
[
this
->
exec_š‹rv®
] +ğ
v”tiûs
[
i
].
d–‘ed_šc
;

471 
	g¡©e
 = "execute-updates";

475 
vœtu®
 
š™_v”tiûs
(
¡d
::
veùÜ
<
sv”‹x_t
> &
v”tiûs
, 
g¿phchi_edge
<
EdgeD©aTy³
> * &
ed©a
) {

476 
	gba£_’gše
::
š™_v”tiûs
(
v”tiûs
, 
ed©a
);

477 
šcÜpÜ©e_bufã»d_edges
(
this
->
exec_š‹rv®
,his->
sub_š‹rv®_¡
,his->
sub_š‹rv®_’
, 
v”tiûs
);

481 
vœtu®
 
š™Ÿlize_™”
() {

482 
	gthis
->
	gš‹rv®s
[
this
->
nsh¬ds
 - 1].
	g£cÚd
 = 
max_v”‹x_id
;

483 
	gthis
->
	gv”‹x_d©a_hªdËr
->
check_size
(
max_v”‹x_id
 + 1);

484 
š™Ÿlize_¦idšg_sh¬ds
();

487 
	gd–‘ecouÁs
.
ş—r
();

488 
	gp
=0;… < 
	gthis
->
	gnsh¬ds
;…++)

489 
	gd–‘ecouÁs
.
push_back
(0);

492 
vœtu®
 
™”©iÚ_fšished
() {

493 ià(
	gthis
->
	g™”
 <his->
	gn™”s
 - 1) {

495 
	gp
=0;… < 
	gthis
->
	gnsh¬ds
;…++) {

496 
	gthis
->
	g¦idšg_sh¬ds
[
p
]->
æush
();

497 
	gthis
->
	g¦idšg_sh¬ds
[
p
]->
£t_off£t
(0, 0, 0);

500 
	gthis
->
	giomgr
->
wa™_fÜ_wr™es
();

502 
comm™_g¿ph_chªges
();

506 
vœtu®
 
š™Ÿlize_befÜe_run
() {

507 
´•¬e_ş—n_¦©e
();

508 
š™_bufãrs
();

510 
	gmax_v”‹x_id
 = (
vid_t
è(
this
->
num_v”tiûs
() - 1);

512 
	gthis
->
	gv”‹x_d©a_hªdËr
->
ş—r
(
this
->
num_v”tiûs
());

513 
	gÜig_edges
 = 0;

518 
vœtu®
 
lßd_aá”_upd©es
(
¡d
::
veùÜ
<
sv”‹x_t
> &
v”tiûs
) {

519 
this
->
ba£_’gše
::
lßd_aá”_upd©es
(
v”tiûs
);

520 
adju¡_deg»es_fÜ_d–‘ed
(
v”tiûs
, 
this
->
sub_š‹rv®_¡
);

523 
	gpublic
:

524 
fšish_aá”_™”s
(
exŒa_™”s
) {

525 
this
->
chicÚ‹xt
.
Ï¡_™”©iÚ
 =his->chicÚ‹xt.
™”©iÚ
 + 
exŒa_™”s
;

528 
	g´Ùeùed
:

531 
	#BBUF
 32000000

	)

536 
comm™_g¿ph_chªges
() {

538 
size_t
 
nd–‘ed
 = 0;

539 
size_t
 
	gi
=0; i < 
	gd–‘ecouÁs
.
size
(); i++) {

540 
	gnd–‘ed
 +ğ
d–‘ecouÁs
[
i
];

545 
log¡»am
(
LOG_DEBUG
è<< "TÙ® d–‘ed: " << 
	gnd–‘ed
 << "Ù®ƒdges: " << 
	gthis
->
num_edges
(è<< 
	g¡d
::
’dl
;

547 ià(
	gadded_edges
 - 
	gÏ¡_comm™
 < 
	gmax_edge_bufãr
 * 0.8 && 
	gnd–‘ed
 < 
	gthis
->
num_edges
() * 0.1) {

548 
	g¡d
::
cout
 << "==============================" << 
¡d
::
’dl
;

549 
	g¡d
::
cout
 << "NØtimtØcomm™ y‘.... OÆy " << (
added_edges
 - 
Ï¡_comm™
è<< " / " << 
max_edge_bufãr


550 << " iÀbufãrs" << 
¡d
::
’dl
;

555 
boŞ
 
	g¿ngeschªged
 = 
çl£
;

556 
	g¡©e
 = "commit-ingests";

557 
vid_t
 
	gmaxwšdow
 = 4000000;

558 
size_t
 
	gmem_budg‘
 = 
this
->
membudg‘_mb
 * 1024 * 1024;

559 
	gthis
->
	gmodifiÿtiÚ_lock
.
lock
();

564 
	g¡d
::
veùÜ
<> 
edge¥”sh¬d
;

565 
	gp
=0;… < 
	gthis
->
	gnsh¬ds
;…++) {

566 
	gedge¥”sh¬d
.
push_back
(
this
->
¦idšg_sh¬ds
[
p
]->
num_edges
());

569 
	g¡d
::
veùÜ
<
¡d
::
·œ
<
vid_t
, 
	gvid_t
> > 
	gÃw¿nges
;

570 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
Ãwsuffiûs
;

572 
	g™”¡r
[128];

573 
¥rštf
(
™”¡r
, "%d", 
this
->
™”
);

575 
size_t
 
	gmš_bufãr_š_sh¬d_to_comm™
 = 
max_edge_bufãr
 / 
this
->
nsh¬ds
 / 2;

577 
	g¡d
::
veùÜ
<
boŞ
> 
was_comm™ed
(
this
->
nsh¬ds
, 
Œue
);

579 
	gsh¬d
=0; sh¬d < 
	gthis
->
	gnsh¬ds
; shard++) {

580 
	g¡d
::
veùÜ
<
edge_bufãr
*> &
sh¬d_bufãr
 = 
Ãw_edge_bufãrs
[
sh¬d
];

583 
size_t
 
	gbuãdges
 = 0;

584 
	gw
=0; w < 
	gthis
->
	gnsh¬ds
; w++) {

585 
	gbuãdges
 +ğ
sh¬d_bufãr
[
w
]->
size
();

589 ià(
	gbuãdges
 < 
	gmš_bufãr_š_sh¬d_to_comm™
 && 
	gd–‘ecouÁs
[
sh¬d
] * 1.0 / 
	gedge¥”sh¬d
[shard] < 0.2) {

590 
log¡»am
(
LOG_DEBUG
è<< 
	gsh¬d
 << ":‚Ùƒnoughƒdge fÜ sh¬d: " << 
	gbuãdges
 << " d–‘ed:" << 
	gd–‘ecouÁs
[
sh¬d
] << "/" << 
	gedge¥”sh¬d
[sh¬d] << 
	g¡d
::
’dl
;

591 
	gÃw¿nges
.
push_back
(
this
->
š‹rv®s
[
sh¬d
]);

592 
	gÃwsuffiûs
.
push_back
(
sh¬d_suffiûs
[
sh¬d
]);

593 
	gwas_comm™ed
[
sh¬d
] = 
çl£
;

596 
log¡»am
(
LOG_DEBUG
è<< 
	gsh¬d
 << ": gošgØ»wr™e, d–‘ed:" << 
	gd–‘ecouÁs
[
sh¬d
] << "/" << 
	gedge¥”sh¬d
[sh¬d] << " buãdges: " << 
	gbuãdges
 << 
	g¡d
::
’dl
;

597 
	gsh¬dlock
.
lock
();

598 
d–‘e
 
	gthis
->
	g¦idšg_sh¬ds
[
sh¬d
];

599 
	gthis
->
	g¦idšg_sh¬ds
[
sh¬d
] = 
NULL
;

600 
	gsh¬dlock
.
uÆock
();

602 
	g¡d
::
¡ršg
 
Üigsh¬dfe
 = 
f’ame_sh¬d_ed©a
<
EdgeD©aTy³
>(
this
->
ba£_f’ame
, 0, 0è+ ".dyng¿ph" + 
	gsh¬d_suffiûs
[
sh¬d
];

603 
	g¡d
::
¡ršg
 
Üigadjfe
 = 
f’ame_sh¬d_adj
(
this
->
ba£_f’ame
, 0, 0è+ ".dyng¿ph" + 
	gsh¬d_suffiûs
[
sh¬d
];

606 
off_t
 
	gsz
 = 
g‘_sh¬d_ed©a_fesize
<
EdgeD©aTy³
>(
Üigsh¬dfe
);

608 
	gou¬ts
 = ( 
sz
 >ğ(
off_t
è
maxsh¬dsize
 ? 2 : 1);

610 
vid_t
 
	g¥l™pos
 = 0;

611 
	g¡d
::
cout
 << "Size: " << 
sz
 << " vs. maxsh¬dsize: " << 
maxsh¬dsize
 << 
¡d
::
’dl
;

612 ià(
	gsz
 > (
	goff_t
)
	gmaxsh¬dsize
) {

613 
	g¿ngeschªged
 = 
Œue
;

615 
size_t
 
	gh®ãdges
 = (
sz
 / (
EdgeD©aTy³
)) / 2;

617 
	gw
=0; w < 
	gthis
->
	gnsh¬ds
; w++) {

618 
	gh®ãdges
 +ğ
Ãw_edge_bufãrs
[
sh¬d
][
w
]->
size
() / 2;

620 
size_t
 
	gÃdges
 = 0;

622 
vid_t
 
	g¡
 = 
this
->
š‹rv®s
[
sh¬d
].
fœ¡
;

623 
	g¥l™pos
 = 
¡
 + (
this
->
š‹rv®s
[
sh¬d
].
£cÚd
 - st) / 2;

624 
boŞ
 
	gfound
 = 
çl£
;

625 
	g¡
 < 
	gthis
->
	gš‹rv®s
[
sh¬d
].
	g£cÚd
) {

626 
vid_t
 
	g’
 = 
¡d
::
mš
(
¡
 + 
maxwšdow
, 
this
->
š‹rv®s
[
sh¬d
].
£cÚd
);

627 
	gthis
->
	gdeg»e_hªdËr
->
lßd
(
¡
, 
’
);

628 
	gnv
 = 
’
 - 
¡
 + 1;

630 
	gi
=0; i<
	gnv
; i++) {

631 
	gÃdges
 +ğ
this
->
deg»e_hªdËr
->
g‘_deg»e
(
¡
 + 
i
).
šdeg»e
;

632 ià(
	gÃdges
 >ğ
h®ãdges
) {

633 
¥l™pos
 = 
i
+
¡
-1;

634 
	gfound
 = 
Œue
;

638 ià(
	gfound
) ;

639 
	g¡
 = 
’
+1;

641 
as£¹
(
¥l™pos
 > 
this
->
š‹rv®s
[
sh¬d
].
fœ¡
 && s¶™po <his->š‹rv®s[sh¬d].
£cÚd
);

644 
	g¥l™s
=0; s¶™s<
	gou¬ts
; splits++) {

645 
ty³Çme
 
	gba£_’gše
::
¦idšgsh¬d_t
 * 
cursh¬d
 =

646 
Ãw
 
ty³Çme
 
ba£_’gše
::
¦idšgsh¬d_t
(
this
->
iomgr
, 
Üigsh¬dfe
, 
Üigadjfe
,

647 
this
->
š‹rv®s
[
sh¬d
].
fœ¡
,his->š‹rv®s[sh¬d].
£cÚd
,

648 
ba£_’gše
::
blocksize
, 
this
->
m
, 
Œue
);

651 
	g¡d
::
¡ršg
 
suffix
 = "";

652 
	g·¹¡r
[128];

653 
¥rštf
(
·¹¡r
, "%d", 
sh¬d
);

654 ià(
	g¥l™s
 == 0) {

655 
suffix
 = 
¡d
::
¡ršg
(
·¹¡r
);

657 
	gsuffix
 = 
¡d
::
¡ršg
(
·¹¡r
) + ".split";

659 
	gsuffix
 = 
suffix
 + ".i" + 
¡d
::
¡ršg
(
™”¡r
);

660 
	gÃwsuffiûs
.
push_back
(
suffix
);

661 
	g¡d
::
¡ršg
 
outfe_ed©a
 = 
f’ame_sh¬d_ed©a
<
EdgeD©aTy³
>(
this
->
ba£_f’ame
, 0, 0è+ ".dyng¿ph" + 
	gsuffix
;

662 
	g¡d
::
¡ršg
 
outfe_ed©a_dœÇme
 = 
dœÇme_sh¬d_ed©a_block
(
outfe_ed©a
, 
ba£_’gše
::
blocksize
);

663 
mkdœ
(
outfe_ed©a_dœÇme
.
c_¡r
(), 0777);

664 
	g¡d
::
¡ršg
 
outfe_adj
 = 
f’ame_sh¬d_adj
(
this
->
ba£_f’ame
, 0, 0è+ ".dyng¿ph" + 
	gsuffix
;

666 
vid_t
 
	g¥l™¡¬t
 = 
this
->
š‹rv®s
[
sh¬d
].
fœ¡
;

667 
vid_t
 
	g¥l™’d
 = 
this
->
š‹rv®s
[
sh¬d
].
£cÚd
;

668 ià(
	gsh¬d
 =ğ
this
->
nsh¬ds
 - 1è
¥l™’d
 = 
max_v”‹x_id
;

671 ià(
	gou¬ts
 == 2) {

672 ià(
¥l™s
==0è
¥l™’d
 = 
¥l™pos
;

673 
	g¥l™¡¬t
 = 
¥l™pos
+1;

675 
	gÃw¿nges
.
push_back
(
¡d
::
·œ
<
vid_t
,vid_t>(
¥l™¡¬t
, 
¥l™’d
));

678 
	gf
 = 
İ’
(
outfe_adj
.
c_¡r
(), 
O_WRONLY
 | 
O_CREAT
, 
S_IROTH
 | 
S_IWOTH
 | 
S_IWUSR
 | 
S_IRUSR
);

679 
	g”r
 = 
árunÿ‹
(
f
, 0);

680 ià(
	g”r
 != 0) {

681 
log¡»am
(
LOG_ERROR
è<< "E¼Ürunÿtšg " << 
outfe_adj
 << ",ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

683 
as£¹
(
”r
 == 0);

685 
	gef
 = 
İ’
(
outfe_ed©a
.
c_¡r
(), 
O_WRONLY
 | 
O_CREAT
, 
S_IROTH
 | 
S_IWOTH
 | 
S_IWUSR
 | 
S_IRUSR
);

686 
	g”r
 = 
árunÿ‹
(
ef
, 0);

687 ià(
	g”r
 != 0) {

688 
log¡»am
(
LOG_ERROR
è<< "E¼Ürunÿtšg " << 
outfe_ed©a
 << ",ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

690 
as£¹
(
”r
 == 0);

691 * 
	gbuf
 = (*è
m®loc
(
BBUF
);

692 * 
	gbuåŒ
 = 
buf
;

693 * 
	gebuf
 = (*è
m®loc
(
BBUF
);

694 * 
	gebuåŒ
 = 
ebuf
;

695 
size_t
 
	gtÙ_ed©aby‹s
 = 0;

698 
	gwšdow
=0; wšdow < 
	gthis
->
	gnsh¬ds
; window++) {

699 
vid_t
 
	g¿nge_¡
 = 
this
->
š‹rv®s
[
wšdow
].
fœ¡
;

700 
vid_t
 
	g¿nge_’
 = 
this
->
š‹rv®s
[
wšdow
].
£cÚd
;

701 ià(
	gwšdow
 =ğ
this
->
nsh¬ds
 - 1è
¿nge_’
 = 
max_v”‹x_id
;

702 
	gedge_bufãr
 &
	gbufãr_fÜ_wšdow
 = *
Ãw_edge_bufãrs
[
sh¬d
][
wšdow
];

704 
vid_t
 
	gwšdow_¡
=
¿nge_¡
; wšdow_¡<
	g¿nge_’
; ) {

706 
vid_t
 
	gwšdow_’
 = 
d‘”mše_Ãxt_wšdow
(
wšdow
, 
wšdow_¡
,

707 
¡d
::
mš
(
¿nge_’
, 
wšdow_¡
 + (
vid_t
)
maxwšdow
), 
mem_budg‘
);

709 
	gnv”tiûs
 = 
wšdow_’
-
wšdow_¡
+1;

710 
	g¡d
::
veùÜ
< 
sv”‹x_t
 > 
v”tiûs
(
nv”tiûs
, svertex_t());

712 
	gg¿phchi_edge
<
	gEdgeD©aTy³
> * 
	ged©a
 = 
NULL
;

713 
size_t
 
	gnum_edges
=0;

714 
	gi
=0; i<
	gnv”tiûs
; i++) {

715 
deg»e
 
	gd
 = 
this
->
deg»e_hªdËr
->
g‘_deg»e
(
i
 + 
wšdow_¡
);

716 
	gnum_edges
 +ğ
d
.
šdeg»e
+d.
outdeg»e
;

718 
size_t
 
	gecouÁ”
 = 0;

719 
	ged©a
 = (
g¿phchi_edge
<
EdgeD©aTy³
>*)
m®loc
(
num_edges
 * (graphchi_edge<EdgeDataType>));

720 
	gi
=0; i<()
	gnv”tiûs
; i++) {

722 
deg»e
 
	gd
 = 
this
->
deg»e_hªdËr
->
g‘_deg»e
(
i
 + 
wšdow_¡
);

723 
	goutc
 = 
d
.
outdeg»e
;

724 
	gv”tiûs
[
i
] = 
sv”‹x_t
(
wšdow_¡
+i, &
ed©a
[
ecouÁ”
],

725 &
ed©a
[
ecouÁ”
+0], 0, 
outc
);

726 
	gv”tiûs
[
i
].
	gscheduËd
 = 
Œue
;

727 
	gecouÁ”
 +ğ0 + 
outc
;

731 
	gcursh¬d
->
»ad_Ãxt_v”tiûs
(
nv”tiûs
, 
wšdow_¡
, 
v”tiûs
, 
çl£
, 
Œue
);

734 
	gebi
=0;ƒbi<
	gbufãr_fÜ_wšdow
.
size
();ƒbi++) {

735 
	gü—‹d_edge
<
	gEdgeD©aTy³
> * 
	gedge
 = 
bufãr_fÜ_wšdow
[
ebi
];

736 ià(
	gedge
->
	g¤c
 >ğ
wšdow_¡
 && 
edge
->
¤c
 <ğ
wšdow_’
) {

737 
v”tiûs
[
edge
->
¤c
-
wšdow_¡
].
add_ou‹dge
Ódge->
d¡
, &edge->
d©a
, 
çl£
);

741 
	gthis
->
	giomgr
->
wa™_fÜ_»ads
();

744 
	g¡d
::
veùÜ
<> 
adju¡ed_couÁs
(
v”tiûs
.
size
(), 0);

745 
	giv
=0; iv< ()
	gv”tiûs
.
size
(); iv++è
	gadju¡ed_couÁs
[
iv
] = 
v”tiûs
[iv].
outc
;

747 ià(
	gou¬ts
 == 2) {

749 
iv
=0; 
	giv
< ()
	gv”tiûs
.
size
(); iv++) {

750 
	gsv”‹x_t
 &
	gv”‹x
 = 
v”tiûs
[
iv
];

751 
	gi
=0; i<
	gv”‹x
.
	goutc
; i++) {

752 ià(!(
	gv”‹x
.
ou‹dge
(
i
)->
	gv”‹xid
 >ğ
¥l™¡¬t
 && 
v”‹x
.ou‹dge(i)->
v”‹xid
 <ğ
¥l™’d
)) {

753 
adju¡ed_couÁs
[
iv
]--;

759 #ifdeà
SUPPORT_DELETIONS


761 
	giv
=0; iv< ()
	gv”tiûs
.
size
(); iv++) {

762 
	gsv”‹x_t
 &
	gv”‹x
 = 
v”tiûs
[
iv
];

763 
	gi
=0; i<
	gv”‹x
.
	goutc
; i++) {

764 ià(
is_d–‘ed_edge_v®ue
(
v”‹x
.
ou‹dge
(
i
)->
g‘_d©a
())) {

765 
	gadju¡ed_couÁs
[
iv
]--;

766 
as£¹
(
çl£
);

775 
size_t
 
	gÃ
 = 0;

776 
vid_t
 
	gcurvid
=
wšdow_¡
; curvid<=
wšdow_’
;) {

777 
	giv
 = 
curvid
 - 
wšdow_¡
;

778 
	gsv”‹x_t
 &
	gv”‹x
 = 
v”tiûs
[
iv
];

779 
	gcouÁ
 = 
adju¡ed_couÁs
[
iv
];

780 ià(
	gcouÁ
 == 0) {

782 
nz
=0;

783 
	gcurvid
++;

784 ; 
	gcurvid
 <ğ
wšdow_’
 && 
nz
<254; curvid++) {

785 ià(
	gadju¡ed_couÁs
[
curvid
 - 
wšdow_¡
] == 0) {

786 
nz
++;

791 
ušt8_t
 
	gÂz
 = (ušt8_t)
nz
;

793 
	gbwr™e
<
	gušt8_t
>(
	gf
, 
	gbuf
, 
	gbuåŒ
, 0);

794 
	gbwr™e
<
	gušt8_t
>(
	gf
, 
	gbuf
, 
	gbuåŒ
, 
	gÂz
);

796 ià(
	gcouÁ
 < 255) {

797 
ušt8_t
 
	gx
 = (ušt8_t)
couÁ
;

798 
	gbwr™e
<
	gušt8_t
>(
	gf
, 
	gbuf
, 
	gbuåŒ
, 
	gx
);

800 
	gbwr™e
<
	gušt8_t
>(
	gf
, 
	gbuf
, 
	gbuåŒ
, 0xff);

801 
	gbwr™e
<
	gušt32_t
>(
	gf
, 
	gbuf
, 
	gbuåŒ
, (ušt32_t)
	gcouÁ
);

804 
	gi
=0; i<
	gv”‹x
.
	goutc
; i++) {

805 ià(
	gv”‹x
.
ou‹dge
(
i
)->
	gv”‹xid
 >ğ
¥l™¡¬t
 && 
v”‹x
.ou‹dge(i)->
v”‹xid
 <ğ
¥l™’d
) {

806 #ifdeà
SUPPORT_DELETIONS


807 ià(
is_d–‘ed_edge_v®ue
(
v”‹x
.
ou‹dge
(
i
)->
g‘_d©a
())) {

808 
as£¹
(
çl£
);

812 
bwr™e
(
f
, 
buf
, 
buåŒ
, 
v”‹x
.
ou‹dge
(
i
)->
v”‹xid
);

813 
	gbwr™e_ed©a
<
	gEdgeD©aTy³
>(
	gebuf
, 
	gebuåŒ
, 
	gv”‹x
.
ou‹dge
(
i
)->
g‘_d©a
(), 
	gtÙ_ed©aby‹s
, 
	goutfe_ed©a
);

814 
	gÃ
++;

815 } 
as£¹
(
ou¬ts
 == 2);

817 
	gcurvid
++;

820 
ä“
(
ed©a
);

821 
	gwšdow_¡
 = 
wšdow_’
+1;

827 
wr™—
(
f
, 
buf
, 
buåŒ
-buf);

829 
	ged©a_æush
<
	gEdgeD©aTy³
>(
	gebuf
, 
	gebuåŒ
, 
	goutfe_ed©a
, 
	gtÙ_ed©aby‹s
);

832 
	g¡d
::
¡ršg
 
sizef’ame
 = 
outfe_ed©a
 + ".size";

833 
	g¡d
::
of¡»am
 
ofs
(
sizef’ame
.
c_¡r
());

834 
	gofs
 << 
	gtÙ_ed©aby‹s
;

835 
	gofs
.
şo£
();

838 
ä“
(
buf
);

839 
ä“
(
ebuf
);

841 
d–‘e
 
	gcursh¬d
;

842 
şo£
(
f
);

843 
şo£
(
ef
);

845 
	gthis
->
	giomgr
->
wa™_fÜ_wr™es
();

849 
	g¡d
::
¡ršg
 
Şd_fe_adj
 = 
f’ame_sh¬d_adj
(
this
->
ba£_f’ame
, 0, 0è+ ".dyng¿ph" + 
	gsh¬d_suffiûs
[
sh¬d
];

850 
	g¡d
::
¡ršg
 
Şd_fe_ed©a
 = 
f’ame_sh¬d_ed©a
<
EdgeD©aTy³
>(
this
->
ba£_f’ame
, 0, 0è+ ".dyng¿ph" + 
	gsh¬d_suffiûs
[
sh¬d
];

851 
	g¡d
::
¡ršg
 
Şd_blockdœ
 = 
dœÇme_sh¬d_ed©a_block
(
Şd_fe_ed©a
, 
ba£_’gše
::
blocksize
);

853 
»move
(
Şd_fe_adj
.
c_¡r
());

854 
»move
(
Şd_blockdœ
.
c_¡r
());

856 
	g¡d
::
¡ršg
 
Şd_sizef’ame
 = 
Şd_fe_ed©a
 + ".size";

857 
»move
(
Şd_sizef’ame
.
c_¡r
());

861 
	gsh¬d
=0; sh¬d < 
	gthis
->
	gnsh¬ds
; shard++) {

862 ià(
	gwas_comm™ed
[
sh¬d
]) {

863 
	gwš
=0; wš < 
	gthis
->
	gnsh¬ds
; win++) {

864 
	gedge_bufãr
 &
	gbufãr_fÜ_wšdow
 = *
Ãw_edge_bufãrs
[
sh¬d
][
wš
];

865 
	gebi
=0;ƒbi<
	gbufãr_fÜ_wšdow
.
size
();ƒbi++) {

866 
	gü—‹d_edge
<
	gEdgeD©aTy³
> * 
	gedge
 = 
bufãr_fÜ_wšdow
[
ebi
];

867 ià(!
	gedge
->
	gaccouÁed_fÜ_outc
) {

868 
	g¡d
::
cout
 << "EdgnÙ‡ccouÁed (out)! " << 
edge
->
¤c
 << " -- " <<ƒdge->
d¡
 << 
¡d
::
’dl
;

870 ià(!
	gedge
->
	gaccouÁed_fÜ_šc
) {

871 
	g¡d
::
cout
 << "EdgnÙ‡ccouÁed (š)! " << 
edge
->
¤c
 << " -- " <<ƒdge->
d¡
 << 
¡d
::
’dl
;

874 
as£¹
(
edge
->
accouÁed_fÜ_šc
);

875 
as£¹
(
edge
->
accouÁed_fÜ_outc
);

877 
	gbufãr_fÜ_wšdow
.
ş—r
();

883 
	gÏ¡_comm™
 = 
added_edges
;

884 
	gthis
->
	gš‹rv®s
 = 
Ãw¿nges
;

885 
	gsh¬d_suffiûs
 = 
Ãwsuffiûs
;

886 
	gthis
->
	gnsh¬ds
 = (è
this
->
š‹rv®s
.
size
();

889 ià(
	g¿ngeschªged
) {

890 
	gsh¬dlock
.
lock
();

891 
	gi
=0; i<()
	gthis
->
	g¦idšg_sh¬ds
.
size
(); i++) {

892 ià(
	gthis
->
	g¦idšg_sh¬ds
[
i
] !ğ
NULL
è
d–‘e
 
this
->
¦idšg_sh¬ds
[i];

894 
	gthis
->
	g¦idšg_sh¬ds
.
ş—r
();

895 
	gsh¬dlock
.
uÆock
();

898 
	g¡d
::
¡ršg
 
numv_f’ame
 = 
ba£_’gše
::
ba£_f’ame
 + ".numvertices";

899 
FILE
 * 
	gf
 = 
fİ’
(
numv_f’ame
.
c_¡r
(), "w");

900 
årštf
(
f
, "%lu\n", 
ba£_’gše
::
num_v”tiûs
());

901 
fşo£
(
f
);

903 
š™_bufãrs
();

904 
	gthis
->
	gmodifiÿtiÚ_lock
.
uÆock
();

908 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

909 
bwr™e
(
f
, * 
buf
, * &
buåŒ
, 
T
 
v®
) {

910 ià(
	gbuåŒ
+(
	gT
)-
	gbuf
>=
BBUF
) {

911 
wr™—
(
f
, 
buf
, 
buåŒ
-buf);

912 
	gbuåŒ
 = 
buf
;

914 *((
	gT
*)
	gbuåŒ
èğ
v®
;

915 
	gbuåŒ
 +ğ(
T
);

919 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

920 
ed©a_æush
(* 
buf
, * 
buåŒ
, 
¡d
::
¡ršg
 & 
sh¬d_f’ame
, 
size_t
 
tÙby‹s
) {

921 
	gblockid
 = (è((
tÙby‹s
 - (
T
)è/ 
ba£_’gše
::
blocksize
);

922 
	gËn
 = (è(
buåŒ
 - 
buf
);

923 
as£¹
(
Ën
 <ğ()
ba£_’gše
::
blocksize
);

925 
	g¡d
::
¡ršg
 
block_f’ame
 = 
f’ame_sh¬d_ed©a_block
(
sh¬d_f’ame
, 
blockid
, 
ba£_’gše
::
blocksize
);

926 
	gf
 = 
İ’
(
block_f’ame
.
c_¡r
(), 
O_RDWR
 | 
O_CREAT
, 
S_IROTH
 | 
S_IWOTH
 | 
S_IWUSR
 | 
S_IRUSR
);

927 
wr™e_com´es£d
(
f
, 
buf
, 
Ën
);

928 
şo£
(
f
);

931 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

932 
bwr™e_ed©a
(* 
buf
, * &
buåŒ
, 
T
 
v®
, 
size_t
 & 
tÙby‹s
, 
¡d
::
¡ršg
 & 
sh¬d_f’ame
) {

933 ià((è(
buåŒ
 + (
T
è- 
buf
è> ()
ba£_’gše
::
blocksize
) {

934 
ed©a_æush
<
T
>(
buf
, 
	gbuåŒ
, 
	gsh¬d_f’ame
, 
	gtÙby‹s
);

935 
	gbuåŒ
 = 
buf
;

937 
	gtÙby‹s
 +ğ(
T
);

938 *((
	gT
*)
	gbuåŒ
èğ
v®
;

939 
	gbuåŒ
 +ğ(
T
);

947 
	gpublic
:

948 
¡d
::
¡ršg
 
g‘_šfo_jsÚ
() {

949 
¡d
::
¡ršg¡»am
 
jsÚ
;

951 
	gthis
->
	gh‰¶ock
.
lock
();

956 
	gjsÚ
 << "{";

957 
	gjsÚ
 << "\"¡©e\" : \"" << 
	g¡©e
 << "\",\n";

958 
	gjsÚ
 << "\"fe\" : \"" << 
	gthis
->
	gba£_f’ame
 << "\",\n";

959 
	gjsÚ
 << "\"numOfSh¬ds\": " << 
	gthis
->
	gnsh¬ds
 << ",\n";

960 
	gjsÚ
 << "\"™”©iÚ\": " << 
	gthis
->
	gchicÚ‹xt
.
	g™”©iÚ
 << ",\n";

961 
	gjsÚ
 << "\"numI‹¿tiÚs\": " << 
	gthis
->
	gchicÚ‹xt
.
	gnum_™”©iÚs
 << ",\n";

962 
	gjsÚ
 << "\"runTime\": " << 
	gthis
->
	gchicÚ‹xt
.
ruÁime
() << ",\n";

964 
	gjsÚ
 << "\"upd©es\": " << 
	gthis
->
	gnupd©es
 << ",\n";

965 
	gjsÚ
 << "\"nv”tiûs\": " << 
	gthis
->
	gchicÚ‹xt
.
	gnv”tiûs
 << ",\n";

966 
	gjsÚ
 << "\"edges\": " << 
num_edges_§ã
() << ",\n";

968 
	gjsÚ
 << "\"edgesInBufãrs\": " << 
	gadded_edges
 << ",\n";

970 
	gjsÚ
 << "\"š‹rv®\":" << 
	gthis
->
	gexec_š‹rv®
 << ",\n";

971 
	gjsÚ
 << "\"wšdowS¹\":" << 
	gthis
->
	gsub_š‹rv®_¡
 << ",";

972 
	gjsÚ
 << "\"wšdowEnd\": " << 
	gthis
->
	gsub_š‹rv®_’
 << ",";

973 
	gjsÚ
 << "\"shards\": [";

976 
	gsh¬dlock
.
lock
();

977 
	gp
=0;… < (è
	gthis
->
	g¦idšg_sh¬ds
.
size
();…++) {

978 ià(
	gp
>0è
	gjsÚ
 << ",";

980 
ty³Çme
 
	gba£_’gše
::
¦idšgsh¬d_t
 * 
sh¬d
 = 
this
->
¦idšg_sh¬ds
[
p
];

981 ià(
	gsh¬d
 !ğ
NULL
) {

982 
jsÚ
 << "{";

983 
	gjsÚ
 << "\"p\": " << 
	gp
 << ", ";

984 
	gjsÚ
 << 
	gsh¬d
->
g‘_šfo_jsÚ
();

985 
	gjsÚ
 << "}";

987 
	gjsÚ
 << "{";

988 
	gjsÚ
 << "\"p\": " << 
	gp
 << ", ";

989 
	gjsÚ
 << "\"state\": \"recreated\"";

990 
	gjsÚ
 << "}";

993 
	gsh¬dlock
.
uÆock
();

995 
	gjsÚ
 << "]";

997 
	g¡d
::
m­
<
¡d
::
¡ršg
, std::¡ršg>::
™”©Ü
 
™
;

998 
	g™
=
this
->
jsÚ_·¿ms
.
begš
(); iˆ!ğthis->jsÚ_·¿ms.
’d
(); ++it) {

999 
	gjsÚ
 << ", \"" << 
	g™
->
	gfœ¡
 << "\":\"";

1000 
	gjsÚ
 << 
	g™
->
	g£cÚd
 << "\"";

1003 
	gjsÚ
 << "}";

1005 
	gthis
->
	gh‰¶ock
.
uÆock
();

1006  
	gjsÚ
.
¡r
();

	@src/engine/functional/functional_engine.hpp

32 #iâdeà
GRAPHCHI_FUNCTIONALENGINE_DEF


33 
	#GRAPHCHI_FUNCTIONALENGINE_DEF


	)

35 
	~"’gše/g¿phchi_’gše.hµ
"

36 
	~"logg”/logg”.hµ
"

38 
Çme¥aû
 
	gg¿phchi
 {

40 
	g‹m¶©e
 <
ty³Çme
 
	gV”‹xD©aTy³
,y³Çm
	gEdgeD©aTy³
,y³Çm
	gfv”‹x_t
>

41 
şass
 
	gfunùiÚ®_’gše
 : 
public
 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
, 
	gfv”‹x_t
> {

42 
	gpublic
:

43 
funùiÚ®_’gše
(
¡d
::
¡ršg
 
ba£_f’ame
, 
nsh¬ds
, 
boŞ
 
£Ëùive_schedulšg
, 
m‘rics
 &
_m
) :

44 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
, 
	gfv”‹x_t
>(
	gba£_f’ame
, 
	gnsh¬ds
, 
	g£Ëùive_schedulšg
, 
	g_m
){

45 
	g_m
.
£t
("engine", "functional");

48 
	g´Ùeùed
:

50 
vœtu®
 
lßd_befÜe_upd©es
(
¡d
::
veùÜ
<
fv”‹x_t
> &
v”tiûs
) {

51 
log¡»am
(
LOG_DEBUG
è<< "Proûssšg in-edges." << 
¡d
::
’dl
;

53 ià(!
	gthis
->
	gmemÜysh¬d
->
lßded
()) {

54 
	gthis
->
	gmemÜysh¬d
->
lßd
();

58 
	gthis
->
	gmemÜysh¬d
->
lßd_v”tiûs
(
this
->
sub_š‹rv®_¡
,his->
sub_š‹rv®_’
, 
v”tiûs
, 
Œue
, 
çl£
);

61 
	gthis
->
	gv”‹x_d©a_hªdËr
->
lßd
(
this
->
sub_š‹rv®_¡
,his->
sub_š‹rv®_’
);

64 
	gthis
->
	giomgr
->
wa™_fÜ_»ads
();

69 
vœtu®
 
š™_v”tiûs
(
¡d
::
veùÜ
<
fv”‹x_t
> &
v”tiûs
, 
g¿phchi_edge
<
EdgeD©aTy³
> * &
e
) {

70 
size_t
 
	gnv”tiûs
 = 
v”tiûs
.
size
();

73 
size_t
 
	gnum_edges
 = 
this
->
num_edges_subš‹rv®
Ñhis->
sub_š‹rv®_¡
,his->
sub_š‹rv®_’
);

76 
size_t
 
	gecouÁ”
 = 0;

77 
	gi
=0; i < ()
	gnv”tiûs
; i++) {

78 
deg»e
 
	gd
 = 
this
->
deg»e_hªdËr
->
g‘_deg»e
Ñhis->
sub_š‹rv®_¡
 + 
i
);

79 
	gšc
 = 
d
.
šdeg»e
;

80 
	goutc
 = 
d
.
outdeg»e
;

81 
	gv”tiûs
[
i
] = 
fv”‹x_t
(
this
->
chicÚ‹xt
,his->
sub_š‹rv®_¡
 + i, 
šc
, 
outc
);

83 ià(
	gthis
->
	gscheduËr
 !ğ
NULL
) {

84 
boŞ
 
is_sched
 = 
this
->
scheduËr
->
is_scheduËd
Ñhis->
sub_š‹rv®_¡
 + 
i
);

85 ià(
	gis_sched
) {

86 
	gv”tiûs
[
i
].
	gscheduËd
 = 
Œue
;

87 
	gthis
->
	gnupd©es
++;

88 
	gecouÁ”
 +ğ
šc
 + 
outc
;

91 
	gthis
->
	gnupd©es
++;

92 
	gv”tiûs
[
i
].
	gscheduËd
 = 
Œue
;

93 
	gecouÁ”
 +ğ
šc
 + 
outc
;

96 
	gthis
->
	gwÜk
 +ğ
num_edges
;

101 
vœtu®
 
lßd_aá”_upd©es
(
¡d
::
veùÜ
<
fv”‹x_t
> &
v”tiûs
) {

102 
log¡»am
(
LOG_DEBUG
è<< "Proûssšg out-edge (brßdÿ¡)." << 
¡d
::
’dl
;

103 
omp_£t_num_th»ads
(
this
->
lßd_th»ads
);

104 #´agm¨
omp
 
·¿Î–
 
scheduË
(
dyÇmic
, 1)

105 
	gp
=0;… < 
	gthis
->
	gnsh¬ds
;…++) {

107 ià(
	gp
 !ğ
this
->
exec_š‹rv®
) {

108 
this
->
¦idšg_sh¬ds
[
p
]->
»ad_Ãxt_v”tiûs
(
v”tiûs
.
size
(),his->
sub_š‹rv®_¡
, vertices,

109 
this
->
scheduËr
 !ğ
NULL
 &&his->
™”
 == 0);

112 
	gthis
->
	gmemÜysh¬d
->
lßd_v”tiûs
(
this
->
sub_š‹rv®_¡
,his->
sub_š‹rv®_’
, 
v”tiûs
, 
çl£
, 
Œue
);

	@src/engine/graphchi_engine.hpp

29 #iâdeà
DEF_GRAPHCHI_GRAPHCHI_ENGINE


30 
	#DEF_GRAPHCHI_GRAPHCHI_ENGINE


	)

33 
	~<io¡»am
>

34 
	~<f¡»am
>

35 
	~<s¡»am
>

36 
	~<c¡dio
>

37 
	~<fú.h
>

38 
	~<uni¡d.h
>

39 
	~<as£¹.h
>

40 
	~<omp.h
>

41 
	~<veùÜ
>

42 
	~<sys/time.h
>

44 
	~"­i/chif’ames.hµ
"

45 
	~"­i/g¿ph_objeùs.hµ
"

46 
	~"­i/g¿phchi_cÚ‹xt.hµ
"

47 
	~"­i/g¿phchi_´og¿m.hµ
"

48 
	~"’gše/auxd©a/deg»e_d©a.hµ
"

49 
	~"’gše/auxd©a/v”‹x_d©a.hµ
"

50 
	~"’gše/b™£t_scheduËr.hµ
"

51 
	~"io/¡redio.hµ
"

52 
	~"logg”/logg”.hµ
"

53 
	~"m‘rics/m‘rics.hµ
"

54 
	~"sh¬ds/memÜysh¬d.hµ
"

55 
	~"sh¬ds/¦idšgsh¬d.hµ
"

56 
	~"ut/±h»ad_toŞs.hµ
"

59 
Çme¥aû
 
	gg¿phchi
 {

61 
	g‹m¶©e
 <
ty³Çme
 
	gV”‹xD©aTy³
,y³Çm
	gEdgeD©aTy³
,

62 
ty³Çme
 
	gsv”‹x_t
 = 
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> >

64 şas 
	cg¿phchi_’gše
 {

65 
	gpublic
:

66 
¦idšg_sh¬d
<
	tV”‹xD©aTy³
, 
	tEdgeD©aTy³
, 
	tsv”‹x_t
> 
	t¦idšgsh¬d_t
;

67 
	gmemÜy_sh¬d
<
	tV”‹xD©aTy³
, 
	tEdgeD©aTy³
, 
	tsv”‹x_t
> 
	tmemsh¬d_t
;

69 
	g´Ùeùed
:

70 
¡d
::
¡ršg
 
ba£_f’ame
;

71 
	gnsh¬ds
;

74 
¡redio
 * 
	giomgr
;

77 
	g¡d
::
veùÜ
<
¦idšgsh¬d_t
 *> 
¦idšg_sh¬ds
;

78 
memsh¬d_t
 * 
	gmemÜysh¬d
;

79 
	g¡d
::
veùÜ
<
¡d
::
·œ
<
vid_t
, 
	gvid_t
> > 
	gš‹rv®s
;

82 
deg»e_d©a
 * 
	gdeg»e_hªdËr
;

83 
	gv”‹x_d©a_¡Üe
<
	gV”‹xD©aTy³
> * 
	gv”‹x_d©a_hªdËr
;

86 
g¿phchi_cÚ‹xt
 
	gchicÚ‹xt
;

89 
b™£t_scheduËr
 * 
	gscheduËr
;

92 
boŞ
 
	gmodif›s_ou‹dges
;

93 
boŞ
 
	gmodif›s_šedges
;

94 
boŞ
 
	gÚly_adjaûncy
;

95 
boŞ
 
	gu£_£Ëùive_schedulšg
;

96 
boŞ
 
	g’abË_d‘”mši¡ic_·¿Î–ism
;

97 
boŞ
 
	g¡Üe_šedges
;

98 
boŞ
 
	gdi§bË_v”‹xd©a_¡Üage
;

99 
boŞ
 
	g´–ßd_comm™
;

101 
size_t
 
	gblocksize
;

102 
	gmembudg‘_mb
;

103 
	glßd_th»ads
;

104 
	gexec_th»ads
;

107 
vid_t
 
	gsub_š‹rv®_¡
;

108 
vid_t
 
	gsub_š‹rv®_’
;

109 
	g™”
;

110 
	gn™”s
;

111 
	gexec_š‹rv®
;

112 
size_t
 
	gnupd©es
;

113 
size_t
 
	gÃdges
;

114 
size_t
 
	gwÜk
;

115 
	gmaxwšdow
;

116 
mu‹x
 
	gmodifiÿtiÚ_lock
;

118 
boŞ
 
	g»£t_v”‹xd©a
;

122 
	gm‘rics
 &
	gm
;

124 
´št_cÚfig
() {

125 
log¡»am
(
LOG_INFO
è<< "EngšcÚfigu¿tiÚ: " << 
	g¡d
::
’dl
;

126 
log¡»am
(
LOG_INFO
è<< "ƒxec_th»ad ğ" << 
	gexec_th»ads
 << 
	g¡d
::
’dl
;

127 
log¡»am
(
LOG_INFO
è<< "†ßd_th»ad ğ" << 
	glßd_th»ads
 << 
	g¡d
::
’dl
;

128 
log¡»am
(
LOG_INFO
è<< " membudg‘_mb = " << 
	gmembudg‘_mb
 << 
	g¡d
::
’dl
;

129 
log¡»am
(
LOG_INFO
è<< " blocksizğ" << 
	gblocksize
 << 
	g¡d
::
’dl
;

130 
log¡»am
(
LOG_INFO
è<< " scheduË¸ğ" << 
	gu£_£Ëùive_schedulšg
 << 
	g¡d
::
’dl
;

133 
	gpublic
:

141 
g¿phchi_’gše
(
¡d
::
¡ršg
 
_ba£_f’ame
, 
_nsh¬ds
, 
boŞ
 
_£Ëùive_schedulšg
, 
m‘rics
 &
_m
è: 
ba£_f’ame
(_ba£_f’ame), 
nsh¬ds
(_nsh¬ds), 
u£_£Ëùive_schedulšg
(_£Ëùive_schedulšg), 
m
(_m) {

143 
	gm
.
¡¬t_time
("iomgr_init");

144 
	giomgr
 = 
Ãw
 
¡redio
(
m
);

145 ià(
di§bË_´–ßdšg
()) {

146 
	giomgr
->
£t_di§bË_´–ßdšg
(
Œue
);

148 
	gm
.
¡İ_time
("iomgr_init");

149 #iâdeà
DYNAMICEDATA


150 
log¡»am
(
LOG_INFO
è<< "In™Ÿlizšg g¿phchi_’gše. Thi ’gšex³ù " << (
	gEdgeD©aTy³
)

151 << "-by‹ƒdgd©a. " << 
	g¡d
::
’dl
;

153 
log¡»am
(
LOG_INFO
) << "Initializing graphchi_engine with dynamicƒdge-data. Thisƒngineƒxpects " << ()

154 << "-by‹ƒdgd©a. " << 
	g¡d
::
’dl
;

158 ià(
	gnsh¬ds
 < 1) {

159 
	gnsh¬ds
 = 
g‘_İtiÚ_št
("nshards", 0);

160 ià(
	gnsh¬ds
 < 1) {

161 
log¡»am
(
LOG_WARNING
è<< "Numb” oàsh¬d wa nÙ s³cif›d (commªd-lš¬gum’ˆ'nsh¬ds'). TryšgØd‘eù. " << 
	g¡d
::
’dl
;

162 
	gnsh¬ds
 = 
discov”_sh¬d_num
();

167 
	gmemÜysh¬d
 = 
NULL
;

168 
	gmodif›s_ou‹dges
 = 
Œue
;

169 
	gmodif›s_šedges
 = 
Œue
;

170 
	g´–ßd_comm™
 = 
Œue
;

171 
	gÚly_adjaûncy
 = 
çl£
;

172 
	g»£t_v”‹xd©a
 = 
çl£
;

173 
	gblocksize
 = 
g‘_İtiÚ_lÚg
("blocksize", 4096 * 1024);

174 #iâdeà
DYNAMICEDATA


175 
	gblocksize
 % (
	gEdgeD©aTy³
è!ğ0è
blocksize
++;

178 
	gdi§bË_v”‹xd©a_¡Üage
 = 
çl£
;

180 
	gmembudg‘_mb
 = 
g‘_İtiÚ_št
("membudget_mb", 1024);

181 
	gnupd©es
 = 0;

182 
	g™”
 = 0;

183 
	gwÜk
 = 0;

184 
	gÃdges
 = 0;

185 
	gscheduËr
 = 
NULL
;

186 
	g¡Üe_šedges
 = 
Œue
;

187 
	gdeg»e_hªdËr
 = 
NULL
;

188 
	gv”‹x_d©a_hªdËr
 = 
NULL
;

189 
	g’abË_d‘”mši¡ic_·¿Î–ism
 = 
Œue
;

190 
	glßd_th»ads
 = 
g‘_İtiÚ_št
("loadthreads", 2);

191 
	gexec_th»ads
 = 
g‘_İtiÚ_št
("exeùh»ads", 
omp_g‘_max_th»ads
());

192 
	gmaxwšdow
 = 40000000;

195 
_lßd_v”‹x_š‹rv®s
();

197 
	g_m
.
£t
("fe", 
_ba£_f’ame
);

198 
	g_m
.
£t
("engine", "default");

199 
	g_m
.
£t
("nsh¬ds", (
size_t
)
nsh¬ds
);

202 
	gvœtu®
 ~
g¿phchi_’gše
() {

203 ià(
	gdeg»e_hªdËr
 !ğ
NULL
è
d–‘e
 
deg»e_hªdËr
;

204 ià(
	gv”‹x_d©a_hªdËr
 !ğ
NULL
è
d–‘e
 
v”‹x_d©a_hªdËr
;

205 ià(
	gmemÜysh¬d
 !ğ
NULL
) {

206 
d–‘e
 
memÜysh¬d
;

207 
	gmemÜysh¬d
 = 
NULL
;

209 
	gi
=0; i < ()
	g¦idšg_sh¬ds
.
size
(); i++) {

210 ià(
	g¦idšg_sh¬ds
[
i
] !ğ
NULL
) {

211 
d–‘e
 
¦idšg_sh¬ds
[
i
];

213 
	g¦idšg_sh¬ds
[
i
] = 
NULL
;

215 
	gdeg»e_hªdËr
 = 
NULL
;

216 
	gv”‹x_d©a_hªdËr
 = 
NULL
;

217 
d–‘e
 
	giomgr
;

221 
	g´Ùeùed
:

223 
vœtu®
 
deg»e_d©a
 * 
ü—‹_deg»e_hªdËr
() {

224  
Ãw
 
deg»e_d©a
(
ba£_f’ame
, 
iomgr
);

227 
vœtu®
 
boŞ
 
di§bË_´–ßdšg
() {

228  
	gçl£
;

235 
discov”_sh¬d_num
() {

236 #iâdeà
DYNAMICEDATA


237 
	g_nsh¬ds
 = 
fšd_sh¬ds
<
EdgeD©aTy³
>(
ba£_f’ame
);

239 
	g_nsh¬ds
 = 
fšd_sh¬ds
<>(
ba£_f’ame
);

241 ià(
	g_nsh¬ds
 == 0) {

242 
log¡»am
(
LOG_ERROR
è<< "Could‚Ù fšd su™abË sh¬d - maybyou‚“dØruÀsh¬d”Øü—‹hem?" << 
¡d
::
’dl
;

243 
log¡»am
(
LOG_ERROR
è<< "Wa lookšg w™h f’am[" << 
	gba£_f’ame
 << "]" << 
	g¡d
::
’dl
;

244 
log¡»am
(
LOG_ERROR
è<< "You‚“dØü—‹hsh¬d w™hƒdgd©a-ty³ oàsiz" << (
	gEdgeD©aTy³
è<< " by‹s." << 
	g¡d
::
’dl
;

245 
log¡»am
(
LOG_ERROR
è<< "TØ¥ecifyhnumb” oàsh¬ds, u£ commªd-lš·¿m‘” 'nsh¬ds'" << 
	g¡d
::
’dl
;

246 
as£¹
(0);

248  
	g_nsh¬ds
;

252 
vœtu®
 
š™Ÿlize_¦idšg_sh¬ds
() {

253 
as£¹
(
¦idšg_sh¬ds
.
size
() == 0);

254 
	gp
=0;… < 
	gnsh¬ds
;…++) {

255 #iâdeà
DYNAMICEDATA


256 
	g¡d
::
¡ršg
 
ed©a_f’ame
 = 
f’ame_sh¬d_ed©a
<
EdgeD©aTy³
>(
ba£_f’ame
, 
	gp
, 
	gnsh¬ds
);

257 
	g¡d
::
¡ršg
 
adj_f’ame
 = 
f’ame_sh¬d_adj
(
ba£_f’ame
, 
p
, 
nsh¬ds
);

261 
	giomgr
->
®low_´–ßdšg
(
ed©a_f’ame
);

262 
	giomgr
->
®low_´–ßdšg
(
adj_f’ame
);

264 
	g¡d
::
¡ršg
 
ed©a_f’ame
 = 
f’ame_sh¬d_ed©a
<>(
ba£_f’ame
, 
	gp
, 
	gnsh¬ds
);

265 
	g¡d
::
¡ršg
 
adj_f’ame
 = 
f’ame_sh¬d_adj
(
ba£_f’ame
, 
p
, 
nsh¬ds
);

269 
	g¦idšg_sh¬ds
.
push_back
(

270 
Ãw
 
¦idšgsh¬d_t
(
iomgr
, 
ed©a_f’ame
,

271 
adj_f’ame
,

272 
š‹rv®s
[
p
].
fœ¡
,

273 
š‹rv®s
[
p
].
£cÚd
,

274 
blocksize
,

275 
m
,

276 !
modif›s_ou‹dges
,

277 
Úly_adjaûncy
));

278 ià(!
	gÚly_adjaûncy
)

279 
	gÃdges
 +ğ
¦idšg_sh¬ds
[¦idšg_sh¬ds.
size
(è- 1]->
num_edges
();

284 
vœtu®
 
š™Ÿlize_scheduËr
() {

285 ià(
	gu£_£Ëùive_schedulšg
) {

286 ià(
	gscheduËr
 !ğ
NULL
è
d–‘e
 
scheduËr
;

287 
	gscheduËr
 = 
Ãw
 
b™£t_scheduËr
((è
num_v”tiûs
());

288 
	gscheduËr
->
add_sk_to_®l
();

290 
	gscheduËr
 = 
NULL
;

298 
boŞ
 
is_šmemÜy_mode
() {

299  
	gnsh¬ds
 == 1;

306 
vœtu®
 
vid_t
 
d‘”mše_Ãxt_wšdow
(vid_ˆ
iš‹rv®
, vid_ˆ
äomvid
, vid_ˆ
maxvid
, 
size_t
 
membudg‘
) {

308 
	gdeg»e_hªdËr
->
lßd
(
äomvid
, 
maxvid
);

311 ià(
is_šmemÜy_mode
()) {

312  
	gmaxvid
;

314 
size_t
 
	gmem»q
 = 0;

315 
	gmax_š‹rv®
 = 
maxvid
 - 
äomvid
;

316 
	gi
=0; i < 
	gmax_š‹rv®
; i++) {

317 
deg»e
 
	gdeg
 = 
deg»e_hªdËr
->
g‘_deg»e
(
äomvid
 + 
i
);

318 
	gšc
 = 
deg
.
šdeg»e
;

319 
	goutc
 = 
deg
.
outdeg»e
;

322 
	gmem»q
 +ğ(
sv”‹x_t
è+ ((
EdgeD©aTy³
è+ (
vid_t
è+ (
g¿phchi_edge
<EdgeD©aTy³>))*(
outc
 + 
šc
);

323 ià(
	gmem»q
 > 
	gmembudg‘
) {

324 
log¡»am
(
LOG_DEBUG
è<< "MemÜy budg‘ƒxûeded w™h " << 
	gmem»q
 << " by‹s." << 
	g¡d
::
’dl
;

325  
	gäomvid
 + 
	gi
 - 1;

328  
	gmaxvid
;

336 
size_t
 
num_edges_subš‹rv®
(
vid_t
 
¡
, vid_ˆ
’
) {

337 
size_t
 
	gnum_edges
 = 0;

338 
	gnv”tiûs
 = 
’
 - 
¡
 + 1;

339 ià(
	gscheduËr
 !ğ
NULL
) {

340 
i
=0; 
	gi
 < 
	gnv”tiûs
; i++) {

341 
boŞ
 
	gis_sched
 = 
scheduËr
->
is_scheduËd
(
¡
 + 
i
);

342 ià(
	gis_sched
) {

343 
deg»e
 
	gd
 = 
deg»e_hªdËr
->
g‘_deg»e
(
¡
 + 
i
);

344 
	gnum_edges
 +ğ
d
.
šdeg»e
 * 
¡Üe_šedges
 + d.
outdeg»e
;

348 
	gi
=0; i < 
	gnv”tiûs
; i++) {

349 
deg»e
 
	gd
 = 
deg»e_hªdËr
->
g‘_deg»e
(
¡
 + 
i
);

350 
	gnum_edges
 +ğ
d
.
šdeg»e
 * 
¡Üe_šedges
 + d.
outdeg»e
;

353  
	gnum_edges
;

356 
vœtu®
 
lßd_befÜe_upd©es
(
¡d
::
veùÜ
<
sv”‹x_t
> &
v”tiûs
) {

357 
omp_£t_num_th»ads
(
lßd_th»ads
);

358 #´agm¨
omp
 
·¿Î–
 
scheduË
(
dyÇmic
, 1)

359 
	gp
=-1;… < 
	gnsh¬ds
;…++) {

360 ià(
	gp
==(-1)) {

362 ià(!
memÜysh¬d
->
lßded
()) {

363 
memÜysh¬d
->
lßd
();

367 
	gmemÜysh¬d
->
lßd_v”tiûs
(
sub_š‹rv®_¡
, 
sub_š‹rv®_’
, 
v”tiûs
);

370 
	gv”‹x_d©a_hªdËr
->
lßd
(
sub_š‹rv®_¡
, 
sub_š‹rv®_’
);

373 ià(!
	gdi§bË_v”‹xd©a_¡Üage
) {

374 
	gv”‹x_d©a_hªdËr
->
lßd
(
sub_š‹rv®_¡
, 
sub_š‹rv®_’
);

378 ià(
	gp
 !ğ
exec_š‹rv®
) {

379 
¦idšg_sh¬ds
[
p
]->
»ad_Ãxt_v”tiûs
((è
v”tiûs
.
size
(), 
sub_š‹rv®_¡
, vertices,

380 
scheduËr
 !ğ
NULL
 && 
chicÚ‹xt
.
™”©iÚ
 == 0);

387 
	giomgr
->
wa™_fÜ_»ads
();

390 
exec_upd©es
(
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
EdgeD©aTy³
, 
sv”‹x_t
> &
u£½rog¿m
,

391 
¡d
::
veùÜ
<
sv”‹x_t
> &
v”tiûs
) {

392 
m‘rics_’Œy
 
me
 = 
m
.
¡¬t_time
();

393 
size_t
 
	gnv”tiûs
 = 
v”tiûs
.
size
();

394 ià(!
	g’abË_d‘”mši¡ic_·¿Î–ism
) {

395 
	gi
=0; i < ()
	gnv”tiûs
; i++è
	gv”tiûs
[
i
].
	g·¿Î–_§ã
 = 
Œue
;

398 
omp_£t_num_th»ads
(
exec_th»ads
);

400 #´agm¨
omp
 
·¿Î–
 
£ùiÚs


402 #´agm¨
omp
 
£ùiÚ


404 #´agm¨
omp
 
·¿Î–
 
scheduË
(
dyÇmic
)

405 
	gvid
=
sub_š‹rv®_¡
; vid <ğ()
sub_š‹rv®_’
; vid++) {

406 
	gsv”‹x_t
 & 
	gv
 = 
v”tiûs
[
vid
 - 
sub_š‹rv®_¡
];

408 ià(
	gexec_th»ads
 =ğ1 || 
v
.
·¿Î–_§ã
) {

409 ià(!
di§bË_v”‹xd©a_¡Üage
)

410 
v
.
d©­Œ
 = 
v”‹x_d©a_hªdËr
->
v”‹x_d©a_±r
(
vid
);

411 ià(
	gv
.
	gscheduËd
)

412 
	gu£½rog¿m
.
upd©e
(
v
, 
chicÚ‹xt
);

416 #´agm¨
omp
 
£ùiÚ


418 ià(
	gexec_th»ads
 > 1 && 
	g’abË_d‘”mši¡ic_·¿Î–ism
) {

419 
	gnÚ§ã_couÁ
 = 0;

420 
	gvid
=
sub_š‹rv®_¡
; vid <ğ()
sub_š‹rv®_’
; vid++) {

421 
	gsv”‹x_t
 & 
	gv
 = 
v”tiûs
[
vid
 - 
sub_š‹rv®_¡
];

422 ià(!
	gv
.
	g·¿Î–_§ã
 && v.
	gscheduËd
) {

423 ià(!
	gdi§bË_v”‹xd©a_¡Üage
)

424 
	gv
.
	gd©­Œ
 = 
v”‹x_d©a_hªdËr
->
v”‹x_d©a_±r
(
vid
);

425 
	gu£½rog¿m
.
upd©e
(
v
, 
chicÚ‹xt
);

426 
	gnÚ§ã_couÁ
++;

430 
	gm
.
add
("£rŸlized-upd©es", 
nÚ§ã_couÁ
);

434 
	gm
.
¡İ_time
(
me
, "execute-updates");

446 
exec_upd©es_šmemÜy_mode
(
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
EdgeD©aTy³
, 
sv”‹x_t
> &
u£½rog¿m
,

447 
¡d
::
veùÜ
<
sv”‹x_t
> &
v”tiûs
) {

448 
wÜk
 = 
nupd©es
 = 0;

449 
	g™”
=0; i‹r<
	gn™”s
; iter++) {

450 
log¡»am
(
LOG_INFO
è<< "In-memÜy mode: I‹¿tiÚ " << 
	g™”
 << " s¹s." << 
	g¡d
::
’dl
;

451 
	gchicÚ‹xt
.
	g™”©iÚ
 = 
™”
;

452 
	gu£½rog¿m
.
befÜe_™”©iÚ
(
™”
, 
chicÚ‹xt
);

453 
	gu£½rog¿m
.
befÜe_exec_š‹rv®
(0, ()
num_v”tiûs
(), 
chicÚ‹xt
);

455 ià(
	gu£_£Ëùive_schedulšg
) {

456 ià(
	g™”
 > 0 && !
	gscheduËr
->
	ghas_Ãw_sks
) {

457 
log¡»am
(
LOG_INFO
è<< "NØÃwask tØrun!" << 
	g¡d
::
’dl
;

460 
	gi
=0; i < ()
	gv”tiûs
.
size
(); i++) {

461 ià(
	g™”
 =ğ0 || 
scheduËr
->
is_scheduËd
(
i
)) {

462 
v”tiûs
[
i
].
scheduËd
 = 
Œue
;

463 
	gnupd©es
++;

464 
	gwÜk
 +ğ
v”tiûs
[
i
].
šc
 + v”tiûs[i].
outc
;

466 
	gv”tiûs
[
i
].
	gscheduËd
 = 
çl£
;

470 
	gscheduËr
->
	ghas_Ãw_sks
 = 
çl£
;

471 
	gscheduËr
->
»move_sks
(0, ()
num_v”tiûs
());

473 
	gnupd©es
 +ğ
num_v”tiûs
();

474 
	gwÜk
 +ğ
num_edges
();

477 
exec_upd©es
(
u£½rog¿m
, 
v”tiûs
);

478 
lßd_aá”_upd©es
(
v”tiûs
);

480 
	gu£½rog¿m
.
aá”_exec_š‹rv®
(0, ()
num_v”tiûs
(), 
chicÚ‹xt
);

481 
	gu£½rog¿m
.
aá”_™”©iÚ
(
™”
, 
chicÚ‹xt
);

482 ià(
	gchicÚ‹xt
.
	gÏ¡_™”©iÚ
 > 0 && chicÚ‹xt.Ï¡_™”©iÚ <ğ
™”
){

483 
log¡»am
(
LOG_INFO
)<<"Stİpšgƒngšsšû†a¡ i‹¿tiÚ wa £ˆto: " << 
chicÚ‹xt
.
Ï¡_™”©iÚ
 << 
¡d
::
’dl
;

491 
vœtu®
 
š™_v”tiûs
(
¡d
::
veùÜ
<
sv”‹x_t
> &
v”tiûs
, 
g¿phchi_edge
<
EdgeD©aTy³
> * &
ed©a
) {

492 
size_t
 
	gnv”tiûs
 = 
v”tiûs
.
size
();

495 
size_t
 
	gnum_edges
 = 
num_edges_subš‹rv®
(
sub_š‹rv®_¡
, 
sub_š‹rv®_’
);

498 
	ged©a
 = (
g¿phchi_edge
<
EdgeD©aTy³
>*è
m®loc
(
num_edges
 * (graphchi_edge<EdgeDataType>));

501 
size_t
 
	gecouÁ”
 = 0;

502 
	gi
=0; i < ()
	gnv”tiûs
; i++) {

503 
deg»e
 
	gd
 = 
deg»e_hªdËr
->
g‘_deg»e
(
sub_š‹rv®_¡
 + 
i
);

504 
	gšc
 = 
d
.
šdeg»e
;

505 
	goutc
 = 
d
.
outdeg»e
;

506 
	gv”tiûs
[
i
] = 
sv”‹x_t
(
sub_š‹rv®_¡
 + i, &
ed©a
[
ecouÁ”
],

507 &
ed©a
[
ecouÁ”
 + 
šc
 * 
¡Üe_šedges
], inc, 
outc
);

508 ià(
	gscheduËr
 !ğ
NULL
) {

509 
boŞ
 
is_sched
 = ( 
scheduËr
->
is_scheduËd
(
sub_š‹rv®_¡
 + 
i
));

510 ià(
	gis_sched
) {

511 
	gv”tiûs
[
i
].
	gscheduËd
 = 
Œue
;

512 
	gnupd©es
++;

513 
	gecouÁ”
 +ğ
šc
 * 
¡Üe_šedges
 + 
outc
;

516 
	gnupd©es
++;

517 
	gv”tiûs
[
i
].
	gscheduËd
 = 
Œue
;

518 
	gecouÁ”
 +ğ
šc
 * 
¡Üe_šedges
 + 
outc
;

521 
	gwÜk
 +ğ
ecouÁ”
;

522 
as£¹
(
ecouÁ”
 <ğ
num_edges
);

526 
§ve_v”tiûs
(
¡d
::
veùÜ
<
sv”‹x_t
> &
v”tiûs
) {

527 ià(
di§bË_v”‹xd©a_¡Üage
) ;

528 
size_t
 
	gnv”tiûs
 = 
v”tiûs
.
size
();

529 
boŞ
 
	gmodif›d_ªy_v”‹x
 = 
çl£
;

530 
	gi
=0; i < ()
	gnv”tiûs
; i++) {

531 ià(
	gv”tiûs
[
i
].
	gmodif›d
) {

532 
	gmodif›d_ªy_v”‹x
 = 
Œue
;

536 ià(
	gmodif›d_ªy_v”‹x
) {

537 
	gv”‹x_d©a_hªdËr
->
§ve
();

541 
vœtu®
 
lßd_aá”_upd©es
(
¡d
::
veùÜ
<
sv”‹x_t
> &
v”tiûs
) {

545 
vœtu®
 
wr™e_d–_log
() {

547 
¡d
::
¡ršg
 
d–âame
 = 
iomgr
->
muÉËx´efix
(0è+ 
ba£_f’ame
 + ".deltalog";

548 
FILE
 * 
	gdf
 = 
fİ’
(
d–âame
.
c_¡r
(), (
chicÚ‹xt
.
™”©iÚ
 == 0 ? "w" : "a"));

549 
årštf
(
df
, "%d,%lu,%lu,%lf\n", 
chicÚ‹xt
.
™”©iÚ
, 
nupd©es
, 
wÜk
, chicÚ‹xt.
g‘_d–
());

550 
fşo£
(
df
);

553 
	gpublic
:

555 
vœtu®
 
¡d
::
·œ
<
vid_t
, 
	gvid_t
> 
g‘_š‹rv®
(
i
) {

556  
	gš‹rv®s
[
i
];

562 
vid_t
 
g‘_š‹rv®_¡¬t
(
i
) {

563  
g‘_š‹rv®
(
i
).
	gfœ¡
;

569 
vid_t
 
g‘_š‹rv®_’d
(
i
) {

570  
g‘_š‹rv®
(
i
).
	g£cÚd
;

573 
vœtu®
 
size_t
 
num_v”tiûs
() {

574  1 + 
	gš‹rv®s
[
nsh¬ds
 - 1].
	g£cÚd
;

577 
	gg¿phchi_cÚ‹xt
 &
g‘_cÚ‹xt
() {

578  
	gchicÚ‹xt
;

581 
vœtu®
 
g‘_nsh¬ds
() {

582  
	gnsh¬ds
;

585 
size_t
 
num_upd©es
() {

586  
	gnupd©es
;

592 
vœtu®
 
size_t
 
num_edges_§ã
() {

593  
num_edges
();

596 
vœtu®
 
size_t
 
num_bufã»d_edges
() {

603 
vœtu®
 
size_t
 
num_edges
() {

604 ià(
	g¦idšg_sh¬ds
.
size
() == 0) {

605 
log¡»am
(
LOG_ERROR
è<< "’gše.num_edges(èÿÀbÿÎed oÆy‡á”ƒngšha b“À¡¬‹d. TØbfixed†©”. A ¨wÜk¬ound,…uˆth’gšštØ¨glob® v¬ŸbË,‡nd qu”yhnumb”‡á”w¬d š begš_™”©iÚ(), fÜƒxam¶e." << 
¡d
::
’dl
;

606 
as£¹
(
çl£
);

608 ià(
	gÚly_adjaûncy
) {

610 
log¡»am
(
LOG_ERROR
è<< "Asked‚umb” oàedges, buˆ’gšwa ruÀw™houˆedge-d©a." << 
	g¡d
::
’dl
;

613  
	gÃdges
;

621 
boŞ
 
is_ªy_v”‹x_scheduËd
(
vid_t
 
¡
, vid_ˆ
’
) {

622 ià(
	gscheduËr
 =ğ
NULL
è 
Œue
;

623 
vid_t
 
	gv
=
¡
; v<=
’
; v++) {

624 ià(
	gscheduËr
->
is_scheduËd
(
v
)) {

625  
	gŒue
;

628  
	gçl£
;

631 
vœtu®
 
š™Ÿlize_™”
() {

635 
vœtu®
 
š™Ÿlize_befÜe_run
() {

636 ià(
	g»£t_v”‹xd©a
) {

637 
	gv”‹x_d©a_hªdËr
->
ş—r
(
num_v”tiûs
());

641 
vœtu®
 
memsh¬d_t
 * 
ü—‹_memsh¬d
(
vid_t
 
š‹rv®_¡
, vid_ˆ
š‹rv®_’
) {

642 #iâdeà
DYNAMICEDATA


643  
Ãw
 
memsh¬d_t
(
this
->
iomgr
,

644 
f’ame_sh¬d_ed©a
<
EdgeD©aTy³
>(
ba£_f’ame
, 
exec_š‹rv®
, 
nsh¬ds
),

645 
f’ame_sh¬d_adj
(
ba£_f’ame
, 
exec_š‹rv®
, 
nsh¬ds
),

646 
š‹rv®_¡
,

647 
š‹rv®_’
,

648 
blocksize
,

649 
m
);

651  
Ãw
 
memsh¬d_t
(
this
->
iomgr
,

652 
f’ame_sh¬d_ed©a
<>(
ba£_f’ame
, 
exec_š‹rv®
, 
nsh¬ds
),

653 
f’ame_sh¬d_adj
(
ba£_f’ame
, 
exec_š‹rv®
, 
nsh¬ds
),

654 
š‹rv®_¡
,

655 
š‹rv®_’
,

656 
blocksize
,

657 
m
);

666 
run
(
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
EdgeD©aTy³
, 
sv”‹x_t
> &
u£½rog¿m
, 
_n™”s
) {

667 
	gm
.
¡¬t_time
("runtime");

668 ià(
	gdeg»e_hªdËr
 =ğ
NULL
)

669 
deg»e_hªdËr
 = 
ü—‹_deg»e_hªdËr
();

672 
	gn™”s
 = 
_n™”s
;

673 
log¡»am
(
LOG_INFO
è<< "G¿phCh˜¡¬tšg" << 
	g¡d
::
’dl
;

674 
log¡»am
(
LOG_INFO
è<< "Liûn£d und”hA·chLiûn£ 2.0" << 
	g¡d
::
’dl
;

675 
log¡»am
(
LOG_INFO
è<< "CİyrighˆA­ØKyrŞ¨‘‡l., C¬Ãg› M–lÚ Univ”s™y (2012)" << 
	g¡d
::
’dl
;

677 ià(
	gv”‹x_d©a_hªdËr
 =ğ
NULL
)

678 
v”‹x_d©a_hªdËr
 = 
Ãw
 
v”‹x_d©a_¡Üe
<
V”‹xD©aTy³
>(
ba£_f’ame
, 
num_v”tiûs
(), 
	giomgr
);

680 
š™Ÿlize_befÜe_run
();

684 ià(
	g¦idšg_sh¬ds
.
size
() == 0) {

685 
š™Ÿlize_¦idšg_sh¬ds
();

687 
log¡»am
(
LOG_DEBUG
è<< "Engšbešg„e¡¬‹d, dØnÙ„eš™Ÿlize." << 
	g¡d
::
’dl
;

690 
š™Ÿlize_scheduËr
();

691 
omp_£t_Ã¡ed
(1);

695 
	gchicÚ‹xt
.
	gscheduËr
 = 
scheduËr
;

696 ià(
	gscheduËr
 =ğ
NULL
) {

697 
chicÚ‹xt
.
scheduËr
 = 
Ãw
 
nÚ_scheduËr
();

701 
´št_cÚfig
();

705 
	g™”
=0; i‹¸< 
	gn™”s
; iter++) {

706 
log¡»am
(
LOG_INFO
è<< "S¹ i‹¿tiÚ: " << 
	g™”
 << 
	g¡d
::
’dl
;

708 
š™Ÿlize_™”
();

711 ià(!
	gdi§bË_v”‹xd©a_¡Üage
)

712 
	gv”‹x_d©a_hªdËr
->
check_size
(
num_v”tiûs
());

715 
	gchicÚ‹xt
.
	gf’ame
 = 
ba£_f’ame
;

716 
	gchicÚ‹xt
.
	g™”©iÚ
 = 
™”
;

717 
	gchicÚ‹xt
.
	gnum_™”©iÚs
 = 
n™”s
;

718 
	gchicÚ‹xt
.
	gnv”tiûs
 = 
num_v”tiûs
();

719 ià(!
	gÚly_adjaûncy
è
	gchicÚ‹xt
.
	gÃdges
 = 
num_edges
();

721 
	gchicÚ‹xt
.
	gexeùh»ads
 = 
exec_th»ads
;

722 
	gchicÚ‹xt
.
»£t_d–s
(
exec_th»ads
);

725 ià(!
is_šmemÜy_mode
())

726 
	gu£½rog¿m
.
befÜe_™”©iÚ
(
™”
, 
chicÚ‹xt
);

729 ià(
	gu£_£Ëùive_schedulšg
) {

730 ià(
	gscheduËr
 !ğ
NULL
) {

731 ià(!
scheduËr
->
has_Ãw_sks
) {

732 
log¡»am
(
LOG_INFO
è<< "NØÃwask tØrun!" << 
¡d
::
’dl
;

735 
	gscheduËr
->
	ghas_Ãw_sks
 = 
çl£
;

740 
	gexec_š‹rv®
=0;ƒxec_š‹rv® < 
	gnsh¬ds
; ++exec_interval) {

742 
vid_t
 
	gš‹rv®_¡
 = 
g‘_š‹rv®_¡¬t
(
exec_š‹rv®
);

743 
vid_t
 
	gš‹rv®_’
 = 
g‘_š‹rv®_’d
(
exec_š‹rv®
);

745 ià(
	gš‹rv®_¡
 > 
	gš‹rv®_’
) ;

747 ià(!
is_šmemÜy_mode
())

748 
	gu£½rog¿m
.
befÜe_exec_š‹rv®
(
š‹rv®_¡
, 
š‹rv®_’
, 
chicÚ‹xt
);

751 
	g¦idšg_sh¬ds
[
exec_š‹rv®
]->
æush
();

752 
	giomgr
->
wa™_fÜ_wr™es
();

755 ià(
	gmemÜysh¬d
 !ğ
NULL
è
d–‘e
 
memÜysh¬d
;

756 
	gmemÜysh¬d
 = 
ü—‹_memsh¬d
(
š‹rv®_¡
, 
š‹rv®_’
);

757 
	gmemÜysh¬d
->
	gÚly_adjaûncy
 = 
Úly_adjaûncy
;

759 
	gsub_š‹rv®_¡
 = 
š‹rv®_¡
;

760 
log¡»am
(
LOG_INFO
è<< 
	gchicÚ‹xt
.
ruÁime
() << "s: Starting: "

761 << 
	gsub_š‹rv®_¡
 << " -- " << 
	gš‹rv®_’
 << 
	g¡d
::
’dl
;

763 
	gsub_š‹rv®_¡
 <ğ
š‹rv®_’
) {

765 
modifiÿtiÚ_lock
.
lock
();

767 
	gsub_š‹rv®_’
 = 
d‘”mše_Ãxt_wšdow
(
exec_š‹rv®
,

768 
sub_š‹rv®_¡
,

769 
¡d
::
mš
(
š‹rv®_’
, 
sub_š‹rv®_¡
 + 
maxwšdow
),

770 
size_t
(
membudg‘_mb
) * 1024 * 1024);

771 
as£¹
(
sub_š‹rv®_’
 >ğ
sub_š‹rv®_¡
);

773 
log¡»am
(
LOG_INFO
è<< "I‹¿tiÚ " << 
	g™”
 << "/" << (
	gn™”s
 - 1è<< ", subš‹rv®: " << 
	gsub_š‹rv®_¡
 << " - " << 
	gsub_š‹rv®_’
 << 
	g¡d
::
’dl
;

775 
boŞ
 
	gªy_v”‹x_scheduËd
 = 
is_ªy_v”‹x_scheduËd
(
sub_š‹rv®_¡
, 
sub_š‹rv®_’
);

776 ià(!
	gªy_v”‹x_scheduËd
) {

777 
log¡»am
(
LOG_INFO
è<< "NØv”tiû scheduËd, sk." << 
	g¡d
::
’dl
;

778 
	gsub_š‹rv®_¡
 = 
sub_š‹rv®_’
 + 1;

779 
	gmodifiÿtiÚ_lock
.
uÆock
();

784 
	gnv”tiûs
 = 
sub_š‹rv®_’
 - 
sub_š‹rv®_¡
 + 1;

785 
	gg¿phchi_edge
<
	gEdgeD©aTy³
> * 
	ged©a
 = 
NULL
;

787 
	g¡d
::
veùÜ
<
sv”‹x_t
> 
v”tiûs
(
nv”tiûs
, svertex_t());

788 
š™_v”tiûs
(
v”tiûs
, 
ed©a
);

791 ià(
	gscheduËr
 !ğ
NULL
)

792 
scheduËr
->
»move_sks
(
sub_š‹rv®_¡
, 
sub_š‹rv®_’
);

795 
lßd_befÜe_upd©es
(
v”tiûs
);

797 
	gmodifiÿtiÚ_lock
.
uÆock
();

799 
log¡»am
(
LOG_INFO
è<< "S¹ upd©es" << 
	g¡d
::
’dl
;

801 ià(!
is_šmemÜy_mode
()) {

802 
exec_upd©es
(
u£½rog¿m
, 
v”tiûs
);

804 
lßd_aá”_upd©es
(
v”tiûs
);

807 
exec_upd©es_šmemÜy_mode
(
u£½rog¿m
, 
v”tiûs
);

809 
log¡»am
(
LOG_INFO
è<< "Fšished upd©es" << 
	g¡d
::
’dl
;

813 ià(!
	gdi§bË_v”‹xd©a_¡Üage
) {

814 
§ve_v”tiûs
(
v”tiûs
);

816 
	gsub_š‹rv®_¡
 = 
sub_š‹rv®_’
 + 1;

819 ià(
	ged©a
 !ğ
NULL
) {

820 
d–‘e
 
ed©a
;

821 
	ged©a
 = 
NULL
;

826 ià(
	gmemÜysh¬d
->
lßded
(è&& !
is_šmemÜy_mode
()) {

827 
log¡»am
(
LOG_INFO
è<< "Comm™ memsh¬d" << 
	g¡d
::
’dl
;

829 
	gmemÜysh¬d
->
comm™
(
modif›s_šedges
, 
modif›s_ou‹dges
);

831 
	g¦idšg_sh¬ds
[
exec_š‹rv®
]->
£t_off£t
(
memÜysh¬d
->
off£t_fÜ_¡»am_cÚt
(), memÜysh¬d->
off£t_vid_fÜ_¡»am_cÚt
(),

832 
memÜysh¬d
->
ed©a_±r_fÜ_¡»am_cÚt
());

834 
d–‘e
 
	gmemÜysh¬d
;

835 
	gmemÜysh¬d
 = 
NULL
;

837 ià(!
is_šmemÜy_mode
())

838 
	gu£½rog¿m
.
aá”_exec_š‹rv®
(
š‹rv®_¡
, 
š‹rv®_’
, 
chicÚ‹xt
);

842 ià(!
is_šmemÜy_mode
())

843 
	gu£½rog¿m
.
aá”_™”©iÚ
(
™”
, 
chicÚ‹xt
);

847 
	gp
=0;…<
	gnsh¬ds
;…++) {

848 
	g¦idšg_sh¬ds
[
p
]->
æush
();

849 
	g¦idšg_sh¬ds
[
p
]->
£t_off£t
(0, 0, 0);

851 
	giomgr
->
wa™_fÜ_wr™es
();

854 
wr™e_d–_log
();

857 ià(
	gchicÚ‹xt
.
	gÏ¡_™”©iÚ
 >= 0) {

858 
n™”s
 = 
chicÚ‹xt
.
Ï¡_™”©iÚ
 + 1;

859 
log¡»am
(
LOG_DEBUG
è<< "La¡ i‹¿tiÚ i now: " << (
	gn™”s
-1è<< 
	g¡d
::
’dl
;

861 
™”©iÚ_fšished
();

865 ià(
	g´–ßd_comm™
)

866 
	giomgr
->
comm™_´–ßded
();

868 
	gm
.
¡İ_time
("runtime");

870 
	gm
.
£t
("upd©es", 
nupd©es
);

871 
	gm
.
£t
("wÜk", 
wÜk
);

872 
	gm
.
£t
("nv”tiûs", 
num_v”tiûs
());

873 
	gm
.
£t
("exeùh»ads", (
size_t
)
exec_th»ads
);

874 
	gm
.
£t
("lßdth»ads", (
size_t
)
lßd_th»ads
);

875 
	gm
.
£t
("compression", 1);

876 
	gm
.
£t
("scheduËr", (
size_t
)
u£_£Ëùive_schedulšg
);

877 
	gm
.
£t
("n™”s", 
n™”s
);

881 
vœtu®
 
™”©iÚ_fšished
() {

885 
¡redio
 * 
g‘_iomªag”
() {

886  
	giomgr
;

889 
vœtu®
 
£t_modif›s_šedges
(
boŞ
 
b
) {

890 
	gmodif›s_šedges
 = 
b
;

893 
vœtu®
 
£t_modif›s_ou‹dges
(
boŞ
 
b
) {

894 
	gmodif›s_ou‹dges
 = 
b
;

897 
vœtu®
 
£t_Úly_adjaûncy
(
boŞ
 
b
) {

898 
	gÚly_adjaûncy
 = 
b
;

901 
vœtu®
 
£t_´–ßd_comm™
(
boŞ
 
b
){

902 
	g´–ßd_comm™
 = 
b
;

910 
£t_blocksize
(
size_t
 
blocksize_š_by‹s
) {

911 
	gblocksize
 = 
blocksize_š_by‹s
;

919 
£t_membudg‘_mb
(
mbs
) {

920 
	gmembudg‘_mb
 = 
mbs
;

924 
£t_lßd_th»ads
(
É
) {

925 
	glßd_th»ads
 = 
É
;

928 
£t_exec_th»ads
(
‘
) {

929 
	gexec_th»ads
 = 
‘
;

936 
£t_’abË_d‘”mši¡ic_·¿Î–ism
(
boŞ
 
b
) {

937 #ifdeà
DYNAMICEDATA


938 ià(!
	gb
) {

939 
log¡»am
(
LOG_ERROR
è<< "W™h dyÇmiøedgd©a, you cªnÙ di§bË d‘”mšiø·¿Î–ism." << 
	g¡d
::
’dl
;

940 
log¡»am
(
LOG_ERROR
è<< "Oth”wi£„aû cÚd™iÚ would cÜru±h¡ruùu» oàthd©a." << 
	g¡d
::
’dl
;

941 
as£¹
(
b
);

945 
	g’abË_d‘”mši¡ic_·¿Î–ism
 = 
b
;

948 
	gpublic
:

949 
£t_di§bË_v”‹xd©a_¡Üage
() {

950 
this
->
di§bË_v”‹xd©a_¡Üage
 = 
Œue
;

953 
£t_’abË_v”‹xd©a_¡Üage
() {

954 
	gthis
->
	gdi§bË_v”‹xd©a_¡Üage
 = 
çl£
;

957 
£t_maxwšdow
(
_maxwšdow
){

958 
	gmaxwšdow
 = 
_maxwšdow
;

961 
	g´Ùeùed
:

963 
vœtu®
 
_lßd_v”‹x_š‹rv®s
() {

964 
lßd_v”‹x_š‹rv®s
(
ba£_f’ame
, 
nsh¬ds
, 
š‹rv®s
);

967 
	g´Ùeùed
:

968 
mu‹x
 
h‰¶ock
;

969 
	g¡d
::
m­
<
¡d
::
¡ršg
, std::¡ršg> 
jsÚ_·¿ms
;

971 
	gpublic
:

976 
‹m¶©e
<
ty³Çme
 
ET
>

977 
»š™Ÿlize_edge_d©a
(
ET
 
z”ov®ue
) {

979 
p
=0; 
	gp
 < 
	gnsh¬ds
;…++) {

980 
	g¡d
::
¡ršg
 
ed©ash¬dÇme
 = 
f’ame_sh¬d_ed©a
<
ET
>(
ba£_f’ame
, 
	gp
, 
	gnsh¬ds
);

981 
	g¡d
::
¡ršg
 
dœÇme
 = 
dœÇme_sh¬d_ed©a_block
(
ed©ash¬dÇme
, 
blocksize
);

982 
size_t
 
	ged©asize
 = 
g‘_sh¬d_ed©a_fesize
<
ET
>(
ed©ash¬dÇme
);

983 
log¡»am
(
LOG_INFO
è<< "CË¬šg d©a: " << 
	ged©ash¬dÇme
 << " by‹s: " << 
	ged©asize
 << 
	g¡d
::
’dl
;

984 
	gnblocks
 = (
ed©asize
 / 
blocksize
) + (edatasize % blocksize == 0 ? 0 : 1);

985 
	gi
=0; i < 
	gnblocks
; i++) {

986 
	g¡d
::
¡ršg
 
block_f’ame
 = 
f’ame_sh¬d_ed©a_block
(
ed©ash¬dÇme
, 
i
, 
blocksize
);

987 
	gËn
 = (è
¡d
::
mš
(
ed©asize
 - 
i
 * 
blocksize
, blocksize);

988 
	gf
 = 
İ’
(
block_f’ame
.
c_¡r
(), 
O_RDWR
 | 
O_CREAT
, 
S_IROTH
 | 
S_IWOTH
 | 
S_IWUSR
 | 
S_IRUSR
);

989 
ET
 * 
	gbuf
 = (ET *è
m®loc
(
Ën
);

990 
	gi
=0; i < (è(
	gËn
 / (
	gET
)); i++) {

991 
	gbuf
[
i
] = 
z”ov®ue
;

993 
wr™e_com´es£d
(
f
, 
buf
, 
Ën
);

994 
şo£
(
f
);

996 #ifdeà
DYNAMICEDATA


997 
wr™e_block_uncom´es£d_size
(
block_f’ame
, 
Ën
);

1009 
£t_»£t_v”‹xd©a
(
boŞ
 
»£t
) {

1010 
	g»£t_v”‹xd©a
 = 
»£t
;

1018 
£t_jsÚ
(
¡d
::
¡ršg
 
key
, std::¡ršg 
v®ue
) {

1019 
h‰¶ock
.
lock
();

1020 
	gjsÚ_·¿ms
[
key
] = 
v®ue
;

1021 
	gh‰¶ock
.
uÆock
();

1024 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1025 
£t_jsÚ
(
¡d
::
¡ršg
 
key
, 
T
 
v®
) {

1026 
	g¡d
::
¡ršg¡»am
 
ss
;

1027 
	gss
 << 
	gv®
;

1028 
£t_jsÚ
(
key
, 
ss
.
¡r
());

1031 
	g¡d
::
¡ršg
 
g‘_šfo_jsÚ
() {

1032 
¡d
::
¡ršg¡»am
 
jsÚ
;

1033 
	gjsÚ
 << "{";

1034 
	gjsÚ
 << "\"fe\" : \"" << 
	gba£_f’ame
 << "\",\n";

1035 
	gjsÚ
 << "\"numOfSh¬ds\": " << 
	gnsh¬ds
 << ",\n";

1036 
	gjsÚ
 << "\"™”©iÚ\": " << 
	gchicÚ‹xt
.
	g™”©iÚ
 << ",\n";

1037 
	gjsÚ
 << "\"numI‹¿tiÚs\": " << 
	gchicÚ‹xt
.
	gnum_™”©iÚs
 << ",\n";

1038 
	gjsÚ
 << "\"runTime\": " << 
	gchicÚ‹xt
.
ruÁime
() << ",\n";

1040 
	gjsÚ
 << "\"upd©es\": " << 
	gnupd©es
 << ",\n";

1041 
	gjsÚ
 << "\"nv”tiûs\": " << 
	gchicÚ‹xt
.
	gnv”tiûs
 << ",\n";

1042 
	gjsÚ
 << "\"š‹rv®\":" << 
	gexec_š‹rv®
 << ",\n";

1043 
	gjsÚ
 << "\"wšdowS¹\":" << 
	gsub_š‹rv®_¡
 << ",";

1044 
	gjsÚ
 << "\"wšdowEnd\": " << 
	gsub_š‹rv®_’
 << ",";

1045 
	gjsÚ
 << "\"shards\": [";

1047 
	gp
=0;… < ()
	gnsh¬ds
;…++) {

1048 ià(
	gp
>0è
	gjsÚ
 << ",";

1050 
	gjsÚ
 << "{";

1051 
	gjsÚ
 << "\"p\": " << 
	gp
 << ", ";

1052 
	gjsÚ
 << 
	g¦idšg_sh¬ds
[
p
]->
g‘_šfo_jsÚ
();

1053 
	gjsÚ
 << "}";

1056 
	gjsÚ
 << "]";

1057 
	gjsÚ
 << "}";

1058  
	gjsÚ
.
¡r
();

	@src/external/vpiotr-mongoose-cpp/examples/chat.c

13 
	~<¡dio.h
>

14 
	~<¡dlib.h
>

15 
	~<as£¹.h
>

16 
	~<¡ršg.h
>

17 
	~<time.h
>

18 
	~<¡d¬g.h
>

19 
	~<±h»ad.h
>

21 
	~"mÚgoo£.h
"

23 
	#MAX_USER_LEN
 20

	)

24 
	#MAX_MESSAGE_LEN
 100

	)

25 
	#MAX_MESSAGES
 5

	)

26 
	#MAX_SESSIONS
 2

	)

27 
	#SESSION_TTL
 120

	)

29 cÚ¡ *
	gauthÜize_u¾
 = "/authorize";

30 cÚ¡ *
	glogš_u¾
 = "/login.html";

31 cÚ¡ *
	gajax_»¶y_¡¬t
 =

39 
	smes§ge
 {

40 
	mid
;

41 
	mu£r
[
MAX_USER_LEN
];

42 
	m‹xt
[
MAX_MESSAGE_LEN
];

43 
time_t
 
	mtime¡amp
;

47 
	s£ssiÚ
 {

48 
	m£ssiÚ_id
[33];

49 
	m¿ndom
[20];

50 
	mu£r
[
MAX_USER_LEN
];

51 
time_t
 
	mexpœe
;

54 
mes§ge
 
	gmes§ges
[
MAX_MESSAGES
];

55 
£ssiÚ
 
	g£ssiÚs
[
MAX_SESSIONS
];

56 
	gÏ¡_mes§ge_id
;

59 
±h»ad_rwlock_t
 
	grwlock
 = 
PTHREAD_RWLOCK_INITIALIZER
;

62 
£ssiÚ
 *
	$g‘_£ssiÚ
(cÚ¡ 
mg_cÚÃùiÚ
 *
cÚn
) {

63 
i
;

64 
£ssiÚ_id
[33];

65 
time_t
 
now
 = 
	`time
(
NULL
);

66 
	`mg_g‘_cook›
(
cÚn
, "£ssiÚ", 
£ssiÚ_id
, (session_id));

67 
i
 = 0; i < 
MAX_SESSIONS
; i++) {

68 ià(
£ssiÚs
[
i
].
expœe
 != 0 &&

69 
£ssiÚs
[
i
].
expœe
 > 
now
 &&

70 
	`¡rcmp
(
£ssiÚs
[
i
].
£ssiÚ_id
, session_id) == 0) {

74  
i
 =ğ
MAX_SESSIONS
 ? 
NULL
 : &
£ssiÚs
[i];

75 
	}
}

77 
	$g‘_qsv¬
(cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
,

78 cÚ¡ *
Çme
, *
d¡
, 
size_t
 
d¡_Ën
) {

79 cÚ¡ *
qs
 = 
»que¡_šfo
->
qu”y_¡ršg
;

80 
	`mg_g‘_v¬
(
qs
, 
	`¡¾’
(q =ğ
NULL
 ? "" : qs), 
Çme
, 
d¡
, 
d¡_Ën
);

81 
	}
}

87 *
	$mes§ges_to_jsÚ
(
Ï¡_id
) {

88 cÚ¡ 
mes§ge
 *message;

89 
max_msgs
, 
Ën
;

90 
buf
[(
mes§ges
)];

93 
	`±h»ad_rwlock_rdlock
(&
rwlock
);

94 
Ën
 = 0;

95 
max_msgs
 = (
mes§ges
) / (messages[0]);

97 ià(
Ï¡_mes§ge_id
 - 
Ï¡_id
 > 
max_msgs
) {

98 
Ï¡_id
 = 
Ï¡_mes§ge_id
 - 
max_msgs
;

100 ; 
Ï¡_id
 < 
Ï¡_mes§ge_id
;†ast_id++) {

101 
mes§ge
 = &
mes§ges
[
Ï¡_id
 % 
max_msgs
];

102 ià(
mes§ge
->
time¡amp
 == 0) {

108 
Ën
 +ğ
	`¢´štf
(
buf
 +†en, (buf) -†en,

110 
mes§ge
->
u£r
, mes§ge->
‹xt
, mes§ge->
time¡amp
, mes§ge->
id
);

111 
	`as£¹
(
Ën
 > 0);

112 
	`as£¹
((
size_t
è
Ën
 < (
buf
));

114 
	`±h»ad_rwlock_uÆock
(&
rwlock
);

116  
Ën
 =ğ0 ? 
NULL
 : 
	`¡rdup
(
buf
);

117 
	}
}

122 
	$hªdË_jsÚp
(
mg_cÚÃùiÚ
 *
cÚn
,

123 cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
) {

124 
cb
[64];

126 
	`g‘_qsv¬
(
»que¡_šfo
, "ÿÎback", 
cb
, (cb));

127 ià(
cb
[0] != '\0') {

128 
	`mg_´štf
(
cÚn
, "%s(", 
cb
);

131  
cb
[0] == '\0' ? 0 : 1;

132 
	}
}

136 
	$ajax_g‘_mes§ges
(
mg_cÚÃùiÚ
 *
cÚn
,

137 cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
) {

138 
Ï¡_id
[32], *
jsÚ
;

139 
is_jsÚp
;

141 
	`mg_´štf
(
cÚn
, "%s", 
ajax_»¶y_¡¬t
);

142 
is_jsÚp
 = 
	`hªdË_jsÚp
(
cÚn
, 
»que¡_šfo
);

144 
	`g‘_qsv¬
(
»que¡_šfo
, "Ï¡_id", 
Ï¡_id
, (last_id));

145 ià((
jsÚ
 = 
	`mes§ges_to_jsÚ
(
	`¡¹oul
(
Ï¡_id
, 
NULL
, 10))) != NULL) {

146 
	`mg_´štf
(
cÚn
, "[%s]", 
jsÚ
);

147 
	`ä“
(
jsÚ
);

150 ià(
is_jsÚp
) {

151 
	`mg_´štf
(
cÚn
, "%s", ")");

153 
	}
}

156 
mes§ge
 *
	$Ãw_mes§ge
() {

157 
size
 = (
mes§ges
) / (messages[0]);

158 
mes§ge
 *mes§gğ&
mes§ges
[
Ï¡_mes§ge_id
 % 
size
];

159 
mes§ge
->
id
 = 
Ï¡_mes§ge_id
++;

160 
mes§ge
->
time¡amp
 = 
	`time
(0);

161  
mes§ge
;

162 
	}
}

164 
	$my_¡¾ıy
(*
d¡
, cÚ¡ *
¤c
, 
size_t
 
Ën
) {

165 
	`¡ºıy
(
d¡
, 
¤c
, 
Ën
);

166 
d¡
[
Ën
 - 1] = '\0';

167 
	}
}

170 
	$ajax_£nd_mes§ge
(
mg_cÚÃùiÚ
 *
cÚn
,

171 cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
) {

172 
mes§ge
 *message;

173 
£ssiÚ
 *session;

174 
‹xt
[(
mes§ge
->text) - 1];

175 
is_jsÚp
;

177 
	`mg_´štf
(
cÚn
, "%s", 
ajax_»¶y_¡¬t
);

178 
is_jsÚp
 = 
	`hªdË_jsÚp
(
cÚn
, 
»que¡_šfo
);

180 
	`g‘_qsv¬
(
»que¡_šfo
, "‹xt", 
‹xt
, (text));

181 ià(
‹xt
[0] != '\0') {

184 
	`±h»ad_rwlock_w¾ock
(&
rwlock
);

185 
mes§ge
 = 
	`Ãw_mes§ge
();

187 
£ssiÚ
 = 
	`g‘_£ssiÚ
(
cÚn
);

188 
	`as£¹
(
£ssiÚ
 !ğ
NULL
);

189 
	`my_¡¾ıy
(
mes§ge
->
‹xt
,ext, (text));

190 
	`my_¡¾ıy
(
mes§ge
->
u£r
, 
£ssiÚ
->user, (message->user));

191 
	`±h»ad_rwlock_uÆock
(&
rwlock
);

194 
	`mg_´štf
(
cÚn
, "%s", 
‹xt
[0] == '\0' ? "false" : "true");

196 ià(
is_jsÚp
) {

197 
	`mg_´štf
(
cÚn
, "%s", ")");

199 
	}
}

203 
	$»dœeù_to_logš
(
mg_cÚÃùiÚ
 *
cÚn
,

204 cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
) {

205 
	`mg_´štf
(
cÚn
, "HTTP/1.1 302 Found\r\n"

208 
»que¡_šfo
->
uri
, 
logš_u¾
);

209 
	}
}

212 
	$check_·sswÜd
(cÚ¡ *
u£r
, cÚ¡ *
·sswÜd
) {

216  (
u£r
[0] && 
·sswÜd
[0]);

217 
	}
}

220 
£ssiÚ
 *
	$Ãw_£ssiÚ
() {

221 
i
;

222 
time_t
 
now
 = 
	`time
(
NULL
);

223 
	`±h»ad_rwlock_w¾ock
(&
rwlock
);

224 
i
 = 0; i < 
MAX_SESSIONS
; i++) {

225 ià(
£ssiÚs
[
i
].
expœe
 =ğ0 || sessiÚs[i].expœ< 
now
) {

226 
£ssiÚs
[
i
].
expœe
 = 
	`time
(0è+ 
SESSION_TTL
;

230 
	`±h»ad_rwlock_uÆock
(&
rwlock
);

231  
i
 =ğ
MAX_SESSIONS
 ? 
NULL
 : &
£ssiÚs
[i];

232 
	}
}

237 
	$g’”©e_£ssiÚ_id
(*
buf
, cÚ¡ *
¿ndom
,

238 cÚ¡ *
u£r
) {

239 
	`mg_md5
(
buf
, 
¿ndom
, 
u£r
, 
NULL
);

240 
	}
}

242 
	$£nd_£rv”_mes§ge
(cÚ¡ *
fmt
, ...) {

243 
va_li¡
 
­
;

244 
mes§ge
 *message;

246 
	`±h»ad_rwlock_w¾ock
(&
rwlock
);

247 
mes§ge
 = 
	`Ãw_mes§ge
();

248 
mes§ge
->
u£r
[0] = '\0';

249 
	`va_¡¬t
(
­
, 
fmt
);

250 
	`v¢´štf
(
mes§ge
->
‹xt
, (mes§ge->‹xt), 
fmt
, 
­
);

251 
	`va_’d
(
­
);

253 
	`±h»ad_rwlock_uÆock
(&
rwlock
);

254 
	}
}

258 
	$authÜize
(
mg_cÚÃùiÚ
 *
cÚn
,

259 cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
) {

260 
u£r
[
MAX_USER_LEN
], 
·sswÜd
[MAX_USER_LEN];

261 
£ssiÚ
 *session;

264 
	`g‘_qsv¬
(
»que¡_šfo
, "u£r", 
u£r
, (user));

265 
	`g‘_qsv¬
(
»que¡_šfo
, "·sswÜd", 
·sswÜd
, (password));

267 ià(
	`check_·sswÜd
(
u£r
, 
·sswÜd
è&& (
£ssiÚ
 = 
	`Ãw_£ssiÚ
()è!ğ
NULL
) {

279 
	`my_¡¾ıy
(
£ssiÚ
->
u£r
, user, (session->user));

280 
	`¢´štf
(
£ssiÚ
->
¿ndom
, (£ssiÚ->¿ndom), "%d", 
	`¿nd
());

281 
	`g’”©e_£ssiÚ_id
(
£ssiÚ
->
£ssiÚ_id
, sessiÚ->
¿ndom
, sessiÚ->
u£r
);

282 
	`£nd_£rv”_mes§ge
("<%s> jošed", 
£ssiÚ
->
u£r
);

283 
	`mg_´štf
(
cÚn
, "HTTP/1.1 302 Found\r\n"

288 
£ssiÚ
->
£ssiÚ_id
, sessiÚ->
u£r
);

291 
	`»dœeù_to_logš
(
cÚn
, 
»que¡_šfo
);

293 
	}
}

296 
	$is_authÜized
(cÚ¡ 
mg_cÚÃùiÚ
 *
cÚn
,

297 cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
) {

298 
£ssiÚ
 *session;

299 
v®id_id
[33];

300 
authÜized
 = 0;

303 ià(!
	`¡rcmp
(
»que¡_šfo
->
uri
, 
logš_u¾
) ||

304 !
	`¡rcmp
(
»que¡_šfo
->
uri
, 
authÜize_u¾
)) {

308 
	`±h»ad_rwlock_rdlock
(&
rwlock
);

309 ià((
£ssiÚ
 = 
	`g‘_£ssiÚ
(
cÚn
)è!ğ
NULL
) {

310 
	`g’”©e_£ssiÚ_id
(
v®id_id
, 
£ssiÚ
->
¿ndom
, sessiÚ->
u£r
);

311 ià(
	`¡rcmp
(
v®id_id
, 
£ssiÚ
->
£ssiÚ_id
) == 0) {

312 
£ssiÚ
->
expœe
 = 
	`time
(0è+ 
SESSION_TTL
;

313 
authÜized
 = 1;

316 
	`±h»ad_rwlock_uÆock
(&
rwlock
);

318  
authÜized
;

319 
	}
}

321 
	$»dœeù_to_s¦
(
mg_cÚÃùiÚ
 *
cÚn
,

322 cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
) {

323 cÚ¡ *
p
, *
ho¡
 = 
	`mg_g‘_h—d”
(
cÚn
, "Host");

324 ià(
ho¡
 !ğ
NULL
 && (
p
 = 
	`¡rchr
(host, ':')) != NULL) {

325 
	`mg_´štf
(
cÚn
, "HTTP/1.1 302 Found\r\n"

327 
p
 - 
ho¡
, ho¡, 
»que¡_šfo
->
uri
);

329 
	`mg_´štf
(
cÚn
, "%s", "HTTP/1.1 500 Error\r\n\r\nHost: header is‚ot set");

331 
	}
}

333 *
	$ev’t_hªdËr
(
mg_ev’t
 
ev’t
,

334 
mg_cÚÃùiÚ
 *
cÚn
,

335 cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
) {

336 *
´oûs£d
 = "yes";

338 ià(
ev’t
 =ğ
MG_NEW_REQUEST
) {

339 ià(!
»que¡_šfo
->
is_s¦
) {

340 
	`»dœeù_to_s¦
(
cÚn
, 
»que¡_šfo
);

341 } ià(!
	`is_authÜized
(
cÚn
, 
»que¡_šfo
)) {

342 
	`»dœeù_to_logš
(
cÚn
, 
»que¡_šfo
);

343 } ià(
	`¡rcmp
(
»que¡_šfo
->
uri
, 
authÜize_u¾
) == 0) {

344 
	`authÜize
(
cÚn
, 
»que¡_šfo
);

345 } ià(
	`¡rcmp
(
»que¡_šfo
->
uri
, "/ajax/get_messages") == 0) {

346 
	`ajax_g‘_mes§ges
(
cÚn
, 
»que¡_šfo
);

347 } ià(
	`¡rcmp
(
»que¡_šfo
->
uri
, "/ajax/send_message") == 0) {

348 
	`ajax_£nd_mes§ge
(
cÚn
, 
»que¡_šfo
);

352 
´oûs£d
 = 
NULL
;

355 
´oûs£d
 = 
NULL
;

358  
´oûs£d
;

359 
	}
}

361 cÚ¡ *
	gİtiÚs
[] = {

366 
NULL


369 
	$maš
() {

370 
mg_cÚ‹xt
 *
ùx
;

374 
	`¤ªd
((è
	`time
(0));

377 
ùx
 = 
	`mg_¡¬t
(&
ev’t_hªdËr
, 
NULL
, 
İtiÚs
);

378 
	`as£¹
(
ùx
 !ğ
NULL
);

381 
	`´štf
("Chat server started on…orts %s,…ressƒntero quit.\n",

382 
	`mg_g‘_İtiÚ
(
ùx
, "listening_ports"));

383 
	`g‘ch¬
();

384 
	`mg_¡İ
(
ùx
);

385 
	`´štf
("%s\n", "Chat server stopped.");

387  
EXIT_SUCCESS
;

388 
	}
}

	@src/external/vpiotr-mongoose-cpp/main.c

21 #ià
defšed
(
_WIN32
)

22 
	#_CRT_SECURE_NO_WARNINGS


23 #–£

	)

24 
	#_XOPEN_SOURCE
 600

26 

	)

27 
	~<sys/¡©.h
>

28 
	~<¡dio.h
>

29 
	~<¡dlib.h
>

30 
	~<sigÇl.h
>

31 
	~<¡ršg.h
>

32 
	~<”ºo.h
>

33 
	~<lim™s.h
>

34 
	~<¡ddef.h
>

35 
	~<¡d¬g.h
>

37 
	~"mÚgoo£.h
"

39 #ifdeà
_WIN32


40 
	~<wšdows.h
>

41 
	~<wšsvc.h
>

42 
	#PATH_MAX
 
MAX_PATH


	)

43 
	#S_ISDIR
(
x
è((xè& 
_S_IFDIR
)

	)

44 
	#DIRSEP
 '\\'

	)

45 
	#¢´štf
 
_¢´štf


	)

46 
	#v¢´štf
 
_v¢´štf


	)

47 
	#¦“p
(
x
è
	`SË•
((xè* 1000)

	)

48 
	#WINCDECL
 
__cdeş


	)

50 
	~<sys/wa™.h
>

51 
	~<uni¡d.h
>

52 
	#DIRSEP
 '/'

	)

53 
	#WINCDECL


	)

56 
	#MAX_OPTIONS
 40

	)

58 
	gex™_æag
;

59 
	g£rv”_Çme
[40];

60 
	gcÚfig_fe
[
PATH_MAX
];

61 
mg_cÚ‹xt
 *
	gùx
;

63 #ià!
defšed
(
CONFIG_FILE
)

64 
	#CONFIG_FILE
 "mÚgoo£.cÚf"

	)

67 
WINCDECL
 
	$sigÇl_hªdËr
(
sig_num
) {

68 
ex™_æag
 = 
sig_num
;

69 
	}
}

71 
	$d›
(cÚ¡ *
fmt
, ...) {

72 
va_li¡
 
­
;

73 
msg
[200];

75 
	`va_¡¬t
(
­
, 
fmt
);

76 
	`v¢´štf
(
msg
, (msg), 
fmt
, 
­
);

77 
	`va_’d
(
­
);

79 #ià
	`defšed
(
_WIN32
)

80 
	`Mes§geBox
(
NULL
, 
msg
, "E¼Ü", 
MB_OK
);

82 
	`årštf
(
¡d”r
, "%s\n", 
msg
);

85 
	`ex™
(
EXIT_FAILURE
);

86 
	}
}

91 
	$mg_ed™_·sswÜds
(cÚ¡ *
âame
, cÚ¡ *
domaš
,

92 cÚ¡ *
u£r
, cÚ¡ *
·ss
) {

93 
mg_cÚ‹xt
 *
ùx
;

94 cÚ¡ *
İtiÚs
[] = {"auth’tiÿtiÚ_domaš", 
NULL
, NULL};

95 
sucûss
;

97 
İtiÚs
[1] = 
domaš
;

98 
ùx
 = 
	`mg_¡¬t
(
NULL
, NULL, 
İtiÚs
);

99 
sucûss
 = 
	`mg_modify_·sswÜds_fe
(
ùx
, 
âame
, 
u£r
, 
·ss
);

100 
	`mg_¡İ
(
ùx
);

102  
sucûss
;

103 
	}
}

105 
	$show_u§ge_ªd_ex™
() {

106 cÚ¡ **
Çmes
;

107 
i
;

109 
	`årštf
(
¡d”r
, "MÚgoo£ v”siÚ % (cèS”gey Lyubka\n", 
	`mg_v”siÚ
());

110 
	`årštf
(
¡d”r
, "Usage:\n");

111 
	`årštf
(
¡d”r
, " mongoose -A <htpasswd_file> <realm> <user> <passwd>\n");

112 
	`årštf
(
¡d”r
, " mongoose <config_file>\n");

113 
	`årštf
(
¡d”r
, " mongoose [-option value ...]\n");

114 
	`årštf
(
¡d”r
, "OPTIONS:\n");

116 
Çmes
 = 
	`mg_g‘_v®id_İtiÚ_Çmes
();

117 
i
 = 0; 
Çmes
[i] !ğ
NULL
; i += 3) {

118 
	`årštf
(
¡d”r
, " -%s %s (default: \"%s\")\n",

119 
Çmes
[
i
],‚ames[˜+ 1],‚ames[˜+ 2] =ğ
NULL
 ? "" :‚ames[i + 2]);

121 
	`årštf
(
¡d”r
, "See http://code.google.com/p/mongoose/wiki/MongooseManual"

123 
	`årštf
(
¡d”r
, "Example:\n mongoose -s cert.pem -p 80,443s -d‚o\n");

124 
	`ex™
(
EXIT_FAILURE
);

125 
	}
}

127 
	$v”ify_docum’t_roÙ
(cÚ¡ *
roÙ
) {

128 cÚ¡ *
p
, *
·th
;

129 
buf
[
PATH_MAX
];

130 
¡©
 
¡
;

132 
·th
 = 
roÙ
;

133 ià((
p
 = 
	`¡rchr
(
roÙ
, ',')è!ğ
NULL
 && (
size_t
èÕ -„oÙè< (
buf
)) {

134 
	`¡ºıy
(
buf
, 
roÙ
, 
p
 -„oot);

135 
·th
 = 
buf
;

138 ià(
	`¡©
(
·th
, &
¡
è!ğ0 || !
	`S_ISDIR
(¡.
¡_mode
)) {

139 
	`d›
("Inv®id„oÙ dœeùÜy: \"%s\"", 
roÙ
);

141 
	}
}

143 *
	$sdup
(cÚ¡ *
¡r
) {

144 *
p
;

145 ià((
p
 = 
	`m®loc
(
	`¡¾’
(
¡r
è+ 1)è!ğ
NULL
) {

146 
	`¡rıy
(
p
, 
¡r
);

148  
p
;

149 
	}
}

151 
	$£t_İtiÚ
(**
İtiÚs
, cÚ¡ *
Çme
, cÚ¡ *
v®ue
) {

152 
i
;

154 ià(!
	`¡rcmp
(
Çme
, "document_root") || !(strcmp(name, "r"))) {

155 
	`v”ify_docum’t_roÙ
(
v®ue
);

158 
i
 = 0; i < 
MAX_OPTIONS
 - 3; i++) {

159 ià(
İtiÚs
[
i
] =ğ
NULL
) {

160 
İtiÚs
[
i
] = 
	`sdup
(
Çme
);

161 
İtiÚs
[
i
 + 1] = 
	`sdup
(
v®ue
);

162 
İtiÚs
[
i
 + 2] = 
NULL
;

167 ià(
i
 =ğ
MAX_OPTIONS
 - 3) {

168 
	`d›
("%s", "Too many options specified");

170 
	}
}

172 
	$´oûss_commªd_lše_¬gum’ts
(*
¬gv
[], **
İtiÚs
) {

173 
lše
[512], 
İt
[512], 
v®
[512], *
p
;

174 
FILE
 *
å
 = 
NULL
;

175 
size_t
 
i
, 
lše_no
 = 0;

177 
İtiÚs
[0] = 
NULL
;

180 ià(
¬gv
[1] !ğ
NULL
 &&‡rgv[2] == NULL) {

181 
	`¢´štf
(
cÚfig_fe
, (cÚfig_fe), "%s", 
¬gv
[1]);

182 } ià((
p
 = 
	`¡¼chr
(
¬gv
[0], 
DIRSEP
)è=ğ
NULL
) {

184 
	`¢´štf
(
cÚfig_fe
, (cÚfig_fe), "%s", 
CONFIG_FILE
);

186 
	`¢´štf
(
cÚfig_fe
, (config_file), "%.*s%c%s",

187 (è(
p
 - 
¬gv
[0]),‡rgv[0], 
DIRSEP
, 
CONFIG_FILE
);

190 
å
 = 
	`fİ’
(
cÚfig_fe
, "r");

193 ià(
¬gv
[1] !ğ
NULL
 &&‡rgv[2] =ğNULL && 
å
 == NULL) {

194 
	`d›
("CªnÙ o³ÀcÚfig f%s: %s", 
cÚfig_fe
, 
	`¡»¼Ü
(
”ºo
));

198 ià(
å
 !ğ
NULL
) {

199 
	`årštf
(
¡d”r
, "Lßdšg cÚfig f%s\n", 
cÚfig_fe
);

202 
	`fg‘s
(
lše
, Öše), 
å
è!ğ
NULL
) {

204 
lše_no
++;

207 ià(
lše
[0] == '#' ||†ine[0] == '\n')

210 ià(
	`ssÿnf
(
lše
, "% %[^\r\n#]", 
İt
, 
v®
) != 2) {

211 
	`d›
("%s:†š%d i šv®id", 
cÚfig_fe
, (è
lše_no
);

213 
	`£t_İtiÚ
(
İtiÚs
, 
İt
, 
v®
);

216 (è
	`fşo£
(
å
);

220 
i
 = 1; 
¬gv
[i] !ğ
NULL
; i += 2) {

221 ià(
¬gv
[
i
][0] !ğ'-' ||‡rgv[˜+ 1] =ğ
NULL
) {

222 
	`show_u§ge_ªd_ex™
();

224 
	`£t_İtiÚ
(
İtiÚs
, &
¬gv
[
i
][1],‡rgv[i + 1]);

226 
	}
}

228 
	$š™_£rv”_Çme
() {

229 
	`¢´štf
(
£rv”_Çme
, (server_name), "Mongoose web server v.%s",

230 
	`mg_v”siÚ
());

231 
	}
}

233 
	$¡¬t_mÚgoo£
(
¬gc
, *
¬gv
[]) {

234 *
İtiÚs
[
MAX_OPTIONS
];

235 
i
;

238 ià(
¬gc
 > 1 && 
¬gv
[1][0] == '-' &&‡rgv[1][1] == 'A') {

239 ià(
¬gc
 != 6) {

240 
	`show_u§ge_ªd_ex™
();

242 
	`ex™
(
	`mg_ed™_·sswÜds
(
¬gv
[2],‡rgv[3],‡rgv[4],‡rgv[5]) ?

243 
EXIT_SUCCESS
 : 
EXIT_FAILURE
);

247 ià(
¬gc
 =ğ2 && (!
	`¡rcmp
(
¬gv
[1], "-h") || !strcmp(argv[1], "--help"))) {

248 
	`show_u§ge_ªd_ex™
();

252 
	`´oûss_commªd_lše_¬gum’ts
(
¬gv
, 
İtiÚs
);

255 
	`sigÇl
(
SIGTERM
, 
sigÇl_hªdËr
);

256 
	`sigÇl
(
SIGINT
, 
sigÇl_hªdËr
);

259 
ùx
 = 
	`mg_¡¬t
(
NULL
, NULL, (cÚ¡ **è
İtiÚs
);

260 
i
 = 0; 
İtiÚs
[i] !ğ
NULL
; i++) {

261 
	`ä“
(
İtiÚs
[
i
]);

264 ià(
ùx
 =ğ
NULL
) {

265 
	`d›
("%s", "Failedo start Mongoose. Maybe some options‡re "

269 
	}
}

271 #ifdeà
_WIN32


272 
SERVICE_STATUS
 
	gss
;

273 
SERVICE_STATUS_HANDLE
 
	ghStus
;

274 cÚ¡ *
	g£rviû_magic_¬gum’t
 = "--";

276 
WINAPI
 
	$CÚŒŞHªdËr
(
DWORD
 
code
) {

277 ià(
code
 =ğ
SERVICE_CONTROL_STOP
 || cod=ğ
SERVICE_CONTROL_SHUTDOWN
) {

278 
ss
.
dwWš32Ex™Code
 = 0;

279 
ss
.
dwCu¼’tS‹
 = 
SERVICE_STOPPED
;

281 
	`S‘S”viûStus
(
hStus
, &
ss
);

282 
	}
}

284 
WINAPI
 
	$S”viûMaš
() {

285 
ss
.
dwS”viûTy³
 = 
SERVICE_WIN32
;

286 
ss
.
dwCu¼’tS‹
 = 
SERVICE_RUNNING
;

287 
ss
.
dwCÚŒŞsAcû±ed
 = 
SERVICE_ACCEPT_STOP
 | 
SERVICE_ACCEPT_SHUTDOWN
;

289 
hStus
 = 
	`Regi¡”S”viûCŒlHªdËr
(
£rv”_Çme
, 
CÚŒŞHªdËr
);

290 
	`S‘S”viûStus
(
hStus
, &
ss
);

292 
ss
.
dwCu¼’tS‹
 =ğ
SERVICE_RUNNING
) {

293 
	`SË•
(1000);

295 
	`mg_¡İ
(
ùx
);

297 
ss
.
dwCu¼’tS‹
 = 
SERVICE_STOPPED
;

298 
ss
.
dwWš32Ex™Code
 = (
DWORD
) -1;

299 
	`S‘S”viûStus
(
hStus
, &
ss
);

300 
	}
}

302 
	#ID_TRAYICON
 100

	)

303 
	#ID_QUIT
 101

	)

304 
	#ID_EDIT_CONFIG
 102

	)

305 
	#ID_SEPARATOR
 103

	)

306 
	#ID_INSTALL_SERVICE
 104

	)

307 
	#ID_REMOVE_SERVICE
 105

	)

308 
	#ID_ICON
 200

	)

309 
NOTIFYICONDATA
 
	gT¿yIcÚ
;

311 
	$ed™_cÚfig_fe
() {

312 cÚ¡ **
Çmes
, *
v®ue
;

313 
FILE
 *
å
;

314 
i
;

315 
cmd
[200];

318 ià((
å
 = 
	`fİ’
(
cÚfig_fe
, "r")è!ğ
NULL
) {

319 
	`fşo£
(
å
);

320 } ià((
å
 = 
	`fİ’
(
cÚfig_fe
, "a+")è!ğ
NULL
) {

321 
	`årštf
(
å
,

326 
Çmes
 = 
	`mg_g‘_v®id_İtiÚ_Çmes
();

327 
i
 = 0; 
Çmes
[i] !ğ
NULL
; i += 3) {

328 
v®ue
 = 
	`mg_g‘_İtiÚ
(
ùx
, 
Çmes
[
i
]);

329 
	`årštf
(
å
, "# % %s\n", 
Çmes
[
i
 + 1], *
v®ue
 ? value : "<value>");

331 
	`fşo£
(
å
);

334 
	`¢´štf
(
cmd
, (cmd), "nÙ•ad.ex%s", 
cÚfig_fe
);

335 
	`WšExec
(
cmd
, 
SW_SHOW
);

336 
	}
}

338 
	$show_”rÜ
() {

339 
buf
[256];

340 
	`FÜm©Mes§ge
(
FORMAT_MESSAGE_FROM_SYSTEM
 | 
FORMAT_MESSAGE_IGNORE_INSERTS
,

341 
NULL
, 
	`G‘La¡E¼Ü
(),

342 
	`MAKELANGID
(
LANG_NEUTRAL
, 
SUBLANG_DEFAULT
),

343 
buf
, (buf), 
NULL
);

344 
	`Mes§geBox
(
NULL
, 
buf
, "E¼Ü", 
MB_OK
);

345 
	}
}

347 
	$mªage_£rviû
(
aùiÚ
) {

348 cÚ¡ *
£rviû_Çme
 = "Mongoose";

349 
SC_HANDLE
 
hSCM
 = 
NULL
, 
hS”viû
 = NULL;

350 
SERVICE_DESCRIPTION
 
desü
 = {
£rv”_Çme
};

351 
·th
[
PATH_MAX
 + 20];

352 
sucûss
 = 1;

354 ià((
hSCM
 = 
	`O³nSCMªag”
(
NULL
, NULL, 
aùiÚ
 =ğ
ID_INSTALL_SERVICE
 ?

355 
GENERIC_WRITE
 : 
GENERIC_READ
)è=ğ
NULL
) {

356 
sucûss
 = 0;

357 
	`show_”rÜ
();

358 } ià(
aùiÚ
 =ğ
ID_INSTALL_SERVICE
) {

359 
	`G‘ModuËFeName
(
NULL
, 
·th
, (path));

360 
	`¡ºÿt
(
·th
, " ", (path));

361 
	`¡ºÿt
(
·th
, 
£rviû_magic_¬gum’t
, (path));

362 
hS”viû
 = 
	`C»©eS”viû
(
hSCM
, 
£rviû_Çme
, service_name,

363 
SERVICE_ALL_ACCESS
, 
SERVICE_WIN32_OWN_PROCESS
,

364 
SERVICE_AUTO_START
, 
SERVICE_ERROR_NORMAL
,

365 
·th
, 
NULL
, NULL, NULL, NULL, NULL);

366 ià(
hS”viû
) {

367 
	`ChªgeS”viûCÚfig2
(
hS”viû
, 
SERVICE_CONFIG_DESCRIPTION
, &
desü
);

369 
	`show_”rÜ
();

371 } ià(
aùiÚ
 =ğ
ID_REMOVE_SERVICE
) {

372 ià((
hS”viû
 = 
	`O³nS”viû
(
hSCM
, 
£rviû_Çme
, 
DELETE
)è=ğ
NULL
 ||

373 !
	`D–‘eS”viû
(
hS”viû
)) {

374 
	`show_”rÜ
();

376 } ià((
hS”viû
 = 
	`O³nS”viû
(
hSCM
, 
£rviû_Çme
,

377 
SERVICE_QUERY_STATUS
)è=ğ
NULL
) {

378 
sucûss
 = 0;

381 
	`Clo£S”viûHªdË
(
hS”viû
);

382 
	`Clo£S”viûHªdË
(
hSCM
);

384  
sucûss
;

385 
	}
}

387 
LRESULT
 
CALLBACK
 
	$WšdowProc
(
HWND
 
hWnd
, 
UINT
 
msg
, 
WPARAM
 
wP¬am
,

388 
LPARAM
 
lP¬am
) {

389 
SERVICE_TABLE_ENTRY
 
£rviû_bË
[] = {

390 {
£rv”_Çme
, (
LPSERVICE_MAIN_FUNCTION
è
S”viûMaš
},

391 {
NULL
, NULL}

393 
£rviû_š¡®Ëd
;

394 
buf
[200], *
£rviû_¬gv
[] = {
__¬gv
[0], 
NULL
};

395 
POINT
 
±
;

396 
HMENU
 
hM’u
;

398 
msg
) {

399 
WM_CREATE
:

400 ià(
__¬gv
[1] !ğ
NULL
 &&

401 !
	`¡rcmp
(
__¬gv
[1], 
£rviû_magic_¬gum’t
)) {

402 
	`¡¬t_mÚgoo£
(1, 
£rviû_¬gv
);

403 
	`S¹S”viûCŒlDi¥©ch”
(
£rviû_bË
);

404 
	`ex™
(
EXIT_SUCCESS
);

406 
	`¡¬t_mÚgoo£
(
__¬gc
, 
__¬gv
);

409 
WM_COMMAND
:

410 
	`LOWORD
(
wP¬am
)) {

411 
ID_QUIT
:

412 
	`mg_¡İ
(
ùx
);

413 
	`Sh–l_NÙifyIcÚ
(
NIM_DELETE
, &
T¿yIcÚ
);

414 
	`Po¡Qu™Mes§ge
(0);

416 
ID_EDIT_CONFIG
:

417 
	`ed™_cÚfig_fe
();

419 
ID_INSTALL_SERVICE
:

420 
ID_REMOVE_SERVICE
:

421 
	`mªage_£rviû
(
	`LOWORD
(
wP¬am
));

425 
WM_USER
:

426 
lP¬am
) {

427 
WM_RBUTTONUP
:

428 
WM_LBUTTONUP
:

429 
WM_LBUTTONDBLCLK
:

430 
hM’u
 = 
	`C»©ePİupM’u
();

431 
	`Aµ’dM’u
(
hM’u
, 
MF_STRING
 | 
MF_GRAYED
, 
ID_SEPARATOR
, 
£rv”_Çme
);

432 
	`Aµ’dM’u
(
hM’u
, 
MF_SEPARATOR
, 
ID_SEPARATOR
, "");

433 
£rviû_š¡®Ëd
 = 
	`mªage_£rviû
(0);

434 
	`¢´štf
(
buf
, (buf), "NT service: %s installed",

435 
£rviû_š¡®Ëd
 ? "" : "not");

436 
	`Aµ’dM’u
(
hM’u
, 
MF_STRING
 | 
MF_GRAYED
, 
ID_SEPARATOR
, 
buf
);

437 
	`Aµ’dM’u
(
hM’u
, 
MF_STRING
 | (
£rviû_š¡®Ëd
 ? 
MF_GRAYED
 : 0),

438 
ID_INSTALL_SERVICE
, "Install");

439 
	`Aµ’dM’u
(
hM’u
, 
MF_STRING
 | (!
£rviû_š¡®Ëd
 ? 
MF_GRAYED
 : 0),

440 
ID_REMOVE_SERVICE
, "Deinstall");

441 
	`Aµ’dM’u
(
hM’u
, 
MF_SEPARATOR
, 
ID_SEPARATOR
, "");

442 
	`Aµ’dM’u
(
hM’u
, 
MF_STRING
, 
ID_EDIT_CONFIG
, "Edit config file");

443 
	`Aµ’dM’u
(
hM’u
, 
MF_STRING
, 
ID_QUIT
, "Exit");

444 
	`G‘CursÜPos
(&
±
);

445 
	`S‘FÜegroundWšdow
(
hWnd
);

446 
	`T¿ckPİupM’u
(
hM’u
, 0, 
±
.
x
,…t.
y
, 0, 
hWnd
, 
NULL
);

447 
	`Po¡Mes§ge
(
hWnd
, 
WM_NULL
, 0, 0);

448 
	`De¡royM’u
(
hM’u
);

454  
	`DefWšdowProc
(
hWnd
, 
msg
, 
wP¬am
, 
lP¬am
);

455 
	}
}

457 
WINAPI
 
	$WšMaš
(
HINSTANCE
 
hIn¡
, HINSTANCE 
hP»v
, 
LPSTR
 
cmdlše
, 
show
) {

458 
WNDCLASS
 
şs
;

459 
HWND
 
hWnd
;

460 
MSG
 
msg
;

462 
	`š™_£rv”_Çme
();

463 
	`mem£t
(&
şs
, 0, (cls));

464 
şs
.
ÍâWndProc
 = (
WNDPROC
è
WšdowProc
;

465 
şs
.
hIcÚ
 = 
	`LßdIcÚ
(
NULL
, 
IDI_APPLICATION
);

466 
şs
.
ÍszCÏssName
 = 
£rv”_Çme
;

468 
	`Regi¡”CÏss
(&
şs
);

469 
hWnd
 = 
	`C»©eWšdow
(
şs
.
ÍszCÏssName
, 
£rv”_Çme
, 
WS_OVERLAPPEDWINDOW
,

470 0, 0, 0, 0, 
NULL
, NULL, NULL, NULL);

471 
	`ShowWšdow
(
hWnd
, 
SW_HIDE
);

473 
T¿yIcÚ
.
cbSize
 = (TrayIcon);

474 
T¿yIcÚ
.
uID
 = 
ID_TRAYICON
;

475 
T¿yIcÚ
.
uFÏgs
 = 
NIF_ICON
 | 
NIF_MESSAGE
 | 
NIF_TIP
;

476 
T¿yIcÚ
.
hIcÚ
 = 
	`LßdImage
(
	`G‘ModuËHªdË
(
NULL
), 
	`MAKEINTRESOURCE
(
ID_ICON
),

477 
IMAGE_ICON
, 16, 16, 0);

478 
T¿yIcÚ
.
hWnd
 = hWnd;

479 
	`¢´štf
(
T¿yIcÚ
.
szT
, (T¿yIcÚ.szT), "%s", 
£rv”_Çme
);

480 
T¿yIcÚ
.
uC®lbackMes§ge
 = 
WM_USER
;

481 
	`Sh–l_NÙifyIcÚ
(
NIM_ADD
, &
T¿yIcÚ
);

483 
	`G‘Mes§ge
(&
msg
, 
hWnd
, 0, 0)) {

484 
	`T¿n¦©eMes§ge
(&
msg
);

485 
	`Di¥©chMes§ge
(&
msg
);

487 
	}
}

489 
	$maš
(
¬gc
, *
¬gv
[]) {

490 
	`š™_£rv”_Çme
();

491 
	`¡¬t_mÚgoo£
(
¬gc
, 
¬gv
);

492 
	`´štf
("%s started on…ort(s) %s with web„oot [%s]\n",

493 
£rv”_Çme
, 
	`mg_g‘_İtiÚ
(
ùx
, "listening_ports"),

494 
	`mg_g‘_İtiÚ
(
ùx
, "document_root"));

495 
ex™_æag
 == 0) {

496 
	`¦“p
(1);

498 
	`´štf
("Exiting on signal %d, waiting for‡llhreadso finish...",

499 
ex™_æag
);

500 
	`fæush
(
¡dout
);

501 
	`mg_¡İ
(
ùx
);

502 
	`´štf
("%s", " done.\n");

504  
EXIT_SUCCESS
;

505 
	}
}

	@src/external/vpiotr-mongoose-cpp/mongcpp.cpp

12 
	~"mÚgıp.h
"

14 
	~<s¡»am
>

15 
	~<c¡ršg
>

17 
usšg
 
Çme¥aû
 
	gmÚgoo£
;

19 
M‘hodM­Gu¬d
 
	gMÚgoo£S”v”
::
m_m‘hodM­
;

21 
	g‹m¶©e
 <
şass
 
	gT
>

22 
šlše
 
	g¡d
::
¡ršg
 
	$toSŒšg
 (cÚ¡ 
T
& 
t
)

24 
¡d
::
¡ršg¡»am
 
ss
;

25 
ss
 << 
t
;

26  
ss
.
	`¡r
();

27 
	}
}

29 
šlše
 
¡ršgToUIÁDef
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
, 
defV®
)

31 
usšg
 
Çme¥aû
 
	g¡d
;

32 
	g»s
;

33 
i¡ršg¡»am
 
cSŒ—m
(
¡r
);

34 ià(!(
	gcSŒ—m
 >> 
	g»s
)) {

35 
	g»s
 = 
defV®
;

37  
	g»s
;

40 
	gMÚgoo£CÚÃùiÚ
::
	$MÚgoo£CÚÃùiÚ
(
mg_cÚÃùiÚ
 *
cÚn
): 
	$m_cÚn
(
cÚn
)

42 
	}
}

44 
MÚgoo£CÚÃùiÚ
::~
	$MÚgoo£CÚÃùiÚ
()

46 
	}
}

48 
MÚgoo£CÚÃùiÚ
::
	$wr™e
(cÚ¡ *
buf
, 
size_t
 
Ën
)

50  
	`mg_wr™e
(
m_cÚn
, 
buf
, 
Ën
);

51 
	}
}

53 
	gMÚgoo£CÚÃùiÚ
::
wr™e
(cÚ¡ 
¡d
::
¡ršg
 &
‹xt
)

55  
wr™e
(
‹xt
.
c_¡r
(),ext.
Ëngth
());

58 
	gMÚgoo£CÚÃùiÚ
::
	$»ad
(*
buf
, 
size_t
 
Ën
)

60  
	`mg_»ad
(
m_cÚn
, 
buf
, 
Ën
);

61 
	}
}

63 
	gMÚgoo£CÚÃùiÚ
::
£ndAuthÜiz©iÚReque¡
(cÚ¡ 
¡d
::
¡ršg
 &
nÚû
)

65 ià(
nÚû
.
em±y
())

66 
mg_£nd_authÜiz©iÚ_»que¡
(
m_cÚn
, 
NULL
);

68 
mg_£nd_authÜiz©iÚ_»que¡
(
m_cÚn
, 
nÚû
.
c_¡r
());

71 
boŞ
 
	gMÚgoo£CÚÃùiÚ
::
g‘H—d”
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, std::¡ršg &
ouut
) const

73 cÚ¡ *
v®ue
 = 
mg_g‘_h—d”
(
m_cÚn
, 
Çme
.
c_¡r
());

74 ià(
	gv®ue
 !ğ
NULL
)

76 
ouut
 = 
¡d
::
¡ršg
(
v®ue
);

77  
	gŒue
;

79 
	gouut
 = "";

80  
	gçl£
;

84 
boŞ
 
	gMÚgoo£CÚÃùiÚ
::
g‘Cook›
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, std::¡ršg &
ouut
) const

86 cÚ¡ 
BUF_LEN
 = 4096;

87 
	gbufãr
[
BUF_LEN
];

89 
	g»adCÁ
 = 
mg_g‘_cook›
(
m_cÚn
, 
Çme
.
c_¡r
(), 
bufãr
, 
BUF_LEN
 - 1);

91 ià(
	g»adCÁ
 >= 0) {

92 
bufãr
[
BUF_LEN
 - 1] = '\0';

93 
	gouut
 = 
bufãr
;

94  
	gŒue
;

96 
	gouut
 = "";

97  
	gçl£
;

101 
mg_cÚÃùiÚ
 *
	gMÚgoo£CÚÃùiÚ
::
	$g‘Info
()

103  
m_cÚn
;

104 
	}
}

107 
	gMÚgoo£Reque¡
::
	$MÚgoo£Reque¡
(
mg_cÚÃùiÚ
 *
cÚn
, 
mg_»que¡_šfo
* 
šfo
):

108 
	`m_cÚn
(
cÚn
), 
	$m_šfo
(
šfo
)

110 
	}
}

112 
	gMÚgoo£Reque¡
::~
	$MÚgoo£Reque¡
()

114 
	}
}

116 cÚ¡ 
¡d
::
¡ršg
 
MÚgoo£Reque¡
::
	$g‘Reque¡M‘hod
() const

118  
¡d
::
	`¡ršg
(
m_šfo
->
»que¡_m‘hod
);

119 
	}
}

121 
MÚgoo£Reque¡M‘hodCode
 
	gMÚgoo£Reque¡
::
	$g‘Reque¡M‘hodCode
() const

124  
MÚgoo£S”v”
::
	`m‘hodTextToCode
(
	`g‘Reque¡M‘hod
());

125 
	}
}

127 cÚ¡ 
	g¡d
::
¡ršg
 
MÚgoo£Reque¡
::
	$g‘Uri
() const

129  
¡d
::
	`¡ršg
(
m_šfo
->
uri
);

130 
	}
}

132 cÚ¡ 
	g¡d
::
¡ršg
 
MÚgoo£Reque¡
::
	$g‘H‰pV”siÚ
() const

134  
¡d
::
	`¡ršg
(
m_šfo
->
h‰p_v”siÚ
);

135 
	}
}

138 cÚ¡ 
	g¡d
::
¡ršg
 
MÚgoo£Reque¡
::
	$g‘Qu”ySŒšg
() const

140 ià(
m_šfo
->
qu”y_¡ršg
 !ğ
NULL
)

141  
¡d
::
	`¡ršg
(
m_šfo
->
qu”y_¡ršg
);

144 
	}
}

147 cÚ¡ 
	g¡d
::
¡ršg
 
MÚgoo£Reque¡
::
	$»adQu”ySŒšg
() const

149 cÚ¡ *
ş
 = 
	`mg_g‘_h—d”
(
m_cÚn
, "Content-Length");

150 
size_t
 
buf_Ën
;

151 ià(
ş
 !ğ
NULL
)

152 
buf_Ën
 = 
	`¡ršgToUIÁDef
(
¡d
::
	`¡ršg
(
ş
), 0);

154 
buf_Ën
 = 0;

156 
¡d
::
¡ršg
 
»s
;

158 ià(
buf_Ën
 > 0)

160 *
buf
 = 
Ãw
 [
buf_Ën
+1];

164 ià(
buf_Ën
 > 2) {

165 
	`mg_»ad
(
m_cÚn
, 
buf
, 2);

166 
	`mg_»ad
(
m_cÚn
, 
buf
 + 2, 
buf_Ën
 - 2);

168 
	`mg_»ad
(
m_cÚn
, 
buf
, 
buf_Ën
);

171 
buf
[
buf_Ën
] = '\0';

172 
»s
 = 
¡d
::
	`¡ršg
(
buf
);

173 
d–‘e
[] 
buf
;

176  
»s
;

177 
	}
}

179 cÚ¡ 
	g¡d
::
¡ršg
 
MÚgoo£Reque¡
::
	$g‘RemÙeU£r
() const

181  
¡d
::
	`¡ršg
(
m_šfo
->
»mÙe_u£r
);

182 
	}
}

184 cÚ¡ 
	g¡d
::
¡ršg
 
MÚgoo£Reque¡
::
	$g‘LogMes§ge
() const

186  
¡d
::
	`¡ršg
(
m_šfo
->
log_mes§ge
);

187 
	}
}

189 
	gMÚgoo£Reque¡
::
	$g‘RemÙeIp
() const

191  
m_šfo
->
»mÙe_
;

192 
	}
}

194 
	gMÚgoo£Reque¡
::
	$g‘RemÙePÜt
() const

196  
m_šfo
->
»mÙe_pÜt
;

197 
	}
}

199 
	gMÚgoo£Reque¡
::
	$g‘StusCode
() const

201  
m_šfo
->
¡©us_code
;

202 
	}
}

204 
boŞ
 
	gMÚgoo£Reque¡
::
	$isS¦
() const

206  (
m_šfo
->
is_s¦
 > 0);

207 
	}
}

209 
mg_»que¡_šfo
* 
	gMÚgoo£Reque¡
::
	$g‘Info
() const

211  
m_šfo
;

212 
	}
}

214 
boŞ
 
	gMÚgoo£Reque¡
::
g‘V¬
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, std::¡ršg &
ouut
) const

216 cÚ¡ 
MAX_VAR_LEN
 = 4096;

217 
	gbufãr
[
MAX_VAR_LEN
];

218 cÚ¡ *
	gqs
 = 
m_šfo
->
qu”y_¡ršg
;

219 
	g»adCÁ
 = 
mg_g‘_v¬
(
qs
, 
¡¾’
(q =ğ
NULL
 ? "" : qs), 
Çme
.
c_¡r
(), 
bufãr
, 
MAX_VAR_LEN
 - 1);

220 ià(
	g»adCÁ
 >= 0) {

221 
bufãr
[
MAX_VAR_LEN
 - 1] = '\0';

222 
	gouut
 = 
bufãr
;

223  
	gŒue
;

225 
	gouut
.
ş—r
();

226  
	gçl£
;

231 
	gMÚgoo£Re¥Ú£
::
	$MÚgoo£Re¥Ú£
(
mg_cÚÃùiÚ
 *
cÚn
): 
	$m_cÚn
(
cÚn
)

233 
	}
}

235 
MÚgoo£Re¥Ú£
::~
	$MÚgoo£Re¥Ú£
()

237 
	}
}

239 
MÚgoo£Re¥Ú£
::
	$wr™e
()

241 
	`mg_wr™e
(
m_cÚn
, 
m_‹xt
.
	`c_¡r
(), m_‹xt.
	`Ëngth
());

242 
m_‹xt
.
	`ş—r
();

243 
	}
}

245 cÚ¡ *
	gMÚgoo£Re¥Ú£
::
	$g‘H‰pStusDesc
(
¡©usCode
)

247 cÚ¡ *
»s
;

249 
¡©usCode
) {

250 100: 
»s
 = "Continue";

252 101: 
»s
 = "Switching Protocols";

255 200: 
»s
 = "OK";

257 201: 
»s
 = "Created";

259 202: 
»s
 = "Accepted";

261 203: 
»s
 = "Non-Authoritative Information";

263 204: 
»s
 = "No Content";

265 205: 
»s
 = "Reset Content";

267 206: 
»s
 = "Partial Content";

270 300: 
»s
 = "Multiple Choices";

272 301: 
»s
 = "Moved Permanently";

274 302: 
»s
 = "Found";

276 303: 
»s
 = "See Other";

278 304: 
»s
 = "Not Modified";

280 305: 
»s
 = "Use Proxy";

282 306: 
»s
 = "Switch Proxy";

284 307: 
»s
 = "Temporary Redirect";

287 400: 
»s
 = "Bad Request";

289 401: 
»s
 = "Unauthorized";

291 402: 
»s
 = "Payment Required";

293 403: 
»s
 = "Forbidden";

295 404: 
»s
 = "Not Found";

297 405: 
»s
 = "Method Not Allowed";

299 406: 
»s
 = "Not Acceptable";

301 407: 
»s
 = "Proxy Authentication Required";

303 408: 
»s
 = "Request Timeout";

305 409: 
»s
 = "Conflict";

307 410: 
»s
 = "Gone";

309 411: 
»s
 = "Length Required";

311 412: 
»s
 = "Precondition Failed";

313 413: 
»s
 = "Request Entity Too Large";

315 414: 
»s
 = "Request-URI Too Long";

317 415: 
»s
 = "Unsupported Media Type";

319 416: 
»s
 = "Requested Range Not Satisfiable";

321 417: 
»s
 = "Expectation Failed";

324 500: 
»s
 = "Internal Server Error";

326 501: 
»s
 = "Not Implemented";

328 502: 
»s
 = "Bad Gateway";

330 503: 
»s
 = "Service Unavailable";

332 504: 
»s
 = "Gateway Timeout";

334 505: 
»s
 = "HTTP Version Not Supported";

337 
»s
 = "";

340  
»s
;

341 
	}
}

343 
	gMÚgoo£Re¥Ú£
::
£tStus
(
code
, cÚ¡ 
¡d
::
¡ršg
 &
¡©usDesc
, cÚ¡ std::¡ršg &
h‰pV”
)

345 cÚ¡ *
»®StusDesc
 = 
NULL
;

346 cÚ¡ *
	g»®H‰pV”
 = 
NULL
;

348 ià(!
	gh‰pV”
.
em±y
()) {

349 
	g»®H‰pV”
 = 
h‰pV”
.
c_¡r
();

352 
	g»®H‰pV”
 = "HTTP/1.1";

355 ià(!
	g¡©usDesc
.
em±y
()) {

356 
	g»®StusDesc
 = 
¡©usDesc
.
c_¡r
();

358 
	g»®StusDesc
 = 
MÚgoo£Re¥Ú£
::
g‘H‰pStusDesc
(
code
);

361 
	g¡d
::
¡ršg
 
ouut
 = 
¡d
::¡ršg(
»®H‰pV”
è+ " " + 
toSŒšg
(
code
è+ " " + std::¡ršg(
»®StusDesc
);

362 
	gm_¡©usText
.
»£t
(
Ãw
 
¡d
::
¡ršg
(
ouut
));

365 
	gMÚgoo£Re¥Ú£
::
£tS‘Cook›
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ std::¡ršg &
v®ue
)

367 
£tH—d”V®ue
("S‘-Cook›", 
Çme
+"="+
v®ue
);

370 
	gMÚgoo£Re¥Ú£
::
£tLoÿtiÚ
(cÚ¡ 
¡d
::
¡ršg
 &
v®ue
)

372 
£tH—d”V®ue
("LoÿtiÚ", 
v®ue
);

375 
	gMÚgoo£Re¥Ú£
::
£tCÚ‹ÁTy³
(cÚ¡ 
¡d
::
¡ršg
 &
v®ue
)

377 ià(
v®ue
.
em±y
())

378 
£tH—d”V®ue
("Content-type", "text/html");

380 
£tH—d”V®ue
("CÚ‹Á-ty³", 
v®ue
);

383 
boŞ
 
	gMÚgoo£Re¥Ú£
::
g‘H—d”V®ue
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, std::¡ršg &
ouut
)

385 
´•¬eH—d”V®ues
();

387 
	gRe¥Ú£V®ueIndex
::
cÚ¡_™”©Ü
 
c™
 = 
m_h—d”V®uesIndex
->
fšd
(
Çme
);

388 
boŞ
 
	g»s
 = 
çl£
;

390 ià(
	gc™
 !ğ
m_h—d”V®uesIndex
->
’d
()) {

391 
idx
 = 
c™
->
£cÚd
;

392 
	gouut
 = (*
m_h—d”V®ues
)[
idx
].
£cÚd
;

393 
	g»s
 = 
Œue
;

395 
	gouut
.
ş—r
();

398  
	g»s
;

402 
	gMÚgoo£Re¥Ú£
::
addH—d”V®ue
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ std::¡ršg &
v®ue
)

404 
´•¬eH—d”V®ues
();

406 
	gidx
 = 
m_h—d”V®ues
->
size
();

408 
	gRe¥Ú£V®ueIndex
::
™”©Ü
 
c™
 = 
m_h—d”V®uesIndex
->
fšd
(
Çme
);

409 ià(
	gc™
 !ğ
m_h—d”V®uesIndex
->
’d
()) {

410 
c™
->
£cÚd
 = 
idx
;

412 
	gm_h—d”V®uesIndex
->
š£¹
(
¡d
::
make_·œ
<¡d::
¡ršg
, >(
Çme
, 
idx
));

415 
	gm_h—d”V®ues
->
push_back
(
¡d
::
make_·œ
<¡d::
¡ršg
, std::¡ršg>(
Çme
, 
v®ue
));

418 
	gMÚgoo£Re¥Ú£
::
£tH—d”V®ue
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ std::¡ršg &
v®ue
)

420 
´•¬eH—d”V®ues
();

421 
	gRe¥Ú£V®ueIndex
::
cÚ¡_™”©Ü
 
c™
 = 
m_h—d”V®uesIndex
->
fšd
(
Çme
);

422 ià(
	gc™
 !ğ
m_h—d”V®uesIndex
->
’d
()) {

423 
idx
 = 
c™
->
£cÚd
;

424 (*
	gm_h—d”V®ues
)[
idx
].
	g£cÚd
 = 
v®ue
;

426 
	gidx
 = 
m_h—d”V®ues
->
size
();

427 
	gm_h—d”V®uesIndex
->
š£¹
(
¡d
::
make_·œ
<¡d::
¡ršg
, >(
Çme
, 
idx
));

428 
	gm_h—d”V®ues
->
push_back
(
¡d
::
make_·œ
<¡d::
¡ršg
, std::¡ršg>(
Çme
, 
v®ue
));

432 
	gMÚgoo£Re¥Ú£
::
addCÚ‹Á
(cÚ¡ 
¡d
::
¡ršg
 &
‹xt
, 
boŞ
 
addL’
)

434 ià(
	gaddL’
) {

435 
£tH—d”V®ue
("CÚ‹Á-Ëngth", 
toSŒšg
(
‹xt
.
Ëngth
()));

436 
addH—d”
();

437 
addTextLše
("");

438 
addText
(
‹xt
);

440 
addH—d”
();

441 
addText
(
‹xt
);

445 
	gMÚgoo£Re¥Ú£
::
	$£tCÚÃùiÚAlive
(
boŞ
 
k“pAlive
)

447 ià(
k“pAlive
)

448 
	`£tH—d”V®ue
("Connection", "Keep-Alive");

450 
	`£tH—d”V®ue
("Connection", "close");

451 
	}
}

453 
	gMÚgoo£Re¥Ú£
::
	$£tCacheDi§bËd
()

455 
	`£tH—d”V®ue
("Cache-Control", "no-cache, must-revalidate");

456 
	`£tH—d”V®ue
("Expires", "Sat, 26 Jul 1997 05:00:00 GMT");

457 
	}
}

459 
	gMÚgoo£Re¥Ú£
::
	$addH—d”
()

461 ià(
m_¡©usText
.
	`g‘
(è!ğ
NULL
) {

462 
	`addTextLše
(*
m_¡©usText
);

463 
m_¡©usText
.
	`»£t
();

466 ià(
m_h—d”V®ues
.
	`g‘
(è!ğ
NULL
) {

467 
Re¥Ú£V®ueLi¡
::
cÚ¡_™”©Ü
 
c™
 = 
m_h—d”V®ues
->
	`begš
(), 
•os
 = m_h—d”V®ues->
	`’d
(); cit !=ƒpos; ++cit)

469 
	`addH—d”V®ueToText
(
c™
->
fœ¡
, c™->
£cÚd
);

473 
m_h—d”V®ues
.
	`»£t
();

474 
m_h—d”V®uesIndex
.
	`»£t
();

475 
	}
}

477 
	gMÚgoo£Re¥Ú£
::
addH—d”V®ueToText
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ std::¡ršg &
v®ue
)

479 
addTextLše
(
Çme
 + 
¡d
::
¡ršg
(": "è+ 
v®ue
);

482 
	gMÚgoo£Re¥Ú£
::
addText
(cÚ¡ 
¡d
::
¡ršg
 &
‹xt
)

484 
m_‹xt
 +ğ
‹xt
;

487 
	gMÚgoo£Re¥Ú£
::
addTextLše
(cÚ¡ 
¡d
::
¡ršg
 &
‹xt
)

489 
addText
(
‹xt
+
¡d
::
¡ršg
("\r\n"));

492 
Re¥Ú£V®ueLi¡
 *
	gMÚgoo£Re¥Ú£
::
	$´•¬eH—d”V®ues
()

494 ià(
m_h—d”V®ues
.
	`g‘
(è=ğ
NULL
) {

495 
m_h—d”V®ues
.
	`»£t
(
Ãw
 
Re¥Ú£V®ueLi¡
);

496 
m_h—d”V®uesIndex
.
	`»£t
(
Ãw
 
Re¥Ú£V®ueIndex
);

499  
m_h—d”V®ues
.
	`g‘
();

500 
	}
}

503 *
	$LoÿlMÚgoo£Ev’tHªdËr
(
mg_ev’t
 
ev’tCode
,

504 
mg_cÚÃùiÚ
 *
cÚn
,

505 cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
)

507 
MÚgoo£S”v”
* 
£rv”
 = (MÚgoo£S”v”* )
	`mg_»ad_u£r_d©a
(
cÚn
);

508  
£rv”
->
	`hªdËEv’t
(
ev’tCode
, 
cÚn
, 
»que¡_šfo
);

509 
	}
}

512 
	gMÚgoo£S”v”
::
	$MÚgoo£S”v”
(): 
	`m_¡©usRuÂšg
(
çl£
), 
	`m_´•¬ed
(çl£), 
	$m_ùx
(
NULL
)

514 
	}
}

516 
	gMÚgoo£S”v”
::~
	$MÚgoo£S”v”
()

518 
	`checkStİ³d
();

519 
	}
}

522 
	gMÚgoo£S”v”
::
	$£tO±iÚs
(cÚ¡ 
S”v”O±iÚS‘
 &
İtiÚs
)

524 
m_İtiÚs
 = 
İtiÚs
;

525 
	}
}

527 
	gMÚgoo£S”v”
::
£tO±iÚ
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ std::¡ršg &
v®ue
)

529 
m_İtiÚs
[
Çme
] = 
v®ue
;

532 
	gMÚgoo£S”v”
::
	$g‘O±iÚs
(
S”v”O±iÚS‘
 &
İtiÚs
) const

534 
İtiÚs
 = 
m_İtiÚs
;

535 
	}
}

537 
boŞ
 
	gMÚgoo£S”v”
::
g‘O±iÚV®ue
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, std::¡ršg &
v®ue
) const

539 
S”v”O±iÚS‘
::
cÚ¡_™”©Ü
 
c™”
 = 
m_İtiÚs
.
fšd
(
Çme
);

540 ià(
	gc™”
 !ğ
m_İtiÚs
.
’d
()) {

541 
v®ue
 = 
c™”
->
£cÚd
;

542  
	gŒue
;

544 
	gv®ue
 = "";

545  
	gçl£
;

549 
	gMÚgoo£S”v”
::
g‘O±iÚV®ue
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, std::¡ršg &
v®ue
, cÚ¡ std::¡ršg &
defV®ue
) const

551 
boŞ
 
found
 = 
g‘O±iÚV®ue
(
Çme
, 
v®ue
);

552 ià(!
	gfound
) {

553 
	gv®ue
 = 
defV®ue
;

557 
	gMÚgoo£S”v”
::
	$g‘V®idO±iÚs
(
S”v”O±iÚLi¡
 &
ouut
)

559 cÚ¡ **
Çmes
;

560 cÚ¡ 
SEP_CHAR
 = ';';

562 
Çmes
 = 
	`mg_g‘_v®id_İtiÚ_Çmes
();

564 
i
 = 0; 
Çmes
[i] !ğ
NULL
; i += 3) {

565 
ouut
.
	`push_back
(

566 
¡d
::
	`¡ršg
(
Çmes
[
i
]è+ 
SEP_CHAR
 +

567 
¡d
::
	`¡ršg
(
Çmes
[
i
] + 1è+ 
SEP_CHAR
 +

568 
¡d
::
	`¡ršg
(
Çmes
[
i
 + 2] =ğ
NULL
 ? "" :‚ames[i + 2])

571 
	}
}

573 
	g¡d
::
¡ršg
 
MÚgoo£S”v”
::
	$g‘V”siÚ
()

575  
¡d
::
	`¡ršg
(
	`mg_v”siÚ
());

576 
	}
}

578 
	gMÚgoo£S”v”
::
ÿlcMD5
(cÚ¡ 
¡d
::
¡ršg
 &
‹xt
, std::¡ršg &
ouut
)

580 
buf
[33];

581 
mg_md5
(
buf
, 
‹xt
.
c_¡r
());

582 
	gouut
 = 
buf
;

586 
	gMÚgoo£S”v”
::
	$š™
()

588 
	`checkM‘hodM­
();

589 
	}
}

591 
	gMÚgoo£S”v”
::
	$¡¬t
()

593 ià(!
m_´•¬ed
) {

594 
	`š™
();

595 
m_´•¬ed
 = 
Œue
;

598 
	`checkStİ³d
();

600 
m_ùx
 = 
	`mg_¡¬t
(
LoÿlMÚgoo£Ev’tHªdËr
, (*è
this
, 
	`´•¬eO±iÚs
());

601 
m_¡©usRuÂšg
 = 
Œue
;

602 
	}
}

604 
	gMÚgoo£S”v”
::
	$¡İ
()

606 ià(!
	`isRuÂšg
())

608 
	`mg_¡İ
(
m_ùx
);

609 
	`uÅ»·»O±iÚs
();

610 
m_ùx
 = 
NULL
;

611 
m_¡©usRuÂšg
 = 
çl£
;

612 
	}
}

614 
boŞ
 
	gMÚgoo£S”v”
::
	$isRuÂšg
()

616  
m_¡©usRuÂšg
;

617 
	}
}

620 #´agm¨
w¬nšg
Ğ
di§bË
 : 4716 )

621 #´agm¨
w¬nšg
Ğ
di§bË
 : 4100 )

622 
boŞ
 
	gMÚgoo£S”v”
::
	$hªdËEv’t
(
S”v”HªdlšgEv’t
 
ev’tCode
, 
MÚgoo£CÚÃùiÚ
 &
cÚÃùiÚ
, cÚ¡ 
MÚgoo£Reque¡
 &
»que¡
, 
MÚgoo£Re¥Ú£
 &
»¥Ú£
)

624  
NULL
;

625 
	}
}

627 *
	gMÚgoo£S”v”
::
	$hªdËEv’t
(
S”v”HªdlšgEv’t
 
ev’tCode
,

628 
mg_cÚÃùiÚ
 *
cÚn
,

629 cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
)

631 *
´oûs£d
 = 
»š‹½»t_ÿ¡
<*> (
cÚ¡_ÿ¡
<*>("yes"));

632 
¡d
::
auto_±r
<
MÚgoo£CÚÃùiÚ
> 
	`cÚÃùiÚ
(
	`ÃwCÚÃùiÚ
(
cÚn
));

633 
¡d
::
auto_±r
<
MÚgoo£Reque¡
> 
	`»que¡
(
	`ÃwReque¡
(
cÚn
, 
»que¡_šfo
));

634 
¡d
::
auto_±r
<
MÚgoo£Re¥Ú£
> 
	`»¥Ú£
(
	`ÃwRe¥Ú£
(
cÚn
));

636 ià(
	`hªdËEv’t
(
ev’tCode
, *
cÚÃùiÚ
, *
»que¡
, *
»¥Ú£
))

637  
´oûs£d
;

639  
NULL
;

640 
	}
}

642 
MÚgoo£CÚÃùiÚ
 *
	gMÚgoo£S”v”
::
	$ÃwCÚÃùiÚ
(
mg_cÚÃùiÚ
 *
cÚn
)

644  
Ãw
 
	`MÚgoo£CÚÃùiÚ
(
cÚn
);

645 
	}
}

647 
MÚgoo£Reque¡
 *
	gMÚgoo£S”v”
::
	$ÃwReque¡
(
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ 
mg_»que¡_šfo
 *
»que¡
)

649  
Ãw
 
	`MÚgoo£Reque¡
(
cÚn
, 
cÚ¡_ÿ¡
<
mg_»que¡_šfo
 *>(
»que¡
));

650 
	}
}

652 
MÚgoo£Re¥Ú£
 *
	gMÚgoo£S”v”
::
	$ÃwRe¥Ú£
(
mg_cÚÃùiÚ
 *
cÚn
)

654  
Ãw
 
	`MÚgoo£Re¥Ú£
(
cÚn
);

655 
	}
}

657 
	gMÚgoo£S”v”
::
	$checkStİ³d
()

659 ià(
m_¡©usRuÂšg
)

660 
	`¡İ
();

661 
	}
}

663 cÚ¡ **
	gMÚgoo£S”v”
::
	$´•¬eO±iÚs
()

665 
	`uÅ»·»O±iÚs
();

666 
S”v”O±iÚS‘
::
cÚ¡_™”©Ü
 
c™
 = 
m_İtiÚs
.
	`begš
(), 
•os
 = m_İtiÚs.
	`’d
(); cit !=ƒpos; ++cit)

668 
m_İtiÚStÜage
.
	`push_back
(
c™
->
fœ¡
.
	`c_¡r
());

669 
m_İtiÚStÜage
.
	`push_back
(
c™
->
£cÚd
.
	`c_¡r
());

671 
m_İtiÚStÜage
.
	`push_back
(
NULL
);

672  &(*
m_İtiÚStÜage
.
	`begš
());

673 
	}
}

675 
	gMÚgoo£S”v”
::
	$uÅ»·»O±iÚs
()

677 
m_İtiÚStÜage
.
	`ş—r
();

678 
	}
}

680 
	gMÚgoo£S”v”
::
	$checkM‘hodM­
()

682 ià(
m_m‘hodM­
.
	`g‘
(è=ğ
NULL
)

684 
m_m‘hodM­
.
	`»£t
(
Ãw
 
M‘hodM­
);

686 
m_m‘hodM­
->
	`š£¹
(
¡d
::
	`make_·œ
("GET", 
rmcG‘
));

687 
m_m‘hodM­
->
	`š£¹
(
¡d
::
	`make_·œ
("POST", 
rmcPo¡
));

688 
m_m‘hodM­
->
	`š£¹
(
¡d
::
	`make_·œ
("HEAD", 
rmcH—d
));

689 
m_m‘hodM­
->
	`š£¹
(
¡d
::
	`make_·œ
("PUT", 
rmcPut
));

690 
m_m‘hodM­
->
	`š£¹
(
¡d
::
	`make_·œ
("DELETE", 
rmcD–‘e
));

691 
m_m‘hodM­
->
	`š£¹
(
¡d
::
	`make_·œ
("TRACE", 
rmcT¿û
));

692 
m_m‘hodM­
->
	`š£¹
(
¡d
::
	`make_·œ
("OPTIONS", 
rmcO±iÚs
));

694 
	}
}

696 
MÚgoo£Reque¡M‘hodCode
 
	gMÚgoo£S”v”
::
m‘hodTextToCode
(cÚ¡ 
¡d
::
¡ršg
 &
‹xt
)

698 
M‘hodM­
::
cÚ¡_™”©Ü
 
c™
 = 
m_m‘hodM­
->
fšd
(
‹xt
);

699 ià(
	gc™
 =ğ
m_m‘hodM­
->
’d
())

700  
rmcUndef
;

702  
	gc™
->
	g£cÚd
;

	@src/external/vpiotr-mongoose-cpp/mongcpp.h

12 #iâdeà
_MONGCPP_H__


13 
	#_MONGCPP_H__


	)

25 
	~<c¡ddef
>

26 
	~<c¡dlib
>

28 
	~"mÚgoo£.h
"

30 
	~<¡ršg
>

31 
	~<m­
>

32 
	~<veùÜ
>

33 
	~<memÜy
>

35 
Çme¥aû
 
	gmÚgoo£


41 
	eMÚgoo£Reque¡M‘hodCode
 {

42 
	grmcUndef
,

43 
	grmcG‘
,

44 
	grmcPo¡
,

45 
	grmcH—d
,

46 
	grmcPut
,

47 
	grmcD–‘e
,

48 
	grmcT¿û
,

49 
	grmcO±iÚs


52 
	g¡d
::
	tm­
<
	t¡d
::
	t¡ršg
, std::¡ršg> 
	tS”v”O±iÚS‘
;

53 
	g¡d
::
	tveùÜ
<
	t¡d
::
	t¡ršg
> 
	tS”v”O±iÚLi¡
;

54 
	g¡d
::
	tveùÜ
<cÚ¡ *> 
	tS”v”O±iÚStÜage
;

55 
	g¡d
::
	tm­
<
	t¡d
::
	t¡ršg
, std::¡ršg> 
	tReque¡V®ueS‘
;

56 
	g¡d
::
	tm­
<
	t¡d
::
	t¡ršg
, > 
	tRe¥Ú£V®ueIndex
;

57 
	g¡d
::
	tveùÜ
< 
	t¡d
::
	t·œ
<¡d::
	t¡ršg
, std::¡ršg> > 
	tRe¥Ú£V®ueLi¡
;

58 
mg_ev’t
 
	tS”v”HªdlšgEv’t
;

59 
	g¡d
::
	tm­
<
	t¡d
::
	t¡ršg
, 
	tMÚgoo£Reque¡M‘hodCode
> 
	tM‘hodM­
;

60 
	g¡d
::
	tauto_±r
<
	tM‘hodM­
> 
	tM‘hodM­Gu¬d
;

74 şas 
	cMÚgoo£CÚÃùiÚ
 {

75 
	gpublic
:

76 
MÚgoo£CÚÃùiÚ
(
mg_cÚÃùiÚ
 *
cÚn
);

77 
	gvœtu®
 ~
MÚgoo£CÚÃùiÚ
();

78 
wr™e
(cÚ¡ *
buf
, 
size_t
 
Ën
);

79 
wr™e
(cÚ¡ 
¡d
::
¡ršg
 &
‹xt
);

80 
»ad
(*
buf
, 
size_t
 
Ën
);

81 
£ndAuthÜiz©iÚReque¡
(cÚ¡ 
¡d
::
¡ršg
 &
nÚû
 = "");

82 
boŞ
 
g‘H—d”
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, std::¡ršg &
ouut
) const;

83 
boŞ
 
g‘Cook›
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, std::¡ršg &
ouut
) const;

84 
	g´Ùeùed
:

85 
mg_cÚÃùiÚ
 *
g‘Info
();

86 
	g´Ùeùed
:

87 
mg_cÚÃùiÚ
 *
m_cÚn
;

90 şas 
	cMÚgoo£Reque¡
 {

91 
	gpublic
:

92 
MÚgoo£Reque¡
(
mg_cÚÃùiÚ
 *
cÚn
, 
mg_»que¡_šfo
* 
šfo
);

93 
	gvœtu®
 ~
MÚgoo£Reque¡
();

94 cÚ¡ 
	g¡d
::
¡ršg
 
g‘Reque¡M‘hod
() const;

95 
MÚgoo£Reque¡M‘hodCode
 
g‘Reque¡M‘hodCode
() const;

96 cÚ¡ 
	g¡d
::
¡ršg
 
g‘Uri
() const;

97 cÚ¡ 
	g¡d
::
¡ršg
 
g‘H‰pV”siÚ
() const;

98 cÚ¡ 
	g¡d
::
¡ršg
 
g‘Qu”ySŒšg
() const;

99 cÚ¡ 
	g¡d
::
¡ršg
 
»adQu”ySŒšg
() const;

100 cÚ¡ 
	g¡d
::
¡ršg
 
g‘RemÙeU£r
() const;

101 cÚ¡ 
	g¡d
::
¡ršg
 
g‘LogMes§ge
() const;

102 
g‘RemÙeIp
() const;

103 
g‘RemÙePÜt
() const;

104 
g‘StusCode
() const;

105 
boŞ
 
isS¦
() const;

106 
boŞ
 
g‘V¬
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, std::¡ršg &
ouut
) const;

107 
MÚgoo£Reque¡M‘hodCode
 
m‘hodTextToCode
(cÚ¡ 
¡d
::
¡ršg
 &
‹xt
);

108 
	g´Ùeùed
:

109 
mg_»que¡_šfo
* 
g‘Info
() const;

110 
	g´Ùeùed
:

111 
mg_»que¡_šfo
* 
m_šfo
;

112 
mg_cÚÃùiÚ
 *
	gm_cÚn
;

115 şas 
	cMÚgoo£Re¥Ú£
 {

116 
	gpublic
:

117 
MÚgoo£Re¥Ú£
(
mg_cÚÃùiÚ
 *
cÚn
);

118 
	gvœtu®
 ~
MÚgoo£Re¥Ú£
();

119 
vœtu®
 
wr™e
();

120 
£tStus
(
code
, cÚ¡ 
¡d
::
¡ršg
 &
¡©usDesc
 = "", cÚ¡ std::¡ršg &
h‰pV”
 = "");

121 
£tS‘Cook›
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ std::¡ršg &
v®ue
);

122 
£tLoÿtiÚ
(cÚ¡ 
¡d
::
¡ršg
 &
v®ue
 = "");

123 
£tCÚ‹ÁTy³
(cÚ¡ 
¡d
::
¡ršg
 &
v®ue
 = "");

124 
boŞ
 
g‘H—d”V®ue
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, std::¡ršg &
ouut
);

125 
addH—d”V®ue
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ std::¡ršg &
v®ue
);

126 
£tH—d”V®ue
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ std::¡ršg &
v®ue
);

127 
£tCÚÃùiÚAlive
(
boŞ
 
k“pAlive
 = 
çl£
);

128 
£tCacheDi§bËd
();

129 
addH—d”
();

130 
addCÚ‹Á
(cÚ¡ 
¡d
::
¡ršg
 &
‹xt
, 
boŞ
 
addL’
 = 
Œue
);

131 
addText
(cÚ¡ 
¡d
::
¡ršg
 &
‹xt
);

132 
addTextLše
(cÚ¡ 
¡d
::
¡ršg
 &
‹xt
);

133 cÚ¡ *
g‘H‰pStusDesc
(
¡©usCode
);

134 
	g´Ùeùed
:

135 
Re¥Ú£V®ueLi¡
 *
´•¬eH—d”V®ues
();

136 
addH—d”V®ueToText
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ std::¡ršg &
v®ue
);

137 
	g´Ùeùed
:

138 
mg_cÚÃùiÚ
 *
m_cÚn
;

139 
	g¡d
::
¡ršg
 
m_‹xt
;

140 
	g¡d
::
auto_±r
<
Re¥Ú£V®ueLi¡
> 
m_h—d”V®ues
;

141 
	g¡d
::
auto_±r
<
Re¥Ú£V®ueIndex
> 
m_h—d”V®uesIndex
;

142 
	g¡d
::
auto_±r
<
¡d
::
¡ršg
> 
m_¡©usText
;

145 şas 
	cMÚgoo£S”v”
 {

146 
	gpublic
:

148 
MÚgoo£S”v”
();

149 
	gvœtu®
 ~
MÚgoo£S”v”
();

151 
£tO±iÚs
(cÚ¡ 
S”v”O±iÚS‘
 &
İtiÚs
);

152 
£tO±iÚ
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ std::¡ršg &
v®ue
);

153 
g‘O±iÚs
(
S”v”O±iÚS‘
 &
İtiÚs
) const;

154 
boŞ
 
g‘O±iÚV®ue
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, std::¡ršg &
v®ue
) const;

155 
g‘O±iÚV®ue
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, std::¡ršg &
v®ue
, cÚ¡ std::¡ršg &
defV®ue
) const;

156 
g‘V®idO±iÚs
(
S”v”O±iÚLi¡
 &
ouut
);

157 
	g¡d
::
¡ršg
 
g‘V”siÚ
();

158 
ÿlcMD5
(cÚ¡ 
¡d
::
¡ršg
 &
‹xt
, std::¡ršg &
ouut
);

159 
MÚgoo£Reque¡M‘hodCode
 
m‘hodTextToCode
(cÚ¡ 
¡d
::
¡ršg
 &
‹xt
);

161 
vœtu®
 
š™
();

162 
¡¬t
();

163 
¡İ
();

164 
boŞ
 
isRuÂšg
();

165 
vœtu®
 *
hªdËEv’t
(
S”v”HªdlšgEv’t
 
ev’tCode
,

166 
mg_cÚÃùiÚ
 *
cÚn
,

167 cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
);

168 
	g´Ùeùed
:

169 
vœtu®
 
boŞ
 
hªdËEv’t
(
S”v”HªdlšgEv’t
 
ev’tCode
, 
MÚgoo£CÚÃùiÚ
 &
cÚÃùiÚ
, cÚ¡ 
MÚgoo£Reque¡
 &
»que¡
, 
MÚgoo£Re¥Ú£
 &
»¥Ú£
);

170 
vœtu®
 
MÚgoo£CÚÃùiÚ
 *
ÃwCÚÃùiÚ
(
mg_cÚÃùiÚ
 *
cÚn
);

171 
vœtu®
 
MÚgoo£Reque¡
 *
ÃwReque¡
(
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ 
mg_»que¡_šfo
 *
»que¡
);

172 
vœtu®
 
MÚgoo£Re¥Ú£
 *
ÃwRe¥Ú£
(
mg_cÚÃùiÚ
 *
cÚn
);

173 
checkStİ³d
();

174 cÚ¡ **
´•¬eO±iÚs
();

175 
uÅ»·»O±iÚs
();

176 
checkM‘hodM­
();

177 
	g´Ùeùed
:

178 
S”v”O±iÚS‘
 
m_İtiÚs
;

179 
S”v”O±iÚStÜage
 
	gm_İtiÚStÜage
;

180 
boŞ
 
	gm_¡©usRuÂšg
;

181 
boŞ
 
	gm_´•¬ed
;

182 
mg_cÚ‹xt
 *
	gm_ùx
;

183 
M‘hodM­Gu¬d
 
	gm_m‘hodM­
;

	@src/external/vpiotr-mongoose-cpp/mongoose.c

21 #ià
defšed
(
_WIN32
)

22 
	#_CRT_SECURE_NO_WARNINGS


23 #–£

	)

24 
	#_XOPEN_SOURCE
 600

25 
	#_LARGEFILE_SOURCE


27 

	)

28 #iâdeà
_WIN32_WCE


29 
	~<sys/ty³s.h
>

30 
	~<sys/¡©.h
>

31 
	~<”ºo.h
>

32 
	~<sigÇl.h
>

33 
	~<fú.h
>

36 
	~<time.h
>

37 
	~<¡dlib.h
>

38 
	~<¡d¬g.h
>

39 
	~<as£¹.h
>

40 
	~<¡ršg.h
>

41 
	~<ùy³.h
>

42 
	~<lim™s.h
>

43 
	~<¡ddef.h
>

44 
	~<¡dio.h
>

46 #ià
defšed
(
_WIN32
)

47 
	#_WIN32_WINNT
 0x0400

48 
	~<wšdows.h
>

	)

50 #iâdeà
PATH_MAX


51 
	#PATH_MAX
 
MAX_PATH


	)

54 #iâdeà
_WIN32_WCE


55 
	~<´oûss.h
>

56 
	~<dœeù.h
>

57 
	~<io.h
>

59 
	~<wšsock2.h
>

60 
	#NO_CGI


61 

	)

62 
	toff_t
;

63 
	#BUFSIZ
 128000

	)

65 
	#”ºo
 
	`G‘La¡E¼Ü
()

	)

66 
	#¡»¼Ü
(
x
è
	`_uÉß
(x, (*è
	`_®loÿ
((xè*3 ), 10)

	)

69 
	#MAKEUQUAD
(
lo
, 
hi
è((
ušt64_t
)(((
ušt32_t
)Öo)è| \

	)

70 ((
	gušt64_t
)((
	gušt32_t
)(
	ghi
))) << 32))

71 
	#RATE_DIFF
 10000000

72 
	#EPOCH_DIFF
 
	`MAKEUQUAD
(0xd53e8000, 0x019db1de)

	)

73 
	#SYS2UNIX_TIME
(
lo
, 
hi
è\

	)

74 (
	gtime_t
è((
MAKEUQUAD
((
lo
), (
hi
)è- 
	gEPOCH_DIFF
è/ 
	gRATE_DIFF
)

79 #ià
defšed
(
_MSC_VER
) && _MSC_VER < 1300

80 
	#STRX
(
x
è#x

	)

81 
	#STR
(
x
è
	`STRX
(x)

	)

82 
	#__func__
 "lš" 
	`STR
(
__LINE__
)

	)

83 
	#¡¹ouÎ
(
x
, 
y
, 
z
è
	`¡¹oul
(x, y, z)

	)

84 
	#¡¹Şl
(
x
, 
y
, 
z
è
	`¡¹Ş
(x, y, z)

	)

86 
	#__func__
 
__FUNCTION__


	)

87 
	#¡¹ouÎ
(
x
, 
y
, 
z
è
	`_¡¹oui64
(x, y, z)

	)

88 
	#¡¹Şl
(
x
, 
y
, 
z
è
	`_¡¹oi64
(x, y, z)

	)

91 
	#ERRNO
 
	`G‘La¡E¼Ü
()

	)

92 
	#NO_SOCKLEN_T


	)

93 
	#SSL_LIB
 "s¦—y32.dÎ"

	)

94 
	#CRYPTO_LIB
 "lib—y32.dÎ"

	)

95 
	#DIRSEP
 '\\'

	)

96 
	#IS_DIRSEP_CHAR
(
c
è((cè=ğ'/' || (cè=ğ'\\')

	)

97 
	#O_NONBLOCK
 0

	)

98 #ià!
defšed
(
EWOULDBLOCK
)

99 
	#EWOULDBLOCK
 
WSAEWOULDBLOCK


	)

101 
	#_POSIX_


	)

102 
	#INT64_FMT
 "I64d"

	)

104 
	#WINCDECL
 
__cdeş


	)

105 
	#SHUT_WR
 1

	)

106 
	#¢´štf
 
_¢´štf


	)

107 
	#v¢´štf
 
_v¢´štf


	)

108 
	#¦“p
(
x
è
	`SË•
((xè* 1000)

	)

110 
	#pe
(
x
è
	`_pe
(x, 
BUFSIZ
, 
_O_BINARY
)

	)

111 
	#pİ’
(
x
, 
y
è
	`_pİ’
(x, y)

	)

112 
	#pşo£
(
x
è
	`_pşo£
(x)

	)

113 
	#şo£
(
x
è
	`_şo£
(x)

	)

114 
	#dlsym
(
x
,
y
è
	`G‘ProcAdd»ss
((
HINSTANCE
è(x), (y))

	)

115 
	#RTLD_LAZY
 0

	)

116 
	#f£eko
(
x
, 
y
, 
z
è
	`f£ek
((x), (y), (z))

	)

117 
	#fdİ’
(
x
, 
y
è
	`_fdİ’
((x), (y))

	)

118 
	#wr™e
(
x
, 
y
, 
z
è
	`_wr™e
((x), (y), (èz)

	)

119 
	#»ad
(
x
, 
y
, 
z
è
	`_»ad
((x), (y), (èz)

	)

120 
	#æockfe
(
x
è(è0

	)

121 
	#fuÆockfe
(
x
è(è0

	)

123 #ià!
defšed
(
f’o
)

124 
	#f’o
(
x
è
	`_f’o
(x)

	)

127 
HANDLE
 
	t±h»ad_mu‹x_t
;

128 ¡ruù {
HANDLE
 
	msigÇl
, 
	mbrßdÿ¡
;} 
	t±h»ad_cÚd_t
;

129 
DWORD
 
	t±h»ad_t
;

130 
	#pid_t
 
HANDLE


131 

	)

132 
	stime¥ec
 {

133 
	mtv_n£c
;

134 
	mtv_£c
;

137 
±h»ad_mu‹x_lock
(
±h»ad_mu‹x_t
 *);

138 
±h»ad_mu‹x_uÆock
(
±h»ad_mu‹x_t
 *);

139 
FILE
 *
mg_fİ’
(cÚ¡ *
·th
, cÚ¡ *
mode
);

141 #ià
defšed
(
HAVE_STDINT
)

142 
	~<¡dšt.h
>

144 
	tušt32_t
;

145 
	tušt16_t
;

146 
	t__št64
 
	tušt64_t
;

147 
__št64
 
	tšt64_t
;

148 
	#INT64_MAX
 9223372036854775807

	)

152 
	sdœ’t
 {

153 
	md_Çme
[
PATH_MAX
];

156 
	sDIR
 {

157 
HANDLE
 
	mhªdË
;

158 
WIN32_FIND_DATAW
 
	mšfo
;

159 
dœ’t
 
	m»suÉ
;

160 } 
	tDIR
;

163 
	~<sys/wa™.h
>

164 
	~<sys/sock‘.h
>

165 
	~<sys/£Ëù.h
>

166 
	~<Ãtš‘/š.h
>

167 
	~<¬·/š‘.h
>

168 
	~<sys/time.h
>

169 
	~<¡dšt.h
>

170 
	~<š‰y³s.h
>

171 
	~<Ãtdb.h
>

173 
	~<pwd.h
>

174 
	~<uni¡d.h
>

175 
	~<dœ’t.h
>

176 #ià!
defšed
(
NO_SSL_DL
è&& !defšed(
NO_SSL
)

177 
	~<dlfú.h
>

179 
	~<±h»ad.h
>

180 #ià
defšed
(
__MACH__
)

181 
	#SSL_LIB
 "libs¦.dylib"

	)

182 
	#CRYPTO_LIB
 "libüy±o.dylib"

	)

184 #ià!
defšed
(
SSL_LIB
)

185 
	#SSL_LIB
 "libs¦.so"

	)

187 #ià!
defšed
(
CRYPTO_LIB
)

188 
	#CRYPTO_LIB
 "libüy±o.so"

	)

191 
	#DIRSEP
 '/'

	)

192 
	#IS_DIRSEP_CHAR
(
c
è((cè=ğ'/')

	)

193 
	#O_BINARY
 0

	)

194 
	#şo£sock‘
(
a
è
	`şo£
×)

	)

195 
	#mg_fİ’
(
x
, 
y
è
	`fİ’
(x, y)

	)

196 
	#mg_mkdœ
(
x
, 
y
è
	`mkdœ
(x, y)

	)

197 
	#mg_»move
(
x
è
	`»move
(x)

	)

198 
	#mg_»Çme
(
x
, 
y
è
	`»Çme
(x, y)

	)

199 
	#ERRNO
 
”ºo


	)

200 
	#INVALID_SOCKET
 (-1)

	)

201 
	#INT64_FMT
 
PRId64


	)

202 
	tSOCKET
;

203 
	#WINCDECL


	)

207 
	~"mÚgoo£.h
"

209 
	#MONGOOSE_VERSION
 "3.0"

	)

210 
	#PASSWORDS_FILE_NAME
 ".hasswd"

	)

211 
	#CGI_ENVIRONMENT_SIZE
 4096

	)

212 
	#MAX_CGI_ENVIR_VARS
 64

	)

213 
	#ARRAY_SIZE
(
¬¿y
è(×¼ayè/ ×¼ay[0]))

	)

215 #ià
defšed
(
DEBUG
)

216 
	#DEBUG_TRACE
(
x
èdØ{ \

	)

217 
æockfe
(
¡dout
); \

218 
´štf
("*** %lu.%p.%s.%d: ", \

219 (è
time
(
NULL
), (*è
±h»ad_£lf
(), \

220 
__func__
, 
__LINE__
); \

221 
´štf
 
	gx
; \

222 
putch¬
('\n'); \

223 
fæush
(
¡dout
); \

224 
fuÆockfe
(
¡dout
); \

227 
	#DEBUG_TRACE
(
x
)

	)

231 #ifdeà
NO_SOCKLEN_T


232 
	tsockËn_t
;

235 * (*
	tmg_th»ad_func_t
)(*);

237 cÚ¡ *
h‰p_500_”rÜ
 = "Internal Server Error";

242 
s¦_¡
 
	tSSL
;

243 
s¦_m‘hod_¡
 
	tSSL_METHOD
;

244 
s¦_ùx_¡
 
	tSSL_CTX
;

246 
	#SSL_ERROR_WANT_READ
 2

	)

247 
	#SSL_ERROR_WANT_WRITE
 3

	)

248 
	#SSL_FILETYPE_PEM
 1

	)

249 
	#CRYPTO_LOCK
 1

	)

251 #ià
	`defšed
(
NO_SSL_DL
)

252 
	`SSL_ä“
(
SSL
 *);

253 
	`SSL_acû±
(
SSL
 *);

254 
	`SSL_cÚÃù
(
SSL
 *);

255 
	`SSL_»ad
(
SSL
 *, *, );

256 
	`SSL_wr™e
(
SSL
 *, const *, );

257 
	`SSL_g‘_”rÜ
(cÚ¡ 
SSL
 *, );

258 
	`SSL_£t_fd
(
SSL
 *, );

259 
SSL
 *
	`SSL_Ãw
(
SSL_CTX
 *);

260 
SSL_CTX
 *
	`SSL_CTX_Ãw
(
SSL_METHOD
 *);

261 
SSL_METHOD
 *
	`SSLv23_£rv”_m‘hod
();

262 
	`SSL_lib¿ry_š™
();

263 
	`SSL_lßd_”rÜ_¡ršgs
();

264 
	`SSL_CTX_u£_Priv©eKey_fe
(
SSL_CTX
 *, const *, );

265 
	`SSL_CTX_u£_û¹ifiÿ‹_fe
(
SSL_CTX
 *, const *, );

266 
	`SSL_CTX_u£_û¹ifiÿ‹_chaš_fe
(
SSL_CTX
 *, const *);

267 
	`SSL_CTX_£t_deçuÉ_·sswd_cb
(
SSL_CTX
 *, 
mg_ÿÎback_t
);

268 
	`SSL_CTX_ä“
(
SSL_CTX
 *);

269 
	`ERR_g‘_”rÜ
();

270 *
	`ERR_”rÜ_¡ršg
(, *);

271 
	`CRYPTO_num_locks
();

272 
	`CRYPTO_£t_lockšg_ÿÎback
((*)(, , const *, ));

273 
	`CRYPTO_£t_id_ÿÎback
((*)());

276 
	ss¦_func
 {

277 cÚ¡ *
Çme
;

278 (*
±r
)();

281 
	#SSL_ä“
 (* ((*)(
SSL
 *)è
s¦_sw
[0].
±r
)

	)

282 
	#SSL_acû±
 (* ((*)(
SSL
 *)è
s¦_sw
[1].
±r
)

	)

283 
	#SSL_cÚÃù
 (* ((*)(
SSL
 *)è
s¦_sw
[2].
±r
)

	)

284 
	#SSL_»ad
 (* ((*)(
SSL
 *, *, )è
s¦_sw
[3].
±r
)

	)

285 
	#SSL_wr™e
 (* ((*)(
SSL
 *, cÚ¡ *,)è
s¦_sw
[4].
±r
)

	)

286 
	#SSL_g‘_”rÜ
 (* ((*)(
SSL
 *, )è
s¦_sw
[5])

	)

287 
	#SSL_£t_fd
 (* ((*)(
SSL
 *, 
SOCKET
)è
s¦_sw
[6].
±r
)

	)

288 
	#SSL_Ãw
 (* (
SSL
 * (*)(
SSL_CTX
 *)è
s¦_sw
[7].
±r
)

	)

289 
	#SSL_CTX_Ãw
 (* (
SSL_CTX
 * (*)(
SSL_METHOD
 *)è
s¦_sw
[8].
±r
)

	)

290 
	#SSLv23_£rv”_m‘hod
 (* (
SSL_METHOD
 * (*)()è
s¦_sw
[9].
±r
)

	)

291 
	#SSL_lib¿ry_š™
 (* ((*)()è
s¦_sw
[10].
±r
)

	)

292 
	#SSL_CTX_u£_Priv©eKey_fe
 (* ((*)(
SSL_CTX
 *, \

	)

293 cÚ¡ *, )è
s¦_sw
[11].
±r
)

294 
	#SSL_CTX_u£_û¹ifiÿ‹_fe
 (* ((*)(
SSL_CTX
 *, \

	)

295 cÚ¡ *, )è
s¦_sw
[12].
±r
)

296 
	#SSL_CTX_£t_deçuÉ_·sswd_cb
 \

	)

297 (* ((*)(
SSL_CTX
 *, 
mg_ÿÎback_t
)è
s¦_sw
[13].
±r
)

298 
	#SSL_CTX_ä“
 (* ((*)(
SSL_CTX
 *)è
s¦_sw
[14].
±r
)

	)

299 
	#SSL_lßd_”rÜ_¡ršgs
 (* ((*)()è
s¦_sw
[15].
±r
)

	)

300 
	#SSL_CTX_u£_û¹ifiÿ‹_chaš_fe
 \

	)

301 (* ((*)(
SSL_CTX
 *, cÚ¡ *)è
s¦_sw
[16].
±r
)

303 
	#CRYPTO_num_locks
 (* ((*)()è
üy±o_sw
[0].
±r
)

	)

304 
	#CRYPTO_£t_lockšg_ÿÎback
 \

	)

305 (* ((*)((*)(, , cÚ¡ *, ))è
üy±o_sw
[1].
±r
)

306 
	#CRYPTO_£t_id_ÿÎback
 \

	)

307 (* ((*)((*)())è
üy±o_sw
[2].
±r
)

308 
	#ERR_g‘_”rÜ
 (* ((*)()è
s¦_sw
[3].
±r
)

	)

309 
	#ERR_”rÜ_¡ršg
 (* (* (*)(, *)è
s¦_sw
[4].
±r
)

	)

315 
s¦_func
 
s¦_sw
[] = {

316 {"SSL_ä“", 
NULL
},

317 {"SSL_acû±", 
NULL
},

318 {"SSL_cÚÃù", 
NULL
},

319 {"SSL_»ad", 
NULL
},

320 {"SSL_wr™e", 
NULL
},

321 {"SSL_g‘_”rÜ", 
NULL
},

322 {"SSL_£t_fd", 
NULL
},

323 {"SSL_Ãw", 
NULL
},

324 {"SSL_CTX_Ãw", 
NULL
},

325 {"SSLv23_£rv”_m‘hod", 
NULL
},

326 {"SSL_lib¿ry_š™", 
NULL
},

327 {"SSL_CTX_u£_Priv©eKey_fe", 
NULL
},

328 {"SSL_CTX_u£_û¹ifiÿ‹_fe",
NULL
},

329 {"SSL_CTX_£t_deçuÉ_·sswd_cb",
NULL
},

330 {"SSL_CTX_ä“", 
NULL
},

331 {"SSL_lßd_”rÜ_¡ršgs", 
NULL
},

332 {"SSL_CTX_u£_û¹ifiÿ‹_chaš_fe", 
NULL
},

333 {
NULL
, NULL}

334 
	}
};

337 
s¦_func
 
	güy±o_sw
[] = {

338 {"CRYPTO_num_locks", 
NULL
},

339 {"CRYPTO_£t_lockšg_ÿÎback", 
NULL
},

340 {"CRYPTO_£t_id_ÿÎback", 
NULL
},

341 {"ERR_g‘_”rÜ", 
NULL
},

342 {"ERR_”rÜ_¡ršg", 
NULL
},

343 {
NULL
, NULL}

347 cÚ¡ *
	gmÚth_Çmes
[] = {

354 
	su§
 {

355 
sockËn_t
 
	mËn
;

357 
sockaddr
 
	m§
;

358 
sockaddr_š
 
	msš
;

359 } 
	mu
;

363 
	svec
 {

364 cÚ¡ *
	m±r
;

365 
size_t
 
	mËn
;

369 
	smg¡©
 {

370 
	mis_dœeùÜy
;

371 
št64_t
 
	msize
;

372 
time_t
 
	mmtime
;

377 
	ssock‘
 {

378 
sock‘
 *
	mÃxt
;

379 
SOCKET
 
	msock
;

380 
u§
 
	ml§
;

381 
u§
 
	mr§
;

382 
	mis_s¦
;

383 
	mis_´oxy
;

387 
	mCGI_EXTENSIONS
, 
	mCGI_ENVIRONMENT
, 
	mPUT_DELETE_PASSWORDS_FILE
, 
	mCGI_INTERPRETER
,

388 
	mPROTECT_URI
, 
	mAUTHENTICATION_DOMAIN
, 
	mSSI_EXTENSIONS
, 
	mACCESS_LOG_FILE
,

389 
	mSSL_CHAIN_FILE
, 
	mENABLE_DIRECTORY_LISTING
, 
	mERROR_LOG_FILE
,

390 
	mGLOBAL_PASSWORDS_FILE
, 
	mINDEX_FILES
,

391 
	mENABLE_KEEP_ALIVE
, 
	mACCESS_CONTROL_LIST
, 
	mMAX_REQUEST_SIZE
,

392 
	mEXTRA_MIME_TYPES
, 
	mLISTENING_PORTS
,

393 
	mDOCUMENT_ROOT
, 
	mSSL_CERTIFICATE
, 
	mNUM_THREADS
, 
	mRUN_AS_USER
,

394 
	mNUM_OPTIONS


397 cÚ¡ *
	gcÚfig_İtiÚs
[] = {

399 "E", "cgi_’vœÚm’t", 
NULL
,

400 "G", "put_d–‘e_·sswÜds_fe", 
NULL
,

401 "I", "cgi_š‹½»‹r", 
NULL
,

402 "P", "´Ùeù_uri", 
NULL
,

405 "a", "acûss_log_fe", 
NULL
,

406 "c", "s¦_chaš_fe", 
NULL
,

408 "e", "”rÜ_log_fe", 
NULL
,

409 "g", "glob®_·sswÜds_fe", 
NULL
,

412 "l", "acûss_cÚŒŞ_li¡", 
NULL
,

414 "m", "exŒa_mime_ty³s", 
NULL
,

417 "s", "s¦_û¹ifiÿ‹", 
NULL
,

419 "u", "run_as_u£r", 
NULL
,

420 
NULL


422 
	#ENTRIES_PER_CONFIG_OPTION
 3

	)

424 
	smg_cÚ‹xt
 {

425 
	m¡İ_æag
;

426 
SSL_CTX
 *
	ms¦_ùx
;

427 *
	mcÚfig
[
NUM_OPTIONS
];

428 
mg_ÿÎback_t
 
	mu£r_ÿÎback
;

429 *
	mu£r_d©a
;

431 
sock‘
 *
	mli¡’šg_sock‘s
;

433 
	mnum_th»ads
;

434 
±h»ad_mu‹x_t
 
	mmu‹x
;

435 
±h»ad_cÚd_t
 
	mcÚd
;

437 
sock‘
 
	mqueue
[20];

438 
	msq_h—d
;

439 
	msq_
;

440 
±h»ad_cÚd_t
 
	msq_fuÎ
;

441 
±h»ad_cÚd_t
 
	msq_em±y
;

444 
	smg_cÚÃùiÚ
 {

445 
mg_cÚÃùiÚ
 *
	m³”
;

446 
mg_»que¡_šfo
 
	m»que¡_šfo
;

447 
mg_cÚ‹xt
 *
	mùx
;

448 
SSL
 *
	ms¦
;

449 
sock‘
 
	mş›Á
;

450 
time_t
 
	mbœth_time
;

451 
št64_t
 
	mnum_by‹s_£Á
;

452 
št64_t
 
	mcÚ‹Á_Ën
;

453 
št64_t
 
	mcÚsumed_cÚ‹Á
;

454 *
	mbuf
;

455 
	mbuf_size
;

456 
	m»que¡_Ën
;

457 
	md©a_Ën
;

458 *
	mauth_h—d”
;

461 cÚ¡ **
	$mg_g‘_v®id_İtiÚ_Çmes
() {

462  
cÚfig_İtiÚs
;

463 
	}
}

465 *
	$ÿÎ_u£r
(
mg_cÚÃùiÚ
 *
cÚn
, 
mg_ev’t
 
ev’t
) {

466 
cÚn
->
»que¡_šfo
.
u£r_d©a
 = cÚn->
ùx
->user_data;

467  
cÚn
->
ùx
->
u£r_ÿÎback
 =ğ
NULL
 ? NULL :

468 
cÚn
->
ùx
->
	`u£r_ÿÎback
(
ev’t
, cÚn, &cÚn->
»que¡_šfo
);

469 
	}
}

471 
	$g‘_İtiÚ_šdex
(cÚ¡ *
Çme
) {

472 
i
;

474 
i
 = 0; 
cÚfig_İtiÚs
[i] !ğ
NULL
; i +ğ
ENTRIES_PER_CONFIG_OPTION
) {

475 ià(
	`¡rcmp
(
cÚfig_İtiÚs
[
i
], 
Çme
) == 0 ||

476 
	`¡rcmp
(
cÚfig_İtiÚs
[
i
 + 1], 
Çme
) == 0) {

477  
i
 / 
ENTRIES_PER_CONFIG_OPTION
;

481 
	}
}

483 cÚ¡ *
	$mg_g‘_İtiÚ
(cÚ¡ 
mg_cÚ‹xt
 *
ùx
, cÚ¡ *
Çme
) {

484 
i
;

485 ià((
i
 = 
	`g‘_İtiÚ_šdex
(
Çme
)) == -1) {

486  
NULL
;

487 } ià(
ùx
->
cÚfig
[
i
] =ğ
NULL
) {

490  
ùx
->
cÚfig
[
i
];

492 
	}
}

495 
	$üy
(
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
fmt
, ...) {

496 
buf
[
BUFSIZ
];

497 
va_li¡
 
­
;

498 
FILE
 *
å
;

499 
time_t
 
time¡amp
;

501 
	`va_¡¬t
(
­
, 
fmt
);

502 (è
	`v¢´štf
(
buf
, (buf), 
fmt
, 
­
);

503 
	`va_’d
(
­
);

508 
cÚn
->
»que¡_šfo
.
log_mes§ge
 = 
buf
;

509 ià(
	`ÿÎ_u£r
(
cÚn
, 
MG_EVENT_LOG
è=ğ
NULL
) {

510 
å
 = 
cÚn
->
ùx
->
cÚfig
[
ERROR_LOG_FILE
] =ğ
NULL
 ? NULL :

511 
	`mg_fİ’
(
cÚn
->
ùx
->
cÚfig
[
ERROR_LOG_FILE
], "a+");

513 ià(
å
 !ğ
NULL
) {

514 
	`æockfe
(
å
);

515 
time¡amp
 = 
	`time
(
NULL
);

517 (è
	`årštf
(
å
,

519 (è
time¡amp
,

520 
	`š‘_Áß
(
cÚn
->
ş›Á
.
r§
.
u
.
sš
.
sš_addr
));

522 ià(
cÚn
->
»que¡_šfo
.
»que¡_m‘hod
 !ğ
NULL
) {

523 (è
	`årštf
(
å
, "%s %s: ",

524 
cÚn
->
»que¡_šfo
.
»que¡_m‘hod
,

525 
cÚn
->
»que¡_šfo
.
uri
);

528 (è
	`årštf
(
å
, "%s", 
buf
);

529 
	`åutc
('\n', 
å
);

530 
	`fuÆockfe
(
å
);

531 ià(
å
 !ğ
¡d”r
) {

532 
	`fşo£
(
å
);

536 
cÚn
->
»que¡_šfo
.
log_mes§ge
 = 
NULL
;

537 
	}
}

540 cÚ¡ *
	$s¦_”rÜ
() {

541 
”r
;

542 
”r
 = 
	`ERR_g‘_”rÜ
();

543  
”r
 =ğ0 ? "" : 
	`ERR_”rÜ_¡ršg
Ó¼, 
NULL
);

544 
	}
}

548 
mg_cÚÃùiÚ
 *
	$fc
(
mg_cÚ‹xt
 *
ùx
) {

549 
mg_cÚÃùiÚ
 
çke_cÚÃùiÚ
;

550 
çke_cÚÃùiÚ
.
ùx
 = ctx;

551  &
çke_cÚÃùiÚ
;

552 
	}
}

554 cÚ¡ *
	$mg_v”siÚ
() {

555  
MONGOOSE_VERSION
;

556 
	}
}

558 
	$mg_¡¾ıy
(*
d¡
, cÚ¡ *
¤c
, 
size_t
 
n
) {

559 ; *
¤c
 !ğ'\0' && 
n
 > 1;‚--) {

560 *
d¡
++ = *
¤c
++;

562 *
d¡
 = '\0';

563 
	}
}

565 
	$low”ÿ£
(cÚ¡ *
s
) {

566  
	`tŞow”
(* (cÚ¡ *è
s
);

567 
	}
}

569 
	$mg_¡ºÿ£cmp
(cÚ¡ *
s1
, cÚ¡ *
s2
, 
size_t
 
Ën
) {

570 
diff
 = 0;

572 ià(
Ën
 > 0)

574 
diff
 = 
	`low”ÿ£
(
s1
++è-†ow”ÿ£(
s2
++);

575 } 
diff
 =ğ0 && 
s1
[-1] !ğ'\0' && --
Ën
 > 0);

577  
diff
;

578 
	}
}

580 
	$mg_¡rÿ£cmp
(cÚ¡ *
s1
, cÚ¡ *
s2
) {

581 
diff
;

584 
diff
 = 
	`low”ÿ£
(
s1
++è-†ow”ÿ£(
s2
++);

585 } 
diff
 =ğ0 && 
s1
[-1] != '\0');

587  
diff
;

588 
	}
}

590 * 
	$mg_¡ºdup
(cÚ¡ *
±r
, 
size_t
 
Ën
) {

591 *
p
;

593 ià((
p
 = (*è
	`m®loc
(
Ën
 + 1)è!ğ
NULL
) {

594 
	`mg_¡¾ıy
(
p
, 
±r
, 
Ën
 + 1);

597  
p
;

598 
	}
}

600 * 
	$mg_¡rdup
(cÚ¡ *
¡r
) {

601  
	`mg_¡ºdup
(
¡r
, 
	`¡¾’
(str));

602 
	}
}

608 
	$mg_v¢´štf
(
mg_cÚÃùiÚ
 *
cÚn
, *
buf
, 
size_t
 
buæ’
,

609 cÚ¡ *
fmt
, 
va_li¡
 
­
) {

610 
n
;

612 ià(
buæ’
 == 0)

615 
n
 = 
	`v¢´štf
(
buf
, 
buæ’
, 
fmt
, 
­
);

617 ià(
n
 < 0) {

618 
	`üy
(
cÚn
, "vsnprintfƒrror");

619 
n
 = 0;

620 } ià(
n
 >ğ(è
buæ’
) {

621 
	`üy
(
cÚn
, "truncating vsnprintf buffer: [%.*s]",

622 
n
 > 200 ? 200 :‚, 
buf
);

623 
n
 = (è
buæ’
 - 1;

625 
buf
[
n
] = '\0';

627  
n
;

628 
	}
}

630 
	$mg_¢´štf
(
mg_cÚÃùiÚ
 *
cÚn
, *
buf
, 
size_t
 
buæ’
,

631 cÚ¡ *
fmt
, ...) {

632 
va_li¡
 
­
;

633 
n
;

635 
	`va_¡¬t
(
­
, 
fmt
);

636 
n
 = 
	`mg_v¢´štf
(
cÚn
, 
buf
, 
buæ’
, 
fmt
, 
­
);

637 
	`va_’d
(
­
);

639  
n
;

640 
	}
}

646 *
	$sk_quÙed
(**
buf
, cÚ¡ *
d–im™”s
, cÚ¡ *
wh™e¥aû
, 
quÙech¬
) {

647 *
p
, *
begš_wÜd
, *
’d_wÜd
, *
’d_wh™e¥aû
;

649 
begš_wÜd
 = *
buf
;

650 
’d_wÜd
 = 
begš_wÜd
 + 
	`¡rc¥n
(begš_wÜd, 
d–im™”s
);

653 ià(
’d_wÜd
 > 
begš_wÜd
) {

654 
p
 = 
’d_wÜd
 - 1;

655 *
p
 =ğ
quÙech¬
) {

657 ià(*
’d_wÜd
 == '\0') {

658 *
p
 = '\0';

661 
size_t
 
’d_off
 = 
	`¡rc¥n
(
’d_wÜd
 + 1, 
d–im™”s
);

662 
	`memmove
 (
p
, 
’d_wÜd
, 
’d_off
 + 1);

663 
p
 +ğ
’d_off
;

664 
’d_wÜd
 +ğ
’d_off
 + 1;

667 
p
++;… < 
’d_wÜd
;…++) {

668 *
p
 = '\0';

672 ià(*
’d_wÜd
 == '\0') {

673 *
buf
 = 
’d_wÜd
;

675 
’d_wh™e¥aû
 = 
’d_wÜd
 + 1 + 
	`¡r¥n
Ónd_wÜd + 1, 
wh™e¥aû
);

677 
p
 = 
’d_wÜd
;… < 
’d_wh™e¥aû
;…++) {

678 *
p
 = '\0';

681 *
buf
 = 
’d_wh™e¥aû
;

684  
begš_wÜd
;

685 
	}
}

688 *
	$sk
(**
buf
, cÚ¡ *
d–im™”s
) {

689  
	`sk_quÙed
(
buf
, 
d–im™”s
, delimiters, 0);

690 
	}
}

694 cÚ¡ *
	$g‘_h—d”
(cÚ¡ 
mg_»que¡_šfo
 *
ri
,

695 cÚ¡ *
Çme
) {

696 
i
;

698 
i
 = 0; i < 
ri
->
num_h—d”s
; i++)

699 ià(!
	`mg_¡rÿ£cmp
(
Çme
, 
ri
->
h‰p_h—d”s
[
i
].name))

700  
ri
->
h‰p_h—d”s
[
i
].
v®ue
;

702  
NULL
;

703 
	}
}

705 cÚ¡ *
	$mg_g‘_h—d”
(cÚ¡ 
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
Çme
) {

706  
	`g‘_h—d”
(&
cÚn
->
»que¡_šfo
, 
Çme
);

707 
	}
}

715 cÚ¡ *
	$Ãxt_İtiÚ
(cÚ¡ *
li¡
, 
vec
 *
v®
,

716 
vec
 *
eq_v®
) {

717 ià(
li¡
 =ğ
NULL
 || *list == '\0') {

719 
li¡
 = 
NULL
;

721 
v®
->
±r
 = 
li¡
;

722 ià((
li¡
 = 
	`¡rchr
(
v®
->
±r
, ',')è!ğ
NULL
) {

724 
v®
->
Ën
 = 
li¡
 - v®->
±r
;

725 
li¡
++;

728 
li¡
 = 
v®
->
±r
 + 
	`¡¾’
(val->ptr);

729 
v®
->
Ën
 = 
li¡
 - v®->
±r
;

732 ià(
eq_v®
 !ğ
NULL
) {

737 
eq_v®
->
Ën
 = 0;

738 
eq_v®
->
±r
 = (cÚ¡ *è
	`memchr
(
v®
->±r, '=', v®->
Ën
);

739 ià(
eq_v®
->
±r
 !ğ
NULL
) {

740 
eq_v®
->
±r
++;

741 
eq_v®
->
Ën
 = 
v®
->
±r
 + val->len -ƒq_val->ptr;

742 
v®
->
Ën
 = (
eq_v®
->
±r
 - val->ptr) - 1;

747  
li¡
;

748 
	}
}

750 #ià!
defšed
(
NO_CGI
)

751 
	$m©ch_ex‹nsiÚ
(cÚ¡ *
·th
, cÚ¡ *
ext_li¡
) {

752 
vec
 
ext_vec
;

753 
size_t
 
·th_Ën
;

755 
·th_Ën
 = 
	`¡¾’
(
·th
);

757 (
ext_li¡
 = 
	`Ãxt_İtiÚ
Óxt_li¡, &
ext_vec
, 
NULL
)) != NULL)

758 ià(
ext_vec
.
Ën
 < 
·th_Ën
 &&

759 
	`mg_¡ºÿ£cmp
(
·th
 + 
·th_Ën
 - 
ext_vec
.
Ën
,

760 
ext_vec
.
±r
,ƒxt_vec.
Ën
) == 0)

764 
	}
}

770 
	$should_k“p_®ive
(cÚ¡ 
mg_cÚÃùiÚ
 *
cÚn
) {

771 cÚ¡ *
h‰p_v”siÚ
 = 
cÚn
->
»que¡_šfo
.http_version;

772 cÚ¡ *
h—d”
 = 
	`mg_g‘_h—d”
(
cÚn
, "Connection");

773  (
h—d”
 =ğ
NULL
 && 
h‰p_v”siÚ
 && !
	`¡rcmp
(http_version, "1.1")) ||

774 (
h—d”
 !ğ
NULL
 && !
	`mg_¡rÿ£cmp
(header, "keep-alive"));

775 
	}
}

777 cÚ¡ *
	$sugge¡_cÚÃùiÚ_h—d”
(cÚ¡ 
mg_cÚÃùiÚ
 *
cÚn
) {

778  
	`should_k“p_®ive
(
cÚn
) ? "keep-alive" : "close";

779 
	}
}

781 
	$£nd_h‰p_”rÜ
(
mg_cÚÃùiÚ
 *
cÚn
, 
¡©us
,

782 cÚ¡ *
»asÚ
, cÚ¡ *
fmt
, ...) {

783 
buf
[
BUFSIZ
];

784 
va_li¡
 
­
;

785 
Ën
;

787 
cÚn
->
»que¡_šfo
.
¡©us_code
 = 
¡©us
;

789 ià(
	`ÿÎ_u£r
(
cÚn
, 
MG_HTTP_ERROR
è=ğ
NULL
) {

790 
buf
[0] = '\0';

791 
Ën
 = 0;

794 ià(
¡©us
 > 199 && status != 204 && status != 304) {

795 
Ën
 = 
	`mg_¢´štf
(
cÚn
, 
buf
, (buf), "E¼Ü %d: %s", 
¡©us
, 
»asÚ
);

796 
	`üy
(
cÚn
, "%s", 
buf
);

797 
buf
[
Ën
++] = '\n';

799 
	`va_¡¬t
(
­
, 
fmt
);

800 
Ën
 +ğ
	`mg_v¢´štf
(
cÚn
, 
buf
 +†’, (bufè-†’, 
fmt
, 
­
);

801 
	`va_’d
(
­
);

803 
	`DEBUG_TRACE
(("[%s]", 
buf
));

805 
	`mg_´štf
(
cÚn
, "HTTP/1.1 %d %s\r\n"

808 "CÚÃùiÚ: %s\r\n\r\n", 
¡©us
, 
»asÚ
, 
Ën
,

809 
	`sugge¡_cÚÃùiÚ_h—d”
(
cÚn
));

810 
cÚn
->
num_by‹s_£Á
 +ğ
	`mg_´štf
(cÚn, "%s", 
buf
);

812 
	}
}

814 #ifdeà
_WIN32


815 
	$±h»ad_mu‹x_š™
(
±h»ad_mu‹x_t
 *
mu‹x
, *
unu£d
) {

816 
unu£d
 = 
NULL
;

817 *
mu‹x
 = 
	`C»©eMu‹x
(
NULL
, 
FALSE
, NULL);

818  *
mu‹x
 =ğ
NULL
 ? -1 : 0;

819 
	}
}

821 
	$±h»ad_mu‹x_de¡roy
(
±h»ad_mu‹x_t
 *
mu‹x
) {

822  
	`Clo£HªdË
(*
mu‹x
) == 0 ? -1 : 0;

823 
	}
}

825 
	$±h»ad_mu‹x_lock
(
±h»ad_mu‹x_t
 *
mu‹x
) {

826  
	`Wa™FÜSšgËObjeù
(*
mu‹x
, 
INFINITE
è=ğ
WAIT_OBJECT_0
? 0 : -1;

827 
	}
}

829 
	$±h»ad_mu‹x_uÆock
(
±h»ad_mu‹x_t
 *
mu‹x
) {

830  
	`R–—£Mu‹x
(*
mu‹x
) == 0 ? -1 : 0;

831 
	}
}

833 
	$±h»ad_cÚd_š™
(
±h»ad_cÚd_t
 *
cv
, cÚ¡ *
unu£d
) {

834 
unu£d
 = 
NULL
;

835 
cv
->
sigÇl
 = 
	`C»©eEv’t
(
NULL
, 
FALSE
, FALSE, NULL);

836 
cv
->
brßdÿ¡
 = 
	`C»©eEv’t
(
NULL
, 
TRUE
, 
FALSE
, NULL);

837  
cv
->
sigÇl
 !ğ
NULL
 && cv->
brßdÿ¡
 != NULL ? 0 : -1;

838 
	}
}

840 
	$±h»ad_cÚd_wa™
(
±h»ad_cÚd_t
 *
cv
, 
±h»ad_mu‹x_t
 *
mu‹x
) {

841 
HANDLE
 
hªdËs
[] = {
cv
->
sigÇl
, cv->
brßdÿ¡
};

842 
	`R–—£Mu‹x
(*
mu‹x
);

843 
	`Wa™FÜMuÉËObjeùs
(2, 
hªdËs
, 
FALSE
, 
INFINITE
);

844  
	`R–—£Mu‹x
(*
mu‹x
) == 0 ? -1 : 0;

845 
	}
}

847 
	$±h»ad_cÚd_sigÇl
(
±h»ad_cÚd_t
 *
cv
) {

848  
	`S‘Ev’t
(
cv
->
sigÇl
) == 0 ? -1 : 0;

849 
	}
}

851 
	$±h»ad_cÚd_brßdÿ¡
(
±h»ad_cÚd_t
 *
cv
) {

854  
	`Pul£Ev’t
(
cv
->
brßdÿ¡
) == 0 ? -1 : 0;

855 
	}
}

857 
	$±h»ad_cÚd_de¡roy
(
±h»ad_cÚd_t
 *
cv
) {

858  
	`Clo£HªdË
(
cv
->
sigÇl
è&& Clo£HªdË(cv->
brßdÿ¡
) ? 0 : -1;

859 
	}
}

861 
±h»ad_t
 
	$±h»ad_£lf
() {

862  
	`G‘Cu¼’tTh»adId
();

863 
	}
}

866 
	$chªge_¦ashes_to_back¦ashes
(*
·th
) {

867 
i
;

869 
i
 = 0; 
·th
[i] != '\0'; i++) {

870 ià(
·th
[
i
] == '/')

871 
·th
[
i
] = '\\';

873 ià(
·th
[
i
] == '\\' && i > 0)

874 
·th
[
i
 + 1] == '\\' ||…ath[i + 1] == '/')

875 (è
	`memmove
(
·th
 + 
i
 + 1,

876 
·th
 + 
i
 + 2, 
	`¡¾’
(path + i + 1));

878 
	}
}

882 
	$to_unicode
(cÚ¡ *
·th
, 
wch¬_t
 *
wbuf
, 
size_t
 
wbuf_Ën
) {

883 
buf
[
PATH_MAX
], *
p
;

885 
	`mg_¡¾ıy
(
buf
, 
·th
, (buf));

886 
	`chªge_¦ashes_to_back¦ashes
(
buf
);

889 
p
 = 
buf
 + 
	`¡¾’
(buf) - 1;

892 
p
 > 
buf
 && *p == '\\' &&…[-1] != ':') {

893 *
p
-- = '\0';

900 ià(*
p
 == 0x20 ||

901 (*
p
 =ğ0x2&&… > 
buf
) ||

902 *
p
 == 0x2b ||

903 (*
p
 & ~0x7f)) {

904 (è
	`årštf
(
¡d”r
, "Rejeùšg su¥iciou ·th: [%s]", 
buf
);

905 
buf
[0] = '\0';

908 (è
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 0, 
buf
, -1, 
wbuf
, (è
wbuf_Ën
);

909 
	}
}

911 #ià
defšed
(
_WIN32_WCE
)

912 
time_t
 
	$time
(
time_t
 *
±ime
) {

913 
time_t
 
t
;

914 
SYSTEMTIME
 
¡
;

915 
FILETIME
 
á
;

917 
	`G‘Sy¡emTime
(&
¡
);

918 
	`Sy¡emTimeToFeTime
(&
¡
, &
á
);

919 
t
 = 
	`SYS2UNIX_TIME
(
á
.
dwLowD©eTime
, ft.
dwHighD©eTime
);

921 ià(
±ime
 !ğ
NULL
) {

922 *
±ime
 = 
t
;

925  
t
;

926 
	}
}

928 
time_t
 
	$mktime
(
tm
 *
±m
) {

929 
SYSTEMTIME
 
¡
;

930 
FILETIME
 
á
, 
lá
;

932 
¡
.
wY—r
 = 
±m
->
tm_y—r
 + 1900;

933 
¡
.
wMÚth
 = 
±m
->
tm_mÚ
 + 1;

934 
¡
.
wDay
 = 
±m
->
tm_mday
;

935 
¡
.
wHour
 = 
±m
->
tm_hour
;

936 
¡
.
wMšu‹
 = 
±m
->
tm_mš
;

937 
¡
.
wSecÚd
 = 
±m
->
tm_£c
;

938 
¡
.
wMli£cÚds
 = 0;

940 
	`Sy¡emTimeToFeTime
(&
¡
, &
á
);

941 
	`LoÿlFeTimeToFeTime
(&
á
, &
lá
);

942  (
time_t
è((
	`MAKEUQUAD
(
lá
.
dwLowD©eTime
,†á.
dwHighD©eTime
) -

943 
EPOCH_DIFF
è/ 
RATE_DIFF
);

944 
	}
}

946 
tm
 *
	$loÿÉime
(cÚ¡ 
time_t
 *
±ime
, 
tm
 *
±m
) {

947 
št64_t
 
t
 = ((št64_tè*
±ime
è* 
RATE_DIFF
 + 
EPOCH_DIFF
;

948 
FILETIME
 
á
, 
lá
;

949 
SYSTEMTIME
 
¡
;

950 
TIME_ZONE_INFORMATION
 
tzšfo
;

952 ià(
±m
 =ğ
NULL
) {

953  
NULL
;

956 * (
št64_t
 *è&
á
 = 
t
;

957 
	`FeTimeToLoÿlFeTime
(&
á
, &
lá
);

958 
	`FeTimeToSy¡emTime
(&
lá
, &
¡
);

959 
±m
->
tm_y—r
 = 
¡
.
wY—r
 - 1900;

960 
±m
->
tm_mÚ
 = 
¡
.
wMÚth
 - 1;

961 
±m
->
tm_wday
 = 
¡
.
wDayOfW“k
;

962 
±m
->
tm_mday
 = 
¡
.
wDay
;

963 
±m
->
tm_hour
 = 
¡
.
wHour
;

964 
±m
->
tm_mš
 = 
¡
.
wMšu‹
;

965 
±m
->
tm_£c
 = 
¡
.
wSecÚd
;

966 
±m
->
tm_yday
 = 0;

967 
±m
->
tm_isd¡
 =

968 
	`G‘TimeZÚeInfÜm©iÚ
(&
tzšfo
è=ğ
TIME_ZONE_ID_DAYLIGHT
 ? 1 : 0;

970  
±m
;

971 
	}
}

973 
size_t
 
	$¡ráime
(*
d¡
, 
size_t
 
d¡_size
, cÚ¡ *
fmt
,

974 cÚ¡ 
tm
 *tm) {

975 (è
	`¢´štf
(
d¡
, 
d¡_size
, "implement strftime() for WinCE");

977 
	}
}

980 
	$mg_»Çme
(cÚ¡ * 
ŞdÇme
, cÚ¡ * 
ÃwÇme
) {

981 
wch¬_t
 
wŞdbuf
[
PATH_MAX
];

982 
wch¬_t
 
wÃwbuf
[
PATH_MAX
];

984 
	`to_unicode
(
ŞdÇme
, 
wŞdbuf
, 
	`ARRAY_SIZE
(woldbuf));

985 
	`to_unicode
(
ÃwÇme
, 
wÃwbuf
, 
	`ARRAY_SIZE
(wnewbuf));

987  
	`MoveFeW
(
wŞdbuf
, 
wÃwbuf
) ? 0 : -1;

988 
	}
}

991 
FILE
 *
	$mg_fİ’
(cÚ¡ *
·th
, cÚ¡ *
mode
) {

992 
wch¬_t
 
wbuf
[
PATH_MAX
], 
wmode
[20];

994 
	`to_unicode
(
·th
, 
wbuf
, 
	`ARRAY_SIZE
(wbuf));

995 
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 0, 
mode
, -1, 
wmode
, 
	`ARRAY_SIZE
(wmode));

997  
	`_wfİ’
(
wbuf
, 
wmode
);

998 
	}
}

1000 
	$mg_¡©
(cÚ¡ *
·th
, 
mg¡©
 *
¡p
) {

1001 
ok
 = -1;

1002 
wch¬_t
 
wbuf
[
PATH_MAX
];

1003 
WIN32_FILE_ATTRIBUTE_DATA
 
šfo
;

1005 
	`to_unicode
(
·th
, 
wbuf
, 
	`ARRAY_SIZE
(wbuf));

1007 ià(
	`G‘FeA‰ribu‹sExW
(
wbuf
, 
G‘FeExInfoSnd¬d
, &
šfo
) != 0) {

1008 
¡p
->
size
 = 
	`MAKEUQUAD
(
šfo
.
nFeSizeLow
, info.
nFeSizeHigh
);

1009 
¡p
->
mtime
 = 
	`SYS2UNIX_TIME
(
šfo
.
áLa¡Wr™eTime
.
dwLowD©eTime
,

1010 
šfo
.
áLa¡Wr™eTime
.
dwHighD©eTime
);

1011 
¡p
->
is_dœeùÜy
 =

1012 
šfo
.
dwFeA‰ribu‹s
 & 
FILE_ATTRIBUTE_DIRECTORY
;

1013 
ok
 = 0;

1016  
ok
;

1017 
	}
}

1019 
	$mg_»move
(cÚ¡ *
·th
) {

1020 
wch¬_t
 
wbuf
[
PATH_MAX
];

1021 
	`to_unicode
(
·th
, 
wbuf
, 
	`ARRAY_SIZE
(wbuf));

1022  
	`D–‘eFeW
(
wbuf
) ? 0 : -1;

1023 
	}
}

1025 
	$mg_mkdœ
(cÚ¡ *
·th
, 
mode
) {

1026 
buf
[
PATH_MAX
];

1027 
wch¬_t
 
wbuf
[
PATH_MAX
];

1029 
mode
 = 0;

1030 
	`mg_¡¾ıy
(
buf
, 
·th
, (buf));

1031 
	`chªge_¦ashes_to_back¦ashes
(
buf
);

1033 (è
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 0, 
buf
, -1, 
wbuf
, (wbuf));

1035  
	`C»©eDœeùÜyW
(
wbuf
, 
NULL
) ? 0 : -1;

1036 
	}
}

1039 
DIR
 * 
	$İ’dœ
(cÚ¡ *
Çme
) {

1040 
DIR
 *
dœ
 = 
NULL
;

1041 
wch¬_t
 
w·th
[
PATH_MAX
];

1042 
DWORD
 
©Œs
;

1044 ià(
Çme
 =ğ
NULL
) {

1045 
	`S‘La¡E¼Ü
(
ERROR_BAD_ARGUMENTS
);

1046 } ià((
dœ
 = (
DIR
 *è
	`m®loc
((*dœ))è=ğ
NULL
) {

1047 
	`S‘La¡E¼Ü
(
ERROR_NOT_ENOUGH_MEMORY
);

1049 
	`to_unicode
(
Çme
, 
w·th
, 
	`ARRAY_SIZE
(wpath));

1050 
©Œs
 = 
	`G‘FeA‰ribu‹sW
(
w·th
);

1051 ià(
©Œs
 != 0xFFFFFFFF &&

1052 ((
©Œs
 & 
FILE_ATTRIBUTE_DIRECTORY
) == FILE_ATTRIBUTE_DIRECTORY)) {

1053 (è
	`wcsÿt
(
w·th
, 
L
"\\*");

1054 
dœ
->
hªdË
 = 
	`FšdFœ¡FeW
(
w·th
, &dœ->
šfo
);

1055 
dœ
->
»suÉ
.
d_Çme
[0] = '\0';

1057 
	`ä“
(
dœ
);

1058 
dœ
 = 
NULL
;

1062  
dœ
;

1063 
	}
}

1065 
	$şo£dœ
(
DIR
 *
dœ
) {

1066 
»suÉ
 = 0;

1068 ià(
dœ
 !ğ
NULL
) {

1069 ià(
dœ
->
hªdË
 !ğ
INVALID_HANDLE_VALUE
)

1070 
»suÉ
 = 
	`FšdClo£
(
dœ
->
hªdË
) ? 0 : -1;

1072 
	`ä“
(
dœ
);

1074 
»suÉ
 = -1;

1075 
	`S‘La¡E¼Ü
(
ERROR_BAD_ARGUMENTS
);

1078  
»suÉ
;

1079 
	}
}

1081 
dœ’t
 * 
	$»addœ
(
DIR
 *
dœ
) {

1082 
dœ’t
 *
»suÉ
 = 0;

1084 ià(
dœ
) {

1085 ià(
dœ
->
hªdË
 !ğ
INVALID_HANDLE_VALUE
) {

1086 
»suÉ
 = &
dœ
->result;

1087 (è
	`WideCh¬ToMuÉiBy‹
(
CP_UTF8
, 0,

1088 
dœ
->
šfo
.
cFeName
, -1, 
»suÉ
->
d_Çme
,

1089 (
»suÉ
->
d_Çme
), 
NULL
, NULL);

1091 ià(!
	`FšdNextFeW
(
dœ
->
hªdË
, &dœ->
šfo
)) {

1092 (è
	`FšdClo£
(
dœ
->
hªdË
);

1093 
dœ
->
hªdË
 = 
INVALID_HANDLE_VALUE
;

1097 
	`S‘La¡E¼Ü
(
ERROR_FILE_NOT_FOUND
);

1100 
	`S‘La¡E¼Ü
(
ERROR_BAD_ARGUMENTS
);

1103  
»suÉ
;

1104 
	}
}

1106 
	#£t_şo£_Ú_exec
(
fd
)

1107 

	)

1108 
	$¡¬t_th»ad
(
mg_cÚ‹xt
 *
ùx
, 
mg_th»ad_func_t
 
func
,

1109 *
·¿m
) {

1110 
HANDLE
 
hTh»ad
;

1111 
ùx
 = 
NULL
;

1113 
hTh»ad
 = 
	`C»©eTh»ad
(
NULL
, 0, (
LPTHREAD_START_ROUTINE
è
func
, 
·¿m
, 0,

1114 
NULL
);

1115 ià(
hTh»ad
 !ğ
NULL
) {

1116 (è
	`Clo£HªdË
(
hTh»ad
);

1119  
hTh»ad
 =ğ
NULL
 ? -1 : 0;

1120 
	}
}

1122 
HANDLE
 
	$dlİ’
(cÚ¡ *
dÎ_Çme
, 
æags
) {

1123 
wch¬_t
 
wbuf
[
PATH_MAX
];

1124 
æags
 = 0;

1125 
	`to_unicode
(
dÎ_Çme
, 
wbuf
, 
	`ARRAY_SIZE
(wbuf));

1126  
	`LßdLib¿ryW
(
wbuf
);

1127 
	}
}

1129 #ià!
defšed
(
NO_CGI
)

1130 
	#SIGKILL
 0

	)

1131 
	$kl
(
pid_t
 
pid
, 
sig_num
) {

1132 (è
	`T”mš©eProûss
(
pid
, 
sig_num
);

1133 (è
	`Clo£HªdË
(
pid
);

1135 
	}
}

1137 
pid_t
 
	$¥awn_´oûss
(
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
´og
,

1138 *
’vblk
, *
’vp
[], 
fd_¡dš
,

1139 
fd_¡dout
, cÚ¡ *
dœ
) {

1140 
HANDLE
 
me
;

1141 *
p
, *
š‹½
, 
cmdlše
[
PATH_MAX
], 
buf
[PATH_MAX];

1142 
FILE
 *
å
;

1143 
STARTUPINFOA
 
si
;

1144 
PROCESS_INFORMATION
 
pi
;

1146 
’vp
 = 
NULL
;

1148 (è
	`mem£t
(&
si
, 0, (si));

1149 (è
	`mem£t
(&
pi
, 0, (pi));

1152 
si
.
cb
 = (si);

1153 
si
.
dwFÏgs
 = 
STARTF_USESTDHANDLES
 | 
STARTF_USESHOWWINDOW
;

1154 
si
.
wShowWšdow
 = 
SW_HIDE
;

1156 
me
 = 
	`G‘Cu¼’tProûss
();

1157 (è
	`Du¶iÿ‹HªdË
(
me
, (
HANDLE
è
	`_g‘_osfhªdË
(
fd_¡dš
), me,

1158 &
si
.
hStdIÅut
, 0, 
TRUE
, 
DUPLICATE_SAME_ACCESS
);

1159 (è
	`Du¶iÿ‹HªdË
(
me
, (
HANDLE
è
	`_g‘_osfhªdË
(
fd_¡dout
), me,

1160 &
si
.
hStdOuut
, 0, 
TRUE
, 
DUPLICATE_SAME_ACCESS
);

1163 
š‹½
 = 
cÚn
->
ùx
->
cÚfig
[
CGI_INTERPRETER
];

1164 ià(
š‹½
 =ğ
NULL
) {

1165 
buf
[2] = '\0';

1166 ià((
å
 = 
	`fİ’
(
cmdlše
, "r")è!ğ
NULL
) {

1167 (è
	`fg‘s
(
buf
, (buf), 
å
);

1168 ià(
buf
[0] != '#' || buf[1] != '!') {

1170 
buf
[2] = '\0';

1173 
p
 = &
buf
[
	`¡¾’
(bufè- 1];… > buà&& 
	`is¥aû
(*p);…--) {

1174 *
p
 = '\0';

1177 (è
	`fşo£
(
å
);

1179 
š‹½
 = 
buf
 + 2;

1182 (è
	`mg_¢´štf
(
cÚn
, 
cmdlše
, (cmdline), "%s%s%s%c%s",

1183 
š‹½
, iÁ”p[0] =ğ'\0' ? "" : " ", 
dœ
, 
DIRSEP
, 
´og
);

1185 
	`DEBUG_TRACE
(("RuÂšg [%s]", 
cmdlše
));

1186 ià(
	`C»©eProûssA
(
NULL
, 
cmdlše
, NULL, NULL, 
TRUE
,

1187 
CREATE_NEW_PROCESS_GROUP
, 
’vblk
, 
dœ
, &
si
, &
pi
) == 0) {

1188 
	`üy
(
cÚn
, "%s: CreateProcess(%s): %d",

1189 
__func__
, 
cmdlše
, 
ERRNO
);

1190 
pi
.
hProûss
 = (
pid_t
) -1;

1192 (è
	`şo£
(
fd_¡dš
);

1193 (è
	`şo£
(
fd_¡dout
);

1196 (è
	`Clo£HªdË
(
si
.
hStdOuut
);

1197 (è
	`Clo£HªdË
(
si
.
hStdIÅut
);

1198 (è
	`Clo£HªdË
(
pi
.
hTh»ad
);

1200  (
pid_t
è
pi
.
hProûss
;

1201 
	}
}

1204 
	$£t_nÚ_blockšg_mode
(
SOCKET
 
sock
) {

1205 
Ú
 = 1;

1206  
	`ioùlsock‘
(
sock
, 
FIONBIO
, &
Ú
);

1207 
	}
}

1210 
	$mg_¡©
(cÚ¡ *
·th
, 
mg¡©
 *
¡p
) {

1211 
¡©
 
¡
;

1212 
ok
;

1214 ià(
	`¡©
(
·th
, &
¡
) == 0) {

1215 
ok
 = 0;

1216 
¡p
->
size
 = 
¡
.
¡_size
;

1217 
¡p
->
mtime
 = 
¡
.
¡_mtime
;

1218 
¡p
->
is_dœeùÜy
 = 
	`S_ISDIR
(
¡
.
¡_mode
);

1220 
ok
 = -1;

1223  
ok
;

1224 
	}
}

1226 
	$£t_şo£_Ú_exec
(
fd
) {

1227 (è
	`fú
(
fd
, 
F_SETFD
, 
FD_CLOEXEC
);

1228 
	}
}

1230 
	$¡¬t_th»ad
(
mg_cÚ‹xt
 *
ùx
, 
mg_th»ad_func_t
 
func
,

1231 *
·¿m
) {

1232 
±h»ad_t
 
th»ad_id
;

1233 
±h»ad_©Œ_t
 
©Œ
;

1234 
»tv®
;

1236 (è
	`±h»ad_©Œ_š™
(&
©Œ
);

1237 (è
	`±h»ad_©Œ_£td‘ach¡©e
(&
©Œ
, 
PTHREAD_CREATE_DETACHED
);

1241 ià((
»tv®
 = 
	`±h»ad_ü—‹
(&
th»ad_id
, &
©Œ
, 
func
, 
·¿m
)) != 0) {

1242 
	`üy
(
	`fc
(
ùx
), "%s: %s", 
__func__
, 
	`¡»¼Ü
(
»tv®
));

1245  
»tv®
;

1246 
	}
}

1248 #iâdeà
NO_CGI


1249 
pid_t
 
	$¥awn_´oûss
(
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
´og
,

1250 *
’vblk
, *
’vp
[], 
fd_¡dš
,

1251 
fd_¡dout
, cÚ¡ *
dœ
) {

1252 
pid_t
 
pid
;

1253 cÚ¡ *
š‹½
;

1255 
’vblk
 = 
NULL
;

1257 ià((
pid
 = 
	`fÜk
()) == -1) {

1259 
	`£nd_h‰p_”rÜ
(
cÚn
, 500, 
h‰p_500_”rÜ
, "fÜk(): %s", 
	`¡»¼Ü
(
ERRNO
));

1260 } ià(
pid
 == 0) {

1262 ià(
	`chdœ
(
dœ
) != 0) {

1263 
	`üy
(
cÚn
, "%s: chdœ(%s): %s", 
__func__
, 
dœ
, 
	`¡»¼Ü
(
ERRNO
));

1264 } ià(
	`dup2
(
fd_¡dš
, 0) == -1) {

1265 
	`üy
(
cÚn
, "%s: dup2(%d, 0): %s", 
__func__
, 
fd_¡dš
, 
	`¡»¼Ü
(
ERRNO
));

1266 } ià(
	`dup2
(
fd_¡dout
, 1) == -1) {

1267 
	`üy
(
cÚn
, "%s: dup2(%d, 1): %s", 
__func__
, 
fd_¡dout
, 
	`¡»¼Ü
(
ERRNO
));

1269 (è
	`dup2
(
fd_¡dout
, 2);

1270 (è
	`şo£
(
fd_¡dš
);

1271 (è
	`şo£
(
fd_¡dout
);

1274 
š‹½
 = 
cÚn
->
ùx
->
cÚfig
[
CGI_INTERPRETER
];

1275 ià(
š‹½
 =ğ
NULL
) {

1276 (è
	`exeşe
(
´og
,…rog, 
NULL
, 
’vp
);

1277 
	`üy
(
cÚn
, "%s:ƒxeşe(%s): %s", 
__func__
, 
´og
, 
	`¡»¼Ü
(
ERRNO
));

1279 (è
	`exeşe
(
š‹½
, iÁ”p, 
´og
, 
NULL
, 
’vp
);

1280 
	`üy
(
cÚn
, "%s:ƒxeşe(% %s): %s", 
__func__
, 
š‹½
, 
´og
,

1281 
	`¡»¼Ü
(
ERRNO
));

1284 
	`ex™
(
EXIT_FAILURE
);

1287 (è
	`şo£
(
fd_¡dš
);

1288 (è
	`şo£
(
fd_¡dout
);

1291  
pid
;

1292 
	}
}

1295 
	$£t_nÚ_blockšg_mode
(
SOCKET
 
sock
) {

1296 
æags
;

1298 
æags
 = 
	`fú
(
sock
, 
F_GETFL
, 0);

1299 (è
	`fú
(
sock
, 
F_SETFL
, 
æags
 | 
O_NONBLOCK
);

1302 
	}
}

1307 
št64_t
 
	$push
(
FILE
 *
å
, 
SOCKET
 
sock
, 
SSL
 *
s¦
, cÚ¡ *
buf
,

1308 
št64_t
 
Ën
) {

1309 
št64_t
 
£Á
;

1310 
n
, 
k
;

1312 
£Á
 = 0;

1313 
£Á
 < 
Ën
) {

1316 
k
 = 
Ën
 - 
£Á
 > 
INT_MAX
 ? INT_MAX : () (len - sent);

1318 ià(
s¦
 !ğ
NULL
) {

1319 
n
 = 
	`SSL_wr™e
(
s¦
, 
buf
 + 
£Á
, 
k
);

1320 } ià(
å
 !ğ
NULL
) {

1321 
n
 = (è
	`fwr™e
(
buf
 + 
£Á
, 1, (
size_t
)
k
, 
å
);

1322 ià(
	`ã¼Ü
(
å
))

1323 
n
 = -1;

1325 
n
 = (è
	`£nd
(
sock
, 
buf
 + 
£Á
, (
size_t
)
k
, 0);

1328 ià(
n
 < 0)

1331 
£Á
 +ğ
n
;

1334  
£Á
;

1335 
	}
}

1339 
	$puÎ
(
FILE
 *
å
, 
SOCKET
 
sock
, 
SSL
 *
s¦
, *
buf
, 
Ën
) {

1340 
Ä—d
;

1342 ià(
s¦
 !ğ
NULL
) {

1343 
Ä—d
 = 
	`SSL_»ad
(
s¦
, 
buf
, 
Ën
);

1344 } ià(
å
 !ğ
NULL
) {

1348 
Ä—d
 = (è
	`»ad
(
	`f’o
(
å
), 
buf
, (
size_t
è
Ën
);

1349 ià(
	`ã¼Ü
(
å
))

1350 
Ä—d
 = -1;

1352 
Ä—d
 = (è
	`»cv
(
sock
, 
buf
, (
size_t
è
Ën
, 0);

1355  
Ä—d
;

1356 
	}
}

1358 
	$mg_»ad
(
mg_cÚÃùiÚ
 *
cÚn
, *
buf
, 
size_t
 
Ën
) {

1359 
n
, 
bufã»d_Ën
, 
Ä—d
;

1360 cÚ¡ *
bufã»d
;

1362 
	`as£¹
(
cÚn
->
cÚ‹Á_Ën
 >ğcÚn->
cÚsumed_cÚ‹Á
);

1363 
	`DEBUG_TRACE
(("%°%zu %Îd %Îd", 
buf
, 
Ën
,

1364 
cÚn
->
cÚ‹Á_Ën
, cÚn->
cÚsumed_cÚ‹Á
));

1365 
Ä—d
 = 0;

1366 ià(
cÚn
->
cÚsumed_cÚ‹Á
 < cÚn->
cÚ‹Á_Ën
) {

1369 
št64_t
 
to_»ad
 = 
cÚn
->
cÚ‹Á_Ën
 - cÚn->
cÚsumed_cÚ‹Á
;

1370 ià(
to_»ad
 < (
št64_t
è
Ën
) {

1371 
Ën
 = (è
to_»ad
;

1375 
bufã»d
 = 
cÚn
->
buf
 + cÚn->
»que¡_Ën
 + cÚn->
cÚsumed_cÚ‹Á
;

1376 
bufã»d_Ën
 = 
cÚn
->
d©a_Ën
 - cÚn->
»que¡_Ën
;

1377 
	`as£¹
(
bufã»d_Ën
 >= 0);

1380 ià(
cÚn
->
cÚsumed_cÚ‹Á
 < (
št64_t
è
bufã»d_Ën
) {

1381 
bufã»d_Ën
 -ğ(è
cÚn
->
cÚsumed_cÚ‹Á
;

1382 ià(
Ën
 < (
size_t
è
bufã»d_Ën
) {

1383 
bufã»d_Ën
 = (è
Ën
;

1385 
	`memıy
(
buf
, 
bufã»d
, (
size_t
)
bufã»d_Ën
);

1386 
Ën
 -ğ
bufã»d_Ën
;

1387 
buf
 = (*èbuà+ 
bufã»d_Ën
;

1388 
cÚn
->
cÚsumed_cÚ‹Á
 +ğ
bufã»d_Ën
;

1389 
Ä—d
 = 
bufã»d_Ën
;

1393 
Ën
 > 0) {

1394 
n
 = 
	`puÎ
(
NULL
, 
cÚn
->
ş›Á
.
sock
, cÚn->
s¦
, (*è
buf
, (è
Ën
);

1395 ià(
n
 <= 0) {

1398 
buf
 = (*èbuà+ 
n
;

1399 
cÚn
->
cÚsumed_cÚ‹Á
 +ğ
n
;

1400 
Ä—d
 +ğ
n
;

1401 
Ën
 -ğ
n
;

1404  
Ä—d
;

1405 
	}
}

1407 
	$mg_wr™e
(
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
buf
, 
size_t
 
Ën
) {

1408  (è
	`push
(
NULL
, 
cÚn
->
ş›Á
.
sock
, cÚn->
s¦
,

1409 (cÚ¡ *è
buf
, (
št64_t
è
Ën
);

1410 
	}
}

1412 
	$mg_´štf
(
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
fmt
, ...) {

1413 
buf
[
BUFSIZ
];

1414 
Ën
;

1415 
va_li¡
 
­
;

1417 
	`va_¡¬t
(
­
, 
fmt
);

1418 
Ën
 = 
	`mg_v¢´štf
(
cÚn
, 
buf
, (buf), 
fmt
, 
­
);

1419 
	`va_’d
(
­
);

1421  
	`mg_wr™e
(
cÚn
, 
buf
, (
size_t
)
Ën
);

1422 
	}
}

1429 
size_t
 
	$u¾_decode
(cÚ¡ *
¤c
, 
size_t
 
¤c_Ën
, *
d¡
,

1430 
size_t
 
d¡_Ën
, 
is_fÜm_u¾_’coded
) {

1431 
size_t
 
i
, 
j
;

1432 
a
, 
b
;

1433 
	#HEXTOI
(
x
è(
	`isdig™
(xè? x - '0' : x - 'W')

	)

1435 
i
 = 
j
 = 0; i < 
¤c_Ën
 && j < 
d¡_Ën
 - 1; i++, j++) {

1436 ià(
¤c
[
i
] == '%' &&

1437 
	`isxdig™
(* (cÚ¡ *è(
¤c
 + 
i
 + 1)) &&

1438 
	`isxdig™
(* (cÚ¡ *è(
¤c
 + 
i
 + 2))) {

1439 
a
 = 
	`tŞow”
(* (cÚ¡ *è(
¤c
 + 
i
 + 1));

1440 
b
 = 
	`tŞow”
(* (cÚ¡ *è(
¤c
 + 
i
 + 2));

1441 
d¡
[
j
] = (è((
	`HEXTOI
(
a
è<< 4è| HEXTOI(
b
));

1442 
i
 += 2;

1443 } ià(
is_fÜm_u¾_’coded
 && 
¤c
[
i
] == '+') {

1444 
d¡
[
j
] = ' ';

1446 
d¡
[
j
] = 
¤c
[
i
];

1450 
d¡
[
j
] = '\0';

1452  
j
;

1453 
	}
}

1459 
	$mg_g‘_v¬
(cÚ¡ *
buf
, 
size_t
 
buf_Ën
, cÚ¡ *
Çme
,

1460 *
d¡
, 
size_t
 
d¡_Ën
) {

1461 cÚ¡ *
p
, *
e
, *
s
;

1462 
size_t
 
Çme_Ën
, 
Ën
;

1464 
Çme_Ën
 = 
	`¡¾’
(
Çme
);

1465 
e
 = 
buf
 + 
buf_Ën
;

1466 
Ën
 = -1;

1467 
d¡
[0] = '\0';

1470 
p
 = 
buf
;… !ğ
NULL
 &&… + 
Çme_Ën
 < 
e
;…++) {

1471 ià((
p
 =ğ
buf
 ||…[-1] =ğ'&'è&&…[
Çme_Ën
] == '=' &&

1472 !
	`mg_¡ºÿ£cmp
(
Çme
, 
p
, 
Çme_Ën
)) {

1475 
p
 +ğ
Çme_Ën
 + 1;

1478 
s
 = (cÚ¡ *è
	`memchr
(
p
, '&', (
size_t
)(
e
 -…));

1479 ià(
s
 =ğ
NULL
) {

1480 
s
 = 
e
;

1482 
	`as£¹
(
s
 >ğ
p
);

1485 ià((
size_t
è(
s
 - 
p
è< 
d¡_Ën
) {

1486 
Ën
 = 
	`u¾_decode
(
p
, (
size_t
)(
s
 -…), 
d¡
, 
d¡_Ën
, 1);

1492  (è
Ën
;

1493 
	}
}

1495 
	$mg_g‘_cook›
(cÚ¡ 
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
cook›_Çme
,

1496 *
d¡
, 
size_t
 
d¡_size
) {

1497 cÚ¡ *
s
, *
p
, *
’d
;

1498 
Çme_Ën
, 
Ën
 = -1;

1500 
d¡
[0] = '\0';

1501 ià((
s
 = 
	`mg_g‘_h—d”
(
cÚn
, "Cook›")è=ğ
NULL
) {

1505 
Çme_Ën
 = (è
	`¡¾’
(
cook›_Çme
);

1506 
’d
 = 
s
 + 
	`¡¾’
(s);

1508 ; (
s
 = 
	`¡r¡r
(s, 
cook›_Çme
)è!ğ
NULL
; s +ğ
Çme_Ën
)

1509 ià(
s
[
Çme_Ën
] == '=') {

1510 
s
 +ğ
Çme_Ën
 + 1;

1511 ià((
p
 = 
	`¡rchr
(
s
, ' ')è=ğ
NULL
)

1512 
p
 = 
’d
;

1513 ià(
p
[-1] == ';')

1514 
p
--;

1515 ià(*
s
 =ğ'"' && 
p
[-1] == '"' &&… > s + 1) {

1516 
s
++;

1517 
p
--;

1519 ià((
size_t
è(
p
 - 
s
è< 
d¡_size
) {

1520 
Ën
 = (è((
p
 - 
s
) + 1);

1521 
	`mg_¡¾ıy
(
d¡
, 
s
, (
size_t
)
Ën
);

1526  
Ën
;

1527 
	}
}

1532 
	$g‘_docum’t_roÙ
(cÚ¡ 
mg_cÚÃùiÚ
 *
cÚn
,

1533 
vec
 *
docum’t_roÙ
) {

1534 cÚ¡ *
roÙ
, *
uri
;

1535 
Ën_of_m©ched_uri
;

1536 
vec
 
uri_vec
, 
·th_vec
;

1538 
uri
 = 
cÚn
->
»que¡_šfo
.uri;

1539 
Ën_of_m©ched_uri
 = 0;

1540 
roÙ
 = 
	`Ãxt_İtiÚ
(
cÚn
->
ùx
->
cÚfig
[
DOCUMENT_ROOT
], 
docum’t_roÙ
, 
NULL
);

1542 (
roÙ
 = 
	`Ãxt_İtiÚ
ÔoÙ, &
uri_vec
, &
·th_vec
)è!ğ
NULL
) {

1543 ià(
	`memcmp
(
uri
, 
uri_vec
.
±r
, uri_vec.
Ën
) == 0) {

1544 *
docum’t_roÙ
 = 
·th_vec
;

1545 
Ën_of_m©ched_uri
 = (è
uri_vec
.
Ën
;

1550  
Ën_of_m©ched_uri
;

1551 
	}
}

1553 
	$cÚv”t_uri_to_fe_Çme
(
mg_cÚÃùiÚ
 *
cÚn
,

1554 cÚ¡ *
uri
, *
buf
,

1555 
size_t
 
buf_Ën
) {

1556 
vec
 vec;

1557 
m©ch_Ën
;

1559 
m©ch_Ën
 = 
	`g‘_docum’t_roÙ
(
cÚn
, &
vec
);

1560 
	`mg_¢´štf
(
cÚn
, 
buf
, 
buf_Ën
, "%.*s%s", 
vec
.
Ën
, vec.
±r
, 
uri
 + 
m©ch_Ën
);

1562 #ifdeà
_WIN32


1563 
	`chªge_¦ashes_to_back¦ashes
(
buf
);

1566 
	`DEBUG_TRACE
(("[%s] -> [%s], [%.*s]", 
uri
, 
buf
, (è
vec
.
Ën
, vec.
±r
));

1567 
	}
}

1569 
s¦ize
(
mg_cÚÃùiÚ
 *
cÚn
, (*
func
)(
SSL
 *)) {

1570  (
cÚn
->
s¦
 = 
	`SSL_Ãw
(cÚn->
ùx
->
s¦_ùx
)è!ğ
NULL
 &&

1571 
	`SSL_£t_fd
(
cÚn
->
s¦
, cÚn->
ş›Á
.
sock
) == 1 &&

1572 
	`func
(
cÚn
->
s¦
) == 1;

1573 
	}
}

1575 
mg_cÚÃùiÚ
 *
	$mg_cÚÃù
(
mg_cÚÃùiÚ
 *
cÚn
,

1576 cÚ¡ *
ho¡
, 
pÜt
, 
u£_s¦
) {

1577 
mg_cÚÃùiÚ
 *
ÃwcÚn
 = 
NULL
;

1578 
sockaddr_š
 
sš
;

1579 
ho¡’t
 *
he
;

1580 
sock
;

1582 ià(
cÚn
->
ùx
->
s¦_ùx
 =ğ
NULL
 && 
u£_s¦
) {

1583 
	`üy
(
cÚn
, "%s: SSL i nÙ in™Ÿlized", 
__func__
);

1584 } ià((
he
 = 
	`g‘ho¡byÇme
(
ho¡
)è=ğ
NULL
) {

1585 
	`üy
(
cÚn
, "%s: g‘ho¡byÇme(%s): %s", 
__func__
, 
ho¡
, 
	`¡»¼Ü
(
ERRNO
));

1586 } ià((
sock
 = 
	`sock‘
(
PF_INET
, 
SOCK_STREAM
, 0)è=ğ
INVALID_SOCKET
) {

1587 
	`üy
(
cÚn
, "%s: sock‘: %s", 
__func__
, 
	`¡»¼Ü
(
ERRNO
));

1589 
sš
.
sš_çmy
 = 
AF_INET
;

1590 
sš
.
sš_pÜt
 = 
	`htÚs
((
ušt16_t
è
pÜt
);

1591 
sš
.
sš_addr
 = * (
š_addr
 *è
he
->
h_addr_li¡
[0];

1592 ià(
	`cÚÃù
(
sock
, (
sockaddr
 *è&
sš
, (sin)) != 0) {

1593 
	`üy
(
cÚn
, "%s: cÚÃù(%s:%d): %s", 
__func__
, 
ho¡
, 
pÜt
,

1594 
	`¡»¼Ü
(
ERRNO
));

1595 
	`şo£sock‘
(
sock
);

1596 } ià((
ÃwcÚn
 = (
mg_cÚÃùiÚ
*è
	`ÿÎoc
(1, (*ÃwcÚn))è=ğ
NULL
) {

1597 
	`üy
(
cÚn
, "%s: c®loc: %s", 
__func__
, 
	`¡»¼Ü
(
ERRNO
));

1598 
	`şo£sock‘
(
sock
);

1600 
ÃwcÚn
->
ş›Á
.
sock
 = sock;

1601 
ÃwcÚn
->
ş›Á
.
r§
.
u
.
sš
 = sin;

1602 ià(
u£_s¦
) {

1603 
	`s¦ize
(
ÃwcÚn
, 
SSL_cÚÃù
);

1608  
ÃwcÚn
;

1609 
	}
}

1615 
	$g‘_»que¡_Ën
(cÚ¡ *
buf
, 
buæ’
) {

1616 cÚ¡ *
s
, *
e
;

1617 
Ën
 = 0;

1619 
	`DEBUG_TRACE
(("buf: %p,†’: %d", 
buf
, 
buæ’
));

1620 
s
 = 
buf
, 
e
 = s + 
buæ’
 - 1; 
Ën
 <= 0 && s <ƒ; s++)

1622 ià(!
	`i¥ršt
(* (cÚ¡ *è
s
) && *s != '\r' &&

1623 *
s
 != '\n' && * (const *) s < 128) {

1624 
Ën
 = -1;

1625 } ià(
s
[0] == '\n' && s[1] == '\n') {

1626 
Ën
 = (è(
s
 - 
buf
) + 2;

1627 } ià(
s
[0] =ğ'\n' && &s[1] < 
e
 &&

1628 
s
[1] == '\r' && s[2] == '\n') {

1629 
Ën
 = (è(
s
 - 
buf
) + 3;

1632  
Ën
;

1633 
	}
}

1636 
	$mÚth_numb”_to_mÚth_Çme
(cÚ¡ *
s
) {

1637 
size_t
 
i
;

1639 
i
 = 0; i < 
	`ARRAY_SIZE
(
mÚth_Çmes
); i++)

1640 ià(!
	`¡rcmp
(
s
, 
mÚth_Çmes
[
i
]))

1641  (è
i
;

1644 
	}
}

1647 
time_t
 
	$·r£_d©e_¡ršg
(cÚ¡ *
s
) {

1648 
time_t
 
cu¼’t_time
;

1649 
tm
m, *
tmp
;

1650 
mÚ
[32];

1651 
£c
, 
mš
, 
hour
, 
mday
, 
mÚth
, 
y—r
;

1653 (è
	`mem£t
(&
tm
, 0, (tm));

1654 
£c
 = 
mš
 = 
hour
 = 
mday
 = 
mÚth
 = 
y—r
 = 0;

1656 ià(((
	`ssÿnf
(
s
, "%d/%3s/%d %d:%d:%d",

1657 &
mday
, 
mÚ
, &
y—r
, &
hour
, &
mš
, &
£c
) == 6) ||

1658 (
	`ssÿnf
(
s
, "%d %3s %d %d:%d:%d",

1659 &
mday
, 
mÚ
, &
y—r
, &
hour
, &
mš
, &
£c
) == 6) ||

1660 (
	`ssÿnf
(
s
, "%*3s, %d %3s %d %d:%d:%d",

1661 &
mday
, 
mÚ
, &
y—r
, &
hour
, &
mš
, &
£c
) == 6) ||

1662 (
	`ssÿnf
(
s
, "%d-%3s-%d %d:%d:%d",

1663 &
mday
, 
mÚ
, &
y—r
, &
hour
, &
mš
, &
£c
) == 6)) &&

1664 (
mÚth
 = 
	`mÚth_numb”_to_mÚth_Çme
(
mÚ
)) != -1) {

1665 
tm
.
tm_mday
 = 
mday
;

1666 
tm
.
tm_mÚ
 = 
mÚth
;

1667 
tm
.
tm_y—r
 = 
y—r
;

1668 
tm
.
tm_hour
 = 
hour
;

1669 
tm
.
tm_mš
 = 
mš
;

1670 
tm
.
tm_£c
 = 
£c
;

1673 ià(
tm
.
tm_y—r
 > 1900) {

1674 
tm
.
tm_y—r
 -= 1900;

1675 } ià(
tm
.
tm_y—r
 < 70) {

1676 
tm
.
tm_y—r
 += 100;

1680 
cu¼’t_time
 = 
	`time
(
NULL
);

1681 
tmp
 = 
	`loÿÉime
(&
cu¼’t_time
);

1682 
tm
.
tm_isd¡
 = 
tmp
->tm_isdst;

1684  
	`mktime
(&
tm
);

1685 
	}
}

1689 
	$»move_doubË_dÙs_ªd_doubË_¦ashes
(*
s
) {

1690 *
p
 = 
s
;

1692 *
s
 != '\0') {

1693 *
p
++ = *
s
++;

1694 ià(
s
[-1] == '/' || s[-1] == '\\') {

1696 *
s
 == '/' || *s == '\\') {

1697 
s
++;

1701 *
s
 == '.' && s[1] == '.') {

1702 
s
 += 2;

1706 *
p
 = '\0';

1707 
	}
}

1710 cÚ¡ *
	mex‹nsiÚ
;

1711 
size_t
 
	mext_Ën
;

1712 cÚ¡ *
	mmime_ty³
;

1713 
size_t
 
	mmime_ty³_Ën
;

1714 } 
	gbutš_mime_ty³s
[] = {

1753 {
NULL
, 0, NULL, 0}

1758 
	$g‘_mime_ty³
(
mg_cÚ‹xt
 *
ùx
, cÚ¡ *
·th
,

1759 
vec
 *vec) {

1760 
vec
 
ext_vec
, 
mime_vec
;

1761 cÚ¡ *
li¡
, *
ext
;

1762 
size_t
 
i
, 
·th_Ën
;

1764 
·th_Ën
 = 
	`¡¾’
(
·th
);

1768 
li¡
 = 
ùx
->
cÚfig
[
EXTRA_MIME_TYPES
];

1769 (
li¡
 = 
	`Ãxt_İtiÚ
Öi¡, &
ext_vec
, &
mime_vec
)è!ğ
NULL
) {

1771 
ext
 = 
·th
 + 
·th_Ën
 - 
ext_vec
.
Ën
;

1772 ià(
	`mg_¡ºÿ£cmp
(
ext
, 
ext_vec
.
±r
,ƒxt_vec.
Ën
) == 0) {

1773 *
vec
 = 
mime_vec
;

1779 
i
 = 0; 
butš_mime_ty³s
[i].
ex‹nsiÚ
 !ğ
NULL
; i++) {

1780 
ext
 = 
·th
 + (
·th_Ën
 - 
butš_mime_ty³s
[
i
].
ext_Ën
);

1781 ià(
·th_Ën
 > 
butš_mime_ty³s
[
i
].
ext_Ën
 &&

1782 
	`mg_¡rÿ£cmp
(
ext
, 
butš_mime_ty³s
[
i
].
ex‹nsiÚ
) == 0) {

1783 
vec
->
±r
 = 
butš_mime_ty³s
[
i
].
mime_ty³
;

1784 
vec
->
Ën
 = 
butš_mime_ty³s
[
i
].
mime_ty³_Ën
;

1790 
vec
->
±r
 = "text/plain";

1791 
vec
->
Ën
 = 10;

1792 
	}
}

1794 #iâdeà
HAVE_MD5


1795 
	sMD5CÚ‹xt
 {

1796 
ušt32_t
 
	mbuf
[4];

1797 
ušt32_t
 
	mb™s
[2];

1798 
	mš
[64];

1799 } 
	tMD5_CTX
;

1801 #ià
defšed
(
__BYTE_ORDER
) && (__BYTE_ORDER == 1234)

1802 
	#by‹Rev”£
(
buf
, 
Ën
)

1803 #–£

	)

1804 
	$by‹Rev”£
(*
buf
, 
lÚgs
) {

1805 
ušt32_t
 
t
;

1807 
t
 = (
ušt32_t
è((è
buf
[3] << 8 | buf[2]) << 16 |

1808 ((è
buf
[1] << 8 | buf[0]);

1809 *(
ušt32_t
 *è
buf
 = 
t
;

1810 
buf
 += 4;

1811 } --
lÚgs
);

1812 
	}
}

1815 
	#F1
(
x
, 
y
, 
z
è(z ^ (x & (y ^ z)))

	)

1816 
	#F2
(
x
, 
y
, 
z
è
	`F1
(z, x, y)

	)

1817 
	#F3
(
x
, 
y
, 
z
è(x ^ y ^ z)

	)

1818 
	#F4
(
x
, 
y
, 
z
è(y ^ (x | ~z))

	)

1820 
	#MD5STEP
(
f
, 
w
, 
x
, 
y
, 
z
, 
d©a
, 
s
è\

	)

1821 Ğ
	gw
 +ğ
f
(
x
, 
y
, 
z
è+ 
	gd©a
, w = 
w
<<
s
 | w>>(32-s), w += x )

1825 
	$MD5In™
(
MD5_CTX
 *
ùx
) {

1826 
ùx
->
buf
[0] = 0x67452301;

1827 
ùx
->
buf
[1] = 0xefcdab89;

1828 
ùx
->
buf
[2] = 0x98badcfe;

1829 
ùx
->
buf
[3] = 0x10325476;

1831 
ùx
->
b™s
[0] = 0;

1832 
ùx
->
b™s
[1] = 0;

1833 
	}
}

1835 
	$MD5T¿nsfÜm
(
ušt32_t
 
buf
[4], ušt32_ˆcÚ¡ 
š
[16]) {

1836 
ušt32_t
 
a
, 
b
, 
c
, 
d
;

1838 
a
 = 
buf
[0];

1839 
b
 = 
buf
[1];

1840 
c
 = 
buf
[2];

1841 
d
 = 
buf
[3];

1843 
	`MD5STEP
(
F1
, 
a
, 
b
, 
c
, 
d
, 
š
[0] + 0xd76aa478, 7);

1844 
	`MD5STEP
(
F1
, 
d
, 
a
, 
b
, 
c
, 
š
[1] + 0xe8c7b756, 12);

1845 
	`MD5STEP
(
F1
, 
c
, 
d
, 
a
, 
b
, 
š
[2] + 0x242070db, 17);

1846 
	`MD5STEP
(
F1
, 
b
, 
c
, 
d
, 
a
, 
š
[3] + 0xc1bdceee, 22);

1847 
	`MD5STEP
(
F1
, 
a
, 
b
, 
c
, 
d
, 
š
[4] + 0xf57c0faf, 7);

1848 
	`MD5STEP
(
F1
, 
d
, 
a
, 
b
, 
c
, 
š
[5] + 0x4787c62a, 12);

1849 
	`MD5STEP
(
F1
, 
c
, 
d
, 
a
, 
b
, 
š
[6] + 0xa8304613, 17);

1850 
	`MD5STEP
(
F1
, 
b
, 
c
, 
d
, 
a
, 
š
[7] + 0xfd469501, 22);

1851 
	`MD5STEP
(
F1
, 
a
, 
b
, 
c
, 
d
, 
š
[8] + 0x698098d8, 7);

1852 
	`MD5STEP
(
F1
, 
d
, 
a
, 
b
, 
c
, 
š
[9] + 0x8b44f7af, 12);

1853 
	`MD5STEP
(
F1
, 
c
, 
d
, 
a
, 
b
, 
š
[10] + 0xffff5bb1, 17);

1854 
	`MD5STEP
(
F1
, 
b
, 
c
, 
d
, 
a
, 
š
[11] + 0x895cd7be, 22);

1855 
	`MD5STEP
(
F1
, 
a
, 
b
, 
c
, 
d
, 
š
[12] + 0x6b901122, 7);

1856 
	`MD5STEP
(
F1
, 
d
, 
a
, 
b
, 
c
, 
š
[13] + 0xfd987193, 12);

1857 
	`MD5STEP
(
F1
, 
c
, 
d
, 
a
, 
b
, 
š
[14] + 0xa679438e, 17);

1858 
	`MD5STEP
(
F1
, 
b
, 
c
, 
d
, 
a
, 
š
[15] + 0x49b40821, 22);

1860 
	`MD5STEP
(
F2
, 
a
, 
b
, 
c
, 
d
, 
š
[1] + 0xf61e2562, 5);

1861 
	`MD5STEP
(
F2
, 
d
, 
a
, 
b
, 
c
, 
š
[6] + 0xc040b340, 9);

1862 
	`MD5STEP
(
F2
, 
c
, 
d
, 
a
, 
b
, 
š
[11] + 0x265e5a51, 14);

1863 
	`MD5STEP
(
F2
, 
b
, 
c
, 
d
, 
a
, 
š
[0] + 0xe9b6c7aa, 20);

1864 
	`MD5STEP
(
F2
, 
a
, 
b
, 
c
, 
d
, 
š
[5] + 0xd62f105d, 5);

1865 
	`MD5STEP
(
F2
, 
d
, 
a
, 
b
, 
c
, 
š
[10] + 0x02441453, 9);

1866 
	`MD5STEP
(
F2
, 
c
, 
d
, 
a
, 
b
, 
š
[15] + 0xd8a1e681, 14);

1867 
	`MD5STEP
(
F2
, 
b
, 
c
, 
d
, 
a
, 
š
[4] + 0xe7d3fbc8, 20);

1868 
	`MD5STEP
(
F2
, 
a
, 
b
, 
c
, 
d
, 
š
[9] + 0x21e1cde6, 5);

1869 
	`MD5STEP
(
F2
, 
d
, 
a
, 
b
, 
c
, 
š
[14] + 0xc33707d6, 9);

1870 
	`MD5STEP
(
F2
, 
c
, 
d
, 
a
, 
b
, 
š
[3] + 0xf4d50d87, 14);

1871 
	`MD5STEP
(
F2
, 
b
, 
c
, 
d
, 
a
, 
š
[8] + 0x455a14ed, 20);

1872 
	`MD5STEP
(
F2
, 
a
, 
b
, 
c
, 
d
, 
š
[13] + 0xa9e3e905, 5);

1873 
	`MD5STEP
(
F2
, 
d
, 
a
, 
b
, 
c
, 
š
[2] + 0xfcefa3f8, 9);

1874 
	`MD5STEP
(
F2
, 
c
, 
d
, 
a
, 
b
, 
š
[7] + 0x676f02d9, 14);

1875 
	`MD5STEP
(
F2
, 
b
, 
c
, 
d
, 
a
, 
š
[12] + 0x8d2a4c8a, 20);

1877 
	`MD5STEP
(
F3
, 
a
, 
b
, 
c
, 
d
, 
š
[5] + 0xfffa3942, 4);

1878 
	`MD5STEP
(
F3
, 
d
, 
a
, 
b
, 
c
, 
š
[8] + 0x8771f681, 11);

1879 
	`MD5STEP
(
F3
, 
c
, 
d
, 
a
, 
b
, 
š
[11] + 0x6d9d6122, 16);

1880 
	`MD5STEP
(
F3
, 
b
, 
c
, 
d
, 
a
, 
š
[14] + 0xfde5380c, 23);

1881 
	`MD5STEP
(
F3
, 
a
, 
b
, 
c
, 
d
, 
š
[1] + 0xa4beea44, 4);

1882 
	`MD5STEP
(
F3
, 
d
, 
a
, 
b
, 
c
, 
š
[4] + 0x4bdecfa9, 11);

1883 
	`MD5STEP
(
F3
, 
c
, 
d
, 
a
, 
b
, 
š
[7] + 0xf6bb4b60, 16);

1884 
	`MD5STEP
(
F3
, 
b
, 
c
, 
d
, 
a
, 
š
[10] + 0xbebfbc70, 23);

1885 
	`MD5STEP
(
F3
, 
a
, 
b
, 
c
, 
d
, 
š
[13] + 0x289b7ec6, 4);

1886 
	`MD5STEP
(
F3
, 
d
, 
a
, 
b
, 
c
, 
š
[0] + 0xeaa127fa, 11);

1887 
	`MD5STEP
(
F3
, 
c
, 
d
, 
a
, 
b
, 
š
[3] + 0xd4ef3085, 16);

1888 
	`MD5STEP
(
F3
, 
b
, 
c
, 
d
, 
a
, 
š
[6] + 0x04881d05, 23);

1889 
	`MD5STEP
(
F3
, 
a
, 
b
, 
c
, 
d
, 
š
[9] + 0xd9d4d039, 4);

1890 
	`MD5STEP
(
F3
, 
d
, 
a
, 
b
, 
c
, 
š
[12] + 0xe6db99e5, 11);

1891 
	`MD5STEP
(
F3
, 
c
, 
d
, 
a
, 
b
, 
š
[15] + 0x1fa27cf8, 16);

1892 
	`MD5STEP
(
F3
, 
b
, 
c
, 
d
, 
a
, 
š
[2] + 0xc4ac5665, 23);

1894 
	`MD5STEP
(
F4
, 
a
, 
b
, 
c
, 
d
, 
š
[0] + 0xf4292244, 6);

1895 
	`MD5STEP
(
F4
, 
d
, 
a
, 
b
, 
c
, 
š
[7] + 0x432aff97, 10);

1896 
	`MD5STEP
(
F4
, 
c
, 
d
, 
a
, 
b
, 
š
[14] + 0xab9423a7, 15);

1897 
	`MD5STEP
(
F4
, 
b
, 
c
, 
d
, 
a
, 
š
[5] + 0xfc93a039, 21);

1898 
	`MD5STEP
(
F4
, 
a
, 
b
, 
c
, 
d
, 
š
[12] + 0x655b59c3, 6);

1899 
	`MD5STEP
(
F4
, 
d
, 
a
, 
b
, 
c
, 
š
[3] + 0x8f0ccc92, 10);

1900 
	`MD5STEP
(
F4
, 
c
, 
d
, 
a
, 
b
, 
š
[10] + 0xffeff47d, 15);

1901 
	`MD5STEP
(
F4
, 
b
, 
c
, 
d
, 
a
, 
š
[1] + 0x85845dd1, 21);

1902 
	`MD5STEP
(
F4
, 
a
, 
b
, 
c
, 
d
, 
š
[8] + 0x6fa87e4f, 6);

1903 
	`MD5STEP
(
F4
, 
d
, 
a
, 
b
, 
c
, 
š
[15] + 0xfe2ce6e0, 10);

1904 
	`MD5STEP
(
F4
, 
c
, 
d
, 
a
, 
b
, 
š
[6] + 0xa3014314, 15);

1905 
	`MD5STEP
(
F4
, 
b
, 
c
, 
d
, 
a
, 
š
[13] + 0x4e0811a1, 21);

1906 
	`MD5STEP
(
F4
, 
a
, 
b
, 
c
, 
d
, 
š
[4] + 0xf7537e82, 6);

1907 
	`MD5STEP
(
F4
, 
d
, 
a
, 
b
, 
c
, 
š
[11] + 0xbd3af235, 10);

1908 
	`MD5STEP
(
F4
, 
c
, 
d
, 
a
, 
b
, 
š
[2] + 0x2ad7d2bb, 15);

1909 
	`MD5STEP
(
F4
, 
b
, 
c
, 
d
, 
a
, 
š
[9] + 0xeb86d391, 21);

1911 
buf
[0] +ğ
a
;

1912 
buf
[1] +ğ
b
;

1913 
buf
[2] +ğ
c
;

1914 
buf
[3] +ğ
d
;

1915 
	}
}

1917 
	$MD5Upd©e
(
MD5_CTX
 *
ùx
, cÚ¡ *
buf
, 
Ën
) {

1918 
ušt32_t
 
t
;

1920 
t
 = 
ùx
->
b™s
[0];

1921 ià((
ùx
->
b™s
[0] = 
t
 + ((
ušt32_t
è
Ën
 << 3)) <)

1922 
ùx
->
b™s
[1]++;

1923 
ùx
->
b™s
[1] +ğ
Ën
 >> 29;

1925 
t
 = (t >> 3) & 0x3f;

1927 ià(
t
) {

1928 *
p
 = (*è
ùx
->
š
 + 
t
;

1930 
t
 = 64 -;

1931 ià(
Ën
 < 
t
) {

1932 
	`memıy
(
p
, 
buf
, 
Ën
);

1935 
	`memıy
(
p
, 
buf
, 
t
);

1936 
	`by‹Rev”£
(
ùx
->
š
, 16);

1937 
	`MD5T¿nsfÜm
(
ùx
->
buf
, (
ušt32_t
 *èùx->
š
);

1938 
buf
 +ğ
t
;

1939 
Ën
 -ğ
t
;

1942 
Ën
 >= 64) {

1943 
	`memıy
(
ùx
->
š
, 
buf
, 64);

1944 
	`by‹Rev”£
(
ùx
->
š
, 16);

1945 
	`MD5T¿nsfÜm
(
ùx
->
buf
, (
ušt32_t
 *èùx->
š
);

1946 
buf
 += 64;

1947 
Ën
 -= 64;

1950 
	`memıy
(
ùx
->
š
, 
buf
, 
Ën
);

1951 
	}
}

1953 
	$MD5Fš®
(
dige¡
[16], 
MD5_CTX
 *
ùx
) {

1954 
couÁ
;

1955 *
p
;

1957 
couÁ
 = (
ùx
->
b™s
[0] >> 3) & 0x3F;

1959 
p
 = 
ùx
->
š
 + 
couÁ
;

1960 *
p
++ = 0x80;

1961 
couÁ
 = 64 - 1 - count;

1962 ià(
couÁ
 < 8) {

1963 
	`mem£t
(
p
, 0, 
couÁ
);

1964 
	`by‹Rev”£
(
ùx
->
š
, 16);

1965 
	`MD5T¿nsfÜm
(
ùx
->
buf
, (
ušt32_t
 *èùx->
š
);

1966 
	`mem£t
(
ùx
->
š
, 0, 56);

1968 
	`mem£t
(
p
, 0, 
couÁ
 - 8);

1970 
	`by‹Rev”£
(
ùx
->
š
, 14);

1972 ((
ušt32_t
 *è
ùx
->
š
)[14] = ctx->
b™s
[0];

1973 ((
ušt32_t
 *è
ùx
->
š
)[15] = ctx->
b™s
[1];

1975 
	`MD5T¿nsfÜm
(
ùx
->
buf
, (
ušt32_t
 *èùx->
š
);

1976 
	`by‹Rev”£
((*è
ùx
->
buf
, 4);

1977 
	`memıy
(
dige¡
, 
ùx
->
buf
, 16);

1978 
	`mem£t
((*è
ùx
, 0, (ctx));

1979 
	}
}

1984 
	$bš2¡r
(*
to
, cÚ¡ *
p
, 
size_t
 
Ën
) {

1985 cÚ¡ *
hex
 = "0123456789abcdef";

1987 ; 
Ën
--; 
p
++) {

1988 *
to
++ = 
hex
[
p
[0] >> 4];

1989 *
to
++ = 
hex
[
p
[0] & 0x0f];

1991 *
to
 = '\0';

1992 
	}
}

1995 
	$mg_md5
(*
buf
, ...) {

1996 
hash
[16];

1997 cÚ¡ *
p
;

1998 
va_li¡
 
­
;

1999 
MD5_CTX
 
ùx
;

2001 
	`MD5In™
(&
ùx
);

2003 
	`va_¡¬t
(
­
, 
buf
);

2004 (
p
 = 
	`va_¬g
(
­
, cÚ¡ *)è!ğ
NULL
) {

2005 
	`MD5Upd©e
(&
ùx
, (cÚ¡ *è
p
, (è
	`¡¾’
(p));

2007 
	`va_’d
(
­
);

2009 
	`MD5Fš®
(
hash
, &
ùx
);

2010 
	`bš2¡r
(
buf
, 
hash
, (hash));

2011 
	}
}

2014 
	$check_·sswÜd
(
mg_cÚÃùiÚ
 *
cÚn
) {

2015 
ha2
[32 + 1], 
ex³ùed_»¥Ú£
[32 + 1];

2016 
mg_auth_h—d”
 *
ah
 = 
cÚn
->
»que¡_šfo
.ah;

2019 ià(
cÚn
->
»que¡_šfo
.
»que¡_m‘hod
 =ğ
NULL
 || 
ah
 == NULL ||

2020 
ah
->
nÚû
 =ğ
NULL
 ||‡h->
nc
 == NULL ||

2021 
ah
->
úÚû
 =ğ
NULL
 ||‡h->
qİ
 =ğNULL ||‡h->
uri
 == NULL ||

2022 
ah
->
»¥Ú£
 =ğ
NULL
) {

2029 
	`¡¾’
(
ah
->
»¥Ú£
) != 32

2035 
	`mg_md5
(
ha2
, 
cÚn
->
»que¡_šfo
.
»que¡_m‘hod
, ":", 
ah
->
uri
, 
NULL
);

2036 
	`mg_md5
(
ex³ùed_»¥Ú£
, 
ah
->
ha1
, ":",‡h->
nÚû
, ":",‡h->
nc
,

2037 ":", 
ah
->
úÚû
, ":",‡h->
qİ
, ":", 
ha2
, 
NULL
);

2039  
	`mg_¡rÿ£cmp
(
ah
->
»¥Ú£
, 
ex³ùed_»¥Ú£
) == 0;

2040 
	}
}

2044 
FILE
 *
	$İ’_auth_fe
(
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
·th
) {

2045 
mg_cÚ‹xt
 *
ùx
 = 
cÚn
->ctx;

2046 
Çme
[
PATH_MAX
];

2047 cÚ¡ *
p
, *
e
;

2048 
mg¡©
 
¡
;

2049 
FILE
 *
å
;

2051 ià(
ùx
->
cÚfig
[
GLOBAL_PASSWORDS_FILE
] !ğ
NULL
) {

2053 
å
 = 
	`mg_fİ’
(
ùx
->
cÚfig
[
GLOBAL_PASSWORDS_FILE
], "r");

2054 ià(
å
 =ğ
NULL
)

2055 
	`üy
(
	`fc
(
ùx
), "fopen(%s): %s",

2056 
ùx
->
cÚfig
[
GLOBAL_PASSWORDS_FILE
], 
	`¡»¼Ü
(
ERRNO
));

2057 } ià(!
	`mg_¡©
(
·th
, &
¡
è&& st.
is_dœeùÜy
) {

2058 (è
	`mg_¢´štf
(
cÚn
, 
Çme
, (name), "%s%c%s",

2059 
·th
, 
DIRSEP
, 
PASSWORDS_FILE_NAME
);

2060 
å
 = 
	`mg_fİ’
(
Çme
, "r");

2063 
p
 = 
·th
, 
e
 =… + 
	`¡¾’
(p) - 1;ƒ >…;ƒ--)

2064 ià(
	`IS_DIRSEP_CHAR
(*
e
))

2066 (è
	`mg_¢´štf
(
cÚn
, 
Çme
, (name), "%.*s%c%s",

2067 (è(
e
 - 
p
),…, 
DIRSEP
, 
PASSWORDS_FILE_NAME
);

2068 
å
 = 
	`mg_fİ’
(
Çme
, "r");

2071  
å
;

2072 
	}
}

2074 
	$·r£_auth_h—d”
(
mg_cÚÃùiÚ
 *
cÚn
) {

2075 *
Çme
, *
v®ue
, *
s
;

2076 cÚ¡ *
auth_h—d”
;

2078 ià((
auth_h—d”
 = 
	`mg_g‘_h—d”
(
cÚn
, "AuthÜiz©iÚ")è=ğ
NULL
 ||

2079 
	`mg_¡ºÿ£cmp
(
auth_h—d”
, "Digest ", 7) != 0) {

2084 
cÚn
->
auth_h—d”
 = 
	`mg_¡rdup
(auth_header + 7);

2085 
s
 = 
cÚn
->
auth_h—d”
;

2087 
cÚn
->
»que¡_šfo
.
ah
 = (
mg_auth_h—d”
*è
	`ÿÎoc
(1, (mg_auth_header));

2092 
	`is¥aû
(* (*è
s
)) {

2093 
s
++;

2095 
Çme
 = 
	`sk_quÙed
(&
s
, "=", " ", 0);

2097 ià(
s
[0] == '\"') {

2098 
s
++;

2099 
v®ue
 = 
	`sk_quÙed
(&
s
, "\"", " ", '\\');

2100 ià(
s
[0] == ',') {

2101 
s
++;

2106 
v®ue
 = 
	`sk_quÙed
(&
s
, ", ", " ", 0);

2108 ià(*
Çme
 == '\0') {

2112 ià(!
	`¡rcmp
(
Çme
, "username")) {

2113 
cÚn
->
»que¡_šfo
.
ah
->
u£r
 = 
v®ue
;

2114 } ià(!
	`¡rcmp
(
Çme
, "cnonce")) {

2115 
cÚn
->
»que¡_šfo
.
ah
->
úÚû
 = 
v®ue
;

2116 } ià(!
	`¡rcmp
(
Çme
, "response")) {

2117 
cÚn
->
»que¡_šfo
.
ah
->
»¥Ú£
 = 
v®ue
;

2118 } ià(!
	`¡rcmp
(
Çme
, "uri")) {

2119 
cÚn
->
»que¡_šfo
.
ah
->
uri
 = 
v®ue
;

2120 } ià(!
	`¡rcmp
(
Çme
, "qop")) {

2121 
cÚn
->
»que¡_šfo
.
ah
->
qİ
 = 
v®ue
;

2122 } ià(!
	`¡rcmp
(
Çme
, "nc")) {

2123 
cÚn
->
»que¡_šfo
.
ah
->
nc
 = 
v®ue
;

2124 } ià(!
	`¡rcmp
(
Çme
, "nonce")) {

2125 
cÚn
->
»que¡_šfo
.
ah
->
nÚû
 = 
v®ue
;

2130 ià(
cÚn
->
»que¡_šfo
.
ah
->
u£r
 !ğ
NULL
) {

2131 
cÚn
->
»que¡_šfo
.
»mÙe_u£r
 = 
	`mg_¡rdup
(cÚn->»que¡_šfo.
ah
->
u£r
);

2134 
	`ä“
(
cÚn
->
»que¡_šfo
.
ah
);

2135 
cÚn
->
»que¡_šfo
.
ah
 = 
NULL
;

2136 
	`ä“
(
cÚn
->
auth_h—d”
);

2137 
cÚn
->
auth_h—d”
 = 
NULL
;

2139 
	}
}

2142 
	$authÜize_äom_fe
(
mg_cÚÃùiÚ
 *
cÚn
, 
FILE
 *
å
) {

2143 
lše
[256], 
f_u£r
[256], 
ha1
[256], 
f_domaš
[256];

2145 ià(
cÚn
->
»que¡_šfo
.
ah
 =ğ
NULL
)

2149 
	`fg‘s
(
lše
, Öše), 
å
è!ğ
NULL
) {

2150 ià(
	`ssÿnf
(
lše
, "%[^:]:%[^:]:%s", 
f_u£r
, 
f_domaš
, 
ha1
) != 3) {

2154 ià(!
	`¡rcmp
(
cÚn
->
»que¡_šfo
.
ah
->
u£r
, 
f_u£r
) &&

2155 !
	`¡rcmp
(
cÚn
->
ùx
->
cÚfig
[
AUTHENTICATION_DOMAIN
], 
f_domaš
)) {

2156 
cÚn
->
»que¡_šfo
.
ah
->
ha1
 = 
	`mg_¡rdup
(ha1);

2157  
	`check_·sswÜd
(
cÚn
);

2162 
	}
}

2165 
	$check_authÜiz©iÚ
(
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
·th
) {

2166 
FILE
 *
å
;

2167 
âame
[
PATH_MAX
];

2168 
vec
 
uri_vec
, 
f’ame_vec
;

2169 cÚ¡ *
li¡
;

2170 
authÜized
;

2173 ià(
cÚn
->
»que¡_šfo
.
ah
 !ğ
NULL
 &&

2174 
cÚn
->
»que¡_šfo
.
ah
->
ha1
 !ğ
NULL
) {

2175  
	`check_·sswÜd
(
cÚn
);

2178 
å
 = 
NULL
;

2179 
authÜized
 = 1;

2181 
li¡
 = 
cÚn
->
ùx
->
cÚfig
[
PROTECT_URI
];

2182 (
li¡
 = 
	`Ãxt_İtiÚ
Öi¡, &
uri_vec
, &
f’ame_vec
)è!ğ
NULL
) {

2183 ià(!
	`memcmp
(
cÚn
->
»que¡_šfo
.
uri
, 
uri_vec
.
±r
, uri_vec.
Ën
)) {

2184 (è
	`mg_¢´štf
(
cÚn
, 
âame
, (fname), "%.*s",

2185 
f’ame_vec
.
Ën
, f’ame_vec.
±r
);

2186 ià((
å
 = 
	`mg_fİ’
(
âame
, "r")è=ğ
NULL
) {

2187 
	`üy
(
cÚn
, "%s: cªnÙ o³À%s: %s", 
__func__
, 
âame
, 
	`¡»¼Ü
(
”ºo
));

2193 ià(
å
 =ğ
NULL
) {

2194 
å
 = 
	`İ’_auth_fe
(
cÚn
, 
·th
);

2197 ià(
å
 !ğ
NULL
) {

2198 
authÜized
 = 
	`authÜize_äom_fe
(
cÚn
, 
å
);

2199 (è
	`fşo£
(
å
);

2202  
authÜized
;

2203 
	}
}

2205 
	$mg_£nd_authÜiz©iÚ_»que¡
(
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
nÚû
) {

2206 
cÚn
->
»que¡_šfo
.
¡©us_code
 = 401;

2207 (è
	`mg_´štf
(
cÚn
,

2211 
cÚn
->
ùx
->
cÚfig
[
AUTHENTICATION_DOMAIN
]);

2212 ià(
nÚû
 =ğ
NULL
)

2213 (è
	`mg_´štf
(
cÚn
, "%lu", (è
	`time
(
NULL
));

2215 (è
	`mg_´štf
(
cÚn
, "%s", 
nÚû
);

2216 (è
	`mg_´štf
(
cÚn
, "\"\r\n\r\n");

2217 
	}
}

2219 
	$is_authÜized_fÜ_put
(
mg_cÚÃùiÚ
 *
cÚn
) {

2220 
FILE
 *
å
;

2221 
»t
 = 0;

2225 
å
 = 
cÚn
->
ùx
->
cÚfig
[
PUT_DELETE_PASSWORDS_FILE
] =ğ
NULL
 ? NULL :

2226 
	`mg_fİ’
(
cÚn
->
ùx
->
cÚfig
[
PUT_DELETE_PASSWORDS_FILE
], "r");

2228 ià(
å
 !ğ
NULL
) {

2229 
»t
 = 
	`authÜize_äom_fe
(
cÚn
, 
å
);

2230 (è
	`fşo£
(
å
);

2233  
»t
;

2234 
	}
}

2236 
	$mg_modify_·sswÜds_fe
(
mg_cÚ‹xt
 *
ùx
, cÚ¡ *
âame
,

2237 cÚ¡ *
u£r
, cÚ¡ *
·ss
) {

2238 
found
;

2239 
lše
[512], 
u
[512], 
d
[512], 
ha1
[33], 
tmp
[
PATH_MAX
];

2240 cÚ¡ *
domaš
;

2241 
FILE
 *
å
, *
å2
;

2243 
found
 = 0;

2244 
å
 = 
å2
 = 
NULL
;

2245 
domaš
 = 
ùx
->
cÚfig
[
AUTHENTICATION_DOMAIN
];

2248 ià(
·ss
[0] == '\0') {

2249 
·ss
 = 
NULL
;

2252 (è
	`¢´štf
(
tmp
, Ñmp), "%s.tmp", 
âame
);

2255 ià((
å
 = 
	`mg_fİ’
(
âame
, "a+")è!ğ
NULL
) {

2256 (è
	`fşo£
(
å
);

2260 ià((
å
 = 
	`mg_fİ’
(
âame
, "r")è=ğ
NULL
) {

2261 
	`üy
(
	`fc
(
ùx
), "CªnÙ o³À%s: %s", 
âame
, 
	`¡»¼Ü
(
”ºo
));

2263 } ià((
å2
 = 
	`mg_fİ’
(
tmp
, "w+")è=ğ
NULL
) {

2264 
	`üy
(
	`fc
(
ùx
), "CªnÙ o³À%s: %s", 
tmp
, 
	`¡»¼Ü
(
”ºo
));

2269 
	`fg‘s
(
lše
, Öše), 
å
è!ğ
NULL
) {

2270 ià(
	`ssÿnf
(
lše
, "%[^:]:%[^:]:%*s", 
u
, 
d
) != 2) {

2274 ià(!
	`¡rcmp
(
u
, 
u£r
è&& !¡rcmp(
d
, 
domaš
)) {

2275 
found
++;

2276 ià(
·ss
 !ğ
NULL
) {

2277 
	`mg_md5
(
ha1
, 
u£r
, ":", 
domaš
, ":", 
·ss
, 
NULL
);

2278 
	`årštf
(
å2
, "%s:%s:%s\n", 
u£r
, 
domaš
, 
ha1
);

2281 (è
	`årštf
(
å2
, "%s", 
lše
);

2286 ià(!
found
 && 
·ss
 !ğ
NULL
) {

2287 
	`mg_md5
(
ha1
, 
u£r
, ":", 
domaš
, ":", 
·ss
, 
NULL
);

2288 (è
	`årštf
(
å2
, "%s:%s:%s\n", 
u£r
, 
domaš
, 
ha1
);

2292 (è
	`fşo£
(
å
);

2293 (è
	`fşo£
(
å2
);

2296 (è
	`mg_»move
(
âame
);

2297 (è
	`mg_»Çme
(
tmp
, 
âame
);

2300 
	}
}

2302 
	sde
 {

2303 
mg_cÚÃùiÚ
 *
	mcÚn
;

2304 *
	mfe_Çme
;

2305 
mg¡©
 
	m¡
;

2308 
	$u¾_’code
(cÚ¡ *
¤c
, *
d¡
, 
size_t
 
d¡_Ën
) {

2309 cÚ¡ *
dÚt_esÿ³
 = "._-$,;~()";

2310 cÚ¡ *
hex
 = "0123456789abcdef";

2311 cÚ¡ *
’d
 = 
d¡
 + 
d¡_Ën
 - 1;

2313 ; *
¤c
 !ğ'\0' && 
d¡
 < 
’d
; src++, dst++) {

2314 ià(
	`i§Êum
(*(cÚ¡ *è
¤c
) ||

2315 
	`¡rchr
(
dÚt_esÿ³
, * (cÚ¡ *è
¤c
è!ğ
NULL
) {

2316 *
d¡
 = *
¤c
;

2317 } ià(
d¡
 + 2 < 
’d
) {

2318 
d¡
[0] = '%';

2319 
d¡
[1] = 
hex
[(* (cÚ¡ *è
¤c
) >> 4];

2320 
d¡
[2] = 
hex
[(* (cÚ¡ *è
¤c
) & 0xf];

2321 
d¡
 += 2;

2325 *
d¡
 = '\0';

2326 
	}
}

2328 
	$´št_dœ_’Œy
(
de
 *de) {

2329 
size
[64], 
mod
[64], 
h»f
[
PATH_MAX
];

2331 ià(
de
->
¡
.
is_dœeùÜy
) {

2332 (è
	`mg_¢´štf
(
de
->
cÚn
, 
size
, (size), "%s", "[DIRECTORY]");

2336 ià(
de
->
¡
.
size
 < 1024) {

2337 (è
	`mg_¢´štf
(
de
->
cÚn
, 
size
, (size),

2338 "%lu", (è
de
->
¡
.
size
);

2339 } ià(
de
->
¡
.
size
 < 1024 * 1024) {

2340 (è
	`mg_¢´štf
(
de
->
cÚn
, 
size
, (size),

2341 "%.1fk", (è
de
->
¡
.
size
 / 1024.0);

2342 } ià(
de
->
¡
.
size
 < 1024 * 1024 * 1024) {

2343 (è
	`mg_¢´štf
(
de
->
cÚn
, 
size
, (size),

2344 "%.1fM", (è
de
->
¡
.
size
 / 1048576);

2346 (è
	`mg_¢´štf
(
de
->
cÚn
, 
size
, (size),

2347 "%.1fG", (è
de
->
¡
.
size
 / 1073741824);

2350 (è
	`¡ráime
(
mod
, (mod), "%d-%b-%Y %H:%M", 
	`loÿÉime
(&
de
->
¡
.
mtime
));

2351 
	`u¾_’code
(
de
->
fe_Çme
, 
h»f
, (href));

2352 
de
->
cÚn
->
num_by‹s_£Á
 +ğ
	`mg_´štf
(de->conn,

2355 
de
->
cÚn
->
»que¡_šfo
.
uri
, 
h»f
, de->
¡
.
is_dœeùÜy
 ? "/" : "",

2356 
de
->
fe_Çme
, de->
¡
.
is_dœeùÜy
 ? "/" : "", 
mod
, 
size
);

2357 
	}
}

2363 
WINCDECL
 
	$com·»_dœ_’Œ›s
(cÚ¡ *
p1
, cÚ¡ *
p2
) {

2364 cÚ¡ 
de
 *
a
 = (cÚ¡ d*è
p1
, *
b
 = (cÚ¡ d*è
p2
;

2365 cÚ¡ *
qu”y_¡ršg
 = 
a
->
cÚn
->
»que¡_šfo
.query_string;

2366 
cmp_»suÉ
 = 0;

2368 ià(
qu”y_¡ršg
 =ğ
NULL
) {

2369 
qu”y_¡ršg
 = "na";

2372 ià(
a
->
¡
.
is_dœeùÜy
 && !
b
->st.is_directory) {

2374 } ià(!
a
->
¡
.
is_dœeùÜy
 && 
b
->st.is_directory) {

2376 } ià(*
qu”y_¡ršg
 == 'n') {

2377 
cmp_»suÉ
 = 
	`¡rcmp
(
a
->
fe_Çme
, 
b
->file_name);

2378 } ià(*
qu”y_¡ršg
 == 's') {

2379 
cmp_»suÉ
 = 
a
->
¡
.
size
 =ğ
b
->st.size ? 0 :

2380 
a
->
¡
.
size
 > 
b
->st.size ? 1 : -1;

2381 } ià(*
qu”y_¡ršg
 == 'd') {

2382 
cmp_»suÉ
 = 
a
->
¡
.
mtime
 =ğ
b
->st.mtime ? 0 :

2383 
a
->
¡
.
mtime
 > 
b
->st.mtime ? 1 : -1;

2386  
qu”y_¡ršg
[1] =ğ'd' ? -
cmp_»suÉ
 : cmp_result;

2387 
	}
}

2389 
	$hªdË_dœeùÜy_»que¡
(
mg_cÚÃùiÚ
 *
cÚn
,

2390 cÚ¡ *
dœ
) {

2391 
dœ’t
 *
dp
;

2392 
DIR
 *
dœp
;

2393 
de
 *
’Œ›s
 = 
NULL
;

2394 
·th
[
PATH_MAX
];

2395 
i
, 
sÜt_dœeùiÚ
, 
num_’Œ›s
 = 0, 
¬r_size
 = 128;

2397 ià((
dœp
 = 
	`İ’dœ
(
dœ
)è=ğ
NULL
) {

2398 
	`£nd_h‰p_”rÜ
(
cÚn
, 500, "Cannot open directory",

2399 "E¼Ü: o³ndœ(%s): %s", 
·th
, 
	`¡»¼Ü
(
ERRNO
));

2403 (è
	`mg_´štf
(
cÚn
, "%s",

2408 
sÜt_dœeùiÚ
 = 
cÚn
->
»que¡_šfo
.
qu”y_¡ršg
 !ğ
NULL
 &&

2409 
cÚn
->
»que¡_šfo
.
qu”y_¡ršg
[1] == 'd' ? 'a' : 'd';

2411 (
dp
 = 
	`»addœ
(
dœp
)è!ğ
NULL
) {

2414 ià(!
	`¡rcmp
(
dp
->
d_Çme
, ".") ||

2415 !
	`¡rcmp
(
dp
->
d_Çme
, "..") ||

2416 !
	`¡rcmp
(
dp
->
d_Çme
, 
PASSWORDS_FILE_NAME
))

2419 ià(
’Œ›s
 =ğ
NULL
 || 
num_’Œ›s
 >ğ
¬r_size
) {

2420 
¬r_size
 *= 2;

2421 
’Œ›s
 = (
de
 *è
	`»®loc
(entries,

2422 
¬r_size
 * (
’Œ›s
[0]));

2425 ià(
’Œ›s
 =ğ
NULL
) {

2426 
	`£nd_h‰p_”rÜ
(
cÚn
, 500, "Cannot open directory",

2431 
	`mg_¢´štf
(
cÚn
, 
·th
, Õ©h), "%s%c%s", 
dœ
, 
DIRSEP
, 
dp
->
d_Çme
);

2438 ià(
	`mg_¡©
(
·th
, &
’Œ›s
[
num_’Œ›s
].
¡
) != 0) {

2439 
	`mem£t
(&
’Œ›s
[
num_’Œ›s
].
¡
, 0, (entries[num_entries].st));

2442 
’Œ›s
[
num_’Œ›s
].
cÚn
 = conn;

2443 
’Œ›s
[
num_’Œ›s
].
fe_Çme
 = 
	`mg_¡rdup
(
dp
->
d_Çme
);

2444 
num_’Œ›s
++;

2446 (è
	`şo£dœ
(
dœp
);

2448 
cÚn
->
num_by‹s_£Á
 +ğ
	`mg_´štf
(conn,

2456 
cÚn
->
»que¡_šfo
.
uri
, conn->request_info.uri,

2457 
sÜt_dœeùiÚ
, sort_direction, sort_direction);

2460 
cÚn
->
num_by‹s_£Á
 +ğ
	`mg_´štf
(conn,

2463 
cÚn
->
»que¡_šfo
.
uri
, "..", "Parent directory", "-", "-");

2466 
	`qsÜt
(
’Œ›s
, (
size_t
)
num_’Œ›s
, ÓÁr›s[0]), 
com·»_dœ_’Œ›s
);

2467 
i
 = 0; i < 
num_’Œ›s
; i++) {

2468 
	`´št_dœ_’Œy
(&
’Œ›s
[
i
]);

2469 
	`ä“
(
’Œ›s
[
i
].
fe_Çme
);

2471 
	`ä“
(
’Œ›s
);

2473 
cÚn
->
num_by‹s_£Á
 +ğ
	`mg_´štf
(conn, "%s", "</table></body></html>");

2474 
cÚn
->
»que¡_šfo
.
¡©us_code
 = 200;

2475 
	}
}

2478 
	$£nd_fe_d©a
(
mg_cÚÃùiÚ
 *
cÚn
, 
FILE
 *
å
, 
št64_t
 
Ën
) {

2479 
buf
[
BUFSIZ
];

2480 
to_»ad
, 
num_»ad
, 
num_wr™‹n
;

2482 
Ën
 > 0) {

2484 
to_»ad
 = (
buf
);

2485 ià((
št64_t
è
to_»ad
 > 
Ën
)

2486 
to_»ad
 = (è
Ën
;

2489 ià((
num_»ad
 = (è
	`ä—d
(
buf
, 1, (
size_t
)
to_»ad
, 
å
)) == 0)

2493 ià((
num_wr™‹n
 = 
	`mg_wr™e
(
cÚn
, 
buf
, (
size_t
)
num_»ad
)) !=‚um_read)

2497 
cÚn
->
num_by‹s_£Á
 +ğ
num_wr™‹n
;

2498 
Ën
 -ğ
num_wr™‹n
;

2500 
	}
}

2502 
	$·r£_¿nge_h—d”
(cÚ¡ *
h—d”
, 
št64_t
 *
a
, iÁ64_ˆ*
b
) {

2503  
	`ssÿnf
(
h—d”
, "by‹s=%" 
INT64_FMT
 "-%" INT64_FMT, 
a
, 
b
);

2504 
	}
}

2506 
	$hªdË_fe_»que¡
(
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
·th
,

2507 
mg¡©
 *
¡p
) {

2508 
d©e
[64], 
lm
[64], 
‘ag
[64], 
¿nge
[64];

2509 cÚ¡ *
fmt
 = "%a, %d %b %Y %H:%M:%S %Z", *
msg
 = "OK", *
hdr
;

2510 
time_t
 
cu¹ime
 = 
	`time
(
NULL
);

2511 
št64_t
 
ş
, 
r1
, 
r2
;

2512 
vec
 
mime_vec
;

2513 
FILE
 *
å
;

2514 
n
;

2516 
	`g‘_mime_ty³
(
cÚn
->
ùx
, 
·th
, &
mime_vec
);

2517 
ş
 = 
¡p
->
size
;

2518 
cÚn
->
»que¡_šfo
.
¡©us_code
 = 200;

2519 
¿nge
[0] = '\0';

2521 ià((
å
 = 
	`mg_fİ’
(
·th
, "rb")è=ğ
NULL
) {

2522 
	`£nd_h‰p_”rÜ
(
cÚn
, 500, 
h‰p_500_”rÜ
,

2523 "fİ’(%s): %s", 
·th
, 
	`¡»¼Ü
(
ERRNO
));

2526 
	`£t_şo£_Ú_exec
(
	`f’o
(
å
));

2529 
r1
 = 
r2
 = 0;

2530 
hdr
 = 
	`mg_g‘_h—d”
(
cÚn
, "Range");

2531 ià(
hdr
 !ğ
NULL
 && (
n
 = 
	`·r£_¿nge_h—d”
(hdr, &
r1
, &
r2
)) > 0) {

2532 
cÚn
->
»que¡_šfo
.
¡©us_code
 = 206;

2533 (è
	`f£eko
(
å
, (
off_t
è
r1
, 
SEEK_SET
);

2534 
ş
 = 
n
 =ğ2 ? 
r2
 - 
r1
 + 1: cl -„1;

2535 (è
	`mg_¢´štf
(
cÚn
, 
¿nge
, (range),

2537 "%" 
INT64_FMT
 "-%"

2538 
INT64_FMT
 "/%" INT64_FMT "\r\n",

2539 
r1
,„1 + 
ş
 - 1, 
¡p
->
size
);

2540 
msg
 = "Partial Content";

2544 (è
	`¡ráime
(
d©e
, (d©e), 
fmt
, 
	`loÿÉime
(&
cu¹ime
));

2545 (è
	`¡ráime
(
lm
, Öm), 
fmt
, 
	`loÿÉime
(&
¡p
->
mtime
));

2546 (è
	`mg_¢´štf
(
cÚn
, 
‘ag
, (etag), "%lx.%lx",

2547 (è
¡p
->
mtime
, (è¡p->
size
);

2549 (è
	`mg_´štf
(
cÚn
,

2555 "CÚ‹Á-L’gth: %" 
INT64_FMT
 "\r\n"

2559 
cÚn
->
»que¡_šfo
.
¡©us_code
, 
msg
, 
d©e
, 
lm
, 
‘ag
,

2560 
mime_vec
.
Ën
, mime_vec.
±r
, 
ş
, 
	`sugge¡_cÚÃùiÚ_h—d”
(
cÚn
), 
¿nge
);

2562 ià(
	`¡rcmp
(
cÚn
->
»que¡_šfo
.
»que¡_m‘hod
, "HEAD") != 0) {

2563 
	`£nd_fe_d©a
(
cÚn
, 
å
, 
ş
);

2565 (è
	`fşo£
(
å
);

2566 
	}
}

2570 
	$·r£_h‰p_h—d”s
(**
buf
, 
mg_»que¡_šfo
 *
ri
) {

2571 
i
;

2573 
i
 = 0; i < (è
	`ARRAY_SIZE
(
ri
->
h‰p_h—d”s
); i++) {

2574 
ri
->
h‰p_h—d”s
[
i
].
Çme
 = 
	`sk_quÙed
(
buf
, ":", " ", 0);

2575 
ri
->
h‰p_h—d”s
[
i
].
v®ue
 = 
	`sk
(
buf
, "\r\n");

2576 ià(
ri
->
h‰p_h—d”s
[
i
].
Çme
[0] == '\0')

2578 
ri
->
num_h—d”s
 = 
i
 + 1;

2580 
	}
}

2582 
	$is_v®id_h‰p_m‘hod
(cÚ¡ *
m‘hod
) {

2583  !
	`¡rcmp
(
m‘hod
, "GET") || !strcmp(method, "POST") ||

2584 !
	`¡rcmp
(
m‘hod
, "HEAD") || !strcmp(method, "CONNECT") ||

2585 !
	`¡rcmp
(
m‘hod
, "PUT") || !strcmp(method, "DELETE");

2586 
	}
}

2589 
	$·r£_h‰p_»que¡
(*
buf
, 
mg_»que¡_šfo
 *
ri
) {

2590 
¡©us
 = 0;

2593 *
buf
 !ğ'\0' && 
	`is¥aû
(* (*) buf)) {

2594 
buf
++;

2597 
ri
->
»que¡_m‘hod
 = 
	`sk
(&
buf
, " ");

2598 
ri
->
uri
 = 
	`sk
(&
buf
, " ");

2599 
ri
->
h‰p_v”siÚ
 = 
	`sk
(&
buf
, "\r\n");

2601 ià(
	`is_v®id_h‰p_m‘hod
(
ri
->
»que¡_m‘hod
) &&

2602 
	`¡ºcmp
(
ri
->
h‰p_v”siÚ
, "HTTP/", 5) == 0) {

2603 
ri
->
h‰p_v”siÚ
 += 5;

2604 
	`·r£_h‰p_h—d”s
(&
buf
, 
ri
);

2605 
¡©us
 = 1;

2608  
¡©us
;

2609 
	}
}

2616 
	$»ad_»que¡
(
FILE
 *
å
, 
SOCKET
 
sock
, 
SSL
 *
s¦
, *
buf
, 
bufsiz
,

2617 *
Ä—d
) {

2618 
n
, 
»que¡_Ën
;

2620 
»que¡_Ën
 = 0;

2621 *
Ä—d
 < 
bufsiz
 && 
»que¡_Ën
 == 0) {

2622 
n
 = 
	`puÎ
(
å
, 
sock
, 
s¦
, 
buf
 + *
Ä—d
, 
bufsiz
 - *nread);

2623 ià(
n
 <= 0) {

2626 *
Ä—d
 +ğ
n
;

2627 
»que¡_Ën
 = 
	`g‘_»que¡_Ën
(
buf
, *
Ä—d
);

2631  
»que¡_Ën
;

2632 
	}
}

2637 
	$sub¡™u‹_šdex_fe
(
mg_cÚÃùiÚ
 *
cÚn
, *
·th
,

2638 
size_t
 
·th_Ën
, 
mg¡©
 *
¡p
) {

2639 cÚ¡ *
li¡
 = 
cÚn
->
ùx
->
cÚfig
[
INDEX_FILES
];

2640 
mg¡©
 
¡
;

2641 
vec
 
f’ame_vec
;

2642 
size_t
 
n
 = 
	`¡¾’
(
·th
);

2643 
found
 = 0;

2648 
n
 > 0 && 
	`IS_DIRSEP_CHAR
(
·th
[n - 1])) {

2649 
n
--;

2651 
·th
[
n
] = 
DIRSEP
;

2655 (
li¡
 = 
	`Ãxt_İtiÚ
Öi¡, &
f’ame_vec
, 
NULL
)) != NULL) {

2658 ià(
f’ame_vec
.
Ën
 > 
·th_Ën
 - 
n
)

2662 (è
	`mg_¡¾ıy
(
·th
 + 
n
 + 1, 
f’ame_vec
.
±r
, f’ame_vec.
Ën
 + 1);

2665 ià(
	`mg_¡©
(
·th
, &
¡
) == 0) {

2667 *
¡p
 = 
¡
;

2668 
found
 = 1;

2674 ià(!
found
) {

2675 
·th
[
n
] = '\0';

2678  
found
;

2679 
	}
}

2682 
	$is_nÙ_modif›d
(cÚ¡ 
mg_cÚÃùiÚ
 *
cÚn
,

2683 cÚ¡ 
mg¡©
 *
¡p
) {

2684 cÚ¡ *
ims
 = 
	`mg_g‘_h—d”
(
cÚn
, "If-Modified-Since");

2685  
ims
 !ğ
NULL
 && 
¡p
->
mtime
 <ğ
	`·r£_d©e_¡ršg
(ims);

2686 
	}
}

2688 
	$fÜw¬d_body_d©a
(
mg_cÚÃùiÚ
 *
cÚn
, 
FILE
 *
å
,

2689 
SOCKET
 
sock
, 
SSL
 *
s¦
) {

2690 cÚ¡ *
ex³ù
, *
bufã»d
;

2691 
buf
[
BUFSIZ
];

2692 
to_»ad
, 
Ä—d
, 
bufã»d_Ën
, 
sucûss
 = 0;

2694 
ex³ù
 = 
	`mg_g‘_h—d”
(
cÚn
, "Expect");

2695 
	`as£¹
(
å
 !ğ
NULL
);

2697 ià(
cÚn
->
cÚ‹Á_Ën
 == -1) {

2698 
	`£nd_h‰p_”rÜ
(
cÚn
, 411, "Length Required", "");

2699 } ià(
ex³ù
 !ğ
NULL
 && 
	`mg_¡rÿ£cmp
(expect, "100-continue")) {

2700 
	`£nd_h‰p_”rÜ
(
cÚn
, 417, "Expectation Failed", "");

2702 ià(
ex³ù
 !ğ
NULL
) {

2703 (è
	`mg_´štf
(
cÚn
, "%s", "HTTP/1.1 100 Continue\r\n\r\n");

2706 
bufã»d
 = 
cÚn
->
buf
 + cÚn->
»que¡_Ën
;

2707 
bufã»d_Ën
 = 
cÚn
->
d©a_Ën
 - cÚn->
»que¡_Ën
;

2708 
	`as£¹
(
bufã»d_Ën
 >= 0);

2709 
	`as£¹
(
cÚn
->
cÚsumed_cÚ‹Á
 == 0);

2711 ià(
bufã»d_Ën
 > 0) {

2712 ià((
št64_t
è
bufã»d_Ën
 > 
cÚn
->
cÚ‹Á_Ën
) {

2713 
bufã»d_Ën
 = (è
cÚn
->
cÚ‹Á_Ën
;

2715 
	`push
(
å
, 
sock
, 
s¦
, 
bufã»d
, (
št64_t
è
bufã»d_Ën
);

2716 
cÚn
->
cÚsumed_cÚ‹Á
 +ğ
bufã»d_Ën
;

2719 
cÚn
->
cÚsumed_cÚ‹Á
 < cÚn->
cÚ‹Á_Ën
) {

2720 
to_»ad
 = (
buf
);

2721 ià((
št64_t
è
to_»ad
 > 
cÚn
->
cÚ‹Á_Ën
 - cÚn->
cÚsumed_cÚ‹Á
) {

2722 
to_»ad
 = (è(
cÚn
->
cÚ‹Á_Ën
 - cÚn->
cÚsumed_cÚ‹Á
);

2724 
Ä—d
 = 
	`puÎ
(
NULL
, 
cÚn
->
ş›Á
.
sock
, cÚn->
s¦
, 
buf
, 
to_»ad
);

2725 ià(
Ä—d
 <ğ0 || 
	`push
(
å
, 
sock
, 
s¦
, 
buf
,‚read) !=‚read) {

2728 
cÚn
->
cÚsumed_cÚ‹Á
 +ğ
Ä—d
;

2731 ià(
cÚn
->
cÚsumed_cÚ‹Á
 =ğcÚn->
cÚ‹Á_Ën
) {

2732 
sucûss
 = 1;

2736 ià(!
sucûss
) {

2737 
	`£nd_h‰p_”rÜ
(
cÚn
, 577, 
h‰p_500_”rÜ
, "");

2741  
sucûss
;

2742 
	}
}

2744 #ià!
defšed
(
NO_CGI
)

2753 
	scgi_’v_block
 {

2754 
mg_cÚÃùiÚ
 *
	mcÚn
;

2755 
	mbuf
[
CGI_ENVIRONMENT_SIZE
];

2756 
	mËn
;

2757 *
	mv¬s
[
MAX_CGI_ENVIR_VARS
];

2758 
	mnv¬s
;

2763 *
	$add’v
(
cgi_’v_block
 *
block
, cÚ¡ *
fmt
, ...) {

2764 
n
, 
¥aû
;

2765 *
added
;

2766 
va_li¡
 
­
;

2769 
¥aû
 = (è((
block
->
buf
è- block->
Ën
 - 2);

2770 
	`as£¹
(
¥aû
 >= 0);

2773 
added
 = 
block
->
buf
 + block->
Ën
;

2776 
	`va_¡¬t
(
­
, 
fmt
);

2777 
n
 = 
	`mg_v¢´štf
(
block
->
cÚn
, 
added
, (
size_t
è
¥aû
, 
fmt
, 
­
);

2778 
	`va_’d
(
­
);

2781 ià(
n
 > 0 &&‚ < 
¥aû
 &&

2782 
block
->
nv¬s
 < (è
	`ARRAY_SIZE
(block->
v¬s
) - 2) {

2784 
block
->
v¬s
[block->
nv¬s
++] = block->
buf
 + block->
Ën
;

2786 
block
->
Ën
 +ğ
n
 + 1;

2789  
added
;

2790 
	}
}

2792 
	$´•¬e_cgi_’vœÚm’t
(
mg_cÚÃùiÚ
 *
cÚn
,

2793 cÚ¡ *
´og
,

2794 
cgi_’v_block
 *
blk
) {

2795 cÚ¡ *
s
, *
¦ash
;

2796 
vec
 
v¬_vec
, 
roÙ
;

2797 *
p
;

2798 
i
;

2800 
blk
->
Ën
 = blk->
nv¬s
 = 0;

2801 
blk
->
cÚn
 = conn;

2803 
	`g‘_docum’t_roÙ
(
cÚn
, &
roÙ
);

2805 
	`add’v
(
blk
, "SERVER_NAME=%s", 
cÚn
->
ùx
->
cÚfig
[
AUTHENTICATION_DOMAIN
]);

2806 
	`add’v
(
blk
, "SERVER_ROOT=%.*s", 
roÙ
.
Ën
,„oÙ.
±r
);

2807 
	`add’v
(
blk
, "DOCUMENT_ROOT=%.*s", 
roÙ
.
Ën
,„oÙ.
±r
);

2810 
	`add’v
(
blk
, "%s", "GATEWAY_INTERFACE=CGI/1.1");

2811 
	`add’v
(
blk
, "%s", "SERVER_PROTOCOL=HTTP/1.1");

2812 
	`add’v
(
blk
, "%s", "REDIRECT_STATUS=200");

2813 
	`add’v
(
blk
, "SERVER_PORT=%d", 
	`Áohs
(
cÚn
->
ş›Á
.
l§
.
u
.
sš
.
sš_pÜt
));

2814 
	`add’v
(
blk
, "REQUEST_METHOD=%s", 
cÚn
->
»que¡_šfo
.
»que¡_m‘hod
);

2815 
	`add’v
(
blk
, "REMOTE_ADDR=%s",

2816 
	`š‘_Áß
(
cÚn
->
ş›Á
.
r§
.
u
.
sš
.
sš_addr
));

2817 
	`add’v
(
blk
, "REMOTE_PORT=%d", 
cÚn
->
»que¡_šfo
.
»mÙe_pÜt
);

2818 
	`add’v
(
blk
, "REQUEST_URI=%s", 
cÚn
->
»que¡_šfo
.
uri
);

2821 
	`as£¹
(
cÚn
->
»que¡_šfo
.
uri
[0] == '/');

2822 
¦ash
 = 
	`¡¼chr
(
cÚn
->
»que¡_šfo
.
uri
, '/');

2823 ià((
s
 = 
	`¡¼chr
(
´og
, '/')è=ğ
NULL
)

2824 
s
 = 
´og
;

2825 
	`add’v
(
blk
, "SCRIPT_NAME=%.*s%s", 
¦ash
 - 
cÚn
->
»que¡_šfo
.
uri
,

2826 
cÚn
->
»que¡_šfo
.
uri
, 
s
);

2828 
	`add’v
(
blk
, "SCRIPT_FILENAME=%s", 
´og
);

2829 
	`add’v
(
blk
, "PATH_TRANSLATED=%s", 
´og
);

2830 
	`add’v
(
blk
, "HTTPS=%s", 
cÚn
->
s¦
 =ğ
NULL
 ? "off" : "on");

2832 ià((
s
 = 
	`mg_g‘_h—d”
(
cÚn
, "CÚ‹Á-Ty³")è!ğ
NULL
)

2833 
	`add’v
(
blk
, "CONTENT_TYPE=%s", 
s
);

2835 ià(
cÚn
->
»que¡_šfo
.
qu”y_¡ršg
 !ğ
NULL
)

2836 
	`add’v
(
blk
, "QUERY_STRING=%s", 
cÚn
->
»que¡_šfo
.
qu”y_¡ršg
);

2838 ià((
s
 = 
	`mg_g‘_h—d”
(
cÚn
, "CÚ‹Á-L’gth")è!ğ
NULL
)

2839 
	`add’v
(
blk
, "CONTENT_LENGTH=%s", 
s
);

2841 ià((
s
 = 
	`g‘’v
("PATH")è!ğ
NULL
)

2842 
	`add’v
(
blk
, "PATH=%s", 
s
);

2844 #ià
	`defšed
(
_WIN32
)

2845 ià((
s
 = 
	`g‘’v
("COMSPEC")è!ğ
NULL
)

2846 
	`add’v
(
blk
, "COMSPEC=%s", 
s
);

2847 ià((
s
 = 
	`g‘’v
("SYSTEMROOT")è!ğ
NULL
)

2848 
	`add’v
(
blk
, "SYSTEMROOT=%s", 
s
);

2850 ià((
s
 = 
	`g‘’v
("LD_LIBRARY_PATH")è!ğ
NULL
)

2851 
	`add’v
(
blk
, "LD_LIBRARY_PATH=%s", 
s
);

2854 ià((
s
 = 
	`g‘’v
("PERLLIB")è!ğ
NULL
)

2855 
	`add’v
(
blk
, "PERLLIB=%s", 
s
);

2857 ià(
cÚn
->
»que¡_šfo
.
»mÙe_u£r
 !ğ
NULL
) {

2858 
	`add’v
(
blk
, "REMOTE_USER=%s", 
cÚn
->
»que¡_šfo
.
»mÙe_u£r
);

2859 
	`add’v
(
blk
, "%s", "AUTH_TYPE=Digest");

2863 
i
 = 0; i < 
cÚn
->
»que¡_šfo
.
num_h—d”s
; i++) {

2864 
p
 = 
	`add’v
(
blk
, "HTTP_%s=%s",

2865 
cÚn
->
»que¡_šfo
.
h‰p_h—d”s
[
i
].
Çme
,

2866 
cÚn
->
»que¡_šfo
.
h‰p_h—d”s
[
i
].
v®ue
);

2869 ; *
p
 != '=' && *p != '\0';…++) {

2870 ià(*
p
 == '-')

2871 *
p
 = '_';

2872 *
p
 = (è
	`touµ”
(* (*)…);

2877 
s
 = 
cÚn
->
ùx
->
cÚfig
[
CGI_ENVIRONMENT
];

2878 (
s
 = 
	`Ãxt_İtiÚ
(s, &
v¬_vec
, 
NULL
)) != NULL) {

2879 
	`add’v
(
blk
, "%.*s", 
v¬_vec
.
Ën
, v¬_vec.
±r
);

2882 
blk
->
v¬s
[blk->
nv¬s
++] = 
NULL
;

2883 
blk
->
buf
[blk->
Ën
++] = '\0';

2885 
	`as£¹
(
blk
->
nv¬s
 < (è
	`ARRAY_SIZE
(blk->
v¬s
));

2886 
	`as£¹
(
blk
->
Ën
 > 0);

2887 
	`as£¹
(
blk
->
Ën
 < (è(blk->
buf
));

2888 
	}
}

2890 
	$hªdË_cgi_»que¡
(
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
´og
) {

2891 
h—d”s_Ën
, 
d©a_Ën
, 
i
, 
fd_¡dš
[2], 
fd_¡dout
[2];

2892 cÚ¡ *
¡©us
;

2893 
buf
[
BUFSIZ
], *
pbuf
, 
dœ
[
PATH_MAX
], *
p
;

2894 
mg_»que¡_šfo
 
ri
;

2895 
cgi_’v_block
 
blk
;

2896 
FILE
 *
š
, *
out
;

2897 
pid_t
 
pid
;

2899 
	`´•¬e_cgi_’vœÚm’t
(
cÚn
, 
´og
, &
blk
);

2904 (è
	`mg_¢´štf
(
cÚn
, 
dœ
, (dœ), "%s", 
´og
);

2905 ià((
p
 = 
	`¡¼chr
(
dœ
, 
DIRSEP
)è!ğ
NULL
) {

2906 *
p
++ = '\0';

2908 
dœ
[0] = '.', dir[1] = '\0';

2909 
p
 = (*è
´og
;

2912 
pid
 = (
pid_t
) -1;

2913 
fd_¡dš
[0] = fd_¡dš[1] = 
fd_¡dout
[0] = fd_stdout[1] = -1;

2914 
š
 = 
out
 = 
NULL
;

2916 ià(
	`pe
(
fd_¡dš
è!ğ0 ||…e(
fd_¡dout
) != 0) {

2917 
	`£nd_h‰p_”rÜ
(
cÚn
, 500, 
h‰p_500_”rÜ
,

2918 "CªnÙ c»©CGI…e: %s", 
	`¡»¼Ü
(
ERRNO
));

2919 
dÚe
;

2920 } ià((
pid
 = 
	`¥awn_´oûss
(
cÚn
, 
p
, 
blk
.
buf
, blk.
v¬s
,

2921 
fd_¡dš
[0], 
fd_¡dout
[1], 
dœ
)è=ğ(
pid_t
) -1) {

2922 
dÚe
;

2923 } ià((
š
 = 
	`fdİ’
(
fd_¡dš
[1], "wb")è=ğ
NULL
 ||

2924 (
out
 = 
	`fdİ’
(
fd_¡dout
[0], "rb")è=ğ
NULL
) {

2925 
	`£nd_h‰p_”rÜ
(
cÚn
, 500, 
h‰p_500_”rÜ
,

2926 "fİ’: %s", 
	`¡»¼Ü
(
ERRNO
));

2927 
dÚe
;

2930 
	`£tbuf
(
š
, 
NULL
);

2931 
	`£tbuf
(
out
, 
NULL
);

2937 
fd_¡dš
[0] = 
fd_¡dout
[1] = -1;

2940 ià(!
	`¡rcmp
(
cÚn
->
»que¡_šfo
.
»que¡_m‘hod
, "POST") &&

2941 !
	`fÜw¬d_body_d©a
(
cÚn
, 
š
, 
INVALID_SOCKET
, 
NULL
)) {

2942 
dÚe
;

2949 
d©a_Ën
 = 0;

2950 
h—d”s_Ën
 = 
	`»ad_»que¡
(
out
, 
INVALID_SOCKET
, 
NULL
,

2951 
buf
, (buf), &
d©a_Ën
);

2952 ià(
h—d”s_Ën
 <= 0) {

2953 
	`£nd_h‰p_”rÜ
(
cÚn
, 500, 
h‰p_500_”rÜ
,

2955 
d©a_Ën
, 
buf
);

2956 
dÚe
;

2958 
pbuf
 = 
buf
;

2959 
buf
[
h—d”s_Ën
 - 1] = '\0';

2960 
	`·r£_h‰p_h—d”s
(&
pbuf
, &
ri
);

2963 
¡©us
 = 
	`g‘_h—d”
(&
ri
, "Status");

2964 
cÚn
->
»que¡_šfo
.
¡©us_code
 = 
¡©us
 =ğ
NULL
 ? 200 : 
	`©oi
(status);

2965 (è
	`mg_´štf
(
cÚn
, "HTTP/1.1 %d OK\r\n", cÚn->
»que¡_šfo
.
¡©us_code
);

2968 
i
 = 0; i < 
ri
.
num_h—d”s
; i++) {

2969 
	`mg_´štf
(
cÚn
, "%s: %s\r\n",

2970 
ri
.
h‰p_h—d”s
[
i
].
Çme
,„i.h‰p_h—d”s[i].
v®ue
);

2972 (è
	`mg_wr™e
(
cÚn
, "\r\n", 2);

2975 
cÚn
->
num_by‹s_£Á
 +ğ
	`mg_wr™e
(cÚn, 
buf
 + 
h—d”s_Ën
,

2976 (
size_t
)(
d©a_Ën
 - 
h—d”s_Ën
));

2979 
	`£nd_fe_d©a
(
cÚn
, 
out
, 
INT64_MAX
);

2981 
dÚe
:

2982 ià(
pid
 !ğ(
pid_t
) -1) {

2983 
	`kl
(
pid
, 
SIGKILL
);

2984 #ià!
	`defšed
(
_WIN32
)

2985 dØ{} 
	`wa™pid
(-1, &
i
, 
WNOHANG
) > 0);

2988 ià(
fd_¡dš
[0] != -1) {

2989 (è
	`şo£
(
fd_¡dš
[0]);

2991 ià(
fd_¡dout
[1] != -1) {

2992 (è
	`şo£
(
fd_¡dout
[1]);

2995 ià(
š
 !ğ
NULL
) {

2996 (è
	`fşo£
(
š
);

2997 } ià(
fd_¡dš
[1] != -1) {

2998 (è
	`şo£
(
fd_¡dš
[1]);

3001 ià(
out
 !ğ
NULL
) {

3002 (è
	`fşo£
(
out
);

3003 } ià(
fd_¡dout
[0] != -1) {

3004 (è
	`şo£
(
fd_¡dout
[0]);

3006 
	}
}

3012 
	$put_dœ
(cÚ¡ *
·th
) {

3013 
buf
[
PATH_MAX
];

3014 cÚ¡ *
s
, *
p
;

3015 
mg¡©
 
¡
;

3016 
size_t
 
Ën
;

3018 
s
 = 
p
 = 
·th
 + 2; (°ğ
	`¡rchr
(s, '/')è!ğ
NULL
; s = ++p) {

3019 
Ën
 = 
p
 - 
·th
;

3020 
	`as£¹
(
Ën
 < (
buf
));

3021 (è
	`memıy
(
buf
, 
·th
, 
Ën
);

3022 
buf
[
Ën
] = '\0';

3025 ià(
	`mg_¡©
(
buf
, &
¡
è=ğ-1 && 
	`mg_mkdœ
(buf, 0755) != 0) {

3030 ià(
p
[1] == '\0') {

3036 
	}
}

3038 
	$put_fe
(
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
·th
) {

3039 
mg¡©
 
¡
;

3040 cÚ¡ *
¿nge
;

3041 
št64_t
 
r1
, 
r2
;

3042 
FILE
 *
å
;

3043 
rc
;

3045 
cÚn
->
»que¡_šfo
.
¡©us_code
 = 
	`mg_¡©
(
·th
, &
¡
) == 0 ? 200 : 201;

3047 ià((
rc
 = 
	`put_dœ
(
·th
)) == 0) {

3048 
	`mg_´štf
(
cÚn
, "HTTP/1.1 %d OK\r\n\r\n", cÚn->
»que¡_šfo
.
¡©us_code
);

3049 } ià(
rc
 == -1) {

3050 
	`£nd_h‰p_”rÜ
(
cÚn
, 500, 
h‰p_500_”rÜ
,

3051 "put_dœ(%s): %s", 
·th
, 
	`¡»¼Ü
(
ERRNO
));

3052 } ià((
å
 = 
	`mg_fİ’
(
·th
, "wb+")è=ğ
NULL
) {

3053 
	`£nd_h‰p_”rÜ
(
cÚn
, 500, 
h‰p_500_”rÜ
,

3054 "fİ’(%s): %s", 
·th
, 
	`¡»¼Ü
(
ERRNO
));

3056 
	`£t_şo£_Ú_exec
(
	`f’o
(
å
));

3057 
¿nge
 = 
	`mg_g‘_h—d”
(
cÚn
, "Content-Range");

3058 
r1
 = 
r2
 = 0;

3059 ià(
¿nge
 !ğ
NULL
 && 
	`·r£_¿nge_h—d”
Ôªge, &
r1
, &
r2
) > 0) {

3060 
cÚn
->
»que¡_šfo
.
¡©us_code
 = 206;

3062 (è
	`f£eko
(
å
, (
off_t
è
r1
, 
SEEK_SET
);

3064 ià(
	`fÜw¬d_body_d©a
(
cÚn
, 
å
, 
INVALID_SOCKET
, 
NULL
))

3065 (è
	`mg_´štf
(
cÚn
, "HTTP/1.1 %d OK\r\n\r\n",

3066 
cÚn
->
»que¡_šfo
.
¡©us_code
);

3067 (è
	`fşo£
(
å
);

3069 
	}
}

3071 
£nd_ssi_fe
(
mg_cÚÃùiÚ
 *, cÚ¡ *, 
FILE
 *, );

3073 
	$do_ssi_šşude
(
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
ssi
,

3074 *
g
, 
šşude_Ëv–
) {

3075 
fe_Çme
[
BUFSIZ
], 
·th
[
PATH_MAX
], *
p
;

3076 
vec
 
roÙ
;

3077 
is_ssi
;

3078 
FILE
 *
å
;

3080 
	`g‘_docum’t_roÙ
(
cÚn
, &
roÙ
);

3084 ià(
	`ssÿnf
(
g
, " vœtu®=\"%[^\"]\"", 
fe_Çme
) == 1) {

3086 (è
	`mg_¢´štf
(
cÚn
, 
·th
, (path), "%.*s%c%s",

3087 
roÙ
.
Ën
,„oÙ.
±r
, 
DIRSEP
, 
fe_Çme
);

3088 } ià(
	`ssÿnf
(
g
, " fe=\"%[^\"]\"", 
fe_Çme
) == 1) {

3091 (è
	`mg_¢´štf
(
cÚn
, 
·th
, Õ©h), "%s", 
fe_Çme
);

3092 } ià(
	`ssÿnf
(
g
, " \"%[^\"]\"", 
fe_Çme
) == 1) {

3094 (è
	`mg_¢´štf
(
cÚn
, 
·th
, Õ©h), "%s", 
ssi
);

3095 ià((
p
 = 
	`¡¼chr
(
·th
, 
DIRSEP
)è!ğ
NULL
) {

3096 
p
[1] = '\0';

3098 (è
	`mg_¢´štf
(
cÚn
, 
·th
 + 
	`¡¾’
(path),

3099 (
·th
è- 
	`¡¾’
Õ©h), "%s", 
fe_Çme
);

3101 
	`üy
(
cÚn
, "Bad SSI #šşude: [%s]", 
g
);

3105 ià((
å
 = 
	`mg_fİ’
(
·th
, "rb")è=ğ
NULL
) {

3106 
	`üy
(
cÚn
, "Cannot open SSI #include: [%s]: fopen(%s): %s",

3107 
g
, 
·th
, 
	`¡»¼Ü
(
ERRNO
));

3109 
	`£t_şo£_Ú_exec
(
	`f’o
(
å
));

3110 
is_ssi
 = 
	`m©ch_ex‹nsiÚ
(
·th
, 
cÚn
->
ùx
->
cÚfig
[
SSI_EXTENSIONS
]);

3111 ià(
is_ssi
) {

3112 
	`£nd_ssi_fe
(
cÚn
, 
·th
, 
å
, 
šşude_Ëv–
 + 1);

3114 
	`£nd_fe_d©a
(
cÚn
, 
å
, 
INT64_MAX
);

3116 (è
	`fşo£
(
å
);

3118 
	}
}

3120 #ià!
defšed
(
NO_POPEN
)

3121 
	$do_ssi_exec
(
mg_cÚÃùiÚ
 *
cÚn
, *
g
) {

3122 
cmd
[
BUFSIZ
];

3123 
FILE
 *
å
;

3125 ià(
	`ssÿnf
(
g
, " \"%[^\"]\"", 
cmd
) != 1) {

3126 
	`üy
(
cÚn
, "Bad SSI #exec: [%s]", 
g
);

3127 } ià((
å
 = 
	`pİ’
(
cmd
, "r")è=ğ
NULL
) {

3128 
	`üy
(
cÚn
, "CªnÙ SSI #exec: [%s]: %s", 
cmd
, 
	`¡»¼Ü
(
ERRNO
));

3130 
	`£nd_fe_d©a
(
cÚn
, 
å
, 
INT64_MAX
);

3131 (è
	`pşo£
(
å
);

3133 
	}
}

3136 
	$£nd_ssi_fe
(
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
·th
,

3137 
FILE
 *
å
, 
šşude_Ëv–
) {

3138 
buf
[
BUFSIZ
];

3139 
ch
, 
Ën
, 
š_ssi_g
;

3141 ià(
šşude_Ëv–
 > 10) {

3142 
	`üy
(
cÚn
, "SSI #šşudËv– i toØd“°(%s)", 
·th
);

3146 
š_ssi_g
 = 0;

3147 
Ën
 = 0;

3149 (
ch
 = 
	`fg‘c
(
å
)è!ğ
EOF
) {

3150 ià(
š_ssi_g
 && 
ch
 == '>') {

3151 
š_ssi_g
 = 0;

3152 
buf
[
Ën
++] = (è
ch
;

3153 
buf
[
Ën
] = '\0';

3154 
	`as£¹
(
Ën
 <ğ(è(
buf
));

3155 ià(
Ën
 < 6 || 
	`memcmp
(
buf
, "<!--#", 5) != 0) {

3157 (è
	`mg_wr™e
(
cÚn
, 
buf
, (
size_t
)
Ën
);

3159 ià(!
	`memcmp
(
buf
 + 5, "include", 7)) {

3160 
	`do_ssi_šşude
(
cÚn
, 
·th
, 
buf
 + 12, 
šşude_Ëv–
);

3161 #ià!
	`defšed
(
NO_POPEN
)

3162 } ià(!
	`memcmp
(
buf
 + 5, "exec", 4)) {

3163 
	`do_ssi_exec
(
cÚn
, 
buf
 + 9);

3166 
	`üy
(
cÚn
, "%s: unknowÀSSI " "commªd: \"%s\"", 
·th
, 
buf
);

3169 
Ën
 = 0;

3170 } ià(
š_ssi_g
) {

3171 ià(
Ën
 =ğ5 && 
	`memcmp
(
buf
, "<!--#", 5) != 0) {

3173 
š_ssi_g
 = 0;

3174 } ià(
Ën
 =ğ(è(
buf
) - 2) {

3175 
	`üy
(
cÚn
, "%s: SSIag i toØÏrge", 
·th
);

3176 
Ën
 = 0;

3178 
buf
[
Ën
++] = 
ch
 & 0xff;

3179 } ià(
ch
 == '<') {

3180 
š_ssi_g
 = 1;

3181 ià(
Ën
 > 0) {

3182 (è
	`mg_wr™e
(
cÚn
, 
buf
, (
size_t
)
Ën
);

3184 
Ën
 = 0;

3185 
buf
[
Ën
++] = 
ch
 & 0xff;

3187 
buf
[
Ën
++] = 
ch
 & 0xff;

3188 ià(
Ën
 =ğ(è(
buf
)) {

3189 (è
	`mg_wr™e
(
cÚn
, 
buf
, (
size_t
)
Ën
);

3190 
Ën
 = 0;

3196 ià(
Ën
 > 0) {

3197 (è
	`mg_wr™e
(
cÚn
, 
buf
, (
size_t
)
Ën
);

3199 
	}
}

3201 
	$hªdË_ssi_fe_»que¡
(
mg_cÚÃùiÚ
 *
cÚn
,

3202 cÚ¡ *
·th
) {

3203 
FILE
 *
å
;

3205 ià((
å
 = 
	`mg_fİ’
(
·th
, "rb")è=ğ
NULL
) {

3206 
	`£nd_h‰p_”rÜ
(
cÚn
, 500, 
h‰p_500_”rÜ
, "fİ’(%s): %s", 
·th
,

3207 
	`¡»¼Ü
(
ERRNO
));

3209 
	`£t_şo£_Ú_exec
(
	`f’o
(
å
));

3210 
	`mg_´štf
(
cÚn
, "HTTP/1.1 200 OK\r\n"

3212 
	`sugge¡_cÚÃùiÚ_h—d”
(
cÚn
));

3213 
	`£nd_ssi_fe
(
cÚn
, 
·th
, 
å
, 0);

3214 (è
	`fşo£
(
å
);

3216 
	}
}

3222 
	$hªdË_»que¡
(
mg_cÚÃùiÚ
 *
cÚn
) {

3223 
mg_»que¡_šfo
 *
ri
 = &
cÚn
->
»que¡_šfo
;

3224 
·th
[
PATH_MAX
];

3225 
uri_Ën
;

3226 
mg¡©
 
¡
;

3228 ià((
cÚn
->
»que¡_šfo
.
qu”y_¡ršg
 = 
	`¡rchr
(
ri
->
uri
, '?')è!ğ
NULL
) {

3229 * 
cÚn
->
»que¡_šfo
.
qu”y_¡ršg
++ = '\0';

3231 
uri_Ën
 = (è
	`¡¾’
(
ri
->
uri
);

3232 (è
	`u¾_decode
(
ri
->
uri
, (
size_t
)
uri_Ën
,„i->uri, (size_t)(uri_len + 1), 0);

3233 
	`»move_doubË_dÙs_ªd_doubË_¦ashes
(
ri
->
uri
);

3234 
	`cÚv”t_uri_to_fe_Çme
(
cÚn
, 
ri
->
uri
, 
·th
, (path));

3236 
	`DEBUG_TRACE
(("%s", 
ri
->
uri
));

3238 
	`·r£_auth_h—d”
(
cÚn
);

3240 ià(
	`ÿÎ_u£r
(
cÚn
, 
MG_AUTHENTICATE
è!ğ
NULL
) {

3242 } ià(!
	`check_authÜiz©iÚ
(
cÚn
, 
·th
)) {

3243 
	`mg_£nd_authÜiz©iÚ_»que¡
(
cÚn
, 
NULL
);

3244 } ià(
	`ÿÎ_u£r
(
cÚn
, 
MG_NEW_REQUEST
è!ğ
NULL
) {

3246 } ià(
	`¡r¡r
(
·th
, 
PASSWORDS_FILE_NAME
)) {

3248 
	`£nd_h‰p_”rÜ
(
cÚn
, 403, "Forbidden", "Access Forbidden");

3249 } ià(
cÚn
->
ùx
->
cÚfig
[
DOCUMENT_ROOT
] =ğ
NULL
) {

3250 
	`£nd_h‰p_”rÜ
(
cÚn
, 404, "Not Found", "Not Found");

3251 } ià((!
	`¡rcmp
(
ri
->
»que¡_m‘hod
, "PUT") ||

3252 !
	`¡rcmp
(
ri
->
»que¡_m‘hod
, "DELETE")) &&

3253 (
cÚn
->
ùx
->
cÚfig
[
PUT_DELETE_PASSWORDS_FILE
] =ğ
NULL
 ||

3254 !
	`is_authÜized_fÜ_put
(
cÚn
))) {

3255 
	`mg_£nd_authÜiz©iÚ_»que¡
(
cÚn
, 
NULL
);

3256 } ià(!
	`¡rcmp
(
ri
->
»que¡_m‘hod
, "PUT")) {

3257 
	`put_fe
(
cÚn
, 
·th
);

3258 } ià(!
	`¡rcmp
(
ri
->
»que¡_m‘hod
, "DELETE")) {

3259 ià(
	`mg_»move
(
·th
) == 0) {

3260 
	`£nd_h‰p_”rÜ
(
cÚn
, 200, "OK", "");

3262 
	`£nd_h‰p_”rÜ
(
cÚn
, 500, 
h‰p_500_”rÜ
, "»move(%s): %s", 
·th
,

3263 
	`¡»¼Ü
(
ERRNO
));

3265 } ià(
	`mg_¡©
(
·th
, &
¡
) != 0) {

3266 
	`£nd_h‰p_”rÜ
(
cÚn
, 404, "Not Found", "%s", "File‚ot found");

3267 } ià(
¡
.
is_dœeùÜy
 && 
ri
->
uri
[
uri_Ën
 - 1] != '/') {

3268 (è
	`mg_´štf
(
cÚn
,

3270 "LoÿtiÚ: %s/\r\n\r\n", 
ri
->
uri
);

3271 } ià(
¡
.
is_dœeùÜy
 &&

3272 !
	`sub¡™u‹_šdex_fe
(
cÚn
, 
·th
, Õ©h), &
¡
)) {

3273 ià(!
	`mg_¡rÿ£cmp
(
cÚn
->
ùx
->
cÚfig
[
ENABLE_DIRECTORY_LISTING
], "yes")) {

3274 
	`hªdË_dœeùÜy_»que¡
(
cÚn
, 
·th
);

3276 
	`£nd_h‰p_”rÜ
(
cÚn
, 403, "Directory Listing Denied",

3279 } ià(
	`m©ch_ex‹nsiÚ
(
·th
, 
cÚn
->
ùx
->
cÚfig
[
CGI_EXTENSIONS
])) {

3280 ià(
	`¡rcmp
(
ri
->
»que¡_m‘hod
, "POST") &&

3281 
	`¡rcmp
(
ri
->
»que¡_m‘hod
, "GET")) {

3282 
	`£nd_h‰p_”rÜ
(
cÚn
, 501, "Not Implemented",

3283 "M‘hod % i nÙ im¶em’‹d", 
ri
->
»que¡_m‘hod
);

3285 
	`hªdË_cgi_»que¡
(
cÚn
, 
·th
);

3287 } ià(
	`m©ch_ex‹nsiÚ
(
·th
, 
cÚn
->
ùx
->
cÚfig
[
SSI_EXTENSIONS
])) {

3288 
	`hªdË_ssi_fe_»que¡
(
cÚn
, 
·th
);

3289 } ià(
	`is_nÙ_modif›d
(
cÚn
, &
¡
)) {

3290 
	`£nd_h‰p_”rÜ
(
cÚn
, 304, "Not Modified", "");

3292 
	`hªdË_fe_»que¡
(
cÚn
, 
·th
, &
¡
);

3294 
	}
}

3296 
	$şo£_®l_li¡’šg_sock‘s
(
mg_cÚ‹xt
 *
ùx
) {

3297 
sock‘
 *
¥
, *
tmp
;

3298 
¥
 = 
ùx
->
li¡’šg_sock‘s
; s°!ğ
NULL
; s°ğ
tmp
) {

3299 
tmp
 = 
¥
->
Ãxt
;

3300 (è
	`şo£sock‘
(
¥
->
sock
);

3301 
	`ä“
(
¥
);

3303 
	}
}

3307 
	$·r£_pÜt_¡ršg
(cÚ¡ 
vec
 *vec, 
sock‘
 *
so
) {

3308 
u§
 *u§ = &
so
->
l§
;

3309 
a
, 
b
, 
c
, 
d
, 
pÜt
, 
Ën
;

3312 
	`mem£t
(
so
, 0, (*so));

3314 ià(
	`ssÿnf
(
vec
->
±r
, "%d.%d.%d.%d:%d%n", &
a
, &
b
, &
c
, &
d
, &
pÜt
, &
Ën
) == 5) {

3316 
u§
->
u
.
sš
.
sš_addr
.
s_addr
 = 
	`htÚl
((
a
 << 24è| (
b
 << 16è| (
c
 << 8è| 
d
);

3317 } ià(
	`ssÿnf
(
vec
->
±r
, "%d%n", &
pÜt
, &
Ën
) == 1) {

3319 
u§
->
u
.
sš
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

3323 
	`as£¹
(
Ën
 > 0 &&†’ <ğ(è
vec
->len);

3325 ià(
	`¡rchr
("¥,", 
vec
->
±r
[
Ën
]è=ğ
NULL
) {

3329 
so
->
is_s¦
 = 
vec
->
±r
[
Ën
] == 's';

3330 
so
->
is_´oxy
 = 
vec
->
±r
[
Ën
] == 'p';

3331 
u§
->
Ën
 = (u§->
u
.
sš
);

3332 
u§
->
u
.
sš
.
sš_çmy
 = 
AF_INET
;

3333 
u§
->
u
.
sš
.
sš_pÜt
 = 
	`htÚs
((
ušt16_t
è
pÜt
);

3336 
	}
}

3338 
	$£t_pÜts_İtiÚ
(
mg_cÚ‹xt
 *
ùx
) {

3339 cÚ¡ *
li¡
 = 
ùx
->
cÚfig
[
LISTENING_PORTS
];

3340 
»u£addr
 = 1, 
sucûss
 = 1;

3341 
SOCKET
 
sock
;

3342 
vec
 vec;

3343 
sock‘
 
so
, *
li¡’”
;

3345 
sucûss
 && (
li¡
 = 
	`Ãxt_İtiÚ
Öi¡, &
vec
, 
NULL
)) != NULL) {

3346 ià(!
	`·r£_pÜt_¡ršg
(&
vec
, &
so
)) {

3347 
	`üy
(
	`fc
(
ùx
), "%s: %.*s: invalid…ort spec. Expecting†ist of: %s",

3348 
__func__
, 
vec
.
Ën
, vec.
±r
, "[IP_ADDRESS:]PORT[s|p]");

3349 
sucûss
 = 0;

3350 } ià(
so
.
is_s¦
 && 
ùx
->
s¦_ùx
 =ğ
NULL
) {

3351 
	`üy
(
	`fc
(
ùx
), "Cannot‡dd SSL socket, is -ssl_cert option set?");

3352 
sucûss
 = 0;

3353 } ià((
sock
 = 
	`sock‘
(
PF_INET
, 
SOCK_STREAM
, 6)è=ğ
INVALID_SOCKET
 ||

3354 #ià!
	`defšed
(
_WIN32
)

3357 
	`£tsockİt
(
sock
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
»u£addr
,

3358 (
»u£addr
)) != 0 ||

3360 
	`bšd
(
sock
, &
so
.
l§
.
u
.
§
, so.l§.
Ën
) != 0 ||

3361 
	`li¡’
(
sock
, 20) != 0) {

3362 
	`şo£sock‘
(
sock
);

3363 
	`üy
(
	`fc
(
ùx
), "%s: cªnÙ bšdØ%.*s: %s", 
__func__
,

3364 
vec
.
Ën
, vec.
±r
, 
	`¡»¼Ü
(
ERRNO
));

3365 
sucûss
 = 0;

3366 } ià((
li¡’”
 = ((
sock‘
*è
	`ÿÎoc
(1, (*li¡’”)))è=ğ
NULL
) {

3367 
	`şo£sock‘
(
sock
);

3368 
	`üy
(
	`fc
(
ùx
), "%s: %s", 
__func__
, 
	`¡»¼Ü
(
ERRNO
));

3369 
sucûss
 = 0;

3371 *
li¡’”
 = 
so
;

3372 
li¡’”
->
sock
 = sock;

3373 
	`£t_şo£_Ú_exec
(
li¡’”
->
sock
);

3374 
li¡’”
->
Ãxt
 = 
ùx
->
li¡’šg_sock‘s
;

3375 
ùx
->
li¡’šg_sock‘s
 = 
li¡’”
;

3379 ià(!
sucûss
) {

3380 
	`şo£_®l_li¡’šg_sock‘s
(
ùx
);

3383  
sucûss
;

3384 
	}
}

3386 
	$log_h—d”
(cÚ¡ 
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
h—d”
,

3387 
FILE
 *
å
) {

3388 cÚ¡ *
h—d”_v®ue
;

3390 ià((
h—d”_v®ue
 = 
	`mg_g‘_h—d”
(
cÚn
, 
h—d”
)è=ğ
NULL
) {

3391 (è
	`årštf
(
å
, "%s", " -");

3393 (è
	`årštf
(
å
, " \"%s\"", 
h—d”_v®ue
);

3395 
	}
}

3397 
	$log_acûss
(cÚ¡ 
mg_cÚÃùiÚ
 *
cÚn
) {

3398 cÚ¡ 
mg_»que¡_šfo
 *
ri
;

3399 
FILE
 *
å
;

3400 
d©e
[64];

3402 
å
 = 
cÚn
->
ùx
->
cÚfig
[
ACCESS_LOG_FILE
] =ğ
NULL
 ? NULL :

3403 
	`mg_fİ’
(
cÚn
->
ùx
->
cÚfig
[
ACCESS_LOG_FILE
], "a+");

3405 ià(
å
 =ğ
NULL
)

3408 (è
	`¡ráime
(
d©e
, (date), "%d/%b/%Y:%H:%M:%S %z",

3409 
	`loÿÉime
(&
cÚn
->
bœth_time
));

3411 
ri
 = &
cÚn
->
»que¡_šfo
;

3413 
	`æockfe
(
å
);

3415 (è
	`årštf
(
å
,

3416 "% - % [%s] \"% % HTTP/%s\" %d %" 
INT64_FMT
,

3417 
	`š‘_Áß
(
cÚn
->
ş›Á
.
r§
.
u
.
sš
.
sš_addr
),

3418 
ri
->
»mÙe_u£r
 =ğ
NULL
 ? "-" :„i->remote_user,

3419 
d©e
,

3420 
ri
->
»que¡_m‘hod
 ?„i->request_method : "-",

3421 
ri
->
uri
 ?„i->uri : "-",

3422 
ri
->
h‰p_v”siÚ
,

3423 
cÚn
->
»que¡_šfo
.
¡©us_code
, cÚn->
num_by‹s_£Á
);

3424 
	`log_h—d”
(
cÚn
, "Reã»r", 
å
);

3425 
	`log_h—d”
(
cÚn
, "U£r-Ag’t", 
å
);

3426 (è
	`åutc
('\n', 
å
);

3427 (è
	`fæush
(
å
);

3429 
	`fuÆockfe
(
å
);

3430 (è
	`fşo£
(
å
);

3431 
	}
}

3433 
	$isby‹
(
n
) {

3434  
n
 >= 0 &&‚ <= 255;

3435 
	}
}

3439 
	$check_aş
(
mg_cÚ‹xt
 *
ùx
, cÚ¡ 
u§
 *usa) {

3440 
a
, 
b
, 
c
, 
d
, 
n
, 
mask
, 
®lowed
;

3441 
æag
;

3442 
ušt32_t
 
aş_subÃt
, 
aş_mask
, 
»mÙe_
;

3443 
vec
 vec;

3444 cÚ¡ *
li¡
 = 
ùx
->
cÚfig
[
ACCESS_CONTROL_LIST
];

3446 ià(
li¡
 =ğ
NULL
) {

3450 (è
	`memıy
(&
»mÙe_
, &
u§
->
u
.
sš
.
sš_addr
, (remote_ip));

3453 
®lowed
 = '-';

3455 (
li¡
 = 
	`Ãxt_İtiÚ
Öi¡, &
vec
, 
NULL
)) != NULL) {

3456 
mask
 = 32;

3458 ià(
	`ssÿnf
(
vec
.
±r
, "%c%d.%d.%d.%d%n", &
æag
, &
a
, &
b
, &
c
, &
d
, &
n
) != 5) {

3459 
	`üy
(
	`fc
(
ùx
), "%s: subÃˆmu¡ b[+|-]x.x.x.x[/x]", 
__func__
);

3461 } ià(
æag
 != '+' && flag != '-') {

3462 
	`üy
(
	`fc
(
ùx
), "%s: fÏg mu¡ b+ o¸-: [%s]", 
__func__
, 
vec
.
±r
);

3464 } ià(!
	`isby‹
(
a
)||!isby‹(
b
)||!isby‹(
c
)||!isby‹(
d
)) {

3465 
	`üy
(
	`fc
(
ùx
), "%s: bad i°add»ss: [%s]", 
__func__
, 
vec
.
±r
);

3467 } ià(
	`ssÿnf
(
vec
.
±r
 + 
n
, "/%d", &
mask
) == 0) {

3469 } ià(
mask
 < 0 || mask > 32) {

3470 
	`üy
(
	`fc
(
ùx
), "%s: bad subÃˆmask: %d [%s]", 
__func__
, 
n
, 
vec
.
±r
);

3474 
aş_subÃt
 = (
a
 << 24è| (
b
 << 16è| (
c
 << 8è| 
d
;

3475 
aş_mask
 = 
mask
 ? 0xffffffffU << (32 - mask) : 0;

3477 ià(
aş_subÃt
 =ğ(
	`Áohl
(
»mÙe_
è& 
aş_mask
)) {

3478 
®lowed
 = 
æag
;

3482  
®lowed
 == '+';

3483 
	}
}

3485 
	$add_to_£t
(
SOCKET
 
fd
, 
fd_£t
 *
£t
, *
max_fd
) {

3486 
	`FD_SET
(
fd
, 
£t
);

3487 ià(
fd
 > (
SOCKET
è*
max_fd
) {

3488 *
max_fd
 = (è
fd
;

3490 
	}
}

3492 #ià!
defšed
(
_WIN32
)

3493 
	$£t_uid_İtiÚ
(
mg_cÚ‹xt
 *
ùx
) {

3494 
·sswd
 *
pw
;

3495 cÚ¡ *
uid
 = 
ùx
->
cÚfig
[
RUN_AS_USER
];

3496 
sucûss
 = 0;

3498 ià(
uid
 =ğ
NULL
) {

3499 
sucûss
 = 1;

3501 ià((
pw
 = 
	`g‘pwÇm
(
uid
)è=ğ
NULL
) {

3502 
	`üy
(
	`fc
(
ùx
), "%s: unknowÀu£¸[%s]", 
__func__
, 
uid
);

3503 } ià(
	`£tgid
(
pw
->
pw_gid
) == -1) {

3504 
	`üy
(
	`fc
(
ùx
), "%s: s‘gid(%s): %s", 
__func__
, 
uid
, 
	`¡»¼Ü
(
”ºo
));

3505 } ià(
	`£tuid
(
pw
->
pw_uid
) == -1) {

3506 
	`üy
(
	`fc
(
ùx
), "%s: s‘uid(%s): %s", 
__func__
, 
uid
, 
	`¡»¼Ü
(
”ºo
));

3508 
sucûss
 = 1;

3512  
sucûss
;

3513 
	}
}

3516 #ià!
defšed
(
NO_SSL
)

3517 
±h»ad_mu‹x_t
 *
	gs¦_mu‹xes
;

3519 
	$s¦_lockšg_ÿÎback
(
mode
, 
mu‹x_num
, cÚ¡ *
fe
,

3520 
lše
) {

3521 
lše
 = 0;

3522 
fe
 = 
NULL
;

3524 ià(
mode
 & 
CRYPTO_LOCK
) {

3525 (è
	`±h»ad_mu‹x_lock
(&
s¦_mu‹xes
[
mu‹x_num
]);

3527 (è
	`±h»ad_mu‹x_uÆock
(&
s¦_mu‹xes
[
mu‹x_num
]);

3529 
	}
}

3531 
	$s¦_id_ÿÎback
() {

3532  (è
	`±h»ad_£lf
();

3533 
	}
}

3535 #ià!
defšed
(
NO_SSL_DL
)

3536 
	$lßd_dÎ
(
mg_cÚ‹xt
 *
ùx
, cÚ¡ *
dÎ_Çme
,

3537 
s¦_func
 *
sw
) {

3538 uniÚ {*
p
; (*
å
)();} 
u
;

3539 *
dÎ_hªdË
;

3540 
s¦_func
 *
å
;

3542 ià((
dÎ_hªdË
 = 
	`dlİ’
(
dÎ_Çme
, 
RTLD_LAZY
)è=ğ
NULL
) {

3543 
	`üy
(
	`fc
(
ùx
), "%s: cªnÙ†ßd %s", 
__func__
, 
dÎ_Çme
);

3547 
å
 = 
sw
; fp->
Çme
 !ğ
NULL
; fp++) {

3548 #ifdeà
_WIN32


3550 
u
.
å
 = ((*)()è
	`dlsym
(
dÎ_hªdË
, fp->
Çme
);

3554 
u
.
p
 = 
	`dlsym
(
dÎ_hªdË
, 
å
->
Çme
);

3556 ià(
u
.
å
 =ğ
NULL
) {

3557 
	`üy
(
	`fc
(
ùx
), "%s: %s: cªnÙ fšd %s", 
__func__
, 
dÎ_Çme
, 
å
->
Çme
);

3560 
å
->
±r
 = 
u
.fp;

3565 
	}
}

3569 
	$£t_s¦_İtiÚ
(
mg_cÚ‹xt
 *
ùx
) {

3570 
SSL_CTX
 *
CTX
;

3571 
i
, 
size
;

3572 cÚ¡ *
³m
 = 
ùx
->
cÚfig
[
SSL_CERTIFICATE
];

3573 cÚ¡ *
chaš
 = 
ùx
->
cÚfig
[
SSL_CHAIN_FILE
];

3575 ià(
³m
 =ğ
NULL
) {

3579 #ià!
	`defšed
(
NO_SSL_DL
)

3580 ià(!
	`lßd_dÎ
(
ùx
, 
SSL_LIB
, 
s¦_sw
) ||

3581 !
	`lßd_dÎ
(
ùx
, 
CRYPTO_LIB
, 
üy±o_sw
)) {

3587 
	`SSL_lib¿ry_š™
();

3588 
	`SSL_lßd_”rÜ_¡ršgs
();

3590 ià((
CTX
 = 
	`SSL_CTX_Ãw
(
	`SSLv23_£rv”_m‘hod
())è=ğ
NULL
) {

3591 
	`üy
(
	`fc
(
ùx
), "SSL_CTX_Ãwƒ¼Ü: %s", 
	`s¦_”rÜ
());

3592 } ià(
ùx
->
u£r_ÿÎback
 !ğ
NULL
) {

3593 
ùx
->
	`u£r_ÿÎback
(
MG_INIT_SSL
, (
mg_cÚÃùiÚ
 *è
CTX
, 
NULL
);

3596 ià(
CTX
 !ğ
NULL
 && 
	`SSL_CTX_u£_û¹ifiÿ‹_fe
(CTX, 
³m
,

3597 
SSL_FILETYPE_PEM
) == 0) {

3598 
	`üy
(
	`fc
(
ùx
), "%s: cªnÙ o³À%s: %s", 
__func__
, 
³m
, 
	`s¦_”rÜ
());

3600 } ià(
CTX
 !ğ
NULL
 && 
	`SSL_CTX_u£_Priv©eKey_fe
(CTX, 
³m
,

3601 
SSL_FILETYPE_PEM
) == 0) {

3602 
	`üy
(
	`fc
(
ùx
), "%s: cªnÙ o³À%s: %s", 
NULL
, 
³m
, 
	`s¦_”rÜ
());

3606 ià(
CTX
 !ğ
NULL
 && 
chaš
 != NULL &&

3607 
	`SSL_CTX_u£_û¹ifiÿ‹_chaš_fe
(
CTX
, 
chaš
) == 0) {

3608 
	`üy
(
	`fc
(
ùx
), "%s: cªnÙ o³À%s: %s", 
NULL
, 
chaš
, 
	`s¦_”rÜ
());

3614 
size
 = (è((
±h»ad_mu‹x_t
è* 
	`CRYPTO_num_locks
());

3615 ià((
s¦_mu‹xes
 = (
±h»ad_mu‹x_t
 *è
	`m®loc
((
size_t
)
size
)è=ğ
NULL
) {

3616 
	`üy
(
	`fc
(
ùx
), "%s: cªnÙ‡Îoÿ‹ mu‹xes: %s", 
__func__
, 
	`s¦_”rÜ
());

3620 
i
 = 0; i < 
	`CRYPTO_num_locks
(); i++) {

3621 
	`±h»ad_mu‹x_š™
(&
s¦_mu‹xes
[
i
], 
NULL
);

3624 
	`CRYPTO_£t_lockšg_ÿÎback
(&
s¦_lockšg_ÿÎback
);

3625 
	`CRYPTO_£t_id_ÿÎback
(&
s¦_id_ÿÎback
);

3628 
ùx
->
s¦_ùx
 = 
CTX
;

3631 
	}
}

3634 
	$£t_g·ss_İtiÚ
(
mg_cÚ‹xt
 *
ùx
) {

3635 
mg¡©
 mgstat;

3636 cÚ¡ *
·th
 = 
ùx
->
cÚfig
[
GLOBAL_PASSWORDS_FILE
];

3637  
·th
 =ğ
NULL
 || 
	`mg_¡©
Õ©h, &
mg¡©
) == 0;

3638 
	}
}

3640 
	$£t_aş_İtiÚ
(
mg_cÚ‹xt
 *
ùx
) {

3641 
u§
 
çke
;

3642 
	`mem£t
(&
çke
, 0, (fake));

3643  
	`check_aş
(
ùx
, &
çke
) != -1;

3644 
	}
}

3646 
	$»£t_³r_»que¡_©Œibu‹s
(
mg_cÚÃùiÚ
 *
cÚn
) {

3647 
mg_»que¡_šfo
 *
ri
 = &
cÚn
->
»que¡_šfo
;

3650 ià(
ri
->
»mÙe_u£r
 !ğ
NULL
) {

3651 
	`ä“
((*è
ri
->
»mÙe_u£r
);

3653 ià(
ri
->
ah
 !ğ
NULL
) {

3654 ià(
ri
->
ah
->
ha1
 !ğ
NULL
) {

3655 
	`ä“
((*è
ri
->
ah
->
ha1
);

3657 ià(
ri
->
ah
->
ex³ùed_»¥Ú£
 !ğ
NULL
) {

3658 
	`ä“
((*è
ri
->
ah
->
ex³ùed_»¥Ú£
);

3660 
	`ä“
((*è
ri
->
ah
);

3662 
ri
->
»mÙe_u£r
 =„i->
»que¡_m‘hod
 =„i->
uri
 =„i->
h‰p_v”siÚ
 = 
NULL
;

3663 
ri
->
ah
 = 
NULL
;

3664 
ri
->
num_h—d”s
 = 0;

3665 
ri
->
¡©us_code
 = -1;

3667 ià(
cÚn
->
auth_h—d”
 !ğ
NULL
) {

3668 
	`ä“
((*è
cÚn
->
auth_h—d”
);

3670 
cÚn
->
auth_h—d”
 = 
NULL
;

3671 
cÚn
->
num_by‹s_£Á
 = cÚn->
cÚsumed_cÚ‹Á
 = 0;

3672 
cÚn
->
cÚ‹Á_Ën
 = -1;

3673 
cÚn
->
»que¡_Ën
 = cÚn->
d©a_Ën
 = 0;

3674 
	}
}

3676 
	$şo£_sock‘_g¿ûfuÎy
(
SOCKET
 
sock
) {

3677 
buf
[
BUFSIZ
];

3678 
n
;

3681 (è
	`shutdown
(
sock
, 
SHUT_WR
);

3682 
	`£t_nÚ_blockšg_mode
(
sock
);

3690 
n
 = 
	`puÎ
(
NULL
, 
sock
, NULL, 
buf
, (buf));

3691 } 
n
 > 0);

3694 (è
	`şo£sock‘
(
sock
);

3695 
	}
}

3697 
	$şo£_cÚÃùiÚ
(
mg_cÚÃùiÚ
 *
cÚn
) {

3698 ià(
cÚn
->
s¦
) {

3699 
	`SSL_ä“
(
cÚn
->
s¦
);

3700 
cÚn
->
s¦
 = 
NULL
;

3703 ià(
cÚn
->
ş›Á
.
sock
 !ğ
INVALID_SOCKET
) {

3704 
	`şo£_sock‘_g¿ûfuÎy
(
cÚn
->
ş›Á
.
sock
);

3706 
	}
}

3708 
	$disÿrd_cu¼’t_»que¡_äom_bufãr
(
mg_cÚÃùiÚ
 *
cÚn
) {

3709 *
bufã»d
;

3710 
bufã»d_Ën
, 
body_Ën
;

3712 
bufã»d
 = 
cÚn
->
buf
 + cÚn->
»que¡_Ën
;

3713 
bufã»d_Ën
 = 
cÚn
->
d©a_Ën
 - cÚn->
»que¡_Ën
;

3714 
	`as£¹
(
bufã»d_Ën
 >= 0);

3716 ià(
cÚn
->
cÚ‹Á_Ën
 == -1) {

3717 
body_Ën
 = 0;

3718 } ià(
cÚn
->
cÚ‹Á_Ën
 < (
št64_t
è
bufã»d_Ën
) {

3719 
body_Ën
 = (è
cÚn
->
cÚ‹Á_Ën
;

3721 
body_Ën
 = 
bufã»d_Ën
;

3724 
cÚn
->
d©a_Ën
 -ğcÚn->
»que¡_Ën
 + 
body_Ën
;

3725 
	`memmove
(
cÚn
->
buf
, cÚn->buà+ cÚn->
»que¡_Ën
 + 
body_Ën
, (
size_t
)cÚn->
d©a_Ën
);

3726 
	}
}

3728 
	$·r£_u¾
(cÚ¡ *
u¾
, *
ho¡
, *
pÜt
) {

3729 
Ën
;

3731 ià(
u¾
 =ğ
NULL
) {

3735 ià(!
	`¡ºcmp
(
u¾
, "http://", 7)) {

3736 
u¾
 += 7;

3739 ià(
	`ssÿnf
(
u¾
, "%1024[^:]:%d/%n", 
ho¡
, 
pÜt
, &
Ën
) == 2) {

3741 
	`ssÿnf
(
u¾
, "%1024[^/]/%n", 
ho¡
, &
Ën
);

3742 *
pÜt
 = 80;

3744 
	`DEBUG_TRACE
(("Ho¡:%s,…Üt:%d", 
ho¡
, *
pÜt
));

3746  
Ën
 > 0 && 
u¾
[len - 1] == '/' ?†en - 1 :†en;

3747 
	}
}

3749 
	$hªdË_´oxy_»que¡
(
mg_cÚÃùiÚ
 *
cÚn
) {

3750 
mg_»que¡_šfo
 *
ri
 = &
cÚn
->
»que¡_šfo
;

3751 
ho¡
[1025], 
buf
[
BUFSIZ
];

3752 
pÜt
, 
is_s¦
, 
Ën
, 
i
, 
n
;

3754 
	`DEBUG_TRACE
(("URL: %s", 
ri
->
uri
));

3755 ià(
cÚn
->
»que¡_šfo
.
uri
[0] == '/' ||

3756 (
Ën
 = 
	`·r£_u¾
(
ri
->
uri
, 
ho¡
, &
pÜt
)) == 0) {

3760 ià(
cÚn
->
³”
 =ğ
NULL
) {

3761 
is_s¦
 = !
	`¡rcmp
(
ri
->
»que¡_m‘hod
, "CONNECT");

3762 ià((
cÚn
->
³”
 = 
	`mg_cÚÃù
(cÚn, 
ho¡
, 
pÜt
, 
is_s¦
)è=ğ
NULL
) {

3765 
cÚn
->
³”
->
ş›Á
.
is_s¦
 = is_ssl;

3769 
	`mg_´štf
(
cÚn
->
³”
, "% % HTTP/%s\r\n", 
ri
->
»que¡_m‘hod
,„i->
uri
 + 
Ën
,

3770 
ri
->
h‰p_v”siÚ
);

3773 
i
 = 0; i < 
ri
->
num_h—d”s
; i++) {

3774 
	`mg_´štf
(
cÚn
->
³”
, "%s: %s\r\n", 
ri
->
h‰p_h—d”s
[
i
].
Çme
,

3775 
ri
->
h‰p_h—d”s
[
i
].
v®ue
);

3778 
	`mg_wr™e
(
cÚn
->
³”
, "\r\n", 2);

3781 ià(!
	`¡rcmp
(
ri
->
»que¡_m‘hod
, "POST")) {

3782 
	`fÜw¬d_body_d©a
(
cÚn
, 
NULL
, cÚn->
³”
->
ş›Á
.
sock
, cÚn->³”->
s¦
);

3786 (
n
 = 
	`puÎ
(
NULL
, 
cÚn
->
³”
->
ş›Á
.
sock
, cÚn->³”->
s¦
,

3787 
buf
, (buf))) > 0) {

3788 ià(
	`mg_wr™e
(
cÚn
, 
buf
, (
size_t
)
n
) !=‚) {

3793 ià(!
cÚn
->
³”
->
ş›Á
.
is_s¦
) {

3794 
	`şo£_cÚÃùiÚ
(
cÚn
->
³”
);

3795 
	`ä“
(
cÚn
->
³”
);

3796 
cÚn
->
³”
 = 
NULL
;

3798 
	}
}

3800 
	$is_v®id_uri
(cÚ¡ *
uri
) {

3803  (
uri
[0] == '/' || (uri[0] == '*' && uri[1] == '\0'));

3804 
	}
}

3806 
	$´oûss_Ãw_cÚÃùiÚ
(
mg_cÚÃùiÚ
 *
cÚn
) {

3807 
mg_»que¡_šfo
 *
ri
 = &
cÚn
->
»que¡_šfo
;

3808 
k“p_®ive_’abËd
;

3809 cÚ¡ *
ş
;

3811 
k“p_®ive_’abËd
 = !
	`¡rcmp
(
cÚn
->
ùx
->
cÚfig
[
ENABLE_KEEP_ALIVE
], "yes");

3814 
	`»£t_³r_»que¡_©Œibu‹s
(
cÚn
);

3817 ià((
cÚn
->
»que¡_Ën
 = 
	`g‘_»que¡_Ën
(cÚn->
buf
, cÚn->
d©a_Ën
)) == 0) {

3818 
cÚn
->
»que¡_Ën
 = 
	`»ad_»que¡
(
NULL
, cÚn->
ş›Á
.
sock
, cÚn->
s¦
,

3819 
cÚn
->
buf
, cÚn->
buf_size
, &cÚn->
d©a_Ën
);

3821 
	`as£¹
(
cÚn
->
d©a_Ën
 >ğcÚn->
»que¡_Ën
);

3822 ià(
cÚn
->
»que¡_Ën
 =ğ0 && cÚn->
d©a_Ën
 =ğcÚn->
buf_size
) {

3823 
	`£nd_h‰p_”rÜ
(
cÚn
, 413, "Request Too Large", "");

3825 } ià(
cÚn
->
»que¡_Ën
 <= 0) {

3830 
cÚn
->
buf
[cÚn->
»que¡_Ën
 - 1] = '\0';

3831 ià(!
	`·r£_h‰p_»que¡
(
cÚn
->
buf
, 
ri
) ||

3832 (!
cÚn
->
ş›Á
.
is_´oxy
 && !
	`is_v®id_uri
(
ri
->
uri
))) {

3834 
	`£nd_h‰p_”rÜ
(
cÚn
, 400, "Bad Request",

3835 "CªnÙ…¬£ HTTP„eque¡: [%.*s]", 
cÚn
->
d©a_Ën
, cÚn->
buf
);

3836 } ià(
	`¡rcmp
(
ri
->
h‰p_v”siÚ
, "1.0") &&

3837 
	`¡rcmp
(
ri
->
h‰p_v”siÚ
, "1.1")) {

3839 
	`£nd_h‰p_”rÜ
(
cÚn
, 505, "HTTP version‚ot supported", "");

3840 
	`log_acûss
(
cÚn
);

3843 
ş
 = 
	`g‘_h—d”
(
ri
, "Content-Length");

3844 
cÚn
->
cÚ‹Á_Ën
 = 
ş
 =ğ
NULL
 ? -1 : 
	`¡¹Şl
(cl, NULL, 10);

3845 
cÚn
->
bœth_time
 = 
	`time
(
NULL
);

3846 ià(
cÚn
->
ş›Á
.
is_´oxy
) {

3847 
	`hªdË_´oxy_»que¡
(
cÚn
);

3849 
	`hªdË_»que¡
(
cÚn
);

3851 
	`log_acûss
(
cÚn
);

3852 
	`disÿrd_cu¼’t_»que¡_äom_bufãr
(
cÚn
);

3855 } 
cÚn
->
³”
 || (
k“p_®ive_’abËd
 && 
	`should_k“p_®ive
(conn)));

3856 
	`»£t_³r_»que¡_©Œibu‹s
(
cÚn
);

3857 
	}
}

3860 
	$cÚsume_sock‘
(
mg_cÚ‹xt
 *
ùx
, 
sock‘
 *
¥
) {

3861 (è
	`±h»ad_mu‹x_lock
(&
ùx
->
mu‹x
);

3862 
	`DEBUG_TRACE
(("going idle"));

3865 
ùx
->
sq_h—d
 =ğùx->
sq_
 && ctx->
¡İ_æag
 == 0) {

3866 
	`±h»ad_cÚd_wa™
(&
ùx
->
sq_fuÎ
, &ùx->
mu‹x
);

3870 ià(
ùx
->
¡İ_æag
) {

3871 (è
	`±h»ad_mu‹x_uÆock
(&
ùx
->
mu‹x
);

3874 
	`as£¹
(
ùx
->
sq_h—d
 > ctx->
sq_
);

3877 *
¥
 = 
ùx
->
queue
[ùx->
sq_
 % 
	`ARRAY_SIZE
(ctx->queue)];

3878 
ùx
->
sq_
++;

3879 
	`DEBUG_TRACE
(("g¿bbed sock‘ %d, gošg busy", 
¥
->
sock
));

3882 
ùx
->
sq_
 > (è
	`ARRAY_SIZE
(ùx->
queue
)) {

3883 
ùx
->
sq_
 -ğ(è
	`ARRAY_SIZE
(ùx->
queue
);

3884 
ùx
->
sq_h—d
 -ğ(è
	`ARRAY_SIZE
(ùx->
queue
);

3887 (è
	`±h»ad_cÚd_sigÇl
(&
ùx
->
sq_em±y
);

3888 (è
	`±h»ad_mu‹x_uÆock
(&
ùx
->
mu‹x
);

3891 
	}
}

3893 
	$wÜk”_th»ad
(
mg_cÚ‹xt
 *
ùx
) {

3894 
mg_cÚÃùiÚ
 *
cÚn
;

3895 
buf_size
 = 
	`©oi
(
ùx
->
cÚfig
[
MAX_REQUEST_SIZE
]);

3897 
cÚn
 = (
mg_cÚÃùiÚ
*è
	`ÿÎoc
(1, (*cÚnè+ 
buf_size
);

3898 
cÚn
->
buf_size
 = buf_size;

3899 
cÚn
->
buf
 = (*) (conn + 1);

3900 
	`as£¹
(
cÚn
 !ğ
NULL
);

3902 
ùx
->
¡İ_æag
 =ğ0 && 
	`cÚsume_sock‘
(ùx, &
cÚn
->
ş›Á
)) {

3903 
cÚn
->
bœth_time
 = 
	`time
(
NULL
);

3904 
cÚn
->
ùx
 = ctx;

3909 
cÚn
->
»que¡_šfo
.
»mÙe_pÜt
 = 
	`Áohs
(cÚn->
ş›Á
.
r§
.
u
.
sš
.
sš_pÜt
);

3910 
	`memıy
(&
cÚn
->
»que¡_šfo
.
»mÙe_
,

3911 &
cÚn
->
ş›Á
.
r§
.
u
.
sš
.
sš_addr
.
s_addr
, 4);

3912 
cÚn
->
»que¡_šfo
.
»mÙe_
 = (
ušt32_t
è
	`Áohl
(conn->request_info.remote_ip);

3913 
cÚn
->
»que¡_šfo
.
is_s¦
 = cÚn->
ş›Á
.is_ssl;

3915 ià(!
cÚn
->
ş›Á
.
is_s¦
 ||

3916 (
cÚn
->
ş›Á
.
is_s¦
 && 
	`s¦ize
(cÚn, 
SSL_acû±
))) {

3917 
	`´oûss_Ãw_cÚÃùiÚ
(
cÚn
);

3920 
	`şo£_cÚÃùiÚ
(
cÚn
);

3922 
	`ä“
(
cÚn
);

3925 (è
	`±h»ad_mu‹x_lock
(&
ùx
->
mu‹x
);

3926 
ùx
->
num_th»ads
--;

3927 (è
	`±h»ad_cÚd_sigÇl
(&
ùx
->
cÚd
);

3928 
	`as£¹
(
ùx
->
num_th»ads
 >= 0);

3929 (è
	`±h»ad_mu‹x_uÆock
(&
ùx
->
mu‹x
);

3931 
	`DEBUG_TRACE
(("exiting"));

3932 
	}
}

3935 
	$´oduû_sock‘
(
mg_cÚ‹xt
 *
ùx
, cÚ¡ 
sock‘
 *
¥
) {

3936 (è
	`±h»ad_mu‹x_lock
(&
ùx
->
mu‹x
);

3939 
ùx
->
sq_h—d
 - ctx->
sq_
 >ğ(è
	`ARRAY_SIZE
(ùx->
queue
)) {

3940 (è
	`±h»ad_cÚd_wa™
(&
ùx
->
sq_em±y
, &ùx->
mu‹x
);

3942 
	`as£¹
(
ùx
->
sq_h—d
 - ctx->
sq_
 < (è
	`ARRAY_SIZE
(ùx->
queue
));

3945 
ùx
->
queue
[ùx->
sq_h—d
 % 
	`ARRAY_SIZE
(ùx->queue)] = *
¥
;

3946 
ùx
->
sq_h—d
++;

3947 
	`DEBUG_TRACE
(("queued sock‘ %d", 
¥
->
sock
));

3949 (è
	`±h»ad_cÚd_sigÇl
(&
ùx
->
sq_fuÎ
);

3950 (è
	`±h»ad_mu‹x_uÆock
(&
ùx
->
mu‹x
);

3951 
	}
}

3953 
	$acû±_Ãw_cÚÃùiÚ
(cÚ¡ 
sock‘
 *
li¡’”
,

3954 
mg_cÚ‹xt
 *
ùx
) {

3955 
sock‘
 
acû±ed
;

3956 
®lowed
;

3958 
acû±ed
.
r§
.
Ën
 = ×cû±ed.r§.
u
.
sš
);

3959 
acû±ed
.
l§
 = 
li¡’”
->lsa;

3960 
acû±ed
.
sock
 = 
	`acû±
(
li¡’”
->sock, &acû±ed.
r§
.
u
.
§
, &acû±ed.r§.
Ën
);

3961 ià(
acû±ed
.
sock
 !ğ
INVALID_SOCKET
) {

3962 
®lowed
 = 
	`check_aş
(
ùx
, &
acû±ed
.
r§
);

3963 ià(
®lowed
) {

3965 
	`DEBUG_TRACE
(("acû±ed sock‘ %d", 
acû±ed
.
sock
));

3966 
acû±ed
.
is_s¦
 = 
li¡’”
->is_ssl;

3967 
acû±ed
.
is_´oxy
 = 
li¡’”
->is_proxy;

3968 
	`´oduû_sock‘
(
ùx
, &
acû±ed
);

3970 
	`üy
(
	`fc
(
ùx
), "%s: %s is‚ot‡llowedo connect",

3971 
__func__
, 
	`š‘_Áß
(
acû±ed
.
r§
.
u
.
sš
.
sš_addr
));

3972 (è
	`şo£sock‘
(
acû±ed
.
sock
);

3975 
	}
}

3977 
	$ma¡”_th»ad
(
mg_cÚ‹xt
 *
ùx
) {

3978 
fd_£t
 
»ad_£t
;

3979 
timev®
 
tv
;

3980 
sock‘
 *
¥
;

3981 
max_fd
;

3983 
ùx
->
¡İ_æag
 == 0) {

3984 
	`FD_ZERO
(&
»ad_£t
);

3985 
max_fd
 = -1;

3988 
¥
 = 
ùx
->
li¡’šg_sock‘s
; s°!ğ
NULL
; s°ğ¥->
Ãxt
) {

3989 
	`add_to_£t
(
¥
->
sock
, &
»ad_£t
, &
max_fd
);

3992 
tv
.
tv_£c
 = 0;

3993 
tv
.
tv_u£c
 = 200 * 1000;

3995 ià(
	`£Ëù
(
max_fd
 + 1, &
»ad_£t
, 
NULL
, NULL, &
tv
) < 0) {

3996 #ifdeà
_WIN32


4000 
	`¦“p
(1);

4003 
¥
 = 
ùx
->
li¡’šg_sock‘s
; s°!ğ
NULL
; s°ğ¥->
Ãxt
) {

4004 ià(
	`FD_ISSET
(
¥
->
sock
, &
»ad_£t
)) {

4005 
	`acû±_Ãw_cÚÃùiÚ
(
¥
, 
ùx
);

4010 
	`DEBUG_TRACE
(("stopping workers"));

4013 
	`şo£_®l_li¡’šg_sock‘s
(
ùx
);

4016 
	`±h»ad_cÚd_brßdÿ¡
(&
ùx
->
sq_fuÎ
);

4019 (è
	`±h»ad_mu‹x_lock
(&
ùx
->
mu‹x
);

4020 
ùx
->
num_th»ads
 > 0) {

4021 (è
	`±h»ad_cÚd_wa™
(&
ùx
->
cÚd
, &ùx->
mu‹x
);

4023 (è
	`±h»ad_mu‹x_uÆock
(&
ùx
->
mu‹x
);

4026 (è
	`±h»ad_mu‹x_de¡roy
(&
ùx
->
mu‹x
);

4027 (è
	`±h»ad_cÚd_de¡roy
(&
ùx
->
cÚd
);

4028 (è
	`±h»ad_cÚd_de¡roy
(&
ùx
->
sq_em±y
);

4029 (è
	`±h»ad_cÚd_de¡roy
(&
ùx
->
sq_fuÎ
);

4032 
ùx
->
¡İ_æag
 = 2;

4034 
	`DEBUG_TRACE
(("exiting"));

4035 
	}
}

4037 
	$ä“_cÚ‹xt
(
mg_cÚ‹xt
 *
ùx
) {

4038 
i
;

4041 
i
 = 0; i < 
NUM_OPTIONS
; i++) {

4042 ià(
ùx
->
cÚfig
[
i
] !ğ
NULL
)

4043 
	`ä“
(
ùx
->
cÚfig
[
i
]);

4047 ià(
ùx
->
s¦_ùx
 !ğ
NULL
) {

4048 
	`SSL_CTX_ä“
(
ùx
->
s¦_ùx
);

4050 #iâdeà
NO_SSL


4051 ià(
s¦_mu‹xes
 !ğ
NULL
) {

4052 
	`ä“
(
s¦_mu‹xes
);

4057 
	`ä“
(
ùx
);

4058 
	}
}

4060 
	$mg_¡İ
(
mg_cÚ‹xt
 *
ùx
) {

4061 
ùx
->
¡İ_æag
 = 1;

4064 
ùx
->
¡İ_æag
 != 2) {

4065 (è
	`¦“p
(0);

4067 
	`ä“_cÚ‹xt
(
ùx
);

4069 #ià
	`defšed
(
_WIN32
)

4070 (è
	`WSACËªup
();

4072 
	}
}

4074 
mg_cÚ‹xt
 *
	$mg_¡¬t
(
mg_ÿÎback_t
 
u£r_ÿÎback
, *
u£r_d©a
,

4075 cÚ¡ **
İtiÚs
) {

4076 
mg_cÚ‹xt
 *
ùx
;

4077 cÚ¡ *
Çme
, *
v®ue
, *
deçuÉ_v®ue
;

4078 
i
;

4080 #ià
	`defšed
(
_WIN32
)

4081 
WSADATA
 
d©a
;

4082 
	`WSAS¹up
(
	`MAKEWORD
(2,2), &
d©a
);

4087 
ùx
 = (
mg_cÚ‹xt
*è
	`ÿÎoc
(1, (*ctx));

4088 
ùx
->
u£r_ÿÎback
 = user_callback;

4089 
ùx
->
u£r_d©a
 = user_data;

4091 
İtiÚs
 && (
Çme
 = *İtiÚs++è!ğ
NULL
) {

4092 ià((
i
 = 
	`g‘_İtiÚ_šdex
(
Çme
)) == -1) {

4093 
	`üy
(
	`fc
(
ùx
), "Inv®id o±iÚ: %s", 
Çme
);

4094 
	`ä“_cÚ‹xt
(
ùx
);

4095  
NULL
;

4096 } ià((
v®ue
 = *
İtiÚs
++è=ğ
NULL
) {

4097 
	`üy
(
	`fc
(
ùx
), "%s: o±iÚ v®uÿÂÙ bNULL", 
Çme
);

4098 
	`ä“_cÚ‹xt
(
ùx
);

4099  
NULL
;

4101 
ùx
->
cÚfig
[
i
] = 
	`mg_¡rdup
(
v®ue
);

4102 
	`DEBUG_TRACE
(("[%s] -> [%s]", 
Çme
, 
v®ue
));

4106 
i
 = 0; 
cÚfig_İtiÚs
[˜* 
ENTRIES_PER_CONFIG_OPTION
] !ğ
NULL
; i++) {

4107 
deçuÉ_v®ue
 = 
cÚfig_İtiÚs
[
i
 * 
ENTRIES_PER_CONFIG_OPTION
 + 2];

4108 ià(
ùx
->
cÚfig
[
i
] =ğ
NULL
 && 
deçuÉ_v®ue
 != NULL) {

4109 
ùx
->
cÚfig
[
i
] = 
	`mg_¡rdup
(
deçuÉ_v®ue
);

4110 
	`DEBUG_TRACE
(("Setting default: [%s] -> [%s]",

4111 
cÚfig_İtiÚs
[
i
 * 
ENTRIES_PER_CONFIG_OPTION
 + 1],

4112 
deçuÉ_v®ue
));

4118 ià(!
	`£t_g·ss_İtiÚ
(
ùx
) ||

4119 #ià!
	`defšed
(
NO_SSL
)

4120 !
	`£t_s¦_İtiÚ
(
ùx
) ||

4122 !
	`£t_pÜts_İtiÚ
(
ùx
) ||

4123 #ià!
	`defšed
(
_WIN32
)

4124 !
	`£t_uid_İtiÚ
(
ùx
) ||

4126 !
	`£t_aş_İtiÚ
(
ùx
)) {

4127 
	`ä“_cÚ‹xt
(
ùx
);

4128  
NULL
;

4131 #ià!
	`defšed
(
_WIN32
)

4134 (è
	`sigÇl
(
SIGPIPE
, 
SIG_IGN
);

4137 (è
	`±h»ad_mu‹x_š™
(&
ùx
->
mu‹x
, 
NULL
);

4138 (è
	`±h»ad_cÚd_š™
(&
ùx
->
cÚd
, 
NULL
);

4139 (è
	`±h»ad_cÚd_š™
(&
ùx
->
sq_em±y
, 
NULL
);

4140 (è
	`±h»ad_cÚd_š™
(&
ùx
->
sq_fuÎ
, 
NULL
);

4143 
	`¡¬t_th»ad
(
ùx
, (
mg_th»ad_func_t
è
ma¡”_th»ad
, ctx);

4146 
i
 = 0; i < 
	`©oi
(
ùx
->
cÚfig
[
NUM_THREADS
]); i++) {

4147 ià(
	`¡¬t_th»ad
(
ùx
, (
mg_th»ad_func_t
è
wÜk”_th»ad
, ctx) != 0) {

4148 
	`üy
(
	`fc
(
ùx
), "CªnÙ s¹ wÜk”h»ad: %d", 
ERRNO
);

4150 
ùx
->
num_th»ads
++;

4154  
ùx
;

4155 
	}
}

4157 *
	$mg_»ad_u£r_d©a
(
mg_cÚÃùiÚ
 *
cÚn
)

4159  
cÚn
->
ùx
->
u£r_d©a
;

4161 
	}
}

	@src/external/vpiotr-mongoose-cpp/mongoose.h

21 #iâdeà
MONGOOSE_HEADER_INCLUDED


22 
	#MONGOOSE_HEADER_INCLUDED


	)

24 #ifdeà
__ılu¥lus


28 
mg_cÚ‹xt
;

29 
mg_cÚÃùiÚ
;

32 
	smg_auth_h—d”
 {

33 cÚ¡ *
u£r
, *
uri
, *
úÚû
, *
»¥Ú£
, *
qİ
, *
nc
, *
nÚû
;

36 *
ha1
;

37 *
ex³ùed_»¥Ú£
;

41 
	smg_»que¡_šfo
 {

42 *
u£r_d©a
;

43 *
»que¡_m‘hod
;

44 *
uri
;

45 *
h‰p_v”siÚ
;

46 *
qu”y_¡ršg
;

47 *
»mÙe_u£r
;

48 *
log_mes§ge
;

49 
»mÙe_
;

50 
»mÙe_pÜt
;

51 
¡©us_code
;

52 
is_s¦
;

53 
num_h—d”s
;

54 
	smg_h—d”
 {

55 *
Çme
;

56 *
v®ue
;

57 } 
h‰p_h—d”s
[64];

58 
mg_auth_h—d”
 *
ah
;

62 
	emg_ev’t
 {

63 
MG_NEW_REQUEST
,

64 
MG_HTTP_ERROR
,

65 
MG_EVENT_LOG
,

66 
MG_INIT_SSL
,

68 
MG_AUTHENTICATE
,

88 * (*
	tmg_ÿÎback_t
)(
	tmg_ev’t
 
	tev’t
,

89 
	tmg_cÚÃùiÚ
 *
	tcÚn
,

90 cÚ¡ 
	tmg_»que¡_šfo
 *
	t»que¡_šfo
);

113 
mg_cÚ‹xt
 *
mg_¡¬t
(
mg_ÿÎback_t
 
ÿÎback
, *
u£r_d©a
,

114 cÚ¡ **
İtiÚs
);

122 
mg_¡İ
(
mg_cÚ‹xt
 *);

131 cÚ¡ *
mg_g‘_İtiÚ
(cÚ¡ 
mg_cÚ‹xt
 *
ùx
, cÚ¡ *
Çme
);

137 cÚ¡ **
mg_g‘_v®id_İtiÚ_Çmes
();

152 
mg_modify_·sswÜds_fe
(
mg_cÚ‹xt
 *
ùx
,

153 cÚ¡ *
·sswÜds_fe_Çme
, cÚ¡ *
u£r
, cÚ¡ *
·sswÜd
);

156 
mg_wr™e
(
mg_cÚÃùiÚ
 *, cÚ¡ *
buf
, 
size_t
 
Ën
);

165 
mg_´štf
(
mg_cÚÃùiÚ
 *, cÚ¡ *
fmt
, ...);

169 
mg_»ad
(
mg_cÚÃùiÚ
 *, *
buf
, 
size_t
 
Ën
);

177 
mg_£nd_authÜiz©iÚ_»que¡
(
mg_cÚÃùiÚ
 *
cÚn
, cÚ¡ *
nÚû
);

184 cÚ¡ *
mg_g‘_h—d”
(cÚ¡ 
mg_cÚÃùiÚ
 *, cÚ¡ *
Çme
);

203 
mg_g‘_v¬
(cÚ¡ *
d©a
, 
size_t
 
d©a_Ën
,

204 cÚ¡ *
v¬_Çme
, *
buf
, 
size_t
 
buf_Ën
);

217 
mg_g‘_cook›
(cÚ¡ 
mg_cÚÃùiÚ
 *,

218 cÚ¡ *
cook›_Çme
, *
buf
, 
size_t
 
buf_Ën
);

222 cÚ¡ *
mg_v”siÚ
();

231 
mg_md5
(*
buf
, ...);

235 *
mg_»ad_u£r_d©a
(
mg_cÚÃùiÚ
 *
cÚn
);

237 #ifdeà
__ılu¥lus


	@src/external/vpiotr-mongoose-cpp/test/embed.c

24 
	~<¡dlib.h
>

25 
	~<¡dio.h
>

26 
	~<¡ršg.h
>

27 #iâdeà
_WIN32


28 
	~<uni¡d.h
>

31 
	~"mÚgoo£.h
"

33 #ià!
defšed
(
LISTENING_PORT
)

34 
	#LISTENING_PORT
 "23456"

	)

37 cÚ¡ *
	g¡ªd¬d_»¶y
 = "HTTP/1.1 200 OK\r\n"

41 
	$‹¡_g‘_v¬
(
mg_cÚÃùiÚ
 *
cÚn
,

42 cÚ¡ 
mg_»que¡_šfo
 *
ri
) {

43 *
v¬
, *
buf
;

44 
size_t
 
buf_Ën
;

45 cÚ¡ *
ş
;

46 
v¬_Ën
;

48 
	`mg_´štf
(
cÚn
, "%s", 
¡ªd¬d_»¶y
);

50 
buf_Ën
 = 0;

51 
v¬
 = 
buf
 = 
NULL
;

52 
ş
 = 
	`mg_g‘_h—d”
(
cÚn
, "Content-Length");

53 
	`mg_´štf
(
cÚn
, "ş: %p\n", 
ş
);

54 ià((!
	`¡rcmp
(
ri
->
»que¡_m‘hod
, "POST") ||

55 !
	`¡rcmp
(
ri
->
»que¡_m‘hod
, "PUT"))

56 && 
ş
 !ğ
NULL
) {

57 
buf_Ën
 = 
	`©oi
(
ş
);

58 
buf
 = 
	`m®loc
(
buf_Ën
);

60 ià(
buf_Ën
 > 2) {

61 
	`mg_»ad
(
cÚn
, 
buf
, 2);

62 
	`mg_»ad
(
cÚn
, 
buf
 + 2, 
buf_Ën
 - 2);

64 
	`mg_»ad
(
cÚn
, 
buf
, 
buf_Ën
);

66 } ià(
ri
->
qu”y_¡ršg
 !ğ
NULL
) {

67 
buf_Ën
 = 
	`¡¾’
(
ri
->
qu”y_¡ršg
);

68 
buf
 = 
	`m®loc
(
buf_Ën
 + 1);

69 
	`¡rıy
(
buf
, 
ri
->
qu”y_¡ršg
);

71 
v¬
 = 
	`m®loc
(
buf_Ën
 + 1);

72 
v¬_Ën
 = 
	`mg_g‘_v¬
(
buf
, 
buf_Ën
, "my_v¬", 
v¬
, buf_len + 1);

73 
	`mg_´štf
(
cÚn
, "V®ue: [%s]\n", 
v¬
);

74 
	`mg_´štf
(
cÚn
, "V®usize: [%d]\n", 
v¬_Ën
);

75 
	`ä“
(
buf
);

76 
	`ä“
(
v¬
);

77 
	}
}

79 
	$‹¡_g‘_h—d”
(
mg_cÚÃùiÚ
 *
cÚn
,

80 cÚ¡ 
mg_»que¡_šfo
 *
ri
) {

81 cÚ¡ *
v®ue
;

82 
i
;

84 
	`mg_´štf
(
cÚn
, "%s", 
¡ªd¬d_»¶y
);

85 
	`´štf
("HTTP h—d”s: %d\n", 
ri
->
num_h—d”s
);

86 
i
 = 0; i < 
ri
->
num_h—d”s
; i++) {

87 
	`´štf
("[%s]: [%s]\n", 
ri
->
h‰p_h—d”s
[
i
].
Çme
,„i->h‰p_h—d”s[i].
v®ue
);

90 
v®ue
 = 
	`mg_g‘_h—d”
(
cÚn
, "Host");

91 ià(
v®ue
 !ğ
NULL
) {

92 
	`mg_´štf
(
cÚn
, "V®ue: [%s]", 
v®ue
);

94 
	}
}

96 
	$‹¡_g‘_»que¡_šfo
(
mg_cÚÃùiÚ
 *
cÚn
,

97 cÚ¡ 
mg_»que¡_šfo
 *
ri
) {

98 
i
;

100 
	`mg_´štf
(
cÚn
, "%s", 
¡ªd¬d_»¶y
);

102 
	`mg_´štf
(
cÚn
, "M‘hod: [%s]\n", 
ri
->
»que¡_m‘hod
);

103 
	`mg_´štf
(
cÚn
, "URI: [%s]\n", 
ri
->
uri
);

104 
	`mg_´štf
(
cÚn
, "HTTP v”siÚ: [%s]\n", 
ri
->
h‰p_v”siÚ
);

106 
i
 = 0; i < 
ri
->
num_h—d”s
; i++) {

107 
	`mg_´štf
(
cÚn
, "HTTP header [%s]: [%s]\n",

108 
ri
->
h‰p_h—d”s
[
i
].
Çme
,

109 
ri
->
h‰p_h—d”s
[
i
].
v®ue
);

112 
	`mg_´štf
(
cÚn
, "Query string: [%s]\n",

113 
ri
->
qu”y_¡ršg
 ?„i->query_string: "");

114 
	`mg_´štf
(
cÚn
, "RemÙIP: [%lu]\n", 
ri
->
»mÙe_
);

115 
	`mg_´štf
(
cÚn
, "RemÙpÜt: [%d]\n", 
ri
->
»mÙe_pÜt
);

116 
	`mg_´štf
(
cÚn
, "Remote user: [%s]\n",

117 
ri
->
»mÙe_u£r
 ?„i->remote_user : "");

118 
	}
}

120 
	$‹¡_”rÜ
(
mg_cÚÃùiÚ
 *
cÚn
,

121 cÚ¡ 
mg_»que¡_šfo
 *
ri
) {

122 
	`mg_´štf
(
cÚn
, "HTTP/1.1 %d XX\r\n"

123 "CÚÁeùiÚ: clo£\r\n\r\n", 
ri
->
¡©us_code
);

124 
	`mg_´štf
(
cÚn
, "E¼Ü: [%d]", 
ri
->
¡©us_code
);

125 
	}
}

127 
	$‹¡_po¡
(
mg_cÚÃùiÚ
 *
cÚn
,

128 cÚ¡ 
mg_»que¡_šfo
 *
ri
) {

129 cÚ¡ *
ş
;

130 *
buf
;

131 
Ën
;

133 
	`mg_´štf
(
cÚn
, "%s", 
¡ªd¬d_»¶y
);

134 ià(
	`¡rcmp
(
ri
->
»que¡_m‘hod
, "POST") == 0 &&

135 (
ş
 = 
	`mg_g‘_h—d”
(
cÚn
, "CÚ‹Á-L’gth")è!ğ
NULL
) {

136 
Ën
 = 
	`©oi
(
ş
);

137 ià((
buf
 = 
	`m®loc
(
Ën
)è!ğ
NULL
) {

138 
	`mg_wr™e
(
cÚn
, 
buf
, 
Ën
);

139 
	`ä“
(
buf
);

142 
	}
}

144 cÚ¡ 
	s‹¡_cÚfig
 {

145 
mg_ev’t
 
	mev’t
;

146 cÚ¡ *
	muri
;

147 (*
	mfunc
)(
	mmg_cÚÃùiÚ
 *, cÚ¡ 
	mmg_»que¡_šfo
 *);

148 } 
	g‹¡_cÚfig
[] = {

149 {
MG_NEW_REQUEST
, "/‹¡_g‘_h—d”", &
‹¡_g‘_h—d”
},

150 {
MG_NEW_REQUEST
, "/‹¡_g‘_v¬", &
‹¡_g‘_v¬
},

151 {
MG_NEW_REQUEST
, "/‹¡_g‘_»que¡_šfo", &
‹¡_g‘_»que¡_šfo
},

152 {
MG_NEW_REQUEST
, "/‹¡_po¡", &
‹¡_po¡
},

153 {
MG_HTTP_ERROR
, "", &
‹¡_”rÜ
},

154 {0, 
NULL
, NULL}

157 *
	$ÿÎback
(
mg_ev’t
 
ev’t
,

158 
mg_cÚÃùiÚ
 *
cÚn
,

159 cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
) {

160 
i
;

162 
i
 = 0; 
‹¡_cÚfig
[i].
uri
 !ğ
NULL
; i++) {

163 ià(
ev’t
 =ğ
‹¡_cÚfig
[
i
].event &&

164 (
ev’t
 =ğ
MG_HTTP_ERROR
 ||

165 !
	`¡rcmp
(
»que¡_šfo
->
uri
, 
‹¡_cÚfig
[
i
].uri))) {

166 
‹¡_cÚfig
[
i
].
	`func
(
cÚn
, 
»que¡_šfo
);

171  
NULL
;

172 
	}
}

174 
	$maš
() {

175 
mg_cÚ‹xt
 *
ùx
;

176 cÚ¡ *
İtiÚs
[] = {"li¡’šg_pÜts", 
LISTENING_PORT
, 
NULL
};

178 
ùx
 = 
	`mg_¡¬t
(
ÿÎback
, 
NULL
, 
İtiÚs
);

179 
	`·u£
();

181 
	}
}

	@src/external/vpiotr-mongoose-cpp/test/mongotest.cpp

12 
	~<io¡»am
>

13 
	~<time.h
>

14 
	~<s¡»am
>

16 
	~"mÚgıp.h
"

19 
usšg
 
Çme¥aû
 
	gmÚgoo£
;

20 
usšg
 
Çme¥aû
 
	g¡d
;

22 
	g‹m¶©e
 <
şass
 
	gT
>

23 
šlše
 
	g¡d
::
¡ršg
 
	$toSŒšg
 (cÚ¡ 
T
& 
t
)

25 
¡d
::
¡ršg¡»am
 
ss
;

26 
ss
 << 
t
;

27  
ss
.
	`¡r
();

28 
	}
}

30 
¡ršg
 
	$ToSŒšg
(

)

32 
¡ršg
 
»s
;

33 
wÜkIp
, 
a
, 
b
, 
c
, 
d
;

34 
wÜkIp
 = 

;

35 
d
 = 
wÜkIp
 % 0x100;

36 
wÜkIp
 = workIp >> 8;

37 
c
 = 
wÜkIp
 % 0x100;

38 
wÜkIp
 = workIp >> 8;

39 
b
 = 
wÜkIp
 % 0x100;

40 
wÜkIp
 = workIp >> 8;

41 
a
 = 
wÜkIp
;

42 
»s
 = 
	`toSŒšg
(
a
)+"."+toSŒšg(
b
)+"."+toSŒšg(
c
)+"."+toSŒšg(
d
);

43  
»s
;

44 
	}
}

46 şas 
	cTe¡MÚgoS”v”
: 
public
 
MÚgoo£S”v”
 {

47 
public
:

48 
	$Te¡MÚgoS”v”
(): 
	$MÚgoo£S”v”
() {}

49 
vœtu®
 ~
	$Te¡MÚgoS”v”
(è{
	}
}

50 
´Ùeùed
:

51 
vœtu®
 
boŞ
 
	$hªdËEv’t
(
S”v”HªdlšgEv’t
 
ev’tCode
, 
MÚgoo£CÚÃùiÚ
 &
cÚÃùiÚ
, cÚ¡ 
MÚgoo£Reque¡
 &
»que¡
, 
MÚgoo£Re¥Ú£
 &
»¥Ú£
) {

52 
boŞ
 
»s
 = 
çl£
;

54 ià(
ev’tCode
 =ğ
MG_NEW_REQUEST
) {

55 ià(
»que¡
.
	`g‘Uri
(è=ğ
	`¡ršg
("/info")) {

56 
	`hªdËInfo
(
»que¡
, 
»¥Ú£
);

57 
»s
 = 
Œue
;

61  
»s
;

62 
	}
}

64 
	$hªdËInfo
(cÚ¡ 
MÚgoo£Reque¡
 &
»que¡
, 
MÚgoo£Re¥Ú£
 &
»¥Ú£
) {

65 
»¥Ú£
.
	`£tStus
(200);

66 
»¥Ú£
.
	`£tCÚÃùiÚAlive
(
çl£
);

67 
»¥Ú£
.
	`£tCacheDi§bËd
();

68 
»¥Ú£
.
	`£tCÚ‹ÁTy³
("text/html");

69 
»¥Ú£
.
	`addCÚ‹Á
(
	`g’”©eInfoCÚ‹Á
(
»que¡
));

70 
»¥Ú£
.
	`wr™e
();

71 
	}
}

73 cÚ¡ 
¡ršg
 
	$g’”©eInfoCÚ‹Á
(cÚ¡ 
MÚgoo£Reque¡
 &
»que¡
) {

74 
¡ršg
 
»suÉ
;

75 
»suÉ
 = "<h1>Sample Info Page</h1>";

76 
»suÉ
 +ğ"<b¸/>Reque¡ URI: " + 
»que¡
.
	`g‘Uri
();

77 
»suÉ
 +ğ"<b¸/>You¸IP: " + 
	`ToSŒšg
(
»que¡
.
	`g‘RemÙeIp
());

79 
time_t
 
tim
;

80 
	`time
(&
tim
);

82 
»suÉ
 +ğ"<b¸/>Cu¼’ˆd©&ime: " + 
	`toSŒšg
(
	`ùime
(&
tim
));

83 
»suÉ
 += "<br /><br /><a href=\"/\">Index…age</a>";

85  
»suÉ
;

86 
	}
}

89 
	$maš
()

91 
Te¡MÚgoS”v”
 
£rv”
;

93 
£rv”
.
	`£tO±iÚ
("document_root", "html");

94 
£rv”
.
	`£tO±iÚ
("listening_ports", "8080");

95 
£rv”
.
	`£tO±iÚ
("num_threads", "5");

97 
£rv”
.
	`¡¬t
();

99 
cout
 << "Te¡ s”v” s¹ed,…»s ’‹¸tØqu™..." << 
’dl
;

100 
cš
.
	`ignÜe
();

102 
£rv”
.
	`¡İ
();

103 
cout
 << "Te¡ s”v” stİ³d" << 
’dl
;

104 
	}
}

	@src/graphchi_basic_includes.hpp

32 #iâdeà
GRAPHCHI_DEF_ALLBASIC_INCLUDES


33 
	#GRAPHCHI_DEF_ALLBASIC_INCLUDES


	)

35 
	~<omp.h
>

36 
	~<s¡»am
>

38 
	~"­i/chif’ames.hµ
"

39 
	~"­i/g¿phchi_cÚ‹xt.hµ
"

40 
	~"­i/g¿phchi_´og¿m.hµ
"

41 
	~"­i/g¿ph_objeùs.hµ
"

42 
	~"­i/ischeduËr.hµ
"

43 
	~"­i/v”‹x_agg»g©Ü.hµ
"

45 
	~"’gše/g¿phchi_’gše.hµ
"

47 
	~"logg”/logg”.hµ
"

49 
	~"m‘rics/m‘rics.hµ
"

50 
	~"m‘rics/»ps/basic_»pÜ‹r.hµ
"

51 
	~"m‘rics/»ps/fe_»pÜ‹r.hµ
"

52 
	~"m‘rics/»ps/html_»pÜ‹r.hµ
"

54 
	~"´•roûssšg/cÚv”siÚs.hµ
"

56 
	~"ut/cmdİts.hµ
"

59 
Çme¥aû
 
	gg¿phchi
 {

64 
VARIABLE_IS_NOT_USED
 
m‘rics_»pÜt
(
m‘rics
 &
m
);

65 
VARIABLE_IS_NOT_USED
 
m‘rics_»pÜt
(
m‘rics
 &
m
) {

66 
	g¡d
::
¡ršg
 
»pÜ‹rs
 = 
g‘_İtiÚ_¡ršg
("metrics.reporter", "console");

67 * 
	gü•s
 = (*)
»pÜ‹rs
.
c_¡r
();

68 cÚ¡ * 
	gd–ims
 = ",";

69 * 
	gt
 = 
¡¹ok
(
ü•s
, 
d–ims
);

71 
	gt
 !ğ
NULL
) {

72 
¡d
::
¡ršg
 
»²ame
(
t
);

73 ià(
	g»²ame
 =ğ"basic" || 
»²ame
 == "console") {

74 
basic_»pÜ‹r
 
»p
;

75 
	gm
.
»pÜt
(
»p
);

76 } ià(
	g»²ame
 == "file") {

77 
fe_»pÜ‹r
 
»p
(
g‘_İtiÚ_¡ršg
("metrics.reporter.filename", "metrics.txt"));

78 
	gm
.
»pÜt
(
»p
);

79 } ià(
	g»²ame
 == "html") {

80 
html_»pÜ‹r
 
»p
(
g‘_İtiÚ_¡ršg
("metrics.reporter.htmlfile", "metrics.html"));

81 
	gm
.
»pÜt
(
»p
);

83 
log¡»am
(
LOG_WARNING
è<< "Could‚Ù fšd m‘ric »pÜ‹¸w™h‚am[" << 
	g»²ame
 << "], ignÜšg." << 
	g¡d
::
’dl
;

85 
	gt
 = 
¡¹ok
(
NULL
, 
d–ims
);

	@src/graphchi_types.hpp

18 #iâdeà
DEF_GRAPHCHI_TYPES


19 
	#DEF_GRAPHCHI_TYPES


	)

22 
	~<¡dšt.h
>

24 
Çme¥aû
 
	gg¿phchi
 {

26 
ušt32_t
 
	tvid_t
;

33 
	g‹m¶©e
 <
ty³Çme
 
	gET
>

34 
	sPaœCÚš”
 {

35 
ET
 
	gËá
;

36 
ET
 
	gright
;

38 
PaœCÚš”
() {

39 
	gËá
 = 
ET
();

40 
	gright
 = 
ET
();

43 
	gET
 & 
Şdv®
(
™”
) {

44  (
	g™”
 % 2 =ğ0 ? 
Ëá
 : 
right
);

47 
£t_Ãwv®
(
™”
, 
ET
 
x
) {

48 ià(
	g™”
 % 2 == 0) {

49 
right
 = 
x
;

51 
	gËá
 = 
x
;

	@src/httpadmin/chi_httpadmin.hpp

10 #iâdeà
CHI_HTTPADMIN_DEF


11 
	#CHI_HTTPADMIN_DEF


	)

13 
	~<as£¹.h
>

14 
	~<¡ršg.h
>

15 
	~<time.h
>

16 
	~<¡d¬g.h
>

17 
	~<¡ršg
>

19 
	~"ex‹º®/vpiÙr-mÚgoo£-ıp/mÚgoo£.h
"

22 
	~"ex‹º®/vpiÙr-mÚgoo£-ıp/mÚgoo£.c
"

24 
Çme¥aû
 
g¿phchi
 {

26 şas 
	ccu¡om_»que¡_hªdËr
 {

28 
public
:

29 
vœtu®
 
¡d
::
¡ršg
 
hªdË
(cÚ¡ * 
»q
) = 0;

30 
vœtu®
 
boŞ
 
»¥Úds_to
(cÚ¡ * 
»q
) = 0;

33 
¡d
::
veùÜ
<
cu¡om_»que¡_hªdËr
 *> 
»qhªdËrs
;

35 
	$»gi¡”_h‰p_»que¡_hªdËr
(
cu¡om_»que¡_hªdËr
 * 
rh
) {

36 
»qhªdËrs
.
	`push_back
(
rh
);

37 
	}
}

40 cÚ¡ *
ajax_»¶y_¡¬t
 =

46 cÚ¡ *
İtiÚs
[] = {

50 
NULL


53 
	$g‘_qsv¬
(cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
,

54 cÚ¡ *
Çme
, *
d¡
, 
size_t
 
d¡_Ën
) {

55 cÚ¡ *
qs
 = 
»que¡_šfo
->
qu”y_¡ršg
;

56 
	`mg_g‘_v¬
(
qs
, 
	`¡¾’
(q =ğ
NULL
 ? "" : qs), 
Çme
, 
d¡
, 
d¡_Ën
);

57 
	}
}

62 
	$hªdË_jsÚp
(
mg_cÚÃùiÚ
 *
cÚn
,

63 cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
) {

64 
cb
[64];

66 
	`g‘_qsv¬
(
»que¡_šfo
, "ÿÎback", 
cb
, (cb));

67 ià(
cb
[0] != '\0') {

68 
	`mg_´štf
(
cÚn
, "%s(", 
cb
);

71  
cb
[0] == '\0' ? 0 : 1;

72 
	}
}

74 
£nd
(
¡d
::
¡ršg
 
jsÚ_šfo
, 
mg_cÚÃùiÚ
 * 
cÚn
,

75 cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
) {

76 
mg_´štf
(
cÚn
, "%s", 
ajax_»¶y_¡¬t
);

77 cÚ¡ * 
c¡r
 = 
jsÚ_šfo
.
c_¡r
();

78 
Ën
 = ()
¡¾’
(
c¡r
);

79 
is_jsÚp
 = 
hªdË_jsÚp
(
cÚn
, 
»que¡_šfo
);

83 
num_wr™‹n
 = 0;

85 
Ën
 > 0) {

86 ià((
num_wr™‹n
 = 
mg_wr™e
(
cÚn
, 
c¡r
, (
size_t
)
Ën
)) !=†en)

88 
Ën
 -ğ
num_wr™‹n
;

89 
c¡r
 +ğ
num_wr™‹n
;

92 ià(
is_jsÚp
) {

93 
mg_´štf
(
cÚn
, "%s", ")");

98 
‹m¶©e
 <
ty³Çme
 
ENGINE
>

99 
	$ajax_£nd_mes§ge
(
mg_cÚÃùiÚ
 *
cÚn
,

100 cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
) {

101 
ENGINE
 * 
’gše
 = (ENGINE*è
»que¡_šfo
->
u£r_d©a
;

103 
¡d
::
¡ršg
 
jsÚ_šfo
 = 
’gše
->
	`g‘_šfo_jsÚ
();

104 
	`£nd
(
jsÚ_šfo
, 
cÚn
, 
»que¡_šfo
);

105 
	}
}

110 
‹m¶©e
 <
ty³Çme
 
ENGINE
>

111 *
	$ev’t_hªdËr
(
mg_ev’t
 
ev’t
,

112 
mg_cÚÃùiÚ
 *
cÚn
,

113 cÚ¡ 
mg_»que¡_šfo
 *
»que¡_šfo
) {

114 *
´oûs£d
 = (*) "yes";

116 ià(
ev’t
 =ğ
MG_NEW_REQUEST
) {

117 ià(
	`¡rcmp
(
»que¡_šfo
->
uri
, "/ajax/getinfo") == 0) {

118 
ajax_£nd_mes§ge
<
ENGINE
>(
cÚn
, 
»que¡_šfo
);

120 
boŞ
 
found
 = 
çl£
;

121 
¡d
::
veùÜ
<
cu¡om_»que¡_hªdËr
 *>::
™”©Ü
 
™
=
»qhªdËrs
.
	`begš
();

122 
™
 !ğ
»qhªdËrs
.
	`’d
(); ++it) {

123 
cu¡om_»que¡_hªdËr
 * 
rh
 = *
™
;

124 ià(
rh
->
	`»¥Úds_to
(
»que¡_šfo
->
uri
)) {

125 
¡d
::
¡ršg
 
»¥Ú£
 = 
rh
->
	`hªdË
(
»que¡_šfo
->
uri
);

126 
	`£nd
(
»¥Ú£
, 
cÚn
, 
»que¡_šfo
);

127 
found
 = 
Œue
;

132 ià(!
found
è
´oûs£d
 = 
NULL
;

135 
´oûs£d
 = 
NULL
;

138  
´oûs£d
;

139 
	}
}

142 
‹m¶©e
 <
ty³Çme
 
ENGINE
>

143 
	$¡¬t_h‰·dmš
(
ENGINE
 * 
’gše
) {

144 
mg_cÚ‹xt
 *
ùx
;

146 
ùx
 = 
	`mg_¡¬t
(&
ev’t_hªdËr
<
ENGINE
>, (*)
’gše
, 
İtiÚs
);

147 
	`as£¹
(
ùx
 !ğ
NULL
);

148 
¡d
::
cout
 << "S¹ed HTTP‡dmš s”v”. " << std::
’dl
;

149 
	}
}

	@src/httpadmin/plotter.hpp

31 #iâdeà
DEF_GRAPHCHI_GNUPLOTTER


32 
	#DEF_GRAPHCHI_GNUPLOTTER


	)

34 
	~<c¡dio
>

35 
	~<¡dlib.h
>

36 
	~<¡ršg
>

38 
	~"g¿phchi_basic_šşudes.hµ
"

40 
Çme¥aû
 
	gg¿phchi
 {

42 
size_t
 
	gš™Ÿl_edges
 = 0;

45 
	g¡d
::
¡ršg
 
¶ÙdœeùÜy
();

46 
	g¡d
::
¡ršg
 
¶ÙdœeùÜy
() {

49 
š™_¶Ù
(
¡d
::
¡ršg
 
¶ÙÇme
);

50 
š™_¶Ù
(
¡d
::
¡ršg
 
¶ÙÇme
) {

51 
¡d
::
¡ršg
 
d©ªame
 = 
¶ÙdœeùÜy
(è+ 
¶ÙÇme
 + ".dat";

52 
FILE
 * 
	gdf
 = 
fİ’
(
d©ªame
.
c_¡r
(), "w");

53 
fşo£
(
df
);

54 
	g¡d
::
cout
 << "---------- In™Ÿlized ------------" << 
¡d
::
’dl
;

57 
	g‹m¶©e
 <
ty³Çme
 
	gENGINE
>

58 
addv®
(
ENGINE
 * 
’gše
, 
¡d
::
¡ršg
 
¶ÙÇme
, 
v®
) {

59 
	gg¿phchi_cÚ‹xt
 &
	gcÚ‹xt
 = 
’gše
->
g‘_cÚ‹xt
();

60 
	g¡d
::
¡ršg
 
d©ªame
 = 
¶ÙdœeùÜy
(è+ 
¶ÙÇme
 + ".dat";

61 
FILE
 * 
	gdf
 = 
fİ’
(
d©ªame
.
c_¡r
(), "a");

62 
as£¹
(
df
 !ğ
NULL
);

63 
årštf
(
df
, "%là%lf\n", 
cÚ‹xt
.
ruÁime
(), 
v®
);

64 
fşo£
(
df
);

68 
d¿w¶Ù
(
¡d
::
¡ršg
 
¶ÙÇme
, 
size_t
 
lookback_£cs
);

69 
d¿w¶Ù
(
¡d
::
¡ršg
 
¶ÙÇme
, 
size_t
 
lookback_£cs
) {

70 
	g¡d
::
¡ršg
 
¶Ùfe
 = 
¶ÙdœeùÜy
(è+ 
¶ÙÇme
 + ".dat";

72 
	g¡d
::
¡ršg¡»am
 
ss
;

73 
	gss
 << "python2.6 ";

74 
	gss
 << 
¶ÙdœeùÜy
(è+ "¶Ù‹r.py " + 
	g¶Ùfe
 + "†astsecs ";

75 
	gss
 << 
	glookback_£cs
;

77 
	g¡d
::
¡ršg
 
cmd
 = 
ss
.
¡r
();

78 
log¡»am
(
LOG_DEBUG
è<< "Executšg: " << 
	gcmd
 << 
	g¡d
::
’dl
;

79 
sy¡em
(
cmd
.
c_¡r
());

82 
	g‹m¶©e
 <
ty³Çme
 
	gENGINE
>

83 
š™_¶Ùs
(
ENGINE
 * 
’gše
) {

84 
š™_¶Ù
("edges");

85 
š™_¶Ù
("bufedges");

86 
š™_¶Ù
("updates");

87 
š™_¶Ù
("ingests");

88 
š™_¶Ù
("deltas");

90 
	gš™Ÿl_edges
 = 
’gše
->
num_edges_§ã
();

93 
	gÏ¡_upd©e_time
 = 0;

94 
size_t
 
	gÏ¡_edges
 = 0;

95 
size_t
 
	gÏ¡_upd©es
 = 0;

96 
size_t
 
	gšge¡ed_edges
 = 0;

99 
£t_šge¡ed_edges
(
size_t
 
n
);

100 
£t_šge¡ed_edges
(
size_t
 
n
) {

101 
	gšge¡ed_edges
 = 
n
;

104 
	g‹m¶©e
 <
ty³Çme
 
	gENGINE
>

105 
upd©e_¶Ùd©a
(
ENGINE
 * 
’gše
) {

106 
addv®
(
’gše
, "edges", (ëngše->
num_edges_§ã
());

107 
addv®
(
’gše
, "buãdges", (ëngše->
num_bufã»d_edges
());

108 
	g¹
 = 
’gše
->
g‘_cÚ‹xt
().
ruÁime
(è- 
Ï¡_upd©e_time
;

110 ià(
	gÏ¡_upd©e_time
 > 0) {

111 
addv®
(
’gše
, "šge¡s", (
šge¡ed_edges
 - 
Ï¡_edges
è/ 
¹
);

112 
addv®
(
’gše
, "upd©es", (’gše->
num_upd©es
(è- 
Ï¡_upd©es
è/ 
¹
);

113 
addv®
(
’gše
, "d–s",ƒngše->
g‘_cÚ‹xt
().
Ï¡_d–sum
);

115 ià(
	gÏ¡_upd©e_time
 == 0) {

116 
Ï¡_edges
 = 
šge¡ed_edges
;

117 
	gÏ¡_upd©e_time
 = 
’gše
->
g‘_cÚ‹xt
().
ruÁime
();

118 
	gÏ¡_upd©es
 = 
’gše
->
num_upd©es
();

122 
d¿w¶Ùs
();

123 
d¿w¶Ùs
() {

124 
d¿w¶Ù
("edges", 1800);

125 
d¿w¶Ù
("bufedges", 1800);

126 
d¿w¶Ù
("updates", 300);

127 
d¿w¶Ù
("ingests", 500);

128 
d¿w¶Ù
("deltas", 7200);

	@src/io/stripedio.hpp

31 #iâdeà
DEF_STRIPEDIO_HPP


32 
	#DEF_STRIPEDIO_HPP


	)

34 
	~<io¡»am
>

36 
	~<fú.h
>

37 
	~<uni¡d.h
>

38 
	~<as£¹.h
>

39 
	~<¡dšt.h
>

40 
	~<±h»ad.h
>

41 
	~<”ºo.h
>

44 
	~<veùÜ
>

46 
	~"logg”/logg”.hµ
"

47 
	~"m‘rics/m‘rics.hµ
"

48 
	~"ut/synchrÚized_queue.hµ
"

49 
	~"ut/iout.hµ
"

50 
	~"ut/cmdİts.hµ
"

54 
Çme¥aû
 
	gg¿phchi
 {

56 
size_t
 
g‘_fesize
(
¡d
::
¡ršg
 
f’ame
);

57 
	gpšÃd_fe
;

62 
	sio_desütÜ
 {

63 
	g¡d
::
¡ršg
 
f’ame
;

64 
	g¡d
::
veùÜ
<> 
»addescs
;

65 
	g¡d
::
veùÜ
<> 
wr™edescs
;

66 
pšÃd_fe
 * 
	gpšÃd_to_memÜy
;

67 
	g¡¬t_m¶ex
;

68 
boŞ
 
	gİ’
;

69 
boŞ
 
	gcom´es£d
;

73 
	eBLOCK_ACTION
 { 
	gREAD
, 
	gWRITE
 };

76 
	s»fcouÁ±r
 {

77 * 
	g±r
;

78 vŞ©
	gcouÁ
;

79 
»fcouÁ±r
(* 
±r
, 
couÁ
) :…tr(ptr), count(count) {}

83 
şass
 
	g¡redio
;

85 
	siÙask
 {

86 
BLOCK_ACTION
 
	gaùiÚ
;

87 
	gfd
;

88 
	g£ssiÚ
;

89 
»fcouÁ±r
 * 
	g±r
;

90 
size_t
 
	gËngth
;

91 
size_t
 
	goff£t
;

92 
size_t
 
	g±roff£t
;

93 
boŞ
 
	gä“_aá”
;

94 
¡redio
 * 
	giomgr
;

95 
boŞ
 
	gcom´es£d
;

96 
boŞ
 
	gşo£fd
;

97 vŞ©* 
	gdÚ•Œ
;

99 
iÙask
(è: 
aùiÚ
(
READ
), 
fd
(0), 
£ssiÚ
(0), 
±r
(
NULL
), 
Ëngth
(0), 
off£t
(0), 
±roff£t
(0), 
ä“_aá”
(
çl£
), 
iomgr
(NULL), 
com´es£d
(çl£), 
şo£fd
(çl£), 
dÚ•Œ
(NULL) {}

100 
iÙask
(
¡redio
 * 
iomgr
, 
BLOCK_ACTION
 
aù
, 
fd
, 
£ssiÚ
, 
»fcouÁ±r
 * 
±r
, 
size_t
 
Ëngth
, size_ˆ
off£t
, size_ˆ
±roff£t
, 
boŞ
 
ä“_aá”
, boŞ 
com´es£d
, boŞ 
şo£fd
=
çl£
) :

101 
aùiÚ
(
aù
), 
fd
(fd), 
£ssiÚ
(£ssiÚ), 
±r
ÕŒ),
Ëngth
Ö’gth), 
off£t
(off£t), 
±roff£t
ÕŒoff£t), 
ä“_aá”
(ä“_aá”), 
iomgr
(iomgr),
com´es£d
(com´es£d), 
şo£fd
(closefd) {

102 ià(
	gşo£fd
è
as£¹
(
ä“_aá”
);

103 
	gdÚ•Œ
 = 
NULL
;

107 
	sthršfo
 {

108 
	gsynchrÚized_queue
<
	giÙask
> * 
	g»adqueue
;

109 
	gsynchrÚized_queue
<
	giÙask
> * 
	gcomm™queue
;

110 
	gsynchrÚized_queue
<
	giÙask
> * 
	g´ioqueue
;

112 
boŞ
 
	gruÂšg
;

113 
m‘rics
 * 
	gm
;

114 vŞ©
	g³ndšg_wr™es
;

115 vŞ©
	g³ndšg_»ads
;

116 
	gm¶ex
;

120 * 
io_th»ad_loİ
(* 
_šfo
);

122 
	s¡re_chunk
 {

123 
	gm¶ex_th»ad
;

124 
size_t
 
	goff£t
;

125 
size_t
 
	gËn
;

126 
¡re_chunk
(
m¶ex_th»ad
, 
size_t
 
off£t
, size_ˆ
Ën
) : mplex_thread(mplex_thread), offset(offset),†en(len) {}

130 
	s¡»amšg_sk
 {

131 
¡redio
 * 
	giomgr
;

132 
	g£ssiÚ
;

133 
size_t
 
	gËn
;

134 vŞ©
size_t
 
	gcu½os
;

135 ** 
	gbuf
;

136 
¡»amšg_sk
() {}

137 
¡»amšg_sk
(
¡redio
 * 
iomgr
, 
£ssiÚ
, 
size_t
 
Ën
, ** 
buf
è: iomgr(iomgr), sessiÚ(£ssiÚ),†’Ö’), 
cu½os
(0), buf(buf) {}

140 
	spšÃd_fe
 {

141 
	g¡d
::
¡ršg
 
f’ame
;

142 
size_t
 
	gËngth
;

143 
ušt8_t
 * 
	gd©a
;

144 
boŞ
 
	gtouched
;

148 * 
¡»am_»ad_loİ
(* 
_šfo
);

151 şas 
	c¡redio
 {

153 
	g¡d
::
veùÜ
<
io_desütÜ
 *> 
£ssiÚs
;

154 
mu‹x
 
	gmlock
;

155 
	g¡resize
;

156 
	gmuÉËx
;

157 
	g¡d
::
¡ršg
 
muÉËx_roÙ
;

158 
boŞ
 
	gdi§bË_´–ßdšg
;

160 
	g¡d
::
veùÜ
< 
synchrÚized_queue
<
iÙask
> > 
m¶ex_»adsks
;

161 
	g¡d
::
veùÜ
< 
synchrÚized_queue
<
iÙask
> > 
m¶ex_wr™‘asks
;

162 
	g¡d
::
veùÜ
< 
synchrÚized_queue
<
iÙask
> > 
m¶ex_´iÙasks
;

163 
	g¡d
::
veùÜ
< 
±h»ad_t
 > 
th»ads
;

164 
	g¡d
::
veùÜ
< 
thršfo
 * > 
th»ad_šfos
;

165 
	gm‘rics
 &
	gm
;

168 
	g¡d
::
veùÜ
<
pšÃd_fe
 *> 
´–ßded_fes
;

169 
mu‹x
 
	g´–ßd_lock
;

170 
size_t
 
	g´–ßded_by‹s
;

171 
size_t
 
	gmax_´–ßd_by‹s
;

174 
	gniÙh»ads
;

176 
	gpublic
:

177 
¡redio
Ğ
m‘rics
 &
_m
è: 
m
(_m) {

178 
di§bË_´–ßdšg
 = 
çl£
;

179 
	g¡resize
 = 
g‘_İtiÚ_št
("io.stripesize", 4096 * 1024 / 2);

181 
	g´–ßded_by‹s
 = 0;

182 
	gmax_´–ßd_by‹s
 = 1024 * 1024 * 
g‘_İtiÚ_lÚg
("preload.max_megabytes", 0);

184 ià(
	gmax_´–ßd_by‹s
 > 0) {

185 
log¡»am
(
LOG_INFO
è<< "P»lßdšg maximum " << 
	gmax_´–ßd_by‹s
 << " by‹s." << 
	g¡d
::
’dl
;

188 
	gmuÉËx
 = 
g‘_İtiÚ_št
("multiplex", 1);

189 ià(
	gmuÉËx
>1) {

190 
	gmuÉËx_roÙ
 = 
g‘_İtiÚ_¡ršg
("multiplex_root", "<not-set>");

192 
	gmuÉËx_roÙ
 = "";

193 
	g¡resize
 = 1024*1024*1024;

195 
	gm
.
£t
("¡resize", (
size_t
)
¡resize
);

198 
	gniÙh»ads
 = 
g‘_İtiÚ_št
("niothreads", 1);

199 
	gm
.
£t
("niÙh»ads", (
size_t
)
niÙh»ads
);

201 
log¡»am
(
LOG_DEBUG
è<< "S¹ io-mªag” w™h " << 
	gniÙh»ads
 << "h»ads." << 
	g¡d
::
’dl
;

204 
	gi
=0; i < 
muÉËx
 * 
	gniÙh»ads
; i++) {

205 
	gm¶ex_»adsks
.
push_back
(
synchrÚized_queue
<
iÙask
>());

206 
	gm¶ex_wr™‘asks
.
push_back
(
synchrÚized_queue
<
iÙask
>());

207 
	gm¶ex_´iÙasks
.
push_back
(
synchrÚized_queue
<
iÙask
>());

210 
	gk
 = 0;

211 
	gi
=0; i < 
	gmuÉËx
; i++) {

212 
	gj
=0; j < 
	gniÙh»ads
; j++) {

213 
thršfo
 * 
	gùh»adšfo
 = 
Ãw
hrinfo();

214 
	gùh»adšfo
->
	gcomm™queue
 = &
m¶ex_wr™‘asks
[
k
];

215 
	gùh»adšfo
->
	g»adqueue
 = &
m¶ex_»adsks
[
k
];

216 
	gùh»adšfo
->
	g´ioqueue
 = &
m¶ex_´iÙasks
[
k
];

217 
	gùh»adšfo
->
	gruÂšg
 = 
Œue
;

218 
	gùh»adšfo
->
	g³ndšg_wr™es
 = 0;

219 
	gùh»adšfo
->
	g³ndšg_»ads
 = 0;

220 
	gùh»adšfo
->
	gm¶ex
 = 
i
;

221 
	gùh»adšfo
->
	gm
 = &
m
;

222 
	gth»ad_šfos
.
push_back
(
ùh»adšfo
);

224 
±h»ad_t
 
	giÙh»ad
;

225 
	g»t
 = 
±h»ad_ü—‹
(&
iÙh»ad
, 
NULL
, 
io_th»ad_loİ
, 
ùh»adšfo
);

226 
	gth»ads
.
push_back
(
iÙh»ad
);

227 
as£¹
(
»t
>=0);

228 
	gk
++;

233 ~
¡redio
() {

234 
	gm¶ex
 = (è
th»ad_šfos
.
size
();

236 
	gi
=0; i<
	gm¶ex
; i++) {

237 
	gth»ad_šfos
[
i
]->
	gruÂšg
=
çl£
;

239 
size_t
 
	gÁh»ads
 = 
th»ads
.
size
();

240 
	gi
=0; i<
	gÁh»ads
; i++) {

241 
±h»ad_još
(
th»ads
[
i
], 
NULL
);

243 
	gi
=0; i<
	gm¶ex
; i++) {

244 
d–‘e
 
	gth»ad_šfos
[
i
];

247 
	gj
=0; j<()
	g£ssiÚs
.
size
(); j++) {

248 ià(
	g£ssiÚs
[
j
] !ğ
NULL
) {

249 
şo£_£ssiÚ
(
j
);

250 
d–‘e
 
	g£ssiÚs
[
j
];

251 
	g£ssiÚs
[
j
] = 
NULL
;

255 
	g¡d
::
veùÜ
<
pšÃd_fe
 *>::
™”©Ü
 
™
=
´–ßded_fes
.
begš
();

256 
	g™
 !ğ
´–ßded_fes
.
’d
(); ++it) {

257 
pšÃd_fe
 * 
	g´–ßded
 = (*
™
);

258 
d–‘e
 
	g´–ßded
->
	gd©a
;

259 
d–‘e
 
	g´–ßded
;

263 
£t_di§bË_´–ßdšg
(
boŞ
 
b
) {

264 
	gdi§bË_´–ßdšg
 = 
b
;

265 ià(
	gb
è
log¡»am
(
LOG_INFO
è<< "Di§bËd…»lßdšg." << 
	g¡d
::
’dl
;

268 
boŞ
 
muÉËxed
() {

269  
	gmuÉËx
>1;

272 
´št_£ssiÚ
(
£ssiÚ
) {

273 
	gi
=0; i<
	gmuÉËx
; i++) {

274 
	g¡d
::
cout
 << "muÉËx: " << 
muÉËx
 << 
¡d
::
’dl
;

275 
	g¡d
::
cout
 << "R—d desc: " << 
£ssiÚs
[
£ssiÚ
]->
»addescs
[
i
] << 
¡d
::
’dl
;

278 
	gi
=0; i<()
	g£ssiÚs
[
£ssiÚ
]->
	gwr™edescs
.
size
(); i++) {

279 
	g¡d
::
cout
 << "muÉËx: " << 
muÉËx
 << 
¡d
::
’dl
;

280 
	g¡d
::
cout
 << "R—d desc: " << 
£ssiÚs
[
£ssiÚ
]->
wr™edescs
[
i
] << 
¡d
::
’dl
;

287 
hash
(
¡d
::
¡ršg
 
f’ame
) {

288 cÚ¡ * 
c¡r
 = 
f’ame
.
c_¡r
();

289 
	ghash
 = 1;

290 
	gl
 = (è
¡¾’
(
c¡r
);

291 
	gi
=0; i<
	gl
; i++) {

292 
	ghash
 = 31*
hash
 + 
c¡r
[
i
];

294  
	g¡d
::
abs
(
hash
);

297 
İ’_£ssiÚ
(
¡d
::
¡ršg
 
f’ame
, 
boŞ
 
»adÚly
=
çl£
, boŞ 
com´es£d
=false) {

298 
mlock
.
lock
();

300 
	g£ssiÚ_id
 = (è
£ssiÚs
.
size
();

301 
io_desütÜ
 * 
	giodesc
 = 
Ãw
 io_descriptor();

302 
	giodesc
->
	gİ’
 = 
Œue
;

303 
	giodesc
->
	gcom´es£d
 = 
com´es£d
;

304 
	giodesc
->
	gpšÃd_to_memÜy
 = 
is_´–ßded
(
f’ame
);

305 
	giodesc
->
	g¡¬t_m¶ex
 = 
hash
(
f’ame
è% 
muÉËx
;

306 
	g£ssiÚs
.
push_back
(
iodesc
);

307 
	gmlock
.
uÆock
();

309 ià(
	gNULL
 !ğ
iodesc
->
pšÃd_to_memÜy
) {

310 
log¡»am
(
LOG_INFO
è<< "O³Ãd…»lßded sessiÚ: " << 
f’ame
 << 
¡d
::
’dl
;

311  
	g£ssiÚ_id
;

314 
	gi
=0; i<
	gmuÉËx
; i++) {

315 
	g¡d
::
¡ršg
 
âame
 = 
muÉËx´efix
(
i
è+ 
f’ame
;

316 
	gj
=0; j<
	gniÙh»ads
+(
	gmuÉËx
 == 1 ? 1 : 0); j++) {

317 
	grddesc
 = 
İ’
(
âame
.
c_¡r
(), (
»adÚly
 ? 
O_RDONLY
 : 
O_RDWR
));

318 ià(
	grddesc
 < 0è
log¡»am
(
LOG_ERROR
è<< "Could‚Ù o³n: " << 
	gâame
 << " sessiÚ: " << 
	g£ssiÚ_id


319 << "ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
	g¡d
::
’dl
; 
as£¹
(
rddesc
>=0);

320 
	giodesc
->
	g»addescs
.
push_back
(
rddesc
);

321 #ifdeà
F_NOCACHE


322 ià(!
	g»adÚly
)

323 
fú
(
rddesc
, 
F_NOCACHE
, 1);

325 ià(!
	g»adÚly
) {

326 
	gwrdesc
 = 
rddesc
;

328 ià(
	gwrdesc
 < 0è
log¡»am
(
LOG_ERROR
è<< "Could‚Ù o³ÀfÜ wr™šg: " << 
	gâame
 << " sessiÚ: " << 
	g£ssiÚ_id


329 << "ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
	g¡d
::
’dl
;

330 
as£¹
(
wrdesc
>=0);

331 #ifdeà
F_NOCACHE


332 
fú
(
wrdesc
, 
F_NOCACHE
, 1);

335 
	giodesc
->
	gwr™edescs
.
push_back
(
wrdesc
);

339 
	giodesc
->
	gf’ame
 = 
f’ame
;

340 ià(
	giodesc
->
	gwr™edescs
.
size
() > 0) {

345  
	g£ssiÚ_id
;

348 
şo£_£ssiÚ
(
£ssiÚ
) {

349 
	gmlock
.
lock
();

353 
boŞ
 
	gwasİ’
;

354 
io_desütÜ
 * 
	giodesc
 = 
£ssiÚs
[
£ssiÚ
];

355 
	gwasİ’
 = 
iodesc
->
İ’
;

356 
	giodesc
->
	gİ’
 = 
çl£
;

357 
	gmlock
.
uÆock
();

358 ià(
	gwasİ’
) {

360 
	g¡d
::
veùÜ
<>::
™”©Ü
 
™
=
iodesc
->
»addescs
.
begš
(); 
	g™
!=iodesc->»addescs.
’d
(); ++it) {

361 
şo£
(*
™
);

369 
m¶ex_fÜ_off£t
(
£ssiÚ
, 
size_t
 
off
) {

370  ((è(
	goff
 / 
	g¡resize
è+ 
	g£ssiÚs
[
£ssiÚ
]->
	g¡¬t_m¶ex
è% 
	gmuÉËx
;

374 
	g¡d
::
veùÜ
< 
¡re_chunk
 > 
¡re_off£ts
(
£ssiÚ
, 
size_t
 
nby‹s
, size_ˆ
off
) {

375 
size_t
 
	g’d
 = 
off
+
nby‹s
;

376 
size_t
 
	gidx
 = 
off
;

377 
size_t
 
	gbufoff
 = 0;

378 
	g¡d
::
veùÜ
<
¡re_chunk
> 
¡r–i¡
;

379 
	gidx
<
	g’d
) {

380 
size_t
 
	gblockoff
 = 
idx
 % 
¡resize
;

381 
size_t
 
	gblockËn
 = 
¡d
::
mš
(
¡resize
-
blockoff
, 
’d
-
idx
);

383 
	gm¶ex_th»ad
 = (è
m¶ex_fÜ_off£t
(
£ssiÚ
, 
idx
è* 
	gniÙh»ads
 + (è(
¿ndom
() %‚iothreads);

384 
	g¡r–i¡
.
push_back
(
¡re_chunk
(
m¶ex_th»ad
, 
bufoff
, 
blockËn
));

386 
	gbufoff
 +ğ
blockËn
;

387 
	gidx
 +ğ
blockËn
;

389  
	g¡r–i¡
;

392 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

393 
´—da_async
(
£ssiÚ
, 
T
 * 
tbuf
, 
size_t
 
nby‹s
, size_ˆ
off
, vŞ©* 
dÚ•Œ
 = 
NULL
) {

394 
¡d
::
veùÜ
<
¡re_chunk
> 
¡r–i¡
 = 
¡re_off£ts
(
£ssiÚ
, 
nby‹s
, 
off
);

395 ià(
com´es£d_£ssiÚ
(
£ssiÚ
)) {

396 
as£¹
(
¡r–i¡
.
size
() == 1);

397 
as£¹
(
off
 == 0);

399 
»fcouÁ±r
 * 
	g»åŒ
 = 
Ãw
„efcouÁ±r((*)
tbuf
, ()
¡r–i¡
.
size
());

400 
	gi
=0; i<()
	g¡r–i¡
.
size
(); i++) {

401 
¡re_chunk
 
	gchunk
 = 
¡r–i¡
[
i
];

402 
__sync_add_ªd_ãtch
(&
th»ad_šfos
[
chunk
.
m¶ex_th»ad
]->
³ndšg_»ads
, 1);

403 
iÙask
 
	gsk
 = iÙask(
this
, 
READ
, 
£ssiÚs
[
£ssiÚ
]->
»addescs
[
chunk
.
m¶ex_th»ad
],

404 
£ssiÚ
,

405 
»åŒ
, 
chunk
.
Ën
, chunk.
off£t
+
off
, chunk.off£t, 
çl£
,

406 
com´es£d_£ssiÚ
(
£ssiÚ
));

407 
	gsk
.
	gdÚ•Œ
 = 
dÚ•Œ
;

408 
	gm¶ex_»adsks
[
chunk
.
m¶ex_th»ad
].
push
(
sk
);

413 
Ïunch_¡»am_»ad”
(
¡»amšg_sk
 * 
sk
) {

414 
±h»ad_t
 
	gt
;

415 
	g»t
 = 
±h»ad_ü—‹
(&
t
, 
NULL
, 
¡»am_»ad_loİ
, (*)
sk
);

416 
as£¹
(
»t
>=0);

424 
boŞ
 
pšÃd_£ssiÚ
(
£ssiÚ
) {

425  
	g£ssiÚs
[
£ssiÚ
]->
	gpšÃd_to_memÜy
;

428 
boŞ
 
com´es£d_£ssiÚ
(
£ssiÚ
) {

429  
	g£ssiÚs
[
£ssiÚ
]->
	gcom´es£d
;

437 
®low_´–ßdšg
(
¡d
::
¡ršg
 
f’ame
) {

438 ià(
di§bË_´–ßdšg
) {

441 
	g´–ßd_lock
.
lock
();

442 
as£¹
(
max_´–ßd_by‹s
 == 0);

467 
	g´–ßd_lock
.
uÆock
();

470 
comm™_´–ßded
() {

471 
	g¡d
::
veùÜ
<
pšÃd_fe
 *>::
™”©Ü
 
™
=
´–ßded_fes
.
begš
();

472 
	g™
 !ğ
´–ßded_fes
.
’d
(); ++it) {

473 
pšÃd_fe
 * 
	g´–ßded
 = (*
™
);

474 ià(
	g´–ßded
->
	gtouched
) {

475 
log¡»am
(
LOG_INFO
è<< "Comm™…»lßded fe: " << 
	g´–ßded
->
	gf’ame
 << 
	g¡d
::
’dl
;

476 
	gfid
 = 
İ’
(
´–ßded
->
f’ame
.
c_¡r
(), 
O_WRONLY
);

477 ià(
	gfid
 < 0) {

478 
log¡»am
(
LOG_ERROR
è<< "Could‚Ù„—d fe: " << 
	g´–ßded
->
	gf’ame


479 << "ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
	g¡d
::
’dl
;

482 
pwr™—
(
fid
, 
´–ßded
->
d©a
,…»lßded->
Ëngth
, 0);

483 
şo£
(
fid
);

485 
	g´–ßded
->
	gtouched
 = 
çl£
;

489 
pšÃd_fe
 * 
is_´–ßded
(
¡d
::
¡ršg
 
f’ame
) {

490 
´–ßd_lock
.
lock
();

491 
pšÃd_fe
 * 
	g´–ßded
 = 
NULL
;

492 
	g¡d
::
veùÜ
<
pšÃd_fe
 *>::
™”©Ü
 
™
=
´–ßded_fes
.
begš
();

493 
	g™
 !ğ
´–ßded_fes
.
’d
(); ++it) {

494 ià(
	gf’ame
 =ğ(*
™
)->
f’ame
) {

495 
´–ßded
 = *
™
;

499 
	g´–ßd_lock
.
uÆock
();

500  
	g´–ßded
;

505 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

506 
pwr™—_async
(
£ssiÚ
, 
T
 * 
tbuf
, 
size_t
 
nby‹s
, size_ˆ
off
, 
boŞ
 
ä“_aá”
, boŞ 
şo£_fd
=
çl£
) {

507 
¡d
::
veùÜ
<
¡re_chunk
> 
¡r–i¡
 = 
¡re_off£ts
(
£ssiÚ
, 
nby‹s
, 
off
);

508 
»fcouÁ±r
 * 
	g»åŒ
 = 
Ãw
„efcouÁ±r((*)
tbuf
, (è
¡r–i¡
.
size
());

509 ià(
com´es£d_£ssiÚ
(
£ssiÚ
)) {

510 
as£¹
(
¡r–i¡
.
size
() == 1);

511 
as£¹
(
off
 == 0);

513 
	gi
=0; i<()
	g¡r–i¡
.
size
(); i++) {

514 
¡re_chunk
 
	gchunk
 = 
¡r–i¡
[
i
];

515 
__sync_add_ªd_ãtch
(&
th»ad_šfos
[
chunk
.
m¶ex_th»ad
]->
³ndšg_wr™es
, 1);

516 
	gm¶ex_wr™‘asks
[
chunk
.
m¶ex_th»ad
].
push
(
iÙask
(
this
, 
WRITE
, 
£ssiÚs
[
£ssiÚ
]->
wr™edescs
[chunk.mplex_thread], session,

517 
»åŒ
, 
chunk
.
Ën
, chunk.
off£t
+
off
, chunk.off£t, 
ä“_aá”
, 
com´es£d_£ssiÚ
(
£ssiÚ
),

518 
şo£_fd
));

522 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

523 
´—da_now
(
£ssiÚ
, 
T
 * 
tbuf
, 
size_t
 
nby‹s
, size_ˆ
off
) {

524 
m‘rics_’Œy
 
	gme
 = 
m
.
¡¬t_time
();

525 ià(
com´es£d_£ssiÚ
(
£ssiÚ
)) {

527 
as£¹
(
off
 == 0);

528 
»ad_com´es£d
(
£ssiÚs
[
£ssiÚ
]->
»addescs
[0], 
tbuf
, 
nby‹s
);

529 
	gm
.
¡İ_time
(
me
, "´—da_now", 
çl£
);

533 ià(
	gmuÉËx
 > 1) {

534 
	g¡d
::
veùÜ
<
¡re_chunk
> 
¡r–i¡
 = 
¡re_off£ts
(
£ssiÚ
, 
nby‹s
, 
off
);

535 
size_t
 
	gcheckËn
=0;

536 
»fcouÁ±r
 * 
	g»åŒ
 = 
Ãw
„efcouÁ±r((*)
tbuf
, (è
¡r–i¡
.
size
());

537 
	g»åŒ
->
	gcouÁ
++;

538 
	gi
=0; i < ()
	g¡r–i¡
.
size
(); i++) {

539 
¡re_chunk
 
	gchunk
 = 
¡r–i¡
[
i
];

540 
__sync_add_ªd_ãtch
(&
th»ad_šfos
[
chunk
.
m¶ex_th»ad
]->
³ndšg_»ads
, 1);

543 
	gm¶ex_´iÙasks
[
chunk
.
m¶ex_th»ad
].
push
(
iÙask
(
this
, 
READ
, 
£ssiÚs
[
£ssiÚ
]->
»addescs
[chunk.mplex_thread], session,

544 
»åŒ
, 
chunk
.
Ën
, chunk.
off£t
+
off
, chunk.off£t, 
çl£
,

545 
çl£
));

546 
	gcheckËn
 +ğ
chunk
.
Ën
;

548 
as£¹
(
checkËn
 =ğ
nby‹s
);

551 
	g»åŒ
->
	gcouÁ
>1) {

552 
u¦“p
(5000);

554 
d–‘e
 
	g»åŒ
;

556 
´—da
(
£ssiÚs
[
£ssiÚ
]->
»addescs
[
th»ads
.
size
()], 
tbuf
, 
nby‹s
, 
off
);

558 
	gm
.
¡İ_time
(
me
, "´—da_now", 
çl£
);

561 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

562 
pwr™—_now
(
£ssiÚ
, 
T
 * 
tbuf
, 
size_t
 
nby‹s
, size_ˆ
off
) {

563 
m‘rics_’Œy
 
	gme
 = 
m
.
¡¬t_time
();

565 ià(
com´es£d_£ssiÚ
(
£ssiÚ
)) {

567 
as£¹
(
off
 == 0);

568 
wr™e_com´es£d
(
£ssiÚs
[
£ssiÚ
]->
wr™edescs
[0], 
tbuf
, 
nby‹s
);

569 
	gm
.
¡İ_time
(
me
, "pwr™—_now", 
çl£
);

573 
	g¡d
::
veùÜ
<
¡re_chunk
> 
¡r–i¡
 = 
¡re_off£ts
(
£ssiÚ
, 
nby‹s
, 
off
);

574 
size_t
 
	gcheckËn
=0;

576 
	gi
=0; i<()
	g¡r–i¡
.
size
(); i++) {

577 
¡re_chunk
 
	gchunk
 = 
¡r–i¡
[
i
];

578 
pwr™—
(
£ssiÚs
[
£ssiÚ
]->
wr™edescs
[
chunk
.
m¶ex_th»ad
], (*)
tbuf
+chunk.
off£t
, chunk.
Ën
, chunk.off£t+
off
);

579 
	gcheckËn
 +ğ
chunk
.
Ën
;

581 
as£¹
(
checkËn
 =ğ
nby‹s
);

582 
	gm
.
¡İ_time
(
me
, "pwr™—_now", 
çl£
);

592 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

593 
mªaged_pwr™—_async
(
£ssiÚ
, 
T
 ** 
tbuf
, 
size_t
 
nby‹s
, size_ˆ
off
, 
boŞ
 
ä“_aá”
, boŞ 
şo£_fd
=
çl£
) {

595 ià(!
pšÃd_£ssiÚ
(
£ssiÚ
)) {

596 
pwr™—_async
(
£ssiÚ
, *
tbuf
, 
nby‹s
, 
off
, 
ä“_aá”
, 
şo£_fd
);

599 
	g£ssiÚs
[
£ssiÚ
]->
	gpšÃd_to_memÜy
->
	gtouched
 = 
Œue
;

603 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

604 
mªaged_´—da_now
(
£ssiÚ
, 
T
 ** 
tbuf
, 
size_t
 
nby‹s
, size_ˆ
off
) {

605 ià(!
pšÃd_£ssiÚ
(
£ssiÚ
)) {

606 
´—da_now
(
£ssiÚ
, *
tbuf
, 
nby‹s
, 
off
);

608 
io_desütÜ
 * 
	giodesc
 = 
£ssiÚs
[
£ssiÚ
];

609 *
	gtbuf
 = (
T
*è(
iodesc
->
pšÃd_to_memÜy
->
d©a
 + 
off
);

613 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

614 
mªaged_pwr™—_now
(
£ssiÚ
, 
T
 ** 
tbuf
, 
size_t
 
nby‹s
, size_ˆ
off
) {

615 ià(!
pšÃd_£ssiÚ
(
£ssiÚ
)) {

616 
pwr™—_now
(
£ssiÚ
, *
tbuf
, 
nby‹s
, 
off
);

619 
	g£ssiÚs
[
£ssiÚ
]->
	gpšÃd_to_memÜy
->
	gtouched
 = 
Œue
;

623 
	g‹m¶©e
<
ty³Çme
 
	gT
>

624 
mªaged_m®loc
(
£ssiÚ
, 
T
 ** 
tbuf
, 
size_t
 
nby‹s
, size_ˆ
noff
) {

625 ià(!
pšÃd_£ssiÚ
(
£ssiÚ
)) {

626 *
	gtbuf
 = (
T
*è
m®loc
(
nby‹s
);

628 
io_desütÜ
 * 
	giodesc
 = 
£ssiÚs
[
£ssiÚ
];

629 *
	gtbuf
 = (
T
*è(
iodesc
->
pšÃd_to_memÜy
->
d©a
 + 
noff
);

636 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

637 
mªaged_´—da_async
(
£ssiÚ
, 
T
 ** 
tbuf
, 
size_t
 
nby‹s
, size_ˆ
off
, vŞ©* 
dÚ•Œ
 = 
NULL
) {

638 ià(!
pšÃd_£ssiÚ
(
£ssiÚ
)) {

640 
´—da_async
(
£ssiÚ
, *
tbuf
, 
nby‹s
, 
off
, 
dÚ•Œ
);

642 
io_desütÜ
 * 
	giodesc
 = 
£ssiÚs
[
£ssiÚ
];

643 *
	gtbuf
 = (
T
*è(
iodesc
->
pšÃd_to_memÜy
->
d©a
 + 
off
);

644 ià(
	gdÚ•Œ
 !ğ
NULL
) {

645 
__sync_sub_ªd_ãtch
(
dÚ•Œ
, 1);

650 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

651 
mªaged_»Ëa£
(
£ssiÚ
, 
T
 ** 
±r
) {

652 ià(!
pšÃd_£ssiÚ
(
£ssiÚ
)) {

653 
as£¹
(*
±r
 !ğ
NULL
);

654 
ä“
(*
±r
);

656 *
	g±r
 = 
NULL
;

660 
Œunÿ‹
(
£ssiÚ
, 
size_t
 
nby‹s
) {

661 
as£¹
(!
pšÃd_£ssiÚ
(
£ssiÚ
));

662 
as£¹
(
muÉËx
 <= 1);

663 
	g¡©
 = 
árunÿ‹
(
£ssiÚs
[
£ssiÚ
]->
wr™edescs
[0], 
nby‹s
);

664 ià(
	g¡©
 != 0) {

665 
log¡»am
(
LOG_ERROR
è<< "Could‚Ùrunÿ‹ " << 
£ssiÚs
[
£ssiÚ
]->
f’ame
 <<

666 "ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

667 
as£¹
(
çl£
);

671 
wa™_fÜ_»ads
() {

672 
m‘rics_’Œy
 
	gme
 = 
m
.
¡¬t_time
();

673 
	gloİs
 = 0;

674 
	gm¶ex
 = (è
th»ad_šfos
.
size
();

675 
	gi
=0; i<
	gm¶ex
; i++) {

676 
	gth»ad_šfos
[
i
]->
	g³ndšg_»ads
 > 0) {

677 
u¦“p
(10000);

678 
	gloİs
++;

681 
	gm
.
¡İ_time
(
me
, "¡redio_wa™_fÜ_»ads", 
çl£
);

684 
wa™_fÜ_wr™es
() {

685 
m‘rics_’Œy
 
	gme
 = 
m
.
¡¬t_time
();

686 
	gm¶ex
 = (è
th»ad_šfos
.
size
();

687 
	gi
=0; i<
	gm¶ex
; i++) {

688 
	gth»ad_šfos
[
i
]->
	g³ndšg_wr™es
>0) {

689 
u¦“p
(10000);

692 
	gm
.
¡İ_time
(
me
, "¡redio_wa™_fÜ_wr™es", 
çl£
);

696 
	g¡d
::
¡ršg
 
muÉËx´efix
(
¡re
) {

697 ià(
muÉËx
 > 1) {

698 
m¡r
[255];

699 
¥rštf
(
m¡r
, "%d/", 1+
¡re
%
muÉËx
);

700  
	gmuÉËx_roÙ
 + 
	g¡d
::
¡ršg
(
m¡r
);

704 
	g¡d
::
¡ršg
 
muÉËx´efix_¿ndom
() {

705  
muÉËx´efix
(()
¿ndom
(è% 
muÉËx
);

710 * 
	$io_th»ad_loİ
(* 
_šfo
) {

711 
iÙask
 
sk
;

712 
thršfo
 * 
šfo
 = (thršfo*)
_šfo
;

713 
Áasks
 = 0;

715 
šfo
->
ruÂšg
) {

716 
boŞ
 
sucûss
;

717 ià(
šfo
->
³ndšg_»ads
>0) {

718 
sucûss
 = 
šfo
->
´ioqueue
->
	`§ãpİ
(&
sk
);

719 ià(!
sucûss
) {

720 
sucûss
 = 
šfo
->
»adqueue
->
	`§ãpİ
(&
sk
);

723 
sucûss
 = 
šfo
->
comm™queue
->
	`§ãpİ
(&
sk
);

725 ià(
sucûss
) {

726 ++
Áasks
;

727 ià(
sk
.
aùiÚ
 =ğ
WRITE
) {

728 
m‘rics_’Œy
 
me
 = 
šfo
->
m
->
	`¡¬t_time
();

730 ià(
sk
.
com´es£d
) {

731 
	`as£¹
(
sk
.
off£t
 == 0);

732 
	`wr™e_com´es£d
(
sk
.
fd
,ask.
±r
->±r,ask.
Ëngth
);

734 
	`pwr™—
(
sk
.
fd
,ask.
±r
->±¸+ask.
±roff£t
,ask.
Ëngth
,ask.
off£t
);

736 ià(
sk
.
ä“_aá”
) {

738 ià(
	`__sync_sub_ªd_ãtch
(&
sk
.
±r
->
couÁ
, 1) == 0) {

739 
	`ä“
(
sk
.
±r
->ptr);

740 
d–‘e
 
sk
.
±r
;

741 ià(
sk
.
şo£fd
) {

742 
sk
.
iomgr
->
	`şo£_£ssiÚ
Ñask.
£ssiÚ
);

747 
	`__sync_sub_ªd_ãtch
(&
šfo
->
³ndšg_wr™es
, 1);

748 
šfo
->
m
->
	`¡İ_time
(
me
, "commit_thr");

750 ià(
sk
.
com´es£d
) {

751 
	`as£¹
(
sk
.
off£t
 == 0);

752 
	`»ad_com´es£d
(
sk
.
fd
,ask.
±r
->±r,ask.
Ëngth
);

755 
	`´—da
(
sk
.
fd
,ask.
±r
->±r+sk.
±roff£t
,ask.
Ëngth
,ask.
off£t
);

757 
	`__sync_sub_ªd_ãtch
(&
šfo
->
³ndšg_»ads
, 1);

758 ià(
	`__sync_sub_ªd_ãtch
(&
sk
.
±r
->
couÁ
, 1) == 0) {

759 
	`ä“
(
sk
.
±r
);

760 ià(
sk
.
şo£fd
) {

761 
sk
.
iomgr
->
	`şo£_£ssiÚ
Ñask.
£ssiÚ
);

765 ià(
sk
.
dÚ•Œ
 !ğ
NULL
) {

766 
	`__sync_sub_ªd_ãtch
(
sk
.
dÚ•Œ
, 1);

769 
	`u¦“p
(50000);

773  
NULL
;

774 
	}
}

777 * 
	$¡»am_»ad_loİ
(* 
_šfo
) {

778 
¡»amšg_sk
 * 
sk
 = (¡»amšg_sk*)
_šfo
;

779 
timev®
 
¡¬t
, 
’d
;

780 
	`g‘timeofday
(&
¡¬t
, 
NULL
);

781 
size_t
 
bufsize
 = 32*1024*1024;

782 * 
tbuf
;

789 ià(
sk
->
iomgr
->
	`pšÃd_£ssiÚ
Ñask->
£ssiÚ
)) {

790 
	`__sync_add_ªd_ãtch
(&
sk
->
cu½os
,ask->
Ën
);

791  
NULL
;

793 
tbuf
 = *
sk
->
buf
;

794 
sk
->
cu½os
 <ask->
Ën
) {

795 
size_t
 
tÜ—d
 = 
¡d
::
	`mš
((size_t)
sk
->
Ën
 - (size_téask->
cu½os
, (size_t)
bufsize
);

796 
sk
->
iomgr
->
	`´—da_now
Ñask->
£ssiÚ
, 
tbuf
 +ask->
cu½os
, 
tÜ—d
,ask->curpos);

797 
	`__sync_add_ªd_ãtch
(&
sk
->
cu½os
, 
tÜ—d
);

800 
	`g‘timeofday
(&
’d
, 
NULL
);

802  
NULL
;

803 
	}
}

805 
size_t
 
g‘_fesize
(
¡d
::
¡ršg
 
f’ame
) {

806 
¡d
::
¡ršg
 
âame
 = 
f’ame
;

807 
	gf
 = 
İ’
(
âame
.
c_¡r
(), 
O_RDONLY
);

809 ià(
	gf
 < 0) {

810 
log¡»am
(
LOG_ERROR
è<< "Could‚Ù o³Àf" << 
	gf’ame
 << "ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
	g¡d
::
’dl
;

811 
as£¹
(
çl£
);

814 
off_t
 
	gsz
 = 
l£ek
(
f
, 0, 
SEEK_END
);

815 
şo£
(
f
);

816  
	gsz
;

	@src/logger/logger.hpp

49 #iâdeà
GRAPHCHI_LOG_LOG_HPP


50 
	#GRAPHCHI_LOG_LOG_HPP


	)

51 
	~<f¡»am
>

52 
	~<s¡»am
>

53 
	~<c¡dlib
>

54 
	~<io¡»am
>

55 
	~<ÿs£¹
>

56 
	~<c¡ršg
>

57 
	~<c¡d¬g
>

58 
	~<±h»ad.h
>

71 
	#LOG_NONE
 5

	)

72 
	#LOG_FATAL
 4

	)

73 
	#LOG_ERROR
 3

	)

74 
	#LOG_WARNING
 2

	)

75 
	#LOG_INFO
 1

	)

76 
	#LOG_DEBUG
 0

	)

85 #iâdeà
OUTPUTLEVEL


86 
	#OUTPUTLEVEL
 
LOG_DEBUG


	)

89 
	#COLOROUTPUT


	)

100 #ià
OUTPUTLEVEL
 =ğ
LOG_NONE


102 
	#logg”
(
lvl
,
fmt
,...)

	)

103 
	#logbuf
(
lvl
,
fmt
,...)

	)

104 
	#log¡»am


	)

107 
	#logg”
(
lvl
,
fmt
,...) \

108 (
log_di¥©ch
<(
lvl
 >ğ
OUTPUTLEVEL
)>::
	`exec
Övl,
__FILE__
, 
__func__
 ,
__LINE__
,
fmt
,##
__VA_ARGS__
))

	)

111 
	#logbuf
(
lvl
,
buf
,
Ën
) \

112 (
log_di¥©ch
<(
lvl
 >ğ
OUTPUTLEVEL
)>::
	`exec
Övl,
__FILE__
, \

113 
__func__
 ,
__LINE__
,
buf
,
Ën
))

	)

115 
	#log¡»am
(
lvl
) \

116 (
log_¡»am_di¥©ch
<(
lvl
 >ğ
OUTPUTLEVEL
)>::
	`exec
Övl,
__FILE__
, 
__func__
 ,
__LINE__
è)

	)

119 cÚ¡ * 
	gmes§ges
[] = { "DEBUG: ",

125 
Çme¥aû
 
	glogg”_im¶
 {

126 
	s¡»ambuff_s_’Œy
 {

127 
	g¡d
::
¡ršg¡»am
 
¡»ambufãr
;

128 
boŞ
 
	g¡»amaùive
;

137 şas 
	cfe_logg”
{

138 
	mpublic
:

150 
	$£t_log_to_cÚsŞe
(
boŞ
 
cÚsŞ–og
) {

151 
log_to_cÚsŞe
 = 
cÚsŞ–og
;

155 
¡d
::
¡ršg
 
	$g‘_log_fe
() {

156  
log_fe
;

157 
	}
}

160 
boŞ
 
	$g‘_log_to_cÚsŞe
() {

161  
log_to_cÚsŞe
;

162 
	}
}

165 
	$g‘_log_Ëv–
() {

166  
log_Ëv–
;

167 
	}
}

170 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

171 
	gfe_logg”
& 
	gİ”©Ü
<<(
T
 
	ga
) {

173 
	glogg”_im¶
::
¡»ambuff_s_’Œy
* 
¡»ambuãÁry
 = 
»š‹½»t_ÿ¡
<
logg”_im¶
::streambuff_tls_entry*>(

174 
±h»ad_g‘¥ecific
(
¡»ambuffkey
));

175 ià(
	g¡»ambuãÁry
 !ğ
NULL
) {

176 
¡d
::
¡ršg¡»am
& 
¡»ambufãr
 = 
¡»ambuãÁry
->streambuffer;

177 
	gboŞ
& 
	g¡»amaùive
 = 
¡»ambuãÁry
->
¡»amaùive
;

179 ià(
	g¡»amaùive
è
	g¡»ambufãr
 << 
	ga
;

181  *
	gthis
;

184 
	gfe_logg”
& 
	gİ”©Ü
<<(cÚ¡ * 
	ga
) {

186 
	glogg”_im¶
::
¡»ambuff_s_’Œy
* 
¡»ambuãÁry
 = 
»š‹½»t_ÿ¡
<
logg”_im¶
::streambuff_tls_entry*>(

187 
±h»ad_g‘¥ecific
(
¡»ambuffkey
));

188 ià(
	g¡»ambuãÁry
 !ğ
NULL
) {

189 
¡d
::
¡ršg¡»am
& 
¡»ambufãr
 = 
¡»ambuãÁry
->streambuffer;

190 
	gboŞ
& 
	g¡»amaùive
 = 
¡»ambuãÁry
->
¡»amaùive
;

192 ià(
	g¡»amaùive
) {

193 
	g¡»ambufãr
 << 
	ga
;

194 ià(
	ga
[
¡¾’
(
a
)-1] == '\n') {

195 
¡»am_æush
();

199  *
	gthis
;

202 
	gfe_logg”
& 
	gİ”©Ü
<<(
	g¡d
::
o¡»am
& (*
f
)(
¡d
::ostream&)){

204 
logg”_im¶
::
¡»ambuff_s_’Œy
* 
¡»ambuãÁry
 = 
»š‹½»t_ÿ¡
<logger_impl::streambuff_tls_entry*>(

205 
±h»ad_g‘¥ecific
(
¡»ambuffkey
));

206 ià(
	g¡»ambuãÁry
 !ğ
NULL
) {

207 
¡d
::
¡ršg¡»am
& 
¡»ambufãr
 = 
¡»ambuãÁry
->streambuffer;

208 
	gboŞ
& 
	g¡»amaùive
 = 
¡»ambuãÁry
->
¡»amaùive
;

210 
	g¡d
::
	to¡»am
& (*
	t’dÉy³
)(
	t¡d
::ostream&);

211 ià(
	g¡»amaùive
) {

212 ià(
’dÉy³
(
f
è=ğ’dÉy³(
¡d
::
’dl
)) {

213 
¡»ambufãr
 << "\n";

214 
¡»am_æush
();

215 if(
	g¡»amlogËv–
 =ğ
LOG_FATAL
) {

216 
throw
 "log fatal";

222  *
	gthis
;

229 
	$£t_log_Ëv–
(
Ãw_log_Ëv–
) {

230 
log_Ëv–
 = 
Ãw_log_Ëv–
;

231 
	}
}

239 
	$¡»ambuffde¡ruùÜ
(* 
v
){

240 
logg”_im¶
::
¡»ambuff_s_’Œy
* 
t
 =

241 
»š‹½»t_ÿ¡
<
logg”_im¶
::
¡»ambuff_s_’Œy
*>(
v
);

242 
d–‘e
 
t
;

243 
	}
}

250 
	$fe_logg”
() {

251 
log_fe
 = "";

252 
log_to_cÚsŞe
 = 
Œue
;

253 
log_Ëv–
 = 
LOG_DEBUG
;

254 
	`±h»ad_mu‹x_š™
(&
mut
, 
NULL
);

255 
	`±h»ad_key_ü—‹
(&
¡»ambuffkey
, 
¡»ambuffde¡ruùÜ
);

256 
	}
}

258 ~
	$fe_logg”
() {

259 ià(
fout
.
	`good
()) {

260 
fout
.
	`æush
();

261 
fout
.
	`şo£
();

264 
	`±h»ad_mu‹x_de¡roy
(&
mut
);

265 
	}
}

267 
boŞ
 
£t_log_fe
(
¡d
::
¡ršg
 
fe
) {

269 ià(
fout
.
good
()) {

270 
fout
.
æush
();

271 
	gfout
.
şo£
();

272 
	glog_fe
 = "";

275 ià(
	gfe
.
Ëngth
() > 0) {

276 
	gfout
.
İ’
(
fe
.
c_¡r
());

277 ià(
	gfout
.
ç
()è 
	gçl£
;

278 
	glog_fe
 = 
fe
;

280  
	gŒue
;

285 
	#RESET
 0

	)

286 
	#BRIGHT
 1

	)

287 
	#DIM
 2

	)

288 
	#UNDERLINE
 3

	)

289 
	#BLINK
 4

	)

290 
	#REVERSE
 7

	)

291 
	#HIDDEN
 8

	)

293 
	#BLACK
 0

	)

294 
	#RED
 1

	)

295 
	#GREEN
 2

	)

296 
	#YELLOW
 3

	)

297 
	#BLUE
 4

	)

298 
	#MAGENTA
 5

	)

299 
	#CYAN
 6

	)

300 
	#WHITE
 7

	)

302 
	$‹xtcŞÜ
(
FILE
* 
hªdË
, 
©Œ
, 
fg
)

304 
commªd
[13];

306 
	`¥rštf
(
commªd
, "%c[%d;%dm", 0x1B, 
©Œ
, 
fg
 + 30);

307 
	`årštf
(
hªdË
, "%s", 
commªd
);

308 
	}
}

310 
	$»£t_cŞÜ
(
FILE
* 
hªdË
)

312 
commªd
[20];

314 
	`¥rštf
(
commªd
, "%c[0m", 0x1B);

315 
	`årštf
(
hªdË
, "%s", 
commªd
);

316 
	}
}

320 
	$_log
(
lš–ogËv–
,cÚ¡ * 
fe
,cÚ¡ * 
funùiÚ
,

321 
lše
,cÚ¡ * 
fmt
, 
va_li¡
 
­
 ){

323 ià(
lš–ogËv–
 >ğ0 &&†š–ogËv– <ğ3 &&†š–ogËv– >ğ
log_Ëv–
){

326 
fe
 = ((
	`¡¼chr
(file, '/') ? : file- 1) + 1);

328 
¡r
[1024];

331 
by‹swr™‹n
 = 
	`¢´štf
(
¡r
,1024, "%s%s(%s:%d): ",

332 
mes§ges
[
lš–ogËv–
],
fe
,
funùiÚ
,
lše
);

335 
by‹swr™‹n
 +ğ
	`v¢´štf
(
¡r
 + by‹swr™‹n,1024 - by‹swr™‹n,
fmt
,
­
);

337 
¡r
[
by‹swr™‹n
] = '\n';

338 
¡r
[
by‹swr™‹n
+1] = 0;

340 ià(
fout
.
	`good
()) {

341 
	`±h»ad_mu‹x_lock
(&
mut
);

342 
fout
 << 
¡r
;;

343 
	`±h»ad_mu‹x_uÆock
(&
mut
);

345 ià(
log_to_cÚsŞe
) {

346 #ifdeà
COLOROUTPUT


347 ià(
lš–ogËv–
 =ğ
LOG_FATAL
) {

348 
	`‹xtcŞÜ
(
¡d”r
, 
BRIGHT
, 
RED
);

350 ià(
lš–ogËv–
 =ğ
LOG_ERROR
) {

351 
	`‹xtcŞÜ
(
¡d”r
, 
BRIGHT
, 
RED
);

353 ià(
lš–ogËv–
 =ğ
LOG_WARNING
) {

354 
	`‹xtcŞÜ
(
¡d”r
, 
BRIGHT
, 
GREEN
);

357 
¡d
::
û¼
 << 
¡r
;;

358 #ifdeà
COLOROUTPUT


359 
	`»£t_cŞÜ
(
¡d”r
);

363 
	}
}

367 
	$_logbuf
(
lš–ogËv–
,cÚ¡ * 
fe
,cÚ¡ * 
funùiÚ
,

368 
lše
,cÚ¡ * 
buf
, 
Ën
) {

370 ià(
lš–ogËv–
 >ğ0 &&†š–ogËv– <ğ3 &&†š–ogËv– >ğ
log_Ëv–
){

373 
fe
 = ((
	`¡¼chr
(file, '/') ? : file- 1) + 1);

376 
size_t
 
h—d”Ën
 = 
	`¢´štf
(
NULL
,0,"%s%s(%s:%d): ",

377 
mes§ges
[
lš–ogËv–
],
fe
,
funùiÚ
,
lše
);

379 ià(
h—d”Ën
> 2047) {

380 
¡d
::
û¼
 << "Header†engthƒxceed buffer†ength!";

383 
¡r
[2048];

384 cÚ¡ *
Ãwlše
="\n";

386 
by‹swr™‹n
 = 
	`¢´štf
(
¡r
,2047,"%s%s(%s:%d): ",

387 
mes§ges
[
lš–ogËv–
],
fe
,
funùiÚ
,
lše
);

388 
	`_log¿w
(
lš–ogËv–
,
¡r
, 
by‹swr™‹n
);

389 
	`_log¿w
(
lš–ogËv–
,
buf
, 
Ën
);

390 
	`_log¿w
(
lš–ogËv–
,
Ãwlše
, ()
	`¡¾’
(newline));

393 
	}
}

395 
	$_log¿w
(
lš–ogËv–
, cÚ¡ * 
buf
, 
Ën
) {

396 ià(
fout
.
	`good
()) {

397 
	`±h»ad_mu‹x_lock
(&
mut
);

398 
fout
.
	`wr™e
(
buf
,
Ën
);

399 
	`±h»ad_mu‹x_uÆock
(&
mut
);

401 ià(
log_to_cÚsŞe
) {

402 #ifdeà
COLOROUTPUT


403 ià(
lš–ogËv–
 =ğ
LOG_FATAL
) {

404 
	`‹xtcŞÜ
(
¡d”r
, 
BRIGHT
, 
RED
);

406 ià(
lš–ogËv–
 =ğ
LOG_ERROR
) {

407 
	`‹xtcŞÜ
(
¡d”r
, 
BRIGHT
, 
RED
);

409 ià(
lš–ogËv–
 =ğ
LOG_WARNING
) {

410 
	`‹xtcŞÜ
(
¡d”r
, 
BRIGHT
, 
GREEN
);

412 ià(
lš–ogËv–
 =ğ
LOG_DEBUG
) {

413 
	`‹xtcŞÜ
(
¡d”r
, 
BRIGHT
, 
YELLOW
);

417 
¡d
::
û¼
.
	`wr™e
(
buf
,
Ën
);

418 #ifdeà
COLOROUTPUT


419 
	`»£t_cŞÜ
(
¡d”r
);

422 
	}
}

424 
	gfe_logg”
& 
	$¡¬t_¡»am
(
lš–ogËv–
,cÚ¡ * 
fe
,cÚ¡ * 
funùiÚ
, 
lše
) {

426 
logg”_im¶
::
¡»ambuff_s_’Œy
* 
¡»ambuãÁry
 = 
»š‹½»t_ÿ¡
<logger_impl::streambuff_tls_entry*>(

427 
	`±h»ad_g‘¥ecific
(
¡»ambuffkey
));

429 ià(
¡»ambuãÁry
 =ğ
NULL
) {

430 
¡»ambuãÁry
 = 
Ãw
 
logg”_im¶
::
¡»ambuff_s_’Œy
;

431 
	`±h»ad_£t¥ecific
(
¡»ambuffkey
, 
¡»ambuãÁry
);

433 
¡d
::
¡ršg¡»am
& 
¡»ambufãr
 = 
¡»ambuãÁry
->streambuffer;

434 
boŞ
& 
¡»amaùive
 = 
¡»ambuãÁry
->streamactive;

436 
fe
 = ((
	`¡¼chr
(file, '/') ? : file- 1) + 1);

438 ià(
lš–ogËv–
 >ğ
log_Ëv–
){

439 ià(
¡»ambufãr
.
	`¡r
().
	`Ëngth
() == 0) {

440 
¡»ambufãr
 << 
mes§ges
[
lš–ogËv–
] << 
fe


441 << "(" << 
funùiÚ
 << ":" <<
lše
<<"): ";

443 
¡»amaùive
 = 
Œue
;

444 
¡»amlogËv–
 = 
lš–ogËv–
;

447 
¡»amaùive
 = 
çl£
;

449  *
this
;

450 
	}
}

454 
	$¡»am_æush
() {

456 
logg”_im¶
::
¡»ambuff_s_’Œy
* 
¡»ambuãÁry
 = 
»š‹½»t_ÿ¡
<logger_impl::streambuff_tls_entry*>(

457 
	`±h»ad_g‘¥ecific
(
¡»ambuffkey
));

458 ià(
¡»ambuãÁry
 !ğ
NULL
) {

459 
¡d
::
¡ršg¡»am
& 
¡»ambufãr
 = 
¡»ambuãÁry
->streambuffer;

461 
¡»ambufãr
.
	`æush
();

462 
	`_log¿w
(
¡»amlogËv–
,

463 
¡»ambufãr
.
	`¡r
().
	`c_¡r
(),

464 ()(
¡»ambufãr
.
	`¡r
().
	`Ëngth
()));

465 
¡»ambufãr
.
	`¡r
("");

467 
	}
}

468 
	g´iv©e
:

469 
¡d
::
of¡»am
 
fout
;

470 
	g¡d
::
¡ršg
 
log_fe
;

472 
±h»ad_key_t
 
	g¡»ambuffkey
;

474 
	g¡»amlogËv–
;

475 
±h»ad_mu‹x_t
 
	gmut
;

477 
boŞ
 
	glog_to_cÚsŞe
;

478 
	glog_Ëv–
;

483 
	gfe_logg”
& 
glob®_logg”
();

488 
	g‹m¶©e
 <
boŞ
 
	gdo¡uff
>

489 
	slog_di¥©ch
 {};

491 
	g‹m¶©e
 <>

492 
	glog_di¥©ch
<
	gŒue
> {

493 
šlše
 
exec
(
logËv–
,cÚ¡ * 
fe
,cÚ¡ * 
funùiÚ
,

494 
lše
,cÚ¡ * 
fmt
, ... ) {

495 
va_li¡
 
	g¬gp
;

496 
va_¡¬t
(
¬gp
, 
fmt
);

497 
glob®_logg”
().
_log
(
logËv–
, 
fe
, 
funùiÚ
, 
lše
, 
fmt
, 
¬gp
);

498 
va_’d
(
¬gp
);

502 
	g‹m¶©e
 <>

503 
	glog_di¥©ch
<
	gçl£
> {

504 
šlše
 
exec
(
logËv–
,cÚ¡ * 
fe
,cÚ¡ * 
funùiÚ
,

505 
lše
,cÚ¡ * 
fmt
, ... ) {}

509 
	snuÎ_¡»am
 {

510 
	m‹m¶©e
<
ty³Çme
 
	mT
>

511 
šlše
 
nuÎ_¡»am
 
	mİ”©Ü
<<(
T
 
	mt
) { ‚ull_stream(); }

512 
šlše
 
nuÎ_¡»am
 
	mİ”©Ü
<<(cÚ¡ * 
	ma
) { ‚ull_stream(); }

513 
šlše
 
nuÎ_¡»am
 
	mİ”©Ü
<<(
	m¡d
::
o¡»am
& (*
f
)(
¡d
::ostream&)) { ‚ull_stream(); }

517 
	g‹m¶©e
 <
boŞ
 
	gdo¡uff
>

518 
	slog_¡»am_di¥©ch
 {};

520 
	g‹m¶©e
 <>

521 
	glog_¡»am_di¥©ch
<
	gŒue
> {

522 
šlše
 
	gfe_logg”
& 
exec
(
lš–ogËv–
,cÚ¡ * 
fe
,cÚ¡ * 
funùiÚ
, 
lše
) {

523  
glob®_logg”
().
¡¬t_¡»am
(
lš–ogËv–
, 
fe
, 
funùiÚ
, 
lše
);

527 
	g‹m¶©e
 <>

528 
	glog_¡»am_di¥©ch
<
	gçl£
> {

529 
šlše
 
nuÎ_¡»am
 
exec
(
lš–ogËv–
,cÚ¡ * 
fe
,cÚ¡ * 
funùiÚ
, 
lše
) {

530  
nuÎ_¡»am
();

534 
‹xtcŞÜ
(
FILE
* 
hªdË
, 
©Œ
, 
fg
);

535 
»£t_cŞÜ
(
FILE
* 
hªdË
);

537 
	gfe_logg”
& 
	$glob®_logg”
() {

538 
fe_logg”
 
l
;

539  
l
;

540 
	}
}

	@src/metrics/imetrics_reporter.hpp

32 #iâdeà
DEF_GRAPHCHI_IMETRICS_REPORTER


33 
	#DEF_GRAPHCHI_IMETRICS_REPORTER


	)

35 
	~<m­
>

38 
Çme¥aû
 
	gg¿phchi
 {

39 şas 
	cim‘rics_»pÜ‹r
 {

41 
	gpublic
:

42 
vœtu®
 
do_»pÜt
(
¡d
::
¡ršg
 
Çme
, std::¡ršg 
id
, std::
m­
<¡d::¡ršg, 
m‘rics_’Œy
> & 
’Œ›s
) = 0;

	@src/metrics/metrics.hpp

30 #iâdeà
DEF_METRICS_HPP


31 
	#DEF_METRICS_HPP


	)

33 
	~<c¡ršg
>

34 
	~<m­
>

35 
	~<veùÜ
>

36 
	~<lim™s
>

37 
	~<as£¹.h
>

38 
	~<sys/time.h
>

40 
	~"ut/±h»ad_toŞs.hµ
"

41 
	~"ut/cmdİts.hµ
"

43 
Çme¥aû
 
	gg¿phchi
 {

46 
	em‘riùy³
 {
	gREAL
, 
	gINTEGER
, 
	gTIME
, 
	gSTRING
, 
	gVECTOR
};

52 
	sm‘rics_’Œy
 {

53 
size_t
 
	gcouÁ
;

54 
	gv®ue
;

55 
	gmšv®ue
;

56 
	gcumv®ue
;

57 
	gmaxv®ue
;

58 
m‘riùy³
 
	gv®ty³
;

59 
	g¡d
::
¡ršg
 
¡ršgv®
;

60 
	g¡d
::
veùÜ
<> 
v
;

61 
timev®
 
	g¡¬t_time
;

62 
	gÏ¡time
;

64 
m‘rics_’Œy
() {}

66 
šlše
 
m‘rics_’Œy
(
fœ¡v®ue
, 
m‘riùy³
 
_v®ty³
) {

67 
	gmšv®ue
 = 
fœ¡v®ue
;

68 
	gmaxv®ue
 = 
fœ¡v®ue
;

69 
	gv®ue
 = 
fœ¡v®ue
;

70 
	gv®ty³
 = 
_v®ty³
;

71 
	gcumv®ue
 = 
v®ue
;

72 
	gcouÁ
 = 1;

73 ià(
	gv®ty³
 =ğ
VECTOR
è
v
.
push_back
(
fœ¡v®ue
);

75 
šlše
 
m‘rics_’Œy
(
¡d
::
¡ršg
 
sv®ue
) {

76 
v®ty³
 = 
STRING
;

77 
	g¡ršgv®
 = 
sv®ue
;

79 
šlše
 
m‘rics_’Œy
(
m‘riùy³
 
_v®ty³
) {

80 
	gv®ty³
 = 
_v®ty³
;

81 
	gcouÁ
 = 0;

82 
	gcumv®ue
 = 0;

83 
	gv®ue
 = 0;

84 
	gmšv®ue
 = 
¡d
::
num”ic_lim™s
<>::
max
();

85 
	gmaxv®ue
 = 
¡d
::
num”ic_lim™s
<>::
mš
();

87 
šlše
 
adj
(
v
) {

88 ià(
	gcouÁ
 == 0) {

89 
mšv®ue
 = 
v
;

90 
	gmaxv®ue
 = 
v
;

92 
	gmšv®ue
 = 
¡d
::
mš
(
v
,
mšv®ue
);

93 
	gmaxv®ue
 = 
¡d
::
max
(
v
,
maxv®ue
);

98 
šlše
 
add
(
x
) {

99 
adj
(
x
);

100 
	gv®ue
 +ğ
x
;

101 
	gcumv®ue
 +ğ
x
;

102 ++
	gcouÁ
;

103 ià(
	gv®ty³
 =ğ
VECTOR
) {

104 
v
.
push_back
(
x
);

111 
šlše
 
£t
(
v
) {

112 
adj
(
v
);

113 
	gv®ue
 = 
v
;

114 
	gcumv®ue
 +ğ
v
;

116 
šlše
 
£t
(
¡d
::
¡ršg
 
s
) {

117 
¡ršgv®
 = 
s
;

120 
šlše
 
add_veùÜ_’Œy
(
size_t
 
i
, 
x
) {

121 ià(
	gv
.
size
(è< 
	gi
 + 1èv.
»size
(
i
 + 1);

122 
	gcouÁ
 = 
v
.
size
();

123 
	gv®ue
 +ğ
x
;

124 
	gcumv®ue
 +ğ
x
;

125 
	gv
[
i
] +ğ
x
;

126 
adj
(
v
[
i
]);

129 
šlše
 
£t_veùÜ_’Œy
(
size_t
 
i
, 
x
) {

130 ià(
	gv
.
size
(è< 
	gi
 + 1èv.
»size
(
i
 + 1);

131 
	gcouÁ
 = 
v
.
size
();

132 
	gv®ue
 = 
v®ue
 - 
v
[
i
] + 
x
;

133 
	gcumv®ue
 = 
cumv®ue
 - 
v
[
i
] + 
x
;

134 
	gv
[
i
] = 
x
;

136 
	gmšv®ue
 = 
x
; 
	gmaxv®ue
 = x;

137 
size_t
 
	gi
 = 0; i < 
	gv
.
size
(); ++i) {

138 
adj
(
v
[
i
]);

142 
šlše
 
tim”_¡¬t
() {

143 
g‘timeofday
(&
¡¬t_time
, 
NULL
);

146 
šlše
 
tim”_¡İ
() {

147 
timev®
 
	g’d
;

148 
g‘timeofday
(&
’d
, 
NULL
);

149 
	gÏ¡time
 = 
’d
.
tv_£c
 - 
¡¬t_time
.tv_£ø+ (()Ónd.
tv_u£c
 - start_time.tv_usec)) / 1.0E6;

150 
add
(
Ï¡time
);

154 şas 
	cim‘rics_»pÜ‹r
 {

156 
	gpublic
:

157 
vœtu®
 ~
im‘rics_»pÜ‹r
() {}

158 
vœtu®
 
do_»pÜt
(
¡d
::
¡ršg
 
Çme
, std::¡ršg 
id
, std::
m­
<¡d::¡ršg, 
m‘rics_’Œy
> & 
’Œ›s
) = 0;

165 şas 
	cm‘rics
 {

167 
	g¡d
::
¡ršg
 
Çme
, 
	gid’t
;

168 
	g¡d
::
m­
<
¡d
::
¡ršg
, 
	gm‘rics_’Œy
> 
	g’Œ›s
;

169 
mu‹x
 
	gmlock
;

171 
	gpublic
:

172 
šlše
 
m‘rics
(
¡d
::
¡ršg
 
_Çme
 = "", std::¡ršg 
_id
 = ""è: 
Çme
(_Çme), 
id’t
 (_id) {

173 
	gthis
->
£t
("­p", 
_Çme
);

176 
šlše
 
ş—r
() {

177 
	g’Œ›s
.
ş—r
();

181 
šlše
 
	g¡d
::
¡ršg
 
™”key
(
¡d
::¡ršg 
key
, 
™”
) {

182 
	gs
[256];

183 
¥rštf
(
s
, "%s.%d", 
key
.
c_¡r
(), 
™”
);

184  
	g¡d
::
¡ršg
(
s
);

190 
šlše
 
add
(
¡d
::
¡ršg
 
key
, 
v®ue
, 
m‘riùy³
 
ty³
 = 
REAL
) {

191 
mlock
.
lock
();

192 ià(
	g’Œ›s
.
couÁ
(
key
) == 0) {

193 
’Œ›s
[
key
] = 
m‘rics_’Œy
(
v®ue
, 
ty³
);

195 
	g’Œ›s
[
key
].
add
(
v®ue
);

197 
	gmlock
.
uÆock
();

200 
šlše
 
add_to_veùÜ
(
¡d
::
¡ršg
 
key
, 
v®ue
) {

201 ià(
	g’Œ›s
.
couÁ
(
key
) == 0) {

202 
’Œ›s
[
key
] = 
m‘rics_’Œy
(
v®ue
, 
VECTOR
);

204 
	g’Œ›s
[
key
].
add
(
v®ue
);

208 
šlše
 
add_veùÜ_’Œy
(
¡d
::
¡ršg
 
key
, 
size_t
 
idx
, 
v®ue
) {

209 ià(
	g’Œ›s
.
couÁ
(
key
) == 0) {

210 
’Œ›s
[
key
] = 
m‘rics_’Œy
(
VECTOR
);

212 
	g’Œ›s
[
key
].
add_veùÜ_’Œy
(
idx
, 
v®ue
);

215 
šlše
 
£t
(
¡d
::
¡ršg
 
key
, 
size_t
 
v®ue
) {

216 
£t
(
key
, ()
v®ue
, 
INTEGER
);

220 
šlše
 
£t
(
¡d
::
¡ršg
 
key
, 
v®ue
) {

221 
£t
(
key
, ()
v®ue
, 
INTEGER
);

224 
šlše
 
£t
(
¡d
::
¡ršg
 
key
, 
v®ue
, 
m‘riùy³
 
ty³
 = 
REAL
) {

225 ià(
’Œ›s
.
couÁ
(
key
) == 0) {

226 
’Œ›s
[
key
] = 
m‘rics_’Œy
(
v®ue
, 
ty³
);

228 
	g’Œ›s
[
key
].
£t
(
v®ue
);

232 
šlše
 
£t_š‹g”
(
¡d
::
¡ršg
 
key
, 
size_t
 
v®ue
) {

233 ià(
	g’Œ›s
.
couÁ
(
key
) == 0) {

234 
’Œ›s
[
key
] = 
m‘rics_’Œy
(()
v®ue
, 
INTEGER
);

236 
	g’Œ›s
[
key
].
£t
(()
v®ue
);

240 
šlše
 
£t
(
¡d
::
¡ršg
 
key
, std::¡ršg 
s
) {

241 ià(
’Œ›s
.
couÁ
(
key
) == 0) {

242 
’Œ›s
[
key
] = 
m‘rics_’Œy
(
s
);

244 
	g’Œ›s
[
key
].
£t
(
s
);

248 
šlše
 
£t_veùÜ_’Œy_š‹g”
(
¡d
::
¡ršg
 
key
, 
size_t
 
idx
, size_ˆ
v®ue
) {

249 
£t_veùÜ_’Œy
(
key
, 
idx
, ()(
v®ue
));

252 
šlše
 
£t_veùÜ_’Œy
(
¡d
::
¡ršg
 
key
, 
size_t
 
idx
, 
v®ue
) {

253 
	gmlock
.
lock
();

255 ià(
	g’Œ›s
.
couÁ
(
key
) == 0) {

256 
’Œ›s
[
key
] = 
m‘rics_’Œy
(
VECTOR
);

258 
	g’Œ›s
[
key
].
£t_veùÜ_’Œy
(
idx
, 
v®ue
);

259 
	gmlock
.
uÆock
();

262 
šlše
 
¡¬t_time
(
¡d
::
¡ršg
 
key
) {

263 
mlock
.
lock
();

265 ià(
	g’Œ›s
.
couÁ
(
key
) == 0) {

266 
’Œ›s
[
key
] = 
m‘rics_’Œy
(
TIME
);

268 
	g’Œ›s
[
key
].
tim”_¡¬t
();

269 
	gmlock
.
uÆock
();

273 
m‘rics_’Œy
 
¡¬t_time
() {

274 
m‘rics_’Œy
 
me
(
TIME
);

275 
	gme
.
tim”_¡¬t
();

276  
	gme
;

281 
šlše
 
¡İ_time
(
m‘rics_’Œy
 
me
, 
¡d
::
¡ršg
 
key
, 
boŞ
 
show
=
çl£
) {

282 
me
.
tim”_¡İ
();

283 
	gmlock
.
lock
();

285 ià(
	g’Œ›s
.
couÁ
(
key
) == 0) {

286 
’Œ›s
[
key
] = 
m‘rics_’Œy
(
TIME
);

288 
	g’Œ›s
[
key
].
add
(
me
.
Ï¡time
);

289 ià(
	gshow
)

290 
	g¡d
::
cout
 << 
key
 << ": " << 
me
.
Ï¡time
 << " secs." << 
¡d
::
’dl
;

291 
	gmlock
.
uÆock
();

295 
šlše
 
¡İ_time
(
m‘rics_’Œy
 
me
, 
¡d
::
¡ršg
 
key
, 
™”num
, 
boŞ
 
show
=
çl£
) {

296 
me
.
tim”_¡İ
();

297 
	gmlock
.
lock
();

299 
	gt
 = 
me
.
Ï¡time
;

300 ià(
	g’Œ›s
.
couÁ
(
key
) == 0) {

301 
’Œ›s
[
key
] = 
m‘rics_’Œy
(
TIME
);

303 
	g’Œ›s
[
key
].
add
(
t
);

304 ià(
	gshow
)

305 
	g¡d
::
cout
 << 
key
 << ": " << 
me
.
Ï¡time
 << " secs." << 
¡d
::
’dl
;

307 
	gs
[256];

308 
¥rštf
(
s
, "%s.%d", 
key
.
c_¡r
(), 
™”num
);

309 
	g¡d
::
¡ršg
 
ikey
(
s
);

310 ià(
	g’Œ›s
.
couÁ
(
ikey
) == 0) {

311 
’Œ›s
[
ikey
] = 
m‘rics_’Œy
(
TIME
);

313 
	g’Œ›s
[
ikey
].
add
(
t
);

315 
	gmlock
.
uÆock
();

320 
šlše
 
¡İ_time
(
¡d
::
¡ršg
 
key
, 
boŞ
 
show
 = 
çl£
) {

321 
’Œ›s
[
key
].
tim”_¡İ
();

322 ià(
	gshow
)

323 
	g¡d
::
cout
 << 
key
 << ": " << 
’Œ›s
[key].
Ï¡time
 << " secs." << 
¡d
::
’dl
;

326 
šlše
 
m‘rics_’Œy
 
g‘
(
¡d
::
¡ršg
 
key
) {

327  
’Œ›s
[
key
];

331 
»pÜt
(
im‘rics_»pÜ‹r
 & 
»pÜ‹r
) {

332 ià(
	gÇme
 != "") {

333 
»pÜ‹r
.
do_»pÜt
(
Çme
, 
id’t
, 
’Œ›s
);

	@src/metrics/reps/basic_reporter.hpp

32 #iâdeà
GRAPHCHI_BASIC_REPORTER


33 
	#GRAPHCHI_BASIC_REPORTER


	)

35 
	~<io¡»am
>

36 
	~<m­
>

38 
	~"m‘rics/m‘rics.hµ
"

45 
Çme¥aû
 
	gg¿phchi
 {

47 şas 
	cbasic_»pÜ‹r
 : 
public
 
im‘rics_»pÜ‹r
 {

49 
public
:

50 
vœtu®
 ~
basic_»pÜ‹r
() {}

51 
vœtu®
 
do_»pÜt
(
¡d
::
¡ršg
 
Çme
, std::¡ršg 
id’t
, std::
m­
<¡d::¡ršg, 
m‘rics_’Œy
> & 
’Œ›s
) {

53 ià(
	gid’t
 !ğ
Çme
) {

54 
¡d
::
cout
 << std::
’dl
 << " ==ğREPORT FOR " << 
Çme
 << "(" << 
id’t
 << ") ===" << std::endl;

56 
	g¡d
::
cout
 << 
¡d
::
’dl
 << " ==ğREPORT FOR " << 
Çme
 << " ===" << std::endl;

60 
	ground
=0;„ound<4;„ound++) {

61 
	g¡d
::
m­
<
¡d
::
¡ršg
, 
	gm‘rics_’Œy
>::
™”©Ü
 
™
;

62 
	gc
 = 0;

64 
	g™
 = 
’Œ›s
.
begš
(); iˆ!ğ’Œ›s.
’d
(); ++it) {

65 
m‘rics_’Œy
 
	g’t
 = 
™
->
£cÚd
;

66 
	g’t
.
	gv®ty³
) {

67 
	gREAL
:

68 
INTEGER
:

69 ià(
round
 == 0) {

70 ià(
c
++ =ğ0è
¡d
::
cout
 << "[Num”ic]" << std::
’dl
;

71 
	g¡d
::
cout
 << 
™
->
fœ¡
 << ":\t\t";

72 ià(
	g’t
.
	gcouÁ
 > 1) {

73 
	g¡d
::
cout
 << 
’t
.
v®ue
 << "\t(couÁ: " <<ƒÁ.
couÁ
 << ", mš: " <<ƒÁ.
mšv®ue
 <<

74 ", max: " << 
’t
.
maxv®ue
 << ",‡vg: "

75 << 
’t
.
cumv®ue
/(ëÁ.
couÁ
 << ")" << 
¡d
::
’dl
;

77 
	g¡d
::
cout
 << 
’t
.
v®ue
 << 
¡d
::
’dl
;

81 
	gTIME
:

82 ià(
round
 == 1) {

83 ià(
c
++ =ğ0è
¡d
::
cout
 << "[Timšgs]" << std::
’dl
;

84 
	g¡d
::
cout
 << 
™
->
fœ¡
 << ":\t\t";

85 ià(
	g’t
.
	gcouÁ
>1) {

86 
	g¡d
::
cout
 << 
’t
.
v®ue
 << "s\ˆ(couÁ: " <<ƒÁ.
couÁ
 << ", mš: " <<ƒÁ.
mšv®ue
 <<

87 "s, " << "max: " << 
’t
.
maxv®ue
 << ",‡vg: "

88 << 
’t
.
cumv®ue
/(ëÁ.
couÁ
 << "s)" << 
¡d
::
’dl
;

90 
	g¡d
::
cout
 << 
’t
.
v®ue
 << " s" << 
¡d
::
’dl
;

94 
	gSTRING
:

95 ià(
round
 == 2) {

96 ià(
c
++ =ğ0è
¡d
::
cout
 << "[Oth”]" << std::
’dl
;

97 
	g¡d
::
cout
 << 
™
->
fœ¡
 << ":\t";

98 
	g¡d
::
cout
 << 
’t
.
¡ršgv®
 << 
¡d
::
’dl
;

101 
	gVECTOR
:

102 ià(
round
 == 3) {

103 ià(
c
++ =ğ0è
¡d
::
cout
 << "[Num”ic]" << std::
’dl
;

104 
	g¡d
::
cout
 << 
™
->
fœ¡
 << ":\t\t";

105 ià(
	g’t
.
	gcouÁ
 > 1) {

106 
	g¡d
::
cout
 << 
’t
.
v®ue
 << "\t(couÁ: " <<ƒÁ.
couÁ
 << ", mš: " <<ƒÁ.
mšv®ue
 <<

107 ", max: " << 
’t
.
maxv®ue
 << ",‡vg: "

108 << 
’t
.
cumv®ue
/(ëÁ.
couÁ
 << ")" << 
¡d
::
’dl
;

110 
	g¡d
::
cout
 << 
’t
.
v®ue
 << 
¡d
::
’dl
;

112 
	g¡d
::
cout
 << 
™
->
fœ¡
 << ".values:\t\t";

113 
size_t
 
	gj
=0; j<
	g’t
.
	gv
.
size
(); j++è
	g¡d
::
cout
 << 
’t
.
v
[
j
] << ",";

114 
	g¡d
::
cout
 << 
¡d
::
’dl
;

	@src/metrics/reps/file_reporter.hpp

30 #iâdeà
DEF_GRAPHCHI_FILE_REPORTER


31 
	#DEF_GRAPHCHI_FILE_REPORTER


	)

33 
	~<f¡»am
>

34 
	~<c¡dio
>

36 
	~"m‘rics/m‘rics.hµ
"

37 
	~"ut/cmdİts.hµ
"

41 
Çme¥aû
 
	gg¿phchi
 {

43 şas 
	cfe_»pÜ‹r
 : 
public
 
im‘rics_»pÜ‹r
 {

44 
´iv©e
:

45 
fe_»pÜ‹r
() {}

47 
¡d
::
¡ršg
 
f’ame
;

48 
FILE
 * 
	gf
;

49 
	gpublic
:

52 
fe_»pÜ‹r
(
¡d
::
¡ršg
 
âame
è: 
f’ame
(fname) {

54 
f
 = 
fİ’
(
âame
.
c_¡r
(), "w");

55 
as£¹
(
f
 !ğ
NULL
);

58 
	gvœtu®
 ~
fe_»pÜ‹r
() {}

60 
vœtu®
 
do_»pÜt
(
¡d
::
¡ršg
 
Çme
, std::¡ršg 
id’t
, std::
m­
<¡d::¡ršg, 
m‘rics_’Œy
> & 
’Œ›s
) {

61 ià(
	gid’t
 !ğ
Çme
) {

62 
årštf
(
f
, "[%s:%s]\n", 
Çme
.
c_¡r
(), 
id’t
.c_str());

64 
årštf
(
f
, "[%s]\n", 
Çme
.
c_¡r
());

66 
	g¡d
::
m­
<
¡d
::
¡ršg
, 
	gm‘rics_’Œy
>::
™”©Ü
 
™
;

68 
	g™
 = 
’Œ›s
.
begš
(); iˆ!ğ’Œ›s.
’d
(); ++it) {

69 
m‘rics_’Œy
 
	g’t
 = 
™
->
£cÚd
;

70 
	g’t
.
	gv®ty³
) {

71 
	gINTEGER
:

73 
årštf
(
f
, "%s.%s=%ld\n", 
id’t
.
c_¡r
(), 
™
->
fœ¡
.c_¡r(), (è(
’t
.
v®ue
));

74 
årštf
(
f
, "%s.%s.couÁ=%lu\n", 
id’t
.
c_¡r
(), 
™
->
fœ¡
.c_¡r(), 
’t
.
couÁ
);

75 
årštf
(
f
, "%s.%s.mš=%ld\n", 
id’t
.
c_¡r
(), 
™
->
fœ¡
.c_¡r(), (è(
’t
.
mšv®ue
));

76 
årštf
(
f
, "%s.%s.max=%ld\n", 
id’t
.
c_¡r
(), 
™
->
fœ¡
.c_¡r(), (è(
’t
.
maxv®ue
));

77 
årštf
(
f
, "%s.%s.avg=%lf\n", 
id’t
.
c_¡r
(), 
™
->
fœ¡
.c_¡r(), 
’t
.
cumv®ue
/’t.
couÁ
);

79 
	gREAL
:

80 
TIME
:

81 
årštf
(
f
, "%s.%s=%lf\n", 
id’t
.
c_¡r
(), 
™
->
fœ¡
.c_¡r(), (
’t
.
v®ue
));

82 
årštf
(
f
, "%s.%s.couÁ=%lu\n", 
id’t
.
c_¡r
(), 
™
->
fœ¡
.c_¡r(), 
’t
.
couÁ
);

83 
årštf
(
f
, "%s.%s.mš=%lf\n", 
id’t
.
c_¡r
(), 
™
->
fœ¡
.c_¡r(), (
’t
.
mšv®ue
));

84 
årštf
(
f
, "%s.%s.max=%lf\n", 
id’t
.
c_¡r
(), 
™
->
fœ¡
.c_¡r(), (
’t
.
maxv®ue
));

85 
årštf
(
f
, "%s.%s.avg=%lf\n", 
id’t
.
c_¡r
(), 
™
->
fœ¡
.c_¡r(), 
’t
.
cumv®ue
/’t.
couÁ
);

87 
	gSTRING
:

88 
årštf
(
f
, "%s.%s=%s\n", 
id’t
.
c_¡r
(), 
™
->
fœ¡
.c_¡r(), it->
£cÚd
.
¡ršgv®
.c_str());

90 
	gVECTOR
:

95 
fæush
(
f
);

96 
fşo£
(
f
);

99 ià(
g‘_İtiÚ_št
("metrics.insert_to_db", 0) == 1) {

100 
¡d
::
¡ršg
 
cmd
 = "pythÚ2.7 b’chtodb.py " + 
f’ame
;

101 
	g”r
 = 
sy¡em
(
cmd
.
c_¡r
());

102 ià(
	g”r
 != 0) {

103 
¡d
::
cout
 << "E¼Ü„uÂšghpythÚ süt." << std::
’dl
;

	@src/metrics/reps/html_reporter.hpp

31 #iâdeà
GRAPHCHI_HTML_REPORTER


32 
	#GRAPHCHI_HTML_REPORTER


	)

34 
	~<c¡dio
>

36 
	~"m‘rics/m‘rics.hµ
"

43 
Çme¥aû
 
	gg¿phchi
 {

45 şas 
	chtml_»pÜ‹r
 : 
public
 
im‘rics_»pÜ‹r
 {

46 
´iv©e
:

47 
html_»pÜ‹r
() {}

49 
¡d
::
¡ršg
 
f’ame
;

50 
FILE
 * 
	gf
;

51 
	gpublic
:

54 
html_»pÜ‹r
(
¡d
::
¡ršg
 
âame
è: 
f’ame
(fname) {

56 
f
 = 
fİ’
(
âame
.
c_¡r
(), "w");

57 
as£¹
(
f
 !ğ
NULL
);

58 
årštf
(
f
, "<html><head><title>GraphCHI Metrics Report</title>");

59 
årštf
(
f
, "<style>\n");

60 
årštf
(
f
, "table { border: 1px solid #999999; font:‚ormal 80%%/140%%‡rial, helvetica, sans-serif; color: #555; background: #fff;}d,h {border: 1px dotted #bbb;…adding: .5em; width:100px} ");

61 
årštf
(
f
, "</style></head><body>");

64 
	gvœtu®
 ~
html_»pÜ‹r
() {

65 
årštf
(
f
, "</body></html>");

66 
fşo£
(
f
);

69 
vœtu®
 
do_»pÜt
(
¡d
::
¡ršg
 
Çme
, std::¡ršg 
id’t
, std::
m­
<¡d::¡ršg, 
m‘rics_’Œy
> & 
’Œ›s
) {

70 ià(
	gid’t
 !ğ
Çme
) {

71 
årštf
(
f
, "<h3>%s:%s</h3>\n", 
Çme
.
c_¡r
(), 
id’t
.c_str());

73 
årštf
(
f
, "<h3>%s</h3>\n", 
Çme
.
c_¡r
());

78 
	ground
=0;„ound<4;„ound++) {

79 
	g¡d
::
m­
<
¡d
::
¡ršg
, 
	gm‘rics_’Œy
>::
™”©Ü
 
™
;

80 
	gc
 = 0;

81 
årštf
(
f
, "<!-- Round %d -->\n", 
round
);

82 
årštf
(
f
, "\n<p>");

83 
	g™
 = 
’Œ›s
.
begš
(); iˆ!ğ’Œ›s.
’d
(); ++it) {

84 
m‘rics_’Œy
 
	g’t
 = 
™
->
£cÚd
;

85 
	g’t
.
	gv®ty³
) {

86 
	gINTEGER
:

87 ià(
round
 == 0) {

88 ià(
c
++ == 0)

89 
årštf
(
f
, "<table><tr><th>Key</th><th>Value</th><th>Count</th><th>Min</th><th>Max</th><th>Average</th></tr>");

91 
årštf
(
f
, "<Œ><td>%s</td>\n", 
™
->
fœ¡
.
c_¡r
());

93 
årštf
(
f
, "<td>%ld</td>\n", (è
’t
.
v®ue
);

94 ià(
	g’t
.
	gcouÁ
 > 1) {

95 
årštf
(
f
, "<td>%ld</td>\n", (è
’t
.
couÁ
);

96 
årštf
(
f
, "<td>%ld</td>\n", (è
’t
.
mšv®ue
);

97 
årštf
(
f
, "<td>%ld</td>\n", (è
’t
.
maxv®ue
);

98 
årštf
(
f
, "<td>%.3lf</td>\n", 
’t
.
cumv®ue
/(ëÁ.
couÁ
);

99 } 
årštf
(
f
, "<td colspan=4>&nbsp;</td>");

100 
årštf
(
f
, "</tr>");

103 
	gREAL
:

104 ià(
round
 == 0) {

105 ià(
c
++ == 0)

106 
årštf
(
f
, "<table><tr><th>Key</th><th>Value</th><th>Count</th><th>Min</th><th>Max</th><th>Average</th></tr>");

108 
	gTIME
:

109 ià(
’t
.
v®ty³
 =ğ
TIME
 && 
round
 == 1) {

110 ià(
c
++ == 0)

111 
årštf
(
f
, "<table><tr><th>Key</th><th>Value (sec)</th><th>Count</th><th>Min (sec)</th><th>Max (sec)</th><th>Average (sec)</th></tr>\n");

113 ià((
	ground
 =ğ0 && 
’t
.
v®ty³
 =ğ
REAL
)||(
round
 =ğ1 &&ƒÁ.v®ty³ =ğ
TIME
)) {

114 
årštf
(
f
, "<Œ><td>%s</td>\n", 
™
->
fœ¡
.
c_¡r
());

116 
årštf
(
f
, "<td>%lf</td>\n", 
’t
.
v®ue
);

117 ià(
	g’t
.
	gcouÁ
 > 1) {

118 
årštf
(
f
, "<td>%ld</td>\n", (è
’t
.
couÁ
);

119 
årštf
(
f
, "<td>%.3lf</td>\n", 
’t
.
mšv®ue
);

120 
årštf
(
f
, "<td>%.3lf</td>\n", 
’t
.
maxv®ue
);

121 
årštf
(
f
, "<td>%.3lf</td>\n", 
’t
.
cumv®ue
/(ëÁ.
couÁ
);

122 } 
årštf
(
f
, "<td colspan=4>&nbsp;</td>");

123 
årštf
(
f
, "</tr>");

126 
	gSTRING
:

127 ià(
round
 == 2) {

128 ià(
c
++ == 0)

129 
årštf
(
f
, "<table><tr><th>Key</th><th>Value</th></tr>\n");

130 
årštf
(
f
, "<Œ><td>%s</td><td width=400>%s</td>\n", 
™
->
fœ¡
.
c_¡r
(), 
’t
.
¡ršgv®
.c_str());

131 
årštf
(
f
, "</tr>");

135 
	gVECTOR
:

136 ià(
round
 == 3) {

142 ià(
	gc
>0è
årštf
(
f
, "</table>");

143 
årštf
(
f
, " </p>");

146 
fæush
(
f
);

	@src/metrics/reps/null_reporter.hpp

28 #iâdeà
GRAPHLAB_NULL_REPORTER


29 
	#GRAPHLAB_NULL_REPORTER


	)

31 
	~"m‘rics/m‘rics.hµ
"

38 
Çme¥aû
 
	gg¿phchi
 {

40 şas 
	cnuÎ_»pÜ‹r
 : 
public
 
im‘rics_»pÜ‹r
 {

42 
public
:

43 
vœtu®
 ~
nuÎ_»pÜ‹r
();

44 
vœtu®
 
do_»pÜt
(
¡d
::
¡ršg
 
Çme
, std::¡ršg 
id’t
, std::
m­
<¡d::¡ršg, 
m‘rics_’Œy
> & 
’Œ›s
) {

	@src/preprocessing/blocksplitter.cpp

28 
	~<io¡»am
>

29 
	~<¡dlib.h
>

30 
	~<¡ršg
>

31 
	~<as£¹.h
>

32 
	~<uni¡d.h
>

33 
	~<f¡»am
>

34 
	~<sys/¡©.h
>

36 
	~"­i/chif’ames.hµ
"

37 
	~"io/¡redio.hµ
"

38 
	~"logg”/logg”.hµ
"

39 
	~"ut/iout.hµ
"

40 
	~"ut/cmdİts.hµ
"

41 
	~"´•roûssšg/cÚv”siÚs.hµ
"

42 
	~"´•roûssšg/sh¬d”.hµ
"

44 
usšg
 
Çme¥aû
 
	gg¿phchi
;

47 
	tEdgeD©aTy³
;

49 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

50 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

52 
	`glob®_logg”
().
	`£t_log_Ëv–
(
LOG_DEBUG
);

55 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

56 
nsh¬ds
 = 
cÚv”t_if_nÙexi¡s
<
EdgeD©aTy³
>(
f’ame
, 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"));

57 
size_t
 
blocksize
ğ
	`g‘_İtiÚ_lÚg
("blocksize", 4096 * 1024);

59 * 
buf
 = (*è
	`m®loc
(
blocksize
);

60 
p
=0;… < 
nsh¬ds
;…++) {

61 
¡d
::
¡ršg
 
sh¬d_f’ame
 = 
f’ame_sh¬d_ed©a
<
EdgeD©aTy³
>(
f’ame
, 
p
, 
nsh¬ds
);

62 
f
 = 
	`İ’
(
sh¬d_f’ame
.
	`c_¡r
(), 
O_RDONLY
);

63 
size_t
 
fsize
 = 
	`g‘_fesize
(
sh¬d_f’ame
);

65 
size_t
 
nblocks
 = 
fsize
 / 
blocksize
 + (fsize % blocksize != 0);

66 
size_t
 
idx
 = 0;

67 
¡d
::
¡ršg
 
block_dœÇme
 = 
	`dœÇme_sh¬d_ed©a_block
(
sh¬d_f’ame
, 
blocksize
);

68 
	`log¡»am
(
LOG_INFO
è<< "GošgØü—‹: " << 
block_dœÇme
 << 
¡d
::
’dl
;

69 
”r
 = 
	`mkdœ
(
block_dœÇme
.
	`c_¡r
(), 0777);

70 ià(
”r
 != 0) {

71 
	`log¡»am
(
LOG_ERROR
è<< 
	`¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

74 
i
=0; i < 
nblocks
; i++) {

75 
size_t
 
Ën
 = 
¡d
::
	`mš
(
blocksize
, 
fsize
 - 
idx
);

76 
	`´—da
(
f
, 
buf
, 
Ën
, 
idx
);

78 
¡d
::
¡ršg
 
block_f’ame
 = 
	`f’ame_sh¬d_ed©a_block
(
sh¬d_f’ame
, 
i
, 
blocksize
);

79 
bf
 = 
	`İ’
(
block_f’ame
.
	`c_¡r
(), 
O_RDWR
 | 
O_CREAT
, 
S_IROTH
 | 
S_IWOTH
 | 
S_IWUSR
 | 
S_IRUSR
);

80 
	`wr™e_com´es£d
(
bf
, 
buf
, 
Ën
);

81 
	`şo£
(
bf
);

83 
idx
 +ğ
blocksize
;

85 
	`şo£
(
f
);

87 
¡d
::
¡ršg
 
sizef’ame
 = 
sh¬d_f’ame
 + ".size";

88 
¡d
::
of¡»am
 
	`ofs
(
sizef’ame
.
	`c_¡r
());

89 
ofs
 << 
fsize
;

90 
ofs
.
	`şo£
();

92 
	}
}

	@src/preprocessing/conversions.hpp

28 #iâdeà
GRAPHCHI_CONVERSIONS_DEF


29 
	#GRAPHCHI_CONVERSIONS_DEF


	)

31 
	~<fú.h
>

32 
	~<uni¡d.h
>

33 
	~<sys/ty³s.h
>

34 
	~<dœ’t.h
>

35 
	~<sys/¡©.h
>

37 
	~"g¿phchi_ty³s.hµ
"

38 
	~"logg”/logg”.hµ
"

39 
	~"´•roûssšg/sh¬d”.hµ
"

40 
	~"´•roûssšg/fÜm©s/bš¬y_adjaûncy_li¡.hµ
"

46 #ifdeà
__GNUC__


47 
	#VARIABLE_IS_NOT_USED
 
	`__©Œibu‹__
 ((
unu£d
))

	)

49 
	#VARIABLE_IS_NOT_USED


	)

52 
Çme¥aû
 
	gg¿phchi
 {

55 
VARIABLE_IS_NOT_USED
 
·r£
(&
x
, cÚ¡ * 
s
);

56 
VARIABLE_IS_NOT_USED
 
·r£
(&
x
, cÚ¡ * 
s
);

57 
VARIABLE_IS_NOT_USED
 
·r£
(&
x
, cÚ¡ * 
s
);

58 
VARIABLE_IS_NOT_USED
 
·r£
(&
x
, cÚ¡ * 
s
);

59 
VARIABLE_IS_NOT_USED
 
·r£
(&
x
, cÚ¡ * 
s
);

60 
VARIABLE_IS_NOT_USED
 
·r£
(
boŞ
 &
x
, cÚ¡ * 
s
);

61 
VARIABLE_IS_NOT_USED
 
·r£
(&
x
, cÚ¡ * 
s
);

62 
VARIABLE_IS_NOT_USED
 
·r£
(&
x
, cÚ¡ * 
s
);

63 
FIXLINE
(* 
s
);

65 
·r£
(&
x
, cÚ¡ * 
s
) {

66 
	gx
 = 
©oi
(
s
);

69 
·r£
(&
x
, cÚ¡ * 
s
) {

70 
	gx
 = (è
¡¹oul
(
s
, 
NULL
, 10);

73 
·r£
(&
x
, cÚ¡ * 
s
) {

74 
	gx
 = (è
©of
(
s
);

81 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

82 
·r£
(
PaœCÚš”
<
T
> &
x
, cÚ¡ * 
s
) {

83 
·r£
(
x
.
Ëá
, 
s
);

84 
·r£
(
x
.
right
, 
s
);

87 
·r£
(&
x
, cÚ¡ * 
s
) {

88 
	gx
 = 
©Ş
(
s
);

91 
·r£
(&
x
, cÚ¡ * 
s
) {

92 
	gx
 = 
s
[0];

95 
·r£
(
boŞ
 &
x
, cÚ¡ * 
s
) {

96 
	gx
 = 
©oi
(
s
) == 1;

99 
·r£
(&
x
, cÚ¡ * 
s
) {

100 
	gx
 = 
©of
(
s
);

103 
·r£
(&
x
, cÚ¡ * 
s
) {

104 
	gx
 = (è
©oi
(
s
);

108 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

109 
·r£
(
T
 &
x
, cÚ¡ * 
s
) {

110 
log¡»am
(
LOG_FATAL
) << "You‚eedo define…arse<your-type>(your-type &x, const char *s) function"

111 << "ØsuµÜˆ·rsšghedgv®ue." << 
	g¡d
::
’dl
;

112 
as£¹
(
çl£
);

118 
FIXLINE
(* 
s
) {

119 
	gËn
 = (è
¡¾’
(
s
)-1;

120 if(
	gs
[
Ën
] =ğ'\n'è
s
[len] = 0;

125 
g‘dœ
 (
¡d
::
¡ršg
 
dœ
, std::
veùÜ
<¡d::¡ršg> &
fes
);

126 
g‘dœ
 (
¡d
::
¡ršg
 
dœ
, std::
veùÜ
<¡d::¡ršg> &
fes
)

128 
DIR
 *
dp
;

129 
dœ’t
 *
	gdœp
;

130 if((
	gdp
 = 
İ’dœ
(
dœ
.
c_¡r
())è=ğ
NULL
) {

131 
¡d
::
cout
 << "E¼Ü(" << 
”ºo
 << "èİ’šg " << 
dœ
 << std::
’dl
;

132  
	g”ºo
;

135 (
	gdœp
 = 
»addœ
(
dp
)è!ğ
NULL
) {

136 
fes
.
push_back
(
¡d
::
¡ršg
(
dœp
->
d_Çme
));

138 
şo£dœ
(
dp
);

142 
	g¡d
::
¡ršg
 
g‘_dœÇme
(
¡d
::¡ršg 
¬g
);

143 
	g¡d
::
¡ršg
 
g‘_dœÇme
(
¡d
::¡ršg 
¬g
) {

144 
size_t
 
a
 = 
¬g
.
fšd_Ï¡_of
("/");

145 ià(
	ga
 !ğ
¬g
.
Åos
) {

146 
¡d
::
¡ršg
 
dœ
 = 
¬g
.
sub¡r
(0, 
a
);

147  
	gdœ
;

149 
as£¹
(
çl£
);

153 
	g¡d
::
¡ršg
 
g‘_f’ame
(
¡d
::¡ršg 
¬g
);

154 
	g¡d
::
¡ršg
 
g‘_f’ame
(
¡d
::¡ršg 
¬g
) {

155 
size_t
 
a
 = 
¬g
.
fšd_Ï¡_of
("/");

156 ià(
	ga
 !ğ
¬g
.
Åos
) {

157 
¡d
::
¡ršg
 
f
 = 
¬g
.
sub¡r
(
a
 + 1);

158  
	gf
;

160 
as£¹
(
çl£
);

168 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

169 
cÚv”t_edg–i¡
(
¡d
::
¡ršg
 
šputfe
, 
sh¬d”
<
EdgeD©aTy³
> &
sh¬d”obj
) {

171 
FILE
 * 
	gšf
 = 
fİ’
(
šputfe
.
c_¡r
(), "r");

172 
size_t
 
	gby‹¤—d
 = 0;

173 
size_t
 
	glš’um
 = 0;

174 ià(
	gšf
 =ğ
NULL
) {

175 
log¡»am
(
LOG_FATAL
è<< "Could‚Ù†ßd :" << 
šputfe
 << "ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

177 
as£¹
(
šf
 !ğ
NULL
);

179 
log¡»am
(
LOG_INFO
è<< "R—dšg iÀedgli¡ fÜm©!" << 
	g¡d
::
’dl
;

180 
	gs
[1024];

181 
fg‘s
(
s
, 1024, 
šf
è!ğ
NULL
) {

182 
lš’um
++;

183 ià(
	glš’um
 % 10000000 == 0) {

184 
log¡»am
(
LOG_DEBUG
è<< "R—d " << 
lš’um
 << "†šes, " << 
by‹¤—d
 / 1024 / 1024. << " MB" << 
¡d
::
’dl
;

186 
FIXLINE
(
s
);

187 
	gby‹¤—d
 +ğ
¡¾’
(
s
);

188 ià(
	gs
[0] == '#') ;

189 ià(
	gs
[0] == '%') ;

191 
	gd–ims
[] = "\t ";

192 * 
	gt
;

193 
	gt
 = 
¡¹ok
(
s
, 
d–ims
);

194 ià(
	gt
 =ğ
NULL
) {

195 
log¡»am
(
LOG_ERROR
) << "Input file is‚ot in„ight format. "

197 << "Cu¼’ˆlše: \"" << 
s
 << "\"\n";

198 
as£¹
(
çl£
);

200 
vid_t
 
	gäom
 = 
©oi
(
t
);

201 
	gt
 = 
¡¹ok
(
NULL
, 
d–ims
);

202 ià(
	gt
 =ğ
NULL
) {

203 
log¡»am
(
LOG_ERROR
) << "Input file is‚ot in„ight format. "

205 << "Cu¼’ˆlše: \"" << 
s
 << "\"\n";

206 
as£¹
(
çl£
);

208 
vid_t
 
	gto
 = 
©oi
(
t
);

211 
	gt
 = 
¡¹ok
(
NULL
, 
d–ims
);

213 
EdgeD©aTy³
 
	gv®
;

214 ià(
	gt
 !ğ
NULL
) {

215 
·r£
(
v®
, (cÚ¡ *è
t
);

217 ià(
	gäom
 !ğ
to
) {

218 ià(
t
 !ğ
NULL
) {

219 
sh¬d”obj
.
´•roûssšg_add_edge
(
äom
, 
to
, 
v®
);

221 
	gsh¬d”obj
.
´•roûssšg_add_edge
(
äom
, 
to
);

225 
fşo£
(
šf
);

232 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

233 
cÚv”t_adjli¡
(
¡d
::
¡ršg
 
šputfe
, 
sh¬d”
<
EdgeD©aTy³
> &
sh¬d”obj
) {

234 
FILE
 * 
	gšf
 = 
fİ’
(
šputfe
.
c_¡r
(), "r");

235 ià(
	gšf
 =ğ
NULL
) {

236 
log¡»am
(
LOG_FATAL
è<< "Could‚Ù†ßd :" << 
šputfe
 << "ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

238 
as£¹
(
šf
 !ğ
NULL
);

239 
log¡»am
(
LOG_INFO
è<< "R—dšg iÀadjaûncy†i¡ fÜm©!" << 
	g¡d
::
’dl
;

241 
	gmaxËn
 = 100000000;

242 * 
	gs
 = (*è
m®loc
(
maxËn
);

244 
size_t
 
	gby‹¤—d
 = 0;

246 
	gd–ims
[] = " \t";

247 
size_t
 
	glš’um
 = 0;

248 
size_t
 
	gÏ¡log
 = 0;

250 
fg‘s
(
s
, 
maxËn
, 
šf
è!ğ
NULL
) {

251 
lš’um
++;

252 ià(
	gby‹¤—d
 - 
	gÏ¡log
 >= 500000000) {

253 
log¡»am
(
LOG_DEBUG
è<< "R—d " << 
lš’um
 << "†šes, " << 
by‹¤—d
 / 1024 / 1024. << " MB" << 
¡d
::
’dl
;

254 
	gÏ¡log
 = 
by‹¤—d
;

256 
FIXLINE
(
s
);

257 
	gby‹¤—d
 +ğ
¡¾’
(
s
);

259 ià(
	gs
[0] == '#') ;

260 ià(
	gs
[0] == '%') ;

261 * 
	gt
 = 
¡¹ok
(
s
, 
d–ims
);

262 
vid_t
 
	gäom
 = 
©oi
(
t
);

263 
	gt
 = 
¡¹ok
(
NULL
,
d–ims
);

264 ià(
	gt
 !ğ
NULL
) {

265 
vid_t
 
num
 = 
©oi
(
t
);

266 
vid_t
 
	gi
 = 0;

267 (
	gt
 = 
¡¹ok
(
NULL
,
d–ims
)) != NULL) {

268 
vid_t
 
to
 = 
©oi
(
t
);

269 ià(
	gäom
 !ğ
to
) {

270 
sh¬d”obj
.
´•roûssšg_add_edge
(
äom
, 
to
, 
EdgeD©aTy³
());

272 
	gi
++;

274 ià(
	gnum
 !ğ
i
)

275 
log¡»am
(
LOG_ERROR
è<< "Mism©ch wh’„—dšg‡djaûncy†i¡: " << 
num
 << " !ğ" << 
i
 << " s: " << 
¡d
::
¡ršg
(
s
)

276 << " oÀlše: " << 
lš’um
 << 
¡d
::
’dl
;

277 
as£¹
(
num
 =ğ
i
);

280 
ä“
(
s
);

281 
fşo£
(
šf
);

288 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

289 
cÚv”t_ÿssov¬y
(
¡d
::
¡ršg
 
ba£f’ame
, 
sh¬d”
<
EdgeD©aTy³
> &
sh¬d”obj
) {

290 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
·¹s
;

291 
	g¡d
::
¡ršg
 
dœÇme
 = 
g‘_dœÇme
(
ba£f’ame
);

292 
	g¡d
::
¡ršg
 
´efix
 = 
g‘_f’ame
(
ba£f’ame
);

294 
	g¡d
::
cout
 << "dœ=[" << 
dœÇme
 << "]…»fix=[" << 
´efix
 << "]" << 
¡d
::
’dl
;

295 
g‘dœ
(
dœÇme
, 
·¹s
);

297 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
™”©Ü
 
™
=
·¹s
.
begš
(); 
	g™
 !ğ·¹s.
’d
(); ++it) {

298 
	g¡d
::
¡ršg
 
šputfe
 = *
™
;

299 ià(
	gšputfe
.
fšd
(
´efix
è=ğ0 && 
šputfe
.fšd("tmp"è=ğšputfe.
Åos
) {

300 
¡d
::
cout
 << "GošgØ´oûss: " << 
šputfe
 << std::
’dl
;

304 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
™”©Ü
 
™
=
·¹s
.
begš
(); 
	g™
 !ğ·¹s.
’d
(); ++it) {

305 
	g¡d
::
¡ršg
 
šputfe
 = *
™
;

306 ià(
	gšputfe
.
fšd
(
´efix
è=ğ0 && 
šputfe
.fšd(".tmp"è=ğšputfe.
Åos
) {

307 
šputfe
 = 
dœÇme
 + "/" + inputfile;

308 
	g¡d
::
cout
 << "Proûss: " << 
šputfe
 << 
¡d
::
’dl
;

309 
FILE
 * 
	gšf
 = 
fİ’
(
šputfe
.
c_¡r
(), "r");

310 ià(
	gšf
 =ğ
NULL
) {

311 
log¡»am
(
LOG_FATAL
è<< "Could‚Ù†ßd :" << 
šputfe
 << "ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

313 
as£¹
(
šf
 !ğ
NULL
);

314 
log¡»am
(
LOG_INFO
è<< "R—dšg iÀÿssov¬y fÜm©!" << 
	g¡d
::
’dl
;

316 
	gmaxËn
 = 100000000;

317 * 
	gs
 = (*è
m®loc
(
maxËn
);

319 
size_t
 
	gby‹¤—d
 = 0;

321 
	gd–ims
[] = " \t";

322 
size_t
 
	glš’um
 = 0;

323 
size_t
 
	gÏ¡log
 = 0;

324 
fg‘s
(
s
, 
maxËn
, 
šf
è!ğ
NULL
) {

325 
lš’um
++;

326 ià(
	gby‹¤—d
 - 
	gÏ¡log
 >= 500000000) {

327 
log¡»am
(
LOG_DEBUG
è<< "R—d " << 
lš’um
 << "†šes, " << 
by‹¤—d
 / 1024 / 1024. << " MB" << 
¡d
::
’dl
;

328 
	gÏ¡log
 = 
by‹¤—d
;

330 
FIXLINE
(
s
);

331 
	gby‹¤—d
 +ğ
¡¾’
(
s
);

333 ià(
	gs
[0] == '#') ;

334 ià(
	gs
[0] == '%') ;

335 * 
	gt
 = 
¡¹ok
(
s
, 
d–ims
);

336 
vid_t
 
	gäom
 = 
©oi
(
t
);

337 
	gt
 = 
¡¹ok
(
NULL
,
d–ims
);

338 ià(
	gt
 !ğ
NULL
) {

339 
vid_t
 
num
 = 
©oi
(
t
);

342 
	glš’um
 +ğ
num
 + 1;

343 
vid_t
 
	gi
=0; i < 
	gnum
; i++) {

344 
	gs
 = 
fg‘s
(
s
, 
maxËn
, 
šf
);

345 
FIXLINE
(
s
);

346 
vid_t
 
	gto
 = 
©oi
(
s
);

347 ià(
	gäom
 !ğ
to
) {

348 
sh¬d”obj
.
´•roûssšg_add_edge
(
äom
, 
to
, 
EdgeD©aTy³
());

354 
ä“
(
s
);

355 
fşo£
(
šf
);

364 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

365 
cÚv”t_bšedg–i¡
(
¡d
::
¡ršg
 
ba£f’ame
, 
sh¬d”
<
EdgeD©aTy³
> &
sh¬d”obj
) {

366 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
·¹s
;

367 
	g¡d
::
¡ršg
 
dœÇme
 = 
g‘_dœÇme
(
ba£f’ame
);

368 
	g¡d
::
¡ršg
 
´efix
 = 
g‘_f’ame
(
ba£f’ame
);

370 
	g¡d
::
cout
 << "dœ=[" << 
dœÇme
 << "]…»fix=[" << 
´efix
 << "]" << 
¡d
::
’dl
;

371 
g‘dœ
(
dœÇme
, 
·¹s
);

373 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
™”©Ü
 
™
=
·¹s
.
begš
(); 
	g™
 !ğ·¹s.
’d
(); ++it) {

374 
	g¡d
::
¡ršg
 
šputfe
 = *
™
;

375 ià(
	gšputfe
.
fšd
(
´efix
è=ğ0 && 
šputfe
.fšd("tmp"è=ğšputfe.
Åos
) {

376 
¡d
::
cout
 << "GošgØ´oûss: " << 
šputfe
 << std::
’dl
;

380 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
™”©Ü
 
™
=
·¹s
.
begš
(); 
	g™
 !ğ·¹s.
’d
(); ++it) {

381 
	g¡d
::
¡ršg
 
šputfe
 = *
™
;

382 ià(
	gšputfe
.
fšd
(
´efix
è=ğ0 && 
šputfe
.fšd(".tmp"è=ğšputfe.
Åos
) {

383 
šputfe
 = 
dœÇme
 + "/" + inputfile;

384 
	g¡d
::
cout
 << "Proûss: " << 
šputfe
 << 
¡d
::
’dl
;

385 
FILE
 * 
	gšf
 = 
fİ’
(
šputfe
.
c_¡r
(), "r");

387 !
ãof
(
šf
)) {

388 
vid_t
 
	gäom
;

389 
vid_t
 
	gto
;

391 
size_t
 
	g»s1
 = 
ä—d
(&
äom
, (
vid_t
), 1, 
šf
);

392 
size_t
 
	g»s2
 = 
ä—d
(&
to
, (
vid_t
), 1, 
šf
);

394 
as£¹
(
»s1
 > 0 && 
»s2
 > 0);

395 ià(
	gäom
 !ğ
to
) {

396 
sh¬d”obj
.
´•roûssšg_add_edge
(
äom
, 
to
, 
EdgeD©aTy³
());

399 
fşo£
(
šf
);

405 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

406 
cÚv”t_bšedg–i¡v®
(
¡d
::
¡ršg
 
ba£f’ame
, 
sh¬d”
<
EdgeD©aTy³
> &
sh¬d”obj
) {

407 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
·¹s
;

408 
	g¡d
::
¡ršg
 
dœÇme
 = 
g‘_dœÇme
(
ba£f’ame
);

409 
	g¡d
::
¡ršg
 
´efix
 = 
g‘_f’ame
(
ba£f’ame
);

411 
	g¡d
::
cout
 << "dœ=[" << 
dœÇme
 << "]…»fix=[" << 
´efix
 << "]" << 
¡d
::
’dl
;

412 
g‘dœ
(
dœÇme
, 
·¹s
);

414 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
™”©Ü
 
™
=
·¹s
.
begš
(); 
	g™
 !ğ·¹s.
’d
(); ++it) {

415 
	g¡d
::
¡ršg
 
šputfe
 = *
™
;

416 ià(
	gšputfe
.
fšd
(
´efix
è=ğ0 && 
šputfe
.fšd("tmp"è=ğšputfe.
Åos
) {

417 
¡d
::
cout
 << "GošgØ´oûss: " << 
šputfe
 << std::
’dl
;

421 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
™”©Ü
 
™
=
·¹s
.
begš
(); 
	g™
 !ğ·¹s.
’d
(); ++it) {

422 
	g¡d
::
¡ršg
 
šputfe
 = *
™
;

423 ià(
	gšputfe
.
fšd
(
´efix
è=ğ0 && 
šputfe
.fšd(".tmp"è=ğšputfe.
Åos
) {

424 
šputfe
 = 
dœÇme
 + "/" + inputfile;

425 
	g¡d
::
cout
 << "Proûss: " << 
šputfe
 << 
¡d
::
’dl
;

426 
FILE
 * 
	gšf
 = 
fİ’
(
šputfe
.
c_¡r
(), "r");

428 !
ãof
(
šf
)) {

429 
vid_t
 
	gäom
;

430 
vid_t
 
	gto
;

431 
EdgeD©aTy³
 
	gedgev®
;

433 
size_t
 
	g»s1
 = 
ä—d
(&
äom
, (
vid_t
), 1, 
šf
);

434 
size_t
 
	g»s2
 = 
ä—d
(&
to
, (
vid_t
), 1, 
šf
);

435 
size_t
 
	g»s3
 = 
ä—d
(&
edgev®
, (
EdgeD©aTy³
), 1, 
šf
);

436 
as£¹
(
»s1
 > 0 && 
»s2
 > 0 && 
»s3
 > 0);

437 ià(
	gäom
 !ğ
to
) {

438 
sh¬d”obj
.
´•roûssšg_add_edge
(
äom
, 
to
, 
edgev®
);

441 
fşo£
(
šf
);

454 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

455 şas 
	cSh¬d”P»´oûssÜ
 {

456 
	gpublic
:

457 
vœtu®
 ~
Sh¬d”P»´oûssÜ
() {}

458 
vœtu®
 
¡d
::
¡ršg
 
g‘Suffix
() = 0;

459 
vœtu®
 
»´oûss
(
¡d
::
¡ršg
 
´•rocF’ame
, std::¡ršg 
ba£feName
) = 0;

466 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

467 
cÚv”t
(
¡d
::
¡ršg
 
ba£f’ame
, std::¡ršg 
nsh¬ds_¡ršg
, 
Sh¬d”P»´oûssÜ
<
EdgeD©aTy³
> * 
´•roûssÜ
 = 
NULL
) {

468 
¡d
::
¡ršg
 
suffix
 = "";

469 ià(
	g´•roûssÜ
 !ğ
NULL
) {

470 
suffix
 = 
´•roûssÜ
->
g‘Suffix
();

472 
	gsh¬d”
<
	gEdgeD©aTy³
> 
sh¬d”obj
(
ba£f’ame
 + 
suffix
);

474 ià(!
	gsh¬d”obj
.
´•roûs£d_fe_exi¡s
()) {

475 
	g¡d
::
¡ršg
 
fe_ty³_¡r
 = 
g‘_İtiÚ_¡ršg_š‹¿ùive
("filetype", "edgelist,‡djlist");

476 ià(
	gfe_ty³_¡r
 !ğ"adjli¡" && 
fe_ty³_¡r
 != "edgelist" && file_type_str != "binedgelist") {

477 
log¡»am
(
LOG_ERROR
è<< "You‚“dØ¥ecify f‘y³: 'edg–i¡' o¸'adjli¡'." << 
¡d
::
’dl
;

478 
as£¹
(
çl£
);

482 
	gsh¬d”obj
.
¡¬t_´•roûssšg
();

484 ià(
	gfe_ty³_¡r
 == "adjlist") {

485 
cÚv”t_adjli¡
<
EdgeD©aTy³
>(
ba£f’ame
, 
sh¬d”obj
);

486 } ià(
	gfe_ty³_¡r
 == "edgelist") {

487 
cÚv”t_edg–i¡
<
EdgeD©aTy³
>(
ba£f’ame
, 
sh¬d”obj
);

488 } ià(
	gfe_ty³_¡r
 == "binedgelist") {

489 
cÚv”t_bšedg–i¡v®
<
EdgeD©aTy³
>(
ba£f’ame
, 
sh¬d”obj
);

493 
	gsh¬d”obj
.
’d_´•roûssšg
();

495 ià(
	g´•roûssÜ
 !ğ
NULL
) {

496 
´•roûssÜ
->
»´oûss
(
sh¬d”obj
.
´•roûs£d_Çme
(), 
ba£f’ame
);

501 
vid_t
 
	gmax_v”‹x_id
 = 
g‘_İtiÚ_št
("maxvertex", 0);

502 ià(
	gmax_v”‹x_id
 > 0) {

503 
	gsh¬d”obj
.
£t_max_v”‹x_id
(
max_v”‹x_id
);

506 
	gnsh¬ds
 = 
sh¬d”obj
.
execu‹_sh¬dšg
(
nsh¬ds_¡ršg
);

507 
log¡»am
(
LOG_INFO
è<< "SucûssfuÎy fšished sh¬dšg fÜ " << 
	gba£f’ame
 + 
	gsuffix
 << 
	g¡d
::
’dl
;

508 
log¡»am
(
LOG_INFO
è<< "C»©ed " << 
	gnsh¬ds
 << " sh¬ds." << 
	g¡d
::
’dl
;

509  
	gnsh¬ds
;

512 
	sdummy
 {};

518 
cÚv”t_nÚe
(
¡d
::
¡ršg
 
ba£f’ame
, std::¡ršg 
nsh¬ds_¡ršg
);

519 
cÚv”t_nÚe
(
¡d
::
¡ršg
 
ba£f’ame
, std::¡ršg 
nsh¬ds_¡ršg
) {

520 
¡d
::
¡ršg
 
suffix
 = "";

521 
	gsh¬d”
<
	gdummy
> 
sh¬d”obj
(
ba£f’ame
 + 
suffix
);

522 
	gsh¬d”obj
.
£t_no_edgev®ues
();

524 ià(!
	gsh¬d”obj
.
´•roûs£d_fe_exi¡s
()) {

525 
	g¡d
::
¡ršg
 
fe_ty³_¡r
 = 
g‘_İtiÚ_¡ršg_š‹¿ùive
("filetype", "edgelist,‡djlist, cassovary, binedgelist");

526 ià(
	gfe_ty³_¡r
 !ğ"adjli¡" && 
fe_ty³_¡r
 != "edgelist" && file_type_str != "cassovary" && file_type_str != "binedgelist") {

527 
log¡»am
(
LOG_ERROR
è<< "You‚“dØ¥ecify f‘y³: 'edg–i¡' o¸'adjli¡'." << 
¡d
::
’dl
;

528 
as£¹
(
çl£
);

532 
	gsh¬d”obj
.
¡¬t_´•roûssšg
();

534 ià(
	gfe_ty³_¡r
 == "adjlist") {

535 
cÚv”t_adjli¡
<
dummy
>(
ba£f’ame
, 
sh¬d”obj
);

536 } ià(
	gfe_ty³_¡r
 == "edgelist") {

537 
cÚv”t_edg–i¡
<
dummy
>(
ba£f’ame
, 
sh¬d”obj
);

538 } ià(
	gfe_ty³_¡r
 == "cassovary") {

539 
cÚv”t_ÿssov¬y
<
dummy
>(
ba£f’ame
, 
sh¬d”obj
);

540 } ià(
	gfe_ty³_¡r
 == "binedgelist") {

541 
cÚv”t_bšedg–i¡
<
dummy
>(
ba£f’ame
, 
sh¬d”obj
);

545 
	gsh¬d”obj
.
’d_´•roûssšg
();

548 ià(
g‘_İtiÚ_št
("skipsharding", 0) == 1) {

549 
¡d
::
cout
 << "Sk sh¬dšg..." << std::
’dl
;

550 
ex™
(0);

553 
vid_t
 
	gmax_v”‹x_id
 = 
g‘_İtiÚ_št
("maxvertex", 0);

554 ià(
	gmax_v”‹x_id
 > 0) {

555 
	gsh¬d”obj
.
£t_max_v”‹x_id
(
max_v”‹x_id
);

558 
	gnsh¬ds
 = 
sh¬d”obj
.
execu‹_sh¬dšg
(
nsh¬ds_¡ršg
);

559 
log¡»am
(
LOG_INFO
è<< "SucûssfuÎy fšished sh¬dšg fÜ " << 
	gba£f’ame
 + 
	gsuffix
 << 
	g¡d
::
’dl
;

560 
log¡»am
(
LOG_INFO
è<< "C»©ed " << 
	gnsh¬ds
 << " sh¬ds." << 
	g¡d
::
’dl
;

561  
	gnsh¬ds
;

566 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

567 
cÚv”t_if_nÙexi¡s
(
¡d
::
¡ršg
 
ba£f’ame
, std::¡ršg 
nsh¬ds_¡ršg
, 
boŞ
 &
didexi¡
,

568 
Sh¬d”P»´oûssÜ
<
EdgeD©aTy³
> * 
´•roûssÜ
 = 
NULL
) {

569 
nsh¬ds
;

570 
	g¡d
::
¡ršg
 
suffix
 = "";

571 ià(
	g´•roûssÜ
 !ğ
NULL
) {

572 
suffix
 = 
´•roûssÜ
->
g‘Suffix
();

578 ià((
	gnsh¬ds
 = 
fšd_sh¬ds
<
EdgeD©aTy³
>(
ba£f’ame
 + 
suffix
, 
	gnsh¬ds_¡ršg
))) {

579 
log¡»am
(
LOG_INFO
è<< "Found…»´oûs£d fe fÜ " << 
	gba£f’ame
 << ",‚um sh¬ds=" << 
	gnsh¬ds
 << 
	g¡d
::
’dl
;

580 
	gdidexi¡
 = 
Œue
;

581 ià(
	gcheck_Üigfe_modifiÿtiÚ_—¾›r
<
	gEdgeD©aTy³
>(
	gba£f’ame
 + 
	gsuffix
, 
	gnsh¬ds
)) {

582  
	gnsh¬ds
;

586 
	gdidexi¡
 = 
çl£
;

588 
log¡»am
(
LOG_INFO
è<< "Did‚Ù fšd…»´oûs£d sh¬d fÜ " << 
	gba£f’ame
 + 
	gsuffix
 << 
	g¡d
::
’dl
;

590 
log¡»am
(
LOG_INFO
è<< "(Edge-v®usize: " << (
	gEdgeD©aTy³
è<< ")" << 
	g¡d
::
’dl
;

591 
log¡»am
(
LOG_INFO
è<< "WÈŒy c»©them‚ow..." << 
	g¡d
::
’dl
;

592 
	gnsh¬ds
 = 
cÚv”t
<
EdgeD©aTy³
>(
ba£f’ame
, 
	gnsh¬ds_¡ršg
, 
	g´•roûssÜ
);

593  
	gnsh¬ds
;

596 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

597 
cÚv”t_if_nÙexi¡s
(
¡d
::
¡ršg
 
ba£f’ame
, std::¡ršg 
nsh¬ds_¡ršg
, 
Sh¬d”P»´oûssÜ
<
EdgeD©aTy³
> * 
´•roûssÜ
 = 
NULL
) {

598 
boŞ
 
b
;

599  
	gcÚv”t_if_nÙexi¡s
<
	gEdgeD©aTy³
>(
	gba£f’ame
, 
	gnsh¬ds_¡ršg
, 
	gb
, 
	g´•roûssÜ
);

604 
	sv”‹x_deg»e
 {

605 
	gdeg
;

606 
vid_t
 
	gid
;

607 
v”‹x_deg»e
() {}

608 
v”‹x_deg»e
(
deg
, 
vid_t
 
id
) : deg(deg), id(id) {}

611 
boŞ
 
v”‹x_deg»e_Ëss
(cÚ¡ 
v”‹x_deg»e
 &
a
, cÚ¡ v”‹x_deg»&
b
);

612 
boŞ
 
	$v”‹x_deg»e_Ëss
(cÚ¡ 
v”‹x_deg»e
 &
a
, cÚ¡ v”‹x_deg»&
b
) {

613  
a
.
deg
 < 
b
.deg || (a.deg =ğb.deg &&‡.
id
 < b.id);

614 
	}
}

620 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

621 
şass
 
	gOrd”ByDeg»e
 : 
public
 
Sh¬d”P»´oûssÜ
<
EdgeD©aTy³
> {

622 
pha£
;

624 
	gpublic
:

625 
edge_w™h_v®ue
<
	tEdgeD©aTy³
> 
	tedge_t
;

626 
vid_t
 * 
	gŒª¦©e_bË
;

627 
vid_t
 
	gmax_v”‹x_id
;

628 
v”‹x_deg»e
 * 
	gdeg¬¿y
;

629 
	gbš¬y_adjaûncy_li¡_wr™”
<
	gEdgeD©aTy³
> * 
	gwr™”
;

630 
Ord”ByDeg»e
() {

631 
	gdeg¬¿y
 = 
NULL
;

632 
	gwr™”
 = 
NULL
;

635 ~
Ord”ByDeg»e
() {

636 ià(
	gdeg¬¿y
 !ğ
NULL
è
ä“
(
deg¬¿y
);

637 
	gdeg¬¿y
 = 
NULL
;

638 ià(
	gwr™”
 !ğ
NULL
è
d–‘e
 
wr™”
;

639 
	gwr™”
 = 
NULL
;

642 
	g¡d
::
¡ršg
 
g‘Suffix
() {

646 
vid_t
 
Œª¦©e
(vid_ˆ
vid
) {

647 ià(
	gvid
 > 
	gmax_v”‹x_id
)  vid;

648  
	gŒª¦©e_bË
[
vid
];

657 
»ûive_edge
(
vid_t
 
äom
, vid_ˆ
to
, 
EdgeD©aTy³
 
v®ue
, 
boŞ
 
is_v®ue
) {

658 ià(
	gpha£
 == 0) {

659 
deg¬¿y
[
äom
].
deg
++;

660 
	gdeg¬¿y
[
to
].
	gdeg
++;

662 
	gwr™”
->
add_edge
(
Œª¦©e
(
äom
),¿n¦©e(
to
));

665 
»´oûss
(
¡d
::
¡ršg
 
´•roûs£dFe
, std::¡ršg 
ba£F’ame
) {

667 
bš¬y_adjaûncy_li¡_»ad”
<
EdgeD©aTy³
> 
»ad”
(
´•roûs£dFe
);

668 
	gmax_v”‹x_id
 = (
vid_t
è
»ad”
.
g‘_max_v”‹x_id
();

670 
	gdeg¬¿y
 = (
v”‹x_deg»e
 *è
ÿÎoc
(
max_v”‹x_id
 + 1, (vertex_degree));

671 
vid_t
 
	gnv”ts
 = 
max_v”‹x_id
 + 1;

672 
vid_t
 
	gi
=0; i < 
	gnv”ts
; i++) {

673 
	gdeg¬¿y
[
i
].
	gid
 = i;

676 
	gpha£
 = 0;

678 
	g»ad”
.
»ad_edges
(
this
);

681 
quickSÜt
(
deg¬¿y
, 
nv”ts
, 
v”‹x_deg»e_Ëss
);

684 
	gŒª¦©e_bË
 = (
vid_t
*è
ÿÎoc
((vid_t), 
nv”ts
);

685 
vid_t
 
	gi
=0; i<
	gnv”ts
; i++) {

686 
	gŒª¦©e_bË
[
deg¬¿y
[
i
].
	gid
] = i;

688 
d–‘e
 
	gdeg¬¿y
;

691 
	g¡d
::
¡ršg
 
Œª¦©e_bË_fe
 = 
ba£F’ame
 + ".vertexmap";

692 
	gdf
 = 
İ’
(
Œª¦©e_bË_fe
.
c_¡r
(), 
O_RDWR
 | 
O_CREAT
, 
S_IROTH
 | 
S_IWOTH
 | 
S_IWUSR
 | 
S_IRUSR
);

693 ià(
	gdf
 < 0è
log¡»am
(
LOG_ERROR
è<< "Could‚Ù wr™v”‹x m­: " << 
	gŒª¦©e_bË_fe
 <<

694 "ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
	g¡d
::
’dl
;

695 
as£¹
(
df
 >= 0);

696 
pwr™—
(
df
, 
Œª¦©e_bË
, 
nv”ts
 * (
vid_t
), 0);

697 
şo£
(
df
);

700 
	g¡d
::
¡ršg
 
tmpf’ame
 = 
´•roûs£dFe
 + ".old";

701 
»Çme
(
´•roûs£dFe
.
c_¡r
(), 
tmpf’ame
.c_str());

703 
	gwr™”
 = 
Ãw
 
bš¬y_adjaûncy_li¡_wr™”
<
EdgeD©aTy³
>(
´•roûs£dFe
);

704 
	gbš¬y_adjaûncy_li¡_»ad”
<
	gEdgeD©aTy³
> 
»ad”2
(
tmpf’ame
);

706 
	gpha£
 = 1;

707 
	g»ad”2
.
»ad_edges
(
this
);

709 
	gwr™”
->
fšish
();

710 
d–‘e
 
	gwr™”
;

711 
	gwr™”
 = 
NULL
;

713 
d–‘e
 
	gŒª¦©e_bË
;

	@src/preprocessing/formats/binary_adjacency_list.hpp

33 #iâdeà
DEF_GRAPHCHI_BINADJLIST_FORMAT


34 
	#DEF_GRAPHCHI_BINADJLIST_FORMAT


	)

36 
	~<as£¹.h
>

37 
	~<¡dio.h
>

38 
	~<¡dšt.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<¡ršg
>

43 
	~"g¿phchi_ty³s.hµ
"

44 
	~"logg”/logg”.hµ
"

45 
	~"ut/iout.hµ
"

47 
Çme¥aû
 
	gg¿phchi
 {

49 
	#FORMAT_VERSION
 20120705

50 

	)

54 
	sbš_adj_h—d”
 {

55 
	gfÜm©_v”siÚ
;

56 
ušt64_t
 
	gmax_v”‹x_id
;

57 
boŞ
 
	gcÚšs_edge_v®ues
;

58 
ušt32_t
 
	gedge_v®ue_size
;

59 
ušt64_t
 
	gnumedges
;

65 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

66 
	sedge_w™h_v®ue_badj
 {

67 
vid_t
 
	gv”‹x
;

68 
EdgeD©aTy³
 
	gv®ue
;

69 
edge_w™h_v®ue_badj
() {}

70 
edge_w™h_v®ue_badj
(
vid_t
 
v
, 
EdgeD©aTy³
 
x
è: 
v”‹x
(v), 
v®ue
(x) {}

73 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

74 şas 
	cbš¬y_adjaûncy_li¡_»ad”
 {

75 
	g¡d
::
¡ršg
 
f’ame
;

76 
	gfd
;

77 
size_t
 
	gåos
;

78 
size_t
 
	gblockËn
;

79 
size_t
 
	gblocksize
;

80 
size_t
 
	gtÙ®_to_´oûss
;

81 * 
	gblock
;

82 * 
	gblock±r
;

84 
bš_adj_h—d”
 
	gh—d”
;

86 
	g‹m¶©e
 <
ty³Çme
 
	gU
>

87 
šlše
 
U
 
»ad_v®
() {

88 ià(
	gblock±r
 + (
	gU
è> 
	gblock
 + 
	gblockËn
) {

90 
	gblockËn
 = 
¡d
::
mš
(
blocksize
, 
tÙ®_to_´oûss
 - 
åos
);

91 
´—da
(
fd
, 
block
, 
blockËn
, 
åos
);

92 
	gblock±r
 = 
block
;

94 
U
 
	g»s
 = *((U*)
block±r
);

95 
	gblock±r
 +ğ(
U
);

96 
	gåos
 +ğ(
U
);

97  
	g»s
;

100 
	gpublic
:

101 
bš¬y_adjaûncy_li¡_»ad”
(
¡d
::
¡ršg
 
f’ame
) : filename(filename) {

102 
fd
 = 
İ’
(
f’ame
.
c_¡r
(), 
O_RDONLY
);

103 ià(
	gfd
 < 0) {

104 
log¡»am
(
LOG_FATAL
è<< "Could‚Ù o³Àfe: " << 
	gf’ame
 << "ƒrror: " <<

105 
¡»¼Ü
(
”ºo
è<< 
	g¡d
::
’dl
;

107 
as£¹
(
fd
 >= 0);

109 
	gblocksize
 = (
size_t
è
g‘_İtiÚ_lÚg
("preprocessing.bufsize", 64 * 1024 * 1024);

110 
	gblock
 = (*è
m®loc
(
blocksize
);

111 
	gblock±r
 = 
block
;

112 
	gtÙ®_to_´oûss
 = 
g‘_fesize
(
f’ame
);

113 
	gblockËn
 = 0;

114 
	gåos
 = 0;

116 
	gh—d”
 = 
»ad_v®
<
bš_adj_h—d”
>();

117 
as£¹
(
h—d”
.
fÜm©_v”siÚ
 =ğ
FORMAT_VERSION
);

120 ~
bš¬y_adjaûncy_li¡_»ad”
() {

121 ià(
	gblock
 !ğ
NULL
è
ä“
(
block
);

122 
şo£
(
fd
);

125 
	g‹m¶©e
 <
şass
 
	gC®lback
>

126 
»ad_edges
(
C®lback
 * 
ÿÎback
) {

127 
size_t
 
	gÃdges
 = 0;

132 ià(
	gÃdges
 % 10000000 == 0) {

133 
log¡»am
(
LOG_DEBUG
è<< (
åos
 * 1.0 / 
tÙ®_to_´oûss
 * 100è<< "%" << 
¡d
::
’dl
;

135 
vid_t
 
	gäom
;

136 
vid_t
 
	gto
;

137 
	gadjËn
;

138 
EdgeD©aTy³
 
	gv®
 = EdgeDataType();

140 
	gäom
 = 
»ad_v®
<
vid_t
>();

141 
	gadjËn
 = (è
»ad_v®
<
ušt8_t
>();

142 
as£¹
(
adjËn
 > 0);

143 
	gi
=0; i < 
	gadjËn
; i++) {

144 
	gto
 = 
»ad_v®
<
vid_t
>();

145 ià(
	gh—d”
.
	gcÚšs_edge_v®ues
) {

146 
	gv®
 = 
»ad_v®
<
EdgeD©aTy³
>();

149 
	gÿÎback
->
»ûive_edge
(
äom
, 
to
, 
v®
, 
h—d”
.
cÚšs_edge_v®ues
);

151 
	gÃdges
++;

154 } 
	gÃdges
 < 
	gh—d”
.
	gnumedges
);

157 
boŞ
 
has_edge_v®ues
() {

158  
	gh—d”
.
	gcÚšs_edge_v®ues
;

161 
size_t
 
g‘_max_v”‹x_id
() {

162  
	gh—d”
.
	gmax_v”‹x_id
;

165 
size_t
 
g‘_numedges
() {

166  
	gh—d”
.
	gnumedges
;

171 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

172 şas 
	cbš¬y_adjaûncy_li¡_wr™”
 {

174 
	g´iv©e
:

176 
¡d
::
¡ršg
 
f’ame
;

177 
	gfd
;

178 
bš_adj_h—d”
 
	gh—d”
;

179 
	gbufsize
;

181 * 
	gbuf
;

182 * 
	gbuåŒ
;

184 
boŞ
 
	gš™Ÿlized
;

186 
	gedge_w™h_v®ue_badj
<
	gEdgeD©aTy³
> 
	g§mev_buf
[256];

187 
vid_t
 
	gÏ¡id
;

188 
ušt8_t
 
	gcouÁ”
;

190 
	gpublic
:

191 
bš¬y_adjaûncy_li¡_wr™”
(
¡d
::
¡ršg
 
f’ame
) : filename(filename) {

192 
bufsize
 = (è
g‘_İtiÚ_št
("preprocessing.bufsize", 64 * 1024 * 1024);

193 
as£¹
(
bufsize
 > 1024 * 1024);

194 
	gfd
 = 
İ’
(
f’ame
.
c_¡r
(), 
O_WRONLY
 | 
O_CREAT
, 
S_IROTH
 | 
S_IWOTH
 | 
S_IWUSR
 | 
S_IRUSR
);

195 ià(
	gfd
 < 0) {

196 
log¡»am
(
LOG_FATAL
è<< "Could‚Ù o³Àf" << 
	gf’ame
 << " for writing. " <<

197 " E¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
	g¡d
::
’dl
;

199 
	g»s
 = 
árunÿ‹
(
fd
, 0);

200 ià(
	g»s
 != 0) {

201 
log¡»am
(
LOG_FATAL
è<< "Could‚Ùrunÿ‹ f" << 
f’ame
 <<

202 " E¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

204 
as£¹
(
»s
 == 0);

206 
	gh—d”
.
	gfÜm©_v”siÚ
 = 
FORMAT_VERSION
;

207 
	gh—d”
.
	gmax_v”‹x_id
 = 0;

208 
	gh—d”
.
	gcÚšs_edge_v®ues
 = 
çl£
;

209 
	gh—d”
.
	gnumedges
 = 0;

210 
	gh—d”
.
	gedge_v®ue_size
 = (
ušt32_t
è(
EdgeD©aTy³
);

212 
	gbuf
 = (*è
m®loc
(
bufsize
);

213 
	gbuåŒ
 = 
buf
;

214 
	gbwr™e
<
	gbš_adj_h—d”
>(
	gfd
, 
	gbuf
, 
	gbuåŒ
, 
	gh—d”
);

215 
	gcouÁ”
 = 0;

216 
	gÏ¡id
 = 0;

217 
	gš™Ÿlized
 = 
çl£
;

218 
as£¹
(
fd
 >= 0);

221 ~
bš¬y_adjaûncy_li¡_wr™”
() {

222 ià(
	gbuf
 !ğ
NULL
è
d–‘e
 
buf
;

225 
	g´Ùeùed
:

227 
wr™e_h—d”
() {

228 
log¡»am
(
LOG_DEBUG
è<< "Wr™h—d”: max v”‹x: " << 
h—d”
.
max_v”‹x_id
 << 
¡d
::
’dl
;

229 
pwr™—
(
fd
, &
h—d”
, (
bš_adj_h—d”
), 0);

235 
æush
() {

236 ià(
	gcouÁ”
 != 0) {

237 
bwr™e
<
vid_t
>(
fd
, 
buf
, 
buåŒ
, 
Ï¡id
);

238 
	gbwr™e
<
	gušt8_t
>(
	gfd
, 
	gbuf
, 
	gbuåŒ
, 
	gcouÁ”
);

239 
	gi
=0; i < 
	gcouÁ”
; i++) {

240 
	gbwr™e
<
	gvid_t
>(
	gfd
, 
	gbuf
, 
	gbuåŒ
, 
	g§mev_buf
[
i
].
	gv”‹x
);

241 ià(
	gh—d”
.
	gcÚšs_edge_v®ues
) {

242 
	gbwr™e
<
	gEdgeD©aTy³
>(
	gfd
, 
	gbuf
, 
	gbuåŒ
, 
	g§mev_buf
[
i
].
	gv®ue
);

245 
	gh—d”
.
	gnumedges
 +ğ(
ušt64_t
)
couÁ”
;

246 
	gcouÁ”
 = 0;

250 
_addedge
(
vid_t
 
äom
, vid_ˆ
to
, 
EdgeD©aTy³
 
v®
) {

251 ià(
	gäom
 =ğ
to
) ;

253 ià(
	gäom
 =ğ
Ï¡id
 && 
couÁ”
 > 0) {

254 
§mev_buf
[
couÁ”
++] = 
edge_w™h_v®ue_badj
<
EdgeD©aTy³
>(
to
, 
	gv®
);

256 
æush
();

257 
	gÏ¡id
 = 
äom
;

258 
	g§mev_buf
[
couÁ”
++] = 
edge_w™h_v®ue_badj
<
EdgeD©aTy³
>(
to
, 
	gv®
);

260 ià(
	gcouÁ”
 == 255) {

262 
æush
();

263 
	gcouÁ”
 = 0;

265 ià(
	gäom
 > 
	gh—d”
.
	gmax_v”‹x_id
 || 
	gto
 > header.max_vertex_id) {

266 
	gh—d”
.
	gmax_v”‹x_id
 = 
¡d
::
max
(
äom
, 
to
);

271 
	gpublic
:

272 
add_edge
(
vid_t
 
äom
, vid_ˆ
to
, 
EdgeD©aTy³
 
v®
) {

273 ià(!
	gš™Ÿlized
) {

274 
	gh—d”
.
	gcÚšs_edge_v®ues
 = 
Œue
;

275 
	gš™Ÿlized
 = 
Œue
;

277 ià(!
	gh—d”
.
	gcÚšs_edge_v®ues
) {

278 
log¡»am
(
LOG_ERROR
è<< "Tr›dØaddƒdgw™h‡ v®ue,‡Éhough…»viou¦y‡dded oÃ w™h‡ v®ue!" << 
	g¡d
::
’dl
;

280 
as£¹
(
h—d”
.
cÚšs_edge_v®ues
);

282 
_addedge
(
äom
, 
to
, 
v®
);

285 
add_edge
(
vid_t
 
äom
, vid_ˆ
to
) {

286 ià(!
	gš™Ÿlized
) {

287 
	gh—d”
.
	gcÚšs_edge_v®ues
 = 
çl£
;

288 
	gš™Ÿlized
 = 
Œue
;

290 ià(
	gh—d”
.
	gcÚšs_edge_v®ues
) {

291 
log¡»am
(
LOG_ERROR
è<< "Tr›dØaddƒdgw™houˆ¨v®ue,‡Éhough…»viou¦y‡ddedƒdgw™h‡ v®ue!" << 
	g¡d
::
’dl
;

294 
as£¹
(!
h—d”
.
cÚšs_edge_v®ues
);

295 
_addedge
(
äom
, 
to
, 
EdgeD©aTy³
());

298 
boŞ
 
has_edge_v®ues
() {

299  
	gh—d”
.
	gcÚšs_edge_v®ues
;

302 
fšish
() {

303 
æush
();

306 
wr™—
(
fd
, 
buf
, 
buåŒ
 - buf);

307 
ä“
(
buf
);

308 
	gbuf
 = 
NULL
;

310 
wr™e_h—d”
();

311 
şo£
(
fd
);

314 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

315 
bwr™e
(
f
, * 
buf
, * &
buåŒ
, 
T
 
v®
) {

316 ià(
	gbuåŒ
 + (
	gT
è- 
	gbuf
 >ğ
bufsize
) {

317 
wr™—
(
f
, 
buf
, 
buåŒ
 - buf);

318 
	gbuåŒ
 = 
buf
;

320 *((
	gT
*)
	gbuåŒ
èğ
v®
;

321 
	gbuåŒ
 +ğ(
T
);

	@src/preprocessing/sharder.hpp

35 #iâdeà
GRAPHCHI_SHARDER_DEF


36 
	#GRAPHCHI_SHARDER_DEF


	)

39 
	~<io¡»am
>

40 
	~<c¡dio
>

41 
	~<fú.h
>

42 
	~<uni¡d.h
>

43 
	~<sys/¡©.h
>

45 
	~<veùÜ
>

46 
	~<omp.h
>

47 
	~<”ºo.h
>

48 
	~<s¡»am
>

49 
	~<¡ršg
>

51 
	~"­i/chif’ames.hµ
"

52 
	~"­i/g¿phchi_cÚ‹xt.hµ
"

53 
	~"g¿phchi_ty³s.hµ
"

54 
	~"io/¡redio.hµ
"

55 
	~"logg”/logg”.hµ
"

56 
	~"’gše/auxd©a/deg»e_d©a.hµ
"

57 
	~"m‘rics/m‘rics.hµ
"

58 
	~"m‘rics/»ps/basic_»pÜ‹r.hµ
"

59 
	~"´•roûssšg/fÜm©s/bš¬y_adjaûncy_li¡.hµ
"

60 
	~"sh¬ds/memÜysh¬d.hµ
"

61 
	~"sh¬ds/¦idšgsh¬d.hµ
"

62 
	~"ut/iout.hµ
"

63 
	~"ut/qsÜt.hµ
"

65 
Çme¥aû
 
	gg¿phchi
 {

67 
	#SHARDER_BUFSIZE
 (64 * 1024 * 1024)

	)

69 
	eProcPha£
 { 
	gCOMPUTE_INTERVALS
=1, 
	gSHOVEL
=2 };

72 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

73 
	sedge_w™h_v®ue
 {

74 
vid_t
 
	g¤c
;

75 
vid_t
 
	gd¡
;

76 
EdgeD©aTy³
 
	gv®ue
;

78 #ifdeà
DYNAMICEDATA


81 
boŞ
 
	gis_chivec_v®ue
;

84 
edge_w™h_v®ue
(
vid_t
 
¤c
, vid_ˆ
d¡
, 
EdgeD©aTy³
 
v®ue
) : src(src), dst(dst), value(value) {

85 #ifdeà
DYNAMICEDATA


86 
	gis_chivec_v®ue
 = 
çl£
;

90 
boŞ
 
¡İ³r
(è{  
	g¤c
 =ğ0 && 
d¡
 == 0; }

93 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

94 
boŞ
 
edge_t_¤c_Ëss
(cÚ¡ 
edge_w™h_v®ue
<
EdgeD©aTy³
> &
a
, cÚ¡ƒdge_w™h_v®ue<EdgeD©aTy³> &
b
) {

95 ià(
	ga
.
	g¤c
 =ğ
b
.
¤c
è 
a
.
d¡
 < b.dst;

96  
	ga
.
	g¤c
 < 
	gb
.src;

99 
	g‹m¶©e
 <
ty³Çme
 
	gEdgeD©aTy³
>

100 şas 
	csh¬d”
 {

102 
	gedge_w™h_v®ue
<
	tEdgeD©aTy³
> 
	tedge_t
;

104 
	g´Ùeùed
:

105 
¡d
::
¡ršg
 
ba£f’ame
;

107 
vid_t
 
	gmax_v”‹x_id
;

110 
	gnsh¬ds
;

111 
	g¡d
::
veùÜ
< 
¡d
::
·œ
<
vid_t
, 
	gvid_t
> > 
	gš‹rv®s
;

112 
	g¡d
::
veùÜ
< 
size_t
 > 
shov–sizes
;

113 
	g¡d
::
veùÜ
< > 
shov–blocksidxs
;

114 
	gpha£
;

116 * 
	gedgecouÁs
;

117 
	gv”‹xchunk
;

118 
size_t
 
	gÃdges
;

119 
	g¡d
::
¡ršg
 
´efix
;

121 
	gcom´es£d_block_size
;

123 
edge_t
 ** 
	gbufs
;

124 * 
	gbuåŒs
;

125 
size_t
 
	gbufsize
;

126 
size_t
 
	gedged©asize
;

127 
size_t
 
	gebufãr_size
;

128 
size_t
 
	gedges_³r_block
;

131 
vid_t
 
	gf‹r_max_v”‹x
;

133 
boŞ
 
	gno_edgev®ues
;

135 
m‘rics
 
	gm
;

137 
	gbš¬y_adjaûncy_li¡_wr™”
<
	gEdgeD©aTy³
> * 
	g´•roc_wr™”
;

139 
	gpublic
:

141 
sh¬d”
(
¡d
::
¡ršg
 
ba£f’ame
è: ba£f’ame(ba£f’ame), 
m
("sh¬d”"), 
´•roc_wr™”
(
NULL
è{ 
	gbufs
 = NULL;

142 
	gedged©asize
 = (
EdgeD©aTy³
);

143 
	gno_edgev®ues
 = 
çl£
;

144 
	gcom´es£d_block_size
 = 4096 * 1024;

145 
	gf‹r_max_v”‹x
 = 0;

146 
	gcom´es£d_block_size
 % (
	gEdgeD©aTy³
è!ğ0è
com´es£d_block_size
++;

147 
	gedges_³r_block
 = 
com´es£d_block_size
 / (
EdgeD©aTy³
);

152 
	gvœtu®
 ~
sh¬d”
() {

153 ià(
	g´•roc_wr™”
 !ğ
NULL
) {

154 
d–‘e
 
´•roc_wr™”
;

158 
£t_max_v”‹x_id
(
vid_t
 
maxid
) {

159 
	gf‹r_max_v”‹x
 = 
maxid
;

162 
£t_no_edgev®ues
() {

163 
	gno_edgev®ues
 = 
Œue
;

166 
	g¡d
::
¡ršg
 
´•roûs£d_Çme
() {

167  
´•roûss_f’ame
<
EdgeD©aTy³
>(
ba£f’ame
);

174 
boŞ
 
´•roûs£d_fe_exi¡s
() {

175 
	gf
 = 
İ’
(
´•roûs£d_Çme
().
c_¡r
(), 
O_RDONLY
);

176 ià(
	gf
 >= 0) {

177 
şo£
(
f
);

178  
	gŒue
;

180  
	gçl£
;

187 
¡¬t_´•roûssšg
() {

188 ià(
	g´•roc_wr™”
 !ğ
NULL
) {

189 
log¡»am
(
LOG_FATAL
è<< "¡¬t_´•roûssšg(è®»ady c®Ëd! AbÜtšg." << 
¡d
::
’dl
;

192 
	gm
.
¡¬t_time
("preprocessing");

193 
	g¡d
::
¡ršg
 
tmpf’ame
 = 
´•roûs£d_Çme
() + ".tmp";

194 
	g´•roc_wr™”
 = 
Ãw
 
bš¬y_adjaûncy_li¡_wr™”
<
EdgeD©aTy³
>(
tmpf’ame
);

195 
log¡»am
(
LOG_INFO
è<< "S¹ed…»´oûssšg: " << 
	gba£f’ame
 << " --> " << 
	gtmpf’ame
 << 
	g¡d
::
’dl
;

198 
	gmax_v”‹x_id
 = 0;

204 
’d_´•roûssšg
() {

205 
as£¹
(
´•roc_wr™”
 !ğ
NULL
);

207 
	g´•roc_wr™”
->
fšish
();

208 
d–‘e
 
	g´•roc_wr™”
;

209 
	g´•roc_wr™”
 = 
NULL
;

212 
	g¡d
::
¡ršg
 
tmpf’ame
 = 
´•roûs£d_Çme
() + ".tmp";

213 
»Çme
(
tmpf’ame
.
c_¡r
(), 
´•roûs£d_Çme
().c_str());

215 
as£¹
(
´•roûs£d_fe_exi¡s
());

216 
log¡»am
(
LOG_INFO
è<< "Fšished…»´oûssšg: " << 
	gba£f’ame
 << " --> " << 
´•roûs£d_Çme
(è<< 
	g¡d
::
’dl
;

217 
	gm
.
¡İ_time
("preprocessing");

223 
´•roûssšg_add_edge
(
vid_t
 
äom
, vid_ˆ
to
, 
EdgeD©aTy³
 
v®
) {

224 
	g´•roc_wr™”
->
add_edge
(
äom
, 
to
, 
v®
);

225 
	gmax_v”‹x_id
 = 
¡d
::
max
(¡d::max(
äom
, 
to
), 
max_v”‹x_id
);

231 
´•roûssšg_add_edge
(
vid_t
 
äom
, vid_ˆ
to
) {

232 
	g´•roc_wr™”
->
add_edge
(
äom
, 
to
);

233 
	gmax_v”‹x_id
 = 
¡d
::
max
(¡d::max(
äom
, 
to
), 
max_v”‹x_id
);

237 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

238 
bwr™e
(
f
, * 
buf
, * &
buåŒ
, 
T
 
v®
) {

239 ià(
	gbuåŒ
 + (
	gT
è- 
	gbuf
 >ğ
SHARDER_BUFSIZE
) {

240 
wr™—
(
f
, 
buf
, 
buåŒ
 - buf);

241 
	gbuåŒ
 = 
buf
;

243 *((
	gT
*)
	gbuåŒ
èğ
v®
;

244 
	gbuåŒ
 +ğ(
T
);

247 
	gblockid
;

249 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

250 
ed©a_æush
(* 
buf
, * 
buåŒ
, 
¡d
::
¡ršg
 & 
sh¬d_f’ame
, 
size_t
 
tÙby‹s
) {

251 
	gËn
 = (è(
buåŒ
 - 
buf
);

253 
	gm
.
¡¬t_time
("edata_flush");

255 
	g¡d
::
¡ršg
 
block_f’ame
 = 
f’ame_sh¬d_ed©a_block
(
sh¬d_f’ame
, 
blockid
, 
com´es£d_block_size
);

256 
	gf
 = 
İ’
(
block_f’ame
.
c_¡r
(), 
O_RDWR
 | 
O_CREAT
, 
S_IROTH
 | 
S_IWOTH
 | 
S_IWUSR
 | 
S_IRUSR
);

257 
wr™e_com´es£d
(
f
, 
buf
, 
Ën
);

258 
şo£
(
f
);

260 
	gm
.
¡İ_time
("edata_flush");

263 #ifdeà
DYNAMICEDATA


265 
wr™e_block_uncom´es£d_size
(
block_f’ame
, 
Ën
);

269 
	gblockid
++;

272 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

273 
bwr™e_ed©a
(* &
buf
, * &
buåŒ
, 
T
 
v®
, 
size_t
 & 
tÙby‹s
, 
¡d
::
¡ršg
 & 
sh¬d_f’ame
,

274 
size_t
 & 
edgecouÁ”
) {

275 ià(
	gno_edgev®ues
) ;

277 ià(
	gedgecouÁ”
 =ğ
edges_³r_block
) {

278 
ed©a_æush
<
T
>(
buf
, 
buåŒ
, 
sh¬d_f’ame
, 
tÙby‹s
);

279 
	gbuåŒ
 = 
buf
;

280 
	gedgecouÁ”
 = 0;

284 ià(
	gbuåŒ
 - 
	gbuf
 + (
	gT
è> 
	gebufãr_size
) {

285 
	gebufãr_size
 *= 2;

286 
log¡»am
(
LOG_DEBUG
è<< "Inü—£d bufã¸sizto: " << 
	gebufãr_size
 << 
	g¡d
::
’dl
;

287 
size_t
 
	g±roff
 = 
buåŒ
 - 
buf
;

288 
	gbuf
 = (*è
»®loc
(
buf
, 
ebufãr_size
);

289 
	gbuåŒ
 = 
buf
 + 
±roff
;

292 
	gtÙby‹s
 +ğ(
T
);

293 *((
	gT
*)
	gbuåŒ
èğ
v®
;

294 
	gbuåŒ
 +ğ(
T
);

298 
boŞ
 
Œy_lßd_š‹rv®s
() {

299 
	g¡d
::
veùÜ
<
¡d
::
·œ
<
vid_t
, 
	gvid_t
> > 
	gtmpš‹rv®s
;

300 
lßd_v”‹x_š‹rv®s
(
ba£f’ame
, 
nsh¬ds
, 
tmpš‹rv®s
, 
Œue
);

301 ià(
	gtmpš‹rv®s
.
em±y
()) {

302  
	gçl£
;

304 
	gš‹rv®s
 = 
tmpš‹rv®s
;

305  
	gŒue
;

313 
execu‹_sh¬dšg
(
¡d
::
¡ršg
 
nsh¬ds_¡ršg
) {

314 
m
.
¡¬t_time
("execute_sharding");

315 
d‘”mše_numb”_of_sh¬ds
(
nsh¬ds_¡ršg
);

317 ià(
	gnsh¬ds
 == 1) {

318 
bš¬y_adjaûncy_li¡_»ad”
<
EdgeD©aTy³
> 
»ad”
(
´•roûs£d_Çme
());

319 
	gmax_v”‹x_id
 = (
vid_t
è
»ad”
.
g‘_max_v”‹x_id
();

320 
Úe_sh¬d_š‹rv®s
();

323 
	gpha£
=1;…hase <= 2; ++phase) {

324 ià(
	gnsh¬ds
 =ğ1 && 
pha£
 == 1) ;

327 
	gbš¬y_adjaûncy_li¡_»ad”
<
	gEdgeD©aTy³
> 
»ad”
(
´•roûs£d_Çme
());

330 
	gmax_v”‹x_id
 = (
vid_t
è
»ad”
.
g‘_max_v”‹x_id
();

331 ià(
	gf‹r_max_v”‹x
 > 0) {

332 
	gmax_v”‹x_id
 = 
f‹r_max_v”‹x
;

335 
log¡»am
(
LOG_INFO
è<< "Max v”‹x id: " << 
	gmax_v”‹x_id
 << 
	g¡d
::
’dl
;

337 ià(
	gpha£
 == 1) {

338 ià(
Œy_lßd_š‹rv®s
()) {

339 
log¡»am
(
LOG_INFO
è<< "Found iÁ”v®s-fe, skpšgh© s‹p!" << 
¡d
::
’dl
;

345 
	gthis
->
¡¬t_pha£
(
pha£
);

347 
	g»ad”
.
»ad_edges
(
this
);

349 
	gthis
->
’d_pha£
();

352 
wr™e_sh¬ds
();

354 
	gm
.
¡İ_time
("execute_sharding");

357 
basic_»pÜ‹r
 
	gbasiü•
;

358 
	gm
.
»pÜt
(
basiü•
);

360  
	gnsh¬ds
;

366 
	g´Ùeùed
:

368 
vœtu®
 
d‘”mše_numb”_of_sh¬ds
(
¡d
::
¡ršg
 
nsh¬ds_¡ršg
) {

369 
as£¹
(
´•roûs£d_fe_exi¡s
());

370 ià(
	gnsh¬ds_¡ršg
.
fšd
("auto"è!ğ
¡d
::
¡ršg
::
Åos
 || 
nsh¬ds_¡ršg
 == "0") {

371 
log¡»am
(
LOG_INFO
è<< "D‘”mššg‚umb” oàsh¬d autom©iÿÎy." << 
¡d
::
’dl
;

373 
	gmembudg‘_mb
 = 
g‘_İtiÚ_št
("membudget_mb", 1024);

374 
log¡»am
(
LOG_INFO
è<< "Assumšg‡vaabË memÜy i " << 
	gmembudg‘_mb
 << " megaby‹s. " << 
	g¡d
::
’dl
;

375 
log¡»am
(
LOG_INFO
è<< " (Thi ÿÀbdefšed w™h cÚfigu¿tiÚ…¬am‘” 'membudg‘_mb')" << 
	g¡d
::
’dl
;

377 
	gbš¬y_adjaûncy_li¡_»ad”
<
	gEdgeD©aTy³
> 
»ad”
(
´•roûs£d_Çme
());

378 
size_t
 
	gnumedges
 = 
»ad”
.
g‘_numedges
();

380 
	gmax_sh¬dsize
 = 
membudg‘_mb
 * 1024. * 1024. / 8;

381 
log¡»am
(
LOG_INFO
è<< "D‘”mššg maximum sh¬d size: " << (
	gmax_sh¬dsize
 / 1024. / 1024.è<< " MB." << 
	g¡d
::
’dl
;

383 
	gnsh¬ds
 = (èĞ2 + (
numedges
 * (
EdgeD©aTy³
è/ 
max_sh¬dsize
) + 0.5);

385 #ifdeà
DYNAMICEDATA


387 
	gnsh¬ds
 = (èĞ2 + 4 * (
numedges
 * (
EdgeD©aTy³
è/ 
max_sh¬dsize
) + 0.5);

391 
	gnsh¬ds
 = 
©oi
(
nsh¬ds_¡ršg
.
c_¡r
());

393 
as£¹
(
nsh¬ds
 > 0);

394 
log¡»am
(
LOG_INFO
è<< "Numb” oàsh¬d tØbü—‹d: " << 
	gnsh¬ds
 << 
	g¡d
::
’dl
;

397 
compu‹_·¹™iÚš‹rv®s
() {

398 
size_t
 
	gedges_³r_·¹
 = 
Ãdges
 / 
nsh¬ds
 + 1;

400 
log¡»am
(
LOG_INFO
è<< "Numb” oàsh¬ds: " << 
	gnsh¬ds
 << 
	g¡d
::
’dl
;

401 
log¡»am
(
LOG_INFO
è<< "Edge ³¸sh¬d: " << 
	gedges_³r_·¹
 << 
	g¡d
::
’dl
;

402 
log¡»am
(
LOG_INFO
è<< "Max v”‹x id: " << 
	gmax_v”‹x_id
 << 
	g¡d
::
’dl
;

404 
vid_t
 
	gcur_¡
 = 0;

405 
size_t
 
	gedgecouÁ”
=0;

406 
	g¡d
::
¡ršg
 
âame
 = 
f’ame_š‹rv®s
(
ba£f’ame
, 
nsh¬ds
);

407 
FILE
 * 
	gf
 = 
fİ’
(
âame
.
c_¡r
(), "w");

409 ià(
	gf
 =ğ
NULL
) {

410 
log¡»am
(
LOG_ERROR
è<< "Could‚Ù o³Àfe: " << 
âame
 << "ƒrror: " <<

411 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

413 
as£¹
(
f
 !ğ
NULL
);

415 
vid_t
 
	gi
 = 0;

416 
	gnsh¬ds
 > (è
	gš‹rv®s
.
size
()) {

417 
	gi
 +ğ
v”‹xchunk
;

418 
	gedgecouÁ”
 +ğ
edgecouÁs
[
i
 / 
v”‹xchunk
];

419 ià(
	gedgecouÁ”
 >ğ
edges_³r_·¹
 || (
i
 >ğ
max_v”‹x_id
)) {

420 
š‹rv®s
.
push_back
(
¡d
::
·œ
<
vid_t
,vid_t>(
cur_¡
, std::
mš
(
i
, 
max_v”‹x_id
)));

421 
log¡»am
(
LOG_INFO
è<< "IÁ”v®: " << 
	gcur_¡
 << " - " << 
	gi
 << 
	g¡d
::
’dl
;

422 
årštf
(
f
, "%u\n", 
¡d
::
mš
(
i
, 
max_v”‹x_id
));

423 
	gcur_¡
 = 
i
 + 1;

424 
	gedgecouÁ”
 = 0;

427 
fşo£
(
f
);

428 
as£¹
(
nsh¬ds
 =ğ()
š‹rv®s
.
size
());

431 
	g¡d
::
¡ršg
 
numv_f’ame
 = 
ba£f’ame
 + ".numvertices";

432 
	gf
 = 
fİ’
(
numv_f’ame
.
c_¡r
(), "w");

433 
årštf
(
f
, "%u\n", 1 + 
max_v”‹x_id
);

434 
fşo£
(
f
);

436 
log¡»am
(
LOG_INFO
è<< "Compu‹d iÁ”v®s." << 
	g¡d
::
’dl
;

439 
Úe_sh¬d_š‹rv®s
() {

440 
as£¹
(
nsh¬ds
 == 1);

441 
	g¡d
::
¡ršg
 
âame
 = 
f’ame_š‹rv®s
(
ba£f’ame
, 
nsh¬ds
);

442 
FILE
 * 
	gf
 = 
fİ’
(
âame
.
c_¡r
(), "w");

443 
	gš‹rv®s
.
push_back
(
¡d
::
·œ
<
vid_t
,vid_t>(0, 
max_v”‹x_id
));

444 
årštf
(
f
, "%u\n", 
max_v”‹x_id
);

445 
fşo£
(
f
);

446 
as£¹
(
nsh¬ds
 =ğ()
š‹rv®s
.
size
());

450 
	g¡d
::
¡ršg
 
shov–_f’ame
(
sh¬d
) {

451 
¡d
::
¡ršg¡»am
 
ss
;

452 
	gss
 << 
	gba£f’ame
 << 
	gsh¬d
 << "." << 
	gnsh¬ds
 << ".shovel";

453  
	gss
.
¡r
();

456 
¡¬t_pha£
(
p
) {

457 
	gpha£
 = 
p
;

458 
	gÏ¡·¹
 = 0;

459 
log¡»am
(
LOG_INFO
è<< "S¹šg…ha£: " << 
	gpha£
 << 
	g¡d
::
’dl
;

460 
	gpha£
) {

461 
	gCOMPUTE_INTERVALS
:

466 
v”‹xchunk
 = (è(
max_v”‹x_id
 * (è/ (1024 * 1024 * 
g‘_İtiÚ_lÚg
("membudget_mb", 1024)));

467 ià(
	gv”‹xchunk
<1) vertexchunk = 1;

468 
	gedgecouÁs
 = (*)
ÿÎoc
Ğ
max_v”‹x_id
 / 
v”‹xchunk
 + 1, ());

469 
	gÃdges
 = 0;

472 
	gSHOVEL
:

473 
shov–sizes
.
»size
(
nsh¬ds
);

474 
	gshov–blocksidxs
.
»size
(
nsh¬ds
);

475 
	gbufs
 = 
Ãw
 
edge_t
*[
nsh¬ds
];

476 
	gbuåŒs
 = 
Ãw
 [
nsh¬ds
];

477 
size_t
 
	gmembudg‘_mb
 = 
g‘_İtiÚ_lÚg
("membudget_mb", 1024);

478 ià(
	gmembudg‘_mb
 > 3000) membudget_mb = 3000;

479 
	gbufsize
 = (1024 * 1024 * 
membudg‘_mb
è/ 
nsh¬ds
 / 4;

480 
	gbufsize
 % (
	gedge_t
è!ğ0è
bufsize
++;

482 
log¡»am
(
LOG_DEBUG
)<< "Shov–šg bufsize: " << 
	gbufsize
 << 
	g¡d
::
’dl
;

484 
	gi
=0; i < 
	gnsh¬ds
; i++) {

485 
	gshov–sizes
[
i
] = 0;

486 
	gshov–blocksidxs
[
i
] = 0;

487 
	gbufs
[
i
] = (
edge_t
*è
m®loc
(
bufsize
);

488 
	gbuåŒs
[
i
] = 0;

494 
’d_pha£
() {

495 
log¡»am
(
LOG_INFO
è<< "Endšg…ha£: " << 
	gpha£
 << 
	g¡d
::
’dl
;

496 
	gpha£
) {

497 
	gCOMPUTE_INTERVALS
:

498 
compu‹_·¹™iÚš‹rv®s
();

499 
ä“
(
edgecouÁs
);

500 
	gedgecouÁs
 = 
NULL
;

502 
	gSHOVEL
:

503 
i
=0; 
	gi
<
	gnsh¬ds
; i++) {

504 
swr™e
(
i
, 
edge_t
(0, 0, 
EdgeD©aTy³
()), 
Œue
);

505 
ä“
(
bufs
[
i
]);

507 
ä“
(
bufs
);

508 
ä“
(
buåŒs
);

514 
	gÏ¡·¹
;

516 
swr™e
(
sh¬d
, 
edge_t
 
‘
, 
boŞ
 
æush
=
çl£
) {

517 ià(!
æush
)

518 
bufs
[
sh¬d
][
buåŒs
[sh¬d]++] = 
‘
;

519 ià(
	gæush
 || 
	gbuåŒs
[
sh¬d
] * (
	gedge_t
è>ğ
bufsize
) {

520 
m
.
¡¬t_time
("shovel_flush");

521 
	g¡d
::
¡ršg¡»am
 
ss
;

522 
	gss
 << 
shov–_f’ame
(
sh¬d
è<< "." << 
	gshov–blocksidxs
[shard];

523 
	g¡d
::
¡ršg
 
shov–fblockÇme
 = 
ss
.
¡r
();

524 
	gbf
 = 
İ’
(
shov–fblockÇme
.
c_¡r
(), 
O_WRONLY
 | 
O_CREAT
, 
S_IROTH
 | 
S_IWOTH
 | 
S_IWUSR
 | 
S_IRUSR
);

525 
size_t
 
	gËn
 = (
edge_t
è* 
buåŒs
[
sh¬d
];

526 
size_t
 
	gwcom´es£d
 = 
wr™e_com´es£d
(
bf
, 
bufs
[
sh¬d
], 
Ën
);

527 
	gbuåŒs
[
sh¬d
] = 0;

529 
şo£
(
bf
);

530 
	gshov–sizes
[
sh¬d
] +ğ
Ën
;

531 
	gshov–blocksidxs
[
sh¬d
] ++;

532 
	gm
.
¡İ_time
("shovel_flush");

534 
log¡»am
(
LOG_DEBUG
è<< "Flushed " << 
	gshov–fblockÇme
 << " bufsize: " << 
	gbufsize
 << "/" << 
	gwcom´es£d
 << " ("

535 << (
	gwcom´es£d
 * 1.0 / 
	gbufsize
è<< "), sizeofÓdge_t)" << (
	gedge_t
è<< 
	g¡d
::
’dl
;

542 
»ûive_edge
(
vid_t
 
äom
, vid_ˆ
to
, 
EdgeD©aTy³
 
v®ue
, 
boŞ
 
šput_v®ue
) {

543 ià(
	gto
 =ğ
äom
) {

544 
log¡»am
(
LOG_WARNING
è<< "Tr›dØadd s–f-edg" << 
äom
 << "->" << 
to
 << 
¡d
::
’dl
;

547 ià(
	gäom
 > 
	gmax_v”‹x_id
 || 
	gto
 > max_vertex_id) {

548 ià(
	gmax_v”‹x_id
 == 0) {

549 
log¡»am
(
LOG_ERROR
) << "Triedo‡dd‡nƒdge withoo†arge from/to values. From:" <<

550 
äom
 << "o: "<< 
to
 << " max: " << 
max_v”‹x_id
 << 
¡d
::
’dl
;

551 
as£¹
(
çl£
);

556 
	gpha£
) {

557 
	gCOMPUTE_INTERVALS
:

558 
edgecouÁs
[
to
 / 
v”‹xchunk
]++;

559 
	gÃdges
++;

561 
	gSHOVEL
:

562 
boŞ
 
found
=
çl£
;

563 
	gi
=0; i < 
	gnsh¬ds
; i++) {

564 
	gsh¬d
 = (
Ï¡·¹
 + 
i
è% 
nsh¬ds
;

565 ià(
	gto
 >ğ
š‹rv®s
[
sh¬d
].
fœ¡
 && 
to
 <ğš‹rv®s[sh¬d].
£cÚd
) {

566 
edge_t
 
e
(
äom
, 
to
, 
v®ue
);

567 #ifdeà
DYNAMICEDATA


568 
	ge
.
	gis_chivec_v®ue
 = 
šput_v®ue
;

570 
swr™e
(
sh¬d
, 
e
);

571 
	gÏ¡·¹
 = 
sh¬d
;

572 
	gfound
 = 
Œue
;

576 if(!
	gfound
) {

577 
log¡»am
(
LOG_ERROR
è<< "Sh¬d‚Ù found fÜ : " << 
	gto
 << 
	g¡d
::
’dl
;

579 
as£¹
(
found
);

584 
size_t
 
»ad_shov–
(
sh¬d
, ** 
d©a
) {

585 
	gm
.
¡¬t_time
("read_shovel");

586 
size_t
 
	gsz
 = 
shov–sizes
[
sh¬d
];

587 *
	gd©a
 = (*è
m®loc
(
sz
);

588 * 
	g±r
 = * 
d©a
;

589 
size_t
 
	gÄ—d
 = 0;

590 
	gblockidx
 = 0;

591 
	gŒue
) {

592 
size_t
 
	gËn
 = 
¡d
::
mš
(
bufsize
, 
sz
-
Ä—d
);

594 
	g¡d
::
¡ršg¡»am
 
ss
;

595 
	gss
 << 
shov–_f’ame
(
sh¬d
è<< "." << 
	gblockidx
;

596 
	g¡d
::
¡ršg
 
shov–fblockÇme
 = 
ss
.
¡r
();

597 
	gf
 = 
İ’
(
shov–fblockÇme
.
c_¡r
(), 
O_RDONLY
);

598 ià(
	gf
 < 0) ;

599 
	gm
.
¡¬t_time
("shovel_readcompressed");

600 
»ad_com´es£d
(
f
, 
±r
, 
Ën
);

601 
	gm
.
¡İ_time
("shovel_readcompressed");

602 
	gÄ—d
 +ğ
Ën
;

603 
	g±r
 +ğ
Ën
;

604 
şo£
(
f
);

605 
	gblockidx
++;

606 
»move
(
shov–fblockÇme
.
c_¡r
());

608 
	gm
.
¡İ_time
("read_shovel");

609 
as£¹
(
Ä—d
 =ğ
sz
);

610  
	gsz
;

619 
vœtu®
 
wr™e_sh¬ds
() {

621 
	gmembudg‘_mb
 = 
g‘_İtiÚ_št
("membudget_mb", 1024);

625 
boŞ
 
	gcouÁ_deg»es_šmem
 = 
size_t
(
membudg‘_mb
è* 1024 * 1024 / 3 > 
max_v”‹x_id
 * (
deg»e
);

626 #ifdeà
DYNAMICEDATA


627 ià(!
	gcouÁ_deg»es_šmem
) {

631 
log¡»am
(
LOG_WARNING
è<< "DyÇmiøedgd©¨suµÜˆÚly sh¬dšg wh’hv”‹x deg»e ÿÀbcompu‹d in-memÜy." << 
	g¡d
::
’dl
;

632 
log¡»am
(
LOG_WARNING
è<< "Iàth´og¿m g‘ v”y slow (¡¬t sw­pšg),hd©¨sizi toØbig." << 
	g¡d
::
’dl
;

633 
	gcouÁ_deg»es_šmem
 = 
Œue
;

636 
deg»e
 * 
	gdeg»es
 = 
NULL
;

637 ià(
	gcouÁ_deg»es_šmem
) {

638 
	gdeg»es
 = (
deg»e
 *è
ÿÎoc
(1 + 
max_v”‹x_id
, (degree));

641 
	gsh¬d
=0; sh¬d < 
	gnsh¬ds
; shard++) {

642 
	gm
.
¡¬t_time
("shard_final");

643 
	gblockid
 = 0;

644 
size_t
 
	gedgecouÁ”
 = 0;

646 
log¡»am
(
LOG_INFO
è<< "S¹šg fš®…roûssšg fÜ sh¬d: " << 
	gsh¬d
 << 
	g¡d
::
’dl
;

648 
	g¡d
::
¡ršg
 
âame
 = 
f’ame_sh¬d_adj
(
ba£f’ame
, 
sh¬d
, 
nsh¬ds
);

649 
	g¡d
::
¡ršg
 
edâame
 = 
f’ame_sh¬d_ed©a
<
EdgeD©aTy³
>(
ba£f’ame
, 
	gsh¬d
, 
	gnsh¬ds
);

650 
	g¡d
::
¡ršg
 
edblockdœÇme
 = 
dœÇme_sh¬d_ed©a_block
(
edâame
, 
com´es£d_block_size
);

653 ià(!
	gno_edgev®ues
)

654 
mkdœ
(
edblockdœÇme
.
c_¡r
(), 0777);

656 
edge_t
 * 
	gshov–buf
;

657 
size_t
 
	gshov–size
 = 
»ad_shov–
(
sh¬d
, (**è&
shov–buf
);

658 
size_t
 
	gnumedges
 = 
shov–size
 / (
edge_t
);

660 
log¡»am
(
LOG_DEBUG
è<< "Shov– size:" << 
	gshov–size
 << "ƒdges: " << 
	gnumedges
 << 
	g¡d
::
’dl
;

662 
quickSÜt
(
shov–buf
, ()
numedges
, 
edge_t_¤c_Ëss
<
EdgeD©aTy³
>);

665 
	gf
 = 
İ’
(
âame
.
c_¡r
(), 
O_WRONLY
 | 
O_CREAT
, 
S_IROTH
 | 
S_IWOTH
 | 
S_IWUSR
 | 
S_IRUSR
);

666 ià(
	gf
 < 0) {

667 
log¡»am
(
LOG_ERROR
è<< "Could‚Ù o³À" << 
	gâame
 << "ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
	g¡d
::
’dl
;

669 
as£¹
(
f
 >= 0);

670 
	gŒ”r
 = 
árunÿ‹
(
f
, 0);

671 
as£¹
(
Œ”r
 == 0);

673 * 
	gbuf
 = (*è
m®loc
(
SHARDER_BUFSIZE
);

674 * 
	gbuåŒ
 = 
buf
;

676 * 
	gebuf
 = (*è
m®loc
(
com´es£d_block_size
);

677 
	gebufãr_size
 = 
com´es£d_block_size
;

678 * 
	gebuåŒ
 = 
ebuf
;

680 
vid_t
 
	gcurvid
=0;

681 #ifdeà
DYNAMICEDATA


682 
vid_t
 
	gÏ¡d¡
 = 0xffffffff;

684 
size_t
 
	gi¡¬t
 = 0;

685 
size_t
 
	gtÙ_ed©aby‹s
 = 0;

686 
size_t
 
	gi
=0; i <ğ
numedges
; i++) {

687 
edge_t
 
	gedge
 = (
i
 < 
numedges
 ? 
shov–buf
[i] :ƒdge_t(0, 0, 
EdgeD©aTy³
()));

689 #ifdeà
DYNAMICEDATA


691 ià(
	gÏ¡d¡
 =ğ
edge
.
d¡
 &&ƒdge.
¤c
 =ğ
curvid
) {

693 
log¡»am
(
LOG_ERROR
è<< "Du¶iÿ‹ƒdgšh¡»am -‡bÜtšg" << 
¡d
::
’dl
;

694 
as£¹
(
çl£
);

696 
	gÏ¡d¡
 = 
edge
.
d¡
;

699 ià(!
	gedge
.
¡İ³r
()) {

700 #iâdeà
DYNAMICEDATA


701 
	gbwr™e_ed©a
<
	gEdgeD©aTy³
>(
	gebuf
, 
	gebuåŒ
, 
EdgeD©aTy³
(
edge
.
v®ue
), 
	gtÙ_ed©aby‹s
, 
	gedâame
, 
	gedgecouÁ”
);

704 ià(
	gedge
.
	gis_chivec_v®ue
) {

707 
ty³Çme
 
	gchiveùÜ
<
	gEdgeD©aTy³
>::
sizewÜd_t
 
szw
;

708 ((
	gušt16_t
 *è&
	gszw
)[0] = 1;

709 ((
	gušt16_t
 *è&
	gszw
)[1] = 1;

710 
	gbwr™e_ed©a
<
ty³Çme
 
	gchiveùÜ
<
	gEdgeD©aTy³
>::
sizewÜd_t
>(
ebuf
, 
	gebuåŒ
, 
	gszw
, 
	gtÙ_ed©aby‹s
, 
	gedâame
, 
	gedgecouÁ”
);

711 
	gbwr™e_ed©a
<
	gEdgeD©aTy³
>(
	gebuf
, 
	gebuåŒ
, 
EdgeD©aTy³
(
edge
.
v®ue
), 
	gtÙ_ed©aby‹s
, 
	gedâame
, 
	gedgecouÁ”
);

714 
	gbwr™e_ed©a
<>(
	gebuf
, 
	gebuåŒ
, 0, 
	gtÙ_ed©aby‹s
, 
	gedâame
, 
	gedgecouÁ”
);

717 
	gedgecouÁ”
++;

719 ià(
	gdeg»es
 !ğ
NULL
 && 
edge
.
¤c
 !ğedge.
d¡
) {

720 
deg»es
[
edge
.
¤c
].
outdeg»e
++;

721 
	gdeg»es
[
edge
.
d¡
].
	gšdeg»e
++;

724 ià((
	gedge
.
	g¤c
 !ğ
curvid
è|| 
edge
.
¡İ³r
()) {

726 
size_t
 
couÁ
 = 
i
 - 
i¡¬t
;

727 
as£¹
(
couÁ
>0 || 
curvid
==0);

728 ià(
	gcouÁ
>0) {

729 ià(
	gcouÁ
 < 255) {

730 
ušt8_t
 
	gx
 = (ušt8_t)
couÁ
;

731 
	gbwr™e
<
	gušt8_t
>(
	gf
, 
	gbuf
, 
	gbuåŒ
, 
	gx
);

733 
	gbwr™e
<
	gušt8_t
>(
	gf
, 
	gbuf
, 
	gbuåŒ
, 0xff);

734 
	gbwr™e
<
	gušt32_t
>(
	gf
, 
	gbuf
, 
	gbuåŒ
, (ušt32_t)
	gcouÁ
);

738 
size_t
 
	gj
=
i¡¬t
; j < 
	gi
; j++) {

739 
bwr™e
(
f
, 
buf
, 
buåŒ
, 
shov–buf
[
j
].
d¡
);

742 
	gi¡¬t
 = 
i
;

745 ià(!
	gedge
.
¡İ³r
()) {

746 ià(
	gedge
.
	g¤c
 - 
	gcurvid
 > 1 || (
	gi
 =ğ0 && 
edge
.
¤c
>0)) {

747 
nz
 = 
edge
.
¤c
-
curvid
-1;

748 ià(
	gi
 =ğ0 && 
edge
.
¤c
 > 0è
nz
 =ƒdge.src;

750 
	gbwr™e
<
	gušt8_t
>(
	gf
, 
	gbuf
, 
	gbuåŒ
, 0);

751 
	gnz
--;

752 
	gŠz
 = 
¡d
::
mš
(254, 
nz
);

753 
	gbwr™e
<
	gušt8_t
>(
	gf
, 
	gbuf
, 
	gbuåŒ
, (ušt8_tè
	gŠz
);

754 
	gnz
 -ğ
Šz
;

755 } 
	gnz
>0);

758 
	gcurvid
 = 
edge
.
¤c
;

763 
wr™—
(
f
, 
buf
, 
buåŒ
 - buf);

764 
ä“
(
buf
);

765 
ä“
(
shov–buf
);

766 
şo£
(
f
);

769 ià(!
	gno_edgev®ues
) {

770 
	ged©a_æush
<
	gEdgeD©aTy³
>(
	gebuf
, 
	gebuåŒ
, 
	gedâame
, 
	gtÙ_ed©aby‹s
);

772 
	g¡d
::
¡ršg
 
sizef’ame
 = 
edâame
 + ".size";

773 
	g¡d
::
of¡»am
 
ofs
(
sizef’ame
.
c_¡r
());

774 #iâdeà
DYNAMICEDATA


775 
	gofs
 << 
	gtÙ_ed©aby‹s
;

777 
	gofs
 << 
numedges
 * ();

780 
	gofs
.
şo£
();

782 
ä“
(
ebuf
);

784 
	gm
.
¡İ_time
("shard_final");

787 ià(!
	gcouÁ_deg»es_šmem
) {

788 #iâdeà
DYNAMICEDATA


790 
ü—‹_deg»e_fe
();

794 
	g¡d
::
¡ršg
 
deg»eâame
 = 
f’ame_deg»e_d©a
(
ba£f’ame
);

795 
	gdeg»eOutF
 = 
İ’
(
deg»eâame
.
c_¡r
(), 
O_RDWR
 | 
O_CREAT
, 
S_IROTH
 | 
S_IWOTH
 | 
S_IWUSR
 | 
S_IRUSR
);

796 ià(
	gdeg»eOutF
 < 0) {

797 
log¡»am
(
LOG_ERROR
è<< "Could‚Ù c»©e: " << 
	gdeg»eOutF
 << 
	g¡d
::
’dl
;

798 
as£¹
(
deg»eOutF
 >= 0);

801 
wr™—
(
deg»eOutF
, 
deg»es
, (
deg»e
è* (1 + 
max_v”‹x_id
));

802 
ä“
(
deg»es
);

803 
şo£
(
deg»eOutF
);

809 
	tdummy_t
;

811 
	g¦idšg_sh¬d
<, 
	tdummy_t
> 
	t¦idšgsh¬d_t
;

812 
	gmemÜy_sh¬d
<, 
	tdummy_t
> 
	tmemsh¬d_t
;

815 #iâdeà
DYNAMICEDATA


816 
ü—‹_deg»e_fe
() {

818 
¡redio
 * 
	giomgr
 = 
Ãw
 sŒedio(
m
);

819 
	g¡d
::
veùÜ
<
¦idšgsh¬d_t
 * > 
¦idšg_sh¬ds
;

821 
	gsubwšdow
 = 5000000;

822 
	gm
.
£t
("subwšdow", (
size_t
)
subwšdow
);

824 
	glßdth»ads
 = 4;

826 
	gm
.
¡¬t_time
("degrees.runtime");

829 
	gblocksize
 = 
com´es£d_block_size
;

831 
	gp
=0;… < 
	gnsh¬ds
;…++) {

832 
log¡»am
(
LOG_INFO
è<< "In™Ÿliz¡»amšg sh¬d: " << 
	gp
 << 
	g¡d
::
’dl
;

833 
	g¦idšg_sh¬ds
.
push_back
(

834 
Ãw
 
¦idšgsh¬d_t
(
iomgr
, 
f’ame_sh¬d_ed©a
<
dummy_t
>(
ba£f’ame
, 
p
, 
nsh¬ds
),

835 
f’ame_sh¬d_adj
(
ba£f’ame
, 
p
, 
nsh¬ds
), 
š‹rv®s
[p].
fœ¡
,

836 
š‹rv®s
[
p
].
£cÚd
,

837 
blocksize
, 
m
, 
Œue
,rue));

840 
g¿phchi_cÚ‹xt
 
	ggšfo
;

841 
	ggšfo
.
	gnv”tiûs
 = 1 + 
š‹rv®s
[
nsh¬ds
 - 1].
£cÚd
;

842 
	ggšfo
.
	gscheduËr
 = 
NULL
;

844 
	g¡d
::
¡ršg
 
ouutâame
 = 
f’ame_deg»e_d©a
(
ba£f’ame
);

846 
	gdeg»eOutF
 = 
İ’
(
ouutâame
.
c_¡r
(), 
O_RDWR
 | 
O_CREAT
, 
S_IROTH
 | 
S_IWOTH
 | 
S_IWUSR
 | 
S_IRUSR
);

847 ià(
	gdeg»eOutF
 < 0) {

848 
log¡»am
(
LOG_ERROR
è<< "Could‚Ù c»©e: " << 
	gdeg»eOutF
 << 
	g¡d
::
’dl
;

850 
as£¹
(
deg»eOutF
 >= 0);

851 
	gŒ”r
 = 
árunÿ‹
(
deg»eOutF
, 
gšfo
.
nv”tiûs
 * () * 2);

852 
as£¹
(
Œ”r
 == 0);

853 
	gwšdow
=0; wšdow<
	gnsh¬ds
; window++) {

854 
m‘rics_’Œy
 
	gmwi
 = 
m
.
¡¬t_time
();

856 
vid_t
 
	gš‹rv®_¡
 = 
š‹rv®s
[
wšdow
].
fœ¡
;

857 
vid_t
 
	gš‹rv®_’
 = 
š‹rv®s
[
wšdow
].
£cÚd
;

860 
	g¦idšg_sh¬ds
[
wšdow
]->
æush
();

863 
memsh¬d_t
 
memsh¬d
(
iomgr
, 
f’ame_sh¬d_ed©a
<
EdgeD©aTy³
>(
ba£f’ame
, 
wšdow
, 
nsh¬ds
), 
f’ame_sh¬d_adj
(basefilename, window,‚shards),

864 
š‹rv®_¡
, 
š‹rv®_’
, 
blocksize
, 
m
);

865 
	gmemsh¬d
.
	gÚly_adjaûncy
 = 
Œue
;

866 
log¡»am
(
LOG_INFO
è<< "IÁ”v®: " << 
	gš‹rv®_¡
 << " " << 
	gš‹rv®_’
 << 
	g¡d
::
’dl
;

868 
vid_t
 
	gsubš‹rv®_¡
=
š‹rv®_¡
; subš‹rv®_¡ <ğ
š‹rv®_’
; ) {

869 
vid_t
 
	gsubš‹rv®_’
 = 
¡d
::
mš
(
š‹rv®_’
, 
subš‹rv®_¡
 + 
subwšdow
);

870 
log¡»am
(
LOG_INFO
è<< "(Deg»´oc.èSub-wšdow: [" << 
	gsubš‹rv®_¡
 << " - " << 
	gsubš‹rv®_’
 << "]" << 
	g¡d
::
’dl
;

871 
as£¹
(
subš‹rv®_’
 >ğ
subš‹rv®_¡
 && subš‹rv®_’ <ğ
š‹rv®_’
);

874 
m‘rics_’Œy
 
	gm’
 = 
m
.
¡¬t_time
();

875 
	gnv”tiûs
 = 
subš‹rv®_’
 - 
subš‹rv®_¡
 + 1;

876 
	g¡d
::
veùÜ
< 
g¿phchi_v”‹x
<, 
	gdummy_t
> > 
v”tiûs
(
nv”tiûs
, g¿phchi_v”‹x<, 
dummy_t
>());

879 
	gi
=0; i < 
	gnv”tiûs
; i++) {

880 
	gv”tiûs
[
i
] = 
g¿phchi_v”‹x
<, 
	gdummy_t
>(
	gsubš‹rv®_¡
 + 
	gi
, 
	gNULL
, NULL, 0, 0);

881 
	gv”tiûs
[
i
].
	gscheduËd
 = 
Œue
;

884 
m‘rics_’Œy
 
	gme
 = 
m
.
¡¬t_time
();

885 
omp_£t_num_th»ads
(
lßdth»ads
);

886 #´agm¨
omp
 
·¿Î–
 

887 
	gp
=-1;… < 
	gnsh¬ds
;…++) {

888 ià(
	gp
 == (-1)) {

890 ià(
memsh¬d
.
lßded
(è=ğ
çl£
) {

891 
memsh¬d
.
lßd
();

895 
	gmemsh¬d
.
lßd_v”tiûs
(
subš‹rv®_¡
, 
subš‹rv®_’
, 
v”tiûs
);

898 ià(
	gp
 !ğ
wšdow
) {

899 
¦idšg_sh¬ds
[
p
]->
»ad_Ãxt_v”tiûs
(
nv”tiûs
, 
subš‹rv®_¡
, 
v”tiûs
, 
çl£
);

904 
	gm
.
¡İ_time
(
me
, "¡»am_ah—d", 
wšdow
);

907 
m‘rics_’Œy
 
	gmev
 = 
m
.
¡¬t_time
();

910 * 
	gvbuf
 = (*è
m®loc
(
nv”tiûs
 * () * 2);

912 
	gi
=0; i<
	gnv”tiûs
; i++) {

913 
	gvbuf
[2 * 
i
] = 
v”tiûs
[i].
num_šedges
();

914 
	gvbuf
[2 * 
i
 +1] = 
v”tiûs
[i].
num_ou‹dges
();

916 
pwr™—
(
deg»eOutF
, 
vbuf
, 
nv”tiûs
 * (è* 2, 
subš‹rv®_¡
 * () * 2);

918 
ä“
(
vbuf
);

921 
	gsubš‹rv®_¡
 = 
subš‹rv®_’
+1;

924 
	g¦idšg_sh¬ds
[
wšdow
]->
£t_off£t
(
memsh¬d
.
off£t_fÜ_¡»am_cÚt
(), memsh¬d.
off£t_vid_fÜ_¡»am_cÚt
(),

925 
memsh¬d
.
ed©a_±r_fÜ_¡»am_cÚt
());

927 
şo£
(
deg»eOutF
);

928 
	gm
.
¡İ_time
("degrees.runtime");

929 
d–‘e
 
	giomgr
;

933 
ä›nd
 
şass
 
	gbš¬y_adjaûncy_li¡_»ad”
<
	gEdgeD©aTy³
>;

	@src/preprocessing/sharder_basic.cpp

29 
	~<io¡»am
>

30 
	~<¡dlib.h
>

31 
	~<¡ršg
>

32 
	~<as£¹.h
>

34 
	~"logg”/logg”.hµ
"

35 
	~"´•roûssšg/cÚv”siÚs.hµ
"

36 
	~"´•roûssšg/sh¬d”.hµ
"

37 
	~"ut/cmdİts.hµ
"

39 
usšg
 
Çme¥aû
 
	gg¿phchi
;

43 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

44 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

46 
	`glob®_logg”
().
	`£t_log_Ëv–
(
LOG_DEBUG
);

48 
¡d
::
¡ršg
 
ba£fe
 = 
	`g‘_İtiÚ_¡ršg_š‹¿ùive
("file", "[pathohe input graph]");

49 
¡d
::
¡ršg
 
edge_d©a_ty³
 = 
	`g‘_İtiÚ_¡ršg_š‹¿ùive
("edgedatatype", "int, uint, short, float, char, double, boolean,†ong, float-float, int-int,‚one");

50 
¡d
::
¡ršg
 
nsh¬ds_¡r
 = 
	`g‘_İtiÚ_¡ršg_š‹¿ùive
("nshards", "Number of shardso create, or 'auto'");

52 ià(
edge_d©a_ty³
 == "float") {

53 
cÚv”t
<>(
ba£fe
, 
nsh¬ds_¡r
);

54 } ià(
edge_d©a_ty³
 == "float-float") {

55 
cÚv”t
<
PaœCÚš”
<> >(
ba£fe
, 
nsh¬ds_¡r
);

56 } ià(
edge_d©a_ty³
 == "int") {

57 
cÚv”t
<>(
ba£fe
, 
nsh¬ds_¡r
);

58 } ià(
edge_d©a_ty³
 == "uint") {

59 
cÚv”t
<>(
ba£fe
, 
nsh¬ds_¡r
);

60 } ià(
edge_d©a_ty³
 == "int-int") {

61 
cÚv”t
<
PaœCÚš”
<> >(
ba£fe
, 
nsh¬ds_¡r
);

62 } ià(
edge_d©a_ty³
 == "short") {

63 
cÚv”t
<>(
ba£fe
, 
nsh¬ds_¡r
);

64 } ià(
edge_d©a_ty³
 == "double") {

65 
cÚv”t
<>(
ba£fe
, 
nsh¬ds_¡r
);

66 } ià(
edge_d©a_ty³
 == "char") {

67 
cÚv”t
<>(
ba£fe
, 
nsh¬ds_¡r
);

68 } ià(
edge_d©a_ty³
 == "boolean") {

69 
cÚv”t
<
boŞ
>(
ba£fe
, 
nsh¬ds_¡r
);

70 } ià(
edge_d©a_ty³
 == "long") {

71 
cÚv”t
<>(
ba£fe
, 
nsh¬ds_¡r
);

72 } ià(
edge_d©a_ty³
 == "none") {

73 
	`cÚv”t_nÚe
(
ba£fe
, 
nsh¬ds_¡r
);

75 
	`log¡»am
(
LOG_ERROR
) << "You‚eedo specifyƒdgedatatype. Currently supported: int, short, float, char, double, boolean,†ong.";

80 
	}
}

	@src/shards/dynamicdata/dynamicblock.hpp

29 #iâdeà
g¿phchi_xcode_dyÇmicblock_hµ


30 
	#g¿phchi_xcode_dyÇmicblock_hµ


	)

32 
	~<¡dšt.h
>

34 
Çme¥aû
 
	gg¿phchi
 {

36 
g‘_block_uncom´es£d_size
(
¡d
::
¡ršg
 
blockf’ame
, 
deçuÉsize
);

37 
g‘_block_uncom´es£d_size
(
¡d
::
¡ršg
 
blockf’ame
, 
deçuÉsize
) {

38 
	g¡d
::
¡ršg
 
szf’ame
 = 
blockf’ame
 + ".bsize";

39 
FILE
 * 
	gf
 = 
fİ’
(
szf’ame
.
c_¡r
(), "r");

40 ià(
	gf
 !ğ
NULL
) {

41 
sz
;

42 
ä—d
(&
sz
, 1, (), 
f
);

43 
fşo£
(
f
);

44  
	gsz
;

46  
	gdeçuÉsize
;

50 
wr™e_block_uncom´es£d_size
(
¡d
::
¡ršg
 
blockf’ame
, 
size
);

51 
wr™e_block_uncom´es£d_size
(
¡d
::
¡ršg
 
blockf’ame
, 
size
) {

52 
	g¡d
::
¡ršg
 
szf’ame
 = 
blockf’ame
 + ".bsize";

53 
FILE
 * 
	gf
 = 
fİ’
(
szf’ame
.
c_¡r
(), "w");

54 
fwr™e
(&
size
, 1, (), 
f
);

55 
fşo£
(
f
);

58 
d–‘e_block_uncom´es£d_sizefe
(
¡d
::
¡ršg
 
blockf’ame
);

59 
d–‘e_block_uncom´es£d_sizefe
(
¡d
::
¡ršg
 
blockf’ame
) {

60 
¡d
::
¡ršg
 
szf’ame
 = 
blockf’ame
 + ".bsize";

61 
	g”r
 = 
»move
(
szf’ame
.
c_¡r
());

62 ià(
	g”r
 != 0) {

69 
	g‹m¶©e
 <
ty³Çme
 
	gET
>

70 
	sdyÇmicd©a_block
 {

71 
	gn™ems
;

72 
ušt8_t
 * 
	gd©a
;

73 
ET
 * 
	gchivecs
;

75 
dyÇmicd©a_block
(è: 
d©a
(
NULL
), 
chivecs
(NULL) {}

77 
dyÇmicd©a_block
(
n™ems
, 
ušt8_t
 * 
d©a
, 
d©asize
) :‚items(nitems){

78 
chivecs
 = 
Ãw
 
ET
[
n™ems
];

79 
ušt8_t
 * 
	g±r
 = 
d©a
;

80 
	gi
=0; i < 
	gn™ems
; i++) {

81 
as£¹
(
±r
 - 
d©a
 <ğ
d©asize
);

82 
ty³Çme
 
	gET
::
sizewÜd_t
 * 
sz
 = (Ñy³Çm
ET
::sizewÜd_ˆ*è
±r
);

83 
	g±r
 +ğ(
ty³Çme
 
ET
::
sizewÜd_t
);

84 
	gchivecs
[
i
] = 
ET
(((
ušt16_t
 *)
sz
)[0], ((ušt16_ˆ*)sz)[1], (
ty³Çme
 ET::
–em’t_ty³_t
 *è
±r
);

85 
	g±r
 +ğ(è((
ušt16_t
 *)
sz
)[1] * (
ty³Çme
 
ET
::
–em’t_ty³_t
);

89 
ET
 * 
edgevec
(
i
) {

90 
as£¹
(
i
 < 
n™ems
);

91 
as£¹
(
chivecs
 !ğ
NULL
);

92  &
	gchivecs
[
i
];

95 
wr™e
(
ušt8_t
 ** 
outd©a
, & 
size
) {

97 
	gsize
 = 0;

98 
	gi
=0; i < 
	gn™ems
; i++) {

99 
	gsize
 +ğ
chivecs
[
i
].
ÿ·c™y
(è* (
ty³Çme
 
ET
::
–em’t_ty³_t
è+ Ñy³ÇmET::
sizewÜd_t
);

102 *
	goutd©a
 = (
ušt8_t
 *è
m®loc
(
size
);

103 
ušt8_t
 * 
	g±r
 = *
outd©a
;

104 
	gi
=0; i < 
	gn™ems
; i++) {

105 
	gET
 & 
	gvec
 = 
chivecs
[
i
];

106 ((
	gušt16_t
 *è
	g±r
)[0] = 
vec
.
size
();

107 ((
	gušt16_t
 *è
	g±r
)[1] = 
vec
.
ÿ·c™y
();

109 
	g±r
 +ğ(
ty³Çme
 
ET
::
sizewÜd_t
);

110 
	gvec
.
wr™e
((
ty³Çme
 
ET
::
–em’t_ty³_t
 *è
±r
);

111 
	g±r
 +ğ
vec
.
ÿ·c™y
(è* (
ty³Çme
 
ET
::
–em’t_ty³_t
);

115 ~
dyÇmicd©a_block
() {

116 ià(
	gchivecs
 !ğ
NULL
) {

117 
d–‘e
 [] 
chivecs
;

	@src/shards/dynamicdata/memoryshard.hpp

30 #iâdeà
DEF_GRAPHCHI_MEMSHARD


31 
	#DEF_GRAPHCHI_MEMSHARD


	)

34 
	~<io¡»am
>

35 
	~<c¡dio
>

36 
	~<s¡»am
>

37 
	~<veùÜ
>

38 
	~<fú.h
>

39 
	~<uni¡d.h
>

40 
	~<as£¹.h
>

41 
	~<¡ršg
>

43 
	~"­i/g¿ph_objeùs.hµ
"

44 
	~"m‘rics/m‘rics.hµ
"

45 
	~"io/¡redio.hµ
"

46 
	~"g¿phchi_ty³s.hµ
"

47 
	~"sh¬ds/dyÇmicd©a/dyÇmicblock.hµ
"

49 
Çme¥aû
 
	gg¿phchi
 {

52 
	g‹m¶©e
 <
ty³Çme
 
	gVT
,y³Çm
	gET
,y³Çm
	gsv”‹x_t
 = 
g¿phchi_v”‹x
<
VT
, ET> >

53 şas 
	cmemÜy_sh¬d
 {

55 
¡redio
 * 
	giomgr
;

57 
	g¡d
::
¡ršg
 
f’ame_ed©a
;

58 
	g¡d
::
¡ršg
 
f’ame_adj
;

60 
vid_t
 
	g¿nge_¡
;

61 
vid_t
 
	g¿nge_’d
;

62 
size_t
 
	gadjfesize
;

63 
size_t
 
	ged©afesize
;

65 
size_t
 
	gedg•Œ
;

66 
vid_t
 
	g¡»amšg_off£t_vid
;

67 
size_t
 
	g¡»amšg_off£t
;

68 
size_t
 
	g¿nge_¡¬t_off£t
;

69 
size_t
 
	g¿nge_¡¬t_edge_±r
;

70 
size_t
 
	g¡»amšg_off£t_edge_±r
;

71 
ušt8_t
 * 
	gadjd©a
;

72 ** 
	gedged©a
;

73 
	g¡d
::
veùÜ
<
size_t
> 
blocksizes
;

74 
	g¡d
::
veùÜ
< 
dyÇmicd©a_block
<
ET
> * > 
dyÇmicblocks
;

75 
ušt64_t
 
	gchunkid
;

77 
	g¡d
::
veùÜ
<> 
block_ed©a£ssiÚs
;

78 
	gadj_£ssiÚ
;

79 
¡»amšg_sk
 
	gadj_¡»am_£ssiÚ
;

81 
boŞ
 
	gis_lßded
;

82 
size_t
 
	gblocksize
;

83 
	gm‘rics
 &
	gm
;

85 
	gpublic
:

86 
boŞ
 
Úly_adjaûncy
;

89 
memÜy_sh¬d
(
¡redio
 * 
iomgr
,

90 
¡d
::
¡ršg
 
_f’ame_ed©a
,

91 
¡d
::
¡ršg
 
_f’ame_adj
,

92 
vid_t
 
_¿nge_¡¬t
,

93 
vid_t
 
_¿nge_’d
,

94 
size_t
 
_blocksize
,

95 
m‘rics
 &
_m
è: 
iomgr
(iomgr), 
f’ame_ed©a
(
_f’ame_ed©a
),

96 
f’ame_adj
(
_f’ame_adj
),

97 
¿nge_¡
(
_¿nge_¡¬t
), 
¿nge_’d
(
_¿nge_’d
), 
blocksize
(
_blocksize
), 
m
(
_m
) {

98 
	gadjd©a
 = 
NULL
;

99 
	gÚly_adjaûncy
 = 
çl£
;

100 
	gis_lßded
 = 
çl£
;

101 
	gadj_£ssiÚ
 = -1;

102 
	gedged©a
 = 
NULL
;

106 ~
memÜy_sh¬d
() {

107 
	gnblocks
 = (è
block_ed©a£ssiÚs
.
size
();

109 
	gi
=0; i < 
	gnblocks
; i++) {

110 ià(
	gedged©a
[
i
] !ğ
NULL
) {

111 
iomgr
->
mªaged_»Ëa£
(
block_ed©a£ssiÚs
[
i
], &
edged©a
[i]);

112 
	giomgr
->
şo£_£ssiÚ
(
block_ed©a£ssiÚs
[
i
]);

115 ià(
	gdyÇmicblocks
[
i
] !ğ
NULL
)

116 
d–‘e
 
dyÇmicblocks
[
i
];

117 
	gdyÇmicblocks
[
i
] = 
NULL
;

119 
	gdyÇmicblocks
.
ş—r
();

120 ià(
	gadj_£ssiÚ
 >= 0) {

121 ià(
adjd©a
 !ğ
NULL
è
iomgr
->
mªaged_»Ëa£
(
adj_£ssiÚ
, &adjdata);

122 
	giomgr
->
şo£_£ssiÚ
(
adj_£ssiÚ
);

124 ià(
	gedged©a
 !ğ
NULL
)

125 
ä“
(
edged©a
);

126 
	gedged©a
 = 
NULL
;

130 
wr™e_ªd_»Ëa£_block
(
i
) {

131 
	g¡d
::
¡ršg
 
block_f’ame
 = 
f’ame_sh¬d_ed©a_block
(
f’ame_ed©a
, 
i
, 
blocksize
);

133 
	gdyÇmicd©a_block
<
	gET
> * 
	gdynblock
 = 
dyÇmicblocks
[
i
];

134 ià(
	gdynblock
 !ğ
NULL
) {

135 
ušt8_t
 * 
outd©a
;

136 
	goutsize
;

137 
	gdynblock
->
wr™e
(&
outd©a
, 
outsize
);

138 
wr™e_block_uncom´es£d_size
(
block_f’ame
, 
outsize
);

139 
	giomgr
->
mªaged_pwr™—_now
(
block_ed©a£ssiÚs
[
i
], &
outd©a
, 
outsize
, 0);

140 
	giomgr
->
mªaged_»Ëa£
(
block_ed©a£ssiÚs
[
i
], &
edged©a
[i]);

141 
	giomgr
->
şo£_£ssiÚ
(
block_ed©a£ssiÚs
[
i
]);

142 
ä“
(
outd©a
);

143 
d–‘e
 
	gdynblock
;

145 
	gdyÇmicblocks
[
i
] = 
NULL
;

149 
comm™
(
boŞ
 
comm™_šedges
, boŞ 
comm™_ou‹dges
) {

150 ià(
	gblock_ed©a£ssiÚs
.
size
(è=ğ0 || 
Úly_adjaûncy
) ;

151 
as£¹
(
is_lßded
);

152 
m‘rics_’Œy
 
	gcm
 = 
m
.
¡¬t_time
();

160 
	gnblocks
 = (è
block_ed©a£ssiÚs
.
size
();

162 ià(
	gcomm™_šedges
) {

163 
	gi
=0; i < 
	gnblocks
; i++) {

165 
wr™e_ªd_»Ëa£_block
(
i
);

166 
	gedged©a
[
i
] = 
NULL
;

168 } ià(
	gcomm™_ou‹dges
) {

169 
size_t
 
	gÏ¡
 = 
¡»amšg_off£t_edge_±r
;

170 ià(
	gÏ¡
 == 0){

172 
Ï¡
 = 
ed©afesize
;

175 
	g¡¬tblock
 = (è(
¿nge_¡¬t_edge_±r
 / 
blocksize
);

176 
	g’dblock
 = (è(
Ï¡
 / 
blocksize
);

177 
	gi
=0; i < 
	gnblocks
; i++) {

178 ià(
	gi
 >ğ
¡¬tblock
 && 
i
 <ğ
’dblock
) {

179 
wr™e_ªd_»Ëa£_block
(
i
);

181 
	giomgr
->
mªaged_»Ëa£
(
block_ed©a£ssiÚs
[
i
], &
edged©a
[i]);

183 
	gedged©a
[
i
] = 
NULL
;

184 
	giomgr
->
şo£_£ssiÚ
(
block_ed©a£ssiÚs
[
i
]);

187 
	gm
.
¡İ_time
(
cm
, "memshard_commit");

189 
	giomgr
->
mªaged_»Ëa£
(
adj_£ssiÚ
, &
adjd©a
);

191 
	gi
=0; i < 
	gnblocks
; i++) {

192 ià(
	gedged©a
[
i
] !ğ
NULL
) {

193 
iomgr
->
mªaged_»Ëa£
(
block_ed©a£ssiÚs
[
i
], &
edged©a
[i]);

196 
	gblock_ed©a£ssiÚs
.
ş—r
();

197 
	gis_lßded
 = 
çl£
;

200 
boŞ
 
lßded
() {

201  
	gis_lßded
;

204 
	g´iv©e
:

207 
lßd_ed©a
() {

208 
boŞ
 
async_šedged©a_lßdšg
 = 
çl£
;

209 
as£¹
(
blocksize
 % () == 0);

210 
	gnblocks
 = (è(
ed©afesize
 / 
blocksize
 + (edatafilesize % blocksize != 0));

211 
	gedged©a
 = (**è
ÿÎoc
(
nblocks
, (*));

212 
size_t
 
	gcom´es£dsize
 = 0;

213 
	gblockid
 = 0;

216 
	gŒue
) {

217 
	g¡d
::
¡ršg
 
block_f’ame
 = 
f’ame_sh¬d_ed©a_block
(
f’ame_ed©a
, 
blockid
, 
blocksize
);

218 ià(
fe_exi¡s
(
block_f’ame
)) {

219 
size_t
 
	gfsize
 = 
g‘_block_uncom´es£d_size
(
block_f’ame
, 
¡d
::
mš
(
ed©afesize
 - 
blocksize
 * 
blockid
, blocksize));

220 
	gcom´es£dsize
 +ğ
g‘_fesize
(
block_f’ame
);

221 
	gblock£ssiÚ
 = 
iomgr
->
İ’_£ssiÚ
(
block_f’ame
, 
çl£
, 
Œue
);

222 
	gblock_ed©a£ssiÚs
.
push_back
(
block£ssiÚ
);

223 
	gblocksizes
.
push_back
(
fsize
);

224 
	gedged©a
[
blockid
] = 
NULL
;

225 
	giomgr
->
mªaged_m®loc
(
block£ssiÚ
, &
edged©a
[
blockid
], 
fsize
, 0);

226 ià(
	gasync_šedged©a_lßdšg
) {

227 
as£¹
(
çl£
);

229 
	giomgr
->
mªaged_´—da_now
(
block£ssiÚ
, &
edged©a
[
blockid
], 
fsize
, 0);

231 
	gdyÇmicblocks
.
push_back
(
NULL
);

233 
	gblockid
++;

236 ià(
	gblockid
 == 0) {

237 
log¡»am
(
LOG_ERROR
è<< "Sh¬d block fdid‚Ùƒxi¡s:" << 
block_f’ame
 << 
¡d
::
’dl
;

242 
as£¹
(
blockid
 =ğ
nblocks
);

243 
log¡»am
(
LOG_DEBUG
è<< "Com´es£d/fuÎ size: " << 
	gcom´es£dsize
 * 1.0 / 
	ged©afesize
 <<

244 "‚umb” oàblocks: " << 
	gnblocks
 << 
	g¡d
::
’dl
;

248 
check_block_š™Ÿlized
(
blockid
) {

249 ià(
	gdyÇmicblocks
[
blockid
] =ğ
NULL
) {

250 
¡d
::
¡ršg
 
block_f’ame
 = 
f’ame_sh¬d_ed©a_block
(
f’ame_ed©a
, 
blockid
, 
blocksize
);

251 
size_t
 
	gfsize
 = 
g‘_block_uncom´es£d_size
(
block_f’ame
, 
¡d
::
mš
(
ed©afesize
 - 
blocksize
 * 
blockid
, blocksize));

252 
	gÃdges
 = 
¡d
::
mš
(
ed©afesize
 - 
blocksize
 * 
blockid
, blocksize) / ();

253 
	gdyÇmicblocks
[
blockid
] = 
Ãw
 
dyÇmicd©a_block
<
ET
>(
Ãdges
, (
	gušt8_t
*è
	gedged©a
[blockid], 
	gfsize
);

258 
	gpublic
:

261 
lßd
() {

262 
is_lßded
 = 
Œue
;

263 
	gadjfesize
 = 
g‘_fesize
(
f’ame_adj
);

264 
	ged©afesize
 = 
g‘_sh¬d_ed©a_fesize
<
ET
>(
f’ame_ed©a
);

266 #ifdeà
SUPPORT_DELETIONS


267 
	gasync_šedged©a_lßdšg
 = 
çl£
;

273 
	gadj_£ssiÚ
 = 
iomgr
->
İ’_£ssiÚ
(
f’ame_adj
, 
Œue
);

274 
	giomgr
->
mªaged_m®loc
(
adj_£ssiÚ
, &
adjd©a
, 
adjfesize
, 0);

275 
	gadj_¡»am_£ssiÚ
 = 
¡»amšg_sk
(
iomgr
, 
adj_£ssiÚ
, 
adjfesize
, (**è&
adjd©a
);

277 
	giomgr
->
Ïunch_¡»am_»ad”
(&
adj_¡»am_£ssiÚ
);

279 ià(!
	gÚly_adjaûncy
) {

280 
lßd_ed©a
();

286 
šlše
 
check_¡»am_´og»ss
(
tÜ—d
, 
size_t
 
pos
) {

287 ià(
	gadj_¡»am_£ssiÚ
.
	gcu½os
 =ğ
adjfesize
) ;

289 
	gadj_¡»am_£ssiÚ
.
	gcu½os
 < 
	gtÜ—d
+
	gpos
) {

290 
u¦“p
(20000);

291 ià(
	gadj_¡»am_£ssiÚ
.
	gcu½os
 =ğ
adjfesize
) ;

296 
lßd_v”tiûs
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
¡d
::
veùÜ
<
sv”‹x_t
> & 
´—Îoc
, 
boŞ
 
šedges
=
Œue
, boŞ 
ou‹dges
=true) {

298 
m
.
¡¬t_time
("memoryshard_create_edges");

300 
as£¹
(
adjd©a
 !ğ
NULL
);

303 
ušt8_t
 * 
	g±r
 = 
adjd©a
;

304 
ušt8_t
 * 
	g’d
 = 
±r
 + 
adjfesize
;

305 
vid_t
 
	gvid
 = 0;

306 
	gedg•Œ
 = 0;

308 
	g¡»amšg_off£t
 = 0;

309 
	g¡»amšg_off£t_vid
 = 0;

310 
	g¡»amšg_off£t_edge_±r
 = 0;

311 
	g¿nge_¡¬t_off£t
 = 
adjfesize
;

312 
	g¿nge_¡¬t_edge_±r
 = 
ed©afesize
;

314 
boŞ
 
	g£toff£t
 = 
çl£
;

315 
boŞ
 
	g£Œªgeoff£t
 = 
çl£
;

316 
	g±r
 < 
	g’d
) {

317 
check_¡»am_´og»ss
(6, 
±r
-
adjd©a
);

318 ià(!
	g£toff£t
 && 
	gvid
 > 
	g¿nge_’d
) {

321 
	g¡»amšg_off£t
 = 
±r
-
adjd©a
;

322 
	g¡»amšg_off£t_vid
 = 
vid
;

323 
	g¡»amšg_off£t_edge_±r
 = 
edg•Œ
;

324 
	g£toff£t
 = 
Œue
;

326 ià(!
	g£Œªgeoff£t
 && 
	gvid
>=
¿nge_¡
) {

327 
¿nge_¡¬t_off£t
 = 
±r
-
adjd©a
;

328 
	g¿nge_¡¬t_edge_±r
 = 
edg•Œ
;

329 
	g£Œªgeoff£t
 = 
Œue
;

332 
ušt8_t
 
	gns
 = *
±r
;

333 
	gn
;

335 
	g±r
 +ğ(
ušt8_t
);

337 ià(
	gns
 == 0x00) {

339 
ušt8_t
 
nz
 = *
±r
;

340 
	g±r
 +ğ(
ušt8_t
);

341 
	gvid
++;

342 
	gvid
 +ğ
nz
;

346 ià(
	gns
 == 0xff) {

347 
n
 = *((
ušt32_t
*)
±r
);

348 
	g±r
 +ğ(
ušt32_t
);

350 
	gn
 = 
ns
;

352 
sv”‹x_t
* 
	gv”‹x
 = 
NULL
;

354 ià(
	gvid
>=
wšdow_¡
 && 
vid
 <=
wšdow_’
) {

355 
v”‹x
 = &
´—Îoc
[
vid
-
wšdow_¡
];

356 ià(!
	gv”‹x
->
	gscheduËd
èv”‹x = 
NULL
;

358 
check_¡»am_´og»ss
(
n
 * 4, 
±r
 - 
adjd©a
);

359 
boŞ
 
	gªy_edges
 = 
çl£
;

360 --
	gn
>=0) {

361 
blockid
 = (è(
edg•Œ
 / 
blocksize
);

363 
vid_t
 
	grg‘
 = *((vid_t*è
±r
);

364 
	g±r
 +ğ(
vid_t
);

365 ià(
	gv”‹x
 !ğ
NULL
 && 
ou‹dges
)

367 
check_block_š™Ÿlized
(
blockid
);

368 
	gv”‹x
->
add_ou‹dge
(
rg‘
, (
Úly_adjaûncy
 ? 
NULL
 : 
dyÇmicblocks
[
blockid
]->
edgevec
((
edg•Œ
 % 
blocksize
)/())), 
çl£
);

371 ià(
	grg‘
 >ğ
wšdow_¡
) {

372 ià(
rg‘
 <ğ
wšdow_’
) {

373 ià(
šedges
) {

374 
sv”‹x_t
 & 
d¡v”‹x
 = 
´—Îoc
[
rg‘
 - 
wšdow_¡
];

375 ià(
	gd¡v”‹x
.
	gscheduËd
) {

376 
	gªy_edges
 = 
Œue
;

378 
check_block_š™Ÿlized
(
blockid
);

379 
ET
 * 
	g•Œ
 = (
Úly_adjaûncy
 ? 
NULL
 : 
dyÇmicblocks
[
blockid
]->
edgevec
((
edg•Œ
 % 
blocksize
)/()));

381 
	gd¡v”‹x
.
add_šedge
(
vid
, (
Úly_adjaûncy
 ? 
NULL
 : 
•Œ
), 
çl£
);

382 
	gd¡v”‹x
.
	g·¿Î–_§ã
 = 
d¡v”‹x
.
·¿Î–_§ã
 && (
v”‹x
 =ğ
NULL
);

387 ià(
	gv”‹x
 =ğ
NULL
) {

388 
±r
 +ğ(
vid_t
è* 
n
;

389 
	gedg•Œ
 +ğ(
n
 + 1) * ();

394 
	gedg•Œ
 += ();

398 ià(
	gªy_edges
 && 
	gv”‹x
 !ğ
NULL
) {

399 
v”‹x
->
·¿Î–_§ã
 = 
çl£
;

401 
	gvid
++;

403 
	gm
.
¡İ_time
("memÜysh¬d_ü—‹_edges", 
çl£
);

406 
size_t
 
off£t_fÜ_¡»am_cÚt
() {

407  
	g¡»amšg_off£t
;

409 
vid_t
 
off£t_vid_fÜ_¡»am_cÚt
() {

410  
	g¡»amšg_off£t_vid
;

412 
size_t
 
ed©a_±r_fÜ_¡»am_cÚt
() {

413  
	g¡»amšg_off£t_edge_±r
;

	@src/shards/dynamicdata/slidingshard.hpp

30 #iâdeà
DEF_GRAPHCHI_SLIDINGSHARD


31 
	#DEF_GRAPHCHI_SLIDINGSHARD


	)

34 
	~<io¡»am
>

35 
	~<c¡dio
>

36 
	~<s¡»am
>

37 
	~<veùÜ
>

38 
	~<fú.h
>

39 
	~<uni¡d.h
>

40 
	~<as£¹.h
>

41 
	~<¡ršg
>

43 
	~"­i/g¿ph_objeùs.hµ
"

44 
	~"m‘rics/m‘rics.hµ
"

45 
	~"logg”/logg”.hµ
"

46 
	~"io/¡redio.hµ
"

47 
	~"g¿phchi_ty³s.hµ
"

49 
	~"­i/dyÇmicd©a/chiveùÜ.hµ
"

50 
	~"sh¬ds/dyÇmicd©a/dyÇmicblock.hµ
"

53 
Çme¥aû
 
	gg¿phchi
 {

58 
	g‹m¶©e
 <
ty³Çme
 
	gET
>

59 
	ssblock
 {

61 
	gwr™edesc
;

62 
	g»addesc
;

63 
size_t
 
	goff£t
;

64 
size_t
 
	g’d
;

65 
ušt8_t
 * 
	gd©a
;

66 
ušt8_t
 * 
	g±r
;

67 
boŞ
 
	gaùive
;

68 
boŞ
 
	gis_ed©a_block
;

69 
	g¡d
::
¡ršg
 
blockf’ame
;

70 
	gdyÇmicd©a_block
<
	gET
> * 
	gdynblock
;

72 
sblock
(è: 
wr™edesc
(0), 
»addesc
(0), 
aùive
(
çl£
è{ 
	gd©a
 = 
NULL
; 
	gdynblock
 = NULL; }

73 
sblock
(
wdesc
, 
rdesc
, 
boŞ
 
is_ed©a_block
=
çl£
è: 
wr™edesc
(wdesc), 
»addesc
Ôdesc), 
aùive
(false),

74 
is_ed©a_block
(is_ed©a_block){ 
	gd©a
 = 
NULL
; 
	gdynblock
 = NULL; }

75 
sblock
(
wdesc
, 
rdesc
, 
boŞ
 
is_ed©a_block
, 
¡d
::
¡ršg
 
blockf’ame
è: 
wr™edesc
(wdesc), 
»addesc
Ôdesc), 
aùive
(
çl£
),

76 
is_ed©a_block
(is_ed©a_block), 
blockf’ame
(blockfilename) {

77 
as£¹
(
is_ed©a_block
 =ğ
Œue
);

78 
	gd©a
 = 
NULL
;

79 
	gdynblock
 = 
NULL
;

82 
comm™_async
(
¡redio
 * 
iomgr
) {

83 
comm™_now
(
iomgr
);

84 
»Ëa£
(
iomgr
);

87 
comm™_now
(
¡redio
 * 
iomgr
) {

88 ià(
	gaùive
 && 
	gd©a
 !ğ
NULL
 && 
wr™edesc
 >= 0) {

89 
size_t
 
Ën
 = 
±r
-
d©a
;

90 ià(
	gËn
 > 
	g’d
-
	goff£t
èËÀğ
’d
-
off£t
;

91 ià(
	gis_ed©a_block
) {

92 
ušt8_t
 * 
	goutd©a
 = 
NULL
;

93 
	g»®size
;

94 
	gdynblock
->
wr™e
(&
outd©a
, 
»®size
);

95 
wr™e_block_uncom´es£d_size
(
blockf’ame
, 
»®size
);

96 
	giomgr
->
mªaged_pwr™—_now
(
wr™edesc
, &
outd©a
, 
»®size
, 0);

97 
ä“
(
outd©a
);

99 
	giomgr
->
mªaged_pwr™—_now
(
wr™edesc
, &
d©a
, 
Ën
, 
off£t
);

103 
»ad_async
(
¡redio
 * 
iomgr
) {

104 
as£¹
(
çl£
);

106 
»ad_now
(
¡redio
 * 
iomgr
) {

107 ià(
	gis_ed©a_block
) {

108 
	g»®size
 = 
g‘_block_uncom´es£d_size
(
blockf’ame
, 
’d
-
off£t
);

109 
	giomgr
->
mªaged_´—da_now
(
»addesc
, &
d©a
, 
»®size
, 0);

110 
	gÃdges
 = (
’d
 - 
off£t
) / ();

111 
	gdynblock
 = 
Ãw
 
dyÇmicd©a_block
<
ET
>(
Ãdges
, (
	gušt8_t
 *è
	gd©a
, 
	g»®size
);

113 
	giomgr
->
mªaged_´—da_now
(
»addesc
, &
d©a
, 
’d
 - 
off£t
, offset);

117 
»Ëa£
(
¡redio
 * 
iomgr
) {

118 ià(
	gd©a
 !ğ
NULL
) {

119 
iomgr
->
mªaged_»Ëa£
(
»addesc
, &
d©a
);

121 ià(
	gis_ed©a_block
) {

122 
	giomgr
->
şo£_£ssiÚ
(
»addesc
);

124 ià(
	gdynblock
 !ğ
NULL
) {

125 
d–‘e
 
dynblock
;

126 
	gdynblock
 = 
NULL
;

128 
	gd©a
 = 
NULL
;

134 
	sšdex’Œy
 {

135 
size_t
 
	gadjoff£t
, 
	ged©aoff£t
;

136 
šdex’Œy
(
size_t
 
a
, size_ˆ
e
è: 
adjoff£t
×), 
ed©aoff£t
(e) {}

144 
	g‹m¶©e
 <
ty³Çme
 
	gVT
,y³Çm
	gET
,y³Çm
	gsv”‹x_t
 = 
g¿phchi_v”‹x
<
VT
, ET>,y³Çm
	gET¥ecŸl
 = 
ET
>

145 şas 
	c¦idšg_sh¬d
 {

147 
¡redio
 * 
iomgr
;

149 
	g¡d
::
¡ršg
 
f’ame_ed©a
;

150 
	g¡d
::
¡ršg
 
f’ame_adj
;

151 
vid_t
 
	g¿nge_¡
, 
	g¿nge_’d
;

152 
size_t
 
	gblocksize
;

154 
vid_t
 
	gcurvid
;

155 
size_t
 
	gadjoff£t
, 
	ged©aoff£t
, 
	gadjfesize
, 
	ged©afesize
;

156 
size_t
 
	gwšdow_¡¬t_ed©aoff£t
;

158 
	g¡d
::
veùÜ
<
sblock
<
ET
> > 
aùiveblocks
;

159 
	gadjfe_£ssiÚ
;

160 
	gwr™edesc
;

161 
	gsblock
<
	gET
> * 
	gcurblock
;

162 
	gsblock
<
	gET
> * 
	gcu¿djblock
;

163 
	gm‘rics
 &
	gm
;

165 
	g¡d
::
m­
<, 
	gšdex’Œy
> 
	g¥¬£_šdex
;

166 
boŞ
 
	gdi§bË_wr™es
;

167 
boŞ
 
	gasync_ed©a_lßdšg
;

171 
	gpublic
:

172 
boŞ
 
Úly_adjaûncy
;

174 
¦idšg_sh¬d
(
¡redio
 * 
iomgr
, 
¡d
::
¡ršg
 
_f’ame_ed©a
, std::¡ršg 
_f’ame_adj
, 
vid_t
 
_¿nge_¡
, vid_ˆ
_¿nge_’
, 
size_t
 
_blocksize
, 
m‘rics
 &
_m
,

175 
boŞ
 
_di§bË_wr™es
=
çl£
, boŞ 
Úlyadj
 = false) :

176 
iomgr
(iomgr),

177 
f’ame_ed©a
(
_f’ame_ed©a
),

178 
f’ame_adj
(
_f’ame_adj
),

179 
¿nge_¡
(
_¿nge_¡
),

180 
¿nge_’d
(
_¿nge_’
),

181 
blocksize
(
_blocksize
),

182 
m
(
_m
),

183 
di§bË_wr™es
(
_di§bË_wr™es
) {

184 
	gcurvid
 = 0;

185 
	gadjoff£t
 = 0;

186 
	ged©aoff£t
 = 0;

187 
	gdi§bË_wr™es
 = 
çl£
;

188 
	gÚly_adjaûncy
 = 
Úlyadj
;

189 
	gcurblock
 = 
NULL
;

190 
	gcu¿djblock
 = 
NULL
;

191 
	gwšdow_¡¬t_ed©aoff£t
 = 0;

194 
	gblocksize
 % (è!ğ0è
blocksize
++;

195 
as£¹
(
blocksize
 % ()==0);

197 
	gadjfesize
 = 
g‘_fesize
(
f’ame_adj
);

198 
	ged©afesize
 = 
g‘_sh¬d_ed©a_fesize
<>(
f’ame_ed©a
);

199 ià(!
	gÚly_adjaûncy
) {

200 
log¡»am
(
LOG_DEBUG
è<< "TÙ®ƒdgd©¨size: " << 
	ged©afesize
 << 
	g¡d
::
’dl
;

205 
	gadjfe_£ssiÚ
 = 
iomgr
->
İ’_£ssiÚ
(
f’ame_adj
, 
Œue
);

206 
§ve_off£t
();

208 
	gasync_ed©a_lßdšg
 = 
çl£
;

212 ~
¦idšg_sh¬d
() {

213 
»Ëa£_´iÜ_to_off£t
(
Œue
);

214 ià(
	gcurblock
 !ğ
NULL
) {

215 
curblock
->
»Ëa£
(
iomgr
);

216 
d–‘e
 
	gcurblock
;

217 
	gcurblock
 = 
NULL
;

219 ià(
	gcu¿djblock
 !ğ
NULL
) {

220 
cu¿djblock
->
»Ëa£
(
iomgr
);

221 
d–‘e
 
	gcu¿djblock
;

222 
	gcu¿djblock
 = 
NULL
;

226 
	giomgr
->
şo£_£ssiÚ
(
adjfe_£ssiÚ
);

230 
size_t
 
num_edges
() {

231  
	ged©afesize
 / (
	gET
);

234 
	g´Ùeùed
:

235 
size_t
 
g‘_adjoff£t
(è{  
adjoff£t
; }

236 
size_t
 
g‘_ed©aoff£t
(è{  
	ged©aoff£t
; }

238 
§ve_off£t
() {

241 
	g¥¬£_šdex
.
š£¹
(
¡d
::
·œ
<, 
šdex’Œy
>(-(()
curvid
), index’Œy(
adjoff£t
, 
ed©aoff£t
)));

244 
move_şo£_to
(
vid_t
 
v
) {

245 ià(
	gcurvid
 >ğ
v
) ;

247 
	g¡d
::
m­
<,
	gšdex’Œy
>::
™”©Ü
 
low”bd_™”
 = 
¥¬£_šdex
.
low”_bound
(-(()
v
));

248 
	gşo£¡_vid
 = -(()
low”bd_™”
->
fœ¡
);

249 
as£¹
(
şo£¡_vid
>=0);

250 
šdex’Œy
 
	gşo£¡_off£t
 = 
low”bd_™”
->
£cÚd
;

251 
as£¹
(
şo£¡_vid
 <ğ()
v
);

252 ià(
	gşo£¡_vid
 > ()
	gcurvid
) {

253 
log¡»am
(
LOG_DEBUG
)

254 << "Slidšg sh¬d, s¹: " << 
	g¿nge_¡
 << " movedo: " << 
	gşo£¡_vid
 << " " << 
	gşo£¡_off£t
.
	gadjoff£t
 << ",‡sked fÜ : " << 
	gv
 << " wa š: curvidğ" << 
	gcurvid
 << " " <<‡djoff£ˆ<< 
	g¡d
::
’dl
;

255 ià(
	gcurblock
 !ğ
NULL
)

256 
curblock
->
±r
 +ğ
şo£¡_off£t
.
ed©aoff£t
 -ƒdataoffset;

257 ià(
	gcu¿djblock
 !ğ
NULL
)

258 
cu¿djblock
->
±r
 +ğ
şo£¡_off£t
.
adjoff£t
 -‡djoffset;

259 
	gcurvid
 = (
vid_t
)
şo£¡_vid
;

260 
	gadjoff£t
 = 
şo£¡_off£t
.
adjoff£t
;

261 
	ged©aoff£t
 = 
şo£¡_off£t
.
ed©aoff£t
;

270 
šlše
 
check_curblock
(
size_t
 
tÜ—d
) {

271 ià(
	gcurblock
 =ğ
NULL
 || 
curblock
->
’d
 < 
ed©aoff£t
+
tÜ—d
) {

272 ià(
curblock
 !ğ
NULL
) {

273 ià(!
curblock
->
aùive
) {

274 
curblock
->
»Ëa£
(
iomgr
);

278 
	g¡d
::
¡ršg
 
blockf’ame
 = 
f’ame_sh¬d_ed©a_block
(
f’ame_ed©a
, (è(
ed©aoff£t
 / 
blocksize
), blocksize);

279 
	ged©a_£ssiÚ
 = 
iomgr
->
İ’_£ssiÚ
(
blockf’ame
, 
çl£
, 
Œue
);

280 
	gsblock
<
	gET
> 
Ãwblock
(
ed©a_£ssiÚ
,ƒd©a_£ssiÚ, 
Œue
, 
blockf’ame
);

284 
	gÃwblock
.
	goff£t
 = (
ed©aoff£t
 / 
blocksize
) * blocksize;

285 
size_t
 
	gcÜ»ùiÚ
 = 
ed©aoff£t
 - 
Ãwblock
.
off£t
;

286 
	gÃwblock
.
	g’d
 = 
¡d
::
mš
(
ed©afesize
, 
Ãwblock
.
off£t
 + 
blocksize
);

287 
as£¹
(
Ãwblock
.
’d
 >ğÃwblock.
off£t
);

288 
	g»®size
 = 
g‘_block_uncom´es£d_size
(
blockf’ame
, 
Ãwblock
.
’d
 -‚ewblock.
off£t
);

289 
	giomgr
->
mªaged_m®loc
(
ed©a_£ssiÚ
, &
Ãwblock
.
d©a
, 
»®size
,‚ewblock.
off£t
);

290 
	gÃwblock
.
	g±r
 = 
Ãwblock
.
d©a
 + 
cÜ»ùiÚ
;

291 
	gaùiveblocks
.
push_back
(
Ãwblock
);

292 
	gcurblock
 = &
aùiveblocks
[aùiveblocks.
size
()-1];

293 
	gcurblock
->
	gaùive
 = 
Œue
;

294 
	gcurblock
->
»ad_now
(
iomgr
);

298 
šlše
 
check_adjblock
(
size_t
 
tÜ—d
) {

299 ià(
	gcu¿djblock
 =ğ
NULL
 || 
cu¿djblock
->
’d
 <ğ
adjoff£t
 + 
tÜ—d
) {

300 ià(
cu¿djblock
 !ğ
NULL
) {

301 
cu¿djblock
->
»Ëa£
(
iomgr
);

302 
d–‘e
 
	gcu¿djblock
;

303 
	gcu¿djblock
 = 
NULL
;

305 
	gsblock
<
	gET
> * 
	gÃwblock
 = 
Ãw
 
sblock
<
ET
>(0, 
	gadjfe_£ssiÚ
);

306 
	gÃwblock
->
	goff£t
 = 
adjoff£t
;

307 
	gÃwblock
->
	g’d
 = 
¡d
::
mš
(
adjfesize
, 
adjoff£t
+
blocksize
);

308 
as£¹
(
Ãwblock
->
’d
 > 0);

309 
as£¹
(
Ãwblock
->
’d
 >ğÃwblock->
off£t
);

310 
	giomgr
->
mªaged_m®loc
(
adjfe_£ssiÚ
, &
Ãwblock
->
d©a
,‚ewblock->
’d
 -‚ewblock->
off£t
, 
adjoff£t
);

311 
	gÃwblock
->
	g±r
 = 
Ãwblock
->
d©a
;

312 
m‘rics_’Œy
 
	gme
 = 
m
.
¡¬t_time
();

313 
	giomgr
->
mªaged_´—da_now
(
adjfe_£ssiÚ
, &
Ãwblock
->
d©a
,‚ewblock->
’d
 -‚ewblock->
off£t
, 
adjoff£t
);

314 
	gm
.
¡İ_time
(
me
, "blockload");

315 
	gcu¿djblock
 = 
Ãwblock
;

319 
	g‹m¶©e
 <
ty³Çme
 
	gU
>

320 
šlše
 
U
 
»ad_v®
() {

321 
check_adjblock
((
U
));

322 
U
 
	g»s
 = *((U*)
cu¿djblock
->
±r
);

323 
	gadjoff£t
 +ğ(
U
);

324 
	gcu¿djblock
->
	g±r
 +ğ(
U
);

325  
	g»s
;

328 
šlše
 
ET
 * 
»ad_edg•Œ
() {

329 ià(
	gÚly_adjaûncy
è 
	gNULL
;

330 
check_curblock
(());

331 
	ged©aoff£t
 += ();

332 
	gblockedgeidx
 = (
curblock
->
±r
 - curblock->
d©a
) / ();

333 
	gcurblock
->
	g±r
 += ();

334 
as£¹
(
curblock
->
dynblock
 !ğ
NULL
);

335  
	gcurblock
->
	gdynblock
->
edgevec
(
blockedgeidx
);

338 
šlše
 
sk
(
n
, 
sz
) {

339 
size_t
 
	gtÙ
 = 
n
 * 
sz
;

340 
	gadjoff£t
 +ğ
tÙ
;

341 ià(
	gcu¿djblock
 !ğ
NULL
)

342 
cu¿djblock
->
±r
 +ğ
tÙ
;

343 
	ged©aoff£t
 +ğ(è* 
n
;

344 ià(
	gcurblock
 !ğ
NULL
)

345 
curblock
->
±r
 +ğ(è* 
n
;

348 
	gpublic
:

352 
»ad_Ãxt_v”tiûs
(
nvecs
, 
vid_t
 
¡¬t
, 
¡d
::
veùÜ
<
sv”‹x_t
> & 
´—Îoc
, 
boŞ
 
»cÜd_šdex
=
çl£
, boŞ 
di§bË_wr™es
=false) {

353 
m‘rics_’Œy
 
me
 = 
m
.
¡¬t_time
();

354 ià(!
	g»cÜd_šdex
)

355 
move_şo£_to
(
¡¬t
);

358 
	gcurblock
 = 
NULL
;

359 
»Ëa£_´iÜ_to_off£t
(
çl£
, 
di§bË_wr™es
);

360 
as£¹
(
aùiveblocks
.
size
() <= 1);

363 ià(!
	gaùiveblocks
.
em±y
(è&& !
	gÚly_adjaûncy
) {

364 
	gcurblock
 = &
aùiveblocks
[0];

366 
vid_t
 
	gÏ¡»c
 = 
¡¬t
;

367 
	gwšdow_¡¬t_ed©aoff£t
 = 
ed©aoff£t
;

369 
	gi
=(()
curvid
è- (()
¡¬t
); i<
	gnvecs
; i++) {

370 ià(
	gadjoff£t
 >ğ
adjfesize
) ;

374 
	gn
;

375 ià(
	g»cÜd_šdex
 && (
	gsize_t
)(
	gcurvid
 - 
	gÏ¡»c
è>ğ(
size_t
è
¡d
::
max
(()100000, 
nvecs
/16)) {

376 
§ve_off£t
();

377 
	gÏ¡»c
 = 
curvid
;

379 
ušt8_t
 
	gns
 = 
»ad_v®
<uint8_t>();

380 ià(
	gns
 == 0x00) {

381 
curvid
++;

382 
ušt8_t
 
	gnz
 = 
»ad_v®
<uint8_t>();

383 
	gcurvid
 +ğ
nz
;

384 
	gi
 +ğ
nz
;

388 ià(
	gns
 == 0xff) {

389 
n
 = 
»ad_v®
<
ušt32_t
>();

391 
	gn
 = 
ns
;

394 ià(
	gi
<0) {

396 
sk
(
n
, (
vid_t
));

398 
	gsv”‹x_t
& 
	gv”‹x
 = 
´—Îoc
[
i
];

399 
as£¹
(
v”‹x
.
id
(è=ğ
curvid
);

401 ià(
	gv”‹x
.
	gscheduËd
) {

403 --
	gn
 >= 0) {

404 
boŞ
 
¥ecŸl_edge
 = 
çl£
;

405 
vid_t
 
	grg‘
 = ((
ET
è=ğ(
ET¥ecŸl
è? 
»ad_v®
<vid_t>(è: 
Œª¦©e_edge
Ô—d_v®<vid_t>(), 
¥ecŸl_edge
));

406 
ET
 * 
	gev®ue
 = 
»ad_edg•Œ
();

409 
	gv”‹x
.
add_ou‹dge
(
rg‘
, 
ev®ue
, 
¥ecŸl_edge
);

411 ià(!((
	grg‘
 >ğ
¿nge_¡
 && 
rg‘
 <ğ
¿nge_’d
))) {

412 
log¡»am
(
LOG_ERROR
è<< "E¼Ü : " << 
rg‘
 << "‚Ù iÀ[" << 
¿nge_¡
 << " - " << 
¿nge_’d
 << "]" << 
¡d
::
’dl
;

413 
	giomgr
->
´št_£ssiÚ
(
adjfe_£ssiÚ
);

415 
as£¹
(
rg‘
 >ğ
¿nge_¡
 &&¬g‘ <ğ
¿nge_’d
);

420 
sk
(
n
, (
vid_t
));

423 
	gcurvid
++;

425 
	gm
.
¡İ_time
(
me
, "read_next_vertices");

426 
	gcurblock
 = 
NULL
;

433 
comm™
(
sblock
<
ET
> &
b
, 
boŞ
 
synchrÚou¦y
, boŞ 
di§bË_wr™es
=
çl£
) {

434 ià(
synchrÚou¦y
) {

435 
m‘rics_’Œy
 
me
 = 
m
.
¡¬t_time
();

436 ià(!
	gdi§bË_wr™es
è
	gb
.
comm™_now
(
iomgr
);

437 
	gm
.
¡İ_time
(
me
, "commit");

438 
	gb
.
»Ëa£
(
iomgr
);

440 ià(!
	gdi§bË_wr™es
è
	gb
.
comm™_async
(
iomgr
);

441 
	gb
.
»Ëa£
(
iomgr
);

448 
æush
() {

449 
»Ëa£_´iÜ_to_off£t
(
Œue
);

450 ià(
	gcu¿djblock
 !ğ
NULL
) {

451 
cu¿djblock
->
»Ëa£
(
iomgr
);

452 
d–‘e
 
	gcu¿djblock
;

453 
	gcu¿djblock
 = 
NULL
;

460 
£t_off£t
(
size_t
 
Ãwoff
, 
vid_t
 
_curvid
, size_ˆ
edg•Œ
) {

461 
	gthis
->
	gadjoff£t
 = 
Ãwoff
;

462 
	gthis
->
	gcurvid
 = 
_curvid
;

463 
	gthis
->
	ged©aoff£t
 = 
edg•Œ
;

464 ià(
	gcu¿djblock
 !ğ
NULL
) {

465 
cu¿djblock
->
»Ëa£
(
iomgr
);

466 
d–‘e
 
	gcu¿djblock
;

467 
	gcu¿djblock
 = 
NULL
;

474 
»Ëa£_´iÜ_to_off£t
(
boŞ
 
®l
=
çl£
, boŞ 
di§bË_wr™es
=false) {

475 
i
=()
aùiveblocks
.
size
(è- 1; 
	gi
 >= 0; i--) {

476 
	gsblock
<
	gET
> &
	gb
 = 
aùiveblocks
[
i
];

477 ià(
	gb
.
	g’d
 <ğ
ed©aoff£t
 || 
®l
) {

478 
comm™
(
b
, 
®l
, 
di§bË_wr™es
);

479 
	gaùiveblocks
.
”a£
(
aùiveblocks
.
begš
(è+ ()
i
);

484 
	g¡d
::
¡ršg
 
g‘_šfo_jsÚ
() {

485 
¡d
::
¡ršg¡»am
 
jsÚ
;

486 
	gjsÚ
 << "\"size\": ";

487 
	gjsÚ
 << 
	ged©afesize
 << 
	g¡d
::
’dl
;

488 
	gjsÚ
 << ", \"windowStart\": ";

489 
	gjsÚ
 << 
	gwšdow_¡¬t_ed©aoff£t
;

490 
	gjsÚ
 << ", \"windowEnd\": ";

491 
	gjsÚ
 << 
	ged©aoff£t
;

492 
	gjsÚ
 << ", \"intervalStart\": ";

493 
	gjsÚ
 << 
	g¿nge_¡
;

494 
	gjsÚ
 << ", \"intervalEnd\": ";

495 
	gjsÚ
 << 
	g¿nge_’d
;

496  
	gjsÚ
.
¡r
();

	@src/shards/memoryshard.hpp

29 #ifdeà
DYNAMICEDATA


30 
	~"sh¬ds/dyÇmicd©a/memÜysh¬d.hµ
"

33 #iâdeà
DEF_GRAPHCHI_MEMSHARD


34 
	#DEF_GRAPHCHI_MEMSHARD


	)

37 
	~<io¡»am
>

38 
	~<c¡dio
>

39 
	~<s¡»am
>

40 
	~<veùÜ
>

41 
	~<fú.h
>

42 
	~<uni¡d.h
>

43 
	~<as£¹.h
>

44 
	~<¡ršg
>

46 
	~"­i/g¿ph_objeùs.hµ
"

47 
	~"m‘rics/m‘rics.hµ
"

48 
	~"io/¡redio.hµ
"

49 
	~"g¿phchi_ty³s.hµ
"

52 
Çme¥aû
 
	gg¿phchi
 {

55 
	g‹m¶©e
 <
ty³Çme
 
	gVT
,y³Çm
	gET
,y³Çm
	gsv”‹x_t
 = 
g¿phchi_v”‹x
<
VT
, ET> >

56 şas 
	cmemÜy_sh¬d
 {

58 
¡redio
 * 
	giomgr
;

60 
	g¡d
::
¡ršg
 
f’ame_ed©a
;

61 
	g¡d
::
¡ršg
 
f’ame_adj
;

63 
vid_t
 
	g¿nge_¡
;

64 
vid_t
 
	g¿nge_’d
;

65 
size_t
 
	gadjfesize
;

66 
size_t
 
	ged©afesize
;

68 
size_t
 
	gedg•Œ
;

69 
vid_t
 
	g¡»amšg_off£t_vid
;

70 
size_t
 
	g¡»amšg_off£t
;

71 
size_t
 
	g¿nge_¡¬t_off£t
;

72 
size_t
 
	g¿nge_¡¬t_edge_±r
;

73 
size_t
 
	g¡»amšg_off£t_edge_±r
;

74 
ušt8_t
 * 
	gadjd©a
;

75 ** 
	gedged©a
;

76 * 
	gdÚ•Œ
;

77 
	g¡d
::
veùÜ
<
size_t
> 
blocksizes
;

78 
ušt64_t
 
	gchunkid
;

80 
	g¡d
::
veùÜ
<> 
block_ed©a£ssiÚs
;

81 
	gadj_£ssiÚ
;

82 
¡»amšg_sk
 
	gadj_¡»am_£ssiÚ
;

84 
boŞ
 
	gasync_ed©a_lßdšg
;

85 
boŞ
 
	gis_lßded
;

86 
size_t
 
	gblocksize
;

87 
	gm‘rics
 &
	gm
;

89 
	gpublic
:

90 
boŞ
 
Úly_adjaûncy
;

92 
memÜy_sh¬d
(
¡redio
 * 
iomgr
,

93 
¡d
::
¡ršg
 
_f’ame_ed©a
,

94 
¡d
::
¡ršg
 
_f’ame_adj
,

95 
vid_t
 
_¿nge_¡¬t
,

96 
vid_t
 
_¿nge_’d
,

97 
size_t
 
_blocksize
,

98 
m‘rics
 &
_m
è: 
iomgr
(iomgr), 
f’ame_ed©a
(
_f’ame_ed©a
),

99 
f’ame_adj
(
_f’ame_adj
),

100 
¿nge_¡
(
_¿nge_¡¬t
), 
¿nge_’d
(
_¿nge_’d
), 
blocksize
(
_blocksize
), 
m
(
_m
) {

101 
	gadjd©a
 = 
NULL
;

102 
	gÚly_adjaûncy
 = 
çl£
;

103 
	gis_lßded
 = 
çl£
;

104 
	gadj_£ssiÚ
 = -1;

105 
	gedged©a
 = 
NULL
;

106 
	gdÚ•Œ
 = 
NULL
;

107 
	gasync_ed©a_lßdšg
 = !
sv”‹x_t
().
computiÚ®_edges
();

108 #ifdeà
SUPPORT_DELETIONS


109 
	gasync_ed©a_lßdšg
 = 
çl£
;

113 ~
memÜy_sh¬d
() {

114 
	gnblocks
 = (è
block_ed©a£ssiÚs
.
size
();

116 
	gi
=0; i < 
	gnblocks
; i++) {

117 ià(
	gedged©a
[
i
] !ğ
NULL
) {

118 
iomgr
->
mªaged_»Ëa£
(
block_ed©a£ssiÚs
[
i
], &
edged©a
[i]);

119 
	giomgr
->
şo£_£ssiÚ
(
block_ed©a£ssiÚs
[
i
]);

122 ià(
	gadj_£ssiÚ
 >= 0) {

123 ià(
adjd©a
 !ğ
NULL
è
iomgr
->
mªaged_»Ëa£
(
adj_£ssiÚ
, &adjdata);

124 
	giomgr
->
şo£_£ssiÚ
(
adj_£ssiÚ
);

126 ià(
	gedged©a
 !ğ
NULL
)

127 
ä“
(
edged©a
);

128 
	gedged©a
 = 
NULL
;

129 ià(
	gdÚ•Œ
 !ğ
NULL
) {

130 
ä“
(
dÚ•Œ
);

134 
comm™
(
boŞ
 
comm™_šedges
, boŞ 
comm™_ou‹dges
) {

135 ià(
	gblock_ed©a£ssiÚs
.
size
(è=ğ0 || 
Úly_adjaûncy
) ;

136 
as£¹
(
is_lßded
);

137 
m‘rics_’Œy
 
	gcm
 = 
m
.
¡¬t_time
();

145 
	gnblocks
 = (è
block_ed©a£ssiÚs
.
size
();

147 ià(
	gcomm™_šedges
) {

148 
	g¡¬t_¡»am_block
 = (è(
¿nge_¡¬t_edge_±r
 / 
blocksize
);

150 
	gi
=0; i < 
	gnblocks
; i++) {

153 ià(
	gi
 >ğ
¡¬t_¡»am_block
) {

154 
iomgr
->
mªaged_pwr™—_now
(
block_ed©a£ssiÚs
[
i
], &
edged©a
[i], 
blocksizes
[i], 0);

155 
	giomgr
->
mªaged_»Ëa£
(
block_ed©a£ssiÚs
[
i
], &
edged©a
[i]);

156 
	giomgr
->
şo£_£ssiÚ
(
block_ed©a£ssiÚs
[
i
]);

158 
	gedged©a
[
i
] = 
NULL
;

161 
	giomgr
->
mªaged_pwr™—_async
(
block_ed©a£ssiÚs
[
i
], &
edged©a
[i], 
blocksizes
[i], 0, 
Œue
,rue);

162 
	gedged©a
[
i
] = 
NULL
;

165 } ià(
	gcomm™_ou‹dges
) {

166 
size_t
 
	gÏ¡
 = 
¡»amšg_off£t_edge_±r
;

167 ià(
	gÏ¡
 == 0){

169 
Ï¡
 = 
ed©afesize
;

172 
	g¡¬tblock
 = (è(
¿nge_¡¬t_edge_±r
 / 
blocksize
);

173 
	g’dblock
 = (è(
Ï¡
 / 
blocksize
);

174 
	gi
=0; i < 
	gnblocks
; i++) {

175 ià(
	gi
 >ğ
¡¬tblock
 && 
i
 <ğ
’dblock
) {

176 
iomgr
->
mªaged_pwr™—_now
(
block_ed©a£ssiÚs
[
i
], &
edged©a
[i], 
blocksizes
[i], 0);

178 
	giomgr
->
mªaged_»Ëa£
(
block_ed©a£ssiÚs
[
i
], &
edged©a
[i]);

179 
	gedged©a
[
i
] = 
NULL
;

180 
	giomgr
->
şo£_£ssiÚ
(
block_ed©a£ssiÚs
[
i
]);

183 
	gi
=0; i < 
	gnblocks
; i++) {

184 
	giomgr
->
şo£_£ssiÚ
(
block_ed©a£ssiÚs
[
i
]);

188 
	gm
.
¡İ_time
(
cm
, "memshard_commit");

190 
	giomgr
->
mªaged_»Ëa£
(
adj_£ssiÚ
, &
adjd©a
);

192 
	gi
=0; i < 
	gnblocks
; i++) {

193 ià(
	gedged©a
[
i
] !ğ
NULL
) {

194 
iomgr
->
mªaged_»Ëa£
(
block_ed©a£ssiÚs
[
i
], &
edged©a
[i]);

197 
	gblock_ed©a£ssiÚs
.
ş—r
();

198 
	gis_lßded
 = 
çl£
;

201 
boŞ
 
lßded
() {

202  
	gis_lßded
;

205 
	g´iv©e
:

207 
lßd_ed©a
() {

208 
as£¹
(
blocksize
 % (
ET
) == 0);

209 
	gnblocks
 = (è(
ed©afesize
 / 
blocksize
 + (edatafilesize % blocksize != 0));

210 
	gedged©a
 = (**è
ÿÎoc
(
nblocks
, (*));

211 
size_t
 
	gcom´es£dsize
 = 0;

212 
	gblockid
 = 0;

214 ià(!
	gasync_ed©a_lßdšg
) {

215 
	gdÚ•Œ
 = (*è
m®loc
(
nblocks
 * ());

216 
	gi
=0; i < 
	gnblocks
; i++è
	gdÚ•Œ
[
i
] = 1;

219 
	gŒue
) {

220 
	g¡d
::
¡ršg
 
block_f’ame
 = 
f’ame_sh¬d_ed©a_block
(
f’ame_ed©a
, 
blockid
, 
blocksize
);

221 ià(
fe_exi¡s
(
block_f’ame
)) {

222 
size_t
 
	gfsize
 = 
¡d
::
mš
(
ed©afesize
 - 
blocksize
 * 
blockid
, blocksize);

224 
	gcom´es£dsize
 +ğ
g‘_fesize
(
block_f’ame
);

225 
	gblock£ssiÚ
 = 
iomgr
->
İ’_£ssiÚ
(
block_f’ame
, 
çl£
, 
Œue
);

226 
	gblock_ed©a£ssiÚs
.
push_back
(
block£ssiÚ
);

227 
	gblocksizes
.
push_back
(
fsize
);

229 
	gedged©a
[
blockid
] = 
NULL
;

230 
	giomgr
->
mªaged_m®loc
(
block£ssiÚ
, &
edged©a
[
blockid
], 
fsize
, 0);

231 ià(
	gasync_ed©a_lßdšg
) {

232 
	giomgr
->
mªaged_´—da_async
(
block£ssiÚ
, &
edged©a
[
blockid
], 
fsize
, 0);

234 
	giomgr
->
mªaged_´—da_async
(
block£ssiÚ
, &
edged©a
[
blockid
], 
fsize
, 0, (vŞ©*)&
dÚ•Œ
[blockid]);

236 
	gblockid
++;

239 ià(
	gblockid
 == 0) {

240 
log¡»am
(
LOG_ERROR
è<< "Sh¬d block fdid‚Ùƒxi¡s:" << 
block_f’ame
 << 
¡d
::
’dl
;

245 
log¡»am
(
LOG_DEBUG
è<< "Com´es£d/fuÎ size: " << 
	gcom´es£dsize
 * 1.0 / 
	ged©afesize
 <<

246 "‚umb” oàblocks: " << 
	gnblocks
 << 
	g¡d
::
’dl
;

247 
as£¹
(
blockid
 =ğ
nblocks
);

252 
	gpublic
:

255 
lßd
() {

256 
is_lßded
 = 
Œue
;

257 
	gadjfesize
 = 
g‘_fesize
(
f’ame_adj
);

259 #ifdeà
SUPPORT_DELETIONS


260 
	gasync_ed©a_lßdšg
 = 
çl£
;

266 
	gadj_£ssiÚ
 = 
iomgr
->
İ’_£ssiÚ
(
f’ame_adj
, 
Œue
);

267 
	giomgr
->
mªaged_m®loc
(
adj_£ssiÚ
, &
adjd©a
, 
adjfesize
, 0);

268 
	gadj_¡»am_£ssiÚ
 = 
¡»amšg_sk
(
iomgr
, 
adj_£ssiÚ
, 
adjfesize
, (**è&
adjd©a
);

270 
	giomgr
->
Ïunch_¡»am_»ad”
(&
adj_¡»am_£ssiÚ
);

272 ià(!
	gÚly_adjaûncy
) {

273 
	ged©afesize
 = 
g‘_sh¬d_ed©a_fesize
<
ET
>(
f’ame_ed©a
);

274 
lßd_ed©a
();

280 
šlše
 
check_¡»am_´og»ss
(
tÜ—d
, 
size_t
 
pos
) {

281 ià(
	gadj_¡»am_£ssiÚ
.
	gcu½os
 =ğ
adjfesize
) ;

283 
	gadj_¡»am_£ssiÚ
.
	gcu½os
 < 
	gtÜ—d
+
	gpos
) {

284 
u¦“p
(20000);

285 ià(
	gadj_¡»am_£ssiÚ
.
	gcu½os
 =ğ
adjfesize
) ;

289 
lßd_v”tiûs
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
¡d
::
veùÜ
<
sv”‹x_t
> & 
´—Îoc
, 
boŞ
 
šedges
=
Œue
, boŞ 
ou‹dges
=true) {

291 
m
.
¡¬t_time
("memoryshard_create_edges");

293 
as£¹
(
adjd©a
 !ğ
NULL
);

296 
ušt8_t
 * 
	g±r
 = 
adjd©a
;

297 
ušt8_t
 * 
	g’d
 = 
±r
 + 
adjfesize
;

298 
vid_t
 
	gvid
 = 0;

299 
	gedg•Œ
 = 0;

301 
	g¡»amšg_off£t
 = 0;

302 
	g¡»amšg_off£t_vid
 = 0;

303 
	g¡»amšg_off£t_edge_±r
 = 0;

304 
	g¿nge_¡¬t_off£t
 = 
adjfesize
;

305 
	g¿nge_¡¬t_edge_±r
 = 
ed©afesize
;

307 
boŞ
 
	g£toff£t
 = 
çl£
;

308 
boŞ
 
	g£Œªgeoff£t
 = 
çl£
;

309 
	g±r
 < 
	g’d
) {

310 
check_¡»am_´og»ss
(6, 
±r
-
adjd©a
);

311 ià(!
	g£toff£t
 && 
	gvid
 > 
	g¿nge_’d
) {

314 
	g¡»amšg_off£t
 = 
±r
-
adjd©a
;

315 
	g¡»amšg_off£t_vid
 = 
vid
;

316 
	g¡»amšg_off£t_edge_±r
 = 
edg•Œ
;

317 
	g£toff£t
 = 
Œue
;

319 ià(!
	g£Œªgeoff£t
 && 
	gvid
>=
¿nge_¡
) {

320 
¿nge_¡¬t_off£t
 = 
±r
-
adjd©a
;

321 
	g¿nge_¡¬t_edge_±r
 = 
edg•Œ
;

322 
	g£Œªgeoff£t
 = 
Œue
;

325 
ušt8_t
 
	gns
 = *
±r
;

326 
	gn
;

328 
	g±r
 +ğ(
ušt8_t
);

330 ià(
	gns
 == 0x00) {

332 
ušt8_t
 
nz
 = *
±r
;

333 
	g±r
 +ğ(
ušt8_t
);

334 
	gvid
++;

335 
	gvid
 +ğ
nz
;

339 ià(
	gns
 == 0xff) {

340 
n
 = *((
ušt32_t
*)
±r
);

341 
	g±r
 +ğ(
ušt32_t
);

343 
	gn
 = 
ns
;

345 
sv”‹x_t
* 
	gv”‹x
 = 
NULL
;

347 ià(
	gvid
>=
wšdow_¡
 && 
vid
 <=
wšdow_’
) {

348 
v”‹x
 = &
´—Îoc
[
vid
-
wšdow_¡
];

349 ià(!
	gv”‹x
->
	gscheduËd
èv”‹x = 
NULL
;

351 
check_¡»am_´og»ss
(
n
 * 4, 
±r
 - 
adjd©a
);

352 
boŞ
 
	gªy_edges
 = 
çl£
;

353 --
	gn
>=0) {

354 
blockid
 = (è(
edg•Œ
 / 
blocksize
);

355 ià(!
	gasync_ed©a_lßdšg
 && !
	gÚly_adjaûncy
) {

357 
	gdÚ•Œ
[
edg•Œ
 / 
blocksize
] !ğ0è{ 
u¦“p
(10); }

360 
vid_t
 
	grg‘
 = *((vid_t*è
±r
);

361 
	g±r
 +ğ(
vid_t
);

362 ià(
	gv”‹x
 !ğ
NULL
 && 
ou‹dges
)

364 * 
•Œ
 = (
Úly_adjaûncy
 ? 
NULL
 : &(
edged©a
[
blockid
][
edg•Œ
 % 
blocksize
]));

365 
	gv”‹x
->
add_ou‹dge
(
rg‘
, (
Úly_adjaûncy
 ? 
NULL
 : (
ET
*è
•Œ
), 
çl£
);

368 ià(
	grg‘
 >ğ
wšdow_¡
) {

369 ià(
rg‘
 <ğ
wšdow_’
) {

370 ià(
šedges
) {

371 
sv”‹x_t
 & 
d¡v”‹x
 = 
´—Îoc
[
rg‘
 - 
wšdow_¡
];

372 ià(
	gd¡v”‹x
.
	gscheduËd
) {

373 
	gªy_edges
 = 
Œue
;

375 * 
	g•Œ
 = (
Úly_adjaûncy
 ? 
NULL
 : &(
edged©a
[
blockid
][
edg•Œ
 % 
blocksize
]));

377 
	gd¡v”‹x
.
add_šedge
(
vid
, (
Úly_adjaûncy
 ? 
NULL
 : (
ET
*è
•Œ
), 
çl£
);

378 
	gd¡v”‹x
.
	g·¿Î–_§ã
 = 
d¡v”‹x
.
·¿Î–_§ã
 && (
v”‹x
 =ğ
NULL
);

383 ià(
	gv”‹x
 =ğ
NULL
) {

384 
±r
 +ğ(
vid_t
è* 
n
;

385 
	gedg•Œ
 +ğ(
n
 + 1è* (
ET
);

390 
	gedg•Œ
 +ğ(
ET
);

394 ià(
	gªy_edges
 && 
	gv”‹x
 !ğ
NULL
) {

395 
v”‹x
->
·¿Î–_§ã
 = 
çl£
;

397 
	gvid
++;

399 
	gm
.
¡İ_time
("memÜysh¬d_ü—‹_edges", 
çl£
);

402 
size_t
 
off£t_fÜ_¡»am_cÚt
() {

403  
	g¡»amšg_off£t
;

405 
vid_t
 
off£t_vid_fÜ_¡»am_cÚt
() {

406  
	g¡»amšg_off£t_vid
;

408 
size_t
 
ed©a_±r_fÜ_¡»am_cÚt
() {

409  
	g¡»amšg_off£t_edge_±r
;

	@src/shards/slidingshard.hpp

30 #ifdeà
DYNAMICEDATA


31 
	~"sh¬ds/dyÇmicd©a/¦idšgsh¬d.hµ
"

34 #iâdeà
DEF_GRAPHCHI_SLIDINGSHARD


35 
	#DEF_GRAPHCHI_SLIDINGSHARD


	)

38 
	~<io¡»am
>

39 
	~<c¡dio
>

40 
	~<s¡»am
>

41 
	~<veùÜ
>

42 
	~<fú.h
>

43 
	~<uni¡d.h
>

44 
	~<as£¹.h
>

45 
	~<¡ršg
>

47 
	~"­i/g¿ph_objeùs.hµ
"

48 
	~"m‘rics/m‘rics.hµ
"

49 
	~"logg”/logg”.hµ
"

50 
	~"io/¡redio.hµ
"

51 
	~"g¿phchi_ty³s.hµ
"

54 
Çme¥aû
 
	gg¿phchi
 {

62 
	ssblock
 {

64 
	gwr™edesc
;

65 
	g»addesc
;

66 
size_t
 
	goff£t
;

67 
size_t
 
	g’d
;

68 
ušt8_t
 * 
	gd©a
;

69 
ušt8_t
 * 
	g±r
;

70 
boŞ
 
	gaùive
;

71 
boŞ
 
	gis_ed©a_block
;

73 
sblock
(è: 
wr™edesc
(0), 
»addesc
(0), 
aùive
(
çl£
è{ 
	gd©a
 = 
NULL
; }

74 
sblock
(
wdesc
, 
rdesc
, 
boŞ
 
is_ed©a_block
=
çl£
è: 
wr™edesc
(wdesc), 
»addesc
Ôdesc), 
aùive
(false),

75 
is_ed©a_block
(is_ed©a_block){ 
	gd©a
 = 
NULL
; }

77 
comm™_async
(
¡redio
 * 
iomgr
) {

78 ià(
	gaùive
 && 
	gd©a
 !ğ
NULL
 && 
wr™edesc
 >= 0) {

79 ià(
is_ed©a_block
) {

80 
iomgr
->
mªaged_pwr™—_async
(
wr™edesc
, &
d©a
, 
’d
-
off£t
, 0, 
Œue
,rue);

81 
	gd©a
 = 
NULL
;

83 
	giomgr
->
mªaged_pwr™—_async
(
wr™edesc
, &
d©a
, 
’d
-
off£t
, off£t, 
Œue
);

88 
comm™_now
(
¡redio
 * 
iomgr
) {

89 ià(
	gaùive
 && 
	gd©a
 !ğ
NULL
 && 
wr™edesc
 >= 0) {

90 
size_t
 
Ën
 = 
±r
-
d©a
;

91 ià(
	gËn
 > 
	g’d
-
	goff£t
èËÀğ
’d
-
off£t
;

92 ià(
	gis_ed©a_block
) {

93 
	giomgr
->
mªaged_pwr™—_now
(
wr™edesc
, &
d©a
, 
’d
 - 
off£t
, 0);

95 
	giomgr
->
mªaged_pwr™—_now
(
wr™edesc
, &
d©a
, 
Ën
, 
off£t
);

99 
»ad_async
(
¡redio
 * 
iomgr
) {

100 ià(
	gis_ed©a_block
) {

101 
	giomgr
->
mªaged_´—da_async
(
»addesc
, &
d©a
, (
’d
 - 
off£t
), 0);

104 
	giomgr
->
mªaged_´—da_async
(
»addesc
, &
d©a
, 
’d
 - 
off£t
, offset);

107 
»ad_now
(
¡redio
 * 
iomgr
) {

108 ià(
	gis_ed©a_block
) {

109 
	giomgr
->
mªaged_´—da_now
(
»addesc
, &
d©a
, 
’d
-
off£t
, 0);

111 
	giomgr
->
mªaged_´—da_now
(
»addesc
, &
d©a
, 
’d
-
off£t
, offset);

115 
»Ëa£
(
¡redio
 * 
iomgr
) {

116 ià(
	gd©a
 !ğ
NULL
) {

117 
iomgr
->
mªaged_»Ëa£
(
»addesc
, &
d©a
);

118 ià(
	gis_ed©a_block
) {

119 
	giomgr
->
şo£_£ssiÚ
(
»addesc
);

122 
	gd©a
 = 
NULL
;

128 
	sšdex’Œy
 {

129 
size_t
 
	gadjoff£t
, 
	ged©aoff£t
;

130 
šdex’Œy
(
size_t
 
a
, size_ˆ
e
è: 
adjoff£t
×), 
ed©aoff£t
(e) {}

137 
	g‹m¶©e
 <
ty³Çme
 
	gVT
,y³Çm
	gET
,y³Çm
	gsv”‹x_t
 = 
g¿phchi_v”‹x
<
VT
, ET>,y³Çm
	gET¥ecŸl
 = 
ET
>

138 şas 
	c¦idšg_sh¬d
 {

140 
¡redio
 * 
iomgr
;

142 
	g¡d
::
¡ršg
 
f’ame_ed©a
;

143 
	g¡d
::
¡ršg
 
f’ame_adj
;

144 
vid_t
 
	g¿nge_¡
, 
	g¿nge_’d
;

145 
size_t
 
	gblocksize
;

147 
vid_t
 
	gcurvid
;

148 
size_t
 
	gadjoff£t
, 
	ged©aoff£t
, 
	gadjfesize
, 
	ged©afesize
;

149 
size_t
 
	gwšdow_¡¬t_ed©aoff£t
;

151 
	g¡d
::
veùÜ
<
sblock
> 
aùiveblocks
;

152 
	gadjfe_£ssiÚ
;

153 
	gwr™edesc
;

154 
sblock
 * 
	gcurblock
;

155 
sblock
 * 
	gcu¿djblock
;

156 
	gm‘rics
 &
	gm
;

158 
	g¡d
::
m­
<, 
	gšdex’Œy
> 
	g¥¬£_šdex
;

159 
boŞ
 
	gdi§bË_wr™es
;

160 
boŞ
 
	gasync_ed©a_lßdšg
;

164 
	gpublic
:

165 
boŞ
 
Úly_adjaûncy
;

167 
¦idšg_sh¬d
(
¡redio
 * 
iomgr
, 
¡d
::
¡ršg
 
_f’ame_ed©a
, std::¡ršg 
_f’ame_adj
, 
vid_t
 
_¿nge_¡
, vid_ˆ
_¿nge_’
, 
size_t
 
_blocksize
, 
m‘rics
 &
_m
,

168 
boŞ
 
_di§bË_wr™es
=
çl£
, boŞ 
Úlyadj
 = false) :

169 
iomgr
(iomgr),

170 
f’ame_ed©a
(
_f’ame_ed©a
),

171 
f’ame_adj
(
_f’ame_adj
),

172 
¿nge_¡
(
_¿nge_¡
),

173 
¿nge_’d
(
_¿nge_’
),

174 
blocksize
(
_blocksize
),

175 
m
(
_m
),

176 
di§bË_wr™es
(
_di§bË_wr™es
) {

177 
	gcurvid
 = 0;

178 
	gadjoff£t
 = 0;

179 
	ged©aoff£t
 = 0;

180 
	gdi§bË_wr™es
 = 
çl£
;

181 
	gÚly_adjaûncy
 = 
Úlyadj
;

182 
	gcurblock
 = 
NULL
;

183 
	gcu¿djblock
 = 
NULL
;

184 
	gwšdow_¡¬t_ed©aoff£t
 = 0;

187 
	gblocksize
 % (
	gET
è!ğ0è
blocksize
++;

188 
as£¹
(
blocksize
 % (
ET
)==0);

190 
	gadjfesize
 = 
g‘_fesize
(
f’ame_adj
);

191 ià(!
	gÚly_adjaûncy
) {

192 
	ged©afesize
 = 
g‘_sh¬d_ed©a_fesize
<
ET
>(
f’ame_ed©a
);

193 
log¡»am
(
LOG_DEBUG
è<< "TÙ®ƒdgd©¨size: " << 
	ged©afesize
 << ", " << 
	gf’ame_ed©a


194 << "sizeof(ET): " << (
	gET
è<< 
	g¡d
::
’dl
;

199 
	gadjfe_£ssiÚ
 = 
iomgr
->
İ’_£ssiÚ
(
f’ame_adj
, 
Œue
);

200 
§ve_off£t
();

202 
	gasync_ed©a_lßdšg
 = !
sv”‹x_t
().
computiÚ®_edges
();

203 #ifdeà
SUPPORT_DELETIONS


204 
	gasync_ed©a_lßdšg
 = 
çl£
;

208 ~
¦idšg_sh¬d
() {

209 
»Ëa£_´iÜ_to_off£t
(
Œue
);

210 ià(
	gcurblock
 !ğ
NULL
) {

211 
curblock
->
»Ëa£
(
iomgr
);

212 
d–‘e
 
	gcurblock
;

213 
	gcurblock
 = 
NULL
;

215 ià(
	gcu¿djblock
 !ğ
NULL
) {

216 
cu¿djblock
->
»Ëa£
(
iomgr
);

217 
d–‘e
 
	gcu¿djblock
;

218 
	gcu¿djblock
 = 
NULL
;

222 
	giomgr
->
şo£_£ssiÚ
(
adjfe_£ssiÚ
);

226 
size_t
 
num_edges
() {

227  
	ged©afesize
 / (
	gET
);

230 
	g´Ùeùed
:

231 
size_t
 
g‘_adjoff£t
(è{  
adjoff£t
; }

232 
size_t
 
g‘_ed©aoff£t
(è{  
	ged©aoff£t
; }

234 
§ve_off£t
() {

237 
	g¥¬£_šdex
.
š£¹
(
¡d
::
·œ
<, 
šdex’Œy
>(-(()
curvid
), index’Œy(
adjoff£t
, 
ed©aoff£t
)));

240 
move_şo£_to
(
vid_t
 
v
) {

241 ià(
	gcurvid
 >ğ
v
) ;

243 
	g¡d
::
m­
<,
	gšdex’Œy
>::
™”©Ü
 
low”bd_™”
 = 
¥¬£_šdex
.
low”_bound
(-(()
v
));

244 
	gşo£¡_vid
 = -(()
low”bd_™”
->
fœ¡
);

245 
as£¹
(
şo£¡_vid
>=0);

246 
šdex’Œy
 
	gşo£¡_off£t
 = 
low”bd_™”
->
£cÚd
;

247 
as£¹
(
şo£¡_vid
 <ğ()
v
);

248 ià(
	gşo£¡_vid
 > ()
	gcurvid
) {

249 ià(
	gcurblock
 !ğ
NULL
)

250 
curblock
->
±r
 +ğ
şo£¡_off£t
.
ed©aoff£t
 -ƒdataoffset;

251 ià(
	gcu¿djblock
 !ğ
NULL
)

252 
cu¿djblock
->
±r
 +ğ
şo£¡_off£t
.
adjoff£t
 -‡djoffset;

253 
	gcurvid
 = (
vid_t
)
şo£¡_vid
;

254 
	gadjoff£t
 = 
şo£¡_off£t
.
adjoff£t
;

255 
	ged©aoff£t
 = 
şo£¡_off£t
.
ed©aoff£t
;

264 
šlše
 
check_curblock
(
size_t
 
tÜ—d
) {

265 ià(
	gcurblock
 =ğ
NULL
 || 
curblock
->
’d
 < 
ed©aoff£t
+
tÜ—d
) {

266 ià(
curblock
 !ğ
NULL
) {

267 ià(!
curblock
->
aùive
) {

268 
curblock
->
»Ëa£
(
iomgr
);

272 
	g¡d
::
¡ršg
 
blockf’ame
 = 
f’ame_sh¬d_ed©a_block
(
f’ame_ed©a
, (è(
ed©aoff£t
 / 
blocksize
), blocksize);

273 
	ged©a_£ssiÚ
 = 
iomgr
->
İ’_£ssiÚ
(
blockf’ame
, 
çl£
, 
Œue
);

274 
sblock
 
Ãwblock
(
ed©a_£ssiÚ
,ƒd©a_£ssiÚ, 
Œue
);

278 
	gÃwblock
.
	goff£t
 = (
ed©aoff£t
 / 
blocksize
) * blocksize;

279 
size_t
 
	gcÜ»ùiÚ
 = 
ed©aoff£t
 - 
Ãwblock
.
off£t
;

280 
	gÃwblock
.
	g’d
 = 
¡d
::
mš
(
ed©afesize
, 
Ãwblock
.
off£t
 + 
blocksize
);

281 
as£¹
(
Ãwblock
.
’d
 >ğÃwblock.
off£t
);

282 
	giomgr
->
mªaged_m®loc
(
ed©a_£ssiÚ
, &
Ãwblock
.
d©a
,‚ewblock.
’d
 -‚ewblock.
off£t
,‚ewblock.offset);

283 
	gÃwblock
.
	g±r
 = 
Ãwblock
.
d©a
 + 
cÜ»ùiÚ
;

284 
	gaùiveblocks
.
push_back
(
Ãwblock
);

285 
	gcurblock
 = &
aùiveblocks
[aùiveblocks.
size
()-1];

289 
šlše
 
check_adjblock
(
size_t
 
tÜ—d
) {

290 ià(
	gcu¿djblock
 =ğ
NULL
 || 
cu¿djblock
->
’d
 <ğ
adjoff£t
 + 
tÜ—d
) {

291 ià(
cu¿djblock
 !ğ
NULL
) {

292 
cu¿djblock
->
»Ëa£
(
iomgr
);

293 
d–‘e
 
	gcu¿djblock
;

294 
	gcu¿djblock
 = 
NULL
;

296 
sblock
 * 
	gÃwblock
 = 
Ãw
 sblock(0, 
adjfe_£ssiÚ
);

297 
	gÃwblock
->
	goff£t
 = 
adjoff£t
;

298 
	gÃwblock
->
	g’d
 = 
¡d
::
mš
(
adjfesize
, 
adjoff£t
+
blocksize
);

299 
as£¹
(
Ãwblock
->
’d
 > 0);

300 
as£¹
(
Ãwblock
->
’d
 >ğÃwblock->
off£t
);

301 
	giomgr
->
mªaged_m®loc
(
adjfe_£ssiÚ
, &
Ãwblock
->
d©a
,‚ewblock->
’d
 -‚ewblock->
off£t
, 
adjoff£t
);

302 
	gÃwblock
->
	g±r
 = 
Ãwblock
->
d©a
;

303 
m‘rics_’Œy
 
	gme
 = 
m
.
¡¬t_time
();

304 
	giomgr
->
mªaged_´—da_now
(
adjfe_£ssiÚ
, &
Ãwblock
->
d©a
,‚ewblock->
’d
 -‚ewblock->
off£t
, 
adjoff£t
);

305 
	gm
.
¡İ_time
(
me
, "blockload");

306 
	gcu¿djblock
 = 
Ãwblock
;

310 
	g‹m¶©e
 <
ty³Çme
 
	gU
>

311 
šlše
 
U
 
»ad_v®
() {

312 
check_adjblock
((
U
));

313 
U
 
	g»s
 = *((U*)
cu¿djblock
->
±r
);

314 
	gadjoff£t
 +ğ(
U
);

315 
	gcu¿djblock
->
	g±r
 +ğ(
U
);

316  
	g»s
;

319 
	g‹m¶©e
 <
ty³Çme
 
	gU
>

320 
šlše
 
U
 * 
»ad_edg•Œ
() {

321 ià(
	gÚly_adjaûncy
è 
	gNULL
;

322 
check_curblock
((
U
));

323 
U
 * 
	g»¥Œ
 = ((U*)
curblock
->
±r
);

324 
	ged©aoff£t
 +ğ(
U
);

325 
	gcurblock
->
	g±r
 +ğ(
U
);

326  
	g»¥Œ
;

329 
šlše
 
sk
(
n
, 
sz
) {

330 
size_t
 
	gtÙ
 = 
n
 * 
sz
;

331 
	gadjoff£t
 +ğ
tÙ
;

332 ià(
	gcu¿djblock
 !ğ
NULL
)

333 
cu¿djblock
->
±r
 +ğ
tÙ
;

334 
	ged©aoff£t
 +ğ(
ET
)*
n
;

335 ià(
	gcurblock
 !ğ
NULL
)

336 
curblock
->
±r
 +ğ(
ET
)*
n
;

339 
	gpublic
:

343 
»ad_Ãxt_v”tiûs
(
nvecs
, 
vid_t
 
¡¬t
, 
¡d
::
veùÜ
<
sv”‹x_t
> & 
´—Îoc
, 
boŞ
 
»cÜd_šdex
=
çl£
, boŞ 
di§bË_wr™es
=false) {

344 
m‘rics_’Œy
 
me
 = 
m
.
¡¬t_time
();

345 ià(!
	g»cÜd_šdex
)

346 
move_şo£_to
(
¡¬t
);

349 
	gcurblock
 = 
NULL
;

350 
»Ëa£_´iÜ_to_off£t
(
çl£
, 
di§bË_wr™es
);

351 
as£¹
(
aùiveblocks
.
size
() <= 1);

354 ià(!
	gaùiveblocks
.
em±y
(è&& !
	gÚly_adjaûncy
) {

355 
	gcurblock
 = &
aùiveblocks
[0];

357 
vid_t
 
	gÏ¡»c
 = 
¡¬t
;

358 
	gwšdow_¡¬t_ed©aoff£t
 = 
ed©aoff£t
;

360 
	gi
=(()
curvid
è- (()
¡¬t
); i<
	gnvecs
; i++) {

361 ià(
	gadjoff£t
 >ğ
adjfesize
) ;

365 
	gn
;

366 ià(
	g»cÜd_šdex
 && (
	gsize_t
)(
	gcurvid
 - 
	gÏ¡»c
è>ğ(
size_t
è
¡d
::
max
(()100000, 
nvecs
/16)) {

367 
§ve_off£t
();

368 
	gÏ¡»c
 = 
curvid
;

370 
ušt8_t
 
	gns
 = 
»ad_v®
<uint8_t>();

371 ià(
	gns
 == 0x00) {

372 
curvid
++;

373 
ušt8_t
 
	gnz
 = 
»ad_v®
<uint8_t>();

374 
	gcurvid
 +ğ
nz
;

375 
	gi
 +ğ
nz
;

379 ià(
	gns
 == 0xff) {

380 
n
 = 
»ad_v®
<
ušt32_t
>();

382 
	gn
 = 
ns
;

385 ià(
	gi
<0) {

387 
sk
(
n
, (
vid_t
));

389 
	gsv”‹x_t
& 
	gv”‹x
 = 
´—Îoc
[
i
];

390 
as£¹
(
v”‹x
.
id
(è=ğ
curvid
);

392 ià(
	gv”‹x
.
	gscheduËd
) {

394 --
	gn
 >= 0) {

395 
boŞ
 
¥ecŸl_edge
 = 
çl£
;

396 
vid_t
 
	grg‘
 = ((
ET
è=ğ(
ET¥ecŸl
è? 
»ad_v®
<vid_t>(è: 
Œª¦©e_edge
Ô—d_v®<vid_t>(), 
¥ecŸl_edge
));

397 
ET
 * 
	gev®ue
 = (
¥ecŸl_edge
 ? (ET*)
»ad_edg•Œ
<
ET¥ecŸl
>():„ead_edgeptr<ET>());

399 ià(!
	gÚly_adjaûncy
) {

400 ià(!
	gcurblock
->
	gaùive
) {

401 ià(
	gasync_ed©a_lßdšg
) {

402 
	gcurblock
->
»ad_async
(
iomgr
);

404 
	gcurblock
->
»ad_now
(
iomgr
);

408 
	gcurblock
->
	gaùive
 = 
Œue
;

410 
	gv”‹x
.
add_ou‹dge
(
rg‘
, 
ev®ue
, 
¥ecŸl_edge
);

412 ià(!((
	grg‘
 >ğ
¿nge_¡
 && 
rg‘
 <ğ
¿nge_’d
))) {

413 
log¡»am
(
LOG_ERROR
è<< "E¼Ü : " << 
rg‘
 << "‚Ù iÀ[" << 
¿nge_¡
 << " - " << 
¿nge_’d
 << "]" << 
¡d
::
’dl
;

414 
	giomgr
->
´št_£ssiÚ
(
adjfe_£ssiÚ
);

416 
as£¹
(
rg‘
 >ğ
¿nge_¡
 &&¬g‘ <ğ
¿nge_’d
);

421 
sk
(
n
, (
vid_t
));

424 
	gcurvid
++;

426 
	gm
.
¡İ_time
(
me
, "read_next_vertices");

427 
	gcurblock
 = 
NULL
;

434 
comm™
(
sblock
 &
b
, 
boŞ
 
synchrÚou¦y
, boŞ 
di§bË_wr™es
=
çl£
) {

435 ià(
synchrÚou¦y
) {

436 
m‘rics_’Œy
 
me
 = 
m
.
¡¬t_time
();

437 ià(!
	gdi§bË_wr™es
è
	gb
.
comm™_now
(
iomgr
);

438 
	gm
.
¡İ_time
(
me
, "commit");

439 
	gb
.
»Ëa£
(
iomgr
);

441 ià(!
	gdi§bË_wr™es
è
	gb
.
comm™_async
(
iomgr
);

442 
	gb
.
»Ëa£
(
iomgr
);

449 
æush
() {

450 
»Ëa£_´iÜ_to_off£t
(
Œue
);

451 ià(
	gcu¿djblock
 !ğ
NULL
) {

452 
cu¿djblock
->
»Ëa£
(
iomgr
);

453 
d–‘e
 
	gcu¿djblock
;

454 
	gcu¿djblock
 = 
NULL
;

461 
£t_off£t
(
size_t
 
Ãwoff
, 
vid_t
 
_curvid
, size_ˆ
edg•Œ
) {

462 
	gthis
->
	gadjoff£t
 = 
Ãwoff
;

463 
	gthis
->
	gcurvid
 = 
_curvid
;

464 
	gthis
->
	ged©aoff£t
 = 
edg•Œ
;

465 ià(
	gcu¿djblock
 !ğ
NULL
) {

466 
cu¿djblock
->
»Ëa£
(
iomgr
);

467 
d–‘e
 
	gcu¿djblock
;

468 
	gcu¿djblock
 = 
NULL
;

475 
»Ëa£_´iÜ_to_off£t
(
boŞ
 
®l
=
çl£
, boŞ 
di§bË_wr™es
=false) {

476 
i
=()
aùiveblocks
.
size
(è- 1; 
	gi
 >= 0; i--) {

477 
	gsblock
 &
	gb
 = 
aùiveblocks
[
i
];

478 ià(
	gb
.
	g’d
 <ğ
ed©aoff£t
 || 
®l
) {

479 
comm™
(
b
, 
®l
, 
di§bË_wr™es
);

480 
	gaùiveblocks
.
”a£
(
aùiveblocks
.
begš
(è+ ()
i
);

485 
	g¡d
::
¡ršg
 
g‘_šfo_jsÚ
() {

486 
¡d
::
¡ršg¡»am
 
jsÚ
;

487 
	gjsÚ
 << "\"size\": ";

488 
	gjsÚ
 << 
	ged©afesize
 << 
	g¡d
::
’dl
;

489 
	gjsÚ
 << ", \"windowStart\": ";

490 
	gjsÚ
 << 
	gwšdow_¡¬t_ed©aoff£t
;

491 
	gjsÚ
 << ", \"windowEnd\": ";

492 
	gjsÚ
 << 
	ged©aoff£t
;

493 
	gjsÚ
 << ", \"intervalStart\": ";

494 
	gjsÚ
 << 
	g¿nge_¡
;

495 
	gjsÚ
 << ", \"intervalEnd\": ";

496 
	gjsÚ
 << 
	g¿nge_’d
;

497  
	gjsÚ
.
¡r
();

	@src/tests/basic_dynamicengine_smoketest.cpp

32 
	~<¡ršg
>

34 
	~"g¿phchi_basic_šşudes.hµ
"

35 
	~"’gše/dyÇmic_g¿phs/g¿phchi_dyÇmicg¿ph_’gše.hµ
"

37 
usšg
 
Çme¥aû
 
	gg¿phchi
;

43 
vid_t
 
	tV”‹xD©aTy³
;

44 
vid_t
 
	tEdgeD©aTy³
;

51 
	gSmokeTe¡Prog¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

57 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

58 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0) {

59 
i
=0; 
	gi
 < 
	gv”‹x
.
num_ou‹dges
(); i++) {

60 
	gv”‹x
.
ou‹dge
(
i
)->
£t_d©a
(
v”‹x
.
id
());

63 
	gi
=0; i < 
	gv”‹x
.
num_šedges
(); i++) {

64 
	gg¿phchi_edge
<
	gvid_t
> * 
	gedge
 = 
v”‹x
.
šedge
(
i
);

65 
vid_t
 
	gšedged©a
 = 
edge
->
g‘_d©a
();

66 
vid_t
 
	gex³ùed
 = 
edge
->
v”‹x_id
(è+ 
gcÚ‹xt
.
™”©iÚ
 - (edge->v”‹x_id(è> 
v”‹x
.
id
());

67 ià(
	gšedged©a
 !ğ
ex³ùed
) {

68 
as£¹
(
çl£
);

71 
	gi
=0; i < 
	gv”‹x
.
num_ou‹dges
(); i++) {

72 
	gv”‹x
.
ou‹dge
(
i
)->
£t_d©a
(
v”‹x
.
id
(è+ 
gcÚ‹xt
.
™”©iÚ
);

75 
	gv”‹x
.
£t_d©a
(
gcÚ‹xt
.
™”©iÚ
 + 1);

81 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

87 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

93 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

99 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

107 
şass
 
	gV”‹xD©aCheck”
 : 
public
 
VC®lback
<
V”‹xD©aTy³
> {

108 
™”s
;

109 
	gpublic
:

110 
size_t
 
tÙ®
;

112 
V”‹xD©aCheck”
(
™”s
è: i‹rs(™”s), 
tÙ®
(0) {}

113 
ÿÎback
(
vid_t
 
v”‹x_id
, 
V”‹xD©aTy³
 &
vecv®ue
) {

114 
as£¹
(
vecv®ue
 =ğ
™”s
);

115 
	gtÙ®
 +ğ
™”s
;

119 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

122 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

126 
m‘rics
 
	`m
("smoketest-dynamic-engine");

129 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

130 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 4);

131 
boŞ
 
scheduËr
 = 
çl£
;

134 
nsh¬ds
 = 
cÚv”t_if_nÙexi¡s
<
EdgeD©aTy³
>(
f’ame
,

135 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"));

138 
SmokeTe¡Prog¿m
 
´og¿m
;

139 
g¿phchi_dyÇmicg¿ph_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
, 
nsh¬ds
, 
scheduËr
, 
m
);

140 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

143 
V”‹xD©aCheck”
 
	`vcheck”
(
n™”s
);

144 
	`fÜ—ch_v”tiûs
(
f’ame
, 0, 
’gše
.
	`num_v”tiûs
(), 
vcheck”
);

145 
	`as£¹
(
vcheck”
.
tÙ®
 =ğ
’gše
.
	`num_v”tiûs
(è* 
n™”s
);

148 
	`m‘rics_»pÜt
(
m
);

150 
	`log¡»am
(
LOG_INFO
è<< "DyÇmiøEngšSmok‘e¡…as£d sucûssfuÎy! You¸sy¡em i wÜkšg!" << 
¡d
::
’dl
;

152 
	}
}

	@src/tests/basic_dynamicengine_smoketest2.cpp

32 
	~<¡ršg
>

34 
	#SUPPORT_DELETIONS
 1

	)

36 
	~"g¿phchi_basic_šşudes.hµ
"

37 
	~"’gše/dyÇmic_g¿phs/g¿phchi_dyÇmicg¿ph_’gše.hµ
"

39 
usšg
 
Çme¥aû
 
	gg¿phchi
;

45 
vid_t
 
	tV”‹xD©aTy³
;

46 
vid_t
 
	tEdgeD©aTy³
;

54 
	gSmokeTe¡Prog¿m2
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

56 vŞ©
size_t
 
	gnd–‘ed
;

61 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

62 
	gnšedges
 = 0;

63 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0) {

64 
i
=0; 
	gi
 < 
	gv”‹x
.
num_šedges
(); i++) {

65 
	gv”‹x
.
šedge
(
i
)->
£t_d©a
(
v”‹x
.
id
());

66 
	gnšedges
++;

71 ià(
	gv”‹x
.
g‘_d©a
(è!ğ
v”‹x
.
num_šedges
()) {

72 
log¡»am
(
LOG_ERROR
è<< "Disü•ªcy iÀedgcouÁs: " << 
v”‹x
.
g‘_d©a
(è<< " !ğ" << v”‹x.
num_šedges
(è<< 
¡d
::
’dl
;

74 
as£¹
(
v”‹x
.
g‘_d©a
(è=ğv”‹x.
num_šedges
());

76 
	gi
=0; i < 
	gv”‹x
.
num_ou‹dges
(); i++) {

77 
	gg¿phchi_edge
<
	gvid_t
> * 
	gedge
 = 
v”‹x
.
ou‹dge
(
i
);

78 
vid_t
 
	gou‹dged©a
 = 
edge
->
g‘_d©a
();

79 
vid_t
 
	gex³ùed
 = 
edge
->
v”‹x_id
(è+ 
gcÚ‹xt
.
™”©iÚ
 - (edge->v”‹x_id(è> 
v”‹x
.
id
());

80 ià(!
is_d–‘ed_edge_v®ue
(
edge
->
g‘_d©a
())) {

81 ià(
	gou‹dged©a
 !ğ
ex³ùed
) {

82 
log¡»am
(
LOG_ERROR
è<< 
ou‹dged©a
 << " !ğ" << 
ex³ùed
 << 
¡d
::
’dl
;

83 
as£¹
(
çl£
);

87 
	gi
=0; i < 
	gv”‹x
.
num_šedges
(); i++) {

88 
	gv”‹x
.
šedge
(
i
)->
£t_d©a
(
v”‹x
.
id
(è+ 
gcÚ‹xt
.
™”©iÚ
);

90 ià(
	g¡d
::
¿nd
() % 4 == 1) {

91 
v”‹x
.
»move_šedge
(
i
);

92 
__sync_add_ªd_ãtch
(&
nd–‘ed
, 1);

94 
	gnšedges
++;

99 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 =ğ
gcÚ‹xt
.
num_™”©iÚs
 - 1) {

100 
v”‹x
.
£t_d©a
(
gcÚ‹xt
.
™”©iÚ
 + 1);

102 
	gv”‹x
.
£t_d©a
(
nšedges
);

109 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

110 
	gnd–‘ed
 = 0;

116 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

117 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 > 0)

118 
as£¹
(
nd–‘ed
 > 0);

119 
log¡»am
(
LOG_INFO
è<< "D–‘ed: " << 
	gnd–‘ed
 << 
	g¡d
::
’dl
;

125 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

131 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

139 
şass
 
	gV”‹xD©aCheck”
 : 
public
 
VC®lback
<
V”‹xD©aTy³
> {

140 
™”s
;

141 
	gpublic
:

142 
size_t
 
tÙ®
;

144 
V”‹xD©aCheck”
(
™”s
è: i‹rs(™”s), 
tÙ®
(0) {}

145 
ÿÎback
(
vid_t
 
v”‹x_id
, 
V”‹xD©aTy³
 &
vecv®ue
) {

146 
as£¹
(
vecv®ue
 =ğ
™”s
);

147 
	gtÙ®
 +ğ
™”s
;

151 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

154 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

158 
m‘rics
 
	`m
("smoketest-dynamic-engine2");

161 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

162 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 4);

163 
boŞ
 
scheduËr
 = 
çl£
;

166 
nsh¬ds
 = 
cÚv”t_if_nÙexi¡s
<
EdgeD©aTy³
>(
f’ame
,

167 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"));

170 
SmokeTe¡Prog¿m2
 
´og¿m
;

171 
g¿phchi_dyÇmicg¿ph_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
, 
nsh¬ds
, 
scheduËr
, 
m
);

172 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

175 
V”‹xD©aCheck”
 
	`vcheck”
(
n™”s
);

176 
	`fÜ—ch_v”tiûs
(
f’ame
, 0, 
’gše
.
	`num_v”tiûs
(), 
vcheck”
);

177 
	`as£¹
(
vcheck”
.
tÙ®
 =ğ
’gše
.
	`num_v”tiûs
(è* 
n™”s
);

180 
	`m‘rics_»pÜt
(
m
);

182 
	`log¡»am
(
LOG_INFO
è<< "DyÇmiøEngšSmok‘e¡…as£d sucûssfuÎy! You¸sy¡em i wÜkšg!" << 
¡d
::
’dl
;

184 
	}
}

	@src/tests/basic_smoketest.cpp

32 
	~<¡ršg
>

34 
	~"g¿phchi_basic_šşudes.hµ
"

36 
usšg
 
Çme¥aû
 
	gg¿phchi
;

42 
vid_t
 
	tV”‹xD©aTy³
;

43 
vid_t
 
	tEdgeD©aTy³
;

50 
	gSmokeTe¡Prog¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

56 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

57 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0) {

58 
i
=0; 
	gi
 < 
	gv”‹x
.
num_ou‹dges
(); i++) {

59 
	gv”‹x
.
ou‹dge
(
i
)->
£t_d©a
(
v”‹x
.
id
());

62 
	gi
=0; i < 
	gv”‹x
.
num_šedges
(); i++) {

63 
	gg¿phchi_edge
<
	gvid_t
> * 
	gedge
 = 
v”‹x
.
šedge
(
i
);

64 
vid_t
 
	gšedged©a
 = 
edge
->
g‘_d©a
();

65 
vid_t
 
	gex³ùed
 = 
edge
->
v”‹x_id
(è+ 
gcÚ‹xt
.
™”©iÚ
 - (edge->v”‹x_id(è> 
v”‹x
.
id
());

66 ià(
	gšedged©a
 !ğ
ex³ùed
) {

67 
as£¹
(
çl£
);

70 
	gi
=0; i < 
	gv”‹x
.
num_ou‹dges
(); i++) {

71 
	gv”‹x
.
ou‹dge
(
i
)->
£t_d©a
(
v”‹x
.
id
(è+ 
gcÚ‹xt
.
™”©iÚ
);

74 
	gv”‹x
.
£t_d©a
(
gcÚ‹xt
.
™”©iÚ
 + 1);

80 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

86 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

92 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

98 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

106 
şass
 
	gV”‹xD©aCheck”
 : 
public
 
VC®lback
<
V”‹xD©aTy³
> {

107 
™”s
;

108 
	gpublic
:

109 
size_t
 
tÙ®
;

111 
V”‹xD©aCheck”
(
™”s
è: i‹rs(™”s), 
tÙ®
(0) {}

112 
ÿÎback
(
vid_t
 
v”‹x_id
, 
V”‹xD©aTy³
 &
vecv®ue
) {

113 
as£¹
(
vecv®ue
 =ğ(
V”‹xD©aTy³
)
™”s
);

114 
	gtÙ®
 +ğ(
size_t
è
™”s
;

118 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

121 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

125 
m‘rics
 
	`m
("smoketest");

128 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

129 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 4);

130 
boŞ
 
scheduËr
 = 
çl£
;

133 
nsh¬ds
 = 
cÚv”t_if_nÙexi¡s
<
EdgeD©aTy³
>(
f’ame
,

134 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"));

137 
SmokeTe¡Prog¿m
 
´og¿m
;

138 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
, 
nsh¬ds
, 
scheduËr
, 
m
);

139 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

142 
V”‹xD©aCheck”
 
	`vcheck”
(
n™”s
);

143 
	`fÜ—ch_v”tiûs
(
f’ame
, 0, 
’gše
.
	`num_v”tiûs
(), 
vcheck”
);

144 
	`as£¹
(
vcheck”
.
tÙ®
 =ğ
’gše
.
	`num_v”tiûs
(è* 
n™”s
);

147 
	`m‘rics_»pÜt
(
m
);

149 
	`log¡»am
(
LOG_INFO
è<< "Smok‘e¡…as£d sucûssfuÎy! You¸sy¡em i wÜkšg!" << 
¡d
::
’dl
;

151 
	}
}

	@src/tests/bulksync_functional_test.cpp

29 
	#RANDOMRESETPROB
 0.15

	)

31 
	~<¡ršg
>

32 
	~<f¡»am
>

33 
	~<cm©h
>

35 
	~"ut/cmdİts.hµ
"

36 
	~"­i/g¿phchi_cÚ‹xt.hµ
"

37 
	~"­i/g¿ph_objeùs.hµ
"

38 
	~"­i/ischeduËr.hµ
"

39 
	~"­i/funùiÚ®/funùiÚ®_­i.hµ
"

40 
	~"m‘rics/m‘rics.hµ
"

41 
	~"m‘rics/»ps/basic_»pÜ‹r.hµ
"

42 
	~"ut/tİli¡.hµ
"

44 
usšg
 
Çme¥aû
 
	gg¿phchi
;

46 
	gsmok‘e¡_´og¿m
 : 
public
 
funùiÚ®_k”Ãl
<, > {

49 
š™Ÿl_v®ue
(
g¿phchi_cÚ‹xt
 &
šfo
, 
v”‹x_šfo
& 
myv”‹x
) {

54 
»£t
() {

60 
İ_ÃighbÜv®
(
g¿phchi_cÚ‹xt
 &
šfo
, 
v”‹x_šfo
& 
myv”‹x
, 
vid_t
 
nbid
, 
nbv®
) {

61 
as£¹
(
nbv®
 =ğ(è
šfo
.
™”©iÚ
 - 1);

62  
	gnbv®
;

66 
¶us
(
curv®
, 
tßdd
) {

67 
as£¹
(
curv®
 =ğ0 || 
tßdd
 == curval);

68  
	gtßdd
;

72 
compu‹_v”‹xv®ue
(
g¿phchi_cÚ‹xt
 &
gšfo
, 
v”‹x_šfo
& 
myv”‹x
, 
nbv®sum
) {

73  
	ggšfo
.
	g™”©iÚ
;

77 
v®ue_to_ÃighbÜ
(
g¿phchi_cÚ‹xt
 &
šfo
, 
v”‹x_šfo
& 
myv”‹x
, 
vid_t
 
nbid
, 
myv®
) {

78 
as£¹
(
myv®
 =ğ(è
šfo
.
™”©iÚ
);

79  
	gmyv®
;

84 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

85 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

86 
m‘rics
 
	`m
("test-functional");

88 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

89 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 5);

90 
¡d
::
¡ršg
 
mode
 = 
	`g‘_İtiÚ_¡ršg
("mode", "semisync");

92 
	`log¡»am
(
LOG_INFO
è<< "RuÂšg bulk synøsmok‹¡." << 
¡d
::
’dl
;

93 
run_funùiÚ®_unweigh‹d_synchrÚous
<
smok‘e¡_´og¿m
>(
f’ame
, 
n™”s
, 
m
);

95 
	`log¡»am
(
LOG_INFO
è<< "Smok‘e¡…as£d sucûssfuÎy! You¸sy¡em i wÜkšg!" << 
¡d
::
’dl
;

97 
	}
}

	@src/tests/dynamicdata_smoketest.cpp

30 
	#DYNAMICEDATA
 1

	)

32 
	~<¡ršg
>

34 
	~"g¿phchi_basic_šşudes.hµ
"

35 
	~"­i/dyÇmicd©a/chiveùÜ.hµ
"

37 
usšg
 
Çme¥aû
 
	gg¿phchi
;

43 
vid_t
 
	tV”‹xD©aTy³
;

44 
	gchiveùÜ
<
	tvid_t
> 
	tEdgeD©aTy³
;

49 
	gDyÇmicD©aSmokeTe¡Prog¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

55 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
 > &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

56 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0) {

57 
i
=0; 
	gi
 < 
	gv”‹x
.
num_ou‹dges
(); i++) {

58 
	gchiveùÜ
<
	gvid_t
> * 
	geveùÜ
 = 
v”‹x
.
ou‹dge
(
i
)->
g‘_veùÜ
();

59 
	geveùÜ
->
ş—r
();

60 
as£¹
(
eveùÜ
->
size
() == 0);

62 
	geveùÜ
->
add
(
v”‹x
.
id
());

63 
as£¹
(
eveùÜ
->
size
() == 1);

64 
as£¹
(
eveùÜ
->
g‘
(0è=ğ
v”‹x
.
id
());

68 
	gi
=0; i < 
	gv”‹x
.
num_šedges
(); i++) {

69 
	gg¿phchi_edge
<
	gEdgeD©aTy³
> * 
	gedge
 = 
v”‹x
.
šedge
(
i
);

70 
	gchiveùÜ
<
	gvid_t
> * 
	geveùÜ
 = 
edge
->
g‘_veùÜ
();

71 
as£¹
(
eveùÜ
->
size
(è>ğ
gcÚ‹xt
.
™”©iÚ
);

72 
	gj
=0; j < 
	geveùÜ
->
size
(); j++) {

73 
vid_t
 
	gex³ùed
 = 
edge
->
v”‹x_id
(è+ 
j
;

74 
vid_t
 
	ghas
 = 
eveùÜ
->
g‘
(
j
);

75 ià(
	ghas
 !ğ
ex³ùed
) {

76 
¡d
::
cout
 << "Mism©ch: " << 
has
 << " !ğ" << 
ex³ùed
 << std::
’dl
;

78 
as£¹
(
has
 =ğ
ex³ùed
);

81 
	gi
=0; i < 
	gv”‹x
.
num_ou‹dges
(); i++) {

82 
	gv”‹x
.
ou‹dge
(
i
)->
g‘_veùÜ
()->
add
(
v”‹x
.
id
(è+ 
gcÚ‹xt
.
™”©iÚ
);

85 
	gv”‹x
.
£t_d©a
(
gcÚ‹xt
.
™”©iÚ
 + 1);

91 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

97 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

103 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

109 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

117 
şass
 
	gV”‹xD©aCheck”
 : 
public
 
VC®lback
<
V”‹xD©aTy³
> {

118 
™”s
;

119 
	gpublic
:

120 
size_t
 
tÙ®
;

122 
V”‹xD©aCheck”
(
™”s
è: i‹rs(™”s), 
tÙ®
(0) {}

123 
ÿÎback
(
vid_t
 
v”‹x_id
, 
V”‹xD©aTy³
 &
vecv®ue
) {

124 
as£¹
(
vecv®ue
 =ğ(
V”‹xD©aTy³
)
™”s
);

125 
	gtÙ®
 +ğ(
size_t
è
™”s
;

129 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

132 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

136 
m‘rics
 
	`m
("dynamicdata-smoketest");

139 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

140 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 4);

141 
boŞ
 
scheduËr
 = 
çl£
;

144 
nsh¬ds
 = 
cÚv”t_if_nÙexi¡s
<
vid_t
>(
f’ame
, 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"));

147 
DyÇmicD©aSmokeTe¡Prog¿m
 
´og¿m
;

148 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
, 
nsh¬ds
, 
scheduËr
, 
m
);

149 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

152 
V”‹xD©aCheck”
 
	`vcheck”
(
n™”s
);

153 
	`fÜ—ch_v”tiûs
(
f’ame
, 0, 
’gše
.
	`num_v”tiûs
(), 
vcheck”
);

154 
	`as£¹
(
vcheck”
.
tÙ®
 =ğ
’gše
.
	`num_v”tiûs
(è* 
n™”s
);

157 
	`m‘rics_»pÜt
(
m
);

159 
	`log¡»am
(
LOG_INFO
è<< "Smok‘e¡…as£d sucûssfuÎy! You¸sy¡em i wÜkšg!" << 
¡d
::
’dl
;

161 
	}
}

	@src/tests/test_dynamicedata_loader.cpp

31 
	#DYNAMICEDATA
 1

	)

32 
	#DYNAMICVERTEXDATA
 1

	)

34 
	~<¡ršg
>

36 
	~"g¿phchi_basic_šşudes.hµ
"

37 
	~"­i/dyÇmicd©a/chiveùÜ.hµ
"

39 
usšg
 
Çme¥aû
 
	gg¿phchi
;

45 
	gchiveùÜ
<
	tsize_t
> 
	tV”‹xD©aTy³
;

46 
	gchiveùÜ
<
	tvid_t
> 
	tEdgeD©aTy³
;

48 
size_t
 
	gchecksum
 = 0;

49 
size_t
 
	gshouldbe
 = 0;

54 
	gDyÇmicD©aLßd”Te¡Prog¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

56 
mu‹x
 
	glock
;

61 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
 > &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

62 
	gi
=0; i < 
	gv”‹x
.
num_edges
(); i++) {

63 
	gchiveùÜ
<
	gvid_t
> * 
	geveùÜ
 = 
v”‹x
.
edge
(
i
)->
g‘_veùÜ
();

64 
as£¹
(
eveùÜ
 !ğ
NULL
);

65 
as£¹
(
eveùÜ
->
size
() == 1);

67 
vid_t
 
	gex³ùed
 = 
v”‹x
.
id
(è+ v”‹x.
edge
(
i
)->
v”‹x_id
();

68 ià(
	gex³ùed
 !ğ
eveùÜ
->
g‘
(0)) {

69 
log¡»am
(
LOG_ERROR
è<< "V”‹x " << 
v”‹x
.
id
(è<< ",ƒdgd¡: " << v”‹x.
edge
(
i
)->
v”‹x_id
(è<< 
¡d
::
’dl
;

70 
log¡»am
(
LOG_ERROR
è<< "Mism©ch:ƒx³ùed " << 
	gex³ùed
 << " buˆhad " << 
	geveùÜ
->
g‘
(0è<< 
	g¡d
::
’dl
;

72 
as£¹
(
eveùÜ
->
g‘
(0è=ğ
ex³ùed
);

73 
	glock
.
lock
();

74 
	gchecksum
 +ğ
eveùÜ
->
g‘
(0);

75 
	glock
.
uÆock
();

79 
	gchiveùÜ
<
	gsize_t
> * 
	gvveùÜ
 = 
v”‹x
.
g‘_veùÜ
();

80 
	gnum™ems
 = 
v”‹x
.
id
() % 10;

81 
	gi
=0; i<
	gnum™ems
; i++) {

82 
	gvveùÜ
->
add
(
v”‹x
.
id
(è* 982192È+ 
i
);

86 
	gi
=0; i<
	gnum™ems
; i++) {

87 
size_t
 
	gx
 = 
vveùÜ
->
g‘
(
i
);

88 
size_t
 
	gex³ùed
 = 
v”‹x
.
id
(è* 982192È+ 
i
;

89 
as£¹
(
x
 =ğ
ex³ùed
);

96 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

102 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

108 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

114 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

120 
g’”©ed©a
(
¡d
::
¡ršg
 
f’ame
);

121 
g’”©ed©a
(
¡d
::
¡ršg
 
f’ame
) {

122 cÚ¡ * 
âame
 = 
f’ame
.
c_¡r
();

123 
FILE
 * 
	gf
 = 
fİ’
(
âame
, "w");

124 
£t_cÚf
("filetype", "edgelist");

125 
	gshouldbe
 = 0;

126 
	gtÙ®V”tiûs
 = 2500000;

127 
	gi
=0; i < 
	gtÙ®V”tiûs
; i++) {

128 
	gÃdges
 = 
¿ndom
() % 50;

129 
	gj
=0; j < 
	gÃdges
; j++) {

130 
	gd¡
 = (
tÙ®V”tiûs
 / 
Ãdges
è* 
j
 + 
i
 %‚edges;

131 ià(
	gd¡
 !ğ
i
) {

132 
årštf
(
f
, "%d\t%d\t%d\n", 
i
, 
d¡
, i + dst);

133 
	gshouldbe
 +ğ2 * (
i
 + 
d¡
);

137 
fşo£
(
f
);

140 
şass
 
	gV”‹xV®id©Ü
 : 
public
 
VC®lback
<
chiveùÜ
<
size_t
> > {

141 
public
:

142 
vœtu®
 
ÿÎback
(
vid_t
 
v”‹x_id
, 
chiveùÜ
<
size_t
> &
vec
) {

143 
	gnum™ems
 = 
v”‹x_id
 % 10;

144 
as£¹
(
vec
.
size
(è=ğ
num™ems
);

146 
	gj
=0; j < 
	gnum™ems
; j++) {

147 
size_t
 
	gx
 = 
vec
.
g‘
(
j
);

148 
as£¹
(
x
 =ğ
v”‹x_id
 * 982192È+ (
size_t
)
j
);

155 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

158 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

162 
m‘rics
 
	`m
("test-dynamicedata");

166 
¡d
::
¡ršg
 
f’ame
 = "/tmp/__chi_dyntest/testgraph";

167 
	`mkdœ
("/tmp/__chi_dyntest", 0777);

168 
n™”s
 = 1;

169 
boŞ
 
scheduËr
 = 
çl£
;

172 
	`g’”©ed©a
(
f’ame
);

173 
nsh¬ds
 = 
cÚv”t_if_nÙexi¡s
<>(
f’ame
, "3");

175 
checksum
 = 0;

179 
DyÇmicD©aLßd”Te¡Prog¿m
 
´og¿m
;

180 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
, 
nsh¬ds
, 
scheduËr
, 
m
);

181 
’gše
.
	`£t_»£t_v”‹xd©a
(
Œue
);

182 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

185 
¡d
::
cout
 << "Checksum: " << 
checksum
 << ",ƒx³ùšg: " << 
shouldbe
 << std::
’dl
;

186 
	`as£¹
(
shouldbe
 =ğ
checksum
);

189 
V”‹xV®id©Ü
 
v®id©Ü
;

190 
	`fÜ—ch_v”tiûs
(
f’ame
, 0, 
’gše
.
	`num_v”tiûs
(), 
v®id©Ü
);

194 
d–‘e_sh¬ds
<
EdgeD©aTy³
>(
f’ame
, 3);

198 
	`m‘rics_»pÜt
(
m
);

200 
	`log¡»am
(
LOG_INFO
è<< "Te¡…as£d sucûssfuÎy! You¸sy¡em i wÜkšg!" << 
¡d
::
’dl
;

202 
	}
}

	@src/util/atomic.hpp

1 #iâdeà
ATOMIC_HPP


2 
	#ATOMIC_HPP


	)

6 
Çme¥aû
 
	gg¿phchi
 {

13 
	g‹m¶©e
<
ty³Çme
 
	gT
>

14 şas 
	c©omic
{

15 
	gpublic
:

16 vŞ©
T
 
v®ue
;

17 
©omic
(cÚ¡ 
T
& 
v®ue
 = 0) : value(value) { }

18 
T
 
šc
(è{  
__sync_add_ªd_ãtch
(&
v®ue
, 1); }

19 
T
 
dec
(è{  
__sync_sub_ªd_ãtch
(&
v®ue
, 1); }

23 
İ”©Ü
 
T
(ècÚ¡ {  
	gv®ue
; }

26 
T
 
	gİ”©Ü
++(è{  
šc
(); }

29 
T
 
	gİ”©Ü
--(è{  
dec
(); }

32 
T
 
šc
(cÚ¡ T 
v®
è{  
__sync_add_ªd_ãtch
(&
v®ue
, val); }

35 
T
 
dec
(cÚ¡ T 
v®
è{  
__sync_sub_ªd_ãtch
(&
v®ue
, val); }

38 
T
 
	gİ”©Ü
+=(cÚ¡ T 
v®
è{  
šc
(val); }

41 
T
 
	gİ”©Ü
-=(cÚ¡ T 
v®
è{  
dec
(val); }

44 
T
 
šc_»t_Ï¡
(è{  
__sync_ãtch_ªd_add
(&
v®ue
, 1); }

47 
T
 
dec_»t_Ï¡
(è{  
__sync_ãtch_ªd_sub
(&
v®ue
, 1); }

50 
T
 
	gİ”©Ü
++(è{  
šc_»t_Ï¡
(); }

53 
T
 
	gİ”©Ü
--(è{  
dec_»t_Ï¡
(); }

56 
T
 
šc_»t_Ï¡
(cÚ¡ T 
v®
è{  
__sync_ãtch_ªd_add
(&
v®ue
, val); }

59 
T
 
dec_»t_Ï¡
(cÚ¡ T 
v®
è{  
__sync_ãtch_ªd_sub
(&
v®ue
, val); }

62 
T
 
exchªge
(cÚ¡ T 
v®
è{  
__sync_lock_‹¡_ªd_£t
(&
v®ue
, val); }

76 
	g‹m¶©e
<
ty³Çme
 
	gT
>

77 
boŞ
 
	$©omic_com·»_ªd_sw­
(
T
& 
a
, cÚ¡ T &
Şdv®
, cÚ¡ T &
Ãwv®
) {

78  
	`__sync_boŞ_com·»_ªd_sw­
(&
a
, 
Şdv®
, 
Ãwv®
);

79 
	}
};

82 
	g‹m¶©e
 <>

83 
šlše
 
boŞ
 
	$©omic_com·»_ªd_sw­
(& 
a
, cÚ¡ &
Şdv®
, cÚ¡ &
Ãwv®
) {

84  
	`__sync_boŞ_com·»_ªd_sw­
(
»š‹½»t_ÿ¡
<
ušt64_t
*>(&
a
),

85 *
»š‹½»t_ÿ¡
<cÚ¡ 
ušt64_t
*>(&
Şdv®
),

86 *
»š‹½»t_ÿ¡
<cÚ¡ 
ušt64_t
*>(&
Ãwv®
));

87 
	}
};

89 
	g‹m¶©e
 <>

90 
šlše
 
boŞ
 
	$©omic_com·»_ªd_sw­
(& 
a
, cÚ¡ &
Şdv®
, cÚ¡ &
Ãwv®
) {

91  
	`__sync_boŞ_com·»_ªd_sw­
(
»š‹½»t_ÿ¡
<
ušt32_t
*>(&
a
),

92 *
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
*>(&
Şdv®
),

93 *
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
*>(&
Ãwv®
));

94 
	}
};

96 
	g‹m¶©e
<
ty³Çme
 
	gT
>

97 
	$©omic_exchªge
(
T
& 
a
, T& 
b
) {

98 
b
 =
	`__sync_lock_‹¡_ªd_£t
(&
a
, b);

99 
	}
};

	@src/util/cmdopts.hpp

29 #iâdeà
GRAPHCHI_CMDOPTS_DEF


30 
	#GRAPHCHI_CMDOPTS_DEF


	)

33 
	~<¡ršg
>

34 
	~<io¡»am
>

35 
	~<¡dšt.h
>

37 
	~"­i/chif’ames.hµ
"

38 
	~"ut/cÚfigfe.hµ
"

40 
Çme¥aû
 
	gg¿phchi
 {

44 #ifdeà
__GNUC__


45 
	#VARIABLE_IS_NOT_USED
 
	`__©Œibu‹__
 ((
unu£d
))

	)

47 
	#VARIABLE_IS_NOT_USED


	)

50 
boŞ
 
	g_cmd_cÚfigu»d
 = 
çl£
;

52 
	g_¬gc
;

53 **
	g_¬gv
;

54 
	g¡d
::
m­
<
¡d
::
¡ršg
, std::¡ršg> 
cÚf
;

57 
VARIABLE_IS_NOT_USED
 
£t_cÚf
(
¡d
::
¡ršg
 
key
, std::¡ršg 
v®ue
) {

58 
cÚf
[
key
] = 
v®ue
;

62 
	g¡d
::
¡ršg
 
VARIABLE_IS_NOT_USED
 
g‘_cÚfig_İtiÚ_¡ršg
(cÚ¡ *
İtiÚ_Çme
) {

63 ià(
cÚf
.
fšd
(
İtiÚ_Çme
è!ğcÚf.
’d
()) {

64  
cÚf
[
İtiÚ_Çme
];

66 
	g¡d
::
cout
 << "ERROR: could‚Ù fšd o±iÚ " << 
İtiÚ_Çme
 << " from config.";

67 
as£¹
(
çl£
);

71 
	g¡d
::
¡ršg
 
VARIABLE_IS_NOT_USED
 
g‘_cÚfig_İtiÚ_¡ršg
(cÚ¡ *
İtiÚ_Çme
,

72 
¡d
::
¡ršg
 
deçuÉ_v®ue
) {

73 ià(
cÚf
.
fšd
(
İtiÚ_Çme
è!ğcÚf.
’d
()) {

74  
cÚf
[
İtiÚ_Çme
];

76  
	gdeçuÉ_v®ue
;

80 
VARIABLE_IS_NOT_USED
 
g‘_cÚfig_İtiÚ_št
(cÚ¡ *
İtiÚ_Çme
, 
deçuÉ_v®ue
) {

81 ià(
	gcÚf
.
fšd
(
İtiÚ_Çme
è!ğ
cÚf
.
’d
()) {

82  
©oi
(
cÚf
[
İtiÚ_Çme
].
c_¡r
());

84  
	gdeçuÉ_v®ue
;

88 
VARIABLE_IS_NOT_USED
 
g‘_cÚfig_İtiÚ_št
(cÚ¡ *
İtiÚ_Çme
) {

89 ià(
	gcÚf
.
fšd
(
İtiÚ_Çme
è!ğ
cÚf
.
’d
()) {

90  
©oi
(
cÚf
[
İtiÚ_Çme
].
c_¡r
());

92 
	g¡d
::
cout
 << "ERROR: could‚Ù fšd o±iÚ " << 
İtiÚ_Çme
 << " from config.";

93 
as£¹
(
çl£
);

97 
ušt64_t
 
VARIABLE_IS_NOT_USED
 
g‘_cÚfig_İtiÚ_lÚg
(cÚ¡ *
İtiÚ_Çme
, ušt64_ˆ
deçuÉ_v®ue
) {

98 ià(
	gcÚf
.
fšd
(
İtiÚ_Çme
è!ğ
cÚf
.
’d
()) {

99  
©Ş
(
cÚf
[
İtiÚ_Çme
].
c_¡r
());

101  
	gdeçuÉ_v®ue
;

104 
VARIABLE_IS_NOT_USED
 
g‘_cÚfig_İtiÚ_doubË
(cÚ¡ *
İtiÚ_Çme
, 
deçuÉ_v®ue
) {

105 ià(
	gcÚf
.
fšd
(
İtiÚ_Çme
è!ğ
cÚf
.
’d
()) {

106  
©of
(
cÚf
[
İtiÚ_Çme
].
c_¡r
());

108  
	gdeçuÉ_v®ue
;

112 
£t_¬gc
(
¬gc
, cÚ¡ ** 
¬gv
);

113 
£t_¬gc
(
¬gc
, cÚ¡ ** 
¬gv
) {

114 
	g_¬gc
 = 
¬gc
;

115 
	g_¬gv
 = (**)
¬gv
;

116 
	g_cmd_cÚfigu»d
 = 
Œue
;

117 
	gcÚf
 = 
lßdcÚfig
(
f’ame_cÚfig_loÿl
(), 
f’ame_cÚfig
());

120 
	g¡d
::
¡ršg
 
´efix
 = "--";

121 
	gi
 = 1; i < 
	g¬gc
; i++) {

122 
	g¡d
::
¡ršg
 
¬g
 = 
¡d
::¡ršg(
_¬gv
[
i
]);

124 ià(
	g¬g
.
sub¡r
(0, 
´efix
.
size
()) ==…refix) {

125 
¬g
 =‡rg.
sub¡r
(
´efix
.
size
());

126 
size_t
 
	ga
 = 
¬g
.
fšd_fœ¡_of
("=", 0);

127 ià(
	ga
 !ğ
¬g
.
Åos
) {

128 
¡d
::
¡ršg
 
key
 = 
¬g
.
sub¡r
(0, 
a
);

129 
	g¡d
::
¡ršg
 
v®
 = 
¬g
.
sub¡r
(
a
 + 1);

131 
	g¡d
::
cout
 << "[" << 
key
 << "]" << " => " << "[" << 
v®
 << "]" << 
¡d
::
’dl
;

132 
	gcÚf
[
key
] = 
v®
;

139 
g¿phchi_š™
(
¬gc
, cÚ¡ ** 
¬gv
);

140 
g¿phchi_š™
(
¬gc
, cÚ¡ ** 
¬gv
) {

141 
£t_¬gc
(
¬gc
, 
¬gv
);

144 
check_cmd_š™
() {

145 ià(!
	g_cmd_cÚfigu»d
) {

146 
	g¡d
::
cout
 << "ERROR: commªd†šİtiÚ nÙ in™Ÿlized." << 
¡d
::
’dl
;

147 
	g¡d
::
cout
 << " You‚“dØÿÎ s‘_¬gc(èšhbegšnšg oàth´og¿m." << 
¡d
::
’dl
;

154 
	g¡d
::
¡ršg
 
VARIABLE_IS_NOT_USED
 
g‘_İtiÚ_¡ršg
(cÚ¡ *
İtiÚ_Çme
,

155 
¡d
::
¡ršg
 
deçuÉ_v®ue
)

157 
check_cmd_š™
();

158 
	gi
;

160 
	gi
 = 
_¬gc
 - 2; i >= 0; i -= 1)

161 ià(
¡rcmp
(
_¬gv
[
i
], 
İtiÚ_Çme
) == 0)

162  
¡d
::
¡ršg
(
_¬gv
[
i
 + 1]);

163  
g‘_cÚfig_İtiÚ_¡ršg
(
İtiÚ_Çme
, 
deçuÉ_v®ue
);

166 
	g¡d
::
¡ršg
 
VARIABLE_IS_NOT_USED
 
g‘_İtiÚ_¡ršg
(cÚ¡ *
İtiÚ_Çme
)

168 
i
;

169 
check_cmd_š™
();

171 
	gi
 = 
_¬gc
 - 2; i >= 0; i -= 1)

172 ià(
¡rcmp
(
_¬gv
[
i
], 
İtiÚ_Çme
) == 0)

173  
¡d
::
¡ršg
(
_¬gv
[
i
 + 1]);

174  
g‘_cÚfig_İtiÚ_¡ršg
(
İtiÚ_Çme
);

177 
	g¡d
::
¡ršg
 
VARIABLE_IS_NOT_USED
 
g‘_İtiÚ_¡ršg_š‹¿ùive
(cÚ¡ *
İtiÚ_Çme
, 
¡d
::¡ršg 
İtiÚs
)

179 
i
;

180 
check_cmd_š™
();

182 
	gi
 = 
_¬gc
 - 2; i >= 0; i -= 1)

183 ià(
¡rcmp
(
_¬gv
[
i
], 
İtiÚ_Çme
) == 0)

184  
¡d
::
¡ršg
(
_¬gv
[
i
 + 1]);

185 ià(
	gcÚf
.
fšd
(
İtiÚ_Çme
è!ğ
cÚf
.
’d
()) {

186  
cÚf
[
İtiÚ_Çme
];

189 
	g¡d
::
cout
 << "PËa£ƒÁ” v®ufÜ commªd-lš¬gum’ˆ[" << 
¡d
::
¡ršg
(
İtiÚ_Çme
è<< "]"<< std::
’dl
;

190 
	g¡d
::
cout
 << " (O±iÚ ¬e: " << 
İtiÚs
 << ")" << 
¡d
::
’dl
;

192 
	g¡d
::
¡ršg
 
v®
;

193 
	g¡d
::
cš
 >> 
v®
;

195  
	gv®
;

202 
VARIABLE_IS_NOT_USED
 
g‘_İtiÚ_št
(cÚ¡ *
İtiÚ_Çme
, 
deçuÉ_v®ue
)

204 
	gi
;

205 
check_cmd_š™
();

207 
	gi
 = 
_¬gc
 - 2; i >= 0; i -= 1)

208 ià(
¡rcmp
(
_¬gv
[
i
], 
İtiÚ_Çme
) == 0)

209  
©oi
(
_¬gv
[
i
 + 1]);

211  
g‘_cÚfig_İtiÚ_št
(
İtiÚ_Çme
, 
deçuÉ_v®ue
);

214 
VARIABLE_IS_NOT_USED
 
g‘_İtiÚ_št
(cÚ¡ *
İtiÚ_Çme
)

216 
	gi
;

217 
check_cmd_š™
();

219 
	gi
 = 
_¬gc
 - 2; i >= 0; i -= 1)

220 ià(
¡rcmp
(
_¬gv
[
i
], 
İtiÚ_Çme
) == 0)

221  
©oi
(
_¬gv
[
i
 + 1]);

223  
g‘_cÚfig_İtiÚ_št
(
İtiÚ_Çme
);

229 
ušt64_t
 
VARIABLE_IS_NOT_USED
 
g‘_İtiÚ_lÚg
(cÚ¡ *
İtiÚ_Çme
, ušt64_ˆ
deçuÉ_v®ue
)

231 
	gi
;

232 
check_cmd_š™
();

234 
	gi
 = 
_¬gc
 - 2; i >= 0; i -= 1)

235 ià(
¡rcmp
(
_¬gv
[
i
], 
İtiÚ_Çme
) == 0)

236  
©Ş
(
_¬gv
[
i
 + 1]);

237  
g‘_cÚfig_İtiÚ_lÚg
(
İtiÚ_Çme
, 
deçuÉ_v®ue
);

240 
VARIABLE_IS_NOT_USED
 
g‘_İtiÚ_æßt
(cÚ¡ *
İtiÚ_Çme
, 
deçuÉ_v®ue
)

242 
	gi
;

243 
check_cmd_š™
();

245 
	gi
 = 
_¬gc
 - 2; i >= 0; i -= 1)

246 ià(
¡rcmp
(
_¬gv
[
i
], 
İtiÚ_Çme
) == 0)

247  ()
©of
(
_¬gv
[
i
 + 1]);

248  (è
g‘_cÚfig_İtiÚ_doubË
(
İtiÚ_Çme
, 
deçuÉ_v®ue
);

	@src/util/configfile.hpp

30 #iâdeà
GRAPHCHI_CONFIGFILE_DEF


31 
	#GRAPHCHI_CONFIGFILE_DEF


	)

33 
	~<io¡»am
>

34 
	~<c¡dio
>

35 
	~<¡ršg
>

36 
	~<m­
>

37 
	~<as£¹.h
>

39 
Çme¥aû
 
	gg¿phchi
 {

43 cÚ¡ 
	g¡d
::
¡ršg
 
wh™eS·ûs
( " \f\n\r\t\v" );

46 
ŒimRight
Ğ
¡d
::
¡ršg
 &
¡r
,

47 cÚ¡ 
¡d
::
¡ršg
& 
ŒimCh¬s
 )

49 
¡d
::
¡ršg
::
size_ty³
 
pos
 = 
¡r
.
fšd_Ï¡_nÙ_of
Ğ
ŒimCh¬s
 );

50 
	g¡r
.
”a£
Ğ
pos
 + 1 );

54 
ŒimLeá
Ğ
¡d
::
¡ršg
 &
¡r
,

55 cÚ¡ 
¡d
::
¡ršg
& 
ŒimCh¬s
 )

57 
¡d
::
¡ršg
::
size_ty³
 
pos
 = 
¡r
.
fšd_fœ¡_nÙ_of
Ğ
ŒimCh¬s
 );

58 
	g¡r
.
”a£
Ğ0, 
pos
 );

62 
	g¡d
::
¡ršg
 
Œim
Ğ
¡d
::¡ršg 
¡r
)

64 
¡d
::
¡ršg
 
ŒimCh¬s
 = " \f\n\r\t\v";

65 
ŒimRight
Ğ
¡r
, 
ŒimCh¬s
 );

66 
ŒimLeá
Ğ
¡r
, 
ŒimCh¬s
 );

67  
	g¡r
;

72 
_FIXLINE
(* 
s
) {

73 
	gËn
 = ()
¡¾’
(
s
)-1;

74 if(
	gs
[
Ën
] =ğ'\n'è
s
[len] = 0;

83 
	g¡d
::
m­
<
¡d
::
¡ršg
, std::¡ršg> 
lßdcÚfig
(¡d::¡ršg 
f’ame
, std::¡ršg 
£cÚd¬y_f’ame
) {

84 
FILE
 * 
f
 = 
fİ’
(
f’ame
.
c_¡r
(), "r");

85 ià(
	gf
 =ğ
NULL
) {

86 
f
 = 
fİ’
(
£cÚd¬y_f’ame
.
c_¡r
(), "r");

87 ià(
	gf
 =ğ
NULL
) {

88 
¡d
::
cout
 << "ERROR: Could‚Ù„—d cÚfigu¿tiÚ fe: " << 
f’ame
 << std::
’dl
;

89 
	g¡d
::
cout
 << "PËa£ defš’vœÚm’ˆv¬ŸbË GRAPHCHI_ROOT o¸ruÀth´og¿m fromh© dœeùÜy." << 
¡d
::
’dl
;

91 
as£¹
(
f
 !ğ
NULL
);

94 
	gs
[4096];

95 
	g¡d
::
m­
<
¡d
::
¡ršg
, std::¡ršg> 
cÚf
;

98 
fg‘s
(
s
, 4096, 
f
è!ğ
NULL
) {

99 
_FIXLINE
(
s
);

100 ià(
	gs
[0] == '#') ;

101 ià(
	gs
[0] == '%') ;

103 
	gd–ims
[] = "=";

104 * 
	gt
;

105 
	gt
 = 
¡¹ok
(
s
, 
d–ims
);

106 cÚ¡ * 
	gckey
 = 
t
;

107 
	gt
 = 
¡¹ok
(
NULL
, 
d–ims
);

108 cÚ¡ * 
	gcv®
 = 
t
;

110 ià(
	gckey
 !ğ
NULL
 && 
cv®
 != NULL) {

111 
¡d
::
¡ršg
 
key
 = 
Œim
(¡d::¡ršg(
ckey
));

112 
	g¡d
::
¡ršg
 
v®
 = 
Œim
(
¡d
::¡ršg(
cv®
));

113 
	gcÚf
[
key
] = 
v®
;

118  
	gcÚf
;

	@src/util/dense_bitset.hpp

4 #iâdeà
DENSE_BITSET_HPP


5 
	#DENSE_BITSET_HPP


	)

6 
	~<c¡dio
>

7 
	~<c¡dlib
>

8 
	~<¡dšt.h
>

10 
Çme¥aû
 
	gg¿phchi
 {

11 şas 
	cd’£_b™£t
 {

12 
	gpublic
:

13 
d’£_b™£t
(è: 
¬¿y
(
NULL
), 
Ën
(0) {

14 
g’”©e_b™_masks
();

17 
d’£_b™£t
(
size_t
 
size
è: 
¬¿y
(
NULL
), 
Ën
(size) {

18 
»size
(
size
);

19 
ş—r
();

20 
g’”©e_b™_masks
();

24 
	gvœtu®
 ~
d’£_b™£t
(è{
ä“
(
¬¿y
);}

26 
»size
(
size_t
 
n
) {

27 
	gËn
 = 
n
;

29 
	g¬¾’
 = 
n
 / (8*(
size_t
)) + 1;

30 
	g¬¿y
 = (
size_t
*)
»®loc
(
¬¿y
, (size_tè* 
¬¾’
);

33 
ş—r
() {

34 
size_t
 
	gi
 = 0;˜< 
	g¬¾’
; ++iè
	g¬¿y
[
i
] = 0;

37 
£Î
() {

38 
mem£t
(
¬¿y
, 0xff, 
¬¾’
 * (
size_t
));

41 
šlše
 
boŞ
 
g‘
(
ušt32_t
 
b
) const{

42 
ušt32_t
 
	g¬½os
, 
	gb™pos
;

43 
b™_to_pos
(
b
, 
¬½os
, 
b™pos
);

44  
	g¬¿y
[
¬½os
] & (
size_t
(1è<< size_t(
b™pos
));

48 
šlše
 
boŞ
 
£t_b™
(
ušt32_t
 
b
) {

50 
ušt32_t
 
	g¬½os
, 
	gb™pos
;

51 
b™_to_pos
(
b
, 
¬½os
, 
b™pos
);

52 cÚ¡ 
size_t
 
mask
(size_t(1è<< size_t(
b™pos
));

53  
__sync_ãtch_ªd_Ü
(
¬¿y
 + 
¬½os
, 
mask
è& 
	gmask
;

57 
šlše
 
boŞ
 
£t
(
ušt32_t
 
b
, boŞ 
v®ue
) {

58 ià(
	gv®ue
è 
£t_b™
(
b
);

59  
ş—r_b™
(
b
);

63 
šlše
 
boŞ
 
ş—r_b™
(
ušt32_t
 
b
) {

65 
ušt32_t
 
	g¬½os
, 
	gb™pos
;

66 
b™_to_pos
(
b
, 
¬½os
, 
b™pos
);

67 cÚ¡ 
size_t
 
‹¡_mask
(size_t(1è<< size_t(
b™pos
));

68 cÚ¡ 
size_t
 
ş—r_mask
(~
‹¡_mask
);

69  
__sync_ãtch_ªd_ªd
(
¬¿y
 + 
¬½os
, 
ş—r_mask
è& 
	g‹¡_mask
;

72 
šlše
 
ş—r_b™s
(
ušt32_t
 
äomb
, ušt32_ˆ
tob
) {

74 cÚ¡ 
size_t
 
	gb™¥”wÜd
 = (size_t)*8;

75 (
	gäomb
%
	gb™¥”wÜd
 != 0)) {

76 
ş—r_b™
(
äomb
);

77 ià(
	gäomb
>=
tob
) ;

78 
	gäomb
++;

81 (
	gtob
%
	gb™¥”wÜd
 != 0)) {

82 
ş—r_b™
(
tob
);

83 if(
	gtob
<=
äomb
) ;

84 
	gtob
--;

86 
ş—r_b™
(
tob
);

88 
ušt32_t
 
	gäom_¬½os
 = 
äomb
 / (8 * (è(
size_t
));

89 
ušt32_t
 
	gto_¬½os
 = 
tob
 / (8 * (è(
size_t
));

90 
mem£t
(&
¬¿y
[
äom_¬½os
], 0, (
to_¬½os
-äom_¬½osè* (è(
size_t
));

94 
šlše
 
size_t
 
size
() const {

95  
	gËn
;

98 
	g´iv©e
:

101 
šlše
 
b™_to_pos
(
ušt32_t
 
b
, ušt32_ˆ&
¬½os
, ušt32_ˆ&
b™pos
) {

103 
	g¬½os
 = 
b
 / (8 * ()(
size_t
));

104 
	gb™pos
 = 
b
 & (8 * ()(
size_t
) - 1);

107 
g’”©e_b™_masks
() {

108 
	gb–ow_£Ëùedb™
[0] = 
size_t
(-2);

109 
size_t
 
	gi
 = 0;˜< 8 * (
	gsize_t
) ; ++i) {

110 
	g£Ëùb™
[
i
] = 
size_t
(1) << i;

111 
	gnÙ£Ëùb™
[
i
] = ~
£Ëùb™
[i];

112 ià(
	gi
 > 0è
	gb–ow_£Ëùedb™
[
i
] = 
b–ow_£Ëùedb™
[i-1] - 
£Ëùb™
[i];

117 
šlše
 
size_t
 
Ãxt_b™_š_block
(cÚ¡ 
ušt32_t
 &
b
, cÚ¡ size_ˆ&
block
) {

119 
size_t
 
	gx
 = 
block
 & 
b–ow_£Ëùedb™
[
b
] ;

120 ià(
	gx
 == 0)  0;

121  
__butš_ùzl
(
x
);

125 
šlše
 
size_t
 
fœ¡_b™_š_block
(cÚ¡ size_ˆ&
block
) {

127 ià(
	gblock
 == 0)  0;

128  
__butš_ùzl
(
block
);

131 
size_t
* 
	g¬¿y
;

132 
size_t
 
	gËn
;

133 
size_t
 
	g¬¾’
;

135 
size_t
 
	g£Ëùb™
[8 * (size_t)];

136 
size_t
 
	gnÙ£Ëùb™
[8 * (size_t)];

137 
size_t
 
	gb–ow_£Ëùedb™
[8 * (size_t)];

	@src/util/ioutil.hpp

28 #iâdeà
DEF_IOUTIL_HPP


29 
	#DEF_IOUTIL_HPP


	)

31 
	~<uni¡d.h
>

32 
	~<as£¹.h
>

33 
	~<¡dlib.h
>

34 
	~<”ºo.h
>

35 
	~<zlib.h
>

39 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

40 
	$´—da
(
f
, 
T
 * 
tbuf
, 
size_t
 
nby‹s
, size_ˆ
off
) {

41 
size_t
 
Ä—d
 = 0;

42 * 
buf
 = (*)
tbuf
;

43 
Ä—d
<
nby‹s
) {

44 
ssize_t
 
a
 = 
	`´—d
(
f
, 
buf
, 
nby‹s
 - 
Ä—d
, 
off
 +‚read);

45 ià(
a
 == (-1)) {

46 
¡d
::
cout
 << "E¼Ü, could‚Ù„—d: " << 
	`¡»¼Ü
(
”ºo
è<< "; fe-desc: " << 
f
 << std::
’dl
;

47 
¡d
::
cout
 << "P»ad‡rgum’ts: " << 
f
 << "buf: " << 
tbuf
 << "‚by‹s: " << 
nby‹s
 << " off: " << 
off
 << std::
’dl
;

48 
	`as£¹
(
a
 != (-1));

50 
	`as£¹
(
a
>0);

51 
buf
 +ğ
a
;

52 
Ä—d
 +ğ
a
;

54 
	`as£¹
(
Ä—d
 <ğ
nby‹s
);

55 
	}
}

57 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

58 
	$´—da_Œunc
(
f
, 
T
 * 
tbuf
, 
size_t
 
nby‹s
, size_ˆ
off
) {

59 
size_t
 
Ä—d
 = 0;

60 * 
buf
 = (*)
tbuf
;

61 
Ä—d
<
nby‹s
) {

62 
size_t
 
a
 = 
	`´—d
(
f
, 
buf
, 
nby‹s
-
Ä—d
, 
off
+nread);

63 ià(
a
 == 0) {

66 
	`mem£t
(
buf
, 0, 
nby‹s
-
Ä—d
);

69 
buf
 +ğ
a
;

70 
Ä—d
 +ğ
a
;

73 
	}
}

75 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

76 
size_t
 
	$»adfuÎ
(
f
, 
T
 ** 
buf
) {

77 
off_t
 
sz
 = 
	`l£ek
(
f
, 0, 
SEEK_END
);

78 
	`l£ek
(
f
, 0, 
SEEK_SET
);

79 *
buf
 = (*)
	`m®loc
(
sz
);

80 
	`´—da
(
f
, *
buf
, 
sz
, 0);

81  
sz
;

82 
	}
}

83 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

84 
	$pwr™—
(
f
, 
T
 * 
tbuf
, 
size_t
 
nby‹s
, size_ˆ
off
) {

85 
size_t
 
nwr™‹n
 = 0;

86 
	`as£¹
(
f
>0);

87 * 
buf
 = (*)
tbuf
;

88 
nwr™‹n
<
nby‹s
) {

89 
size_t
 
a
 = 
	`pwr™e
(
f
, 
buf
, 
nby‹s
-
nwr™‹n
, 
off
+nwritten);

90 ià(
a
 =ğ
	`size_t
(-1)) {

91 
	`log¡»am
(
LOG_ERROR
è<< "f:" << 
f
 << "‚by‹s: " << 
nby‹s
 << " wr™‹n: " << 
nwr™‹n
 << " off:" <<

92 
off
 << " f: " << 
f
 << "ƒ¼Ü:" << 
	`¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

93 
	`as£¹
(
çl£
);

95 
	`as£¹
(
a
>0);

96 
buf
 +ğ
a
;

97 
nwr™‹n
 +ğ
a
;

99 
	}
}

104 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

105 
check¬¿y_fesize
(
¡d
::
¡ršg
 
âame
, 
size_t
 
ÃËm’ts
) {

107 
	gf
 = 
İ’
(
âame
.
c_¡r
(), 
O_RDWR
 | 
O_CREAT
, 
S_IROTH
 | 
S_IWOTH
 | 
S_IWUSR
 | 
S_IRUSR
);

108 ià(
	gf
 < 1) {

109 
log¡»am
(
LOG_ERROR
è<< "E¼Ü in™Ÿlizšghd©a-fe: " << 
	gâame
 << "ƒ¼Ü:" << 
¡»¼Ü
(
”ºo
è<< 
	g¡d
::
’dl
; }

110 
as£¹
(
f
>0);

111 
	g”r
 = 
árunÿ‹
(
f
, 
ÃËm’ts
 * (
T
));

112 ià(
	g”r
 != 0) {

113 
log¡»am
(
LOG_ERROR
è<< "E¼Ü iÀadju¡šg fsize: " << 
âame
 << "Øsize: " << 
ÃËm’ts
 * (
T
)

114 << "ƒ¼Ü:" << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

116 
as£¹
(
”r
 == 0);

117 
şo£
(
f
);

120 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

121 
	$wr™—
(
f
, 
T
 * 
tbuf
, 
size_t
 
nby‹s
) {

122 
size_t
 
nwr™‹n
 = 0;

123 * 
buf
 = (*)
tbuf
;

124 
nwr™‹n
<
nby‹s
) {

125 
size_t
 
a
 = 
	`wr™e
(
f
, 
buf
, 
nby‹s
-
nwr™‹n
);

126 
	`as£¹
(
a
>0);

127 ià(
a
 =ğ
	`size_t
(-1)) {

128 
	`log¡»am
(
LOG_ERROR
è<< "Could‚Ù wr™" << (
nby‹s
-
nwr™‹n
è<< " by‹s!" << "ƒ¼Ü:" << 
	`¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

129 
	`as£¹
(
çl£
);

131 
buf
 +ğ
a
;

132 
nwr™‹n
 +ğ
a
;

135 
	}
}

143 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

144 
size_t
 
	$wr™e_com´es£d
(
f
, 
T
 * 
tbuf
, 
size_t
 
nby‹s
) {

145 * 
buf
 = (*)
tbuf
;

146 
»t
;

147 
have
;

148 
z_¡»am
 
¡rm
;

149 
CHUNK
 = (è
¡d
::
	`max
((
size_t
)4096 * 1024, 
nby‹s
);

150 * 
out
 = (*è
	`m®loc
(
CHUNK
);

151 
	`l£ek
(
f
, 0, 
SEEK_SET
);

154 
¡rm
.
z®loc
 = 
Z_NULL
;

155 
¡rm
.
zä“
 = 
Z_NULL
;

156 
¡rm
.
İaque
 = 
Z_NULL
;

157 
»t
 = 
	`deæ©eIn™
(&
¡rm
, 
Z_BEST_SPEED
);

158 ià(
»t
 !ğ
Z_OK
)

159 
	`as£¹
(
çl£
);

162 
¡rm
.
ava_š
 = (è
nby‹s
;

163 
¡rm
.
Ãxt_š
 = 
buf
;

165 
Œ”r
 = 
	`árunÿ‹
(
f
, 0);

166 
	`as£¹
 (
Œ”r
 == 0);

167 
size_t
 
tÙwr™‹n
 = 0;

172 
¡rm
.
ava_out
 = 
CHUNK
;

173 
¡rm
.
Ãxt_out
 = 
out
;

174 
»t
 = 
	`deæ©e
(&
¡rm
, 
Z_FINISH
);

175 
	`as£¹
(
»t
 !ğ
Z_STREAM_ERROR
);

176 
have
 = 
CHUNK
 - 
¡rm
.
ava_out
;

177 ià(
	`wr™e
(
f
, 
out
, 
have
) != have) {

178 ()
	`deæ©eEnd
(&
¡rm
);

179 
	`as£¹
(
çl£
);

181 
tÙwr™‹n
 +ğ
have
;

182 } 
¡rm
.
ava_out
 == 0);

183 
	`as£¹
(
¡rm
.
ava_š
 == 0);

185 
	`as£¹
(
»t
 =ğ
Z_STREAM_END
);

188 ()
	`deæ©eEnd
(&
¡rm
);

189 
	`ä“
(
out
);

190  
tÙwr™‹n
;

191 
	}
}

194 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

195 
	$»ad_com´es£d
(
f
, 
T
 * 
tbuf
, 
size_t
 
nby‹s
) {

196 * 
buf
 = (*)
tbuf
;

197 
»t
;

198 
have
;

199 
z_¡»am
 
¡rm
;

200 
CHUNK
 = (è
¡d
::
	`max
((
size_t
)4096 * 1024, 
nby‹s
);

202 
size_t
 
fsize
 = 
	`l£ek
(
f
, 0, 
SEEK_END
);

204 * 
š
 = (*è
	`m®loc
(
fsize
);

205 
	`l£ek
(
f
, 0, 
SEEK_SET
);

208 
¡rm
.
z®loc
 = 
Z_NULL
;

209 
¡rm
.
zä“
 = 
Z_NULL
;

210 
¡rm
.
İaque
 = 
Z_NULL
;

211 
¡rm
.
ava_š
 = 0;

212 
¡rm
.
Ãxt_š
 = 
Z_NULL
;

213 
»t
 = 
	`šæ©eIn™
(&
¡rm
);

214 ià(
»t
 !ğ
Z_OK
)

215 
	`as£¹
(
çl£
);

219 
ssize_t
 
a
 = 0;

221 
a
 = 
	`»ad
(
f
, 
š
 + 
¡rm
.
ava_š
, 
fsize
 - strm.avail_in);

222 
¡rm
.
ava_š
 +ğ(è
a
;

223 
	`as£¹
(
a
 !ğ(
ssize_t
)(-1));

224 } 
a
 > 0);

226 ià(
¡rm
.
ava_š
 == 0)

228 
¡rm
.
Ãxt_š
 = 
š
;

232 
¡rm
.
ava_out
 = 
CHUNK
;

233 
¡rm
.
Ãxt_out
 = 
buf
;

234 
»t
 = 
	`šæ©e
(&
¡rm
, 
Z_NO_FLUSH
);

235 
	`as£¹
(
»t
 !ğ
Z_STREAM_ERROR
);

236 
»t
) {

237 
Z_NEED_DICT
:

238 
»t
 = 
Z_DATA_ERROR
;

239 
Z_DATA_ERROR
:

240 
Z_MEM_ERROR
:

241 
	`as£¹
(
çl£
);

243 
have
 = 
CHUNK
 - 
¡rm
.
ava_out
;

244 
buf
 +ğ
have
;

245 } 
¡rm
.
ava_out
 == 0);

248 } 
»t
 !ğ
Z_STREAM_END
);

251 ()
	`šæ©eEnd
(&
¡rm
);

252 
	`ä“
(
š
);

253 
	}
}

	@src/util/labelanalysis.hpp

33 
	~<veùÜ
>

34 
	~<®gÜ™hm
>

35 
	~<”ºo.h
>

36 
	~<as£¹.h
>

38 
	~"io/¡redio.hµ
"

39 
	~"logg”/logg”.hµ
"

40 
	~"ut/m”ge.hµ
"

41 
	~"ut/iout.hµ
"

42 
	~"ut/qsÜt.hµ
"

43 
	~"­i/chif’ames.hµ
"

44 
	~"’gše/auxd©a/v”‹x_d©a.hµ
"

47 #iâdeà
DEF_GRAPHCHI_LABELANALYSIS


48 
	#DEF_GRAPHCHI_LABELANALYSIS


	)

50 
usšg
 
Çme¥aû
 
	gg¿phchi
;

52 
	g‹m¶©e
 <
ty³Çme
 
	gLab–Ty³
>

53 
	sÏb–couÁ_‰
 {

54 
Lab–Ty³
 
	mÏb–
;

55 
	mcouÁ
;

56 
Ïb–couÁ_‰
(
Lab–Ty³
 
l
, 
c
è: 
Ïb–
Ö), 
couÁ
(c) {}

57 
Ïb–couÁ_‰
() {}

60 
	g‹m¶©e
 <
ty³Çme
 
	gLab–Ty³
>

61 
boŞ
 
Ïb–_couÁ_g»©”
(cÚ¡ 
Ïb–couÁ_‰
<
Lab–Ty³
> &
a
, cÚ¡†ab–couÁ_‰<Lab–Ty³> &
b
) {

62  
	ga
.
	gcouÁ
 > 
	gb
.count;

65 
	g‹m¶©e
 <
ty³Çme
 
	gLab–Ty³
>

66 
ª®yze_Ïb–s
(
¡d
::
¡ršg
 
ba£f’ame
, 
´š‰İ
 = 20) {

67 
Ïb–couÁ_‰
<
	tLab–Ty³
> 
	tÏb–couÁ_t
;

73 
m‘rics
 
m
("labelanalysis");

74 
¡redio
 * 
	giomgr
 = 
Ãw
 sŒedio(
m
);

77 
vid_t
 
	g»adwšdow
 = 1024 * 1024;

78 
vid_t
 
	gnumv”tiûs
 = (vid_tè
g‘_num_v”tiûs
(
ba£f’ame
);

79 
	gv”‹x_d©a_¡Üe
<
	gLab–Ty³
> * 
	gv”‹xd©a
 =

80 
Ãw
 
v”‹x_d©a_¡Üe
<
Lab–Ty³
>(
ba£f’ame
, 
	gnumv”tiûs
, 
	giomgr
);

82 
	g¡d
::
veùÜ
<
Ïb–couÁ_t
> 
cu¾ab–s
;

83 
boŞ
 
	gfœ¡
 = 
Œue
;

84 
vid_t
 
	gcurvid
 = 0;

85 
Lab–Ty³
 * 
	gbufãr
 = (Lab–Ty³*è
ÿÎoc
(
»adwšdow
, (LabelType));

88 
vid_t
 
	g¡
 = 0;

89 
vid_t
 
	g’
 = 
numv”tiûs
 - 1;

91 
	g¡
 <ğ
numv”tiûs
 - 1) {

92 
’
 = 
¡
 + 
»adwšdow
 - 1;

93 ià(
	g’
 >ğ
numv”tiûs
 - 1è
’
 =‚umvertices - 1;

96 
	gv”‹xd©a
->
lßd
(
¡
, 
’
);

98 
	gÁ
 = 
’
 - 
¡
 + 1;

101 
	gi
=0; i < 
	gÁ
; i++) {

102 
Lab–Ty³
 
	gl
 = *
v”‹xd©a
->
v”‹x_d©a_±r
(
i
 + 
¡
);

103 ià(
	gl
 =ğ
curvid
è
bufãr
[
i
] = 0xffffffff;

104 
	gbufãr
[
i
] = 
l
;

105 
	gcurvid
++;

109 
quickSÜt
(
bufãr
, 
Á
, 
¡d
::
Ëss
<
Lab–Ty³
>());

112 
	g¡d
::
veùÜ
<
Ïb–couÁ_t
> 
ÃwÏb–s
;

113 
	gÃwÏb–s
.
»£rve
(
Á
);

114 
vid_t
 
	gÏ¡Ïb–
 = 0xffffffff;

115 
	gi
=0; i < 
	gÁ
; i++) {

116 ià(
	gbufãr
[
i
] != 0xffffffff) {

117 ià(
bufãr
[
i
] !ğ
Ï¡Ïb–
) {

118 
ÃwÏb–s
.
push_back
(
Ïb–couÁ_t
(
bufãr
[
i
], 1));

120 
	gÃwÏb–s
[
ÃwÏb–s
.
size
(è- 1].
	gcouÁ
 ++;

122 
	gÏ¡Ïb–
 = 
bufãr
[
i
];

126 ià(
	gfœ¡
) {

127 
	gi
=0; i < ()
	gÃwÏb–s
.
size
(); i++) {

128 
	gcu¾ab–s
.
push_back
(
ÃwÏb–s
[
i
]);

133 
	gş
 = 0;

134 
	gÆ
 = 0;

135 
	g¡d
::
veùÜ
< 
Ïb–couÁ_t
 > 
m”ged
;

136 
	gm”ged
.
»£rve
(
cu¾ab–s
.
size
(è+ 
ÃwÏb–s
.size());

137 
	gş
 < ()
	gcu¾ab–s
.
size
(è&& 
	gÆ
 < ()
	gÃwÏb–s
.size()) {

138 ià(
	gÃwÏb–s
[
Æ
].
	gÏb–
 =ğ
cu¾ab–s
[
ş
].
Ïb–
) {

139 
m”ged
.
push_back
(
Ïb–couÁ_t
(
ÃwÏb–s
[
Æ
].
Ïb–
,‚ewÏb–s[Æ].
couÁ
 + 
cu¾ab–s
[
ş
].count));

140 
	gÆ
++; 
	gş
++;

142 ià(
	gÃwÏb–s
[
Æ
].
	gÏb–
 < 
	gcu¾ab–s
[
ş
].label) {

143 
	gm”ged
.
push_back
(
ÃwÏb–s
[
Æ
]);

144 
	gÆ
++;

146 
	gm”ged
.
push_back
(
cu¾ab–s
[
ş
]);

147 
	gş
++;

151 
	gş
 < ()
	gcu¾ab–s
.
size
()è
	gm”ged
.
push_back
(
cu¾ab–s
[
ş
++]);

152 
	gÆ
 < ()
	gÃwÏb–s
.
size
()è
	gm”ged
.
push_back
(
ÃwÏb–s
[
Æ
++]);

154 
	gcu¾ab–s
 = 
m”ged
;

157 
	gfœ¡
 = 
çl£
;

158 
	g¡
 +ğ
»adwšdow
;

162 
	g¡d
::
sÜt
(
cu¾ab–s
.
begš
(), cu¾ab–s.
’d
(), 
Ïb–_couÁ_g»©”
<
Lab–Ty³
>);

165 
	g¡d
::
¡ršg
 
ouŠame
 = 
ba£f’ame
 + "_components.txt";

166 
FILE
 * 
	g»sf
 = 
fİ’
(
ouŠame
.
c_¡r
(), "w");

167 ià(
	g»sf
 =ğ
NULL
) {

168 
log¡»am
(
LOG_ERROR
è<< "Could‚Ù wr™Ïb– ouutf: " << 
ouŠame
 << 
¡d
::
’dl
;

171 
	gi
=0; i < (è
	gcu¾ab–s
.
size
(); i++) {

172 
årštf
(
»sf
, "%u,%u\n", 
cu¾ab–s
[
i
].
Ïb–
, cu¾ab–s[i].
couÁ
 + 1);

174 
fşo£
(
»sf
);

176 
	g¡d
::
cout
 << "TÙ®‚umb” oàdifã»Á†ab– (compÚ’ts/commun™›s): " << 
cu¾ab–s
.
size
(è<< 
¡d
::
’dl
;

177 
	g¡d
::
cout
 << "Li¡ oàÏb– wa wr™‹ÀtØfe: " << 
ouŠame
 << 
¡d
::
’dl
;

179 
	gi
=0; i < ()
	g¡d
::
mš
((
size_t
)
´š‰İ
, 
cu¾ab–s
.
size
()); i++) {

180 
	g¡d
::
cout
 << (
i
+1è<< ".†ab–: " << 
cu¾ab–s
[i].
Ïb–
 << ", size: " << cu¾ab–s[i].
couÁ
 << 
¡d
::
’dl
;

183 
ä“
(
bufãr
);

185 
d–‘e
 
	gv”‹xd©a
;

186 
d–‘e
 
	giomgr
;

	@src/util/merge.hpp

25 #iâdeà
DEF_MERGE


26 
	#DEF_MERGE


	)

28 
	g‹m¶©e
 <
şass
 
	gET
, cÏs 
	gF
>

29 
	$m”ge
(
ET
* 
S1
, 
l1
, ET* 
S2
, 
l2
, ET* 
R
, 
F
 
f
) {

30 
ET
* 
pR
 = 
R
;

31 
ET
* 
pS1
 = 
S1
;

32 
ET
* 
pS2
 = 
S2
;

33 
ET
* 
eS1
 = 
S1
+
l1
;

34 
ET
* 
eS2
 = 
S2
+
l2
;

35 
Œue
) {

36 *
pR
++ = 
	`f
(*
pS2
,*
pS1
) ? *pS2++ : *pS1++;

37 ià(
pS1
==
eS1
è{
¡d
::
	`cİy
(
pS2
,
eS2
,
pR
); ;}

38 ià(
pS2
==
eS2
è{
¡d
::
	`cİy
(
pS1
,
eS1
,
pR
); ;}

40 
	}
}

	@src/util/pthread_tools.hpp

1 #iâdeà
DEF_PTHREAD_TOOLS_HPP


2 
	#DEF_PTHREAD_TOOLS_HPP


	)

6 
	~<c¡dlib
>

7 
	~<memÜy.h
>

8 
	~<±h»ad.h
>

9 
	~<£m­hÜe.h
>

10 
	~<sched.h
>

11 
	~<sigÇl.h
>

12 
	~<sys/time.h
>

13 
	~<veùÜ
>

14 
	~<ÿs£¹
>

15 
	~<li¡
>

16 
	~<io¡»am
>

18 #undeà
_POSIX_SPIN_LOCKS


19 
	#_POSIX_SPIN_LOCKS
 -1

	)

27 
Çme¥aû
 
	gg¿phchi
 {

37 şas 
	cmu‹x
 {

38 
	g´iv©e
:

40 
mubË
 
±h»ad_mu‹x_t
 
m_mut
;

41 
	gpublic
:

42 
mu‹x
() {

43 
”rÜ
 = 
±h»ad_mu‹x_š™
(&
m_mut
, 
NULL
);

44 
as£¹
(!
”rÜ
);

46 
šlše
 
lock
() const {

47 
	g”rÜ
 = 
±h»ad_mu‹x_lock
Ğ&
m_mut
 );

48 
as£¹
(!
”rÜ
);

50 
šlše
 
uÆock
() const {

51 
	g”rÜ
 = 
±h»ad_mu‹x_uÆock
Ğ&
m_mut
 );

52 
as£¹
(!
”rÜ
);

54 
šlše
 
boŞ
 
Œy_lock
() const {

55  
±h»ad_mu‹x_Œylock
Ğ&
m_mut
 ) == 0;

57 ~
mu‹x
(){

58 
	g”rÜ
 = 
±h»ad_mu‹x_de¡roy
Ğ&
m_mut
 );

59 ià(
	g”rÜ
)

60 
³¼Ü
("Error: failedo destroy mutex");

61 
as£¹
(!
”rÜ
);

63 
ä›nd
 
şass
 
	gcÚd™iÚ®
;

66 #ià
_POSIX_SPIN_LOCKS
 >= 0

78 şas 
	c¥šlock
 {

79 
	g´iv©e
:

81 
mubË
 
±h»ad_¥šlock_t
 
m_¥š
;

82 
	gpublic
:

83 
¥šlock
 () {

84 
”rÜ
 = 
±h»ad_¥š_š™
(&
m_¥š
, 
PTHREAD_PROCESS_PRIVATE
);

85 
as£¹
(!
”rÜ
);

88 
šlše
 
lock
() const {

89 
	g”rÜ
 = 
±h»ad_¥š_lock
Ğ&
m_¥š
 );

90 
as£¹
(!
”rÜ
);

92 
šlše
 
uÆock
() const {

93 
	g”rÜ
 = 
±h»ad_¥š_uÆock
Ğ&
m_¥š
 );

94 
as£¹
(!
”rÜ
);

96 
šlše
 
boŞ
 
Œy_lock
() const {

97  
±h»ad_¥š_Œylock
Ğ&
m_¥š
 ) == 0;

99 ~
¥šlock
(){

100 
	g”rÜ
 = 
±h»ad_¥š_de¡roy
Ğ&
m_¥š
 );

101 
as£¹
(!
”rÜ
);

103 
ä›nd
 
şass
 
	gcÚd™iÚ®
;

105 
	#SPINLOCK_SUPPORTED
 1

	)

108 
mu‹x
 
	t¥šlock
;

109 
	#SPINLOCK_SUPPORTED
 0

	)

117 şas 
	ccÚd™iÚ®
 {

118 
	g´iv©e
:

119 
mubË
 
±h»ad_cÚd_t
 
m_cÚd
;

120 
	gpublic
:

121 
cÚd™iÚ®
() {

122 
”rÜ
 = 
±h»ad_cÚd_š™
(&
m_cÚd
, 
NULL
);

123 
as£¹
(!
”rÜ
);

125 
šlše
 
wa™
(cÚ¡ 
mu‹x
& 
mut
) const {

126 
	g”rÜ
 = 
±h»ad_cÚd_wa™
(&
m_cÚd
, &
mut
.
m_mut
);

127 
as£¹
(!
”rÜ
);

129 
šlše
 
timedwa™
(cÚ¡ 
mu‹x
& 
mut
, 
£c
) const {

130 
time¥ec
 
	gtimeout
;

131 
timev®
 
	gtv
;

132 
timezÚe
 
	gtz
;

133 
g‘timeofday
(&
tv
, &
tz
);

134 
	gtimeout
.
	gtv_n£c
 = 0;

135 
	gtimeout
.
	gtv_£c
 = 
tv
.
tv_£c
 + 
£c
;

136  
±h»ad_cÚd_timedwa™
(&
m_cÚd
, &
mut
.
m_mut
, &
timeout
);

138 
šlše
 
sigÇl
() const {

139 
	g”rÜ
 = 
±h»ad_cÚd_sigÇl
(&
m_cÚd
);

140 
as£¹
(!
”rÜ
);

142 
šlše
 
brßdÿ¡
() const {

143 
	g”rÜ
 = 
±h»ad_cÚd_brßdÿ¡
(&
m_cÚd
);

144 
as£¹
(!
”rÜ
);

146 ~
cÚd™iÚ®
() {

147 
	g”rÜ
 = 
±h»ad_cÚd_de¡roy
(&
m_cÚd
);

148 
as£¹
(!
”rÜ
);

156 şas 
	c£m­hÜe
 {

157 
	g´iv©e
:

158 
mubË
 
£m_t
 
m_£m
;

159 
	gpublic
:

160 
£m­hÜe
() {

161 
”rÜ
 = 
£m_š™
(&
m_£m
, 0,0);

162 
as£¹
(!
”rÜ
);

164 
šlše
 
po¡
() const {

165 
	g”rÜ
 = 
£m_po¡
(&
m_£m
);

166 
as£¹
(!
”rÜ
);

168 
šlše
 
wa™
() const {

169 
	g”rÜ
 = 
£m_wa™
(&
m_£m
);

170 
as£¹
(!
”rÜ
);

172 ~
£m­hÜe
() {

173 
	g”rÜ
 = 
£m_de¡roy
(&
m_£m
);

174 
as£¹
(!
”rÜ
);

181 
	#©omic_xadd
(
P
, 
V
è
	`__sync_ãtch_ªd_add
((P), (V))

	)

182 
	#cmpxchg
(
P
, 
O
, 
N
è
	`__sync_v®_com·»_ªd_sw­
((P), (O), (N))

	)

183 
	#©omic_šc
(
P
è
	`__sync_add_ªd_ãtch
((P), 1)

	)

192 şas 
	c¥šrwlock
 {

194 
	urwtick‘
 {

195 
	gu
;

196 
	gus
;

197 
__ex‹nsiÚ__
 struct {

198 
	gwr™e
;

199 
	g»ad
;

200 
	gu£rs
;

201 } 
	gs
;

203 
mubË
 
boŞ
 
	gwr™šg
;

204 
mubË
 vŞ©
rwtick‘
 
	gl
;

205 
	gpublic
:

206 
¥šrwlock
() {

207 
mem£t
(
cÚ¡_ÿ¡
<
rwtick‘
*>(&
l
), 0, (rwticket));

209 
šlše
 
wr™–ock
() const {

210 
	gme
 = 
©omic_xadd
(&
l
.
u
, (1<<16));

211 
	gv®
 = 
me
 >> 16;

213 
	gv®
 !ğ
l
.
s
.
wr™e
è
sched_y›ld
();

214 
	gwr™šg
 = 
Œue
;

217 
šlše
 
wruÆock
() const{

218 
rwtick‘
 
	gt
 = *
cÚ¡_ÿ¡
<rwtick‘*>(&
l
);

220 
	gt
.
	gs
.
	gwr™e
++;

221 
	gt
.
	gs
.
	g»ad
++;

223 *(vŞ©*è(&
	gl
èğ
t
.
us
;

224 
	gwr™šg
 = 
çl£
;

225 
__asm
("mfence");

228 
šlše
 
»adlock
() const {

229 
	gme
 = 
©omic_xadd
(&
l
.
u
, (1<<16));

230 
	gv®
 = 
me
 >> 16;

232 
	gv®
 !ğ
l
.
s
.
»ad
è
sched_y›ld
();

233 
	gl
.
	gs
.
	g»ad
++;

236 
šlše
 
rduÆock
() const {

237 
©omic_šc
(&
l
.
s
.
wr™e
);

240 
šlše
 
uÆock
() const {

241 ià(!
	gwr™šg
è
rduÆock
();

242 
wruÆock
();

246 #undeà
©omic_xadd


247 #undeà
cmpxchg


248 #undeà
©omic_šc


255 şas 
	crwlock
 {

256 
	g´iv©e
:

257 
mubË
 
±h»ad_rwlock_t
 
m_rwlock
;

258 
	gpublic
:

259 
rwlock
() {

260 
”rÜ
 = 
±h»ad_rwlock_š™
(&
m_rwlock
, 
NULL
);

261 
as£¹
(!
”rÜ
);

263 ~
rwlock
() {

264 
	g”rÜ
 = 
±h»ad_rwlock_de¡roy
(&
m_rwlock
);

265 
as£¹
(!
”rÜ
);

267 
šlše
 
»adlock
() const {

268 
±h»ad_rwlock_rdlock
(&
m_rwlock
);

271 
šlše
 
wr™–ock
() const {

272 
±h»ad_rwlock_w¾ock
(&
m_rwlock
);

275 
šlše
 
uÆock
() const {

276 
±h»ad_rwlock_uÆock
(&
m_rwlock
);

279 
šlše
 
rduÆock
() const {

280 
uÆock
();

282 
šlše
 
wruÆock
() const {

283 
uÆock
();

291 #ifdeà
__lšux__


296 şas 
	cb¬r›r
 {

297 
	g´iv©e
:

298 
mubË
 
±h»ad_b¬r›r_t
 
m_b¬r›r
;

299 
	gpublic
:

300 
b¬r›r
(
size_t
 
numth»ads
è{ 
±h»ad_b¬r›r_š™
(&
m_b¬r›r
, 
NULL
,‚umthreads); }

301 ~
b¬r›r
(è{ 
±h»ad_b¬r›r_de¡roy
(&
m_b¬r›r
); }

302 
šlše
 
wa™
(ècÚ¡ { 
±h»ad_b¬r›r_wa™
(&
m_b¬r›r
); }

310 şas 
	cb¬r›r
 {

311 
	g´iv©e
:

312 
mu‹x
 
m
;

313 
	gÃeded
;

314 
	gÿÎed
;

315 
cÚd™iÚ®
 
	gc
;

318 
	g¡d
::
veùÜ
<> 
wa™šg
;

319 
	gpublic
:

321 
b¬r›r
(
size_t
 
numth»ads
) {

322 
Ãeded
 = ()
numth»ads
;

323 
	gÿÎed
 = 0;

324 
	gwa™šg
.
»size
(
numth»ads
);

325 
	g¡d
::
fl
(
wa™šg
.
begš
(), wa™šg.
’d
(), 0);

328 ~
b¬r›r
() {}

331 
šlše
 
wa™
() {

332 
	gm
.
lock
();

334 
size_t
 
	gmyid
 = 
ÿÎed
;

335 
	gwa™šg
[
myid
] = 1;

336 
	gÿÎed
++;

338 ià(
	gÿÎed
 =ğ
Ãeded
) {

342 
ÿÎed
 = 0;

344 
	g¡d
::
fl
(
wa™šg
.
begš
(), wa™šg.
’d
(), 0);

345 
	gc
.
brßdÿ¡
();

349 
	gwa™šg
[
myid
]è
	gc
.
wa™
(
m
);

351 
	gm
.
uÆock
();

358 
šlše
 
	$´eãtch_¿nge
(*
addr
, 
size_t
 
Ën
) {

359 *
ı
;

360 *
’d
 = (*)(
addr
è+ 
Ën
;

362 
ı
 = (*)(
addr
); c°< 
’d
; c°+ğ64è
	`__butš_´eãtch
(cp, 0);

363 
	}
}

364 
šlše
 
	$´eãtch_¿nge_wr™e
(*
addr
, 
size_t
 
Ën
) {

365 *
ı
;

366 *
’d
 = (*)(
addr
è+ 
Ën
;

368 
ı
 = (*)(
addr
); c°< 
’d
; c°+ğ64è
	`__butš_´eãtch
(cp, 1);

369 
	}
}

	@src/util/qsort.hpp

24 #iâdeà
GRAPHCHI_QSORT_INCLUDED


25 
	#GRAPHCHI_QSORT_INCLUDED


	)

27 
	~<®gÜ™hm
>

28 
	~<veùÜ
>

30 
	g‹m¶©e
 <
şass
 
	gE
, cÏs 
	gBšP»d
>

31 
	$š£¹iÚSÜt
(
E
* 
A
, 
n
, 
BšP»d
 
f
) {

32 
i
=0; i < 
n
; i++) {

33 
E
 
v
 = 
A
[
i
];

34 
E
* 
B
 = 
A
 + 
i
;

35 --
B
 >ğ
A
 && 
	`f
(
v
,*B)) *(B+1) = *B;

36 *(
B
+1èğ
v
;

38 
	}
}

41 
	#ISORT
 25

	)

43 
	g‹m¶©e
 <
şass
 
	gE
, cÏs 
	gBšP»d
>

44 
E
 
	$medŸn
(
E
 
a
, E 
b
, E 
c
, 
BšP»d
 
f
) {

45  
	`f
(
a
,
b
è? (f(b,
c
) ? b : (f(a,c) ? c :‡))

46 : (
	`f
(
a
,
c
è?‡ : (f(
b
,c) ? c : b));

47 
	}
}

50 
	g‹m¶©e
 <
şass
 
	gE
, cÏs 
	gBšP»d
>

51 
	$quickSÜt
(
E
* 
A
, 
n
, 
BšP»d
 
f
) {

52 ià(
n
 < 
ISORT
è
	`š£¹iÚSÜt
(
A
,‚, 
f
);

54 
E
 
p
 = 
A
[
	`¿nd
(è% 
n
];

55 
E
* 
L
 = 
A
;

56 
E
* 
M
 = 
A
;

57 
E
* 
R
 = 
A
+
n
-1;

59 !
	`f
(
p
,*
M
)) {

60 ià(
	`f
(*
M
,
p
)è
¡d
::
	`sw­
(*M,*(
L
++));

61 ià(
M
 >ğ
R
) ;

62 
M
++;

64 
	`f
(
p
,*
R
)) R--;

65 ià(
M
 >ğ
R
) ;

66 
¡d
::
	`sw­
(*
M
,*
R
--);

67 ià(
	`f
(*
M
,
p
)è
¡d
::
	`sw­
(*M,*(
L
++));

68 
M
++;

70 
	`quickSÜt
(
A
, (è(
L
-A), 
f
);

71 
	`quickSÜt
(
M
, (è(
A
+
n
-M), 
f
);

73 
	}
}

	@src/util/readdeg.cpp

9 
	~<io¡»am
>

10 
	~<f¡»am
>

12 
	sdeg»e
 {

13 
	mšdeg»e
;

14 
	moutdeg»e
;

17 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

18 
FILE
 * 
f
 = 
	`fİ’
(
¬gv
[1], "r");

20 
wª‹d
 = 
	`©oi
(
¬gv
[2]);

21 
size_t
 
nout
 = 0;

22 
size_t
 
nš
 = 0;

23 
size_t
 
nÚz
 = 0;

24 
size_t
 
tÙ
 = 0;

25 
deg»e
 
d
;

26 
j
 = 0;

27 !
	`ãof
(
f
)) {

28 
	`ä—d
(&
d
, (
deg»e
), 1, 
f
);

29 
nout
 +ğ
d
.
outdeg»e
;

30 
nš
 +ğ
d
.
šdeg»e
;

31 <<<<<<< 
loÿl


32 ià(
wª‹d
 =ğ
j
) {

33 
¡d
::
cout
 << 
wª‹d
 << " indeg: " << 
d
.
šdeg»e
 << " outdeg: " << d.
outdeg»e
 << std::
’dl
;

35 
j
++;

37 
tÙ
++;

38 
nÚz
 +ğ(
d
.
outdeg»e
 + d.
šdeg»e
) > 0;

39 >>>>>>> 
Ùh”


41 
¡d
::
cout
 << "TÙ® in: " << 
nš
 << "Ù® out: " << 
nout
 << std::
’dl
;

42 
¡d
::
cout
 << "NÚ-sšgËtÚ v”tiûs: " << 
nÚz
 << std::
’dl
;

43 
¡d
::
cout
 << "TÙ® v”tiûs: " << 
tÙ
 << std::
’dl
;

45 
	}
}

	@src/util/synchronized_queue.hpp

1 #iâdeà
SYNCHRONIZED_QUEUE_HPP


2 
	#SYNCHRONIZED_QUEUE_HPP


	)

4 
	~<queue
>

5 
	~"±h»ad_toŞs.hµ
"

9 
Çme¥aû
 
	gg¿phchi
 {

12 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

13 şas 
	csynchrÚized_queue
 {

15 
	gpublic
:

16 
synchrÚized_queue
() { };

17 ~
synchrÚized_queue
() { };

19 
push
(cÚ¡ 
T
 &
™em
) {

20 
	g_queu–ock
.
lock
();

21 
	g_queue
.
push
(
™em
);

22 
	g_queu–ock
.
uÆock
();

25 
boŞ
 
§ãpİ
(
T
 * 
»t
) {

26 
	g_queu–ock
.
lock
();

27 ià(
	g_queue
.
size
() == 0) {

28 
_queu–ock
.
uÆock
();

30  
	gçl£
;

32 *
	g»t
 = 
_queue
.
äÚt
();

33 
	g_queue
.
pİ
();

34 
	g_queu–ock
.
uÆock
();

35  
	gŒue
;

38 
T
 
pİ
() {

39 
	g_queu–ock
.
lock
();

40 
T
 
	gt
 = 
_queue
.
äÚt
();

41 
	g_queue
.
pİ
();

42 
	g_queu–ock
.
uÆock
();

43  
	gt
;

46 
size_t
 
size
() const{

47  
	g_queue
.
size
();

49 
	g´iv©e
:

50 
¡d
::
queue
<
T
> 
_queue
;

51 
¥šlock
 
	g_queu–ock
;

	@src/util/toplist.hpp

29 #iâdeà
DEF_GRAPHCHI_TOPLIST


30 
	#DEF_GRAPHCHI_TOPLIST


	)

32 
	~<veùÜ
>

33 
	~<®gÜ™hm
>

34 
	~<”ºo.h
>

35 
	~<as£¹.h
>

37 
	~"io/¡redio.hµ
"

38 
	~"logg”/logg”.hµ
"

39 
	~"ut/m”ge.hµ
"

40 
	~"ut/iout.hµ
"

41 
	~"ut/qsÜt.hµ
"

42 
	~"­i/chif’ames.hµ
"

43 
	~"’gše/auxd©a/v”‹x_d©a.hµ
"

45 
Çme¥aû
 
	gg¿phchi
 {

47 
	g‹m¶©e
 <
ty³Çme
 
	gV”‹xD©aTy³
>

48 
	sv”‹x_v®ue
 {

49 
vid_t
 
	gv”‹x
;

50 
V”‹xD©aTy³
 
	gv®ue
;

51 
v”‹x_v®ue
() {}

52 
v”‹x_v®ue
(
vid_t
 
v
, 
V”‹xD©aTy³
 
x
è: 
v”‹x
(v), 
v®ue
(x) {}

55 
	g‹m¶©e
 <
ty³Çme
 
	gV”‹xD©aTy³
>

56 
boŞ
 
v”‹x_v®ue_g»©”
(cÚ¡ 
v”‹x_v®ue
<
V”‹xD©aTy³
> &
a
, cÚ¡ v”‹x_v®ue<V”‹xD©aTy³> &
b
) {

57  
	ga
.
	gv®ue
 > 
	gb
.value;

71 
	g‹m¶©e
 <
ty³Çme
 
	gV”‹xD©aTy³
>

72 
	g¡d
::
veùÜ
<
v”‹x_v®ue
<
V”‹xD©aTy³
> > 
g‘_tİ_v”tiûs
(
¡d
::
¡ršg
 
ba£f’ame
, 
Áİ
, 
vid_t
 
äom
=0, vid_ˆ
to
=0) {

73 
v”‹x_v®ue
<
	tV”‹xD©aTy³
> 
	tvv_t
;

76 
m‘rics
 
m
("toplist");

77 
¡redio
 * 
	giomgr
 = 
Ãw
 sŒedio(
m
);

80 
vid_t
 
	g»adwšdow
 = 1024 * 1024;

81 
size_t
 
	gnumv”tiûs
 = 
g‘_num_v”tiûs
(
ba£f’ame
);

82 
	gv”‹x_d©a_¡Üe
<
	gV”‹xD©aTy³
> * 
	gv”‹xd©a
 =

83 
Ãw
 
v”‹x_d©a_¡Üe
<
V”‹xD©aTy³
>(
ba£f’ame
, 
	gnumv”tiûs
, 
	giomgr
);

85 ià((
	gsize_t
)
	gÁİ
 > 
	gnumv”tiûs
) {

86 
	gÁİ
 = ()
numv”tiûs
;

90 
vv_t
 * 
	gbufãr_idxs
 = (vv_t*è
ÿÎoc
(
»adwšdow
, (vv_t));

91 
vv_t
 * 
	gtİbuf
 = (vv_t*è
ÿÎoc
(
Áİ
, (vv_t));

92 
vv_t
 * 
	gm”g—¼
 = (vv_t*è
ÿÎoc
(
Áİ
 * 2, (vv_t));

95 
size_t
 
	gidx
 = 0;

96 
vid_t
 
	g¡
 = 0;

97 
vid_t
 
	g’
 = 
numv”tiûs
 - 1;

99 
	gcouÁ
 = 0;

100 
	g¡
 <ğ
numv”tiûs
 - 1) {

101 
’
 = 
¡
 + 
»adwšdow
 - 1;

102 ià(
	g’
 >ğ
numv”tiûs
 - 1è
’
 =‚umvertices - 1;

105 
	gv”‹xd©a
->
lßd
(
¡
, 
’
);

107 
	gÁ
 = 
’
 - 
¡
 + 1;

108 
	gk
 = 0;

109 
V”‹xD©aTy³
 
	gmšima
 = VertexDataType();

110 ià(
	gcouÁ
 > 0) {

111 
	gmšima
 = 
tİbuf
[
Áİ
 - 1].
v®ue
;

113 
	gj
=0; j < 
	gÁ
; j++) {

114 
	gV”‹xD©aTy³
& 
	gv®
 = *
v”‹xd©a
->
v”‹x_d©a_±r
(
j
 + 
¡
);

115 ià(
	gcouÁ
 =ğ0 || (
v®
 > 
mšima
)) {

116 
bufãr_idxs
[
k
] = 
vv_t
((
vid_t
)
idx
 + 
äom
, 
v®
);

117 
	gk
++;

119 
	gidx
++;

121 
	gÁ
 = 
k
;

124 
quickSÜt
(
bufãr_idxs
, 
Á
, 
v”‹x_v®ue_g»©”
<
V”‹xD©aTy³
>);

127 ià(
	gcouÁ
 == 0) {

129 
memıy
(
tİbuf
, 
bufãr_idxs
, 
Áİ
 * (
vv_t
));

132 
	gm”ge
<
	gvv_t
>(
	gtİbuf
, 
	gÁİ
, 
	gbufãr_idxs
, 
	g¡d
::
mš
(
Áİ
, 
Á
), 
	gm”g—¼
, 
	gv”‹x_v®ue_g»©”
<
	gV”‹xD©aTy³
>);

133 
memıy
(
tİbuf
, 
m”g—¼
, 
Áİ
 * (
vv_t
));

136 
	gcouÁ
++;

137 
	g¡
 +ğ
»adwšdow
;

141 
	g¡d
::
veùÜ
< 
vv_t
 > 
»t
;

142 
	gi
=0; i < 
	gÁİ
; i++) {

143 
	g»t
.
push_back
(
tİbuf
[
i
]);

145 
ä“
(
bufãr_idxs
);

146 
ä“
(
m”g—¼
);

147 
ä“
(
tİbuf
);

149 
d–‘e
 
	gv”‹xd©a
;

150 
d–‘e
 
	giomgr
;

152  
	g»t
;

	@toolkits/collaborative_filtering/als.cpp

55 
	~"commÚ.hµ
"

56 
	~"eig’_w¿µ”.hµ
"

58 
	gÏmbda
 = 0.065;

61 
	sv”‹x_d©a
 {

62 
vec
 
	mpvec
;

64 
v”‹x_d©a
() {

65 
	mpvec
 = 
z”os
(
D
);

67 
£t_v®
(
šdex
, 
v®
){

68 
	mpvec
[
šdex
] = 
v®
;

70 
g‘_v®
(
šdex
){

71  
	mpvec
[
šdex
];

80 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

81 
	tEdgeD©aTy³
;

83 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

84 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	gpv®id©iÚ_’gše
 = 
NULL
;

85 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

87 
	~"io.hµ
"

88 
	~"rm£.hµ
"

89 
	~"rm£_’gše.hµ
"

92 
	$®s_´ediù
(cÚ¡ 
v”‹x_d©a
& 
u£r
,

93 cÚ¡ 
v”‹x_d©a
& 
mov›
,

94 cÚ¡ 
¿tšg
,

95 & 
´ediùiÚ
,

96 * 
exŒa
 = 
NULL
){

99 
´ediùiÚ
 = 
	`dÙ_´od
(
u£r
.
pvec
, 
mov›
.pvec);

101 
´ediùiÚ
 = 
¡d
::
	`mš
((í»diùiÚ, 
maxv®
);

102 
´ediùiÚ
 = 
¡d
::
	`max
((í»diùiÚ, 
mšv®
);

104 
”r
 = 
¿tšg
 - 
´ediùiÚ
;

105 
	`as£¹
(!
¡d
::
	`i¢ª
(
”r
));

106  
”r
*err;

108 
	}
}

117 
	gALSV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

124 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

125 
	gv”‹x_d©a
 & 
	gvd©a
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

126 
m©
 
	gXtX
 = m©::
Z”o
(
D
, D);

127 
vec
 
	gXty
 = vec::
Z”o
(
D
);

129 
boŞ
 
	gcompu‹_rm£
 = (
v”‹x
.
num_ou‹dges
() > 0);

131 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

132 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

133 
	gv”‹x_d©a
 & 
	gnbr_Ï‹Á
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

134 
	gXty
 +ğ
nbr_Ï‹Á
.
pvec
 * 
ob£rv©iÚ
;

135 
	gXtX
.
	gŒŸnguÏrV›w
<
	gEig’
::
Uµ”
>(è+ğ
nbr_Ï‹Á
.
pvec
 *‚br_Ï‹Á.pvec.
Œª¥o£
();

136 ià(
	gcompu‹_rm£
) {

137 
	g´ediùiÚ
;

138 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
®s_´ediù
(
vd©a
, 
nbr_Ï‹Á
, 
ob£rv©iÚ
, 
´ediùiÚ
);

142 
	gi
=0; i < 
	gD
; i++è
XtX
(
i
,iè+ğ(
Ïmbda
);

145 
	gvd©a
.
	gpvec
 = 
XtX
.
£lçdjoštV›w
<
Eig’
::
Uµ”
>().
ldÉ
().
sŞve
(
Xty
);

152 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

153 
»£t_rm£
(
gcÚ‹xt
.
exeùh»ads
);

160 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

161 
Œaššg_rm£
(
™”©iÚ
, 
gcÚ‹xt
);

162 
run_v®id©iÚ
(
pv®id©iÚ_’gše
, 
gcÚ‹xt
);

170 
ouut_®s_»suÉ
(
¡d
::
¡ršg
 
f’ame
) {

171 
MMOuu‰”_m©
<
v”‹x_d©a
> 
u£r_m©
(
f’ame
 + "_U.mm", 0, 
M
 , "Thi fcÚš ALS ouuˆm©rix U. IÀ—ch„ow D faùÜ oà¨sšgË u£¸node.", 
Ï‹Á_çùÜs_šmem
);

172 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
™em_m©
(
f’ame
 + "_V.mm", 
M
 ,M+
N
, "Thi fcÚš ALS ouuˆm©rix V. IÀ—ch„ow D faùÜ oà¨sšgË i‹m‚ode.", 
Ï‹Á_çùÜs_šmem
);

173 
log¡»am
(
LOG_INFO
è<< "ALS ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << "_U.mm" <<

174 ", " << 
	gf’ame
 + "_V.mm " << 
	g¡d
::
’dl
;

177 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

179 
	`´št_cİyright
();

183 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

187 
m‘rics
 
	`m
("als-inmemory-factors");

189 
Ïmbda
 = 
	`g‘_İtiÚ_æßt
("lambda", 0.065);

191 
	`·r£_commªd_lše_¬gs
();

192 
	`·r£_im¶ic™_commªd_lše
();

196 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
Œaššg
, 
NULL
, 0, 0, 3, 
TRAINING
, 
çl£
);

197 
š™_ã©u»_veùÜs
<
¡d
::
veùÜ
<
v”‹x_d©a
> >(
M
+
N
, 
Ï‹Á_çùÜs_šmem
, !
lßd_çùÜs_äom_fe
);

198 ià(
v®id©iÚ
 != ""){

199 
vsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
v®id©iÚ
, 
NULL
, 0, 0, 3, 
VALIDATION
, 
çl£
);

200 
š™_v®id©iÚ_rm£_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
>(
pv®id©iÚ_’gše
, 
vsh¬ds
, &
®s_´ediù
);

204 ià(
lßd_çùÜs_äom_fe
){

205 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_U.mm", 0, 
D
);

206 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_V.mm", 
M
, 
D
);

210 
ALSV”tiûsInMemProg¿m
 
´og¿m
;

211 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

212 
	`£t_’gše_æags
(
’gše
);

213 
³ngše
 = &
’gše
;

214 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

217 
	`ouut_®s_»suÉ
(
Œaššg
);

218 
	`‹¡_´ediùiÚs
(&
®s_´ediù
);

221 ià(!
qu›t
)

222 
	`m‘rics_»pÜt
(
m
);

225 
	}
}

	@toolkits/collaborative_filtering/als_tensor.cpp

33 
	~"commÚ.hµ
"

34 
	~"eig’_w¿µ”.hµ
"

36 
	gÏmbda
 = 0.065;

38 
boŞ
 
	$is_u£r
(
vid_t
 
id
){  id < 
M
; 
	}
}

39 
boŞ
 
	$is_™em
(
vid_t
 
id
){  id >ğ
M
 && id < 
N
; 
	}
}

40 
boŞ
 
	$is_time
(
vid_t
 
id
){  id >ğ
M
+
N
; 
	}
}

42 
	sv”‹x_d©a
 {

43 
vec
 
	mpvec
;

45 
v”‹x_d©a
() {

46 
	mpvec
 = 
z”os
(
D
);

48 
£t_v®
(
šdex
, 
v®
){

49 
	mpvec
[
šdex
] = 
v®
;

51 
g‘_v®
(
šdex
){

52  
	mpvec
[
šdex
];

56 
	sedge_d©a
 {

57 
	mweight
;

58 
	mtime
;

60 
edge_d©a
(è{ 
	mweight
 = 
time
 = 0; }

62 
edge_d©a
(
weight
, 
time
) : weight(weight),ime(time) { }

70 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

71 
edge_d©a
 
	tEdgeD©aTy³
;

73 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

74 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	gpv®id©iÚ_’gše
 = 
NULL
;

75 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

77 
	~"io.hµ
"

78 
	~"rm£.hµ
"

79 
	~"rm£_’gše4.hµ
"

81 
	$®s_‹nsÜ_´ediù
(cÚ¡ 
v”‹x_d©a
& 
u£r
,

82 cÚ¡ 
v”‹x_d©a
& 
mov›
,

83 cÚ¡ 
¿tšg
,

84 & 
´ediùiÚ
,

85 * 
exŒa
){

87 
v”‹x_d©a
 * 
time_node
 = (v”‹x_d©a*)
exŒa
;

88 
	`as£¹
(
time_node
 !ğ
NULL
 &&ime_node->
pvec
.
	`size
(è=ğ
D
);

89 
´ediùiÚ
 = 
	`dÙ3
(
u£r
.
pvec
, 
mov›
.pvec, 
time_node
->pvec);

91 
´ediùiÚ
 = 
¡d
::
	`mš
((í»diùiÚ, 
maxv®
);

92 
´ediùiÚ
 = 
¡d
::
	`max
((í»diùiÚ, 
mšv®
);

94 
”r
 = 
¿tšg
 - 
´ediùiÚ
;

95 
	`as£¹
(!
¡d
::
	`i¢ª
(
”r
));

96  
”r
*err;

98 
	}
}

107 
	gALSV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

112 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

113 
	gv”‹x_d©a
 & 
	gvd©a
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

114 
m©
 
	gXtX
 = m©::
Z”o
(
D
, D);

115 
vec
 
	gXty
 = vec::
Z”o
(
D
);

117 
boŞ
 
	gcompu‹_rm£
 = 
is_u£r
(
v”‹x
.
id
());

119 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++){

120 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
().
weight
;

121 
ušt
 
	gtime
 = (ušt)
v”‹x
.
edge
(
e
)->
g‘_d©a
().
time
;

122 
as£¹
(
time
 >ğ0 &&im< 
M
+
N
+
K
);

123 
as£¹
(
time
 !ğ
v”‹x
.
id
());

124 
	gv”‹x_d©a
 & 
	gnbr_Ï‹Á
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

125 
	gv”‹x_d©a
 & 
	gtime_node
 = 
Ï‹Á_çùÜs_šmem
[
time
];

126 
as£¹
(
time
 !ğ
v”‹x
.
id
(è&&im!ğv”‹x.
edge
(
e
)->
v”‹x_id
());

127 
vec
 
	gXY
 = 
nbr_Ï‹Á
.
pvec
.
cwi£Produù
(
time_node
.pvec);

128 
	gXty
 +ğ
XY
 * 
ob£rv©iÚ
;

129 
	gXtX
.
	gŒŸnguÏrV›w
<
	gEig’
::
Uµ”
>(è+ğ
XY
 * XY.
Œª¥o£
();

130 ià(
	gcompu‹_rm£
) {

131 
	g´ediùiÚ
;

132 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
®s_‹nsÜ_´ediù
(
vd©a
, 
nbr_Ï‹Á
, 
ob£rv©iÚ
, 
´ediùiÚ
, (*)&
time_node
);

136 
	gi
=0; i < 
	gD
; i++è
XtX
(
i
,iè+ğ(
Ïmbda
);

139 
	gvd©a
.
	gpvec
 = 
XtX
.
£lçdjoštV›w
<
Eig’
::
Uµ”
>().
ldÉ
().
sŞve
(
Xty
);

146 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

147 
»£t_rm£
(
gcÚ‹xt
.
exeùh»ads
);

154 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

155 
Œaššg_rm£
(
™”©iÚ
, 
gcÚ‹xt
);

156 
run_v®id©iÚ4
(
pv®id©iÚ_’gše
, 
gcÚ‹xt
);

164 
ouut_®s_»suÉ
(
¡d
::
¡ršg
 
f’ame
) {

165 
MMOuu‰”_m©
<
v”‹x_d©a
> 
u£r_m©
(
f’ame
 + "_U.mm", 0, 
M
, "Thi fcÚš ‹nsÜ-ALS ouuˆm©rix U. IÀ—ch„ow D faùÜ oà¨sšgË u£¸node.", 
Ï‹Á_çùÜs_šmem
);

166 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
™em_m©
(
f’ame
 + "_V.mm", 
M
 ,M+
N
, "Thi fcÚš ‹nsÜ-ALS ouuˆm©rix V. IÀ—ch„ow D faùÜ oà¨sšgË i‹m‚ode.", 
Ï‹Á_çùÜs_šmem
);

167 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
time_m©
(
f’ame
 + "_T.mm", 
M
+
N
 ,M+N+
K
, "Thi fcÚš ‹nsÜ-ALS ouuˆm©rix T. IÀ—ch„ow D faùÜ oà¨sšgËimnode.", 
Ï‹Á_çùÜs_šmem
);

168 
log¡»am
(
LOG_INFO
è<< "‹nsÜ - ALS ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << "_U.mm" <<

169 ", " << 
	gf’ame
 + "_V.mm " << f’am+ "_T.mm" << 
	g¡d
::
’dl
;

172 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

175 
	`´št_cİyright
();

179 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

183 
m‘rics
 
	`m
("als-tensor-inmemory-factors");

185 
Ïmbda
 = 
	`g‘_İtiÚ_æßt
("lambda", 0.065);

186 
	`·r£_commªd_lše_¬gs
();

187 
	`·r£_im¶ic™_commªd_lše
();

190 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘4
<
edge_d©a
>(
Œaššg
, 
Œue
);

191 
š™_ã©u»_veùÜs
<
¡d
::
veùÜ
<
v”‹x_d©a
> >(
M
+
N
+
K
, 
Ï‹Á_çùÜs_šmem
, !
lßd_çùÜs_äom_fe
);

192 ià(
v®id©iÚ
 != ""){

193 
vsh¬ds
 = 
cÚv”t_m©rixm¬k‘4
<
EdgeD©aTy³
>(
v®id©iÚ
, 
Œue
, 
M
==
N
, 
VALIDATION
);

194 
š™_v®id©iÚ_rm£_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
>(
pv®id©iÚ_’gše
, 
vsh¬ds
, &
®s_‹nsÜ_´ediù
, 
çl£
, 
Œue
, 1);

198 ià(
lßd_çùÜs_äom_fe
){

199 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_U.mm", 0, 
D
);

200 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_V.mm", 
M
, 
D
);

201 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_T.mm", 
M
+
N
, 
D
);

206 
ALSV”tiûsInMemProg¿m
 
´og¿m
;

207 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

208 
	`£t_’gše_æags
(
’gše
);

209 
³ngše
 = &
’gše
;

210 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

213 
	`ouut_®s_»suÉ
(
Œaššg
);

214 
	`‹¡_´ediùiÚs3
(&
®s_‹nsÜ_´ediù
);

217 ià(!
qu›t
)

218 
	`m‘rics_»pÜt
(
m
);

220 
	}
}

	@toolkits/collaborative_filtering/baseline.cpp

35 
	~"commÚ.hµ
"

36 
	~"eig’_w¿µ”.hµ
"

40 
	mGLOBAL_MEAN
 = 0, 
	mUSER_MEAN
 = 1, 
	mITEM_MEAN
 = 2

43 
	g®go
 = 
GLOBAL_MEAN
;

44 
	g¡d
::
¡ršg
 
®gÜ™hm
;

46 
	sv”‹x_d©a
 {

47 
	mm—n_¿tšg
;

48 
vec
 
	mpvec
;

50 
v”‹x_d©a
() {

51 
	mm—n_¿tšg
 = 0;

53 
£t_v®
(
šdex
, 
v®
){

54 
	mpvec
[
šdex
] = 
v®
;

56 
g‘_v®
(
šdex
){

57  
	mpvec
[
šdex
];

62 
	~"ut.hµ
"

65 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

66 
	tEdgeD©aTy³
;

68 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

69 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

71 
	~"rm£.hµ
"

72 
	~"io.hµ
"

76 
	$ba£lše_´ediù
(cÚ¡ 
v”‹x_d©a
& 
u£r
,

77 cÚ¡ 
v”‹x_d©a
& 
mov›
,

78 cÚ¡ 
¿tšg
,

79 & 
´ediùiÚ
,

80 * 
exŒa
 = 
NULL
){

83 
´ediùiÚ
 = 
glob®M—n
;

84 ià(
®go
 =ğ
USER_MEAN
)

85 
´ediùiÚ
 = 
u£r
.
m—n_¿tšg
;

86 ià(
®go
 =ğ
ITEM_MEAN
)

87 
´ediùiÚ
 = 
mov›
.
m—n_¿tšg
;

90 
´ediùiÚ
 = 
¡d
::
	`mš
((í»diùiÚ, 
maxv®
);

91 
´ediùiÚ
 = 
¡d
::
	`max
((í»diùiÚ, 
mšv®
);

93 
”r
 = 
¿tšg
 - 
´ediùiÚ
;

94 
	`as£¹
(!
¡d
::
	`i¢ª
(
”r
));

95  
”r
*err;

97 
	}
}

106 
	gBa£lšeV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

109 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

110 
Œaššg_rm£
(
™”©iÚ
, 
gcÚ‹xt
, 
®go
 =ğ
ITEM_MEAN
);

111 
v®id©iÚ_rm£
(&
ba£lše_´ediù
, 
gcÚ‹xt
);

117 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

119 iàĞ
	gv”‹x
.
num_ou‹dges
(è> 0 && (
	g®go
 =ğ
GLOBAL_MEAN
 || 
®go
 =ğ
USER_MEAN
)){

120 
v”‹x_d©a
 & 
u£r
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

123 ià(
	g®go
 =ğ
USER_MEAN
){

124 
e
=0; 
	ge
 < 
	gv”‹x
.
num_edges
();ƒ++) {

125 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

126 
	gu£r
.
	gm—n_¿tšg
 +ğ
ob£rv©iÚ
;

128 ià(
	gv”‹x
.
num_edges
() > 0)

129 
	gu£r
.
	gm—n_¿tšg
 /ğ
v”‹x
.
num_edges
();

133 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

134 
	g´ediùiÚ
;

135 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

136 
	gv”‹x_d©a
 & 
	gmov›
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

137 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
ba£lše_´ediù
(
u£r
, 
mov›
, 
ob£rv©iÚ
, 
´ediùiÚ
);

140 ià(
	gv”‹x
.
num_šedges
(è> 0 && 
	g®go
 =ğ
ITEM_MEAN
){

141 
v”‹x_d©a
 & 
u£r
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

144 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

145 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

146 
	gu£r
.
	gm—n_¿tšg
 +ğ
ob£rv©iÚ
;

148 ià(
	gv”‹x
.
num_edges
() > 0)

149 
	gu£r
.
	gm—n_¿tšg
 /ğ
v”‹x
.
num_edges
();

151 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

152 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

153 
	g´ediùiÚ
;

154 
	gv”‹x_d©a
 & 
	gmov›
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

155 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
ba£lše_´ediù
(
mov›
, 
u£r
, 
ob£rv©iÚ
, 
´ediùiÚ
);

162 
	sMMOuu‰”2
{

163 
FILE
 * 
	moutf
;

164 
MMOuu‰”2
(
¡d
::
¡ršg
 
âame
, 
ušt
 
¡¬t
, ušˆ
’d
, std::¡ršg 
comm’t
) {

165 
MM_ty³code
 
m©code
;

166 
£t_m©code
(
m©code
);

167 
	moutf
 = 
fİ’
(
âame
.
c_¡r
(), "w");

168 
as£¹
(
outf
 !ğ
NULL
);

169 
mm_wr™e_bªÃr
(
outf
, 
m©code
);

170 ià(
	mcomm’t
 != "")

171 
årštf
(
outf
, "%%%s\n", 
comm’t
.
c_¡r
());

172 
mm_wr™e_mtx_¬¿y_size
(
outf
, 
’d
-
¡¬t
, 
D
);

173 
ušt
 
	mi
=
¡¬t
; i < 
	m’d
; i++)

174 
årštf
(
outf
, "%1.12e\n", 
Ï‹Á_çùÜs_šmem
[
i
].
m—n_¿tšg
);

177 ~
MMOuu‰”2
() {

178 ià(
	moutf
 !ğ
NULL
è
fşo£
(
outf
);

184 
ouut_ba£lše_»suÉ
(
¡d
::
¡ršg
 
f’ame
) {

185 ià(
®go
 =ğ
USER_MEAN
){

186 
MMOuu‰”2
 
mmouut_Ëá
(
f’ame
 + ".ba£lše_u£r", 0, 
M
, "This file contains Baseline output matrix U. Inƒach„ow„ating mean‡ single user‚ode.");

188 ià(
	g®go
 =ğ
ITEM_MEAN
){

189 
MMOuu‰”2
 
mmouut_right
(
f’ame
 + ".ba£lše_™em", 
M
 ,M+
N
, "This file contains Baseline output vector V. Inƒach„ow„ating mean of‡ single item‚ode.");

192 
log¡»am
(
LOG_INFO
è<< "Ba£lšouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << (
	g®go
 =ğ
USER_MEAN
 ? ".ba£lše_u£r" : ".ba£lše_™em"è<< 
¡d
::
’dl
;

196 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

198 
	`´št_cİyright
();

201 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

205 
m‘rics
 
	`m
("sgd-inmemory-factors");

207 
®gÜ™hm
 = 
	`g‘_İtiÚ_¡ršg
("algorithm", "global_mean");

208 ià(
®gÜ™hm
 == "global_mean")

209 
®go
 = 
GLOBAL_MEAN
;

210 ià(
®gÜ™hm
 == "user_mean")

211 
®go
 = 
USER_MEAN
;

212 ià(
®gÜ™hm
 == "item_mean")

213 
®go
 = 
ITEM_MEAN
;

214 
	`log¡»am
(
LOG_FATAL
)<<"UnsuµÜ‹d‡lgÜ™hm‚ame. Should b--®gÜ™hm=XX wh”XX i Úoà[glob®_m—n,u£r_m—n,™em_m—n] fÜƒxam¶--®gÜ™hm=glob®_m—n" << 
¡d
::
’dl
;

217 
	`·r£_commªd_lše_¬gs
();

218 
mytim”
.
	`¡¬t
();

221 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<>(
Œaššg
, 
NULL
, 0, 0, 3, 
TRAINING
, 
çl£
);

222 
š™_ã©u»_veùÜs
<
¡d
::
veùÜ
<
v”‹x_d©a
> >(
M
+
N
, 
Ï‹Á_çùÜs_šmem
, 
çl£
);

223 
rm£_vec
 = 
	`z”os
(
	`numb”_of_omp_th»ads
());

224 
	`´št_cÚfig
();

227 
Ba£lšeV”tiûsInMemProg¿m
 
´og¿m
;

228 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

229 
	`£t_’gše_æags
(
’gše
);

230 
³ngše
 = &
’gše
;

231 
’gše
.
	`run
(
´og¿m
, 1);

233 ià(
®go
 =ğ
USER_MEAN
 ||‡lgØ=ğ
ITEM_MEAN
)

234 
	`ouut_ba£lše_»suÉ
(
Œaššg
);

235 
	`‹¡_´ediùiÚs
(&
ba£lše_´ediù
);

238 ià(!
qu›t
)

239 
	`m‘rics_»pÜt
(
m
);

241 
	}
}

	@toolkits/collaborative_filtering/biassgd.cpp

32 
	~"commÚ.hµ
"

33 
	~"eig’_w¿µ”.hµ
"

35 
	gbŸssgd_Ïmbda
 = 1e-3;

36 
	gbŸssgd_gamma
 = 1e-3;

37 
	gbŸssgd_¡•_dec
 = 0.9;

38 
	#BIAS_POS
 -1

	)

40 
	sv”‹x_d©a
 {

41 
vec
 
	mpvec
;

42 
	mbŸs
;

44 
v”‹x_d©a
() {

45 
	mpvec
 = 
z”os
(
D
);

46 
	mbŸs
 = 0;

49 
£t_v®
(
šdex
, 
v®
){

50 ià(
	mšdex
 =ğ
BIAS_POS
)

51 
bŸs
 = 
v®
;

52 
	mpvec
[
šdex
] = 
v®
;

54 
g‘_v®
(
šdex
){

55 ià(
	mšdex
=ğ
BIAS_POS
)

56  
bŸs
;

57  
	mpvec
[
šdex
];

68 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

69 
	tEdgeD©aTy³
;

71 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

72 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	gpv®id©iÚ_’gše
 = 
NULL
;

73 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

74 
	~"rm£.hµ
"

75 
	~"rm£_’gše.hµ
"

76 
	~"io.hµ
"

79 
	$bŸs_sgd_´ediù
(cÚ¡ 
v”‹x_d©a
& 
u£r
,

80 cÚ¡ 
v”‹x_d©a
& 
mov›
,

81 cÚ¡ 
¿tšg
,

82 & 
´ediùiÚ
,

83 * 
exŒa
 = 
NULL
){

86 
´ediùiÚ
 = 
glob®M—n
 + 
u£r
.
bŸs
 + 
mov›
.bŸ + 
	`dÙ_´od
(u£r.
pvec
, movie.pvec);

88 
´ediùiÚ
 = 
¡d
::
	`mš
((í»diùiÚ, 
maxv®
);

89 
´ediùiÚ
 = 
¡d
::
	`max
((í»diùiÚ, 
mšv®
);

91 
”r
 = 
¿tšg
 - 
´ediùiÚ
;

92 ià(
¡d
::
	`i¢ª
(
”r
))

93 
	`log¡»am
(
LOG_FATAL
)<<"GÙ iÁØnum”iÿÈ”rÜs. TryØdeü—£ s‹°sizusšg bŸs-SGD commªd†š¬ugm’ts)" << 
¡d
::
’dl
;

94  
”r
*err;

96 
	}
}

104 
	gBIASSGDV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

109 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

110 
»£t_rm£
(
gcÚ‹xt
.
exeùh»ads
);

117 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

118 
	gbŸssgd_gamma
 *ğ
bŸssgd_¡•_dec
;

119 
Œaššg_rm£
(
™”©iÚ
, 
gcÚ‹xt
);

120 
run_v®id©iÚ
(
pv®id©iÚ_’gše
, 
gcÚ‹xt
);

126 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

127 iàĞ
	gv”‹x
.
num_ou‹dges
() > 0){

128 
	gv”‹x_d©a
 & 
	gu£r
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

129 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

130 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

131 
	gv”‹x_d©a
 & 
	gmov›
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

132 
	ge¡ScÜe
 = 0;

133 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
bŸs_sgd_´ediù
(
u£r
, 
mov›
, 
ob£rv©iÚ
, 
e¡ScÜe
);

134 
	g”r
 = 
ob£rv©iÚ
 - 
e¡ScÜe
;

135 ià(
	g¡d
::
i¢ª
(
”r
è|| 
¡d
::
isšf
(err))

136 
log¡»am
(
LOG_FATAL
)<<"BIASSGD gÙ iÁØnum”iÿÈ”rÜ. PËa£uÃ s‹°sizusšg --bŸssgd_gamm¨ªd bŸssgd_Ïmbda" << 
¡d
::
’dl
;

137 
	gu£r
.
	gbŸs
 +ğ
bŸssgd_gamma
*(
”r
 - 
bŸssgd_Ïmbda
* 
u£r
.
bŸs
);

138 
	gmov›
.
	gbŸs
 +ğ
bŸssgd_gamma
*(
”r
 - 
bŸssgd_Ïmbda
* 
mov›
.
bŸs
);

146 
	gmov›
.
	gpvec
 +ğ
bŸssgd_gamma
*(
”r
*
u£r
.
pvec
 - 
bŸssgd_Ïmbda
*
mov›
.pvec);

148 
	gu£r
.
	gpvec
 +ğ
bŸssgd_gamma
*(
”r
*
mov›
.
pvec
 - 
bŸssgd_Ïmbda
*
u£r
.pvec);

160 
ouut_bŸssgd_»suÉ
(
¡d
::
¡ršg
 
f’ame
){

161 
MMOuu‰”_m©
<
v”‹x_d©a
> 
u£r_ouut
(
f’ame
 + "_U.mm", 0, 
M
, "Thi fcÚš bŸs-SGD ouuˆm©rix U. IÀ—ch„ow D faùÜ oà¨sšgË u£¸node.", 
Ï‹Á_çùÜs_šmem
);

162 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
™em_ouut
(
f’ame
 + "_V.mm", 
M
, M+
N
 , "Thi fcÚš bŸs-SGD ouuˆm©rix V. IÀ—ch„ow D faùÜ oà¨sšgË i‹m‚ode.", 
Ï‹Á_çùÜs_šmem
);

163 
	gMMOuu‰”_vec
<
	gv”‹x_d©a
> 
u£r_bŸs_vec
(
f’ame
 + "_U_bŸs.mm", 0, 
M
, 
BIAS_POS
, "Thi fcÚš bŸs-SGD ouuˆbŸ veùÜ. IÀ—ch„ow‡ sšgË u£¸bŸs.", 
Ï‹Á_çùÜs_šmem
);

164 
	gMMOuu‰”_vec
<
	gv”‹x_d©a
> 
™em_bŸs_vec
(
f’ame
 + "_V_bŸs.mm",
M
 ,M+
N
, 
BIAS_POS
, "Thi fcÚš bŸs-SGD ouuˆbŸ veùÜ. IÀ—ch„ow‡ sšgË i‹m bŸs.", 
Ï‹Á_çùÜs_šmem
);

165 
MMOuu‰”_sÿÏr
 
gm—n
(
f’ame
 + "_glob®_m—n.mm", "Thi fcÚš SVD++ glob® m—Àwhich i »quœed fÜ computšg…»diùiÚs.", 
glob®M—n
);

167 
log¡»am
(
LOG_INFO
è<< "SVDPP ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << "_U.mm" <<

168 ", " << 
	gf’ame
 + "_V.mm, " << f’am<< "_U_bŸs.mm, " << f’am<< "_V_bŸs.mm, " << f’am<< "_glob®_m—n.mm" << 
	g¡d
::
’dl
;

172 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

173 
	`´št_cİyright
();

176 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

180 
m‘rics
 
	`m
("biassgd-inmemory-factors");

182 
bŸssgd_Ïmbda
 = 
	`g‘_İtiÚ_æßt
("biassgd_lambda", 1e-3);

183 
bŸssgd_gamma
 = 
	`g‘_İtiÚ_æßt
("biassgd_gamma", 1e-3);

184 
bŸssgd_¡•_dec
 = 
	`g‘_İtiÚ_æßt
("biassgd_step_dec", 0.9);

187 
	`·r£_commªd_lše_¬gs
();

188 
	`·r£_im¶ic™_commªd_lše
();

192 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
Œaššg
, 
NULL
, 0, 0, 3, 
TRAINING
, 
çl£
);

193 
š™_ã©u»_veùÜs
<
¡d
::
veùÜ
<
v”‹x_d©a
> >(
M
+
N
, 
Ï‹Á_çùÜs_šmem
, !
lßd_çùÜs_äom_fe
);

194 ià(
v®id©iÚ
 != ""){

195 
vsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
v®id©iÚ
, 
NULL
, 0, 0, 3, 
VALIDATION
, 
çl£
);

196 
š™_v®id©iÚ_rm£_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
>(
pv®id©iÚ_’gše
, 
vsh¬ds
, &
bŸs_sgd_´ediù
);

200 ià(
lßd_çùÜs_äom_fe
){

201 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_U.mm", 0, 
D
);

202 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_V.mm", 
M
, 
D
);

203 
vec
 
u£r_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 +"_U_bŸs.mm", 
çl£
, 
Œue
);

204 
vec
 
™em_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 +"_V_bŸs.mm", 
çl£
, 
Œue
);

205 
ušt
 
i
=0; i<
M
+
N
; i++){

206 
Ï‹Á_çùÜs_šmem
[
i
].
bŸs
 = ((i<
M
)?
u£r_bŸs
[i] : 
™em_bŸs
[i-M]);

208 
vec
 
gm
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 + "_glob®_m—n.mm", 
çl£
, 
Œue
);

209 
glob®M—n
 = 
gm
[0];

214 
BIASSGDV”tiûsInMemProg¿m
 
´og¿m
;

215 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

216 
	`£t_’gše_æags
(
’gše
);

217 
³ngše
 = &
’gše
;

218 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

221 
	`ouut_bŸssgd_»suÉ
(
Œaššg
);

222 
	`‹¡_´ediùiÚs
(&
bŸs_sgd_´ediù
);

226 ià(!
qu›t
)

227 
	`m‘rics_»pÜt
(
m
);

229 
	}
}

	@toolkits/collaborative_filtering/biassgd2.cpp

33 
	~"commÚ.hµ
"

34 
	~"eig’_w¿µ”.hµ
"

36 
	gbŸssgd_Ïmbda
 = 1e-3;

37 
	gbŸssgd_gamma
 = 1e-3;

38 
	gbŸssgd_¡•_dec
 = 0.9;

39 
	#BIAS_POS
 -1

	)

41 
	sv”‹x_d©a
 {

42 
vec
 
	mpvec
;

43 
	mbŸs
;

45 
v”‹x_d©a
() {

46 
	mpvec
 = 
z”os
(
D
);

47 
	mbŸs
 = 0;

50 
£t_v®
(
šdex
, 
v®
){

51 ià(
	mšdex
 =ğ
BIAS_POS
)

52 
bŸs
 = 
v®
;

53 
	mpvec
[
šdex
] = 
v®
;

55 
g‘_v®
(
šdex
){

56 ià(
	mšdex
=ğ
BIAS_POS
)

57  
bŸs
;

58  
	mpvec
[
šdex
];

67 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

68 
	tEdgeD©aTy³
;

70 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

71 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	gpv®id©iÚ_’gše
 = 
NULL
;

72 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

73 
	~"rm£.hµ
"

74 
	~"rm£_’gše.hµ
"

75 
	~"io.hµ
"

78 
	$bŸs_sgd_´ediù
(cÚ¡ 
v”‹x_d©a
& 
u£r
,

79 cÚ¡ 
v”‹x_d©a
& 
mov›
,

80 cÚ¡ 
¿tšg
,

81 & 
´ediùiÚ
,

82 * 
exŒa
 = 
NULL
){

85 
´ediùiÚ
 = 
glob®M—n
/
maxv®
 + 
u£r
.
bŸs
 + 
mov›
.bŸ + 
	`dÙ_´od
(u£r.
pvec
, movie.pvec);

87 
exp_´ediùiÚ
 = 1.0 / (1.0 + 
	`exp
(-
´ediùiÚ
));

89 
´ediùiÚ
 = 
mšv®
 + 
exp_´ediùiÚ
 *(
maxv®
-minval);

91 
”r
 = 
¿tšg
 - 
´ediùiÚ
;

92 ià(
¡d
::
	`i¢ª
(
”r
))

93 
	`log¡»am
(
LOG_FATAL
)<<"GÙ iÁØnum”iÿÈ”rÜs. TryØdeü—£ s‹°sizusšg bŸs-SGD commªd†š¬ugm’ts)" << 
¡d
::
’dl
;

95 ià(
exŒa
 !ğ
NULL
)

96 *(*)
exŒa
 = 
exp_´ediùiÚ
;

98  
	`ÿlc_loss
(
exp_´ediùiÚ
, 
”r
);

100 
	}
}

108 
	gBIASSGDV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

114 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

115 
»£t_rm£
(
gcÚ‹xt
.
exeùh»ads
);

122 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

123 
	gbŸssgd_gamma
 *ğ
bŸssgd_¡•_dec
;

124 
Œaššg_rm£
(
™”©iÚ
, 
gcÚ‹xt
);

125 
run_v®id©iÚ
(
pv®id©iÚ_’gše
, 
gcÚ‹xt
);

131 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

133 iàĞ
	gv”‹x
.
num_ou‹dges
() > 0){

134 
	gv”‹x_d©a
 & 
	gu£r
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

135 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

136 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

137 
	gv”‹x_d©a
 & 
	gmov›
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

138 
	g´ediùiÚ
;

139 
	gexp_´ediùiÚ
;

140 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
bŸs_sgd_´ediù
(
u£r
, 
mov›
, 
ob£rv©iÚ
, 
´ediùiÚ
, &
exp_´ediùiÚ
);

141 
	g”r
 = 
ob£rv©iÚ
 - 
´ediùiÚ
;

142 
	g”r
 = 
ÿlc_”rÜ_f
(
exp_´ediùiÚ
, 
”r
);

144 ià(
	g¡d
::
i¢ª
(
”r
è|| 
¡d
::
isšf
(err))

145 
log¡»am
(
LOG_FATAL
)<<"BIASSGD gÙ iÁØnum”iÿÈ”rÜ. PËa£uÃ s‹°sizusšg --bŸssgd_gamm¨ªd bŸssgd_Ïmbda" << 
¡d
::
’dl
;

147 
	gu£r
.
	gbŸs
 +ğ
bŸssgd_gamma
*(
”r
 - 
bŸssgd_Ïmbda
* 
u£r
.
bŸs
);

148 
	gmov›
.
	gbŸs
 +ğ
bŸssgd_gamma
*(
”r
 - 
bŸssgd_Ïmbda
* 
mov›
.
bŸs
);

156 
	gmov›
.
	gpvec
 +ğ
bŸssgd_gamma
*(
”r
*
u£r
.
pvec
 - 
bŸssgd_Ïmbda
*
mov›
.pvec);

158 
	gu£r
.
	gpvec
 +ğ
bŸssgd_gamma
*(
”r
*
mov›
.
pvec
 - 
bŸssgd_Ïmbda
*
u£r
.pvec);

164 
ouut_bŸssgd_»suÉ
(
¡d
::
¡ršg
 
f’ame
){

165 
MMOuu‰”_m©
<
v”‹x_d©a
> 
u£r_m©
(
f’ame
 + "_U.mm", 0, 
M
, "Thi fcÚš bŸs-SGD ouuˆm©rix U. IÀ—ch„ow D faùÜ oà¨sšgË u£¸node.", 
Ï‹Á_çùÜs_šmem
);

166 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
™em_m©
(
f’ame
 + "_V.mm", 
M
, M+
N
 , "Thi fcÚš bŸs-SGD ouuˆm©rix V. IÀ—ch„ow D faùÜ oà¨sšgË i‹m‚ode.", 
Ï‹Á_çùÜs_šmem
);

167 
	gMMOuu‰”_vec
<
	gv”‹x_d©a
> 
u£r_bŸs_vec
(
f’ame
 + "_U_bŸs.mm", 0, 
M
, 
BIAS_POS
, "Thi fcÚš bŸs-SGD ouuˆbŸ veùÜ. IÀ—ch„ow‡ sšgË u£¸bŸs.",
Ï‹Á_çùÜs_šmem
);

168 
	gMMOuu‰”_vec
<
	gv”‹x_d©a
> 
™em_bŸs_vec
(
f’ame
 + "_V_bŸs.mm",
M
 ,M+
N
, 
BIAS_POS
, "Thi fcÚš bŸs-SGD ouuˆbŸ veùÜ. IÀ—ch„ow‡ sšgË i‹m bŸs.", 
Ï‹Á_çùÜs_šmem
);

169 
MMOuu‰”_sÿÏr
 
gm—n
(
f’ame
 + "_glob®_m—n.mm", "Thi fcÚš SVD++ glob® m—Àwhich i »quœed fÜ computšg…»diùiÚs.", 
glob®M—n
);

171 
log¡»am
(
LOG_INFO
è<< "SVDPP ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << "_U.mm" <<

172 ", " << 
	gf’ame
 + "_V.mm, " << f’am<< "_U_bŸs.mm, " << f’am<< "_V_bŸs.mm, " << f’am<< "_glob®_m—n.mm" << 
	g¡d
::
’dl
;

176 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

177 
	`´št_cİyright
();

180 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

184 
m‘rics
 
	`m
("biassgd2");

186 
bŸssgd_Ïmbda
 = 
	`g‘_İtiÚ_æßt
("biassgd_lambda", 1e-3);

187 
bŸssgd_gamma
 = 
	`g‘_İtiÚ_æßt
("biassgd_gamma", 1e-3);

188 
bŸssgd_¡•_dec
 = 
	`g‘_İtiÚ_æßt
("biassgd_step_dec", 0.9);

189 
	`·r£_commªd_lše_¬gs
();

190 
	`·r£_im¶ic™_commªd_lše
();

192 ià(
maxv®
 =ğ1e100 || 
mšv®
 == -1e100)

193 
	`log¡»am
(
LOG_FATAL
)<<"You mu¡ s‘ mš‡Îowed„©šg‡nd max‡Îowed„©šg usšgh--mšv®‡nd --mav® fÏgs" << 
¡d
::
’dl
;

196 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
Œaššg
, 
NULL
,0, 0, 3, 
TRAINING
, 
çl£
);

197 
š™_ã©u»_veùÜs
<
¡d
::
veùÜ
<
v”‹x_d©a
> >(
M
+
N
, 
Ï‹Á_çùÜs_šmem
, !
lßd_çùÜs_äom_fe
);

198 ià(
v®id©iÚ
 != ""){

199 
vsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
v®id©iÚ
, 
NULL
, 0, 0, 3, 
VALIDATION
, 
çl£
);

200 
š™_v®id©iÚ_rm£_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
>(
pv®id©iÚ_’gše
, 
vsh¬ds
, &
bŸs_sgd_´ediù
);

204 ià(
lßd_çùÜs_äom_fe
){

205 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_U.mm", 0, 
D
);

206 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_V.mm", 
M
, 
D
);

207 
vec
 
u£r_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 +"_U_bŸs.mm", 
çl£
, 
Œue
);

208 
vec
 
™em_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 +"_V_bŸs.mm", 
çl£
, 
Œue
);

209 
ušt
 
i
=0; i<
M
+
N
; i++){

210 
Ï‹Á_çùÜs_šmem
[
i
].
bŸs
 = ((i<
M
)?
u£r_bŸs
[i] : 
™em_bŸs
[i-M]);

212 
vec
 
gm
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 + "_glob®_m—n.mm", 
çl£
, 
Œue
);

213 
glob®M—n
 = 
gm
[0];

218 
BIASSGDV”tiûsInMemProg¿m
 
´og¿m
;

219 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

220 
	`£t_’gše_æags
(
’gše
);

221 
³ngše
 = &
’gše
;

222 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

225 
	`ouut_bŸssgd_»suÉ
(
Œaššg
);

226 
	`‹¡_´ediùiÚs
(&
bŸs_sgd_´ediù
);

230 ià(!
qu›t
)

231 
	`m‘rics_»pÜt
(
m
);

233 
	}
}

	@toolkits/collaborative_filtering/common.hpp

1 #iâdeà
_COMMON_H__


2 
	#_COMMON_H__


	)

26 
	~<®gÜ™hm
>

27 
	~<as£¹.h
>

28 
	~<cm©h
>

29 
	~<”ºo.h
>

30 
	~<¡ršg
>

32 
	~"ut.hµ
"

33 
	~"g¿phchi_basic_šşudes.hµ
"

34 
	~"­i/v”‹x_agg»g©Ü.hµ
"

35 
	~"´•roûssšg/sh¬d”.hµ
"

36 
	~"../../exam¶e_­ps/m©rix_çùÜiz©iÚ/m©rixm¬k‘/mmio.h
"

37 
	~"../../exam¶e_­ps/m©rix_çùÜiz©iÚ/m©rixm¬k‘/mmio.c
"

39 
	~<¡dio.h
>

40 #ifdeà
__APPLE__


41 
	~"g‘lše.hµ
"

44 
usšg
 
Çme¥aû
 
	gg¿phchi
;

46 
	gmšv®
 = -1e100;

47 
	gmaxv®
 = 1e100;

48 
	gv®¿nge
 = 1;

49 
	g¡d
::
¡ršg
 
Œaššg
;

50 
	g¡d
::
¡ršg
 
v®id©iÚ
;

51 
	g¡d
::
¡ršg
 
‹¡
;

52 
ušt
 
	gM
, 
	gN
, 
	gK
;

53 
size_t
 
	gL
, 
	gLe
;

54 
ušt
 
	gMe
, 
	gNe
;

55 
	gglob®M—n
 = 0;

56 
	gglob®M—n2
 = 0;

57 
	grm£
=0.0;

58 
boŞ
 
	glßd_çùÜs_äom_fe
 = 
çl£
;

59 
	gun™‹¡
 = 0;

60 
	gn™”s
 = 10;

61 
	gh®t_Ú_rm£_šü—£
 = 0;

62 
	gD
 = 20;

63 
boŞ
 
	gqu›t
 = 
çl£
;

64 
	gšput_fe_off£t
 = 1;

67 
	g¡d
::
¡ršg
 
loss
 = "square";

69 
	mLOGISTIC
 = 0, 
	mSQUARE
 = 1, 
	mABS
 = 2, 
	mAP
 = 3

71 cÚ¡ * 
	g”rÜ_Çmes
[] = {"LOGISTIC LOSS", "RMSE", "MAE", "AP"};

72 
	gloss_ty³
 = 
SQUARE
;

73 
	gÿlc_­
 = 0;

74 
	g­_numb”
 = 3;

78 
	mTRAINING
ğ0, 
	mVALIDATION
 = 1, 
	mTEST
 = 2

81 
	$·r£_commªd_lše_¬gs
(){

83 
un™‹¡
 = 
	`g‘_İtiÚ_št
("unittest", 0);

84 
n™”s
 = 
	`g‘_İtiÚ_št
("max_iter", 6);

85 ià(
un™‹¡
 > 0)

86 
Œaššg
 = 
	`g‘_İtiÚ_¡ršg
("training", "");

87 
Œaššg
 = 
	`g‘_İtiÚ_¡ršg
("training");

88 
v®id©iÚ
 = 
	`g‘_İtiÚ_¡ršg
("validation", "");

89 
‹¡
 = 
	`g‘_İtiÚ_¡ršg
("test", "");

90 
D
 = 
	`g‘_İtiÚ_št
("D", D);

92 ià(
v®id©iÚ
 == "")

93 
v®id©iÚ
 +ğ
Œaššg
 + "e";

94 ià(
‹¡
 == "")

95 
‹¡
 +ğ
Œaššg
 + "t";

97 
maxv®
 = 
	`g‘_İtiÚ_æßt
("maxval", 1e100);

98 
mšv®
 = 
	`g‘_İtiÚ_æßt
("minval", -1e100);

99 
v®¿nge
 = 
maxv®
 - 
mšv®
;

100 
qu›t
 = 
	`g‘_İtiÚ_št
("quiet", 0);

101 ià(
qu›t
)

102 
	`glob®_logg”
().
	`£t_log_Ëv–
(
LOG_ERROR
);

103 
h®t_Ú_rm£_šü—£
 = 
	`g‘_İtiÚ_št
("halt_on_rmse_increase", 0);

105 
lßd_çùÜs_äom_fe
 = 
	`g‘_İtiÚ_št
("load_factors_from_file", 0);

106 
šput_fe_off£t
 = 
	`g‘_İtiÚ_æßt
("input_file_offset", input_file_offset);

108 
loss
 = 
	`g‘_İtiÚ_¡ršg
("loss",†oss);

109 ià(
loss
 == "square")

110 
loss_ty³
 = 
SQUARE
;

111 ià(
loss
 == "logistic")

112 
loss_ty³
 = 
LOGISTIC
;

113 ià(
loss
 == "abs")

114 
loss_ty³
 = 
ABS
;

115 ià(
loss
 == "ap")

116 
loss_ty³
 = 
AP
;

117 
	`log¡»am
(
LOG_FATAL
)<<"Los ty³ should bÚoà[squ¬e,logi¡ic,abs] (fÜƒxam¶e, --loss==squ¬e);" << 
¡d
::
’dl
;

119 
ÿlc_­
 = 
	`g‘_İtiÚ_št
("calc_ap", calc_ap);

120 ià(
ÿlc_­
)

121 
loss_ty³
 = 
AP
;

122 
­_numb”
 = 
	`g‘_İtiÚ_št
("ap_number",‡p_number);

123 
	}
}

125 
	g‹m¶©e
<
ty³Çme
 
	gT
>

126 
	$£t_’gše_æags
(
T
 & 
³ngše
){

127 
³ngše
.
	`£t_di§bË_v”‹xd©a_¡Üage
();

128 
³ngše
.
	`£t_’abË_d‘”mši¡ic_·¿Î–ism
(
çl£
);

129 
³ngše
.
	`£t_modif›s_šedges
(
çl£
);

130 
³ngše
.
	`£t_modif›s_ou‹dges
(
çl£
);

131 
³ngše
.
	`£t_´–ßd_comm™
(
çl£
);

132 
	}
}

133 
	g‹m¶©e
<
ty³Çme
 
	gT
>

134 
	$£t_’gše_æags
(
T
 & 
³ngše
, 
boŞ
 
modify_ou‹dges
){

135 
³ngše
.
	`£t_di§bË_v”‹xd©a_¡Üage
();

136 
³ngše
.
	`£t_’abË_d‘”mši¡ic_·¿Î–ism
(
çl£
);

137 
³ngše
.
	`£t_modif›s_šedges
(
çl£
);

138 
³ngše
.
	`£t_modif›s_ou‹dges
(
modify_ou‹dges
);

139 
³ngše
.
	`£t_´–ßd_comm™
(
çl£
);

140 
	}
}

143 
	$´št_cİyright
(){

144 
	`log¡»am
(
LOG_WARNING
)<<"GraphChi Collaborative filtering†ibrary is written by Danny Bickson (c). Send‡ny "

145 " comm’t Ü bug„•Üt tØdªny.bicksÚ@gma.com " << 
¡d
::
’dl
;

146 
	}
}

148 
	$´št_cÚfig
(){

149 
¡d
::
cout
<<"[ã©u»_width] => [" << 
D
 << "]" << std::
’dl
;

150 
¡d
::
cout
<<"[u£rs] => [" << 
M
 << "]" << std::
’dl
;

151 
¡d
::
cout
<<"[mov›s] => [" << 
N
 << "]" <<¡d::
’dl
;

152 
¡d
::
cout
<<"[Œaššg_¿tšgs] => [" << 
L
 << "]" << std::
’dl
;

153 
¡d
::
cout
<<"[numb”_of_th»ads] => [" << 
	`numb”_of_omp_th»ads
(è<< "]" <<¡d::
’dl
;

154 
¡d
::
cout
<<"[membudg‘_Mb] => [" << 
	`g‘_İtiÚ_št
("membudg‘_mb"è<< "]" <<¡d::
’dl
;

155 
	}
}

157 
	g‹m¶©e
<
ty³Çme
 
	gT
>

158 
	$š™_ã©u»_veùÜs
(
ušt
 
size
, 
T
& 
Ï‹Á_çùÜs_šmem
, 
boŞ
 
¿ndomize
 = 
Œue
){

159 
	`as£¹
(
size
 > 0);

161 
	`¤ªd48
(
	`time
(
NULL
));

162 
Ï‹Á_çùÜs_šmem
.
	`»size
(
size
);

163 ià(!
¿ndomize
)

166 #´agm¨
omp
 
·¿Î–
 

167 
i
=0; i < ()
size
; i++){

168 
j
=0; j<
D
; j++)

169 
Ï‹Á_çùÜs_šmem
[
i
].
pvec
[
j
] = 
	`d¿nd48
();

171 
	}
}

	@toolkits/collaborative_filtering/cosamp.hpp

27 #iâdeà
_COSAMP_HPP


28 
	#_COSAMP_HPP


	)

30 
	~"eig’_w¿µ”.hµ
"

33 
ivec
 
	$sÜt_uniÚ
(
ivec
 
a
, iveø
b
){

34 
ivec
 
ab
 = 
	`cÚÿt
(
a
,
b
);

35 
	`sÜt
(
ab
);

36 
i
=1; i< 
ab
.
	`size
(); i++){

37 ià(
ab
[
i
] ==‡b[i-1])

38 
	`d–
(
ab
,
i
);

40  
ab
;

41 
	}
}

44 
vec
 
	$CoSaMP
(cÚ¡ 
m©
 & 
Phi
, cÚ¡ 
vec
 & 
u
, 
K
, 
max_™”
, 
tŞ1
, 
D
){

46 
	`as£¹
(
K
<ğ2*
D
);

47 
	`as£¹
(
K
>=1);

49 
	`as£¹
(
Phi
.
	`rows
(è=ğPhi.
	`cŞs
());

50 
	`as£¹
(
Phi
.
	`rows
(è=ğ
D
);

51 
	`as£¹
(
u
.
	`size
(è=ğ
D
);

54 
vec
 
Se¡
 = 
	`z”os
(
D
);

55 
vec
 
uŒue
 = 
Se¡
;

56 
vec
 
v
 = 
u
;

57 
t
=1;

58 
ivec
 
T2
;

60 
t
<
max_™”
){

61 
ivec
 
z
 = 
	`sÜt_šdex
(
	`çbs
(
Phi
.
	`Œª¥o£
(è* 
v
));

62 
z
 = 
	`»v”£
(z);

63 
ivec
 
Omega
 = 
	`h—d
(
z
,2*
K
);

64 
ivec
 
T
=
	`sÜt_uniÚ
(
Omega
,
T2
);

65 
m©
 
ph™
=
	`g‘_cŞs
(
Phi
, 
T
);

66 
vec
 
b
;

67 
boŞ
 
»t
 = 
	`back¦ash
(
ph™
, 
u
, 
b
);

68 
	`as£¹
(
»t
);

69 
»t
 = 
çl£
;

70 
b
ğ
	`çbs
(b);

71 
ivec
 
z3
 = 
	`sÜt_šdex
(
b
);

72 
z3
 = 
	`»v”£
(z3);

73 
Se¡
=
	`z”os
(
D
);

74 
i
=0; i< 
K
; i++)

75 
	`£t_v®
(
Se¡
, 
z3
[
i
], 
b
[z3[i]]);

76 
ivec
 
z2
 = 
	`sÜt_šdex
(
	`çbs
(
Se¡
));

77 
z2
 = 
	`»v”£
(z2);

78 
T2
 = 
	`h—d
(
z2
,
K
-1);

79 
v
=
u
-
Phi
*
Se¡
;

80 
n2
 = 
	`max
(
	`çbs
(
v
));

81 ià(
n2
 < 
tŞ1
)

83 
t
++;

85  
Se¡
;

87 
	}
}

91 
	$‹¡_co§mp
(){

93 
m©
 
A
ğ
	`š™_m©
("0.9528 0.5982 0.8368 ; 0.7041 0.8407 0.5187; 0.9539 0.4428 0.0222", 3, 3);

94 
vec
 
b
ğ
	`š™_vec
(" 0.3759 0.8986 0.4290",3);

95 
K
=1;

96 
•sÚ
 =1e-3;

97 
vec
 
»t
 = 
	`CoSaMP
(
A
,
b
,
K
,10, 
•sÚ
,3);

98 
vec
 
right
 = 
	`š™_vec
("0 1.2032 0", 3);

99 
diff
 = 
	`nÜm
(
»t
 - 
right
);

100 
	`as£¹
(
diff
 <1e-4);

101 
diff
 = 0;

103 
	}
}

	@toolkits/collaborative_filtering/distance.hpp

1 #iâdeà
_DISTANCE_HPP__


2 
	#_DISTANCE_HPP__


	)

3 
	~"g¿phchi_basic_šşudes.hµ
"

6 
	tæt_dbl
;

7 
¥¬£_vec
 
	t¥¬£_æt_dbl_vec
;

8 
vec
 
	tæt_dbl_vec
;

9 
debug
;

11 
	$§ãLog
(
d
) {

12  
d
 <ğ0.0 ? 0.0 : 
	`log
(d);

13 
	}
}

14 
	$logL
(
p
, 
k
, 
n
) {

15  
k
 * 
	`§ãLog
(
p
è+ (
n
 - k) * safeLog(1.0 -…);

16 
	}
}

18 
	$twoLogLambda
(
k1
, 
k2
, 
n1
, 
n2
) {

19 
p
 = (
k1
 + 
k2
è/ (
n1
 + 
n2
);

20  2.0 * (
	`logL
(
k1
 / 
n1
, k1,‚1è+†ogL(
k2
 / 
n2
, k2,‚2è-†ogL(
p
, k1,‚1) -†ogL(p, k2,‚2));

21 
	}
}

23 
æt_dbl
 
	$ÿlc_loglik–ihood_di¡ªû
Ğ
¥¬£_æt_dbl_vec
 & 
d©­ošt
, s·r£_æt_dbl_veø& 
şu¡”
, 
æt_dbl
 
sqr_sum
, fÉ_dbÈ
sqr_sum_d©­ošt
){

24 
æt_dbl
 
š‹r£ùiÚ
 = 
	`dÙ_´od
(
d©­ošt
 , 
şu¡”
);

25 
æt_dbl
 
logLik–ihood
 = 
	`twoLogLambda
(
š‹r£ùiÚ
,

26 
sqr_sum
 - 
š‹r£ùiÚ
,

27 
sqr_sum_d©­ošt
,

28 
d©­ošt
.
	`size
(è- 
sqr_sum_d©­ošt
);

29  1.0 - 1.0 / (1.0 + 
logLik–ihood
);

30 
	}
}

32 
æt_dbl
 
	$ÿlc_loglik–ihood_di¡ªû
Ğ
¥¬£_æt_dbl_vec
 & 
d©­ošt
, 
æt_dbl_vec
 &
şu¡”
, 
æt_dbl
 
sqr_sum
, fÉ_dbÈ
sqr_sum_d©­ošt
){

33 
æt_dbl
 
š‹r£ùiÚ
 = 
	`dÙ_´od
(
d©­ošt
, 
şu¡”
);

34 
æt_dbl
 
logLik–ihood
 = 
	`twoLogLambda
(
š‹r£ùiÚ
,

35 
sqr_sum
 - 
š‹r£ùiÚ
,

36 
sqr_sum_d©­ošt
,

37 
d©­ošt
.
	`size
(è- 
sqr_sum_d©­ošt
);

38  1.0 - 1.0 / (1.0 + 
logLik–ihood
);

39 
	}
}

43 
æt_dbl
 
	$ÿlc_nimÙo_di¡ªû
Ğ
¥¬£_æt_dbl_vec
 & 
d©­ošt
, s·r£_æt_dbl_veø& 
şu¡”
, 
æt_dbl
 
sqr_sum
, fÉ_dbÈ
sqr_sum_d©­ošt
){

44 
æt_dbl
 
a_muÉ_b
 = 
	`dÙ_´od
(
d©­ošt
 , 
şu¡”
);

45 
æt_dbl
 
div
 = (
sqr_sum
 + 
sqr_sum_d©­ošt
 - 
a_muÉ_b
);

46 ià(
debug
 && (
div
 =ğ0 || 
a_muÉ_b
/div < 0)){

47 
	`log¡»am
(
LOG_ERROR
è<< "divisÜ i zeo: " << 
sqr_sum
<< " " << 
sqr_sum_d©­ošt
 << " " << 
a_muÉ_b
 << " " << 
¡d
::
’dl
;

48 
	`´št
(
d©­ošt
);

49 
	`´št
(
şu¡”
);

50 
	`ex™
(1);

52  1.0 - 
a_muÉ_b
/
div
;

53 
	}
}

55 
æt_dbl
 
	$ÿlc_nimÙo_di¡ªû
Ğ
¥¬£_æt_dbl_vec
 & 
d©­ošt
, 
æt_dbl_vec
 &
şu¡”
, 
æt_dbl
 
sqr_sum
, fÉ_dbÈ
sqr_sum_d©­ošt
){

56 
æt_dbl
 
a_muÉ_b
 = 
	`dÙ_´od
(
d©­ošt
, 
şu¡”
);

57 
æt_dbl
 
div
 = (
sqr_sum
 + 
sqr_sum_d©­ošt
 - 
a_muÉ_b
);

58 ià(
debug
 && (
div
 =ğ0 || 
a_muÉ_b
/div < 0)){

59 
	`log¡»am
(
LOG_ERROR
è<< "divisÜ i zeo: " << 
sqr_sum
 << " " << 
sqr_sum_d©­ošt
 << " " << 
a_muÉ_b
 << " " << 
¡d
::
’dl
;

60 
	`´št
(
d©­ošt
);

61 
	`debug_´št_vec
("şu¡”", 
şu¡”
, clu¡”.
	`size
());

62 
	`ex™
(1);

64  1.0 - 
a_muÉ_b
/
div
;

65 
	}
}

67 
æt_dbl
 
	$ÿlc_jacÿrd_weight_di¡ªû
Ğ
¥¬£_æt_dbl_vec
 & 
d©­ošt
, s·r£_æt_dbl_veø& 
şu¡”
, 
æt_dbl
 
sqr_sum
, fÉ_dbÈ
sqr_sum_d©­ošt
){

68 
æt_dbl
 
a_size
 = 0;

69 
	`FOR_ITERATOR
(
i
, 
d©­ošt
){

70 
a_size
+ğ
i
.
	`v®ue
();

72 
æt_dbl
 
b_size
 = 0;

73 
	`FOR_ITERATOR
(
i
, 
şu¡”
){

74 
b_size
+ğ
i
.
	`v®ue
();

76 
æt_dbl
 
š‹r£ùiÚ_size
 = 
sqr_sum
;

77 
	`as£¹
(
š‹r£ùiÚ_size
 != 0);

78  
š‹r£ùiÚ_size
 / (
a_size
+
b_size
-intersection_size);

79 
	}
}

83 
æt_dbl
 
	$ÿlc_euşidŸn_di¡ªû
Ğ
¥¬£_æt_dbl_vec
 & 
d©­ošt
, s·r£_æt_dbl_veø&
şu¡”
, 
æt_dbl
 
sqr_sum
, fÉ_dbÈ
sqr_sum_d©­ošt
){

86 
¥¬£_æt_dbl_vec
 
muÉ
 = 
	`–em_muÉ
(
d©­ošt
, 
şu¡”
);

87 
æt_dbl
 
diff
 = (
sqr_sum
 + 
sqr_sum_d©­ošt
 - 2*
	`sum
(
muÉ
));

88  
	`sq¹
(
	`çbs
(
diff
));

89 
	}
}

115 
æt_dbl
 
	$ÿlc_chebychev_di¡ªû
Ğ
¥¬£_æt_dbl_vec
 & 
d©­ošt
, s·r£_æt_dbl_veø&
şu¡”
){

116 
¥¬£_æt_dbl_vec
 
diff
 = 
	`mšus
(
d©­ošt
 , 
şu¡”
);

117 
æt_dbl
 
»t
 = 0;

118 
	`FOR_ITERATOR
(
i
, 
diff
){

119 
»t
 = 
¡d
::
	`max
Ô‘, (
æt_dbl
)
	`çbs
(
	`g‘_nz_d©a
(
diff
, 
i
)));

121  
»t
;

123 
	}
}

124 
æt_dbl
 
	$ÿlc_chebychev_di¡ªû
Ğ
¥¬£_æt_dbl_vec
 & 
d©­ošt
, 
æt_dbl_vec
 &
şu¡”
){

125 
æt_dbl_vec
 
diff
 = 
	`mšus
(
d©­ošt
 , 
şu¡”
);

126 
æt_dbl
 
»t
 = 0;

127 
i
=0; i< 
diff
.
	`size
(); i++)

128 
»t
 = 
¡d
::
	`max
Ô‘, (
æt_dbl
)
	`çbs
(
diff
[
i
]));

130  
»t
;

132 
	}
}

134 
æt_dbl
 
	$ÿlc_mªh©‹n_di¡ªû
Ğ
¥¬£_æt_dbl_vec
 & 
d©­ošt
, s·r£_æt_dbl_veø&
şu¡”
){

135 
¥¬£_æt_dbl_vec
 
diff
 = 
	`mšus
(
d©­ošt
 , 
şu¡”
);

136 
¥¬£_æt_dbl_vec
 
absvec
 = 
	`çbs
(
diff
);

137 
æt_dbl
 
»t
 = 
	`sum
(
absvec
);

138  
»t
;

140 
	}
}

141 
æt_dbl
 
	$ÿlc_mªh©‹n_di¡ªû
Ğ
¥¬£_æt_dbl_vec
 & 
d©­ošt
, 
æt_dbl_vec
 &
şu¡”
){

142 
æt_dbl_vec
 
diff
 = 
	`mšus
(
d©­ošt
 , 
şu¡”
);

143 
æt_dbl
 
»t
 = 
	`sum
(
	`çbs
(
diff
));

144  
»t
;

146 
	}
}

148 
æt_dbl
 
	$ÿlc_cosše_di¡ªû
Ğ
¥¬£_æt_dbl_vec
 & 
d©­ošt
, s·r£_æt_dbl_veø& 
şu¡”
, 
æt_dbl
 
sum_sqr
, fÉ_dbÈ
sum_sqr0
){

149 
æt_dbl
 
dÙ´od
 = 
	`dÙ_´od
(
d©­ošt
,
şu¡”
);

150 
æt_dbl
 
d’omš©Ü
 = 
	`sq¹
(
sum_sqr0
)*sq¹(
sum_sqr
);

151  1.0 - 
dÙ´od
 / 
d’omš©Ü
;

152 
	}
}

154 
æt_dbl
 
	$ÿlc_cosše_di¡ªû
Ğ
¥¬£_æt_dbl_vec
 & 
d©­ošt
, 
æt_dbl_vec
 & 
şu¡”
, 
æt_dbl
 
sum_sqr
, fÉ_dbÈ
sum_sqr0
){

155 
æt_dbl
 
dÙ´od
 = 
	`dÙ_´od
(
d©­ošt
,
şu¡”
);

156 
æt_dbl
 
d’omš©Ü
 = 
	`sq¹
(
sum_sqr0
)*sq¹(
sum_sqr
);

157  1.0 - 
dÙ´od
 / 
d’omš©Ü
;

158 
	}
}

160 
æt_dbl
 
	$ÿlc_dÙ_´oduù_di¡ªû
Ğ
¥¬£_æt_dbl_vec
 & 
d©­ošt
, 
æt_dbl_vec
 & 
şu¡”
){

161  
	`dÙ_´od
(
d©­ošt
, 
şu¡”
);

162 
	}
}

163 
æt_dbl
 
	$ÿlc_dÙ_´oduù_di¡ªû
Ğ
¥¬£_æt_dbl_vec
 & 
d©­ošt
, s·r£_æt_dbl_veø& 
şu¡”
){

164  
	`dÙ_´od
(
d©­ošt
, 
şu¡”
);

165 
	}
}

	@toolkits/collaborative_filtering/eigen_wrapper.hpp

26 #iâdeà
EIGEN_WRAPPER


27 
	#EIGEN_WRAPPER


	)

28 #ifdeà
EIGEN_NDEBUG


29 
	#NDEBUG


	)

38 
	~<io¡»am
>

39 
	~<f¡»am
>

40 
	~<o¡»am
>

42 
	~"Eig’/D’£
"

43 
	#EIGEN_YES_I_KNOW_SPARSE_MODULE_IS_NOT_STABLE_YET


	)

44 
	~"Eig’/S·r£
"

45 
	~"Eig’/ChŞesky
"

46 
	~"Eig’/Eig’v®ues
"

47 
	~"Eig’/SVD
"

48 
	#EIGEN_DONT_PARALLELIZE


49 
usšg
 
Çme¥aû
 
Eig’
;

	)

51 
M©rixXd
 
	tm©
;

52 
VeùÜXd
 
	tvec
;

53 
VeùÜXf
 
	tfvec
;

54 
VeùÜXi
 
	tivec
;

55 
M©rixXi
 
	tim©
;

56 
	gM©rix
<
	tsize_t
, 
	tDyÇmic
, DyÇmic> 
	tm©¡
;

57 
	gS·r£VeùÜ
<> 
	t¥¬£_vec
;

59 
šlše
 
	$debug_´št_vec
(cÚ¡ * 
Çme
,cÚ¡ 
vec
& 
_vec
, 
Ën
){

60 
	`´štf
("% è", 
Çme
);

61 
i
=0; i< 
Ën
; i++)

62 ià(
_vec
[
i
] == 0)

63 
	`´štf
(" 0 ");

64 
	`´štf
("%12.4g ", 
_vec
[
i
]);

65 
	`´štf
("\n");

66 
	}
}

67 
šlše
 
	$debug_´št_vec
(cÚ¡ * 
Çme
,cÚ¡ * 
_vec
, 
Ën
){

68 
	`´štf
("% è", 
Çme
);

69 
i
=0; i< 
Ën
; i++)

70 ià(
_vec
[
i
] == 0)

71 
	`´štf
(" 0 ");

72 
	`´štf
("%12.4g ", 
_vec
[
i
]);

73 
	`´štf
("\n");

74 
	}
}

75 
m©
 
¿ndn1
(
dx
, 
dy
, 
cŞ
);

77 
	g‹m¶©e
<
ty³Çme
 
	gm©
,y³Çm
	gd©a
>

78 
šlše
 
	$£t_v®
(
m©
 &
A
, 
row
, 
cŞ
, 
d©a
 
v®
){

79 
	`A
(
row
, 
cŞ
èğ
v®
;

80 
	}
}

81 
šlše
 
	$g‘_v®
(cÚ¡ 
m©
 &
A
, 
row
, 
cŞ
){

82  
	`A
(
row
, 
cŞ
);

83 
	}
}

84 
šlše
 
	$g‘_v®
(cÚ¡ 
im©
 &
A
, 
row
, 
cŞ
){

85  
	`A
(
row
, 
cŞ
);

86 
	}
}

87 
šlše
 
vec
 
	$g‘_cŞ
(cÚ¡ 
m©
& 
A
, 
cŞ
){

88  
A
.
	`cŞ
(
cŞ
);

89 
	}
}

90 
šlše
 
vec
 
	$g‘_row
(cÚ¡ 
m©
& 
A
, 
row
){

91  
A
.
	`row
(
row
);

92 
	}
}

93 
šlše
 
	$£t_cŞ
(
m©
& 
A
, 
cŞ
, cÚ¡ 
vec
 & 
v®
){

94 
A
.
	`cŞ
(
cŞ
èğ
v®
;

95 
	}
}

96 
šlše
 
	$£t_row
(
m©
& 
A
, 
row
, cÚ¡ 
vec
 & 
v®
){

97 
A
.
	`row
(
row
èğ
v®
;

98 
	}
}

100 
šlše
 
m©
 
	$eye
(
size
){

101  
m©
::
	`Id’t™y
(
size
, size);

102 
	}
}

103 
šlše
 
vec
 
	$Úes
(
size
){

104  
vec
::
	`OÃs
(
size
);

105 
	}
}

106 
šlše
 
fvec
 
	$fÚes
(
size
){

107  
fvec
::
	`OÃs
(
size
);

108 
	}
}

109 
šlše
 
vec
 
	$š™_vec
(cÚ¡ * 
¬¿y
, 
size
){

110 
vec
 
	`»t
(
size
);

111 
	`memıy
(
»t
.
	`d©a
(), 
¬¿y
, 
size
*());

112  
»t
;

113 
	}
}

114 
šlše
 
m©
 
	$š™_m©
(cÚ¡ * 
¡ršg
, 
row
, 
cŞ
){

115 
m©
 
	`out
(
row
, 
cŞ
);

116 
buf
[2056];

117 
	`¡rıy
(
buf
, 
¡ršg
);

118 *
pch
 = 
	`¡¹ok
(
buf
," \r\n\t;");

119 
i
=0; i< 
row
; i++){

120 
j
=0; j< 
cŞ
; j++){

121 
	`out
(
i
,
j
èğ
	`©of
(
pch
);

122 
pch
 = 
	`¡¹ok
 (
NULL
, " \r\n\t;");

125  
out
;

126 
	}
}

127 
šlše
 
im©
 
	$š™_im©
(cÚ¡ * 
¡ršg
, 
row
, 
cŞ
){

128 
im©
 
	`out
(
row
, 
cŞ
);

129 
buf
[2056];

130 
	`¡rıy
(
buf
, 
¡ršg
);

131 *
pch
 = 
	`¡¹ok
(
buf
," \r\n\t;");

132 
i
=0; i< 
row
; i++){

133 
j
=0; j< 
cŞ
; j++){

134 
	`out
(
i
,
j
èğ
	`©Ş
(
pch
);

135 
pch
 = 
	`¡¹ok
 (
NULL
, " \r\n\t;");

138  
out
;

139 
	}
}

140 
šlše
 
vec
 
	$š™_vec
(cÚ¡ * 
¡ršg
, 
size
){

141 
vec
 
	`out
(
size
);

142 
buf
[2056];

143 
	`¡rıy
(
buf
, 
¡ršg
);

144 *
pch
 = 
	`¡¹ok
 (
buf
," \r\n\t;");

145 
i
=0;

146 
pch
 !ğ
NULL
)

148 
	`out
(
i
è=
	`©of
(
pch
);

149 
pch
 = 
	`¡¹ok
 (
NULL
, " \r\n\t;");

150 
i
++;

152 
	`as£¹
(
i
 =ğ
size
);

153  
out
;

154 
	}
}

155 
šlše
 
vec
 
	$š™_dbl_vec
(cÚ¡ * 
¡ršg
, 
size
){

156  
	`š™_vec
(
¡ršg
, 
size
);

157 
	}
}

159 
šlše
 
vec
 
	$z”os
(
size
){

160  
vec
::
	`Z”o
(
size
);

161 
	}
}

162 
šlše
 
fvec
 
	$fz”os
(
size
){

163  
fvec
::
	`Z”o
(
size
);

164 
	}
}

165 
šlše
 
m©
 
	$z”os
(
rows
, 
cŞs
){

166  
m©
::
	`Z”o
(
rows
, 
cŞs
);

167 
	}
}

168 
šlše
 
vec
 
	$h—d
(cÚ¡ 
vec
& 
v
, 
num
){

169  
v
.
	`h—d
(
num
);

170 
	}
}

171 
šlše
 
vec
 
	$mid
(cÚ¡ 
vec
&
v
, 
¡¬t
, 
num
){

172  
v
.
	`£gm’t
(
¡¬t
, 
¡d
::
	`mš
(
num
, ()(v.
	`size
()-start)));

173 
	}
}

174 
šlše
 
vec
 
	$
(cÚ¡ 
vec
&
v
, 
num
){

175  
v
.
	`£gm’t
(v.
	`size
(è- 
num
,‚um);

176 
	}
}

177 
šlše
 
ivec
 
	$h—d
(cÚ¡ 
ivec
& 
v
, 
num
){

178  
v
.
	`h—d
(
num
);

179 
	}
}

180 
šlše
 
	$sÜt
(
ivec
 &
a
){

181 
¡d
::
	`sÜt
(
a
.
	`d©a
(),‡.d©a()+a.
	`size
());

182 
	}
}

183 
šlše
 
	$sÜt
(
vec
 & 
a
){

184 
¡d
::
	`sÜt
(
a
.
	`d©a
(),‡.d©a()+a.
	`size
());

185 
	}
}

186 
šlše
 
ivec
 
	$sÜt_šdex
(cÚ¡ 
vec
&
a
){

187 
ivec
 
	`»t
(
a
.
	`size
());

188 
¡d
::
veùÜ
<¡d::
·œ
<,> > 
D
;

190 
D
.
	`»£rve
(
a
.
	`size
());

191 
i
=0;i<
a
.
	`size
();i++)

192 
D
.
	`push_back
(
¡d
::
make_·œ
<,>(
a
.
	`cÛff
(
i
),i));

193 
¡d
::
	`sÜt
(
D
.
	`begš
(),D.
	`’d
());

194 
i
=0;i<
a
.
	`size
();i++)

196 
»t
[
i
]=
D
[i].
£cÚd
;

198  
»t
;

199 
	}
}

200 
šlše
 
	$dÙ2
(cÚ¡ 
vec
& 
x1
, cÚ¡ vec& 
x3
, 
m©
 & 
Q
, 
j
, 
Ën
){

201 
i
=0; i< 
Ën
; i++){

202 
	`Q
(
i
,
j
èğ(
	`x1
(iè* 
	`x3
(i));

204 
	}
}

206 
šlše
 
boŞ
 
	$ls_sŞve_chŞ
(cÚ¡ 
m©
 &
A
, cÚ¡ 
vec
 &
b
, veø&
»suÉ
){

208 
»suÉ
 = 
A
.
	`ldÉ
().
	`sŞve
(
b
);

209  
Œue
;

210 
	}
}

211 
šlše
 
boŞ
 
	$ls_sŞve
(cÚ¡ 
m©
 &
A
, cÚ¡ 
vec
 &
b
, veø&
»suÉ
){

213 
»suÉ
 = 
A
.
	`ldÉ
().
	`sŞve
(
b
);

214  
Œue
;

215 
	}
}

216 
šlše
 
boŞ
 
	$chŞ
(
m©
& 
sigma
, m©& 
out
){

217 
out
 = 
sigma
.
	`Ît
().
	`m©rixLLT
();

218  
Œue
;

219 
	}
}

220 
šlše
 
boŞ
 
	$back¦ash
(cÚ¡ 
m©
& 
A
, cÚ¡ 
vec
 & 
b
, veø& 
x
){

221 
x
 = 
A
.
	`jacobiSvd
(
Compu‹ThšU
 | 
Compu‹ThšV
).
	`sŞve
(
b
);

222  
Œue
;

223 
	}
}

224 
šlše
 
m©
 
	$Œª¥o£
(
m©
 & 
A
){

225  
A
.
	`Œª¥o£
();

226 
	}
}

227 
šlše
 
m©
 
	$¿ndn
(
dx
, 
dy
){

228  
	`¿ndn1
(
dx
,
dy
,-1);

229 
	}
}

230 
šlše
 
	$£t_dŸg
(
m©
 &
A
, 
vec
 & 
v
){

231 
A
.
	`dŸgÚ®
()=
v
;

232 
	}
}

233 
šlše
 
m©
 
	$dŸg
(
vec
 & 
v
){

234  
v
.
	`asDŸgÚ®
();

235 
	}
}

237 
	g‹m¶©e
<
ty³Çme
 
	gm©
>

238 
šlše
 
	$sumsum
(cÚ¡ 
m©
 & 
A
){

239  
A
.
	`sum
();

240 
	}
}

241 
šlše
 
	$nÜm
(cÚ¡ 
m©
 &
A
, 
pow
=2){

242  
A
.
	`squ¬edNÜm
();

243 
	}
}

244 
šlše
 
m©
 
	$šv
(cÚ¡ 
m©
&
A
){

245  
A
.
	`šv”£
();

246 
	}
}

247 
šlše
 
boŞ
 
	$šv
(cÚ¡ 
m©
&
A
, m© &
out
){

248 
out
 = 
A
.
	`šv”£
();

249  
Œue
;

250 
	}
}

251 
šlše
 
m©
 
	$ou‹r_´oduù
(cÚ¡ 
vec
&
a
, cÚ¡ vec&
b
){

252  
a
*
b
.
	`Œª¥o£
();

253 
	}
}

255 
šlše
 
boŞ
 
	$eig_sym
(cÚ¡ 
m©
 & 
T
, 
vec
 & 
eig’v®ues
, m© & 
eig’veùÜs
){

258 
S–fAdjoštEig’SŞv”
<
m©
> 
	`sŞv”
(
T
);

259 
eig’veùÜs
 = 
sŞv”
.
	`eig’veùÜs
();

260 
eig’v®ues
 = 
sŞv”
.
	`eig’v®ues
();

261 
ivec
 
šdex
 = 
	`sÜt_šdex
(
eig’v®ues
);

262 
	`sÜt
(
eig’v®ues
);

263 
vec
 
eig’v®ues2
 = 
eig’v®ues
.
	`»v”£
();

264 
m©
 
T2
 = 
	`z”os
(
eig’veùÜs
.
	`rows
(),ƒig’veùÜs.
	`cŞs
());

265 
i
=0; i< 
eig’veùÜs
.
	`cŞs
(); i++){

266 
	`£t_cŞ
(
T2
, 
šdex
[
i
], 
	`g‘_cŞ
(
eig’veùÜs
, i));

268 
eig’veùÜs
 = 
T2
;

269 
eig’v®ues
 = 
eig’v®ues2
;

270  
Œue
;

271 
	}
}

273 
šlše
 
vec
 
	$–em_muÉ
(cÚ¡ 
vec
&
a
, cÚ¡ vec&
b
){

274 
vec
 
»t
 = 
a
;

275 
i
=0; i<
b
.
	`size
(); i++)

276 
	`»t
(
i
è*ğ
	`b
(i);

277  
»t
;

278 
	}
}

279 
šlše
 
¥¬£_vec
 
	$–em_muÉ
(cÚ¡ 
¥¬£_vec
&
a
, cÚ¡ s·r£_vec&
b
){

280  
a
.
	`cwi£Produù
(
b
);

281 
	}
}

282 
šlše
 
	$sum
(cÚ¡ 
vec
 & 
a
){

283  
a
.
	`sum
();

284 
	}
}

285 
šlše
 
	$mš
(cÚ¡ 
vec
 &
a
){

286  
a
.
	`mšCÛff
();

287 
	}
}

288 
šlše
 
	$max
(cÚ¡ 
vec
 & 
a
){

289  
a
.
	`maxCÛff
();

290 
	}
}

291 
šlše
 
vec
 
	$¿ndu
(
size
){

292  
vec
::
	`Rªdom
(
size
);

293 
	}
}

294 
šlše
 
fvec
 
	$äªdu
(
size
){

295  
fvec
::
	`Rªdom
(
size
);

296 
	}
}

297 
šlše
 
	$¿ndu
(){

298  
vec
::
	`Rªdom
(1)(0);

299 
	}
}

300 
šlše
 
ivec
 
	$¿ndi
(
size
, 
äom
, 
to
){

301 
ivec
 
	`»t
(
size
);

302 
i
=0; i<
size
; i++)

303 
»t
[
i
]ğ
š‹º®
::
¿ndom
<>(
äom
,
to
);

304  
»t
;

305 
	}
}

306 
šlše
 
	$¿ndi
(
äom
, 
to
){

307  
š‹º®
::
¿ndom
<>(
äom
,
to
);

308 
	}
}

309 
šlše
 
ivec
 
	$cÚÿt
(cÚ¡ 
ivec
&
a
, cÚ¡ ivec&
b
){

310 
ivec
 
	`»t
(
a
.
	`size
()+
b
.size());

311 
»t
 << 
a
,
b
;

312  
»t
;

313 
	}
}

314 
šlše
 
	$d–
(
ivec
&
a
, 
i
){

315 
	`memıy
(
a
.
	`d©a
()+
i
,‡.d©a(è+ i+1, (a.
	`size
() - i - 1)*());

316 
a
.
	`cÚ£rv©iveResize
×.
	`size
() - 1);

317 
	}
}

318 
šlše
 
m©
 
	$g‘_cŞs
(cÚ¡ 
m©
&
A
, 
ivec
 & 
cŞs
){

319 
m©
 
	`a
(
A
.
	`rows
(), 
cŞs
.
	`size
());

320 
i
=0; i< 
cŞs
.
	`size
(); i++)

321 
	`£t_cŞ
(
a
, 
i
, 
	`g‘_cŞ
(
A
, 
cŞs
[i]));

322  
a
;

323 
	}
}

324 
šlše
 
m©
 
	$g‘_cŞs
(cÚ¡ 
m©
&
A
, 
¡¬t_cŞ
, 
’d_cŞ
){

325 
	`as£¹
(
’d_cŞ
 > 
¡¬t_cŞ
);

326 
	`as£¹
(
’d_cŞ
 <ğ
A
.
	`cŞs
());

327 
	`as£¹
(
¡¬t_cŞ
 >= 0);

328 
m©
 
	`a
(
A
.
	`rows
(), 
’d_cŞ
-
¡¬t_cŞ
);

329 
i
=0; i< 
’d_cŞ
-
¡¬t_cŞ
; i++)

330 
	`£t_cŞ
(
a
, 
i
, 
	`g‘_cŞ
(
A
, i));

331  
a
;

332 
	}
}

333 
šlše
 
	$£t_v®
(
vec
 & 
v
, 
pos
, 
v®
){

334 
	`v
(
pos
èğ
v®
;

335 
	}
}

336 
šlše
 
	$£t_v®
(
¥¬£_vec
 & 
v
, 
pos
, 
v®
){

337 
v
.
	`cÛffRef
(
pos
èğ
v®
;

338 
	}
}

339 
šlše
 
	$dÙ
(cÚ¡ 
vec
&
a
, cÚ¡ vec& 
b
){

340  
a
.
	`dÙ
(
b
);

341 
	}
}

342 
šlše
 
vec
 
	$»v”£
(
vec
& 
a
){

343  
a
.
	`»v”£
();

344 
	}
}

345 
šlše
 
ivec
 
	$»v”£
(
ivec
& 
a
){

346  
a
.
	`»v”£
();

347 
	}
}

348 
šlše
 cÚ¡ * 
	$d©a
(cÚ¡ 
m©
 &
A
){

349  
A
.
	`d©a
();

350 
	}
}

351 
šlše
 cÚ¡ * 
	$d©a
(cÚ¡ 
im©
 &
A
){

352  
A
.
	`d©a
();

353 
	}
}

354 
šlše
 cÚ¡ * 
	$d©a
(cÚ¡ 
vec
 &
v
){

355  
v
.
	`d©a
();

356 
	}
}

358 şas 
	c™_fe
{

359 
	m¡d
::
f¡»am
 
fb
;

361 
	mpublic
:

362 
	$™_fe
(cÚ¡ * 
Çme
){

363 
fb
.
	`İ’
(
Çme
, 
¡d
::
f¡»am
::
š
);

364 
fb
.
	`şo£
();

366 ià(
fb
.
	`ç
()){

367 
fb
.
	`ş—r
(
¡d
::
f¡»am
::
çb™
);

368 
fb
.
	`İ’
(
Çme
, 
¡d
::
f¡»am
::
out
 | std::f¡»am::
Œunc
 );

371 
fb
.
	`İ’
(
Çme
, 
¡d
::
f¡»am
::
š
);

374 ià(!
fb
.
	`is_İ’
()){

375 
	`³¼Ü
("Failed opening file ");

376 
	`´štf
("f’amis: %s\n", 
Çme
);

377 
	`as£¹
(
çl£
);

381 
¡d
::
f¡»am
 & 
İ”©Ü
<<(cÚ¡ std::
¡ršg
 
¡r
){

382 
size
 = 
¡r
.
	`size
();

383 
fb
.
	`wr™e
((*)&
size
, ());

384 
	`as£¹
(!
fb
.
	`ç
());

385 
fb
.
	`wr™e
(
¡r
.
	`c_¡r
(), 
size
);

386  
fb
;

387 
	}
}

388 
	g¡d
::
f¡»am
 &
İ”©Ü
<<(
m©
 & 
A
){

389 
rows
 = 
A
.rows(), 
	gcŞs
 = A.
cŞs
();

390 
	gfb
.
wr™e
Ğ(cÚ¡ *)&
rows
, ());

391 
	gfb
.
wr™e
Ğ(cÚ¡ *)&
cŞs
, ());

392 
	gi
=0; i< 
	gA
.
rows
(); i++)

393 
	gj
=0; j< 
	gA
. 
cŞs
(); j++){

394 
	gv®
 = 
A
(
i
,
j
);

395 
	gfb
.
wr™e
Ğ(cÚ¡ *)&
v®
, ());

396 
as£¹
(!
fb
.
ç
());

398  
	gfb
;

400 
	g¡d
::
f¡»am
 &
İ”©Ü
<<(cÚ¡ 
vec
 & 
v
){

401 
size
 = 
v
.size();

402 
	gfb
.
wr™e
Ğ(cÚ¡ *)&
size
, ());

403 
as£¹
(!
fb
.
ç
());

404 
	gi
=0; i< 
	gv
.
size
(); i++){

405 
	gv®
 = 
v
(
i
);

406 
	gfb
.
wr™e
Ğ(cÚ¡ *)&
v®
, ());

407 
as£¹
(!
fb
.
ç
());

409  
	gfb
;

411 
	g¡d
::
f¡»am
 & 
İ”©Ü
<<(cÚ¡ &
v
){

412 
fb
.
wr™e
((cÚ¡ *)&
v
, ());

413  
	gfb
;

415 
	g¡d
::
f¡»am
 & 
İ”©Ü
>>(
¡d
::
¡ršg
 
¡r
){

416 
size
 = -1;

417 
	gfb
.
»ad
((*)&
size
, ());

418 ià(
	gfb
.
ç
(è|| fb.
eof
()){

419 
³¼Ü
("Failed„eading file");

420 
as£¹
(
çl£
);

423 
	gbuf
[256];

424 
	gfb
.
»ad
(
buf
, 
¡d
::
mš
(256,
size
));

425 
as£¹
(!
fb
.
ç
());

426 
as£¹
(!
¡ºcmp
(
¡r
.
c_¡r
(), 
buf
, 
¡d
::
mš
(256,
size
)));

427  
	gfb
;

430 
	g¡d
::
f¡»am
 &
İ”©Ü
>>(
m©
 & 
A
){

431 
rows
, 
	gcŞs
;

432 
	gfb
.
»ad
Ğ(*)&
rows
, ());

433 
as£¹
(!
fb
.
ç
());

434 
	gfb
.
»ad
Ğ(*)&
cŞs
, ());

435 
as£¹
(!
fb
.
ç
());

436 
	gA
 = 
m©
(
rows
, 
cŞs
);

437 
	gv®
;

438 
	gi
=0; i< 
	gA
.
rows
(); i++)

439 
	gj
=0; j< 
	gA
. 
cŞs
(); j++){

440 
	gfb
.
»ad
((*)&
v®
, ());

441 
as£¹
(!
fb
.
ç
());

442 
A
(
i
,
j
èğ
v®
;

444  
	gfb
;

446 
	g¡d
::
f¡»am
 &
İ”©Ü
>>(
vec
 & 
v
){

447 
size
;

448 
	gfb
.
»ad
((*)&
size
, ());

449 
as£¹
(!
fb
.
ç
());

450 
as£¹
(
size
 >0);

451 
	gv
 = 
vec
(
size
);

452 
	gv®
;

453 
	gi
=0; i< 
	gv
.
size
(); i++){

454 
	gfb
.
»ad
((*)& 
v®
, ());

455 
as£¹
(!
fb
.
ç
());

456 
v
(
i
èğ
v®
;

458  
	gfb
;

461 
	g¡d
::
f¡»am
 &
İ”©Ü
>>(&
v
){

462 
fb
.
»ad
((*)&
v
, ());

463 
as£¹
(!
fb
.
ç
());

464  
	gfb
;

467 
	$şo£
(){

468 
fb
.
	`şo£
();

469 
	}
}

472 
	#Name
(
a
è
¡d
::
	`¡ršg
×)

	)

473 
šlše
 
	$£t_size
(
¥¬£_vec
 &
v
, 
size
){

475 
	}
}

476 
šlše
 
	$£t_Ãw
(
¥¬£_vec
&
v
, 
šd
, 
v®
){

477 
v
.
	`š£¹
(
šd
èğ
v®
;

478 
	}
}

479 
šlše
 
	$Âz
(
¥¬£_vec
& 
v
){

480  
v
.
	`nÚZ”os
();

481 
	}
}

482 
šlše
 
g‘_nz_šdex
(
¥¬£_vec
 &
v
, s·r£_vec::
IÂ”I‹¿tÜ
& 
i
){

483  
i
.
šdex
();

485 
šlše
 
g‘_nz_d©a
(
¥¬£_vec
 &
v
, s·r£_vec::
IÂ”I‹¿tÜ
& 
i
){

486  
i
.
v®ue
();

488 
	#FOR_ITERATOR
(
i
,
v
) \

489 
¥¬£_vec
::
IÂ”I‹¿tÜ
 
	`i
(
v
); 
i
; ++i)

	)

491 
	g‹m¶©e
<
ty³Çme
 
	gT
>

492 
šlše
 
sum_sqr
(cÚ¡ 
T
& 
a
);

494 
	g‹m¶©e
<>

495 
šlše
 
	gsum_sqr
<
	gvec
>(cÚ¡ veø& 
	ga
){

496 
vec
 
	g»t
 = 
a
.
¬¿y
().
pow
(2);

497  
	g»t
.
sum
();

499 
	g‹m¶©e
<>

500 
šlše
 
	gsum_sqr
<
	g¥¬£_vec
>(cÚ¡ s·r£_veø& 
	ga
){

501 
	gsum
=0;

502 
FOR_ITERATOR
(
i
,
a
){

503 
	gsum
+ğ
powf
(
i
.
v®ue
(),2);

505  
	gsum
;

508 
šlše
 
	$Œaû
(cÚ¡ 
m©
 & 
a
){

509  
a
.
	`Œaû
();

510 
	}
}

511 
šlše
 
	$g‘_nz_d©a
(
¥¬£_vec
 &
v
, 
i
){

512 
	`as£¹
(
	`Âz
(
v
è> 
i
);

513 
út
=0;

514 
	`FOR_ITERATOR
(
j
, 
v
){

515 ià(
út
 =ğ
i
){

516  
j
.
	`v®ue
();

518 
út
++;

521 
	}
}

522 
šlše
 
	$´št
(
¥¬£_vec
 & 
vec
){

523 
út
 = 0;

524 
	`FOR_ITERATOR
(
i
, 
vec
){

525 
¡d
::
cout
<<
	`g‘_nz_šdex
(
vec
, 
i
)<<":"<< 
	`g‘_nz_d©a
(vec, i) << " ";

526 
út
++;

527 ià(
út
 >= 20)

530 
¡d
::
cout
<<¡d::
’dl
;

531 
	}
}

532 
šlše
 
vec
 
	$pow
(cÚ¡ 
vec
&
v
, 
expÚ’t
){

533 
vec
 
»t
 = 
	`vec
(
v
.
	`size
());

534 
i
=0; i< 
v
.
	`size
(); i++)

535 
»t
[
i
] = 
	`powf
(
v
[i], 
expÚ’t
);

536  
»t
;

537 
	}
}

538 
šlše
 
	$dÙ_´od
(
¥¬£_vec
 &
v1
, s·r£_veø& 
v2
){

539  
v1
.
	`dÙ
(
v2
);

540 
	}
}

541 
šlše
 
	$dÙ_´od
(cÚ¡ 
vec
 &
v1
, cÚ¡ veø& 
v2
){

542  
v1
.
	`dÙ
(
v2
);

543 
	}
}

544 
šlše
 
	$dÙ3
(cÚ¡ 
vec
 &
v1
, cÚ¡ veø& 
v2
, cÚ¡ veø& 
v3
){

545 
»t
 = 0;

546 
i
=0; i < 
v1
.
	`size
(); i++)

547 
»t
+ğ
v1
[
i
]*
v2
[i]*
v3
[i];

548  
»t
;

549 
	}
}

550 
šlše
 
	$dÙ_´od
(
¥¬£_vec
 &
v1
, cÚ¡ 
vec
 & 
v2
){

551 
sum
 = 0;

552 
i
=0; i< 
v2
.
	`size
(); i++){

553 
sum
+ğ
v2
[
i
] * 
v1
.
	`cÛffRef
(i);

555  
sum
;

556 
	}
}

557 
šlše
 
vec
 
	$cumsum
(
vec
& 
v
){

558 
vec
 
»t
 = 
v
;

559 
i
=1; i< 
v
.
	`size
(); i++)

560 
j
=0; j< 
i
; j++)

561 
	`»t
(
i
è+ğ
	`v
(
j
);

562  
»t
;

563 
	}
}

564 
šlše
 
	$g‘_v®
(
¥¬£_vec
 & 
v1
, 
i
){

565 
¥¬£_vec
::
IÂ”I‹¿tÜ
 
	`™
(
v1
); 
™
; ++it)

566 ià(
™
.
	`šdex
(è=ğ
i
)

567  
™
.
	`v®ue
();

570 
	}
}

571 
šlše
 
	$g‘_v®
(
vec
 & 
v1
, 
i
){

572  
	`v1
(
i
);

573 
	}
}

574 
šlše
 
£t_div
(
¥¬£_vec
&
v
, s·r£_vec::
IÂ”I‹¿tÜ
 
i
, 
v®
){

575 
	gv
.
cÛffRef
(
i
.
šdex
()è/ğ
v®
;

577 
šlše
 
¥¬£_vec
 
	$mšus
(
¥¬£_vec
 &
v1
,¥¬£_veø&
v2
){

578  
v1
-
v2
;

579 
	}
}

580 
šlše
 
vec
 
	$mšus
Ğ
¥¬£_vec
 &
v1
, 
vec
 &
v2
){

581 
vec
 
»t
 = -
v2
;

582 
	`FOR_ITERATOR
(
i
, 
v1
){

583 
»t
[
i
.
	`šdex
()] +ği.
	`v®ue
();

585  
»t
;

586 
	}
}

587 
šlše
 
	$¶us
Ğ
vec
 &
v1
, 
¥¬£_vec
 &
v2
){

588 
	`FOR_ITERATOR
(
i
, 
v2
){

589 
v1
[
i
.
	`šdex
()] +ği.
	`v®ue
();

591 
	}
}

592 
šlše
 
	$mšus
Ğ
vec
 &
v1
, 
¥¬£_vec
 &
v2
){

593 
	`FOR_ITERATOR
(
i
, 
v2
){

594 
v1
[
i
.
	`šdex
()] -ği.
	`v®ue
();

596 
	}
}

597 
šlše
 
¥¬£_vec
 
	$çbs
Ğ
¥¬£_vec
 & 
dvec1
){

598 
¥¬£_vec
 
»t
 = 
dvec1
;

599 
	`FOR_ITERATOR
(
i
, 
»t
){

600 
»t
.
	`cÛffRef
(
i
.
	`šdex
()èğ
	`çbs
(i.
	`v®ue
());

602  
»t
;

603 
	}
};

605 
šlše
 
vec
 
	$çbs
ĞcÚ¡ 
vec
 & 
dvec1
){

606 
vec
 
	`»t
(
dvec1
.
	`size
());

607 
i
=0; i< 
dvec1
.
	`size
(); i++){

608 
	`»t
(
i
èğ
	`çbs
(
	`dvec1
(i));

610  
»t
;

611 
	}
};

612 
šlše
 
	$abs_sum
(cÚ¡ 
m©
& 
A
){

613 
sum
 =0;

614 
i
=0; i< 
A
.
	`rows
(); i++)

615 
j
=0; j< 
A
.
	`cŞs
(); j++)

616 
sum
 +ğ
	`çbs
(
	`A
(
i
,
j
));

617  
sum
;

618 
	}
}

619 
šlše
 
	$abs_sum
(cÚ¡ 
vec
 &
v
){

620 
sum
 =0;

621 
i
=0; i< 
v
.
	`size
(); i++)

622 
sum
 +ğ
	`çbs
(
	`v
(
i
));

623  
sum
;

624 
	}
}

625 
šlše
 
	$sum
(cÚ¡ 
¥¬£_vec
 &
v
){

626 
sum
 =0;

627 
	`FOR_ITERATOR
(
i
, 
v
){

628 
sum
 +ğ
i
.
	`v®ue
();

630  
sum
;

631 
	}
}

632 
šlše
 
vec
 
	$sq¹
(cÚ¡ 
vec
 & 
v
){

633 
vec
 
	`»t
(
v
.
	`size
());

634 
i
=0; i< 
v
.
	`size
(); i++){

635 
»t
[
i
] = 
¡d
::
	`sq¹
(
	`v
(i));

637  
»t
;

638 
	}
}

639 
šlše
 
	$svd
(cÚ¡ 
m©
 & 
A
, m© & 
U
, m© & 
V
, 
vec
 & 
sšguÏr_v®ues
){

640 
Eig’
::
JacobiSVD
<
m©
> 
	`svdEig’
(
A
, Eig’::
Compu‹FuÎU
 | Eig’::
Compu‹FuÎV
);

641 
U
ğ
svdEig’
.
	`m©rixU
();

642 
V
ğ
svdEig’
.
	`m©rixV
();

643 
sšguÏr_v®ues
 =
svdEig’
.
	`sšguÏrV®ues
();

644 
	}
}

646 
šlše
 
boŞ
 
·œ_com·»
 (
¡d
::
·œ
<,> &
x1
, std::·œ<,> & 
x2
è{  (
	gx1
.
	gfœ¡
>
	gx2
.first); }

648 
šlše
 
ivec
 
	$»v”£_sÜt_šdex2
(cÚ¡ 
vec
&
a
, cÚ¡ 
ivec
&
šdiûs
, veø& 
out
, 
K
){

649 
	`as£¹
(
a
.
	`size
(è=ğ
šdiûs
.size());

650 
	`as£¹
(
K
 > 0);

651 
size
 = 
¡d
::
	`mš
(()
a
.
	`size
(), ()
K
);

652 
ivec
 
	`»t
(
size
);

653 
¡d
::
veùÜ
<¡d::
·œ
<,> > 
D
;

655 
D
.
	`»£rve
(
a
.
	`size
());

656 
i
=0;i<
a
.
	`size
();i++)

657 
D
.
	`push_back
(
¡d
::
make_·œ
<,>(
a
[
i
],
šdiûs
[i]));

658 
¡d
::
	`·¹Ÿl_sÜt
(
D
.
	`begš
(),D.begš(è+ 
size
, D.
	`’d
(), 
·œ_com·»
);

659 
i
=0;i< 
size
;i++)

661 
»t
[
i
]=
D
[i].
£cÚd
;

662 
out
[
i
] = 
D
[i].
fœ¡
;

664  
»t
;

665 
	}
}

666 
šlše
 
ivec
 
	$»v”£_sÜt_šdex
(cÚ¡ 
vec
& 
a
, 
K
){

667 
	`as£¹
(
K
 > 0);

668 
size
 = 
¡d
::
	`mš
(()
a
.
	`size
(), ()
K
);

669 
ivec
 
	`»t
(
size
);

670 
¡d
::
veùÜ
<¡d::
·œ
<,> > 
D
;

672 
D
.
	`»£rve
(
a
.
	`size
());

673 
i
=0;i<
a
.
	`size
();i++)

674 
D
.
	`push_back
(
¡d
::
make_·œ
<,>(
a
[
i
],i));

675 
¡d
::
	`·¹Ÿl_sÜt
(
D
.
	`begš
(),D.begš(è+ 
size
, D.
	`’d
(), 
·œ_com·»
);

676 
i
=0;i< 
size
;i++)

678 
»t
[
i
]=
D
[i].
£cÚd
;

680  
»t
;

681 
	}
}

682 
šlše
 
ivec
 
	$»v”£_sÜt_šdex
(
¥¬£_vec
& 
a
, 
K
){

683 
	`as£¹
(
K
 > 0);

684 
size
 = 
¡d
::
	`mš
(()
	`Âz
(
a
), ()
K
);

685 
ivec
 
	`»t
(
size
);

686 
¡d
::
veùÜ
<¡d::
·œ
<,> > 
D
;

688 
D
.
	`»£rve
(
	`Âz
(
a
));

689 
	`FOR_ITERATOR
(
i
, 
a
){

690 
D
.
	`push_back
(
¡d
::
make_·œ
<,>(
i
.
	`v®ue
(),i.
	`šdex
()));

692 
¡d
::
	`·¹Ÿl_sÜt
(
D
.
	`begš
(),D.begš(è+ 
size
, D.
	`’d
(), 
·œ_com·»
);

693 
i
=0;i< 
size
;i++)

695 
»t
[
i
]=
D
[i].
£cÚd
;

697  
»t
;

698 
	}
}

700 
	$equ®_g»©”
(
x
){

701 ià(
x
 != 0)

705 
	}
}

707 #undeà
NDEBUG


	@toolkits/collaborative_filtering/gensgd.cpp

37 
	~<veùÜ
>

38 
	~"commÚ.hµ
"

39 
	~"eig’_w¿µ”.hµ
"

40 
	~"../·r£rs/commÚ.hµ
"

41 
	~<omp.h
>

42 
	#MAX_FEATURES
 256

	)

43 
	#FEATURE_WIDTH
 38

44 

	)

45 
	gg’sgd_¿‹1
 = 1e-02;

46 
	gg’sgd_¿‹2
 = 1e-02;

47 
	gg’sgd_¿‹3
 = 1e-02;

48 
	gg’sgd_¿‹4
 = 1e-02;

49 
	gg’sgd_¿‹5
 = 1e-02;

50 
	gg’sgd_muÉ_dec
 = 0.9;

51 
	gg’sgd_»gw
 = 1e-3;

52 
	gg’sgd_»gv
 = 1e-3;

53 
	gg’sgd_»g0
 = 1e-1;

54 
boŞ
 
	gdebug
 = 
çl£
;

55 
	g¡d
::
¡ršg
 
u£r_fe
;

56 
	g¡d
::
¡ršg
 
™em_fe
;

57 
	g¡d
::
¡ršg
 
u£r_lšks
;

58 
	glim™_¿tšg
 = 0;

59 
size_t
 
	gv”‹x_w™h_no_edges
 = 0;

60 
	gÿlc_”rÜ
 = 0;

61 
	gfe_cŞumns
 = 0;

62 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
h—d”_t™Ës
;

63 
	ghas_h—d”_t™Ës
 = 0;

64 
	gcutoff
 = 0;

66 
	s¡©s
{

67 
	mmšv®
;

68 
	mmaxv®
;

69 
	mm—nv®
;

70 
¡©s
(){

71 
	mmšv®
 = 
maxv®
 = 
m—nv®
 = 0;

75 
	sã©u»_cÚŒŞ
{

76 
	m¡d
::
veùÜ
<
doubË_m­
> 
node_id_m­s
;

77 
doubË_m­
 
	mv®_m­
;

78 
	m»hash_v®ue
;

79 
	mÏ¡_™em
;

80 
	m¡d
::
veùÜ
<
¡©s
> 
¡©s_¬¿y
;

81 
	mã©u»_num
;

82 
	mnode_ã©u»s
;

83 
	mnode_lšks
;

84 
	mtÙ®_ã©u»s
;

85 
	m¡d
::
veùÜ
<
boŞ
> 
ã©u»_£ËùiÚ
;

86 cÚ¡ 
	m¡d
::
¡ršg
 
deçuÉ_ã©u»_¡r
;

87 
	m¡d
::
veùÜ
<> 
off£ts
;

88 
boŞ
 
	mhash_¡ršgs
;

89 
	mäom_pos
;

90 
	mto_pos
;

91 
	mv®_pos
;

93 
ã©u»_cÚŒŞ
(){

94 
	m»hash_v®ue
 = 0;

95 
	mÏ¡_™em
 = 0;

96 
	mtÙ®_ã©u»s
 = 0;

97 
	mnode_ã©u»s
 = 0;

98 
	mã©u»_num
 = 
FEATURE_WIDTH
;

99 
	mhash_¡ršgs
 = 
çl£
;

100 
	mäom_pos
 = 0;

101 
	mto_pos
 = 1;

102 
	mv®_pos
 = -1;

103 
	mnode_lšks
 = 0;

104 
	mã©u»_£ËùiÚ
.
»size
(
MAX_FEATURES
+3);

108 
ã©u»_cÚŒŞ
 
	gfc
;

110 
	$num_ã©u»_bšs
(){

111 
sum
 = 0;

112 ià(
fc
.
hash_¡ršgs
){

113 
	`as£¹
(2+
fc
.
tÙ®_ã©u»s
+fc.
node_ã©u»s
 =ğ()fc.
node_id_m­s
.
	`size
());

114 
i
=2; i < 2+
fc
.
tÙ®_ã©u»s
+fc.
node_ã©u»s
; i++){

115 
sum
+ğ
fc
.
node_id_m­s
[
i
].
¡ršg2nodeid
.
	`size
();

119 
i
=0; i< 
fc
.
tÙ®_ã©u»s
; i++)

120 
sum
 +ğ()
	`û
((
fc
.
¡©s_¬¿y
[
i
].
maxv®
 - fc.¡©s_¬¿y[i].
mšv®
) + 1);

122 ià(
fc
.
tÙ®_ã©u»s
 > 0)

123 
	`as£¹
(
sum
 > 0);

124  
sum
;

125 
	}
}

127 
	$ÿlc_ã©u»_num
(){

128  2+
fc
.
tÙ®_ã©u»s
+fc.
Ï¡_™em
+fc.
node_ã©u»s
;

129 
	}
}

130 
g‘_off£ts
(
¡d
::
veùÜ
<> & 
off£ts
){

131 
as£¹
(
off£ts
.
size
() >= 2);

132 
	goff£ts
[0] = 0;

133 
	goff£ts
[1] = 
M
;

134 ià(
	goff£ts
.
size
() >= 3)

135 
off£ts
[2] = 
M
+
N
;

136 ià(
	gfc
.
	ghash_¡ršgs
){

137 
ušt
 
	gj
=2; j< 
	goff£ts
.
size
()-1; j++){

138 
	goff£ts
[
j
+1] = 
off£ts
[j] + 
fc
.
node_id_m­s
[j].
¡ršg2nodeid
.
size
();

139 
log¡»am
(
LOG_DEBUG
)<<"Off£ˆ" << 
	gj
+1 << " is: " << 
	goff£ts
[
j
+1] << 
	g¡d
::
’dl
;

142 
ušt
 
	gj
=2; j < 
	goff£ts
.
size
(); j++){

143 
	goff£ts
[
j
+1] = 
off£ts
[j] + ()
û
((
fc
.
¡©s_¬¿y
[j-2].
maxv®
-fc.¡©s_¬¿y[j-2].
mšv®
)+1);

144 
log¡»am
(
LOG_DEBUG
)<<"Off£ˆ" << 
	gj
+1 << " is: " << 
	goff£ts
[
j
+1] << 
	g¡d
::
’dl
;

151 
boŞ
 
	$is_u£r
(
vid_t
 
id
){  id < 
M
; 
	}
}

152 
boŞ
 
	$is_™em
(
vid_t
 
id
){  id >ğ
M
 && id < 
N
; 
	}
}

153 
boŞ
 
	$is_time
(
vid_t
 
id
){  id >ğ
M
+
N
; 
	}
}

155 
vec
 
	g”rÜs_vec
;

156 
	#BIAS_POS
 -1

	)

157 
	sv”‹x_d©a
 {

158 
vec
 
	mpvec
;

159 
	mbŸs
;

160 
	mÏ¡_™em
;

161 
¥¬£_vec
 
	mã©u»s
;

162 
¥¬£_vec
 
	mlšks
;

164 
v”‹x_d©a
() {

165 
	mbŸs
 = 0;

166 
	mÏ¡_™em
 = 0;

168 
£t_v®
(
šdex
, 
v®
){

169 ià(
	mšdex
 =ğ
BIAS_POS
)

170 
bŸs
 = 
v®
;

171 
	mpvec
[
šdex
] = 
v®
;

173 
g‘_v®
(
šdex
){

174 ià(
	mšdex
=ğ
BIAS_POS
)

175  
bŸs
;

176  
	mpvec
[
šdex
];

182 
	sedge_d©a
 {

183 
	mã©u»s
[
FEATURE_WIDTH
];

184 
	mweight
;

185 
edge_d©a
(è{ 
	mweight
 = 0; 
mem£t
(
ã©u»s
, 0, ()*
FEATURE_WIDTH
); }

187 
edge_d©a
(
weight
, * 
v®¬¿y
): weight(weightè{ 
memıy
(
ã©u»s
, v®¬¿y, ()*
FEATURE_WIDTH
); }

196 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

197 
edge_d©a
 
	tEdgeD©aTy³
;

199 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

200 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

203 
	$ÿlc_ã©u»_node_¬¿y_size
(
ušt
 
node
, ušˆ
™em
){

204 
	`as£¹
(
node
 <ğ
M
);

205 
	`as£¹
(
™em
 <ğ
N
);

206 
	`as£¹
(
node
 < 
Ï‹Á_çùÜs_šmem
.
	`size
());

207 
	`as£¹
(
fc
.
off£ts
[1]+
™em
 < 
Ï‹Á_çùÜs_šmem
.
	`size
());

208  2+
fc
.
tÙ®_ã©u»s
+fc.
Ï¡_™em
+
	`Âz
(
Ï‹Á_çùÜs_šmem
[
node
].
ã©u»s
)+ÂzÖ©’t_çùÜs_šmem[fc.
off£ts
[1]+
™em
].features);

209 
	}
}

216 
	$g‘_node_id
(* 
pch
, 
pos
, 
size_t
 
i
, 
boŞ
 
»ad_Úly
 = 
çl£
){

217 
	`as£¹
(
pch
 !ğ
NULL
);

218 
	`as£¹
(
i
 >= 0);

220 
»t
;

222 ià(!
fc
.
hash_¡ršgs
){

223 
»t
 = (
pos
 < 2 ? 
	`©oi
(
pch
è: 
	`©of
(pch));

224 ià(
pos
 < 2)

225 
»t
-=
šput_fe_off£t
;

226 ià(
pos
 =ğ0 && 
»t
 >ğ
M
)

227 
	`log¡»am
(
LOG_FATAL
)<<"Row index†¬g”hªhm©rix„ow siz" << 
»t
 << " > " << 
M
 << " iÀlše: " << 
i
 << 
¡d
::
’dl
;

228 ià(
pos
 =ğ1 && 
»t
 >ğ
N
)

229 
	`log¡»am
(
LOG_FATAL
)<<"CŞ index†¬g”hªhm©rix„ow siz" << 
»t
 << " > " << 
N
 << " iÀlše: " << 
i
 << 
¡d
::
’dl
;

234 
ušt
 
id
;

235 
	`as£¹
(
pos
 < ()
fc
.
node_id_m­s
.
	`size
());

236 ià(
»ad_Úly
){

237 
¡d
::
m­
<¡d::
¡ršg
,
ušt
>::
™”©Ü
 
™
 = 
fc
.
node_id_m­s
[
pos
].
¡ršg2nodeid
.
	`fšd
(
pch
);

238 ià(
™
 !ğ
fc
.
node_id_m­s
[
pos
].
¡ršg2nodeid
.
	`’d
()){

239 
»t
 = 
™
->
£cÚd
;

240 
	`as£¹
(
»t
 < 
fc
.
node_id_m­s
[
pos
].
¡ršg2nodeid
.
	`size
());

242 
»t
 = -1;

245 
	`assign_id
(
fc
.
node_id_m­s
[
pos
], 
id
, 
pch
);

246 
»t
 = 
id
;

250 ià(!
»ad_Úly
)

251 
	`as£¹
(
»t
 != -1);

252  
»t
;

253 
	}
}

255 
	$g‘_v®ue
(* 
pch
, 
boŞ
 
»ad_Úly
){

256 
»t
;

257 ià(!
fc
.
»hash_v®ue
){

258 
»t
 = 
	`©of
(
pch
);

261 
ušt
 
id
;

262 ià(
»ad_Úly
){

263 
¡d
::
m­
<¡d::
¡ršg
,
ušt
>::
™”©Ü
 
™
 = 
fc
.
v®_m­
.
¡ršg2nodeid
.
	`fšd
(
pch
);

264 ià(
™
 !ğ
fc
.
v®_m­
.
¡ršg2nodeid
.
	`’d
()){

265 
»t
 = 
™
->
£cÚd
;

267 
»t
 = -1;

270 
	`assign_id
(
fc
.
v®_m­
, 
id
, 
pch
);

271 
»t
 = 
id
;

275 ià(
¡d
::
	`i¢ª
(
»t
è|| std::
	`isšf
(ret))

276 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad v®ue" << 
¡d
::
’dl
;

277  
»t
;

278 
	}
}

281 
boŞ
 
»ad_lše
(
FILE
 * 
f
, cÚ¡ 
¡d
::
¡ršg
 
f’ame
, 
size_t
 
i
, 
ušt
 & 
I
, ušˆ& 
J
, &
v®
, std::
veùÜ
<>& 
v®¬¿y
, 
ty³
){

283 * 
	glšebuf
 = 
NULL
;

284 
size_t
 
	glšesize
 = 0;

285 
	glšebuf_debug
[1024];

287 
	gtok’
 = 0;

288 
	gšdex
 = 0;

289 
	grc
 = 
g‘lše
(&
lšebuf
, &
lšesize
, 
f
);

290 ià(
	grc
 == -1)

291 
log¡»am
(
LOG_FATAL
)<<"FaedØg‘†še: " << 
i
 << " iÀfe: " << 
f’ame
 << 
¡d
::
’dl
;

293 * 
	glšebuf_to_ä“
 = 
lšebuf
;

294 
¡ºıy
(
lšebuf_debug
, 
lšebuf
, 1024);

296 
as£¹
(
fe_cŞumns
 >= 2);

297 
	gtok’
 < 
	gfe_cŞumns
){

299 ià(
	gtok’
 =ğ
fc
.
äom_pos
){

300 *
pch
 = 
¡r£p
(&
lšebuf
,"\t,\r\n ");

301 ià(
	gpch
 =ğ
NULL
)

302 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
i
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

303 
	gI
 = (
ušt
)
g‘_node_id
(
pch
, 0, 
i
);

304 
	gtok’
++;

306 ià(
	gtok’
 =ğ
fc
.
to_pos
){

308 * 
pch
 = 
¡r£p
(&
lšebuf
, "\t,\r\n ");

309 ià(
	gpch
 =ğ
NULL
)

310 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
i
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

311 
	gJ
 = (
ušt
)
g‘_node_id
(
pch
, 1, 
i
);

312 
	gtok’
++;

314 ià(
	gtok’
 =ğ
fc
.
v®_pos
){

316 * 
pch
 = 
¡r£p
(&
lšebuf
, "\t,\r\n ");

317 ià(
	gpch
 =ğ
NULL
)

318 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
i
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

320 
	gv®
 = 
g‘_v®ue
(
pch
, 
ty³
 !ğ
TRAINING
);

321 
	gtok’
++;

325 * 
	gpch
 = 
¡r£p
(&
lšebuf
, "\t,\r\n ");

326 ià(
	gpch
 =ğ
NULL
)

327 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
i
 << " f—tu» " << 
tok’
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

328 ià(!
	gfc
.
	gã©u»_£ËùiÚ
[
tok’
]){

329 
	gtok’
++;

333 
as£¹
(
šdex
 < ()
v®¬¿y
.
size
());

334 
	gv®¬¿y
[
šdex
] = 
g‘_node_id
(
pch
, index+2, 
i
);

335 ià(
	g¡d
::
i¢ª
(
v®¬¿y
[
šdex
]))

336 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
i
 << " f—tu» " << 
tok’
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

339 ià(
	gty³
 =ğ
TRAINING
 && !
fc
.
hash_¡ršgs
){

340 
fc
.
¡©s_¬¿y
[
šdex
].
mšv®
 = 
¡d
::
mš
(fc.¡©s_¬¿y[šdex].mšv®, 
v®¬¿y
[index]);

341 
	gfc
.
	g¡©s_¬¿y
[
šdex
].
	gmaxv®
 = 
¡d
::
max
(
fc
.
¡©s_¬¿y
[šdex].
maxv®
, 
v®¬¿y
[index]);

342 
	gfc
.
	g¡©s_¬¿y
[
šdex
].
	gm—nv®
 +ğ
v®¬¿y
[index];

346 
	gšdex
++;

347 
	gtok’
++;

350 
ä“
(
lšebuf_to_ä“
);

351  
	gŒue
;

355 
compu‹_´ediùiÚ
(

356 cÚ¡ 
ušt
 
I
,

357 cÚ¡ 
ušt
 
J
,

358 cÚ¡ 
v®
,

359 & 
´ediùiÚ
,

360 * 
v®¬¿y
,

361 (*
´ediùiÚ_func
)(cÚ¡ 
v”‹x_d©a
 ** 
¬¿y
, 
¬¿ysize
, 
¿tšg
, & 
´ediùiÚ
, 
vec
 * 
psum
),

362 
vec
 * 
psum
,

363 
v”‹x_d©a
 **& 
node_¬¿y
){

365 
	`as£¹
(
J
 >=0 && J <ğ
N
);

366 
	`as£¹
(
I
>=0 && I <ğ
M
);

371 
šdex
 = 0;

372 
loc
 = 0;

373 
node_¬¿y
[
šdex
] = &
Ï‹Á_çùÜs_šmem
[
I
+
fc
.
off£ts
[index]];

374 
	`as£¹
(
node_¬¿y
[
šdex
]->
pvec
[0] < 1e5);

375 
šdex
++; 
loc
++;

377 
	`as£¹
(
J
+
fc
.
off£ts
[
šdex
] < 
Ï‹Á_çùÜs_šmem
.
	`size
());

378 
node_¬¿y
[
šdex
] = &
Ï‹Á_çùÜs_šmem
[
J
+
fc
.
off£ts
[index]];

379 
	`as£¹
(
node_¬¿y
[
šdex
]->
pvec
[0] < 1e5);

380 
šdex
++; 
loc
++;

382 
j
=0; j< 
fc
.
tÙ®_ã©u»s
; j++){

383 
ušt
 
pos
 = (ušt)
	`û
(
v®¬¿y
[
j
]+
fc
.
off£ts
[j+
šdex
]-fc.
¡©s_¬¿y
[j].
mšv®
);

384 
	`as£¹
(
pos
 >ğ0 &&…o < 
Ï‹Á_çùÜs_šmem
.
	`size
());

385 
node_¬¿y
[
j
+
šdex
] = & 
Ï‹Á_çùÜs_šmem
[
pos
];

386 
	`as£¹
(
node_¬¿y
[
j
+
šdex
]->
pvec
[0] < 1e5);

388 
šdex
+ğ
fc
.
tÙ®_ã©u»s
;

389 
loc
 +ğ
fc
.
tÙ®_ã©u»s
;

391 
i
 = 0;

392 
	`FOR_ITERATOR
(
j
, 
Ï‹Á_çùÜs_šmem
[
I
+
fc
.
off£ts
[0]].
ã©u»s
){

393 
pos
;

394 ià(
u£r_lšks
 != ""){

395 
pos
 = 
j
.
	`šdex
();

396 
	`as£¹
(
pos
 < 
M
);

399 
pos
 = 
j
.
	`šdex
()+
fc
.
off£ts
[
šdex
];

400 
	`as£¹
(
pos
 < ()
fc
.
node_id_m­s
[0].
¡ršg2nodeid
.
	`size
());

401 
	`as£¹
(
pos
 >ğ0 &&…o < 
Ï‹Á_çùÜs_šmem
.
	`size
());

402 
	`as£¹
(
pos
 >ğ(
ušt
)
fc
.
off£ts
[
šdex
]);

405 
node_¬¿y
[
i
+
šdex
] = & 
Ï‹Á_çùÜs_šmem
[
pos
];

406 
	`as£¹
(
node_¬¿y
[
i
+
šdex
]->
pvec
[0] < 1e5);

407 
i
++;

409 
	`as£¹
(
i
 =ğ
	`Âz
(
Ï‹Á_çùÜs_šmem
[
I
+
fc
.
off£ts
[0]].
ã©u»s
));

410 
šdex
+ğ
	`Âz
(
Ï‹Á_çùÜs_šmem
[
I
+
fc
.
off£ts
[0]].
ã©u»s
);

411 
loc
+=1;

413 
i
=0;

414 
	`FOR_ITERATOR
(
j
, 
Ï‹Á_çùÜs_šmem
[
J
+
fc
.
off£ts
[1]].
ã©u»s
){

415 
ušt
 
pos
 = 
j
.
	`šdex
()+
fc
.
off£ts
[
loc
];

416 
	`as£¹
(
j
.
	`šdex
(è< ()
fc
.
node_id_m­s
[
loc
].
¡ršg2nodeid
.
	`size
());

417 
	`as£¹
(
pos
 >ğ0 &&…o < 
Ï‹Á_çùÜs_šmem
.
	`size
());

418 
	`as£¹
(
pos
 >ğ(
ušt
)
fc
.
off£ts
[
loc
]);

420 
node_¬¿y
[
i
+
šdex
] = & 
Ï‹Á_çùÜs_šmem
[
pos
];

421 
	`as£¹
(
node_¬¿y
[
i
+
šdex
]->
pvec
[0] < 1e5);

422 
i
++;

424 
	`as£¹
(
i
 =ğ
	`Âz
(
Ï‹Á_çùÜs_šmem
[
J
+
fc
.
off£ts
[1]].
ã©u»s
));

425 
šdex
+ğ
	`Âz
(
Ï‹Á_çùÜs_šmem
[
J
+
fc
.
off£ts
[1]].
ã©u»s
);

426 
loc
+=1;

427 ià(
fc
.
Ï¡_™em
){

428 
ušt
 
pos
 = 
Ï‹Á_çùÜs_šmem
[
I
].
Ï¡_™em
 + 
fc
.
off£ts
[2+fc.
tÙ®_ã©u»s
+fc.
node_ã©u»s
];

429 
	`as£¹
(
pos
 < 
Ï‹Á_çùÜs_šmem
.
	`size
());

430 
node_¬¿y
[
šdex
] = &
Ï‹Á_çùÜs_šmem
[
pos
];

431 
	`as£¹
(
node_¬¿y
[
šdex
]->
pvec
[0] < 1e5);

432 
šdex
++;

433 
loc
+=1;

435 
	`as£¹
(
šdex
 =ğ
	`ÿlc_ã©u»_node_¬¿y_size
(
I
,
J
));

436 (*
´ediùiÚ_func
)((cÚ¡ 
v”‹x_d©a
**)
node_¬¿y
, 
	`ÿlc_ã©u»_node_¬¿y_size
(
I
,
J
), 
v®
, 
´ediùiÚ
, 
psum
);

437  
	`pow
(
v®
 - 
´ediùiÚ
,2);

438 
	}
}

440 
	~"io.hµ
"

441 
	~"../·r£rs/commÚ.hµ
"

453 
	g‹m¶©e
 <
ty³Çme
 
	g®s_edge_ty³
>

454 
cÚv”t_m©rixm¬k‘_N
(
¡d
::
¡ršg
 
ba£_f’ame
, 
boŞ
 
squ¬e
, 
ã©u»_cÚŒŞ
 & 
fc
, 
lim™_¿tšg
 = 0) {

456 
FILE
 *
f
;

457 
size_t
 
	gnz
;

461 
	gnsh¬ds
;

493 
	gsh¬d”
<
	g®s_edge_ty³
> 
sh¬d”obj
(
ba£_f’ame
);

494 
	gsh¬d”obj
.
¡¬t_´•roûssšg
();

496 
d‘eù_m©rix_size
(
ba£_f’ame
, 
f
, 
M
, 
N
, 
nz
);

497 ià(
	gf
 =ğ
NULL
)

498 
log¡»am
(
LOG_FATAL
è<< "Could‚Ù o³Àfe: " << 
ba£_f’ame
 << ",ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

500 ià(
	ghas_h—d”_t™Ës
){

501 * 
	glšebuf
 = 
NULL
;

502 
size_t
 
	glšesize
;

503 
	glšebuf_debug
[1024];

506 
	grc
 = 
g‘lše
(&
lšebuf
, &
lšesize
, 
f
);

507 ià(
	grc
 == -1)

508 
log¡»am
(
LOG_FATAL
)<<"E¼Ü h—d”†š" << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

510 
¡ºıy
(
lšebuf_debug
, 
lšebuf
, 1024);

514 *
	gpch
 = 
¡¹ok
(
lšebuf
,"\t,\r; ");

515 ià(
	gpch
 =ğ
NULL
)

516 
log¡»am
(
LOG_FATAL
)<<"E¼Ü h—d”†š" << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

518 
	gh—d”_t™Ës
.
push_back
(
pch
);

521 
	gpch
 !ğ
NULL
){

522 
pch
 = 
¡¹ok
(
NULL
, "\t,\r; ");

523 ià(
	gpch
 =ğ
NULL
)

525 
	gh—d”_t™Ës
.
push_back
(
pch
);

530 ià(
	gM
 =ğ0 && 
N
 == 0)

531 
log¡»am
(
LOG_FATAL
)<<"FaedØd‘eù m©rix size. PËa£…»·»‡ fÇmed: " << 
ba£_f’ame
 << ":šfØw™h m©rix m¬k‘ h—d”,‡ ex¶ašed h”e: h‰p://bicksÚ.blog¥Ù.co./2012/12/cŞÏbÜ©ive-f‹ršg-3rd-g’”©iÚ_14.htmÈ" << 
¡d
::
’dl
;

533 
log¡»am
(
LOG_INFO
è<< "S¹šgØ»ad m©rix-m¬k‘ iÅut. M©rix dim’siÚs: " << 
	gM
 << " x " << 
	gN
 << ",‚Ú-z”os: " << 
	gnz
 << 
	g¡d
::
’dl
;

535 
ušt
 
	gI
, 
	gJ
;

536 
	g¡d
::
veùÜ
<> 
v®¬¿y
; 
	gv®¬¿y
.
»size
(
¡d
::
max
(1, 
fc
.
tÙ®_ã©u»s
));

537 
	gv®
;

539 ià(!
	gfc
.
	ghash_¡ršgs
){

540 
	gi
=0; i< 
	gfc
.
	gtÙ®_ã©u»s
; i++){

541 
	gfc
.
	g¡©s_¬¿y
[
i
].
	gmšv®
 = 1e100;

542 
	gfc
.
	g¡©s_¬¿y
[
i
].
	gmaxv®
 = -1e100;

545 ià(
	glim™_¿tšg
 > 0)

546 
	gnz
 = 
lim™_¿tšg
;

547 
size_t
 
	gi
=0; i<
	gnz
; i++)

550 ià(!
»ad_lše
(
f
, 
ba£_f’ame
, 
i
,
I
, 
J
, 
v®
, 
v®¬¿y
, 
TRAINING
))

551 
log¡»am
(
LOG_FATAL
)<<"FaedØ»ad†še: " <<
	gi
<< " iÀfe: " << 
	gba£_f’ame
 << 
	g¡d
::
’dl
;

554 ià(
	gsqu¬e
 && 
	gI
 =ğ
J
)

557 ià(
	gI
>ğ
M
 || 
J
 >ğ
N
){

558 ià(
i
 == 0)

559 
log¡»am
(
LOG_FATAL
)<<"FaedØ·r£d fœ¡†še,h”¬toØmªyok’s. Did you fÜg‘h--has_h—d”_t™Ës=1 fÏg wh’ fha ¡ršg cŞumÀh—d”s?" << 
¡d
::
’dl
;

561 
log¡»am
(
LOG_FATAL
)<<"Bug: cª‚Ù‡ddƒdgäom " << 
	gI
 << "Ø J " << 
	gJ
 << " sšû max is: " << 
	gM
 <<"x" <<
	gN
<<
	g¡d
::
’dl
;

564 
	gL
++;

565 
	gglob®M—n
 +ğ
v®
;

566 
	gsh¬d”obj
.
´•roûssšg_add_edge
(
I
, 
squ¬e
?
J
:
M
+J, 
®s_edge_ty³
(
v®
, &
v®¬¿y
[0]));

569 
	gsh¬d”obj
.
’d_´•roûssšg
();

572 
as£¹
(
L
 > 0);

573 
	gi
=0; i< 
	gfc
.
	gtÙ®_ã©u»s
; i++){

574 
	gfc
.
	g¡©s_¬¿y
[
i
].
	gm—nv®
 /ğ
L
;

576 
as£¹
(
glob®M—n
 != 0);

577 
	gglob®M—n
 /ğ
L
;

578 
log¡»am
(
LOG_INFO
)<<"Cİu‹d glob® m—Àis: " << 
	gglob®M—n
 << 
	g¡d
::
’dl
;

581 
	gi
=0; i< 
	gfc
.
	gtÙ®_ã©u»s
; i++){

582 
log¡»am
(
LOG_INFO
è<< "F—tu» " << 
	gi
 << " mš v®: " << 
	gfc
.
	g¡©s_¬¿y
[
i
].
	gmšv®
 << " max v®: " << fc.¡©s_¬¿y[i].
	gmaxv®
 << " m—Àv®: " << fc.¡©s_¬¿y[i].
	gm—nv®
 << 
	g¡d
::
’dl
;

586 
FILE
 * 
	goutf
 = 
fİ’
((
ba£_f’ame
 + ".gm").
c_¡r
(), "w");

587 
årštf
(
outf
, "%d\n%d\n%ld\n%d\n%12.8lg", 
M
, 
N
, 
L
, 
fc
.
tÙ®_ã©u»s
, 
glob®M—n
);

588 
	gi
=0; i < 
	gfc
.
	gtÙ®_ã©u»s
; i++){

589 
årštf
(
outf
, "%12.8g\n%12.8g\n%12.8g\n", 
fc
.
¡©s_¬¿y
[
i
].
mšv®
, fc.¡©s_¬¿y[i].
maxv®
, fc.¡©s_¬¿y[i].
m—nv®
);

591 
fşo£
(
outf
);

593 
fşo£
(
f
);

595 ià(
	gfc
.
	ghash_¡ršgs
){

596 
	gi
=0; i< 
	gfc
.
	gtÙ®_ã©u»s
+2; i++){

597 ià(
	gfc
.
	gnode_id_m­s
[
i
].
	g¡ršg2nodeid
.
size
() == 0)

598 
log¡»am
(
LOG_FATAL
)<<"FaedØ§vã©u»‚umb” : " << 
i
 << "‚Øv®ue fšd iÀd©¨" << 
¡d
::
’dl
;

602 
log¡»am
(
LOG_INFO
è<< "Now c»©šg sh¬ds." << 
	g¡d
::
’dl
;

604 
	gnsh¬ds
 = 
sh¬d”obj
.
execu‹_sh¬dšg
(
g‘_İtiÚ_¡ršg
("nshards", "auto"));

606  
	gnsh¬ds
;

610 
»ad_node_ã©u»s
(
¡d
::
¡ršg
 
ba£_f’ame
, 
boŞ
 
squ¬e
, 
ã©u»_cÚŒŞ
 & 
fc
, boŞ 
u£r
, boŞ 
bš¬y
) {

611 
FILE
 *
	gf
;

613 ià((
	gf
 = 
fİ’
(
ba£_f’ame
.
c_¡r
(), "r")è=ğ
NULL
) {

614 
log¡»am
(
LOG_FATAL
è<< "Could‚Ù o³Àfe: " << 
ba£_f’ame
 << ",ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

616 
	gbš¬y
 = 
Œue
;

617 
doubË_m­
 
	gfm­
;

618 
	gfc
.
	gnode_id_m­s
.
push_back
(
fm­
);

619 
	gfc
.
	gnode_ã©u»s
++;

620 
¡©s
 
	g¡©
;

621 
	gfc
.
	g¡©s_¬¿y
.
push_back
(
¡©
);

623 
ušt
 
	gI
, 
	gJ
 = -1;

624 * 
	glšebuf
 = 
NULL
;

625 
	glšebuf_debug
[1024];

626 
size_t
 
	glšesize
;

627 
size_t
 
	glšes
 = 0;

628 
size_t
 
	gtok’s
 = 0;

629 
	gv®
 = 1;

631 
	gŒue
){

633 
	grc
 = 
g‘lše
(&
lšebuf
, &
lšesize
, 
f
);

634 ià(
	grc
 == -1)

636 
¡ºıy
(
lšebuf_debug
, 
lšebuf
, 1024);

637 
	glšes
++;

640 *
	gpch
 = 
¡¹ok
(
lšebuf
,"\t,\r; ");

641 ià(
	gpch
 =ğ
NULL
)

642 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
lšes
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

643 
	gI
 = (
ušt
)
g‘_node_id
(
pch
, 
u£r
?0:1, 
lšes
, 
Œue
);

644 ià(
	gI
 =ğ(
ušt
)-1)

647 ià(
	gu£r
)

648 
as£¹
(
I
 >ğ0 && I < 
M
);

649 
as£¹
(
I
>=0 && I< 
N
);

653 
	gpch
 !ğ
NULL
){

654 
pch
 = 
¡¹ok
(
NULL
, "\t,\r; ");

655 ià(
	gpch
 =ğ
NULL
)

657 ià(
	gbš¬y
){

658 ià(
©oi
(
pch
) <= 2)

660 
	gJ
 = (
ušt
)
g‘_node_id
(
pch
, 2+
fc
.
tÙ®_ã©u»s
+fc.
node_ã©u»s
-1, 
lšes
);

663 
	gpch
 = 
¡¹ok
(
NULL
, "\t\r,;: ");

664 ià(
	gpch
 =ğ
NULL
)

665 
log¡»am
(
LOG_FATAL
)<<"FaedØ»ad f‘u» v®ue" << 
¡d
::
’dl
;

666 
	gv®
 = 
©of
(
pch
);

668 
£t_Ãw
(
Ï‹Á_çùÜs_šmem
[
u£r
? 
I
 : I+
M
].
ã©u»s
, 
J
, 
v®
);

669 
	gtok’s
++;

674 
as£¹
(
tok’s
 > 0);

675 
log¡»am
(
LOG_DEBUG
)<<"R—d‡Ù® oà" << 
	glšes
 << "‚odã©u»s. Tok’s: " << 
	gtok’s
 << "‡vgokens: " << (lines/tokens)

676 << " u£r? " << 
	gu£r
 << "‚ewƒÁr›s: " << 
	gfc
.
	gnode_id_m­s
[2+
fc
.
tÙ®_ã©u»s
+fc.
node_ã©u»s
-1].
	g¡ršg2nodeid
.
size
(è<< 
	g¡d
::
’dl
;

681 
»ad_node_lšks
(
¡d
::
¡ršg
 
ba£_f’ame
, 
boŞ
 
squ¬e
, 
ã©u»_cÚŒŞ
 & 
fc
, boŞ 
u£r
, boŞ 
bš¬y
) {

682 
FILE
 *
	gf
;

684 ià((
	gf
 = 
fİ’
(
ba£_f’ame
.
c_¡r
(), "r")è=ğ
NULL
) {

685 
log¡»am
(
LOG_FATAL
è<< "Could‚Ù o³Àfe: " << 
ba£_f’ame
 << ",ƒ¼Ü: " << 
¡»¼Ü
(
”ºo
è<< 
¡d
::
’dl
;

689 
	gfc
.
	gnode_lšks
++;

693 
ušt
 
	gI
, 
	gJ
 = -1;

694 * 
	glšebuf
 = 
NULL
;

695 
	glšebuf_debug
[1024];

696 
size_t
 
	glšesize
;

697 
size_t
 
	glšes
 = 0;

698 
size_t
 
	gtok’s
 = 0;

699 
	gv®
 = 1;

701 
	gŒue
){

703 
	grc
 = 
g‘lše
(&
lšebuf
, &
lšesize
, 
f
);

704 ià(
	grc
 == -1)

706 
¡ºıy
(
lšebuf_debug
, 
lšebuf
, 1024);

707 
	glšes
++;

710 *
	gpch
 = 
¡¹ok
(
lšebuf
,"\t,\r; ");

711 ià(
	gpch
 =ğ
NULL
)

712 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
lšes
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

713 
	gI
 = (
ušt
)
g‘_node_id
(
pch
, 
u£r
? 0 : 1, 
lšes
, 
Œue
);

714 ià(
	gI
 =ğ(
ušt
)-1)

717 ià(
	gu£r
)

718 
as£¹
(
I
 < (
ušt
)
fc
.
off£ts
[1]);

719 
as£¹
(
I
 < (
ušt
)
fc
.
off£ts
[2]);

722 
	gpch
 = 
¡¹ok
(
NULL
, "\t,\r; ");

723 ià(
	gpch
 =ğ
NULL
)

724 
log¡»am
(
LOG_FATAL
)<<"FaedØ»adØf›ld [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

726 
	gJ
 = (
ušt
)
g‘_node_id
(
pch
, 
u£r
? 0 : 1, 
lšes
);

727 
£t_Ãw
(
Ï‹Á_çùÜs_šmem
[
u£r
? 
I
 : I+
M
].
lšks
, 
J
, 
v®
);

728 
	gtok’s
++;

732 
log¡»am
(
LOG_DEBUG
)<<"R—d‡Ù® oà" << 
	glšes
 << "‚odã©u»s. Tok’s: " << 
	gtok’s
 << " u£r? " << 
	gu£r
 << "‚ewƒÁr›s: " << 
	gfc
.
	gnode_id_m­s
[
u£r
? 0 : 1].
¡ršg2nodeid
.
size
(è<< 
¡d
::
’dl
;

736 
	~"rm£.hµ
"

744 
v®id©iÚ_rm£_N
(

745 (*
´ediùiÚ_func
)(cÚ¡ 
v”‹x_d©a
 ** 
¬¿y
, 
¬¿ysize
, 
¿tšg
, & 
´ediùiÚ
, 
vec
 * 
psum
)

746 ,
g¿phchi_cÚ‹xt
 & 
gcÚ‹xt
,

747 
ã©u»_cÚŒŞ
 & 
fc
,

748 
boŞ
 
squ¬e
 = 
çl£
) {

750 
	`as£¹
(
fc
.
tÙ®_ã©u»s
 <ğfc.
ã©u»_num
);

751 ià(
v®id©iÚ
 == "")

754 ià(!
	`fe_exi¡s
(
v®id©iÚ
)) {

755 
	`log¡»am
(
LOG_WARNING
è<< "V®id©iÚ fwa ¥ecif›d, buˆnÙ found:" << 
v®id©iÚ
 << 
¡d
::
’dl
;

759 
FILE
 *
f
 = 
NULL
;

760 
size_t
 
nz
;

762 
	`d‘eù_m©rix_size
(
v®id©iÚ
, 
f
, 
Me
, 
Ne
, 
nz
);

763 ià(
f
 =ğ
NULL
){

764 
	`log¡»am
(
LOG_WARNING
)<<"FaedØİ’ v®id©iÚ d©a. Skpšg."<<
¡d
::
’dl
;

768 ià((
M
 > 0 && 
N
 > 0è&& (
Me
 !ğM || 
Ne
 != N))

769 
	`log¡»am
(
LOG_WARNING
)<<"IÅuˆsizoàv®id©iÚ m©rix mu¡ bid’tiÿÈtØŒaššg m©rix,‚am–y " << 
M
 << "x" << 
N
 << 
¡d
::
’dl
;

771 
Le
 = 
nz
;

773 
Ï¡_v®id©iÚ_rm£
 = 
dv®id©iÚ_rm£
;

774 
dv®id©iÚ_rm£
 = 0;

775 
v®id©iÚ_”rÜ
 = 0;

777 
¡d
::
veùÜ
<> 
v®¬¿y
; v®¬¿y.
	`»size
(
fc
.
tÙ®_ã©u»s
);

778 
ušt
 
I
, 
J
;

779 
v®
;

781 
size_t
 
i
=0; i<
nz
; i++)

783 ià(!
	`»ad_lše
(
f
, 
‹¡
, 
i
, 
I
, 
J
, 
v®
, 
v®¬¿y
, 
VALIDATION
))

784 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad†še: " << 
i
 << " iÀfe: " << 
v®id©iÚ
 << 
¡d
::
’dl
;

786 
´ediùiÚ
;

787 
v”‹x_d©a
 ** 
node_¬¿y
 = 
Ãw
 v”‹x_d©a*[
	`ÿlc_ã©u»_node_¬¿y_size
(
I
,
J
)];

788 
k
=0; k< 
	`ÿlc_ã©u»_node_¬¿y_size
(
I
,
J
); k++)

789 
node_¬¿y
[
k
] = 
NULL
;

790 
vec
 
sum
;

791 
	`compu‹_´ediùiÚ
(
I
, 
J
, 
v®
, 
´ediùiÚ
, &
v®¬¿y
[0], 
´ediùiÚ_func
, &
sum
, 
node_¬¿y
);

792 
d–‘e
 [] 
node_¬¿y
;

793 
dv®id©iÚ_rm£
 +ğ
	`pow
(
´ediùiÚ
 - 
v®
, 2);

794 ià(
ÿlc_”rÜ
)

795 ià((
´ediùiÚ
 < 
cutoff
 && 
v®
 > cutoff) || (prediction > cutoff && val < cutoff))

796 
v®id©iÚ_”rÜ
++;

799 
	`fşo£
(
f
);

801 
	`as£¹
(
Le
 > 0);

802 
dv®id©iÚ_rm£
 = 
	`sq¹
(dv®id©iÚ_rm£ / ()
Le
);

803 
¡d
::
cout
<<" V®id©iÚ RMSE: " << std::
	`£tw
(10è<< 
dv®id©iÚ_rm£
;

804 ià(!
ÿlc_”rÜ
)

805 
¡d
::
cout
 << std::
’dl
;

806 
¡d
::
cout
 << " V®id©iÚƒ¼Ü: " << std::
	`£tw
(10è<< 
v®id©iÚ_”rÜ
/
Le
 << std::
’dl
;

807 ià(
h®t_Ú_rm£_šü—£
 && 
dv®id©iÚ_rm£
 > 
Ï¡_v®id©iÚ_rm£
 && 
gcÚ‹xt
.
™”©iÚ
 > 0){

808 
	`log¡»am
(
LOG_WARNING
)<<"Stİpšgƒngšbeÿu£ oàv®id©iÚ RMSE inü—£" << 
¡d
::
’dl
;

809 
gcÚ‹xt
.
	`£t_Ï¡_™”©iÚ
(gcÚ‹xt.
™”©iÚ
);

811 
	}
}

816 
‹¡_´ediùiÚs_N
(

817 (*
´ediùiÚ_func
)(cÚ¡ 
v”‹x_d©a
 ** 
node_¬¿y
, 
node_¬¿y_size
, 
¿tšg
, & 
´ediùiÚi
, 
vec
 * 
sum
),

818 
ã©u»_cÚŒŞ
 & 
fc
,

819 
boŞ
 
squ¬e
 = 
çl£
) {

820 
FILE
 * 
f
 = 
NULL
;

821 
ušt
 
Me
, 
Ne
;

822 
size_t
 
nz
;

824 ià(
‹¡
 == ""){

825 
	`log¡»am
(
LOG_INFO
)<<"NØ‹¡ fwa found, skpšge¡…»diùiÚ " << 
¡d
::
’dl
;

829 ià(!
	`fe_exi¡s
(
‹¡
)) {

830 
	`log¡»am
(
LOG_ERROR
è<< "e¡…»diùiÚ fwa ¥ecif›d buˆnÙ found: " << 
‹¡
 << 
¡d
::
’dl
;

834 
	`d‘eù_m©rix_size
(
‹¡
, 
f
, 
Me
, 
Ne
, 
nz
);

835 ià(
f
 =ğ
NULL
){

836 
	`log¡»am
(
LOG_WARNING
)<<"FaedØİ’e¡ fe. Skpšg " << 
¡d
::
’dl
;

839 ià((
M
 > 0 && 
N
 > 0 ) && (
Me
 !ğM || 
Ne
 != N))

840 
	`log¡»am
(
LOG_FATAL
)<<"IÅuˆsizoà‹¡ m©rix mu¡ bid’tiÿÈtØŒaššg m©rix,‚am–y " << 
M
 << "x" << 
N
 << 
¡d
::
’dl
;

842 
FILE
 * 
fout
 = 
	`İ’_fe
((
‹¡
 + ".´ediù").
	`c_¡r
(),"w");

844 
MM_ty³code
 
m©code
;

845 
	`mm_£t_¬¿y
(&
m©code
);

846 
	`mm_wr™e_bªÃr
(
fout
, 
m©code
);

847 
	`mm_wr™e_mtx_¬¿y_size
(
fout
 ,
nz
, 1);

849 
¡d
::
veùÜ
<> 
v®¬¿y
; v®¬¿y.
	`»size
(
fc
.
tÙ®_ã©u»s
);

850 
v®
;

851 
´ediùiÚ
;

852 
ušt
 
I
,
J
;

854 
ušt
 
i
=0; i<
nz
; i++)

857 ià(!
	`»ad_lše
(
f
, 
‹¡
, 
i
, 
I
, 
J
, 
v®
, 
v®¬¿y
, 
TEST
))

858 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad†še: " <<
i
 << " iÀfe: " << 
‹¡
 << 
¡d
::
’dl
;

860 
v”‹x_d©a
 ** 
node_¬¿y
 = 
Ãw
 v”‹x_d©a*[
	`ÿlc_ã©u»_node_¬¿y_size
(
I
,
J
)];

861 
vec
 
sum
;

862 
	`compu‹_´ediùiÚ
(
I
, 
J
, 
v®
, 
´ediùiÚ
, &
v®¬¿y
[0], 
´ediùiÚ_func
, &
sum
, 
node_¬¿y
);

863 
	`årštf
(
fout
, "%d %d %12.8lg\n", 
I
+1, 
J
+1, 
´ediùiÚ
);

864 
d–‘e
[] 
node_¬¿y
;

866 
	`fşo£
(
f
);

867 
	`fşo£
(
fout
);

869 
	`log¡»am
(
LOG_INFO
)<<"Fšished wr™šg " << 
nz
 << "…»diùiÚ tØfe: " << 
‹¡
 << ".´ediù" << 
¡d
::
’dl
;

870 
	}
}

876 
	$g’sgd_´ediù
(cÚ¡ 
v”‹x_d©a
** 
node_¬¿y
, 
node_¬¿y_size
,

877 cÚ¡ 
¿tšg
, & 
´ediùiÚ
, 
vec
* 
sum
){

879 
vec
 
sum_sqr
 = 
	`z”os
(
D
);

880 *
sum
 = 
	`z”os
(
D
);

881 
´ediùiÚ
 = 
glob®M—n
;

882 
	`as£¹
(!
¡d
::
	`i¢ª
(
´ediùiÚ
));

883 
i
=0; i< 
node_¬¿y_size
; i++)

884 
´ediùiÚ
 +ğ
node_¬¿y
[
i
]->
bŸs
;

885 
	`as£¹
(!
¡d
::
	`i¢ª
(
´ediùiÚ
));

887 
j
=0; j< 
D
; j++){

888 
i
=0; i< 
node_¬¿y_size
; i++){

889 
sum
->
İ”©Ü
[](
j
è+ğ
node_¬¿y
[
i
]->
pvec
[j];

890 
	`as£¹
(
sum
->
İ”©Ü
[](
j
) < 1e5);

891 
sum_sqr
[
j
] +ğ
	`pow
(
node_¬¿y
[
i
]->
pvec
[j],2);

893 
´ediùiÚ
 +ğ0.5 * (
	`pow
(
sum
->
İ”©Ü
[](
j
),2è- 
sum_sqr
[j]);

894 
	`as£¹
(!
¡d
::
	`i¢ª
(
´ediùiÚ
));

897 
´ediùiÚ
 = 
¡d
::
	`mš
((í»diùiÚ, 
maxv®
);

898 
´ediùiÚ
 = 
¡d
::
	`max
((í»diùiÚ, 
mšv®
);

900 
”r
 = 
¿tšg
 - 
´ediùiÚ
;

901 
	`as£¹
(!
¡d
::
	`i¢ª
(
”r
));

902  
”r
*err;

904 
	}
}

905 
	$g’sgd_´ediù
(cÚ¡ 
v”‹x_d©a
** 
node_¬¿y
, 
node_¬¿y_size
,

906 cÚ¡ 
¿tšg
, & 
´ediùiÚ
){

907 
vec
 
sum
;

908  
	`g’sgd_´ediù
(
node_¬¿y
, 
node_¬¿y_size
, 
¿tšg
, 
´ediùiÚ
, &
sum
);

909 
	}
}

912 
	$š™_g’sgd
(
boŞ
 
lßd_çùÜs_äom_fe
){

914 
	`¤ªd
(
	`time
(
NULL
));

915 
nodes
 = 
M
+
N
+
	`num_ã©u»_bšs
()+
fc
.
Ï¡_™em
*M;

916 
Ï‹Á_çùÜs_šmem
.
	`»size
(
nodes
);

917 
howmªy
 = 
	`ÿlc_ã©u»_num
();

918 
	`log¡»am
(
LOG_DEBUG
)<<"GošgØÿlcuÏ‹: " << 
howmªy
 << " off£ts." << 
¡d
::
’dl
;

919 
fc
.
off£ts
.
	`»size
(
howmªy
);

920 
	`g‘_off£ts
(
fc
.
off£ts
);

921 
	`as£¹
(
D
 > 0);

922 ià(!
lßd_çùÜs_äom_fe
){

923 
çùÜ
 = 0.1/
	`sq¹
(
D
);

924 #´agm¨
omp
 
·¿Î–
 

925 
i
=0; i< 
nodes
; i++){

926 
Ï‹Á_çùÜs_šmem
[
i
].
pvec
 = (
debug
 ? 0.1*
	`Úes
(
D
è: (::
	`¿ndu
(D)*
çùÜ
));

929 
	}
}

932 
	$Œaššg_rm£_N
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
, 
boŞ
 
™ems
 = 
çl£
){

933 
Ï¡_Œaššg_rm£
 = 
dŒaššg_rm£
;

934 
dŒaššg_rm£
 = 0;

935 
size_t
 
tÙ®_”rÜs
 = 0;

936 
¡¬t
 = 0;

937 
’d
 = 
M
;

938 ià(
™ems
){

939 
¡¬t
 = 
M
;

940 
’d
 = 
M
+
N
;

942 
dŒaššg_rm£
 = 
	`sum
(
rm£_vec
);

943 ià(
ÿlc_”rÜ
)

944 
tÙ®_”rÜs
 = 
	`sum
(
”rÜs_vec
);

945 
dŒaššg_rm£
 = 
	`sq¹
(dŒaššg_rm£ / 
³ngše
->
	`num_edges
());

946 ià(
ÿlc_”rÜ
)

947 
¡d
::
cout
<< std::
	`£tw
(10è<< 
mytim”
.
	`cu¼’t_time
(è<< "èI‹¿tiÚ: " << std::£tw(3è<<
™”©iÚ
<<" T¿ššg RMSE: " << std::£tw(10)<< 
dŒaššg_rm£
 << " T¿šƒ¼: " << std::£tw(10è<< (
tÙ®_”rÜs
/()
L
);

949 
¡d
::
cout
<< std::
	`£tw
(10è<< 
mytim”
.
	`cu¼’t_time
(è<< "èI‹¿tiÚ: " << std::£tw(3è<<
™”©iÚ
<<" T¿ššg RMSE: " << std::£tw(10)<< 
dŒaššg_rm£
;

950 
	}
}

956 
	gG’sgdV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

961 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

962 ià(
	gfc
.
	gÏ¡_™em
 && 
	ggcÚ‹xt
.
	g™”©iÚ
 == 0){

963 ià(
is_u£r
(
v”‹x
.
id
()è&& v”‹x.
num_ou‹dges
() > 0) {

964 
v”‹x_d©a
& 
u£r
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

965 
	gmax_time
 = 0;

966 
	ge
=0;ƒ < 
	gv”‹x
.
num_ou‹dges
();ƒ++) {

967 cÚ¡ 
	gedge_d©a
 & 
	gedge
 = 
v”‹x
.
ou‹dge
(
e
)->
g‘_d©a
();

968 ià(
	gedge
.
	gã©u»s
[0] >ğ
max_time
){

969 
max_time
 = ()
û
(
edge
.
ã©u»s
[0]);

970 
	gu£r
.
	gÏ¡_™em
 = 
v”‹x
.
ou‹dge
(
e
)->
v”‹x_id
(è- 
M
;

974 ià(
is_u£r
(
v”‹x
.
id
()è&& 
	gv”‹x
.
num_ou‹dges
() == 0)

975 
v”‹x_w™h_no_edges
++;

980 ià(
is_u£r
(
v”‹x
.
id
())){

981 
	gv”‹x_d©a
& 
	gu£r
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

982 
as£¹
(
u£r
.
Ï¡_™em
 >ğ0 && u£r.Ï¡_™em < ()
N
);

986 
	ge
=0;ƒ < 
	gv”‹x
.
num_ou‹dges
();ƒ++) {

987 
	ghowmªy
 = 
ÿlc_ã©u»_node_¬¿y_size
(
v”‹x
.
id
(), v”‹x.
ou‹dge
(
e
)->
v”‹x_id
()-
M
);

988 
v”‹x_d©a
 ** 
	gnode_¬¿y
 = 
Ãw
 v”‹x_d©a*[
howmªy
];

989 
	gi
=0; i< 
	ghowmªy
; i++)

990 
	gnode_¬¿y
[
i
] = 
NULL
;

992 cÚ¡ 
	gedge_d©a
 & 
	gd©a
 = 
v”‹x
.
ou‹dge
(
e
)->
g‘_d©a
();

993 
	grui
 = 
d©a
.
weight
;

994 
	gpui
;

995 
vec
 
	gsum
;

998 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
compu‹_´ediùiÚ
(
v”‹x
.
id
(), v”‹x.
ou‹dge
(
e
)->
v”‹x_id
()-
M
, 
rui
 ,
pui
, (*)
d©a
.
ã©u»s
, 
g’sgd_´ediù
, &
sum
, 
node_¬¿y
);

999 ià(
	gÿlc_”rÜ
)

1000 ià((
	gpui
 < 
	gcutoff
 && 
	grui
 > cutoff) || (pui > cutoff &&„ui < cutoff))

1001 
	g”rÜs_vec
[
omp_g‘_th»ad_num
()]++;

1002 
	geui
 = 
pui
 - 
rui
;

1005 
	gglob®M—n
 -ğ
g’sgd_¿‹1
 * (
eui
 + 
g’sgd_»g0
 * 
glob®M—n
);

1008 
	gi
=0; i < 
ÿlc_ã©u»_node_¬¿y_size
(
v”‹x
.
id
(), v”‹x.
ou‹dge
(
e
)->
v”‹x_id
()-
M
); i++){

1010 
	gg’sgd_¿‹
;

1011 ià(
	gi
 == 0)

1012 
g’sgd_¿‹
 = 
g’sgd_¿‹1
;

1013 ià(
	gi
 == 1)

1014 
g’sgd_¿‹
 = 
g’sgd_¿‹2
;

1015 ià(
	gi
 < 2+
	gfc
.
	gtÙ®_ã©u»s
)

1016 
	gg’sgd_¿‹
 = 
g’sgd_¿‹3
;

1017 ià(
	gi
 < 2+
	gfc
.
	gtÙ®_ã©u»s
+fc.
	gnode_ã©u»s
)

1018 
	gg’sgd_¿‹
 = 
g’sgd_¿‹4
;

1020 
	gg’sgd_¿‹
 = 
g’sgd_¿‹5
;

1022 
	gnode_¬¿y
[
i
]->
	gbŸs
 -ğ
g’sgd_¿‹
 * (
eui
 + 
g’sgd_»gw
* 
node_¬¿y
[i]->
bŸs
);

1023 
as£¹
(!
¡d
::
i¢ª
(
node_¬¿y
[
i
]->
bŸs
));

1024 
as£¹
(
node_¬¿y
[
i
]->
bŸs
 < 1e3);

1026 
vec
 
	gg¿d
 = 
sum
 - 
node_¬¿y
[
i
]->
pvec
;

1027 
	gnode_¬¿y
[
i
]->
	gpvec
 -ğ
g’sgd_¿‹
 * (
eui
*
g¿d
 + 
g’sgd_»gv
 * 
node_¬¿y
[i]->
pvec
);

1028 
as£¹
(!
¡d
::
i¢ª
(
node_¬¿y
[
i
]->
pvec
[0]));

1029 
as£¹
(
node_¬¿y
[
i
]->
pvec
[0] < 1e3);

1031 
	gd–‘e
[] 
	gnode_¬¿y
;

1043 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

1044 ià(
	g™”©iÚ
 =ğ1 && 
v”‹x_w™h_no_edges
 > 0)

1045 
log¡»am
(
LOG_WARNING
)<<"Th”¬" << 
v”‹x_w™h_no_edges
 << " u£r w™houˆ¿tšgs" << 
¡d
::
’dl
;

1046 
	gg’sgd_¿‹1
 *ğ
g’sgd_muÉ_dec
;

1047 
	gg’sgd_¿‹2
 *ğ
g’sgd_muÉ_dec
;

1048 
	gg’sgd_¿‹3
 *ğ
g’sgd_muÉ_dec
;

1049 
	gg’sgd_¿‹4
 *ğ
g’sgd_muÉ_dec
;

1050 
	gg’sgd_¿‹5
 *ğ
g’sgd_muÉ_dec
;

1051 
Œaššg_rm£_N
(
™”©iÚ
, 
gcÚ‹xt
);

1052 
v®id©iÚ_rm£_N
(&
g’sgd_´ediù
, 
gcÚ‹xt
, 
fc
);

1058 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

1059 
	grm£_vec
 = 
z”os
(
gcÚ‹xt
.
exeùh»ads
);

1060 ià(
	gÿlc_”rÜ
)

1061 
	g”rÜs_vec
 = 
z”os
(
gcÚ‹xt
.
exeùh»ads
);

1069 
ouut_g’sgd_»suÉ
(
¡d
::
¡ršg
 
f’ame
) {

1070 
MMOuu‰”_m©
<
v”‹x_d©a
> 
mmouut
(
f’ame
 + "_U.mm", 0, 
M
+
N
+
num_ã©u»_bšs
(), "Thi fcÚš G’sgd ouuˆm©riûs. IÀ—ch„ow D faùÜ oà¨sšgË u£¸node,h’ i‹m‚odes,h’ f—tu»s", 
Ï‹Á_çùÜs_šmem
);

1071 
	gMMOuu‰”_vec
<
	gv”‹x_d©a
> 
mmouut_bŸs
(
f’ame
 + "_U_bŸs.mm", 0, 
num_ã©u»_bšs
(), 
BIAS_POS
, "Thi fcÚš G’sgd ouuˆbŸ veùÜ. IÀ—ch„ow‡ sšgË u£¸bŸs.", 
Ï‹Á_çùÜs_šmem
);

1072 
MMOuu‰”_sÿÏr
 
gm—n
(
f’ame
 + "_glob®_m—n.mm", "Thi fcÚš G’sgd glob® m—Àwhich i »quœed fÜ computšg…»diùiÚs.", 
glob®M—n
);

1074 
log¡»am
(
LOG_INFO
è<< " GENSGD ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << "_U.mm" << ", "<< f’am<< "_glob®_m—n.mm, " << f’am<< "_U_bŸs.mm " <<
	g¡d
::
’dl
;

1077 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

1079 
	`´št_cİyright
();

1083 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

1087 
m‘rics
 
	`m
("als-tensor-inmemory-factors");

1090 
g’sgd_¿‹1
 = 
	`g‘_İtiÚ_æßt
("gensgd_rate1", gensgd_rate1);

1091 
g’sgd_¿‹2
 = 
	`g‘_İtiÚ_æßt
("gensgd_rate2", gensgd_rate2);

1092 
g’sgd_¿‹3
 = 
	`g‘_İtiÚ_æßt
("gensgd_rate3", gensgd_rate3);

1093 
g’sgd_¿‹4
 = 
	`g‘_İtiÚ_æßt
("gensgd_rate4", gensgd_rate4);

1094 
g’sgd_¿‹5
 = 
	`g‘_İtiÚ_æßt
("gensgd_rate5", gensgd_rate5);

1095 
g’sgd_»gw
 = 
	`g‘_İtiÚ_æßt
("gensgd_regw", gensgd_regw);

1096 
g’sgd_»gv
 = 
	`g‘_İtiÚ_æßt
("gensgd_regv", gensgd_regv);

1097 
g’sgd_»g0
 = 
	`g‘_İtiÚ_æßt
("gensgd_reg0", gensgd_reg0);

1098 
g’sgd_muÉ_dec
 = 
	`g‘_İtiÚ_æßt
("gensgd_mult_dec", gensgd_mult_dec);

1099 
fc
.
Ï¡_™em
 = 
	`g‘_İtiÚ_št
("last_item", fc.last_item);

1100 
fc
.
hash_¡ršgs
 = 
	`g‘_İtiÚ_št
("rehash", fc.hash_strings);

1101 
u£r_fe
 = 
	`g‘_İtiÚ_¡ršg
("user_file", user_file);

1102 
u£r_lšks
 = 
	`g‘_İtiÚ_¡ršg
("user_links", user_links);

1103 
™em_fe
 = 
	`g‘_İtiÚ_¡ršg
("item_file", item_file);

1104 
fe_cŞumns
 = 
	`g‘_İtiÚ_št
("file_columns");

1105 ià(
fe_cŞumns
 < 3)

1106 
	`log¡»am
(
LOG_FATAL
)<<"You mu¡ hav©†—¡ 3 cŞumn š iÅuˆfe: [äom] [to] [v®ue] oÀ—ch†še"<<
¡d
::
’dl
;

1107 
D
 = 
	`g‘_İtiÚ_št
("D", D);

1108 
fc
.
äom_pos
 = 
	`g‘_İtiÚ_št
("from_pos", fc.from_pos);

1109 
fc
.
to_pos
 = 
	`g‘_İtiÚ_št
("to_pos", fc.to_pos);

1110 
fc
.
v®_pos
 = 
	`g‘_İtiÚ_št
("val_pos", fc.val_pos);

1111 
lim™_¿tšg
 = 
	`g‘_İtiÚ_št
("limit_rating",†imit_rating);

1112 
ÿlc_”rÜ
 = 
	`g‘_İtiÚ_št
("calc_error", calc_error);

1113 
has_h—d”_t™Ës
 = 
	`g‘_İtiÚ_št
("has_header_titles", has_header_titles);

1114 
fc
.
»hash_v®ue
 = 
	`g‘_İtiÚ_št
("rehash_value", fc.rehash_value);

1115 
cutoff
 = 
	`g‘_İtiÚ_æßt
("cutoff", cutoff);

1117 
	`·r£_commªd_lše_¬gs
();

1118 
	`·r£_im¶ic™_commªd_lše
();

1120 
¡d
::
¡ršg
 
¡ršg_ã©u»s
 = 
	`g‘_İtiÚ_¡ršg
("ã©u»s", 
fc
.
deçuÉ_ã©u»_¡r
);

1121 ià(
¡ršg_ã©u»s
 != ""){

1122 * 
pã©u»s
 = 
	`¡rdup
(
¡ršg_ã©u»s
.
	`c_¡r
());

1123 * 
pch
 = 
	`¡¹ok
(
pã©u»s
, ",\n\r\t ");

1124 
node
 = 
	`©oi
(
pch
);

1125 ià(
node
 < 0 ||‚od>ğ
MAX_FEATURES
+3)

1126 
	`log¡»am
(
LOG_FATAL
)<<"F—tu» id usšgh--ã©u»s=XX commªd should bnÚ‚eg©ive, s¹šg from z”o"<<
¡d
::
’dl
;

1127 
fc
.
ã©u»_£ËùiÚ
[
node
] = 
Œue
;

1128 
fc
.
tÙ®_ã©u»s
++;

1129 (
pch
 = 
	`¡¹ok
(
NULL
, ",\n\r\t "))!= NULL){

1130 
node
 = 
	`©oi
(
pch
);

1131 ià(
node
 < 0 ||‚od>ğ
MAX_FEATURES
+3)

1132 
	`log¡»am
(
LOG_FATAL
)<<"F—tu» id usšgh--ã©u»s=XX commªd should bnÚ‚eg©ive, s¹šg from z”o"<<
¡d
::
’dl
;

1133 
fc
.
ã©u»_£ËùiÚ
[
node
] = 
Œue
;

1134 
fc
.
tÙ®_ã©u»s
++;

1137 
fc
.
node_id_m­s
.
	`»size
(2+fc.
tÙ®_ã©u»s
);

1138 
fc
.
¡©s_¬¿y
.
	`»size
(fc.
tÙ®_ã©u»s
);

1140 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘_N
<
edge_d©a
>(
Œaššg
, 
çl£
, 
fc
, 
lim™_¿tšg
);

1142 
	`š™_g’sgd
(
lßd_çùÜs_äom_fe
);

1143 ià(
u£r_fe
 != "")

1144 
	`»ad_node_ã©u»s
(
u£r_fe
, 
çl£
, 
fc
, 
Œue
, false);

1145 ià(
™em_fe
 != "")

1146 
	`»ad_node_ã©u»s
(
™em_fe
, 
çl£
, 
fc
, false, false);

1147 ià(
u£r_lšks
 != "")

1148 
	`»ad_node_lšks
(
u£r_lšks
, 
çl£
, 
fc
, 
Œue
, false);

1150 ià(
has_h—d”_t™Ës
 && 
h—d”_t™Ës
.
	`size
() == 0)

1151 
	`log¡»am
(
LOG_FATAL
)<<"PËa£ d–‘‹m°fe (usšg : \"rm -à" << 
Œaššg
 << ".*\"èªd„uÀagaš" << 
¡d
::
’dl
;

1153 
	`log¡»am
(
LOG_INFO
è<<"TÙ® s–eùed f—tu»s: " << 
fc
.
tÙ®_ã©u»s
 << " : " << 
¡d
::
’dl
;

1154 
i
=0; i < 
MAX_FEATURES
+3; i++)

1155 ià(
fc
.
ã©u»_£ËùiÚ
[
i
])

1156 
	`log¡»am
(
LOG_INFO
)<<"S–eùed f—tu»: " << 
¡d
::
	`£tw
(3è<< 
i
 << " : " << (
has_h—d”_t™Ës
? 
h—d”_t™Ës
[i] : ""è<<¡d::
’dl
;

1157 
	`log¡»am
(
LOG_INFO
)<<"T¬g‘ v¬ŸbË " << 
¡d
::
	`£tw
(3è<< 
fc
.
v®_pos
 << " : " << (
has_h—d”_t™Ës
? 
h—d”_t™Ës
[fc.v®_pos] : ""è<<¡d::
’dl
;

1158 
	`log¡»am
(
LOG_INFO
)<<"From " << 
¡d
::
	`£tw
(3è<< 
fc
.
äom_pos
<< " : " << (
has_h—d”_t™Ës
? 
h—d”_t™Ës
[fc.äom_pos] : ""è<<¡d::
’dl
;

1159 
	`log¡»am
(
LOG_INFO
)<<"TØ " << 
¡d
::
	`£tw
(3è<< 
fc
.
to_pos
 << " : " << (
has_h—d”_t™Ës
? 
h—d”_t™Ës
[fc.to_pos] : ""è<<¡d::
’dl
;

1161 ià(
fc
.
node_ã©u»s
){

1162 
Ï¡_off£t
 = 
fc
.
node_id_m­s
.
	`size
();

1163 
tßdd
 = 0;

1164 
i
 = 
Ï¡_off£t
 - 
fc
.
node_ã©u»s
; i <†ast_offset; i++){

1165 
tßdd
 +ğ
fc
.
node_id_m­s
[
i
].
¡ršg2nodeid
.
	`size
();

1167 
	`log¡»am
(
LOG_DEBUG
)<<"GošgØadd " << 
tßdd
 << 
¡d
::
’dl
;

1168 
v”‹x_d©a
 
d©a
;

1169 
i
=0; i < 
tßdd
; i++){

1170 
d©a
.
pvec
 = 
	`z”os
(
D
);

1171 
j
=0; j < 
D
; j++)

1172 
d©a
.
pvec
[
j
] = 
	`d¿nd48
();

1173 
Ï‹Á_çùÜs_šmem
.
	`push_back
(
d©a
);

1175 
fc
.
off£ts
.
	`»size
(
	`ÿlc_ã©u»_num
());

1176 
	`g‘_off£ts
(
fc
.
off£ts
);

1178 ià(
lßd_çùÜs_äom_fe
){

1179 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_U.mm", 0, 
D
);

1180 
vec
 
u£r_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 +"_U_bŸs.mm", 
çl£
, 
Œue
);

1181 
	`as£¹
(
u£r_bŸs
.
	`size
(è=ğ
	`num_ã©u»_bšs
());

1182 
ušt
 
i
=0; 
	`num_ã©u»_bšs
(); i++){

1183 
Ï‹Á_çùÜs_šmem
[
i
].
bŸs
 = 
u£r_bŸs
[i];

1185 
vec
 
gm
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 + "_glob®_m—n.mm", 
çl£
, 
Œue
);

1186 
glob®M—n
 = 
gm
[0];

1191 
G’sgdV”tiûsInMemProg¿m
 
´og¿m
;

1192 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

1193 
	`£t_’gše_æags
(
’gše
);

1194 
³ngše
 = &
’gše
;

1195 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

1198 
	`ouut_g’sgd_»suÉ
(
Œaššg
);

1199 
	`‹¡_´ediùiÚs_N
(&
g’sgd_´ediù
, 
fc
);

1202 ià(!
qu›t
)

1203 
	`m‘rics_»pÜt
(
m
);

1205 
	}
}

	@toolkits/collaborative_filtering/getline.hpp

3 #iâdeà
__GETLINE_GRAPHCHI_MAXOS_FIX


4 
	#__GETLINE_GRAPHCHI_MAXOS_FIX


	)

7 
	~<¡dio.h
>

8 
	~<¡dlib.h
>

9 
	~<”ºo.h
>

10 
	~<uni¡d.h
>

12 "C" 
ssize_t
 
g‘lše
(**
lš•Œ
, 
size_t
 *
n
, 
FILE
 *
¡»am
);

15 
ssize_t


16 
	$g‘lše
(**
lš•
, 
size_t
 *
Å
, 
FILE
 *
¡»am
)

18 *
p
 = 
NULL
;

19 
size_t
 
i
 = 0;

21 ià(!
lš•
 || !
Å
) {

22 
”ºo
 = 
EINVAL
;

26 ià(!(*
lš•
è|| !(*
Å
)) {

27 *
Å
 = 120;

28 *
lš•
 = (*)
	`m®loc
(*
Å
);

29 ià(!(*
lš•
)) {

34 
	`æockfe
(
¡»am
);

36 
p
 = *
lš•
;

37 
ch
 = 0; (ch = 
	`g‘c_uÆocked
(
¡»am
)è!ğ
EOF
;) {

38 ià(
i
 > *
Å
) {

40 
size_t
 
m
 = *
Å
 * 2;

41 *
s
 = (*)
	`»®loc
(*
lš•
, 
m
);

43 ià(!
s
) {

44 
”rÜ
 = 
”ºo
;

45 
	`fuÆockfe
(
¡»am
);

46 
”ºo
 = 
”rÜ
;

50 *
lš•
 = 
s
;

51 *
Å
 = 
m
;

54 
p
[
i
] = 
ch
;

55 ià('\n' =ğ
ch
) ;

56 
i
 += 1;

58 
	`fuÆockfe
(
¡»am
);

61 ià(
i
 > *
Å
) {

63 
size_t
 
m
 = *
Å
 * 2;

64 *
s
 = (*)
	`»®loc
(*
lš•
, 
m
);

66 ià(!
s
) {

70 *
lš•
 = 
s
;

71 *
Å
 = 
m
;

74 
p
[
i
 + 1] = '\0';

75  ((
i
 > 0)? i : -1);

76 
	}
}

	@toolkits/collaborative_filtering/implicit.hpp

1 #iâdeà
_IMPLICIT_HPP__


2 
	#_IMPLICIT_HPP__


	)

26 
	~"eig’_w¿µ”.hµ
"

29 
	mIMPLICIT_RATING_DISABLED
 = 0,

30 
	mIMPLICIT_RATING_RANDOM
 = 1

33 
	gim¶ic™¿tšgweight
;

34 
	gim¶ic™¿tšgv®ue
 = -1;

35 
	gim¶ic™¿tšg³rûÁage
;

36 
	gim¶ic™¿tšgty³
;

38 
	g‹m¶©e
<
ty³Çme
 
	g®s_edge_ty³
>

39 
ušt
 
add_im¶ic™_edges4
(
ty³
, 
sh¬d”
<
®s_edge_ty³
>& 
shrd
){

41 
	gty³
){

42 
	gIMPLICIT_RATING_DISABLED
:  0;

43 
	gIMPLICIT_RATING_RANDOM
: ;

44 : 
as£¹
(
çl£
);

47 
ušt
 
	gadded
 = 0;

48 
ušt
 
	gtßdd
 = (ušt)(
im¶ic™¿tšg³rûÁage
*
N
*
M
);

49 
log¡»am
(
LOG_INFO
)<<"GošgØadd: " << 
	gtßdd
 << " im¶ic™ƒdges. " << 
	g¡d
::
’dl
;

50 
as£¹
(
tßdd
 >= 1);

51 
ušt
 
	gj
=0; j< 
	gtßdd
; j++){

52 
ivec
 
	g™em
 = ::
¿ndi
(1,0,
N
-1);

53 
ivec
 
	gu£r
 = ::
¿ndi
(1,0,
M
-1);

54 
	gshrd
.
´•roûssšg_add_edge
(
u£r
[0], 
™em
[0], 
®s_edge_ty³
(
im¶ic™¿tšgv®ue
, 
im¶ic™¿tšgweight
));

55 
	gadded
++;

57 
log¡»am
(
LOG_INFO
)<<"Fšished‡ddšg " << 
	gtßdd
 << " im¶ic™ƒdges. " << 
	g¡d
::
’dl
;

58  
	gadded
;

61 
	g‹m¶©e
<
ty³Çme
 
	g®s_edge_ty³
>

62 
ušt
 
add_im¶ic™_edges
(
ty³
, 
sh¬d”
<
®s_edge_ty³
>& 
shrd
 ){

64 
	gty³
){

65 
	gIMPLICIT_RATING_DISABLED
:  0;

66 
	gIMPLICIT_RATING_RANDOM
: ;

67 : 
as£¹
(
çl£
);

70 
ušt
 
	gadded
 = 0;

71 
ušt
 
	gtßdd
 = (ušt)(
im¶ic™¿tšg³rûÁage
*
N
*
M
);

72 
log¡»am
(
LOG_INFO
)<<"GošgØadd: " << 
	gtßdd
 << " im¶ic™ƒdges. " << 
	g¡d
::
’dl
;

73 
as£¹
(
tßdd
 >= 1);

74 
ušt
 
	gj
=0; j< 
	gtßdd
; j++){

75 
ivec
 
	g™em
 = ::
¿ndi
(1,0,
N
-1);

76 
ivec
 
	gu£r
 = ::
¿ndi
(1,0,
M
-1);

77 
	gshrd
.
´•roûssšg_add_edge
(
u£r
[0], 
™em
[0], 
®s_edge_ty³
(
im¶ic™¿tšgv®ue
));

78 
	gadded
++;

80 
log¡»am
(
LOG_INFO
)<<"Fšished‡ddšg " << 
	gtßdd
 << " im¶ic™ƒdges. " << 
	g¡d
::
’dl
;

81  
	gadded
;

84 
	$·r£_im¶ic™_commªd_lše
(){

85 
im¶ic™¿tšgweight
 = 
	`g‘_İtiÚ_æßt
("implicitratingweight", implicitratingweight);

86 
im¶ic™¿tšgv®ue
 = 
	`g‘_İtiÚ_æßt
("implicitratingvalue", implicitratingvalue);

87 
im¶ic™¿tšgty³
 = 
	`g‘_İtiÚ_št
("implicitratingtype", implicitratingtype);

88 ià(
im¶ic™¿tšgty³
 !ğ
IMPLICIT_RATING_RANDOM
 && im¶ic™¿tšgty³ !ğ
IMPLICIT_RATING_DISABLED
)

89 
	`log¡»am
(
LOG_FATAL
)<<"Im¶ic™„©šgy³ should be™h” 0 (IMPLICIT_RATING_DISABLEDèÜ 1 (IMPLICIT_RATING_RANDOM)" << 
¡d
::
’dl
;

90 
im¶ic™¿tšg³rûÁage
 = 
	`g‘_İtiÚ_æßt
("implicitratingpercentage", implicitratingpercentage);

91 ià(
im¶ic™¿tšg³rûÁage
 < 1e-8 && implicitratingpercentage > 0.8)

92 
	`log¡»am
(
LOG_FATAL
)<<"Im¶ic™„©šg…”ûÁagshould b(1e-8, 0.8)" << 
¡d
::
’dl
;

93 ià(
im¶ic™¿tšgty³
 !ğ
IMPLICIT_RATING_DISABLED
 && 
im¶ic™¿tšgv®ue
 == 0)

94 
	`log¡»am
(
LOG_FATAL
)<<"You‡»‚Ù‡ÎowedØu£ --im¶ic™¿tšgv®ue=0. PËa£ s–eù‡‚Ú z”Øv®ue, fÜƒxam¶-1" << 
¡d
::
’dl
;

95 
	}
}

	@toolkits/collaborative_filtering/io.hpp

1 #iâdeà
DEF_IOHPP


2 
	#DEF_IOHPP


	)

26 
	~"ty³s.hµ
"

27 
	~"im¶ic™.hµ
"

32 
FILE
 * 
	$İ’_fe
(cÚ¡ * 
Çme
, cÚ¡ * 
mode
, 
boŞ
 
İtiÚ®
 = 
çl£
){

33 
FILE
 * 
f
 = 
	`fİ’
(
Çme
, 
mode
);

34 ià(
f
 =ğ
NULL
 && !
İtiÚ®
){

35 
	`³¼Ü
("fopen failed");

36 
	`log¡»am
(
LOG_FATAL
è<<" FaedØİ’ fe" << 
Çme
 << 
¡d
::
’dl
;

38  
f
;

39 
	}
}

42 
	$£t_m©code
(
MM_ty³code
 & 
m©code
){

43 
	`mm_š™Ÿlize_ty³code
(&
m©code
);

44 
	`mm_£t_m©rix
(&
m©code
);

45 
	`mm_£t_¬¿y
(&
m©code
);

46 
	`mm_£t_»®
(&
m©code
);

47 
	}
}

50 
»ad_m©rix_m¬k‘_bªÃr_ªd_size
(
FILE
 * 
f
, 
MM_ty³code
 & 
m©code
, 
ušt
 & 
Me
, ušˆ& 
Ne
, 
size_t
 & 
nz
, cÚ¡ 
¡d
::
¡ršg
 & 
f’ame
){

52 ià(
mm_»ad_bªÃr
(
f
, &
m©code
) != 0)

53 
log¡»am
(
LOG_FATAL
è<< "Could‚Ù…roûs M©rix M¬k‘ bªÃr. Fe: " << 
f’ame
 << 
¡d
::
’dl
;

57 ià(
mm_is_com¶ex
(
m©code
è|| !
mm_is_¥¬£
(matcode))

58 
log¡»am
(
LOG_FATAL
è<< "SÜry,hi ­¶iÿtiÚ dÛ nÙ suµÜˆcom¶ex v®ue ªd„equœe ¨¥¬£ m©rix." << 
	g¡d
::
’dl
;

61 ià(
mm_»ad_mtx_üd_size
(
f
, &
Me
, &
Ne
, &
nz
) != 0) {

62 
log¡»am
(
LOG_FATAL
è<< "Faed„—dšg m©rix size:ƒ¼Ü" << 
¡d
::
’dl
;

66 
d‘eù_m©rix_size
(
¡d
::
¡ršg
 
f’ame
, 
FILE
 *&
f
, 
ušt
 &
M
, ušˆ&
N
, 
size_t
 & 
nz
, ušˆ
nodes
 = 0, size_ˆ
edges
 = 0, 
ty³
 = 
TRAINING
){

68 
MM_ty³code
 
m©code
;

69 
boŞ
 
	gšfo_fe
 = 
çl£
;

71 ià(
	gnodes
 =ğ0 && 
edges
 == 0){

72 
FILE
 * 
ff
 = 
NULL
;

74 ià((
	gff
 = 
fİ’
((
f’ame
 + ":šfo").
c_¡r
(), "r")è!ğ
NULL
) {

75 
šfo_fe
 = 
Œue
;

76 
»ad_m©rix_m¬k‘_bªÃr_ªd_size
(
ff
, 
m©code
, 
M
, 
N
, 
nz
, 
v®id©iÚ
 + ":info");

77 
fşo£
(
ff
);

80 ià((
	gf
 = 
fİ’
(
f’ame
.
c_¡r
(), "r")è=ğ
NULL
) {

81 ià(
ty³
 =ğ
VALIDATION
){

82 
¡d
::
cout
<<¡d::
’dl
;

85 
log¡»am
(
LOG_FATAL
)<<"FaedØİ’ iÅuˆfe: " << 
	gf’ame
 << 
	g¡d
::
’dl
;

87 ià(!
	gšfo_fe
 && 
	gnodes
 =ğ0 && 
edges
 == 0){

88 
»ad_m©rix_m¬k‘_bªÃr_ªd_size
(
f
, 
m©code
, 
M
, 
N
, 
nz
, 
f’ame
);

90 ià(
	gnodes
 > 0 && 
	gedges
 > 0){

91 ià(
	gty³
 =ğ
TRAINING
){

92 
M
 = 
N
 = 
nodes
;

93 
	gnz
 = 
edges
;

96 
	gMe
 = 
Ne
 = 
nodes
;

97 
	gnz
 = 
edges
;

102 
»ad_glob®_m—n
(
¡d
::
¡ršg
 
ba£_f’ame
, 
ty³
){

103 
FILE
 * 
	gšf
 = 
fİ’
((
ba£_f’ame
 + ".gm").
c_¡r
(), "r");

104 
	grc
;

105 ià(
	gty³
 =ğ
TRAINING
)

106 
rc
 = 
fsÿnf
(
šf
,"%d\n%d\n%ld\n%lg\n%d\n",&
M
, &
N
, &
L
, &
glob®M—n
, &
K
);

107 
	grc
 = 
fsÿnf
(
šf
,"%d\n%d\n%ld\n%lg\n%d\n",&
Me
, &
Ne
, &
Le
, &
glob®M—n2
, &
K
);

108 ià(
	grc
 != 5)

109 
log¡»am
(
LOG_FATAL
)<<"FaedØ»ad glob® m—Àäom fe" << 
ba£_f’ame
 << ".gm" << 
¡d
::
’dl
;

110 
fşo£
(
šf
);

111 ià(
	gty³
 =ğ
TRAINING
)

112 
log¡»am
(
LOG_INFO
è<< "O³Ãd m©rix size: " <<
M
 << " x " << 
N
 << "ƒdges: " << 
L
 << " Glob® m—Àis: " << 
glob®M—n
 << "imbšs: " << 
K
 << " Now c»©šg sh¬ds." << 
¡d
::
’dl
;

114 
log¡»am
(
LOG_INFO
è<< "O³Ãd VLIDATION m©rix size: " <<
	gMe
 << " x " << 
	gNe
 << "ƒdges: " << 
	gLe
 << " Glob® m—Àis: " << 
	gglob®M—n2
 << "imbšs: " << 
	gK
 << " Now c»©šg sh¬ds." << 
	g¡d
::
’dl
;

117 
wr™e_glob®_m—n
(
¡d
::
¡ršg
 
ba£_f’ame
, 
ty³
){

118 
FILE
 * 
	goutf
 = 
fİ’
((
ba£_f’ame
 + ".gm").
c_¡r
(), "w");

119 ià(
	gty³
 =ğ
TRAINING
)

120 
årštf
(
outf
, "%d\n%d\n%ld\n%lg\n%d\n", 
M
, 
N
, 
L
, 
glob®M—n
, 
K
);

122 
årštf
(
outf
, "%d\n%d\n%ld\n%lg\n%d\n", 
Me
, 
Ne
, 
Le
, 
glob®M—n2
, 
K
);

123 
fşo£
(
outf
);

127 
	g‹m¶©e
<
ty³Çme
 
	gv”‹x_d©a
>

128 
	sMMOuu‰”_vec
{

129 
MMOuu‰”_vec
(
¡d
::
¡ršg
 
âame
, 
ušt
 
¡¬t
, ušˆ
’d
, 
šdex
, std::¡ršg 
comm’t
, std::
veùÜ
<
v”‹x_d©a
> & 
Ï‹Á_çùÜs_šmem
) {

130 
MM_ty³code
 
m©code
;

131 
£t_m©code
(
m©code
);

132 
FILE
 * 
	moutf
 = 
İ’_fe
(
âame
.
c_¡r
(), "w");

133 
mm_wr™e_bªÃr
(
outf
, 
m©code
);

134 ià(
	mcomm’t
 != "")

135 
årštf
(
outf
, "%%%s\n", 
comm’t
.
c_¡r
());

136 
mm_wr™e_mtx_¬¿y_size
(
outf
, 
’d
-
¡¬t
, 1);

137 
ušt
 
	mi
=
¡¬t
; i< 
	m’d
; i++)

138 
årštf
(
outf
, "%1.12e\n", 
Ï‹Á_çùÜs_šmem
[
i
].
g‘_v®
(
šdex
));

139 
fşo£
(
outf
);

145 
	g‹m¶©e
<
ty³Çme
 
	gv”‹x_d©a
>

146 
	sMMOuu‰”_m©
{

147 
MMOuu‰”_m©
(
¡d
::
¡ršg
 
âame
, 
ušt
 
¡¬t
, ušˆ
’d
, std::¡ršg 
comm’t
, std::
veùÜ
<
v”‹x_d©a
> & 
Ï‹Á_çùÜs_šmem
, 
size
 = 0) {

148 
as£¹
(
¡¬t
 < 
’d
);

149 
MM_ty³code
 
	mm©code
;

150 
£t_m©code
(
m©code
);

151 
FILE
 * 
	moutf
 = 
İ’_fe
(
âame
.
c_¡r
(), "w");

152 
mm_wr™e_bªÃr
(
outf
, 
m©code
);

153 ià(
	mcomm’t
 != "")

154 
årštf
(
outf
, "%%%s\n", 
comm’t
.
c_¡r
());

155 
mm_wr™e_mtx_¬¿y_size
(
outf
, 
’d
-
¡¬t
, 
size
 > 0 ? siz: 
Ï‹Á_çùÜs_šmem
[¡¬t].
pvec
.size());

156 
ušt
 
	mi
=
¡¬t
; i < 
	m’d
; i++)

157 
	mj
=0; j < ((
	msize
 > 0è? siz: 
Ï‹Á_çùÜs_šmem
[
i
].
pvec
.
size
()); j++) {

158 
årštf
(
outf
, "%1.12e\n", 
Ï‹Á_çùÜs_šmem
[
i
].
g‘_v®
(
j
));

160 
fşo£
(
outf
);

164 
	sMMOuu‰”_sÿÏr
 {

165 
MMOuu‰”_sÿÏr
(
¡d
::
¡ršg
 
âame
, std::¡ršg 
comm’t
, 
v®
) {

166 
MM_ty³code
 
	mm©code
;

167 
£t_m©code
(
m©code
);

168 
FILE
 * 
	moutf
 = 
İ’_fe
(
âame
.
c_¡r
(), "w");

169 
mm_wr™e_bªÃr
(
outf
, 
m©code
);

170 ià(
	mcomm’t
 != "")

171 
årštf
(
outf
, "%%%s\n", 
comm’t
.
c_¡r
());

172 
mm_wr™e_mtx_¬¿y_size
(
outf
, 1, 1);

173 
årštf
(
outf
, "%1.12e\n", 
v®
);

174 
fşo£
(
outf
);

190 
	g‹m¶©e
 <
ty³Çme
 
	g®s_edge_ty³
>

191 
cÚv”t_m©rixm¬k‘4
(
¡d
::
¡ršg
 
ba£_f’ame
, 
boŞ
 
add_time_edges
 = 
çl£
, boŞ 
squ¬e
 = f®£, 
ty³
 = 
TRAINING
, 
m©Ïb_time_off£t
 = 1) {

193 
FILE
 *
f
 = 
NULL
;

194 
size_t
 
	gnz
;

198 
	gnsh¬ds
;

199 ià((
	gnsh¬ds
 = 
fšd_sh¬ds
<
®s_edge_ty³
>(
ba£_f’ame
, 
g‘_İtiÚ_¡ršg
("nshards", "auto")))) {

201 ià(
	gcheck_Üigfe_modifiÿtiÚ_—¾›r
<
	g®s_edge_ty³
>(
	gba£_f’ame
, 
	gnsh¬ds
)) {

202 
log¡»am
(
LOG_INFO
è<< "F" << 
	gba£_f’ame
 << " wa ®»ady…»´oûs£d, wÚ'ˆdØ™‡gaš. " << 
	g¡d
::
’dl
;

203 
»ad_glob®_m—n
(
ba£_f’ame
, 
ty³
);

205  
	gnsh¬ds
;

208 
	gsh¬d”
<
	g®s_edge_ty³
> 
sh¬d”obj
(
ba£_f’ame
);

209 
	gsh¬d”obj
.
¡¬t_´•roûssšg
();

212 
d‘eù_m©rix_size
(
ba£_f’ame
, 
f
, 
ty³
 =ğ
TRAINING
? 
M
:
Me
,y³ =ğTRAINING? 
N
:
Ne
, 
nz
);

213 ià(
	gf
 =ğ
NULL
){

214 ià(
ty³
 =ğ
VALIDATION
){

215 
log¡»am
(
LOG_INFO
)<< "Did‚Ù fšd v®id©iÚ fe: " << 
ba£_f’ame
 << 
¡d
::
’dl
;

218 ià(
	gty³
 =ğ
TRAINING
)

219 
log¡»am
(
LOG_FATAL
)<<"FaedØİ’¿ššg iÅuˆfe: " << 
ba£_f’ame
 << 
¡d
::
’dl
;

222 ià(
	gty³
 =ğ
TRAINING
)

223 
log¡»am
(
LOG_INFO
) << "Startingo„ead matrix-market input. Matrix dimensions: "

224 << 
M
 << " x " << 
N
 << ",‚Ú-z”os: " << 
nz
 << 
¡d
::
’dl
;

226 
log¡»am
(
LOG_INFO
) << "Startingo„ead matrix-market input. Matrix dimensions: "

227 << 
	gMe
 << " x " << 
	gNe
 << ",‚Ú-z”os: " << 
	gnz
 << 
	g¡d
::
’dl
;

229 
ušt
 
	gI
, 
	gJ
;

230 
	gv®
, 
	gtime
;

231 ià(
	gty³
 =ğ
TRAINING
)

232 
L
 = 
nz
;

233 
	gLe
 = 
nz
;

235 ià(!
	gsh¬d”obj
.
´•roûs£d_fe_exi¡s
()) {

236 
size_t
 
	gi
=0; i<
	gnz
; i++)

238 
	grc
 = 
fsÿnf
(
f
, "%d %d %lg %lg\n", &
I
, &
J
, &
time
, &
v®
);

239 ià(
	grc
 != 4)

240 
log¡»am
(
LOG_FATAL
)<<"E¼Ü wh’„—dšg iÅuˆf-†š" << 
i
 << 
¡d
::
’dl
;

241 ià(
	gtime
 < 0)

242 
log¡»am
(
LOG_FATAL
)<<"TimÑhœd cŞumnsèshould b>ğ0 " << 
	g¡d
::
’dl
;

243 
	gI
-=
šput_fe_off£t
;

244 
	gJ
-=
šput_fe_off£t
;

245 ià(
	gI
 >ğ
M
)

246 
log¡»am
(
LOG_FATAL
)<<"Row index†¬g”hªhm©rix„ow siz" << 
I
 << " > " << 
M
 << " iÀlše: " << 
i
 << 
¡d
::
’dl
;

247 ià(
	gJ
 >ğ
N
)

248 
log¡»am
(
LOG_FATAL
)<<"CŞ index†¬g”hªhm©rix cŞ siz" << 
J
 << " > " << 
N
 << " iÀlše; " << 
i
 << 
¡d
::
’dl
;

249 
	gK
 = 
¡d
::
max
(()
time
, ()
K
);

250 
	gtime
 -ğ
m©Ïb_time_off£t
;

251 ià(
	gtime
 < 0 && 
	gadd_time_edges
)

252 
log¡»am
(
LOG_FATAL
)<<"Timbš should b>ğ1 iÀrow " << 
	gi
 << 
	g¡d
::
’dl
;

254 ià(
	gsqu¬e
 && 
	gI
 =ğ
J
)

256 
	gglob®M—n
 +ğ
v®
;

257 
	gsh¬d”obj
.
´•roûssšg_add_edge
(
I
, (
squ¬e
? 
J
 : (
M
 + J)), 
®s_edge_ty³
(
v®
, 
time
+M+
N
));

260 ià(
	gadd_time_edges
){

261 
	gsh¬d”obj
.
´•roûssšg_add_edge
((
ušt
)
time
 + 
M
 + 
N
, 
I
, 
®s_edge_ty³
(
v®
, M+
J
));

262 
	gsh¬d”obj
.
´•roûssšg_add_edge
((
ušt
)
time
 + 
M
 + 
N
, M+
J
 , 
®s_edge_ty³
(
v®
, 
I
));

266 ià(
	gty³
 =ğ
TRAINING
){

267 
ušt
 
tßdd
 = 0;

268 ià(
	gim¶ic™¿tšgty³
 =ğ
IMPLICIT_RATING_RANDOM
)

269 
tßdd
 = 
add_im¶ic™_edges4
(
im¶ic™¿tšgty³
, 
sh¬d”obj
);

270 
	gglob®M—n
 +ğ
im¶ic™¿tšgv®ue
 * 
tßdd
;

271 
	gL
 +ğ
tßdd
;

272 
	gglob®M—n
 /ğ
L
;

273 
log¡»am
(
LOG_INFO
è<< "Glob® m—Àis: " << 
	gglob®M—n
 << "imbšs: " << 
	gK
 << " . Now c»©šg sh¬ds." << 
	g¡d
::
’dl
;

276 
	gglob®M—n2
 /ğ
Le
;

277 
log¡»am
(
LOG_INFO
è<< "Glob® m—Àis: " << 
	gglob®M—n2
 << "imbšs: " << 
	gK
 << " . Now c»©šg sh¬ds." << 
	g¡d
::
’dl
;

279 
wr™e_glob®_m—n
(
ba£_f’ame
, 
ty³
);

281 
	gsh¬d”obj
.
’d_´•roûssšg
();

284 
log¡»am
(
LOG_INFO
è<< "M©rix‡Ì—dy…»´oûs£d, ju¡„uÀsh¬d”." << 
	g¡d
::
’dl
;

287 
fşo£
(
f
);

288 
log¡»am
(
LOG_INFO
è<< "Now c»©šg sh¬ds." << 
	g¡d
::
’dl
;

291 
	gnsh¬ds
 = 
sh¬d”obj
.
execu‹_sh¬dšg
(
g‘_İtiÚ_¡ršg
("nshards", "auto"));

293  
	gnsh¬ds
;

301 
	g‹m¶©e
 <
ty³Çme
 
	g®s_edge_ty³
>

302 
cÚv”t_m©rixm¬k‘_ªd_™em_sim¬™y
(
¡d
::
¡ršg
 
ba£_f’ame
, std::¡ršg 
sim¬™y_fe
, 
tok’s_³r_row
 = 3) {

303 
FILE
 *
f
 = 
NULL
, *
	gfsim
 = NULL;

304 
size_t
 
	gnz
, 
	gnz_sim
;

305 
ušt
 
	gNt
;

309 
	gnsh¬ds
;

310 ià((
	gnsh¬ds
 = 
fšd_sh¬ds
<
®s_edge_ty³
>(
ba£_f’ame
, 
g‘_İtiÚ_¡ršg
("nshards", "auto")))) {

311 ià(
	gcheck_Üigfe_modifiÿtiÚ_—¾›r
<
	g®s_edge_ty³
>(
	gba£_f’ame
, 
	gnsh¬ds
)) {

312 
log¡»am
(
LOG_INFO
è<< "F" << 
	gba£_f’ame
 << " wa ®»ady…»´oûs£d, wÚ'ˆdØ™‡gaš. " << 
	g¡d
::
’dl
;

313 
»ad_glob®_m—n
(
ba£_f’ame
, 
TRAINING
);

314  
	gnsh¬ds
;

318 
	gsh¬d”
<
	g®s_edge_ty³
> 
sh¬d”obj
(
ba£_f’ame
);

319 
	gsh¬d”obj
.
¡¬t_´•roûssšg
();

321 
d‘eù_m©rix_size
(
ba£_f’ame
, 
f
, 
M
, 
N
, 
nz
);

322 ià(
	gf
 =ğ
NULL
)

323 
log¡»am
(
LOG_FATAL
)<<"FaedØİ’¿ššg iÅuˆfe: " << 
ba£_f’ame
 << 
¡d
::
’dl
;

324 
d‘eù_m©rix_size
(
sim¬™y_fe
, 
fsim
, 
Ne
, 
Nt
, 
nz_sim
);

325 ià(
	gfsim
 =ğ
NULL
)

326 
log¡»am
(
LOG_FATAL
)<<"FaedØİ’ i‹m sim¬™y iÅuˆfe: " << 
sim¬™y_fe
 << 
¡d
::
’dl
;

327 ià(
	gNe
 !ğ
N
 || 
Nt
 != N)

328 
log¡»am
(
LOG_FATAL
)<<"WrÚg i‹m sim¬™y fm©rix size: " << 
Ne
 <<" x " << 
Nt
 << " In¡—d oà" << 
N
 << " x " << N << 
¡d
::
’dl
;

329 
	gL
=
nz
 + 
nz_sim
;

331 
ušt
 
	gI
, 
	gJ
;

332 
	gv®
 = 1.0;

333 ià(!
	gsh¬d”obj
.
´•roûs£d_fe_exi¡s
()) {

334 
log¡»am
(
LOG_INFO
) << "Startingo„ead matrix-market input. Matrix dimensions: "

335 << 
	gM
 << " x " << 
	gN
 << ",‚Ú-z”os: " << 
	gnz
 << 
	g¡d
::
’dl
;

337 
size_t
 
	gi
=0; i<
	gnz
; i++){

338 ià(
	gtok’s_³r_row
 == 3){

339 
rc
 = 
fsÿnf
(
f
, "%u %u %lg\n", &
I
, &
J
, &
v®
);

340 ià(
	grc
 != 3)

341 
log¡»am
(
LOG_FATAL
)<<"E¼Ü wh’„—dšg iÅuˆfe: " << 
i
 << 
¡d
::
’dl
;

343 ià(
	gtok’s_³r_row
 == 2){

344 
rc
 = 
fsÿnf
(
f
, "%u %u\n", &
I
, &
J
);

345 ià(
	grc
 != 2)

346 
log¡»am
(
LOG_FATAL
)<<"E¼Ü wh’„—dšg iÅuˆfe: " << 
i
 << 
¡d
::
’dl
;

348 
as£¹
(
çl£
);

350 
	gI
-=
šput_fe_off£t
;

351 
	gJ
-=
šput_fe_off£t
;

352 ià(
	gI
 >ğ
M
)

353 
log¡»am
(
LOG_FATAL
)<<"Row index†¬g”hªhm©rix„ow siz" << 
I
 << " > " << 
M
 << " iÀlše: " << 
i
 << 
¡d
::
’dl
;

354 ià(
	gJ
 >ğ
N
)

355 
log¡»am
(
LOG_FATAL
)<<"CŞ index†¬g”hªhm©rix cŞ siz" << 
J
 << " > " << 
N
 << " iÀlše; " << 
i
 << 
¡d
::
’dl
;

356 
	gsh¬d”obj
.
´•roûssšg_add_edge
(
I
, 
M
==
N
?
J
:M + J, 
®s_edge_ty³
(()
v®
, 0));

359 
log¡»am
(
LOG_DEBUG
)<<"Fšished†ßdšg " << 
	gnz
 << "„©šg äom fe: " << 
	gba£_f’ame
 << 
	g¡d
::
’dl
;

361 
size_t
 
	gi
=0; i<
	gnz_sim
; i++){

362 ià(
	gtok’s_³r_row
 == 3){

363 
rc
 = 
fsÿnf
(
fsim
, "%u %u %lg\n", &
I
, &
J
, &
v®
);

364 ià(
	grc
 != 3)

365 
log¡»am
(
LOG_FATAL
)<<"E¼Ü wh’„—dšg iÅuˆfe: " << 
sim¬™y_fe
 << "†še: " << 
i
 << 
¡d
::
’dl
;

367 ià(
	gtok’s_³r_row
 == 2){

368 
rc
 = 
fsÿnf
(
fsim
, "%u %u\n", &
I
, &
J
);

369 ià(
	grc
 != 2)

370 
log¡»am
(
LOG_FATAL
)<<"E¼Ü wh’„—dšg iÅuˆfe: " << 
i
 << 
¡d
::
’dl
;

372 
as£¹
(
çl£
);

374 
	gI
-=
šput_fe_off£t
;

375 
	gJ
-=
šput_fe_off£t
;

376 ià(
	gI
 >ğ
N
)

377 
log¡»am
(
LOG_FATAL
)<<"Row index†¬g”hªhm©rix„ow siz" << 
I
 << " > " << 
M
 << " iÀlše: " << 
i
 << 
¡d
::
’dl
;

378 ià(
	gJ
 >ğ
N
)

379 
log¡»am
(
LOG_FATAL
)<<"CŞ index†¬g”hªhm©rix cŞ siz" << 
J
 << " > " << 
N
 << " iÀlše; " << 
i
 << 
¡d
::
’dl
;

380 
	gsh¬d”obj
.
´•roûssšg_add_edge
(
M
+
I
, M+
J
, 
®s_edge_ty³
(I < J? 
v®
: 0, I>J? val: 0));

383 
log¡»am
(
LOG_DEBUG
)<<"Fšished†ßdšg " << 
	gnz_sim
 << "„©šg äom fe: " << 
	gsim¬™y_fe
 << 
	g¡d
::
’dl
;

384 
wr™e_glob®_m—n
(
ba£_f’ame
, 
TRAINING
);

385 
	gsh¬d”obj
.
’d_´•roûssšg
();

387 
log¡»am
(
LOG_INFO
è<< "M©rix‡Ì—dy…»´oûs£d, ju¡„uÀsh¬d”." << 
	g¡d
::
’dl
;

389 
fşo£
(
f
);

390 
fşo£
(
fsim
);

392 
log¡»am
(
LOG_INFO
è<< "Now c»©šg sh¬ds." << 
	g¡d
::
’dl
;

395 
	gnsh¬ds
 = 
sh¬d”obj
.
execu‹_sh¬dšg
(
g‘_İtiÚ_¡ršg
("nshards", "auto"));

396 
log¡»am
(
LOG_INFO
è<< "SucûssfuÎy fšished sh¬dšg fÜ " << 
	gba£_f’ame
 << 
	g¡d
::
’dl
;

397 
log¡»am
(
LOG_INFO
è<< "C»©ed " << 
	gnsh¬ds
 << " sh¬ds." << 
	g¡d
::
’dl
;

399  
	gnsh¬ds
;

408 
	g‹m¶©e
 <
ty³Çme
 
	g®s_edge_ty³
>

409 
cÚv”t_m©rixm¬k‘
(
¡d
::
¡ršg
 
ba£_f’ame
, 
Sh¬d”P»´oûssÜ
<
®s_edge_ty³
> * 
´•roûssÜ
 = 
NULL
, 
size_t
 
nodes
 = 0, size_ˆ
edges
 = 0, 
tok’s_³r_row
 = 3, 
ty³
 = 
TRAINING
, 
®low_squ¬e
 = 
Œue
) {

411 
FILE
 *
f
;

412 
size_t
 
	gnz
;

414 
	g¡d
::
¡ršg
 
suffix
 = "";

415 ià(
	g´•roûssÜ
 !ğ
NULL
) {

416 
suffix
 = 
´•roûssÜ
->
g‘Suffix
();

422 
	gnsh¬ds
;

423 ià((
	gnsh¬ds
 = 
fšd_sh¬ds
<
®s_edge_ty³
>(
ba£_f’ame
+ 
suffix
, 
g‘_İtiÚ_¡ršg
("nshards", "auto")))) {

424 ià(
	gcheck_Üigfe_modifiÿtiÚ_—¾›r
<
	g®s_edge_ty³
>(
	gba£_f’ame
, 
	gnsh¬ds
)) {

425 
log¡»am
(
LOG_INFO
è<< "F" << 
	gba£_f’ame
 << " wa ®»ady…»´oûs£d, wÚ'ˆdØ™‡gaš. " << 
	g¡d
::
’dl
;

426 
»ad_glob®_m—n
(
ba£_f’ame
, 
ty³
);

427  
	gnsh¬ds
;

431 
	gsh¬d”
<
	g®s_edge_ty³
> 
sh¬d”obj
(
ba£_f’ame
 + 
suffix
);

432 
	gsh¬d”obj
.
¡¬t_´•roûssšg
();

434 
d‘eù_m©rix_size
(
ba£_f’ame
, 
f
, 
ty³
 =ğ
TRAINING
?
M
:
Me
,y³ =ğTRAINING?
N
:
Ne
, 
nz
, 
nodes
, 
edges
,ype);

435 ià(
	gf
 =ğ
NULL
){

436 ià(
ty³
 =ğ
TRAINING
){

437 
log¡»am
(
LOG_FATAL
)<<"FaedØİ’¿ššg iÅuˆfe: " << 
ba£_f’ame
 << 
¡d
::
’dl
;

439 ià(
	gty³
 =ğ
VALIDATION
){

440 
log¡»am
(
LOG_INFO
)<<"V®id©iÚ fe: " << 
ba£_f’ame
 << " i nÙ found. " << 
¡d
::
’dl
;

444 ià(
	gty³
 =ğ
TRAINING
)

445 
L
=
nz
;

447 
	gLe
 = 
nz
;

449 ià(
	gty³
 =ğ
TRAINING
)

450 
log¡»am
(
LOG_INFO
) << "Startingo„ead matrix-market input. Matrix dimensions: "

451 << 
M
 << " x " << 
N
 << ",‚Ú-z”os: " << 
nz
 << 
¡d
::
’dl
;

453 
log¡»am
(
LOG_INFO
) << "Startingo„ead VALIDATION matrix-market input. Matrix dimensions: "

454 << 
	gMe
 << " x " << 
	gNe
 << ",‚Ú-z”os: " << 
	gnz
 << 
	g¡d
::
’dl
;

456 
ušt
 
	gI
, 
	gJ
;

457 
	gv®
 = 1.0;

458 ià(!
	gsh¬d”obj
.
´•roûs£d_fe_exi¡s
()) {

459 
size_t
 
	gi
=0; i<
	gnz
; i++)

461 ià(
	gtok’s_³r_row
 == 3){

462 
rc
 = 
fsÿnf
(
f
, "%u %u %lg\n", &
I
, &
J
, &
v®
);

463 ià(
	grc
 != 3)

464 
log¡»am
(
LOG_FATAL
)<<"E¼Ü wh’„—dšg iÅuˆfe: " << 
i
 << 
¡d
::
’dl
;

466 ià(
	gtok’s_³r_row
 == 2){

467 
rc
 = 
fsÿnf
(
f
, "%u %u\n", &
I
, &
J
);

468 ià(
	grc
 != 2)

469 
log¡»am
(
LOG_FATAL
)<<"E¼Ü wh’„—dšg iÅuˆfe: " << 
i
 << 
¡d
::
’dl
;

471 
as£¹
(
çl£
);

473 ià(
	gI
 ==987654321 || 
J
== 987654321)

475 
	gI
-=
šput_fe_off£t
;

476 
	gJ
-=
šput_fe_off£t
;

477 ià(
	gI
 >ğ
M
)

478 
log¡»am
(
LOG_FATAL
)<<"Row index†¬g”hªhm©rix„ow siz" << 
I
+1 << " > " << 
M
 << " iÀlše: " << 
i
 << 
¡d
::
’dl
;

479 ià(
	gJ
 >ğ
N
)

480 
log¡»am
(
LOG_FATAL
)<<"CŞ index†¬g”hªhm©rix cŞ siz" << 
J
+1 << " > " << 
N
 << " iÀlše; " << 
i
 << 
¡d
::
’dl
;

481 ià(
	gty³
 =ğ
TRAINING
)

482 
glob®M—n
 +ğ
v®
;

483 
	gglob®M—n2
 +ğ
v®
;

484 
	gsh¬d”obj
.
´•roûssšg_add_edge
(
I
, (
M
==
N
 && 
®low_squ¬e
)?
J
:M + J, 
®s_edge_ty³
(()
v®
));

487 ià(
	gty³
 =ğ
TRAINING
){

488 
ušt
 
tßdd
 = 0;

489 ià(
	gim¶ic™¿tšgty³
 =ğ
IMPLICIT_RATING_RANDOM
)

490 
tßdd
 = 
add_im¶ic™_edges
(
im¶ic™¿tšgty³
, 
sh¬d”obj
);

491 
	gglob®M—n
 +ğ
im¶ic™¿tšgv®ue
 * 
tßdd
;

492 
	gL
 +ğ
tßdd
;

493 
	gglob®M—n
 /ğ
L
;

494 
log¡»am
(
LOG_INFO
è<< "Glob® m—Àis: " << 
	gglob®M—n
 << " Now c»©šg sh¬ds." << 
	g¡d
::
’dl
;

497 
	gglob®M—n2
 /ğ
Le
;

498 
log¡»am
(
LOG_INFO
è<< "Glob® m—Àis: " << 
	gglob®M—n2
 << " Now c»©šg sh¬ds." << 
	g¡d
::
’dl
;

500 
wr™e_glob®_m—n
(
ba£_f’ame
, 
ty³
);

501 
	gsh¬d”obj
.
’d_´•roûssšg
();

503 ià(
	g´•roûssÜ
 !ğ
NULL
) {

504 
´•roûssÜ
->
»´oûss
(
sh¬d”obj
.
´•roûs£d_Çme
(), 
ba£_f’ame
);

508 
log¡»am
(
LOG_INFO
è<< "M©rix‡Ì—dy…»´oûs£d, ju¡„uÀsh¬d”." << 
	g¡d
::
’dl
;

510 
fşo£
(
f
);

513 
log¡»am
(
LOG_INFO
è<< "Now c»©šg sh¬ds." << 
	g¡d
::
’dl
;

516 
	gnsh¬ds
 = 
sh¬d”obj
.
execu‹_sh¬dšg
(
g‘_İtiÚ_¡ršg
("nshards", "auto"));

517 
log¡»am
(
LOG_INFO
è<< "SucûssfuÎy fšished sh¬dšg fÜ " << 
	gba£_f’ame
 + 
	gsuffix
 << 
	g¡d
::
’dl
;

518 
log¡»am
(
LOG_INFO
è<< "C»©ed " << 
	gnsh¬ds
 << " sh¬ds." << 
	g¡d
::
’dl
;

520  
	gnsh¬ds
;

525 
lßd_m©rix_m¬k‘_veùÜ
(cÚ¡ 
¡d
::
¡ršg
 & 
f’ame
, cÚ¡ 
b¬t™e_g¿ph_desütÜ
 & 
desc
,

526 
ty³
, 
boŞ
 
İtiÚ®_f›ld
, boŞ 
®low_z”os
)

529 
	g»t_code
;

530 
MM_ty³code
 
	gm©code
;

531 
ušt
 
	gM
, 
	gN
;

532 
size_t
 
	gi
,
	gnz
;

534 
log¡»am
(
LOG_INFO
è<<"GošgØ»ad m©rix m¬k‘ veùÜ from iÅuˆfe: " << 
	gf’ame
 << 
	g¡d
::
’dl
;

536 
FILE
 * 
	gf
 = 
İ’_fe
(
f’ame
.
c_¡r
(), "r", 
İtiÚ®_f›ld
);

538 ià(
	gf
=ğ
NULL
 && 
İtiÚ®_f›ld
){

542 ià(
mm_»ad_bªÃr
(
f
, &
m©code
) != 0)

543 
log¡»am
(
LOG_FATAL
è<< "Could‚Ù…roûs M©rix M¬k‘ bªÃr." << 
¡d
::
’dl
;

548 ià(
mm_is_com¶ex
(
m©code
è&& 
mm_is_m©rix
(matcode) &&

549 
mm_is_¥¬£
(
m©code
) )

550 
log¡»am
(
LOG_FATAL
è<< "sÜry,hi ­¶iÿtiÚ dÛ nÙ suµÜˆ" << 
	g¡d
::
’dl
 <<

551 "M¬k‘ M¬k‘y³: " << 
mm_ty³code_to_¡r
(
m©code
è<< 
¡d
::
’dl
;

554 ià(
mm_is_¥¬£
(
m©code
)){

555 ià((
	g»t_code
 = 
mm_»ad_mtx_üd_size
(
f
, &
M
, &
N
, &
nz
)) !=0)

556 
log¡»am
(
LOG_FATAL
è<< "çedØ»ad m©rix m¬k‘ c¬dš®™y siz" << 
¡d
::
’dl
;

559 ià((
	g»t_code
 = 
mm_»ad_mtx_¬¿y_size
(
f
, &
M
, &
N
))!= 0)

560 
log¡»am
(
LOG_FATAL
è<< "çedØ»ad m©rix m¬k‘ veùÜ siz" << 
¡d
::
’dl
;

561 ià(
	gN
 > 
	gM
){

562 
	gtmp
 = 
N
;

563 
	gN
 = 
M
;

564 
	gM
 = 
tmp
;

566 
	gnz
 = 
M
*
N
;

570 
ušt
 
	grow
,
	gcŞ
;

571 
	gv®
;

573 
	gi
=0; i<
	gnz
; i++)

575 ià(
mm_is_¥¬£
(
m©code
)){

576 
	grc
 = 
fsÿnf
(
f
, "%u %u %lg\n", &
row
, &
cŞ
, &
v®
);

577 ià(
	grc
 != 3){

578 
log¡»am
(
LOG_FATAL
è<< "Faed„—dšg iÅuˆfe: " << 
f’ame
 << "Problm‡ˆd©¨row " << 
i
 << " (nÙ inşudšg h—d”‡nd comm’ˆlšes)" << 
¡d
::
’dl
;

580 
	grow
--;

581 
	gcŞ
--;

584 
	grc
 = 
fsÿnf
(
f
, "%lg\n", &
v®
);

585 ià(
	grc
 != 1){

586 
log¡»am
(
LOG_FATAL
è<< "Faed„—dšg iÅuˆfe: " << 
f’ame
 << "Problm‡ˆd©¨row " << 
i
 << " (nÙ inşudšg h—d”‡nd comm’ˆlšes)" << 
¡d
::
’dl
;

588 
	grow
 = 
i
;

589 
	gcŞ
 = 0;

592 
as£¹
(
row
 >=0 &&„ow< 
M
);

593 
as£¹
(
cŞ
 == 0);

594 ià(
	gv®
 =ğ0 && !
®low_z”os
)

595 
log¡»am
(
LOG_FATAL
)<<"Z”Ø’Œ› ¬nÙ‡Îowed iÀ¨¥¬£ m©rix m¬k‘ veùÜ. U£ --z”oñrutØavoidhi ”rÜ"<<
¡d
::
’dl
;

597 
	gv”‹x_d©a
 & 
	gvd©a
 = 
Ï‹Á_çùÜs_šmem
[
row
];

598 
	gvd©a
.
	gpvec
[
ty³
] = 
v®
;

600 
fşo£
(
f
);

604 
vec
 
lßd_m©rix_m¬k‘_veùÜ
(cÚ¡ 
¡d
::
¡ršg
 & 
f’ame
, 
boŞ
 
İtiÚ®_f›ld
, boŞ 
®low_z”os
)

607 
	g»t_code
;

608 
MM_ty³code
 
	gm©code
;

609 
ušt
 
	gM
, 
	gN
;

610 
size_t
 
	gi
,
	gnz
;

612 
log¡»am
(
LOG_INFO
è<<"GošgØ»ad m©rix m¬k‘ veùÜ from iÅuˆfe: " << 
	gf’ame
 << 
	g¡d
::
’dl
;

614 
FILE
 * 
	gf
 = 
İ’_fe
(
f’ame
.
c_¡r
(), "r", 
İtiÚ®_f›ld
);

616 ià(
	gf
=ğ
NULL
 && 
İtiÚ®_f›ld
){

617  
z”os
(1);

620 ià(
mm_»ad_bªÃr
(
f
, &
m©code
) != 0)

621 
log¡»am
(
LOG_FATAL
è<< "Could‚Ù…roûs M©rix M¬k‘ bªÃr." << 
¡d
::
’dl
;

626 ià(
mm_is_com¶ex
(
m©code
è&& 
mm_is_m©rix
(matcode) &&

627 
mm_is_¥¬£
(
m©code
) )

628 
log¡»am
(
LOG_FATAL
è<< "sÜry,hi ­¶iÿtiÚ dÛ nÙ suµÜˆ" << 
	g¡d
::
’dl
 <<

629 "M¬k‘ M¬k‘y³: " << 
mm_ty³code_to_¡r
(
m©code
è<< 
¡d
::
’dl
;

632 ià(
mm_is_¥¬£
(
m©code
)){

633 ià((
	g»t_code
 = 
mm_»ad_mtx_üd_size
(
f
, &
M
, &
N
, &
nz
)) !=0)

634 
log¡»am
(
LOG_FATAL
è<< "çedØ»ad m©rix m¬k‘ c¬dš®™y siz" << 
¡d
::
’dl
;

637 ià((
	g»t_code
 = 
mm_»ad_mtx_¬¿y_size
(
f
, &
M
, &
N
))!= 0)

638 
log¡»am
(
LOG_FATAL
è<< "çedØ»ad m©rix m¬k‘ veùÜ siz" << 
¡d
::
’dl
;

639 ià(
	gN
 > 
	gM
){

640 
	gtmp
 = 
N
;

641 
	gN
 = 
M
;

642 
	gM
 = 
tmp
;

644 
	gnz
 = 
M
*
N
;

647 
vec
 
	g»t
 = 
z”os
(
M
);

648 
ušt
 
	grow
,
	gcŞ
;

649 
	gv®
;

651 
	gi
=0; i<
	gnz
; i++)

653 ià(
mm_is_¥¬£
(
m©code
)){

654 
	grc
 = 
fsÿnf
(
f
, "%u %u %lg\n", &
row
, &
cŞ
, &
v®
);

655 ià(
	grc
 != 3){

656 
log¡»am
(
LOG_FATAL
è<< "Faed„—dšg iÅuˆfe: " << 
f’ame
 << "Problm‡ˆd©¨row " << 
i
 << " (nÙ inşudšg h—d”‡nd comm’ˆlšes)" << 
¡d
::
’dl
;

658 
	grow
--;

659 
	gcŞ
--;

662 
	grc
 = 
fsÿnf
(
f
, "%lg\n", &
v®
);

663 ià(
	grc
 != 1){

664 
log¡»am
(
LOG_FATAL
è<< "Faed„—dšg iÅuˆfe: " << 
f’ame
 << "Problm‡ˆd©¨row " << 
i
 << " (nÙ inşudšg h—d”‡nd comm’ˆlšes)" << 
¡d
::
’dl
;

666 
	grow
 = 
i
;

667 
	gcŞ
 = 0;

670 
as£¹
(
row
 >=0 &&„ow< 
M
);

671 
as£¹
(
cŞ
 == 0);

672 ià(
	gv®
 =ğ0 && !
®low_z”os
)

673 
log¡»am
(
LOG_FATAL
)<<"Z”Ø’Œ› ¬nÙ‡Îowed iÀ¨¥¬£ m©rix m¬k‘ veùÜ. U£ --z”oñrutØavoidhi ”rÜ"<<
¡d
::
’dl
;

675 
	g»t
[
row
] = 
v®
;

677 
fşo£
(
f
);

678 
log¡»am
(
LOG_INFO
)<<"SucûsfuÎy„—d‡ veùÜ oàsize: " << 
	gM
 << " [ " << 
	gnz
 << "]" << 
	g¡d
::
’dl
;

679  
	g»t
;

684 
šlše
 
	$wr™e_row
(
row
, 
cŞ
, 
v®
, 
FILE
 * 
f
, 
boŞ
 
is¥¬£
){

685 ià(
is¥¬£
)

686 
	`årštf
(
f
, "%d %d %10.13g\n", 
row
, 
cŞ
, 
v®
);

687 
	`årštf
(
f
, "%10.13g ", 
v®
);

688 
	}
}

690 
šlše
 
	$wr™e_row
(
row
, 
cŞ
, 
v®
, 
FILE
 * 
f
, 
boŞ
 
is¥¬£
){

691 ià(
is¥¬£
)

692 
	`årštf
(
f
, "%d %d %d\n", 
row
, 
cŞ
, 
v®
);

693 
	`årštf
(
f
, "%d ", 
v®
);

694 
	}
}

696 
	g‹m¶©e
<
ty³Çme
 
	gT
>

697 
šlše
 
£t_ty³code
(
MM_ty³code
 & 
m©cÜe
);

699 
	g‹m¶©e
<>

700 
šlše
 
	g£t_ty³code
<
	gvec
>(
	gMM_ty³code
 & 
	gm©code
){

701 
mm_£t_»®
(&
m©code
);

704 
	g‹m¶©e
<>

705 
šlše
 
	g£t_ty³code
<
	givec
>(
	gMM_ty³code
 & 
	gm©code
){

706 
mm_£t_š‹g”
(&
m©code
);

710 
	g‹m¶©e
<
ty³Çme
 
	gvec
>

711 
§ve_m©rix_m¬k‘_fÜm©_veùÜ
(cÚ¡ 
¡d
::
¡ršg
 
d©afe
, cÚ¡ 
vec
 & 
ouut
, 
boŞ
 
is¥¬£
, std::¡ršg 
comm’t
)

713 
MM_ty³code
 
m©code
;

714 
mm_š™Ÿlize_ty³code
(&
m©code
);

715 
mm_£t_m©rix
(&
m©code
);

716 
mm_£t_coÜdš©e
(&
m©code
);

718 ià(
	gis¥¬£
)

719 
mm_£t_¥¬£
(&
m©code
);

720 
mm_£t_d’£
(&
m©code
);

722 
	g£t_ty³code
<
	gvec
>(
	gm©code
);

724 
FILE
 * 
	gf
 = 
fİ’
(
d©afe
.
c_¡r
(),"w");

725 ià(
	gf
 =ğ
NULL
)

726 
log¡»am
(
LOG_FATAL
)<<"FaedØİ’ fe: " << 
d©afe
 << " fÜ wr™šg. " << 
¡d
::
’dl
;

728 
mm_wr™e_bªÃr
(
f
, 
m©code
);

729 ià(
	gcomm’t
.
size
() > 0)

730 
årštf
(
f
, "%c%s\n", '%', 
comm’t
.
c_¡r
());

731 ià(
	gis¥¬£
)

732 
mm_wr™e_mtx_üd_size
(
f
, 
ouut
.
size
(), 1, output.size());

734 
mm_wr™e_mtx_¬¿y_size
(
f
, 
ouut
.
size
(), 1);

736 
	gj
=0; j<()
	gouut
.
size
(); j++){

737 
wr™e_row
(
j
+1, 1, 
ouut
[j], 
f
, 
is¥¬£
);

738 ià(!
	gis¥¬£
)

739 
årštf
(
f
, "\n");

742 
fşo£
(
f
);

746 
	g‹m¶©e
<
ty³Çme
 
	gvec
>

747 
šlše
 
wr™e_ouut_veùÜ
(cÚ¡ 
¡d
::
¡ršg
 & 
d©afe
, cÚ¡ 
vec
& 
ouut
, 
boŞ
 
is¥¬£
, std::¡ršg 
comm’t
 = ""){

749 
log¡»am
(
LOG_INFO
)<<"GošgØwr™ouuˆtØfe: " << 
d©afe
 << " (veùÜ oàsize: " << 
ouut
.
size
(è<< "è" << 
¡d
::
’dl
;

750 
§ve_m©rix_m¬k‘_fÜm©_veùÜ
(
d©afe
, 
ouut
,
is¥¬£
, 
comm’t
);

754 
lßd_m©rix_m¬k‘_m©rix
(cÚ¡ 
¡d
::
¡ršg
 & 
f’ame
, 
off£t
, 
D
){

755 
MM_ty³code
 
	gm©code
;

756 
ušt
 
	gi
,
	gI
,
	gJ
;

757 
	gv®
;

758 
ušt
 
	grows
, 
	gcŞs
;

759 
size_t
 
	gÂz
;

760 
FILE
 * 
	gf
 = 
İ’_fe
(
f’ame
.
c_¡r
() ,"r");

761 
	grc
 = 
mm_»ad_bªÃr
(
f
, &
m©code
);

762 ià(
	grc
 != 0)

763 
log¡»am
(
LOG_FATAL
)<<"FaedØlßd m©rix m¬k‘ bªÃ¸š fe: " << 
f’ame
 << 
¡d
::
’dl
;

765 ià(
mm_is_¥¬£
(
m©code
)){

766 
	grc
 = 
mm_»ad_mtx_üd_size
(
f
, &
rows
, &
cŞs
, &
Âz
);

767 ià(
	grc
 != 0)

768 
log¡»am
(
LOG_FATAL
)<<"FaedØlßd m©rix m¬k‘ bªÃ¸š fe: " << 
f’ame
 << 
¡d
::
’dl
;

771 
	grc
 = 
mm_»ad_mtx_¬¿y_size
(
f
, &
rows
, &
cŞs
);

772 ià(
	grc
 != 0)

773 
log¡»am
(
LOG_FATAL
)<<"FaedØlßd m©rix m¬k‘ bªÃ¸š fe: " << 
f’ame
 << 
¡d
::
’dl
;

774 
	gÂz
 = 
rows
 * 
cŞs
;

777 ià(
	gD
 !ğ()
cŞs
)

778 
log¡»am
(
LOG_FATAL
)<<"WrÚg m©rix sizd‘eùed, should b" << 
D
 << " in¡—d oà: " << 
cŞs
 << 
¡d
::
’dl
;

780 
	gi
=0; i<
	gÂz
; i++){

781 ià(
mm_is_¥¬£
(
m©code
)){

782 
	grc
 = 
fsÿnf
(
f
, "%u %u %lg\n", &
I
, &
J
, &
v®
);

783 ià(
	grc
 != 3)

784 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg iÅuˆlš" << 
i
 << 
¡d
::
’dl
;

785 
	gI
--; 
	gJ
--;

786 
as£¹
(
I
 >ğ0 && I < 
rows
);

787 
as£¹
(
J
 >ğ0 && J < 
cŞs
);

789 
	gÏ‹Á_çùÜs_šmem
[
I
+
off£t
].
£t_v®
(
J
,
v®
);

792 
	grc
 = 
fsÿnf
(
f
, "%lg", &
v®
);

793 ià(
	grc
 != 1)

794 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg‚nz " << 
i
 << 
¡d
::
’dl
;

795 
	gI
 = 
i
 / 
cŞs
;

796 
	gJ
 = 
i
 % 
cŞs
;

797 
	gÏ‹Á_çùÜs_šmem
[
I
+
off£t
].
£t_v®
(
J
, 
v®
);

800 
log¡»am
(
LOG_INFO
è<< "FaùÜ äom fe:†ßded m©rix oàsiz" << 
	grows
 << " x " << 
	gcŞs
 << " from fe: " << 
	gf’ame
 << "Ù® oà" << 
	gÂz
 << "ƒÁr›s. "<< 
	gi
 << 
	g¡d
::
’dl
;

801 
fşo£
(
f
);

	@toolkits/collaborative_filtering/itemcf.cpp

38 
	~<£t
>

39 
	~<iomª
>

40 
	~<®gÜ™hm
>

41 
	~"commÚ.hµ
"

42 
	~"tim”.hµ
"

43 
	~"eig’_w¿µ”.hµ
"

44 
	~"’gše/dyÇmic_g¿phs/g¿phchi_dyÇmicg¿ph_’gše.hµ
"

47 
	eDISTANCE_METRICS
{

48 
	mJACCARD
 = 0,

49 
	mAA
 = 1,

50 
	mRA
 = 2,

51 
	mASYM_COSINE
 = 3,

54 
	gmš_®lowed_š‹r£ùiÚ
 = 1;

55 
vec
 
	gwr™‹n_·œs
;

56 
size_t
 
	gz”o_di¡
 = 0;

57 
size_t
 
	gaùu®_wr™‹n
 = 0;

58 
size_t
 
	g™em_·œs_com·»d
 = 0;

59 
size_t
 
	gnÙ_’ough
 = 0;

60 
	g¡d
::
veùÜ
<
FILE
*> 
out_fes
;

61 
tim”
 
	gmytim”
;

62 
boŞ
 * 
	g»Ëvªt_™ems
 = 
NULL
;

63 
	gg¿bbed_edges
 = 0;

64 
	gdi¡ªû_m‘ric
;

65 
	gasym_cosše_®pha
 = 0.5;

67 
boŞ
 
	$is_™em
(
vid_t
 
v
){  v >ğ
M
; 
	}
}

68 
boŞ
 
	$is_u£r
(
vid_t
 
v
){  v < 
M
; 
	}
}

74 
	tV”‹xD©aTy³
;

75 
	tEdgeD©aTy³
;

77 
	sv”‹x_d©a
{

78 
vec
 
	mpvec
;

79 
	mdeg»e
;

80 
v”‹x_d©a
(){ 
	mdeg»e
 = 0; }

81 
£t_v®
(
šdex
, 
v®
){

82 
	mpvec
[
šdex
] = 
v®
;

84 
g‘_v®
(
šdex
){

85  
	mpvec
[
šdex
];

88 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

89 
	~"io.hµ
"

92 
	sd’£_adj
 {

93 
	mcouÁ
;

94 
vid_t
 * 
	madjli¡
;

96 
d’£_adj
(è{ 
	madjli¡
 = 
NULL
; }

97 
d’£_adj
(
_couÁ
, 
vid_t
 * 
_adjli¡
è: 
couÁ
(_couÁ), 
adjli¡
(_adjlist) {

104 şas 
	cadjli¡_cÚš”
 {

105 
	m¡d
::
veùÜ
<
d’£_adj
> 
adjs
;

107 
	mpublic
:

108 
vid_t
 
pivÙ_¡
, 
	mpivÙ_’
;

110 
	$adjli¡_cÚš”
() {

111 
pivÙ_¡
 = 
M
;

112 
pivÙ_’
 = 
M
;

115 
	$ş—r
() {

116 
¡d
::
veùÜ
<
d’£_adj
>::
™”©Ü
 
™
=
adjs
.
	`begš
(); iˆ!ğadjs.
	`’d
(); ++it) {

117 ià(
™
->
adjli¡
 !ğ
NULL
) {

118 
	`ä“
(
™
->
adjli¡
);

119 
™
->
adjli¡
 = 
NULL
;

122 
adjs
.
	`ş—r
();

123 
pivÙ_¡
 = 
pivÙ_’
;

124 
	}
}

129 
	$ex‹nd_pivÙ¿nge
(
vid_t
 
’
) {

130 
	`as£¹
(
’
>=
pivÙ_’
);

131 
pivÙ_’
 = 
’
;

132 
adjs
.
	`»size
(
pivÙ_’
 - 
pivÙ_¡
);

133 
	}
}

138 
lßd_edges_što_memÜy
(
g¿phchi_v”‹x
<
ušt32_t
, ušt32_t> &
v
) {

142 
	gnum_edges
 = 
v
.
num_edges
();

144 ià(
	gnum_edges
 < 
	gmš_®lowed_š‹r£ùiÚ
){

145 
	g»Ëvªt_™ems
[
v
.
id
(è- 
M
] = 
çl£
;

149 
	g»Ëvªt_™ems
[
v
.
id
(è- 
M
] = 
Œue
;

152 
d’£_adj
 
	gdadj
 = d’£_adj(
num_edges
, (
vid_t
*è
ÿÎoc
((vid_t),‚um_edges));

153 
	gi
=0; i<
	gnum_edges
; i++) {

154 
	gdadj
.
	gadjli¡
[
i
] = 
v
.
edge
(i)->
v”‹x_id
();

156 
	g¡d
::
sÜt
(
dadj
.
adjli¡
, dadj.adjli¡ + 
num_edges
);

157 
	gadjs
[
v
.
id
(è- 
pivÙ_¡
] = 
dadj
;

158 
as£¹
(
v
.
id
(è- 
pivÙ_¡
 < 
adjs
.
size
());

159 
__sync_add_ªd_ãtch
(&
g¿bbed_edges
, 
num_edges
 );

160  
	gnum_edges
;

163 
	$acouÁ
(
vid_t
 
pivÙ
) {

164  
adjs
[
pivÙ
 - 
pivÙ_¡
].
couÁ
;

165 
	}
}

185 
ÿlc_di¡ªû
(
g¿phchi_v”‹x
<
ušt32_t
, ušt32_t> &
v
, 
vid_t
 
pivÙ
, 
di¡ªû_m‘ric
) {

188 
	gd’£_adj
 &
	gpivÙ_edges
 = 
adjs
[
pivÙ
 - 
pivÙ_¡
];

189 
	gnum_edges
 = 
v
.
num_edges
();

192 ià(
	gnum_edges
 < 
	gmš_®lowed_š‹r£ùiÚ
 || 
	gpivÙ_edges
.
	gcouÁ
 < min_allowed_intersection)

195 
	g¡d
::
veùÜ
<
vid_t
> 
edges
;

196 
	gedges
.
»size
(
num_edges
);

197 
	gi
=0; i < 
	gnum_edges
; i++) {

198 
vid_t
 
	gÙh”_v”‹x
 = 
v
.
edge
(
i
)->
v”‹xid
;

199 
	gedges
[
i
] = 
Ùh”_v”‹x
;

201 
sÜt
(
edges
.
begš
(),ƒdges.
’d
());

203 
	g¡d
::
£t
<
vid_t
> 
š‹r£ùiÚ
;

204 
	g¡d
::
£t_š‹r£ùiÚ
(

205 
pivÙ_edges
.
adjli¡
,…ivÙ_edges.adjli¡ +…ivÙ_edges.
couÁ
,

206 
edges
.
begš
(),ƒdges.
’d
(),

207 
¡d
::
š£¹”
(
š‹r£ùiÚ
, iÁ”£ùiÚ.
begš
()));

209 
	gš‹r£ùiÚ_size
 = ()
š‹r£ùiÚ
.
size
();

211 ià(
	gš‹r£ùiÚ_size
 < ()
	gmš_®lowed_š‹r£ùiÚ
)

214 ià(
	gdi¡ªû_m‘ric
 =ğ
JACCARD
){

215 
ušt
 
£t_a_size
 = 
v
.
num_edges
();

216 
ušt
 
	g£t_b_size
 = 
acouÁ
(
pivÙ
);

217  
	gš‹r£ùiÚ_size
 / ()(
	g£t_a_size
 + 
	g£t_b_size
 - intersection_size);

219 ià(
	gdi¡ªû_m‘ric
 =ğ
AA
){

220 
di¡
 = 0;

221 
	g¡d
::
£t
<
vid_t
>::
™”©Ü
 
i
ğ
š‹r£ùiÚ
.
begš
(è; 
	gi
 !ğš‹r£ùiÚ.
’d
(); i++){

222 
vid_t
 
	gu£r
 = *
i
;

223 
as£¹
(
Ï‹Á_çùÜs_šmem
.
size
(è=ğ
M
 && 
is_u£r
(
u£r
));

224 
as£¹
(
Ï‹Á_çùÜs_šmem
[
u£r
].
deg»e
 > 0);

225 
	gdi¡
 +ğ1.0 / 
log
(
Ï‹Á_çùÜs_šmem
[
u£r
].
deg»e
);

227  
	gdi¡
;

229 ià(
	gdi¡ªû_m‘ric
 =ğ
RA
){

230 
di¡
 = 0;

231 
	g¡d
::
£t
<
vid_t
>::
™”©Ü
 
i
ğ
š‹r£ùiÚ
.
begš
(è; 
	gi
 !ğš‹r£ùiÚ.
’d
(); i++){

232 
vid_t
 
	gu£r
 = *
i
;

233 
as£¹
(
Ï‹Á_çùÜs_šmem
.
size
(è=ğ
M
 && 
is_u£r
(
u£r
));

234 
as£¹
(
Ï‹Á_çùÜs_šmem
[
u£r
].
deg»e
 > 0);

235 
	gdi¡
 +ğ1.0 / 
Ï‹Á_çùÜs_šmem
[
u£r
].
deg»e
;

237  
	gdi¡
;

239 ià(
	gdi¡ªû_m‘ric
 =ğ
ASYM_COSINE
){

240 
ušt
 
£t_a_size
 = 
v
.
num_edges
();

241 
ušt
 
	g£t_b_size
 = 
acouÁ
(
pivÙ
);

242  
	gš‹r£ùiÚ_size
 / (
pow
(
£t_a_size
,
asym_cosše_®pha
è*…ow(
£t_b_size
,1-asym_cosine_alpha));

248 
šlše
 
boŞ
 
	$is_pivÙ
(
vid_t
 
vid
) {

249  
vid
 >ğ
pivÙ_¡
 && vid < 
pivÙ_’
;

250 
	}
}

254 
adjli¡_cÚš”
 * 
	gadjcÚš”
;

255 
	sšdex_v®
{

256 
ušt
 
	mšdex
;

257 
	mv®
;

258 
šdex_v®
(){

259 
	mšdex
 = -1; 
	mv®
 = 0;

261 
šdex_v®
(
ušt
 
šdex
, 
v®
): index(index), val(val){ }

263 
boŞ
 
	$G»©”
(cÚ¡ 
šdex_v®
& 
a
, cÚ¡ index_v®& 
b
)

265  
a
.
v®
 > 
b
.val;

266 
	}
}

267 
	gI‹mDi¡ªûProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

273 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

280 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0) {

281 ià(
adjcÚš”
->
is_pivÙ
(
v
.
id
()è&& 
is_™em
(v.id())){

282 
adjcÚš”
->
lßd_edges_što_memÜy
(
v
);

285 ià(
is_u£r
(
v
.
id
())){

289 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 =ğ0 && (
di¡ªû_m‘ric
 =ğ
AA
 || di¡ªû_m‘riø=ğ
RA
)){

290 
Ï‹Á_çùÜs_šmem
[
v
.
id
()].
deg»e
 = v.
num_edges
();

294 
boŞ
 
	ghas_pivÙ
 = 
çl£
;

295 
	gpivÙ
 = -1;

296 
	gi
=0; i<
	gv
.
num_edges
(); i++) {

297 
	gg¿phchi_edge
<
	gušt32_t
> * 
	ge
 = 
v
.
edge
(
i
);

299 ià(
	gadjcÚš”
->
is_pivÙ
(
e
->
v”‹xid
è&& 
	g»Ëvªt_™ems
[e->v”‹xid-
M
]) {

300 
	ghas_pivÙ
 = 
Œue
;

301 
	gpivÙ
 = 
e
->
v”‹xid
;

306 ià(!
	ghas_pivÙ
)

311 
	gi
=0; i<
	gv
.
num_edges
(); i++) {

312 
	gg¿phchi_edge
<
	gušt32_t
> * 
	ge
 = 
v
.
edge
(
i
);

314 
	g»Ëvªt_™ems
[
e
->
v”‹xid
 - 
M
] = 
Œue
;

324 ià(!
	g»Ëvªt_™ems
[
v
.
id
(è- 
M
]){

327 
	g¡d
::
veùÜ
<
šdex_v®
> 
h—p
;

331 
vid_t
 
	gi
=
adjcÚš”
->
pivÙ_¡
; i< 
	gadjcÚš”
->
	gpivÙ_’
; i++){

333 ià((
	gdi¡ªû_m‘ric
 !ğ
ASYM_COSINE
 && 
i
 >ğ
v
.
id
()è|| (!
»Ëvªt_™ems
[i-
M
]))

335 ià(
	gdi¡ªû_m‘ric
 =ğ
ASYM_COSINE
 && 
i
 =ğ
v
.
id
())

338 
	gdi¡
 = 
adjcÚš”
->
ÿlc_di¡ªû
(
v
, 
i
, 
di¡ªû_m‘ric
);

339 
	g™em_·œs_com·»d
++;

340 ià(
	g™em_·œs_com·»d
 % 10000000 == 0)

341 
log¡»am
(
LOG_INFO
)<< 
¡d
::
£tw
(10è<< 
mytim”
.
cu¼’t_time
(è<< "è " << std::£tw(10è<< 
™em_·œs_com·»d
 << "…aœ com·»d " << std::£tw(10è<<
sum
(
wr™‹n_·œs
è<< " wr™‹n. " << std::
’dl
;

344 ià(
	gdi¡
 != 0){

345 
h—p
.
push_back
(
šdex_v®
(
i
, 
di¡
));

349 
	gz”o_di¡
++;

351 
sÜt
(
h—p
.
begš
(), h—p.
’d
(), &
G»©”
);

352 
	gth»ad_num
 = 
omp_g‘_th»ad_num
();

353 ià(
	gh—p
.
size
(è< 
	gK
)

354 
	gnÙ_’ough
++;

355 
ušt
 
	gi
=0; i< 
	g¡d
::
mš
(
h—p
.
size
(), (
size_t
)
K
); i++){

356 
	grc
 = 
årštf
(
out_fes
[
th»ad_num
], "%u %u %lg\n", 
v
.
id
()-
M
+1, 
h—p
[
i
].
šdex
-M+1, ()h—p[i].
v®
);

357 
	gwr™‹n_·œs
[
omp_g‘_th»ad_num
()]++;

358 ià(
	grc
 <= 0){

359 
³¼Ü
("Failedo write output");

360 
log¡»am
(
LOG_FATAL
)<<"FaedØwr™ouuˆto: fe: " << 
	gŒaššg
 << 
omp_g‘_th»ad_num
(è<< ".out" << 
	g¡d
::
’dl
;

371 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

372 
	ggcÚ‹xt
.
	gscheduËr
->
»move_sks
(0, (è
gcÚ‹xt
.
nv”tiûs
 - 1);

373 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0)

374 
wr™‹n_·œs
 = 
z”os
(
gcÚ‹xt
.
exeùh»ads
);

375 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0){

376 
mem£t
(
»Ëvªt_™ems
, 0, (
boŞ
)*
N
);

377 
vid_t
 
	gi
=0; i < 
	gM
+
	gN
; i++){

378 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
i
);

380 
	gg¿bbed_edges
 = 0;

381 
	gadjcÚš”
->
ş—r
();

383 
vid_t
 
	gi
=
M
; i < 
	gM
+
	gN
; i++){

384 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
i
);

397 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

400 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0) {

401 ià(!
qu›t
){

402 
´štf
("’‹ršg i‹¿tiÚ: %d oÀbefÜe_exec_š‹rv®\n", 
gcÚ‹xt
.
™”©iÚ
);

403 
´štf
("pivÙ_¡ i %d wšdow_’ %d\n", 
adjcÚš”
->
pivÙ_¡
, 
wšdow_’
);

405 ià(
	gadjcÚš”
->
	gpivÙ_¡
 <ğ
wšdow_’
) {

406 
size_t
 
max_g¿b_edges
 = 
g‘_İtiÚ_lÚg
("membudget_mb", 1024) * 1024 * 1024 / 8;

407 ià(
	gg¿bbed_edges
 < 
	gmax_g¿b_edges
 * 0.8) {

408 
log¡»am
(
LOG_DEBUG
è<< "Wšdow in™, g¿bbed: " << 
	gg¿bbed_edges
 << "ƒdges" << "ƒx‹ndšg…ivÜ_¿ngtØ: " << 
	gwšdow_’
 + 1 << 
	g¡d
::
’dl
;

409 
	gadjcÚš”
->
ex‹nd_pivÙ¿nge
(
wšdow_’
 + 1);

410 
log¡»am
(
LOG_DEBUG
è<< "WšdowƒÀis: " << 
	gwšdow_’
 << " v”tiûs: " << 
	ggcÚ‹xt
.
	gnv”tiûs
 << 
	g¡d
::
’dl
;

411 ià(
	gwšdow_’
+1 =ğ
gcÚ‹xt
.
nv”tiûs
) {

413 
log¡»am
(
LOG_DEBUG
)<<"S‘tšg†a¡ i‹¿tiÚo: " << 
gcÚ‹xt
.
™”©iÚ
 + 2 << 
¡d
::
’dl
;

414 
	ggcÚ‹xt
.
£t_Ï¡_™”©iÚ
(
gcÚ‹xt
.
™”©iÚ
 + 2);

417 
log¡»am
(
LOG_DEBUG
è<< "ToØmªyƒdges,‡Ì—dy g¿bbed: " << 
	gg¿bbed_edges
 << 
	g¡d
::
’dl
;

430 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

432 
	`´št_cİyright
();

436 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

440 
m‘rics
 
	`m
("item-cf");

442 
mš_®lowed_š‹r£ùiÚ
 = 
	`g‘_İtiÚ_št
("min_allowed_intersection", min_allowed_intersection);

443 
di¡ªû_m‘ric
 = 
	`g‘_İtiÚ_št
("di¡ªû", 
JACCARD
);

444 
asym_cosše_®pha
 = 
	`g‘_İtiÚ_æßt
("asym_cosine_alpha", 0.5);

445 ià(
di¡ªû_m‘ric
 !ğ
JACCARD
 && di¡ªû_m‘riø!ğ
AA
 && di¡ªû_m‘riø!ğ
RA
 && di¡ªû_m‘riø!ğ
ASYM_COSINE
)

446 
	`log¡»am
(
LOG_FATAL
)<<"WrÚg di¡ªû m‘ric. --di¡ªû_m‘ric=XX, wh”XX should be™h” 0èJACCARD, 1èAA, 2èRA, 3èASYM_COSINE" << 
¡d
::
’dl
;

447 
	`·r£_commªd_lše_¬gs
();

449 
mytim”
.
	`¡¬t
();

450 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
Œaššg
 );

451 ià(
nsh¬ds
 != 1)

452 
	`log¡»am
(
LOG_FATAL
)<<"Thi ­¶iÿtiÚ cu¼’y suµÜt Úly 1 sh¬d" << 
¡d
::
’dl
;

453 
K
 = 
	`g‘_İtiÚ_št
("K", K);

454 ià(
K
 <= 0)

455 
	`log¡»am
(
LOG_FATAL
)<<"PËa£ s³cifyhnumb” oà¿tšg tØg’”©fÜƒach u£¸usšgh--K commªd" << 
¡d
::
’dl
;

457 
	`as£¹
(
M
 > 0 && 
N
 > 0);

459 
adjcÚš”
 = 
Ãw
 
	`adjli¡_cÚš”
();

461 
»Ëvªt_™ems
 = 
Ãw
 
boŞ
[
N
];

464 ià(
di¡ªû_m‘ric
 =ğ
AA
 || di¡ªû_m‘riø=ğ
RA
)

465 
Ï‹Á_çùÜs_šmem
.
	`»size
(
M
);

468 
I‹mDi¡ªûProg¿m
 
´og¿m
;

469 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
Œue
, 
m
);

470 
	`£t_’gše_æags
(
’gše
);

471 
’gše
.
	`£t_maxwšdow
(
M
+
N
+1);

474 
out_fes
.
	`»size
(
	`numb”_of_omp_th»ads
());

475 
ušt
 
i
=0; i< 
out_fes
.
	`size
(); i++){

476 
buf
[256];

477 
	`¥rštf
(
buf
, "%s.out%d", 
Œaššg
.
	`c_¡r
(), 
i
);

478 
out_fes
[
i
] = 
	`İ’_fe
(
buf
, "w");

482 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

485 ià(!
qu›t
)

486 
	`m‘rics_»pÜt
(
m
);

488 
¡d
::
cout
<<"TÙ® i‹m…aœ com·»d: " << 
™em_·œs_com·»d
 << "Ù® wr™‹ÀtØfe: " << 
	`sum
(
wr™‹n_·œs
è<< "…aœ w™h z”Ødi¡ªû: " << 
z”o_di¡
 << std::
’dl
;

489 ià(
nÙ_’ough
)

490 
	`log¡»am
(
LOG_WARNING
)<<"I‹m th© did‚Ù hav’ough sim¬ i‹ms: " << 
nÙ_’ough
 << 
¡d
::
’dl
;

491 
ušt
 
i
=0; i< 
out_fes
.
	`size
(); i++){

492 
	`fæush
(
out_fes
[
i
]);

493 
	`fşo£
(
out_fes
[
i
]);

496 
¡d
::
cout
<<"C»©ed " << 
	`numb”_of_omp_th»ads
(è<< " ouuˆfe w™hhfÜm©: " << 
Œaššg
 << ".outXX, wh”XX i thouuˆth»ad‚umb”" << std::
’dl
;

498 
d–‘e
[] 
»Ëvªt_™ems
;

500 
	}
}

	@toolkits/collaborative_filtering/itemcf2.cpp

52 
	~<¡ršg
>

53 
	~<veùÜ
>

54 
	~<®gÜ™hm
>

55 
	~<iomª
>

56 
	~<£t
>

57 
	~<io¡»am
>

58 
	~"eig’_w¿µ”.hµ
"

59 
	~"di¡ªû.hµ
"

60 
	~"ut.hµ
"

61 
	~"tim”.hµ
"

62 
	~"commÚ.hµ
"

64 
	eDISTANCE_METRICS
{

65 
	mJACKARD
 = 0,

66 
	mAA
 = 1,

67 
	mRA
 = 2,

68 
	mPEARSON
 = 3,

69 
	mCOSINE
 = 4,

70 
	mCHEBYCHEV
 = 5,

71 
	mMANHATTEN
 = 6,

72 
	mTANIMOTO
 = 7,

73 
	mLOG_LIKELIHOOD
 = 8

76 
	gmš_®lowed_š‹r£ùiÚ
 = 1;

77 
size_t
 
	gwr™‹n_·œs
 = 0;

78 
size_t
 
	g™em_·œs_com·»d
 = 0;

79 
	g¡d
::
veùÜ
<
FILE
*> 
out_fes
;

80 
tim”
 
	gmytim”
;

81 
boŞ
 * 
	g»Ëvªt_™ems
 = 
NULL
;

82 
vec
 
	gm—n
;

83 
vec
 
	g¡ddev
;

84 
	gg¿bbed_edges
 = 0;

85 
	gdi¡ªû_m‘ric
;

86 
	gdebug
;

88 
boŞ
 
	$is_™em
(
vid_t
 
v
){  v >ğ
M
; 
	}
}

89 
boŞ
 
	$is_u£r
(
vid_t
 
v
){  v < 
M
; 
	}
}

95 
	tV”‹xD©aTy³
;

96 
	tEdgeD©aTy³
;

98 
	sv”‹x_d©a
{

99 
vec
 
	mpvec
;

100 
v”‹x_d©a
(){ }

102 
£t_v®
(
šdex
, 
v®
){

103 
	mpvec
[
šdex
] = 
v®
;

105 
g‘_v®
(
šdex
){

106  
	mpvec
[
šdex
];

109 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

110 
	~"io.hµ
"

116 
	sd’£_adj
 {

117 
¥¬£_vec
 
	medges
;

118 
d’£_adj
() { }

119 
š‹r£ù
(cÚ¡ 
d’£_adj
 & 
Ùh”
){

120 
¥¬£_vec
 
	mx1
 = 
edges
.
uÇryEx´
(
¡d
::
±r_fun
(
equ®_g»©”
));

121 
¥¬£_vec
 
	mx2
 = 
Ùh”
.
edges
.
uÇryEx´
(
¡d
::
±r_fun
(
equ®_g»©”
));

122 
¥¬£_vec
 
	mx3
 = 
x1
.
cwi£Produù
(
x2
);

123  
sum
(
x3
);

129 şas 
	cadjli¡_cÚš”
 {

130 
	m¡d
::
veùÜ
<
d’£_adj
> 
adjs
;

132 
	mpublic
:

133 
vid_t
 
pivÙ_¡
, 
	mpivÙ_’
;

135 
	$adjli¡_cÚš”
() {

136 ià(
debug
)

137 
¡d
::
cout
<<"£‰šg…ivÙ sˆªdƒndØ" << 
M
 << std::
’dl
;

138 
pivÙ_¡
 = 
M
;

139 
pivÙ_’
 = 
M
;

142 
	$ş—r
() {

143 
¡d
::
veùÜ
<
d’£_adj
>::
™”©Ü
 
™
=
adjs
.
	`begš
(); iˆ!ğadjs.
	`’d
(); ++it) {

144 ià(
	`Âz
(
™
->
edges
)) {

145 
™
->
edges
.
	`»size
(0);

148 
adjs
.
	`ş—r
();

149 ià(
debug
)

150 
¡d
::
cout
<<"£‰šg…ivÙ sˆtØ" << 
pivÙ_’
 << std::
’dl
;

151 
pivÙ_¡
 = 
pivÙ_’
;

152 
	}
}

157 
	$ex‹nd_pivÙ¿nge
(
vid_t
 
’
) {

158 
	`as£¹
(
’
>
pivÙ_’
);

159 
pivÙ_’
 = 
’
;

160 
adjs
.
	`»size
(
pivÙ_’
 - 
pivÙ_¡
);

161 
	}
}

166 
lßd_edges_što_memÜy
(
g¿phchi_v”‹x
<
ušt32_t
, > &
v
) {

170 
	gnum_edges
 = 
v
.
num_edges
();

172 ià(
	gnum_edges
 < 
	gmš_®lowed_š‹r£ùiÚ
){

173 
	g»Ëvªt_™ems
[
v
.
id
(è- 
M
] = 
çl£
;

177 
	g»Ëvªt_™ems
[
v
.
id
(è- 
M
] = 
Œue
;

180 
d’£_adj
 
	gdadj
;

181 
	gi
=0; i<
	gnum_edges
; i++)

182 
£t_Ãw
Ğ
dadj
.
edges
, 
v
.
edge
(
i
)->
v”‹x_id
(), v.edge(i)->
g‘_d©a
());

185 
	gadjs
[
v
.
id
(è- 
pivÙ_¡
] = 
dadj
;

186 
as£¹
(
v
.
id
(è- 
pivÙ_¡
 < 
adjs
.
size
());

187 
__sync_add_ªd_ãtch
(&
g¿bbed_edges
, 
num_edges
 );

188  
	gnum_edges
;

191 
	$acouÁ
(
vid_t
 
pivÙ
) {

192  
	`Âz
(
adjs
[
pivÙ
 - 
pivÙ_¡
].
edges
);

193 
	}
}

219 
ÿlc_di¡ªû
(
g¿phchi_v”‹x
<
ušt32_t
, > &
v
, 
vid_t
 
pivÙ
, 
di¡ªû_m‘ric
) {

222 
	gd’£_adj
 &
	gpivÙ_edges
 = 
adjs
[
pivÙ
 - 
pivÙ_¡
];

223 
	gnum_edges
 = 
v
.
num_edges
();

226 ià(
	gnum_edges
 < 
	gmš_®lowed_š‹r£ùiÚ
 || 
Âz
(
pivÙ_edges
.
edges
) < min_allowed_intersection)

229 
d’£_adj
 
	g™em_edges
;

230 
	gi
=0; i < 
	gnum_edges
; i++)

231 
£t_Ãw
(
™em_edges
.
edges
, 
v
.
edge
(
i
)->
v”‹xid
, v.edge(i)->
g‘_d©a
());

233 
	gš‹r£ùiÚ_size
 = 
™em_edges
.
š‹r£ù
(
pivÙ_edges
);

236 ià(
	gš‹r£ùiÚ_size
 < ()
	gmš_®lowed_š‹r£ùiÚ
)

239 ià(
	gdi¡ªû_m‘ric
 =ğ
PEARSON
){

240 ià(
debug
){

241 
¡d
::
cout
<< 
pivÙ
 -
M
+1<<" PivÙƒdges: " <<
pivÙ_edges
.
edges
 << std::
’dl
;

242 
	g¡d
::
cout
<< "Mšusm—n: " << 
mšus
(
pivÙ_edges
.
edges
,
m—n
è<< std::
’dl
;

243 
	g¡d
::
cout
<< 
v
.
id
(è-
M
+1<<"I‹mƒdges: " <<
™em_edges
.
edges
 << 
¡d
::
’dl
;

244 
	g¡d
::
cout
<< "Mšusm—n: " << 
mšus
(
™em_edges
.
edges
, 
m—n
è<< std::
’dl
;

246 
	gdi¡
 = 
mšus
(
pivÙ_edges
.
edges
, 
m—n
).
dÙ
(mšus(
™em_edges
.edges, mean));

247 ià(
	gdebug
)

248 
	g¡d
::
cout
<<"di¡ " << 
pivÙ
-
M
+1 << ":" << 
v
.
id
()-M+1 << " " << 
di¡
 << 
¡d
::
’dl
;

250  
	gdi¡
 / (
	g¡ddev
[
pivÙ
-
M
] * stddev[
v
.
id
()-M]);

252 ià(
	gdi¡ªû_m‘ric
 =ğ
TANIMOTO
){

253  
ÿlc_nimÙo_di¡ªû
(
pivÙ_edges
.
edges
,

254 
™em_edges
.
edges
,

255 
sum_sqr
(
pivÙ_edges
.
edges
),

256 
sum_sqr
(
™em_edges
.
edges
));

258 ià(
	gdi¡ªû_m‘ric
 =ğ
CHEBYCHEV
){

259  
ÿlc_chebychev_di¡ªû
(
pivÙ_edges
.
edges
,

260 
™em_edges
.
edges
);

262 ià(
	gdi¡ªû_m‘ric
 =ğ
LOG_LIKELIHOOD
){

263  
ÿlc_loglik–ihood_di¡ªû
(
pivÙ_edges
.
edges
,

264 
™em_edges
.
edges
,

265 
sum_sqr
(
pivÙ_edges
.
edges
),

266 
sum_sqr
(
™em_edges
.
edges
));

268 ià(
	gdi¡ªû_m‘ric
 =ğ
COSINE
){

269  
ÿlc_cosše_di¡ªû
(
pivÙ_edges
.
edges
,

270 
™em_edges
.
edges
,

271 
sum_sqr
(
pivÙ_edges
.
edges
),

272 
sum_sqr
(
™em_edges
.
edges
));

274 ià(
	gdi¡ªû_m‘ric
 ==
MANHATTEN
){

275  
ÿlc_mªh©‹n_di¡ªû
(
pivÙ_edges
.
edges
,

276 
™em_edges
.
edges
);

278  
	gNAN
;

281 
šlše
 
boŞ
 
	$is_pivÙ
(
vid_t
 
vid
) {

282  
vid
 >ğ
pivÙ_¡
 && vid < 
pivÙ_’
;

283 
	}
}

287 
adjli¡_cÚš”
 * 
	gadjcÚš”
;

289 
	gI‹mDi¡ªûProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

295 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

296 ià(
	gdebug
)

297 
´štf
("EÁ”ed i‹¿tiÚ %d w™h %d\n", 
gcÚ‹xt
.
™”©iÚ
, 
v
.
id
());

300 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0){

301 ià(
is_™em
(
v
.
id
())){

302 
i
=0; 
	gi
<
	gv
.
num_edges
(); i++) {

303 
	gg¿phchi_edge
<> * 
	ge
 = 
v
.
edge
(
i
);

304 
vid_t
 
	gu£r
 = 
e
->
v”‹xid
;

305 
	gm—n
[
u£r
] +ğ
e
->
g‘_d©a
(è/ ()
N
;

310 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 1){

311 ià(
is_™em
(
v
.
id
())){

312 
d’£_adj
 
™em_edges
;

313 
	gi
=0; i < 
	gv
.
num_edges
(); i++)

314 
£t_Ãw
(
™em_edges
.
edges
, 
v
.
edge
(
i
)->
v”‹xid
, v.edge(i)->
g‘_d©a
());

315 
	g¡ddev
[
v
.
id
(è- 
M
] = 
sum
(
mšus
(
™em_edges
.
edges
, 
m—n
).
¬¿y
().
pow
(2)è/ (
	gM
-1.0);

316 ià(
	gdebug
)

317 
	g¡d
::
cout
<<"™em: " << 
v
.
id
(è- 
M
+1 << " stddev: " << 
¡ddev
[v.id(è- M] << 
¡d
::
’dl
;

325 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0) {

326 ià(
adjcÚš”
->
is_pivÙ
(
v
.
id
()è&& 
is_™em
(v.id())){

327 
adjcÚš”
->
lßd_edges_što_memÜy
(
v
);

328 ià(
	gdebug
)

329 
´štf
("Lßdšg…ivÙ %d iÁrØmemÜy\n", 
v
.
id
());

331 ià(
is_u£r
(
v
.
id
())){

333 
boŞ
 
	ghas_pivÙ
 = 
çl£
;

334 
	gpivÙ
 = -1;

335 
	gi
=0; i<
	gv
.
num_edges
(); i++) {

336 
	gg¿phchi_edge
<> * 
	ge
 = 
v
.
edge
(
i
);

338 ià(
	gadjcÚš”
->
is_pivÙ
(
e
->
v”‹xid
è&& 
	g»Ëvªt_™ems
[e->v”‹xid-
M
]) {

339 
	ghas_pivÙ
 = 
Œue
;

340 
	gpivÙ
 = 
e
->
v”‹xid
;

344 ià(
	gdebug
)

345 
´štf
("u£¸%d i lškedØpivÙ %d\n", 
v
.
id
(), 
pivÙ
);

346 ià(!
	ghas_pivÙ
)

351 
	gi
=0; i<
	gv
.
num_edges
(); i++) {

352 
	gg¿phchi_edge
<> * 
	ge
 = 
v
.
edge
(
i
);

354 
	g»Ëvªt_™ems
[
e
->
v”‹xid
 - 
M
] = 
Œue
;

363 ià(!
	g»Ëvªt_™ems
[
v
.
id
(è- 
M
]){

367 
vid_t
 
	gi
=
adjcÚš”
->
pivÙ_¡
; i< 
	gadjcÚš”
->
	gpivÙ_’
; i++){

369 ià(
	gi
 >ğ
v
.
id
(è|| (!
»Ëvªt_™ems
[
i
-
M
]))

372 
	gdi¡
 = 
adjcÚš”
->
ÿlc_di¡ªû
(
v
, 
i
, 
di¡ªû_m‘ric
);

373 
	g™em_·œs_com·»d
++;

374 ià(
	g™em_·œs_com·»d
 % 1000000 == 0)

375 
log¡»am
(
LOG_INFO
)<< 
¡d
::
£tw
(10è<< 
mytim”
.
cu¼’t_time
(è<< "è " << std::£tw(10è<< 
™em_·œs_com·»d
 << "…aœ com·»d " << std::
’dl
;

376 ià(
	gdebug
)

377 
´štf
("com·ršg %dØpivÙ %d di¡ªû i %lg\n", 
i
 - 
M
 + 1, 
v
.
id
(è- M + 1, 
di¡
);

378 ià(
	gdi¡
 != 0){

379 
årštf
(
out_fes
[
omp_g‘_th»ad_num
()], "%u %u %lg\n", 
v
.
id
()-
M
+1, 
i
-M+1, ()
di¡
);

382 
	gwr™‹n_·œs
++;

393 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

394 
	ggcÚ‹xt
.
	gscheduËr
->
»move_sks
(0, (è
gcÚ‹xt
.
nv”tiûs
 - 1);

395 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0){

396 
mem£t
(
»Ëvªt_™ems
, 0, (
boŞ
)*
N
);

397 
vid_t
 
	gi
=0; i < 
	gM
+
	gN
; i++){

398 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
i
);

400 ià(
	gdebug
)

401 
´štf
("scheduling‡ll‚odes, setting„elevant_itemso zero\n");

402 
	gg¿bbed_edges
 = 0;

403 
	gadjcÚš”
->
ş—r
();

405 
vid_t
 
	gi
=
M
; i < 
	gM
+
	gN
; i++){

406 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
i
);

414 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

415 ià(
	gdebug
 && 
	ggcÚ‹xt
.
	g™”©iÚ
 == 0)

416 
¡d
::
cout
<<"M—À: " << 
m—n
 << std::
’dl
;

426 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

429 ià((
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 =ğ0è&& (
gcÚ‹xt
.
™”©iÚ
 >= 2)) {

430 ià(
debug
){

431 
´štf
("’‹ršg i‹¿tiÚ: %d oÀbefÜe_exec_š‹rv®\n", 
gcÚ‹xt
.
™”©iÚ
);

432 
´štf
("pivÙ_¡ i %d wšdow_’ %d\n", 
adjcÚš”
->
pivÙ_¡
, 
wšdow_’
);

434 ià(
	gadjcÚš”
->
	gpivÙ_¡
 <ğ
wšdow_’
) {

435 
size_t
 
max_g¿b_edges
 = 
g‘_İtiÚ_lÚg
("membudget_mb", 1024) * 1024 * 1024 / 8;

436 ià(
	gg¿bbed_edges
 < 
	gmax_g¿b_edges
 * 0.8) {

437 
log¡»am
(
LOG_DEBUG
è<< "Wšdow in™, g¿bbed: " << 
	gg¿bbed_edges
 << "ƒdges" << "ƒx‹ndšg…ivÜ_¿ngtØ: " << 
	gwšdow_’
 + 1 << 
	g¡d
::
’dl
;

438 
	gadjcÚš”
->
ex‹nd_pivÙ¿nge
(
wšdow_’
 + 1);

439 
log¡»am
(
LOG_DEBUG
è<< "WšdowƒÀis: " << 
	gwšdow_’
 << " v”tiûs: " << 
	ggcÚ‹xt
.
	gnv”tiûs
 << 
	g¡d
::
’dl
;

440 ià(
	gwšdow_’
+1 =ğ
gcÚ‹xt
.
nv”tiûs
) {

442 
log¡»am
(
LOG_DEBUG
)<<"S‘tšg†a¡ i‹¿tiÚo: " << 
gcÚ‹xt
.
™”©iÚ
 + 2 << 
¡d
::
’dl
;

443 
	ggcÚ‹xt
.
£t_Ï¡_™”©iÚ
(
gcÚ‹xt
.
™”©iÚ
 + 2);

446 
log¡»am
(
LOG_DEBUG
è<< "ToØmªyƒdges,‡Ì—dy g¿bbed: " << 
	gg¿bbed_edges
 << 
	g¡d
::
’dl
;

456 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

457 
	`´št_cİyright
();

461 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

465 
m‘rics
 
	`m
("item-cf2");

467 
mš_®lowed_š‹r£ùiÚ
 = 
	`g‘_İtiÚ_št
("min_allowed_intersection", min_allowed_intersection);

469 
di¡ªû_m‘ric
 = 
	`g‘_İtiÚ_št
("di¡ªû", 
PEARSON
);

470 ià(
di¡ªû_m‘ric
 !ğ
PEARSON
 && di¡ªû_m‘riø!ğ
MANHATTEN
 && di¡ªû_m‘riø!ğ
COSINE
 &&

471 
di¡ªû_m‘ric
 !ğ
CHEBYCHEV
 && di¡ªû_m‘riø!ğ
LOG_LIKELIHOOD
 && di¡ªû_m‘riø!ğ
TANIMOTO
)

472 
	`log¡»am
(
LOG_FATAL
)<<"--di¡ªû_m‘rix=XX should bÚof: 3=PEARSON, 4=COSINE, 5=CHEBYCHEV, 6=MANHATTEN, 7=TANIMOTO, 8=LOG_LIKELIHOOD" << 
¡d
::
’dl
;

473 
debug
 = 
	`g‘_İtiÚ_št
("debug", 0);

474 
	`·r£_commªd_lše_¬gs
();

479 
mytim”
.
	`¡¬t
();

480 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
Œaššg
 );

482 
	`as£¹
(
M
 > 0 && 
N
 > 0);

485 
adjcÚš”
 = 
Ãw
 
	`adjli¡_cÚš”
();

487 
»Ëvªt_™ems
 = 
Ãw
 
boŞ
[
N
];

488 
m—n
 = 
vec
::
	`Z”o
(
M
);

489 
¡ddev
 = 
vec
::
	`Z”o
(
N
);

492 
I‹mDi¡ªûProg¿m
 
´og¿m
;

493 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
 ,
nsh¬ds
, 
Œue
, 
m
);

494 
	`£t_’gše_æags
(
’gše
);

497 
out_fes
.
	`»size
(
	`numb”_of_omp_th»ads
());

498 
ušt
 
i
=0; i< 
out_fes
.
	`size
(); i++){

499 
buf
[256];

500 
	`¥rštf
(
buf
, "%s.out%d", 
Œaššg
.
	`c_¡r
(), 
i
);

501 
out_fes
[
i
] = 
	`İ’_fe
(
buf
, "w");

505 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

508 ià(!
qu›t
)

509 
	`m‘rics_»pÜt
(
m
);

511 
¡d
::
cout
<<"TÙ® i‹m…aœ com·»d: " << 
™em_·œs_com·»d
 << "Ù® wr™‹ÀtØfe: " << 
wr™‹n_·œs
 << std::
’dl
;

513 
ušt
 
i
=0; i< 
out_fes
.
	`size
(); i++)

514 
	`fşo£
(
out_fes
[
i
]);

516 
¡d
::
cout
<<"C»©ed ouuˆfe w™hhfÜm©: " << 
Œaššg
 << ".outXX, wh”XX i thouuˆth»ad‚umb”" << std::
’dl
;

518 
d–‘e
[] 
»Ëvªt_™ems
;

520 
	}
}

	@toolkits/collaborative_filtering/itemcf3.cpp

52 
	~<¡ršg
>

53 
	~<veùÜ
>

54 
	~<®gÜ™hm
>

55 
	~<iomª
>

56 
	~<£t
>

57 
	~<io¡»am
>

58 
	~"eig’_w¿µ”.hµ
"

59 
	~"di¡ªû.hµ
"

60 
	~"ut.hµ
"

61 
	~"tim”.hµ
"

62 
	~"commÚ.hµ
"

64 
	eDISTANCE_METRICS
{

65 
	mJACKARD
 = 0,

66 
	mAA
 = 1,

67 
	mRA
 = 2,

68 
	mPEARSON
 = 3,

69 
	mCOSINE
 = 4,

70 
	mCHEBYCHEV
 = 5,

71 
	mMANHATTEN
 = 6,

72 
	mTANIMOTO
 = 7,

73 
	mLOG_LIKELIHOOD
 = 8,

74 
	mJACCARD_WEIGHT
 = 9

77 
	gmš_®lowed_š‹r£ùiÚ
 = 1;

78 
size_t
 
	gwr™‹n_·œs
 = 0;

79 
size_t
 
	g™em_·œs_com·»d
 = 0;

80 
	g¡d
::
veùÜ
<
FILE
*> 
out_fes
;

81 
tim”
 
	gmytim”
;

82 
vec
 
	gm—n
;

83 
vec
 
	g¡ddev
;

84 
	gg¿bbed_edges
 = 0;

85 
	gdi¡ªû_m‘ric
;

86 
	gdebug
;

88 
boŞ
 
	$is_™em
(
vid_t
 
v
){  
M
 =ğ
N
 ? 
Œue
 : v >ğM; 
	}
}

89 
boŞ
 
	$is_u£r
(
vid_t
 
v
){  v < 
M
; 
	}
}

95 
	tV”‹xD©aTy³
;

96 
	tEdgeD©aTy³
;

98 
	sv”‹x_d©a
{

99 
vec
 
	mpvec
;

100 
v”‹x_d©a
(){ }

102 
£t_v®
(
šdex
, 
v®
){

103 
	mpvec
[
šdex
] = 
v®
;

105 
g‘_v®
(
šdex
){

106  
	mpvec
[
šdex
];

109 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

110 
	~"io.hµ
"

116 
	sd’£_adj
 {

117 
¥¬£_vec
 
	medges
;

118 
d’£_adj
() { }

119 
š‹r£ù
(cÚ¡ 
d’£_adj
 & 
Ùh”
){

120 
¥¬£_vec
 
	mx1
 = 
edges
.
uÇryEx´
(
¡d
::
±r_fun
(
equ®_g»©”
));

121 
¥¬£_vec
 
	mx2
 = 
Ùh”
.
edges
.
uÇryEx´
(
¡d
::
±r_fun
(
equ®_g»©”
));

122 
¥¬£_vec
 
	mx3
 = 
x1
.
cwi£Produù
(
x2
);

123  
sum
(
x3
);

129 şas 
	cadjli¡_cÚš”
 {

131 
	mpublic
:

132 
¡d
::
veùÜ
<
d’£_adj
> 
adjs
;

133 
vid_t
 
	mpivÙ_¡
, 
	mpivÙ_’
;

135 
	$adjli¡_cÚš”
() {

136 ià(
debug
)

137 
¡d
::
cout
<<"£‰šg…ivÙ sˆªdƒndØ" << 
M
 << std::
’dl
;

138 ià(
di¡ªû_m‘ric
 =ğ
JACCARD_WEIGHT
){

139 
pivÙ_¡
 = 0;

140 
pivÙ_’
 = 0;

143 
pivÙ_¡
 = 
M
;

144 
pivÙ_’
 = 
M
;

148 
	$ş—r
() {

149 
¡d
::
veùÜ
<
d’£_adj
>::
™”©Ü
 
™
=
adjs
.
	`begš
(); iˆ!ğadjs.
	`’d
(); ++it) {

150 ià(
	`Âz
(
™
->
edges
)) {

151 
™
->
edges
.
	`»size
(0);

154 
adjs
.
	`ş—r
();

155 ià(
debug
)

156 
¡d
::
cout
<<"£‰šg…ivÙƒndØ" << 
pivÙ_’
 << std::
’dl
;

157 
pivÙ_¡
 = 
pivÙ_’
;

158 
	}
}

163 
	$ex‹nd_pivÙ¿nge
(
vid_t
 
’
) {

164 
	`as£¹
(
’
>
pivÙ_’
);

165 
pivÙ_’
 = 
’
;

166 
adjs
.
	`»size
(
pivÙ_’
 - 
pivÙ_¡
);

167 
	}
}

172 
lßd_edges_što_memÜy
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v
) {

176 
	gnum_edges
 = 
v
.
num_edges
();

178 ià(
	gnum_edges
 < 
	gmš_®lowed_š‹r£ùiÚ
){

179 ià(
	gdebug
)

180 
log¡»am
(
LOG_DEBUG
)<<"Skpšg sšû‚umƒdges: " << 
	gnum_edges
 << 
	g¡d
::
’dl
;

186 
d’£_adj
 
	gdadj
;

187 
	gi
=0; i<
	gnum_edges
; i++)

188 
£t_Ãw
Ğ
dadj
.
edges
, 
v
.
edge
(
i
)->
v”‹x_id
(), v.edge(i)->
g‘_d©a
());

191 
	gadjs
[
v
.
id
(è- 
pivÙ_¡
] = 
dadj
;

192 
as£¹
(
v
.
id
(è- 
pivÙ_¡
 < 
adjs
.
size
());

193 
__sync_add_ªd_ãtch
(&
g¿bbed_edges
, 
num_edges
 );

194  
	gnum_edges
;

197 
	$acouÁ
(
vid_t
 
pivÙ
) {

198  
	`Âz
(
adjs
[
pivÙ
 - 
pivÙ_¡
].
edges
);

199 
	}
}

228 
ÿlc_di¡ªû
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v
, 
vid_t
 
pivÙ
, 
di¡ªû_m‘ric
) {

231 
	gd’£_adj
 &
	gpivÙ_edges
 = 
adjs
[
pivÙ
 - 
pivÙ_¡
];

232 
	gnum_edges
 = 
v
.
num_edges
();

234 
d’£_adj
 
	g™em_edges
;

235 
	gi
=0; i < 
	gnum_edges
; i++){

236 
£t_Ãw
(
™em_edges
.
edges
, 
v
.
edge
(
i
)->
v”‹xid
, v.edge(i)->
g‘_d©a
());

239 ià(
	gdi¡ªû_m‘ric
 =ğ
JACCARD_WEIGHT
){

240  
ÿlc_jacÿrd_weight_di¡ªû
(
pivÙ_edges
.
edges
, 
™em_edges
.edges, 
g‘_v®
ĞpivÙ_edges.edges, 
v
.
id
()), 0);

242  
	gNAN
;

245 
šlše
 
boŞ
 
	$is_pivÙ
(
vid_t
 
vid
) {

246  
vid
 >ğ
pivÙ_¡
 && vid < 
pivÙ_’
;

247 
	}
}

251 
adjli¡_cÚš”
 * 
	gadjcÚš”
;

253 
	gI‹mDi¡ªûProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

259 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

260 ià(
	gdebug
)

261 
´štf
("EÁ”ed i‹¿tiÚ %d w™h %d -ƒdge %d\n", 
gcÚ‹xt
.
™”©iÚ
, 
v
.
id
(), v.
num_edges
());

267 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0) {

268 ià(
adjcÚš”
->
is_pivÙ
(
v
.
id
())){

269 
adjcÚš”
->
lßd_edges_što_memÜy
(
v
);

270 ià(
	gdebug
)

271 
´štf
("Lßdšg…ivÙ %d iÁrØmemÜy\n", 
v
.
id
());

276 
vid_t
 
	gi
=
adjcÚš”
->
pivÙ_¡
; i< 
	gadjcÚš”
->
	gpivÙ_’
; i++){

278 ià(
	gi
 >ğ
v
.
id
())

281 
	gd’£_adj
 &
	gpivÙ_edges
 = 
adjcÚš”
->
adjs
[
i
 -‡djcÚš”->
pivÙ_¡
];

283 ià(
g‘_v®
(
pivÙ_edges
.
edges
, 
v
.
id
()) == 0)

286 
	gdi¡
 = 
adjcÚš”
->
ÿlc_di¡ªû
(
v
, 
i
, 
di¡ªû_m‘ric
);

287 
	g™em_·œs_com·»d
++;

288 ià(
	g™em_·œs_com·»d
 % 1000000 == 0)

289 
log¡»am
(
LOG_INFO
)<< 
¡d
::
£tw
(10è<< 
mytim”
.
cu¼’t_time
(è<< "è " << std::£tw(10è<< 
™em_·œs_com·»d
 << "…aœ com·»d " << std::
’dl
;

290 ià(
	gdebug
)

291 
´štf
("com·ršg %dØpivÙ %d di¡ªû i %lg\n", 
i
+ 1, 
v
.
id
(è+ 1, 
di¡
);

292 ià(
	gdi¡
 != 0){

293 
årštf
(
out_fes
[
omp_g‘_th»ad_num
()], "%u %u %lg\n", 
v
.
id
()+1, 
i
+1, ()
di¡
);

296 
	gwr™‹n_·œs
++;

307 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

308 
	ggcÚ‹xt
.
	gscheduËr
->
»move_sks
(0, (è
gcÚ‹xt
.
nv”tiûs
 - 1);

309 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0){

310 
vid_t
 
i
=0; 
	gi
 < 
	gM
; i++){

311 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
i
);

313 
	gg¿bbed_edges
 = 0;

314 
	gadjcÚš”
->
ş—r
();

316 
vid_t
 
	gi
=0; i< 
	gM
; i++){

317 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
i
);

325 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

335 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

338 ià((
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0)) {

339 ià(
debug
){

340 
´štf
("’‹ršg i‹¿tiÚ: %d oÀbefÜe_exec_š‹rv®\n", 
gcÚ‹xt
.
™”©iÚ
);

341 
´štf
("pivÙ_¡ i %d wšdow_’ %d\n", 
adjcÚš”
->
pivÙ_¡
, 
wšdow_’
);

343 ià(
	gadjcÚš”
->
	gpivÙ_¡
 <ğ
wšdow_’
) {

344 
size_t
 
max_g¿b_edges
 = 
g‘_İtiÚ_lÚg
("membudget_mb", 1024) * 1024 * 1024 / 8;

345 ià(
	gg¿bbed_edges
 < 
	gmax_g¿b_edges
 * 0.8) {

346 
log¡»am
(
LOG_DEBUG
è<< "Wšdow in™, g¿bbed: " << 
	gg¿bbed_edges
 << "ƒdges" << "ƒx‹ndšg…ivÜ_¿ngtØ: " << 
	gwšdow_’
 + 1 << 
	g¡d
::
’dl
;

347 
	gadjcÚš”
->
ex‹nd_pivÙ¿nge
(
wšdow_’
 + 1);

348 
log¡»am
(
LOG_DEBUG
è<< "WšdowƒÀis: " << 
	gwšdow_’
 << " v”tiûs: " << 
	ggcÚ‹xt
.
	gnv”tiûs
 << 
	g¡d
::
’dl
;

349 ià(
	gwšdow_’
+1 =ğ
gcÚ‹xt
.
nv”tiûs
) {

351 
log¡»am
(
LOG_DEBUG
)<<"S‘tšg†a¡ i‹¿tiÚo: " << 
gcÚ‹xt
.
™”©iÚ
 + 2 << 
¡d
::
’dl
;

352 
	ggcÚ‹xt
.
£t_Ï¡_™”©iÚ
(
gcÚ‹xt
.
™”©iÚ
 + 2);

355 
log¡»am
(
LOG_DEBUG
è<< "ToØmªyƒdges,‡Ì—dy g¿bbed: " << 
	gg¿bbed_edges
 << 
	g¡d
::
’dl
;

365 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

366 
	`´št_cİyright
();

370 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

374 
m‘rics
 
	`m
("item-cf2");

376 
mš_®lowed_š‹r£ùiÚ
 = 
	`g‘_İtiÚ_št
("min_allowed_intersection", min_allowed_intersection);

378 
di¡ªû_m‘ric
 = 
	`g‘_İtiÚ_št
("di¡ªû", 
JACCARD_WEIGHT
);

379 ià(
di¡ªû_m‘ric
 !ğ
JACCARD_WEIGHT
)

380 
	`log¡»am
(
LOG_FATAL
)<<"--di¡ªû_m‘rix=XX should bÚof:9ğJACCARD_WEIGHT" << 
¡d
::
’dl
;

381 
debug
 = 
	`g‘_İtiÚ_št
("debug", 0);

382 
	`·r£_commªd_lše_¬gs
();

387 
mytim”
.
	`¡¬t
();

388 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
Œaššg
, 
NULL
, 0, 0, 3, 
TRAINING
, 
Œue
);

390 
	`as£¹
(
M
 > 0 && 
N
 > 0);

393 
adjcÚš”
 = 
Ãw
 
	`adjli¡_cÚš”
();

396 
I‹mDi¡ªûProg¿m
 
´og¿m
;

397 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
 ,
nsh¬ds
, 
Œue
, 
m
);

398 
	`£t_’gše_æags
(
’gše
);

401 
out_fes
.
	`»size
(
	`numb”_of_omp_th»ads
());

402 
ušt
 
i
=0; i< 
out_fes
.
	`size
(); i++){

403 
buf
[256];

404 
	`¥rštf
(
buf
, "%s.out%d", 
Œaššg
.
	`c_¡r
(), 
i
);

405 
out_fes
[
i
] = 
	`İ’_fe
(
buf
, "w");

409 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

412 ià(!
qu›t
)

413 
	`m‘rics_»pÜt
(
m
);

415 
¡d
::
cout
<<"TÙ® i‹m…aœ com·»d: " << 
™em_·œs_com·»d
 << "Ù® wr™‹ÀtØfe: " << 
wr™‹n_·œs
 << std::
’dl
;

417 
ušt
 
i
=0; i< 
out_fes
.
	`size
(); i++)

418 
	`fşo£
(
out_fes
[
i
]);

420 
¡d
::
cout
<<"C»©ed ouuˆfe w™hhfÜm©: " << 
Œaššg
 << ".outXX, wh”XX i thouuˆth»ad‚umb”" << std::
’dl
;

423 
	}
}

	@toolkits/collaborative_filtering/itemsim2rating.cpp

30 
	~<¡ršg
>

31 
	~<veùÜ
>

32 
	~<®gÜ™hm
>

33 
	~<iomª
>

34 
	~<£t
>

35 
	~<io¡»am
>

36 
	~"eig’_w¿µ”.hµ
"

37 
	~"di¡ªû.hµ
"

38 
	~"ut.hµ
"

39 
	~"tim”.hµ
"

40 
	~"commÚ.hµ
"

43 
	gmš_®lowed_š‹r£ùiÚ
 = 1;

44 
size_t
 
	gwr™‹n_·œs
 = 0;

45 
size_t
 
	g™em_·œs_com·»d
 = 0;

46 
FILE
 * 
	gout_fe
;

47 
tim”
 
	gmytim”
;

48 
boŞ
 * 
	g»Ëvªt_™ems
 = 
NULL
;

49 
	gg¿bbed_edges
 = 0;

50 
	gdi¡ªû_m‘ric
;

51 
	gdebug
;

52 
	gundœeùed
 = 0;

53 
	gQ
 = 3;

54 
boŞ
 
	$is_™em
(
vid_t
 
v
){  v >ğ
M
; 
	}
}

55 
boŞ
 
	$is_u£r
(
vid_t
 
v
){  v < 
M
; 
	}
}

61 
	tV”‹xD©aTy³
;

63 
	sedge_d©a
{

64 
	mup_weight
;

65 
	mdown_weight
;

66 
edge_d©a
(){ 
	mup_weight
 = 0; 
	mdown_weight
 = 0; }

67 
edge_d©a
(
up_weight
, 
down_weight
) : up_weight(up_weight), down_weight(down_weight) { };

70 
edge_d©a
 
	tEdgeD©aTy³
;

72 
	sv”‹x_d©a
{

73 
vec
 
	mpvec
;

74 
v”‹x_d©a
(){ }

76 
£t_v®
(
šdex
, 
v®
){

77 
	mpvec
[
šdex
] = 
v®
;

79 
g‘_v®
(
šdex
){

80  
	mpvec
[
šdex
];

83 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

84 
	~"io.hµ
"

86 
	sd’£_adj
 {

87 
¥¬£_vec
 
	medges
;

88 
¥¬£_vec
 
	m¿tšgs
;

89 
mu‹x
 
	mmymu‹x
;

90 
d’£_adj
() { }

93 
boŞ
 
fšd_twiû
(
¡d
::
veùÜ
<
vid_t
>& 
edges
, vid_ˆ
v®
){

94 
	g»t
 = 0;

95 
	gi
=0; i < 
	gedges
.
size
(); i++){

96 ià(
	gedges
[
i
] =ğ
v®
)

97 
»t
++;

99 
as£¹
(
»t
 >= 0 &&„et <= 2);

100  (
	g»t
 == 2);

103 şas 
	cadjli¡_cÚš”
 {

104 
	mpublic
:

105 
¡d
::
veùÜ
<
d’£_adj
> 
adjs
;

106 
vid_t
 
	mpivÙ_¡
, 
	mpivÙ_’
;

108 
	$adjli¡_cÚš”
() {

109 ià(
debug
)

110 
¡d
::
cout
<<"£‰šg…ivÙ sˆªdƒndØ" << 0 << std::
’dl
;

111 
pivÙ_¡
 = 0;

112 
pivÙ_’
 = 0;

115 
	$ş—r
() {

116 
¡d
::
veùÜ
<
d’£_adj
>::
™”©Ü
 
™
=
adjs
.
	`begš
(); iˆ!ğadjs.
	`’d
(); ++it) {

117 ià(
	`Âz
(
™
->
edges
)) {

118 
™
->
edges
.
	`»size
(0);

120 
™
->
¿tšgs
.
	`»size
(0);

122 
adjs
.
	`ş—r
();

123 ià(
debug
)

124 
¡d
::
cout
<<"£‰šg…ivÙ sˆtØ" << 
pivÙ_’
 << std::
’dl
;

125 
pivÙ_¡
 = 
pivÙ_’
;

126 
	}
}

131 
	$ex‹nd_pivÙ¿nge
(
vid_t
 
’
) {

132 
	`as£¹
(
’
>
pivÙ_’
);

133 
	`as£¹
(
’
 > 
pivÙ_¡
);

134 
pivÙ_’
 = 
’
;

135 
adjs
.
	`»size
(
pivÙ_’
 - 
pivÙ_¡
);

138 
	}
}

143 
lßd_edges_što_memÜy
(
g¿phchi_v”‹x
<
ušt32_t
, 
EdgeD©aTy³
> &
v
) {

144 
as£¹
(
is_pivÙ
(
v
.
id
()));

145 
as£¹
(
is_u£r
(
v
.
id
()));

147 
	gnum_edges
 = 
v
.
num_edges
();

149 
d’£_adj
 
	gdadj
;

150 
	gi
=0; i<
	gnum_edges
; i++)

151 
£t_Ãw
Ğ
dadj
.
edges
, 
v
.
edge
(
i
)->
v”‹x_id
(), v.edge(i)->
g‘_d©a
().
up_weight
);

153 
	gadjs
[
v
.
id
(è- 
pivÙ_¡
] = 
dadj
;

154 
as£¹
(
v
.
id
(è- 
pivÙ_¡
 < 
adjs
.
size
());

155 
__sync_add_ªd_ãtch
(&
g¿bbed_edges
, 
num_edges
 );

156  
	gnum_edges
;

164 
compu‹_¿tšgs
(
g¿phchi_v”‹x
<
ušt32_t
, 
EdgeD©aTy³
> &
™em
, 
vid_t
 
u£r_pivÙ
, 
di¡ªû_m‘ric
) {

165 
as£¹
(
is_pivÙ
(
u£r_pivÙ
));

167 
	gd’£_adj
 &
	gpivÙ_edges
 = 
adjs
[
u£r_pivÙ
 - 
pivÙ_¡
];

169 ià(!
g‘_v®
(
pivÙ_edges
.
edges
, 
™em
.
id
())){

170 ià(
	gdebug
)

171 
log¡»am
(
LOG_DEBUG
)<<"Skpšg i‹m…ivÙ…aœ sšû‚Ù cÚÃùed!" << 
	g™em
.
id
(è<< 
	g¡d
::
’dl
;

175 
	gnum_edges
 = 
™em
.
num_edges
();

176 ià(
	gdebug
)

177 
log¡»am
(
LOG_DEBUG
)<<"Found " << 
	gnum_edges
 << "ƒdge äom i‹m : " << 
	g™em
.
id
(è<< 
	g¡d
::
’dl
;

180 ià(
	gnum_edges
 < 
	gmš_®lowed_š‹r£ùiÚ
 || 
Âz
(
pivÙ_edges
.
edges
) < min_allowed_intersection){

181 ià(
	gdebug
)

182 
log¡»am
(
LOG_DEBUG
)<<"skpšg i‹m…ivÙ…aœ sšû < mš_®lowed_š‹r£ùiÚ" << 
	g¡d
::
’dl
;

186 
	g¡d
::
veùÜ
<
vid_t
> 
edges
;

187 
	gi
=0; i < 
	gnum_edges
; i++){

188 ià(
is_™em
(
™em
.
edge
(
i
)->
v”‹x_id
()))

189 
	gedges
.
push_back
(
™em
.
edge
(
i
)->
v”‹x_id
());

191 
	g¡d
::
sÜt
(
edges
.
d©a
(),ƒdges.d©a()+edges.
size
());

194 
	gi
=0; i < 
	gnum_edges
; i++){

195 
vid_t
 
	gÙh”_™em
 = 
™em
.
edge
(
i
)->
v”‹x_id
();

196 
boŞ
 
	gup
 = 
™em
.
id
(è< 
Ùh”_™em
;

197 ià(
	gdebug
)

198 
log¡»am
(
LOG_DEBUG
)<<"Checkšg‚owƒdge: " << 
	gÙh”_™em
 << 
	g¡d
::
’dl
;

200 ià(
is_u£r
(
Ùh”_™em
)){

201 ià(
	gdebug
)

202 
log¡»am
(
LOG_DEBUG
)<<"skpšgƒdgtØu£¸" << 
	gÙh”_™em
 << 
	g¡d
::
’dl
;

206 ià(!
	gundœeùed
 && ((!
	gup
 && 
	g™em
.
edge
(
i
)->
g‘_d©a
().
	gup_weight
 == 0) ||

207 (
up
 && 
™em
.
edge
(
i
)->
g‘_d©a
().
down_weight
 == 0))){

208 ià(
debug
)

209 
log¡»am
(
LOG_DEBUG
)<<"skpšgƒdgw™h wrÚg dœeùiÚØ" << 
Ùh”_™em
 << 
¡d
::
’dl
;

213 ià(
g‘_v®
(
pivÙ_edges
.
edges
, 
Ùh”_™em
)){

214 ià(
	gdebug
)

215 
log¡»am
(
LOG_DEBUG
)<<"skpšgƒdgtØ" << 
	gÙh”_™em
 << " beÿu£‡Ì‹ady cÚÃùedØpivÙ" << 
	g¡d
::
’dl
;

219 
as£¹
(
g‘_v®
(
pivÙ_edges
.
edges
, 
™em
.
id
()) != 0);

220 
	gweight
 = 
¡d
::
max
(
™em
.
edge
(
i
)->
g‘_d©a
().
down_weight
, i‹m.edge(i)->g‘_d©a().
up_weight
);

221 
as£¹
(
weight
 != 0);

223 ià(
	gundœeùed
 || 
fšd_twiû
(
edges
, 
Ùh”_™em
)){

225 
	gpivÙ_edges
.
	gmymu‹x
.
lock
();

226 
£t_v®
(
pivÙ_edges
.
¿tšgs
, 
Ùh”_™em
-
M
, 
g‘_v®
ÕivÙ_edges.¿tšgs, oth”_™em-Mè+ 
pow
(
weight
,
Q
) );

227 
	gpivÙ_edges
.
	gmymu‹x
.
uÆock
();

228 ià(
	gdebug
)

229 
log¡»am
(
LOG_DEBUG
)<<"Addšg weight: " << 
	gweight
 << "Ø™em: " << 
	gÙh”_™em
-
	gM
+1 << " fÜ u£r: " << 
	gu£r_pivÙ
+1<<
	g¡d
::
’dl
;

233 ià(
	gdebug
)

234 
log¡»am
(
LOG_DEBUG
)<<"Fšished u£¸pivÙ " << 
	gu£r_pivÙ
 << 
	g¡d
::
’dl
;

238 
šlše
 
boŞ
 
	$is_pivÙ
(
vid_t
 
vid
) {

239  
vid
 >ğ
pivÙ_¡
 && vid < 
pivÙ_’
;

240 
	}
}

244 
adjli¡_cÚš”
 * 
	gadjcÚš”
;

246 
	gI‹mDi¡ªûProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

251 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

252 ià(
	gdebug
)

253 
´štf
("EÁ”ed i‹¿tiÚ %d w™h %d\n", 
gcÚ‹xt
.
™”©iÚ
, 
is_™em
(
v
.
id
()è? (v.id(è- 
M
 + 1): v.id());

259 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0) {

260 ià(
adjcÚš”
->
is_pivÙ
(
v
.
id
()è&& 
is_u£r
(v.id())){

261 
adjcÚš”
->
lßd_edges_što_memÜy
(
v
);

262 ià(
	gdebug
)

263 
´štf
("Lßdšg…ivÙ %d iÁrØmemÜy\n", 
v
.
id
());

271 
as£¹
(
is_™em
(
v
.
id
()));

273 
	gi
=0; i< 
	gv
.
num_edges
(); i++){

274 ià(!
is_u£r
(
v
.
edge
(
i
)->
v”‹x_id
()è|| !
	gadjcÚš”
->
is_pivÙ
(v.edge(i)->vertex_id()))

276 ià(
	gdebug
)

277 
´štf
("com·ršg u£¸pivÙ %dØ™em %d\n", 
v
.
edge
(
i
)->
v”‹x_id
()+1 , v.
id
(è- 
M
 + 1);

279 
	gadjcÚš”
->
compu‹_¿tšgs
(
v
, v.
edge
(
i
)->
v”‹x_id
(), 
di¡ªû_m‘ric
);

280 
	g™em_·œs_com·»d
++;

281 ià(
	g™em_·œs_com·»d
 % 1000000 == 0)

282 
log¡»am
(
LOG_INFO
)<< 
¡d
::
£tw
(10è<< 
mytim”
.
cu¼’t_time
(è<< "è " << std::£tw(10è<< 
™em_·œs_com·»d
 << "…aœ com·»d " << std::
’dl
;

292 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

293 
	ggcÚ‹xt
.
	gscheduËr
->
»move_sks
(0, (è
gcÚ‹xt
.
nv”tiûs
 - 1);

294 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0){

295 
vid_t
 
i
=0; 
	gi
 < 
	gM
; i++){

296 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
i
);

298 
	gg¿bbed_edges
 = 0;

299 
	gadjcÚš”
->
ş—r
();

301 
vid_t
 
	gi
=
M
; i < 
	gM
+
	gN
; i++){

302 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
i
);

315 
befÜe_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

318 ià((
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 0)) {

320 
´štf
("’‹ršg i‹¿tiÚ: %d oÀbefÜe_exec_š‹rv®\n", 
gcÚ‹xt
.
™”©iÚ
);

321 
´štf
("pivÙ_¡ i %d wšdow_Sˆ%d, wšdow_’ %d\n", 
adjcÚš”
->
pivÙ_¡
, 
wšdow_¡
, 
wšdow_’
);

324 ià(
	gadjcÚš”
->
	gpivÙ_¡
 < 
	gM
){

326 
log¡»am
(
LOG_DEBUG
è<< "Wšdow in™, g¿bbed: " << 
	gg¿bbed_edges
 << "ƒdges" << "ƒx‹ndšg…ivÜ_¿ngtØ: " << 
	gwšdow_’
 + 1 << 
	g¡d
::
’dl
;

327 
	gadjcÚš”
->
ex‹nd_pivÙ¿nge
(
M
 );

328 
log¡»am
(
LOG_DEBUG
è<< "WšdowƒÀis: " << 
	gwšdow_’
 << " v”tiûs: " << 
	ggcÚ‹xt
.
	gnv”tiûs
 << 
	g¡d
::
’dl
;

329 ià(
	gwšdow_’
 =ğ
M
+
N
) {

331 
log¡»am
(
LOG_DEBUG
)<<"S‘tšg†a¡ i‹¿tiÚo: " << 
gcÚ‹xt
.
™”©iÚ
 + 2 << 
¡d
::
’dl
;

332 
	ggcÚ‹xt
.
£t_Ï¡_™”©iÚ
(
gcÚ‹xt
.
™”©iÚ
 + 2);

347 
aá”_exec_š‹rv®
(
vid_t
 
wšdow_¡
, vid_ˆ
wšdow_’
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

350 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 % 2 == 1){

352 
´štf
("’‹ršg i‹¿tiÚ: %d oÀaá”_exec_š‹rv®\n", 
gcÚ‹xt
.
™”©iÚ
);

353 
´štf
("pivÙ_¡ i %d wšdow_¡ %d, wšdow_’ %d\n", 
adjcÚš”
->
pivÙ_¡
, 
wšdow_¡
, 
wšdow_’
);

356 
ušt
 
	gi
=
wšdow_¡
; i < 
	gwšdow_’
; i++){

357 ià(
is_u£r
(
i
)){

358 ià(
	gdebug
)

359 
log¡»am
(
LOG_DEBUG
)<<"Gošg ov” u£r" << 
	gi
 << 
	g¡d
::
’dl
;

360 
	gd’£_adj
 &
	gu£r
 = 
adjcÚš”
->
adjs
[
i
 - 
wšdow_¡
];

361 ià(
Âz
(
u£r
.
edges
è=ğ0 ||‚nz(u£r.
¿tšgs
) == 0){

362 ià(
debug
)

363 
log¡»am
(
LOG_DEBUG
)<<"U£¸w™h‚Øedges" << 
¡d
::
’dl
;

367 
ivec
 
	gpos™iÚs
 = 
»v”£_sÜt_šdex
(
u£r
.
¿tšgs
, 
K
);

368 
as£¹
(
pos™iÚs
.
size
() > 0);

369 
	gj
=0; j < 
	gpos™iÚs
.
size
(); j++){

370 
as£¹
(
pos™iÚs
[
j
] >= 0);

371 
as£¹
(
pos™iÚs
[
j
] < ()
N
);

374 ià(
g‘_v®
(
u£r
.
¿tšgs
, 
pos™iÚs
[
j
])== 0){

375 ià(
debug
)

376 
log¡»am
(
LOG_DEBUG
)<<"Found z”Øš…os™iÚ " << 
j
 << 
¡d
::
’dl
;

379 
	grc
 = 
årštf
(
out_fe
, "%u %u %lg\n", 
i
+1, 
pos™iÚs
[
j
]+1, 
g‘_v®
(
u£r
.
¿tšgs
,…ositions[j]));

380 
as£¹
(
rc
 > 0);

381 
	gwr™‹n_·œs
++;

392 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

393 
	`´št_cİyright
();

397 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

401 
m‘rics
 
	`m
("itemsim2rating");

403 
mš_®lowed_š‹r£ùiÚ
 = 
	`g‘_İtiÚ_št
("min_allowed_intersection", min_allowed_intersection);

405 
debug
 = 
	`g‘_İtiÚ_št
("debug", 0);

406 
	`·r£_commªd_lše_¬gs
();

407 
¡d
::
¡ršg
 
sim¬™y
 = 
	`g‘_İtiÚ_¡ršg
("similarity", "");

408 ià(
sim¬™y
 == "")

409 
	`log¡»am
(
LOG_FATAL
)<<"Missšg sim¬™y iÅuˆfe. PËa£ s³cify oÃ usšgh--sim¬™y=f’amcommªd†šæag" << 
¡d
::
’dl
;

410 
undœeùed
 = 
	`g‘_İtiÚ_št
("undirected", 0);

411 
Q
 = 
	`g‘_İtiÚ_æßt
("Q", Q);

412 
mytim”
.
	`¡¬t
();

413 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘_ªd_™em_sim¬™y
<
EdgeD©aTy³
>(
Œaššg
, 
sim¬™y
);

414 
K
 = 
	`g‘_İtiÚ_št
("K");

416 
	`as£¹
(
M
 > 0 && 
N
 > 0);

419 
adjcÚš”
 = 
Ãw
 
	`adjli¡_cÚš”
();

421 
»Ëvªt_™ems
 = 
Ãw
 
boŞ
[
N
];

424 
I‹mDi¡ªûProg¿m
 
´og¿m
;

425 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
,
nsh¬ds
, 
Œue
, 
m
);

426 
	`£t_’gše_æags
(
’gše
);

429 
out_fe
 = 
	`İ’_fe
((
Œaššg
 + "-»c").
	`c_¡r
(), "w");

432 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

435 ià(!
qu›t
)

436 
	`m‘rics_»pÜt
(
m
);

438 
¡d
::
cout
<<"TÙ® i‹m…aœ com·»d: " << 
™em_·œs_com·»d
 << "Ù® wr™‹ÀtØfe: " << 
wr™‹n_·œs
 << std::
’dl
;

439 
¡d
::
cout
<<"C»©ed ouuˆfe w™hhfÜm©: " << 
Œaššg
 << "-»c" << std::
’dl
;

441 
d–‘e
[] 
»Ëvªt_™ems
;

442 
	`fşo£
(
out_fe
);

444 
	}
}

	@toolkits/collaborative_filtering/libfm.cpp

35 
	~"commÚ.hµ
"

36 
	~"eig’_w¿µ”.hµ
"

38 
	glibfm_¿‹
 = 1e-02;

39 
	glibfm_muÉ_dec
 = 0.9;

40 
	glibfm_»gw
 = 1e-3;

41 
	glibfm_»gv
 = 1e-3;

42 
	g»g0
 = 0.1;

43 
boŞ
 
	gdebug
 = 
çl£
;

44 
	gtime_off£t
 = 1;

46 
boŞ
 
	$is_u£r
(
vid_t
 
id
){  id < 
M
; 
	}
}

47 
boŞ
 
	$is_™em
(
vid_t
 
id
){  id >ğ
M
 && id < 
N
; 
	}
}

48 
boŞ
 
	$is_time
(
vid_t
 
id
){  id >ğ
M
+
N
; 
	}
}

49 
	#BIAS_POS
 -1

	)

51 
	sv”‹x_d©a
 {

52 
vec
 
	mpvec
;

53 
	mbŸs
;

54 
	mÏ¡_™em
;

56 
v”‹x_d©a
() {

57 
	mbŸs
 = 0;

58 
	mÏ¡_™em
 = 0;

60 
£t_v®
(
šdex
, 
v®
){

61 ià(
	mšdex
 =ğ
BIAS_POS
)

62 
bŸs
 = 
v®
;

63 
	mpvec
[
šdex
] = 
v®
;

65 
g‘_v®
(
šdex
){

66 ià(
	mšdex
=ğ
BIAS_POS
)

67  
bŸs
;

68  
	mpvec
[
šdex
];

74 
	sedge_d©a
 {

75 
	mweight
;

76 
	mtime
;

78 
edge_d©a
(è{ 
	mweight
 = 
time
 = 0; }

80 
edge_d©a
(
weight
, 
time
) : weight(weight),ime(time) { }

84 
	sv”‹x_d©a_libfm
{

85 * 
	mbŸs
;

86 * 
	mv
;

87 *
	mÏ¡_™em
;

89 
v”‹x_d©a_libfm
(cÚ¡ 
v”‹x_d©a
 & 
vd©a
){

90 
	mv
 = (*)&
vd©a
.
pvec
[0];

91 
	mbŸs
 = (*)&
vd©a
.
bŸs
;

92 
	mÏ¡_™em
 = (*)&
vd©a
.
Ï¡_™em
;

95 
	mv”‹x_d©a_libfm
 & 
	mİ”©Ü
=(
v”‹x_d©a
 & 
d©a
){

96 
v
 = (*)&
d©a
.
pvec
[0];

97 
	mbŸs
 = (*)&
d©a
.
bŸs
;

98 
	mÏ¡_™em
 = (*)&
d©a
.
Ï¡_™em
;

99  * 
	mthis
;

107 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

108 
edge_d©a
 
	tEdgeD©aTy³
;

110 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

111 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	gpv®id©iÚ_’gše
 = 
NULL
;

112 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

114 
	~"io.hµ
"

115 
	~"rm£.hµ
"

116 
	~"rm£_’gše4.hµ
"

118 
	$libfm_´ediù
(cÚ¡ 
v”‹x_d©a_libfm
& 
u£r
,

119 cÚ¡ 
v”‹x_d©a_libfm
& 
mov›
,

120 cÚ¡ 
v”‹x_d©a_libfm
& 
time
,

121 cÚ¡ 
¿tšg
,

122 & 
´ediùiÚ
, 
vec
 * 
sum
){

124 
v”‹x_d©a
 & 
Ï¡_™em
 = 
Ï‹Á_çùÜs_šmem
[
M
+
N
+
K
+(*
u£r
.last_item)];

125 
vec
 
sum_sqr
 = 
	`z”os
(
D
);

126 *
sum
 = 
	`z”os
(
D
);

127 
´ediùiÚ
 = 
glob®M—n
 + *
u£r
.
bŸs
 + *
mov›
.bŸ + *
time
.bŸ + 
Ï¡_™em
.bias;

128 
j
=0; j< 
D
; j++){

129 
sum
->
İ”©Ü
[](
j
è+ğ
u£r
.
v
[j] + 
mov›
.v[j] + 
time
.v[j] + 
Ï¡_™em
.
pvec
[j];

130 
sum_sqr
[
j
] = 
	`pow
(
u£r
.
v
[j],2è+…ow(
mov›
.v[j],2è+…ow(
time
.v[j],2è+…ow(
Ï¡_™em
.
pvec
[j],2);

131 
´ediùiÚ
 +ğ0.5 * (
	`pow
(
sum
->
İ”©Ü
[](
j
),2è- 
sum_sqr
[j]);

134 
´ediùiÚ
 = 
¡d
::
	`mš
((í»diùiÚ, 
maxv®
);

135 
´ediùiÚ
 = 
¡d
::
	`max
((í»diùiÚ, 
mšv®
);

137 
”r
 = 
¿tšg
 - 
´ediùiÚ
;

138 
	`as£¹
(!
¡d
::
	`i¢ª
(
”r
));

139  
”r
*err;

141 
	}
}

142 
	$libfm_´ediù
(cÚ¡ 
v”‹x_d©a
& 
u£r
,

143 cÚ¡ 
v”‹x_d©a
& 
mov›
,

144 cÚ¡ 
¿tšg
,

145 & 
´ediùiÚ
,

146 * 
exŒa
){

147 
vec
 
sum
;

148  
	`libfm_´ediù
(
	`v”‹x_d©a_libfm
((
v”‹x_d©a
&)
u£r
), v”‹x_d©a_libfm((v”‹x_d©a&)
mov›
), v”‹x_d©a_libfm(*(v”‹x_d©a*)
exŒa
), 
¿tšg
, 
´ediùiÚ
, &
sum
);

149 
	}
}

152 
	$š™_libfm
(){

154 
	`¤ªd
(
	`time
(
NULL
));

155 
Ï‹Á_çùÜs_šmem
.
	`»size
(
M
+
N
+
K
+M);

157 
	`as£¹
(
D
 > 0);

158 
çùÜ
 = 0.1/
	`sq¹
(
D
);

159 #´agm¨
omp
 
·¿Î–
 

160 
i
=0; i< ()(
M
+
N
+
K
+M); i++){

161 
Ï‹Á_çùÜs_šmem
[
i
].
pvec
 = (
debug
 ? 0.1*
	`Úes
(
D
è: (::
	`¿ndu
(D)*
çùÜ
));

163 
	}
}

171 
	gLIBFMV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

176 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

179 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0){

180 ià(
is_u£r
(
v”‹x
.
id
())) {

181 
v”‹x_d©a_libfm
 
u£r
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

182 
	gmax_time
 = 0;

183 
	ge
=0;ƒ < 
	gv”‹x
.
num_ou‹dges
();ƒ++) {

184 cÚ¡ 
	gedge_d©a
 & 
	gedge
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

185 ià(
	gedge
.
	gtime
 >ğ
max_time
){

186 
max_time
 = ()(
edge
.
time
 - 
time_off£t
);

187 *
	gu£r
.
	gÏ¡_™em
 = 
v”‹x
.
edge
(
e
)->
v”‹x_id
(è- 
M
;

191 ià(
is_u£r
(
v”‹x
.
id
()è&& 
	gv”‹x
.
num_ou‹dges
() == 0)

192 
log¡»am
(
LOG_WARNING
)<<"V”‹x: " << 
v”‹x
.
id
(è<< " w™h‚Øedges: " << 
¡d
::
’dl
;

198 ià(
is_u£r
(
v”‹x
.
id
())){

199 
v”‹x_d©a_libfm
 
	gu£r
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

200 
as£¹
(*
u£r
.
Ï¡_™em
 >ğ0 && *u£r.Ï¡_™em < ()
N
);

201 
	gv”‹x_d©a
 & 
	gÏ¡_™em
 = 
Ï‹Á_çùÜs_šmem
[
M
+
N
+
K
+(*
u£r
.
Ï¡_™em
)];

203 
	ge
=0;ƒ < 
	gv”‹x
.
num_ou‹dges
();ƒ++) {

204 
v”‹x_d©a_libfm
 
mov›
(
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()]);

206 
	grui
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
().
weight
;

207 
	gpui
;

208 
vec
 
	gsum
;

209 
	gv”‹x_d©a
 & 
	gtime
 = 
Ï‹Á_çùÜs_šmem
[()
v”‹x
.
edge
(
e
)->
g‘_d©a
().
time
 - 
time_off£t
];

210 
	gsqE¼
 = 
libfm_´ediù
(
u£r
, 
mov›
, 
time
, 
rui
, 
pui
, &
sum
);

211 
	geui
 = 
pui
 - 
rui
;

213 
	gglob®M—n
 -ğ
libfm_¿‹
 * (
eui
 + 
»g0
 * 
glob®M—n
);

214 *
	gu£r
.
	gbŸs
 -ğ
libfm_¿‹
 * (
eui
 + 
libfm_»gw
 * *
u£r
.
bŸs
);

215 *
	gmov›
.
	gbŸs
 -ğ
libfm_¿‹
 * (
eui
 + 
libfm_»gw
 * *
mov›
.
bŸs
);

216 
	gtime
.
	gbŸs
 -ğ
libfm_»gw
 * (
eui
 +†ibfm_»gw * 
time
.
bŸs
);

217 
as£¹
(!
¡d
::
i¢ª
(
time
.
bŸs
));

218 
	gÏ¡_™em
.
	gbŸs
 -ğ
libfm_»gw
 * (
eui
 +†ibfm_»gw * 
Ï¡_™em
.
bŸs
);

220 
	gf
 = 0; f < 
	gD
; f++){

222 
	gg¿d
 = 
sum
[
f
] - 
u£r
.
v
[f];

223 
	gu£r
.
	gv
[
f
] -ğ
libfm_¿‹
 * (
eui
 * 
g¿d
 + 
libfm_»gv
 * 
u£r
.
v
[f]);

225 
	gg¿d
 = 
sum
[
f
] - 
mov›
.
v
[f];

226 
	gmov›
.
	gv
[
f
] -ğ
libfm_¿‹
 * (
eui
 * 
g¿d
 + 
libfm_»gv
 * 
mov›
.
v
[f]);

228 
	gg¿d
 = 
sum
[
f
] - 
time
.
pvec
[f];

229 
	gtime
.
	gpvec
[
f
] -ğ
libfm_¿‹
 * (
eui
 * 
g¿d
 + 
libfm_»gv
 * 
time
.
pvec
[f]);

231 
	gg¿d
 = 
sum
[
f
] - 
Ï¡_™em
.
pvec
[f];

232 
	gÏ¡_™em
.
	gpvec
[
f
] -ğ
libfm_¿‹
 * (
eui
 * 
g¿d
 + 
libfm_»gv
 * 
Ï¡_™em
.
pvec
[f]);

236 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
sqE¼
;

246 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

247 
»£t_rm£
(
gcÚ‹xt
.
exeùh»ads
);

254 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

255 
	glibfm_¿‹
 *ğ
libfm_muÉ_dec
;

256 
Œaššg_rm£
(
™”©iÚ
, 
gcÚ‹xt
);

257 
run_v®id©iÚ4
(
pv®id©iÚ_’gše
, 
gcÚ‹xt
);

264 
ouut_libfm_»suÉ
(
¡d
::
¡ršg
 
f’ame
) {

265 
MMOuu‰”_m©
<
v”‹x_d©a
> 
mmouut_Ëá
(
f’ame
 + "_U.mm", 0, 
M
, "Thi fcÚš LIBFM ouuˆm©rix U. IÀ—ch„ow D faùÜ oà¨sšgË u£¸node.", 
Ï‹Á_çùÜs_šmem
);

266 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
mmouut_right
(
f’ame
 + "_V.mm", 
M
 ,M+
N
, "Thi fcÚš -LIBFM ouuˆm©rix V. IÀ—ch„ow D faùÜ oà¨sšgË i‹m‚ode.", 
Ï‹Á_çùÜs_šmem
);

267 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
mmouut_time
(
f’ame
 + "_T.mm", 
M
+
N
 ,M+N+
K
, "Thi fcÚš -LIBFM ouuˆm©rix T. IÀ—ch„ow D faùÜ oà¨sšgËimnode.", 
Ï‹Á_çùÜs_šmem
);

268 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
mmouut_Ï¡_™em
(
f’ame
 + "_L.mm", 
M
+
N
+
K
 ,M+N+K+M, "Thi fcÚš -LIBFM ouuˆm©rix L. IÀ—ch„ow D faùÜ oà¨sšgË†a¡ i‹m‚ode.", 
Ï‹Á_çùÜs_šmem
);

269 
	gMMOuu‰”_vec
<
	gv”‹x_d©a
> 
mmouut_bŸs_Ëá
(
f’ame
 + "_U_bŸs.mm", 0, 
M
, 
BIAS_POS
, "Thi fcÚš LIBFM ouuˆbŸ veùÜ. IÀ—ch„ow‡ sšgË u£¸bŸs.", 
Ï‹Á_çùÜs_šmem
);

270 
	gMMOuu‰”_vec
<
	gv”‹x_d©a
> 
mmouut_bŸs_right
(
f’ame
 + "_V_bŸs.mm",
M
 ,M+
N
, 
BIAS_POS
, "Thi fcÚš LIBFM ouuˆbŸ veùÜ. IÀ—ch„ow‡ sšgË i‹m bŸs.", 
Ï‹Á_çùÜs_šmem
);

271 
	gMMOuu‰”_vec
<
	gv”‹x_d©a
> 
mmouut_bŸs_time
(
f’ame
 + "_T_bŸs.mm",
M
+
N
 ,M+N+
K
 , 
BIAS_POS
, "Thi fcÚš LIBFM ouuˆbŸ veùÜ. IÀ—ch„ow‡ sšgËimbŸs.", 
Ï‹Á_çùÜs_šmem
);

272 
	gMMOuu‰”_vec
<
	gv”‹x_d©a
> 
mmouut_bŸs_Ï¡_™em
(
f’ame
 + "_L_bŸs.mm",
M
+
N
+
K
 ,M+N+K+M , 
BIAS_POS
, "Thi fcÚš LIBFM ouuˆbŸ veùÜ. IÀ—ch„ow‡ sšgË†a¡ i‹m bŸs.", 
Ï‹Á_çùÜs_šmem
);

273 
MMOuu‰”_sÿÏr
 
gm—n
(
f’ame
 + "_glob®_m—n.mm", "Thi fcÚš LIBFM glob® m—Àwhich i »quœed fÜ computšg…»diùiÚs.", 
glob®M—n
);

275 
log¡»am
(
LOG_INFO
è<< " LIBFM ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << "_U.mm" << ", " << f’am+ "_V.mm " << f’am+ "_T.mm, " << f’am<< "_L.mm, " << f’am<< "_glob®_m—n.mm, " << f’am<< "_U_bŸs.mm " << f’am<< "_V_bŸs.mm, " << f’am<< "_T_bŸs.mm, " << f’am<< "_L_bŸs.mm " <<
	g¡d
::
’dl
;

278 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

281 
	`´št_cİyright
();

285 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

289 
m‘rics
 
	`m
("libfm");

292 
libfm_¿‹
 = 
	`g‘_İtiÚ_æßt
("libfm_rate",†ibfm_rate);

293 
libfm_»gw
 = 
	`g‘_İtiÚ_æßt
("libfm_regw",†ibfm_regw);

294 
libfm_»gv
 = 
	`g‘_İtiÚ_æßt
("libfm_regv",†ibfm_regv);

295 
libfm_muÉ_dec
 = 
	`g‘_İtiÚ_æßt
("libfm_mult_dec",†ibfm_mult_dec);

296 
D
 = 
	`g‘_İtiÚ_št
("D", D);

298 
	`·r£_commªd_lše_¬gs
();

299 
	`·r£_im¶ic™_commªd_lše
();

302 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘4
<
edge_d©a
>(
Œaššg
, 
çl£
);

303 
	`š™_libfm
();

304 ià(
v®id©iÚ
 != ""){

305 
vsh¬ds
 = 
cÚv”t_m©rixm¬k‘4
<
EdgeD©aTy³
>(
v®id©iÚ
, 
Œue
, 
M
==
N
, 
VALIDATION
);

306 
š™_v®id©iÚ_rm£_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
>(
pv®id©iÚ_’gše
, 
vsh¬ds
, &
libfm_´ediù
, 
çl£
, 
Œue
, 1);

310 ià(
lßd_çùÜs_äom_fe
){

311 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_U.mm", 0, 
D
);

312 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_V.mm", 
M
, 
D
);

313 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_T.mm", 
M
+
N
, 
D
);

314 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_L.mm", 
M
+
N
+
K
, 
D
);

315 
vec
 
u£r_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 +"_U_bŸs.mm", 
çl£
, 
Œue
);

316 
vec
 
™em_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 +"_V_bŸs.mm", 
çl£
, 
Œue
);

317 
vec
 
time_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
+ "_T_bŸs.mm", 
çl£
, 
Œue
);

318 
vec
 
Ï¡_™em_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
+"_L_bŸs.m", 
çl£
, 
Œue
);

319 
ušt
 
i
=0; i<
M
+
N
+
K
+M; i++){

320 ià(
i
 < 
M
)

321 
Ï‹Á_çùÜs_šmem
[
i
].
bŸs
 = 
u£r_bŸs
[i];

322 ià(
i
 <
M
+
N
)

323 
Ï‹Á_çùÜs_šmem
[
i
].
bŸs
 = 
™em_bŸs
[i-
M
];

324 ià(
i
 <
M
+
N
+
K
)

325 
Ï‹Á_çùÜs_šmem
[
i
].
bŸs
 = 
time_bŸs
[i-
M
-
N
];

327 
Ï‹Á_çùÜs_šmem
[
i
].
bŸs
 = 
Ï¡_™em_bŸs
[i-
M
-
N
-
K
];

329 
vec
 
gm
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 + "_glob®_m—n.mm", 
çl£
, 
Œue
);

330 
glob®M—n
 = 
gm
[0];

335 
LIBFMV”tiûsInMemProg¿m
 
´og¿m
;

336 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

337 
	`£t_’gše_æags
(
’gše
);

338 
³ngše
 = &
’gše
;

339 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

342 
	`ouut_libfm_»suÉ
(
Œaššg
);

343 
	`‹¡_´ediùiÚs3
(&
libfm_´ediù
, 1);

346 ià(!
qu›t
)

347 
	`m‘rics_»pÜt
(
m
);

349 
	}
}

	@toolkits/collaborative_filtering/math.hpp

26 #iâdeà
_MATH_HPP


27 
	#_MATH_HPP


	)

29 
	~"ty³s.hµ
"

30 
	~"eig’_w¿µ”.hµ
"

32 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> * 
³ngše
;

34 
	g»guÏriz©iÚ
;

35 
boŞ
 
	gdebug
;

36 
boŞ
 
	g»gnÜm®
;

38 
´št_vec
(cÚ¡ * 
Çme
, cÚ¡ 
vec
 & 
pvec
, 
boŞ
 
high
);

40 
	sm©h_šfo
{

42 
	mšüem’t
;

43 
	mc
;

44 
	md
;

45 
	mx_off£t
, 
	mb_off£t
 , 
	my_off£t
, 
	mr_off£t
, 
	mdiv_off£t
, 
	m´ev_off£t
, 
	mdiv_cÚ¡
;

46 
boŞ
 
	mA_off£t
, 
	mA_Œª¥o£
;

47 
	m¡d
::
veùÜ
<
¡d
::
¡ršg
> 
Çmes
;

48 
boŞ
 
	mu£_dŸg
;

49 
	mÜtho_»³©s
;

50 
	m¡¬t
, 
	m’d
;

53 
boŞ
 
	mdi¡_¦iûd_m©_back¦ash
;

54 
m©
 
	meDT
;

55 
	mmaxv®
, 
	mmšv®
;

57 
m©h_šfo
(){

58 
»£t_off£ts
();

61 
»£t_off£ts
(){

62 
	mšüem’t
 = 2;

63 
	mc
=1.0; 
	md
=0.0;

64 
	mx_off£t
 = 
b_off£t
 = 
y_off£t
 = 
r_off£t
 = 
div_off£t
 = 
´ev_off£t
 = -1;

65 
	mdiv_cÚ¡
 = 0;

66 
	mA_off£t
 = 
çl£
;

67 
	mA_Œª¥o£
 = 
çl£
;

68 
	mu£_dŸg
 = 
Œue
;

69 
	m¡¬t
 = 
’d
 = -1;

70 
	mdi¡_¦iûd_m©_back¦ash
 = 
çl£
;

72 
šüem’t_off£t
(){

73  
	mšüem’t
++;

80 
b¬t™e_g¿ph_desütÜ
 
	gšfo
;

81 
m©h_šfo
 
	gmi
;

83 
	#MAX_PRINT_ITEMS
 25

	)

84 
	gruÁime
 = 0;

94 
	gAxb
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

101 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

103 ià(
	gv”‹x
.
id
(è< (
	gušt
)
	gmi
.
	g¡¬t
 || v”‹x.id(è>ğ(
ušt
)
mi
.
’d
)

106 
	gv”‹x_d©a
& 
	gu£r
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

107 
boŞ
 
	grows
 = 
v”‹x
.
id
(è< (
ušt
)
šfo
.
g‘_¡¬t_node
(
çl£
);

108 ià(
	gšfo
.
is_squ¬e
())

109 
	grows
 = 
mi
.
A_Œª¥o£
;

110 
as£¹
(
mi
.
r_off£t
 >=0);

112 ià(
	gmi
.
	g´ev_off£t
 >= 0)

113 
u£r
.
pvec
[
mi
.
´ev_off£t
 ] = u£r.pvec[mi.
r_off£t
];

115 
	gv®
 = 0;

116 
as£¹
(
mi
.
x_off£t
 >=0 || mi.
y_off£t
>=0);

119 ià(
	gmi
.
	gA_off£t
 && mi.
	gx_off£t
 >= 0){

120 
e
=0; 
	ge
 < 
	gv”‹x
.
num_edges
();ƒ++) {

121 cÚ¡ 
	gedge_d©a
 & 
	gedge
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

122 cÚ¡ 
	gv”‹x_d©a
 & 
	gmov›
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

123 
	gv®
 +ğ(
edge
.
weight
 * 
mov›
.
pvec
[
mi
.
x_off£t
]);

126 ià(
	gšfo
.
is_squ¬e
(è&& 
	gmi
.
	gu£_dŸg
)

127 
	gv®
 +ğĞ(
u£r
.
A_ii
+ 
»guÏriz©iÚ
è* u£r.
pvec
[
mi
.
x_off£t
]);

129 
	gv®
 *ğ
mi
.
c
;

132 ià(!
	gmi
.
	gA_off£t
 && mi.
	gx_off£t
 >= 0){

133 
v®
 = 
mi
.
c
*
u£r
.
pvec
[mi.
x_off£t
];

137 ià(
	gmi
.
	gy_off£t
>= 0){

138 
v®
 +ğ
mi
.
d
*
u£r
.
pvec
[mi.
y_off£t
];

142 ià(
	gmi
.
	gdiv_off£t
 >= 0){

143 
v®
 /ğ
u£r
.
pvec
[
mi
.
div_off£t
];

145 
	gu£r
.
	gpvec
[
mi
.
r_off£t
] = 
v®
;

151 
Axb
 
	g´og¿m
;

153 
	$š™_m©h
(
b¬t™e_g¿ph_desütÜ
 & 
_šfo
, 
Ütho_»³©s
 = 3){

154 
šfo
 = 
_šfo
;

155 
mi
.
	`»£t_off£ts
();

156 
mi
.
Ütho_»³©s
 = ortho_repeats;

157 
	}
}

160 
şass
 
	gDi¡M©
;

161 
şass
 
	gDi¡DoubË
;

163 şas 
	cDi¡Vec
{

164 
	mpublic
:

165 
off£t
;

166 
	mdi¥Ïy_off£t
;

167 
	m´ev_off£t
;

168 
	m¡d
::
¡ršg
 
Çme
;

169 
boŞ
 
	mŒª¥o£
;

170 
b¬t™e_g¿ph_desütÜ
 
	mšfo
;

171 
	m¡¬t
;

172 
	m’d
;

174 
	$š™
(){

175 
¡¬t
 = 
šfo
.
	`g‘_¡¬t_node
(!
Œª¥o£
);

176 
’d
 = 
šfo
.
	`g‘_’d_node
(!
Œª¥o£
);

177 
	`as£¹
(
¡¬t
 < 
’d
 && start >= 0 &&ƒnd >= 1);

181 
	$size
(){  
’d
-
¡¬t
; 
	}
}

183 
Di¡Vec
(cÚ¡ 
b¬t™e_g¿ph_desütÜ
 &
_šfo
, 
_off£t
, 
boŞ
 
_Œª¥o£
, cÚ¡ 
¡d
::
¡ršg
 & 
_Çme
){

184 
off£t
 = 
_off£t
;

185 
	gdi¥Ïy_off£t
 = 
_off£t
;

186 
	gÇme
 = 
_Çme
;

187 
	gšfo
 = 
_šfo
;

188 
	gŒª¥o£
 = 
_Œª¥o£
;

189 
	g´ev_off£t
 = -1;

190 
š™
();

192 
Di¡Vec
(cÚ¡ 
b¬t™e_g¿ph_desütÜ
 &
_šfo
, 
_off£t
, 
boŞ
 
_Œª¥o£
, cÚ¡ 
¡d
::
¡ršg
 & 
_Çme
, 
_´ev_off£t
){

193 
	goff£t
 = 
_off£t
;

194 
	gdi¥Ïy_off£t
 = 
_off£t
;

195 
	gÇme
 = 
_Çme
;

196 
	gšfo
 = 
_šfo
;

197 
	gŒª¥o£
 = 
_Œª¥o£
;

198 
as£¹
(
_´ev_off£t
 < 
d©a_size
);

199 
	g´ev_off£t
 = 
_´ev_off£t
;

200 
š™
();

204 
	gDi¡Vec
& 
	gİ”©Ü
-(){

205 
	gmi
.
	gd
=-1.0;

206  *
	gthis
;

208 
	gDi¡Vec
& 
	gİ”©Ü
-(cÚ¡ Di¡Veø& 
	gÙh”
){

209 
	gmi
.
	gx_off£t
 = 
off£t
;

210 
	gmi
.
	gy_off£t
 = 
Ùh”
.
off£t
;

211 
	gŒª¥o£
 = 
Ùh”
.
Œª¥o£
;

212 ià(
	gmi
.
	gd
 == 0)

213 
mi
.
d
 = -1.0;

215 
	gmi
.
	gd
*=-1.0;

216  *
	gthis
;

218 
	gDi¡Vec
& 
	gİ”©Ü
+(){

219 ià(
	gmi
.
	gd
 == 0)

220 
mi
.
d
=1.0;

221  *
	gthis
;

223 
	gDi¡Vec
& 
	gİ”©Ü
+(cÚ¡ Di¡Veø&
	gÙh”
){

224 
	gmi
.
	gx_off£t
 =
off£t
;

225 
	gmi
.
	gy_off£t
 = 
Ùh”
.
off£t
;

226 
	gŒª¥o£
 = 
Ùh”
.
Œª¥o£
;

227  *
	gthis
;

229 
	gDi¡Vec
& 
	gİ”©Ü
+(cÚ¡ 
	gDi¡M©
 &
	gÙh”
);

231 
	gDi¡Vec
& 
	gİ”©Ü
-(cÚ¡ 
	gDi¡M©
 &
	gÙh”
);

233 
	gDi¡Vec
& 
	gİ”©Ü
/(cÚ¡ Di¡Veø&
	gÙh”
){

234 
	gmi
.
	gdiv_off£t
 = 
Ùh”
.
off£t
;

235  *
	gthis
;

237 
	gDi¡Vec
& 
	gİ”©Ü
/(cÚ¡ 
	gDi¡DoubË
 & 
	gÙh”
);

239 
	gDi¡Vec
& 
	gİ”©Ü
/(
	gv®
){

240 
as£¹
(
v®
 != 0);

241 
as£¹
(
mi
.
d
 == 0);

242 
	gmi
.
	gd
 = 1/
v®
;

243  *
	gthis
;

247 
	gDi¡Vec
& 
	gİ”©Ü
=(cÚ¡ 
Di¡Vec
 & 
vec
){

248 
as£¹
(
off£t
 < (
šfo
.
is_squ¬e
(è? 2*
d©a_size
: data_size));

249 ià(
	gmi
.
	gx_off£t
 =ğ-1 && 
mi
.
y_off£t
 == -1){

250 
mi
.
y_off£t
 = 
vec
.
off£t
;

252 
	gmi
.
	gr_off£t
 = 
off£t
;

253 
as£¹
(
´ev_off£t
 < 
d©a_size
);

254 
	gmi
.
	g´ev_off£t
 = 
´ev_off£t
;

255 ià(
	gmi
.
	gd
 == 0.0)

256 
mi
.
d
=1.0;

257 
	gŒª¥o£
 = 
vec
.
Œª¥o£
;

258 
	g’d
 = 
vec
.
’d
;

259 
	g¡¬t
 = 
vec
.
¡¬t
;

260 
	gmi
.
	g¡¬t
 = 
¡¬t
;

261 
	gmi
.
	g’d
 = 
’d
;

265 
	g³ngše
->
run
(
´og¿m
, 1);

266 
debug_´št
(
Çme
);

267 
	gmi
.
»£t_off£ts
();

268  *
	gthis
;

271 
	gDi¡Vec
& 
	gİ”©Ü
=(cÚ¡ 
vec
 & 
pvec
){

272 
as£¹
(
off£t
 >= 0);

273 
as£¹
(
pvec
.
size
(è=ğ
šfo
.
num_nodes
(
Œue
è||…vec.size(è=ğšfo.num_nodes(
çl£
));

274 
as£¹
(
¡¬t
 < 
’d
);

275 ià(!
	gšfo
.
is_squ¬e
(è&& 
	gpvec
.
size
(è=ğ
šfo
.
num_nodes
(
çl£
)){

276 
Œª¥o£
 = 
Œue
;

279 
	gŒª¥o£
 = 
çl£
;

281 
	gi
=
¡¬t
; i< 
	g’d
; i++){

282 
	gÏ‹Á_çùÜs_šmem
[
i
].
	gpvec
[
off£t
] = 
pvec
[i-
¡¬t
];

284 
debug_´št
(
Çme
);

285  *
	gthis
;

289 
vec
 
	$to_vec
(){

290 
vec
 
»t
 = 
	`z”os
(
’d
-
¡¬t
);

291 
i
=
¡¬t
; i< 
’d
; i++){

292 
»t
[
i
-
¡¬t
] = 
Ï‹Á_çùÜs_šmem
[i].
pvec
[
off£t
];

294  
»t
;

295 
	}
}

297 
	$g‘_pos
(
i
){

298  
Ï‹Á_çùÜs_šmem
[
i
].
pvec
[
off£t
];

299 
	}
}

301 
	$debug_´št
(cÚ¡ * 
Çme
){

302 ià(
debug
){

303 
¡d
::
cout
<<
Çme
<<"["<<
di¥Ïy_off£t
<<"]" << std::
’dl
;

304 
i
=
¡¬t
; i< 
¡d
::
	`mš
(
’d
, s¹+
MAX_PRINT_ITEMS
); i++){

306 
	`´štf
("%.5lg ", 
	`çbs
(
Ï‹Á_çùÜs_šmem
[
i
].
pvec
[(
mi
.
r_off£t
==-1)?
off£t
:mi.r_offset]));

308 
	`´štf
("\n");

310 
	}
}

311 
debug_´št
(
¡d
::
¡ršg
 
Çme
){  debug_´štÒame.
c_¡r
());}

313 
	gİ”©Ü
[](
	gi
){

314 
as£¹
(
i
 < 
’d
 - 
¡¬t
);

315  
	gÏ‹Á_çùÜs_šmem
[
i
+
¡¬t
].
	gpvec
[
off£t
];

318 
Di¡DoubË
 
	gİ”©Ü
*(cÚ¡ 
	gDi¡Vec
 & 
	gÙh”
);

320 
	gDi¡Vec
& 
	gİ”©Ü
*(cÚ¡ 
	gv®
){

321 
as£¹
(
v®
!= 0);

322 
	gmi
.
	gd
=
v®
;

323  *
	gthis
;

325 
	gDi¡Vec
& 
	gİ”©Ü
*(cÚ¡ 
	gDi¡DoubË
 &
	gdv®
);

327 
	gDi¡M©
 &
	gİ”©Ü
*(Di¡M© & 
	gv
);

329 
	gDi¡Vec
& 
	$_Œª¥o£
() {

333  *
this
;

334 
	}
}

336 
	gDi¡Vec
& 
	gİ”©Ü
=(
Di¡M©
 &
m©
);

340 şas 
	cDi¡SliûdM©
{

341 
	mpublic
:

342 
b¬t™e_g¿ph_desütÜ
 
šfo
;

343 
	m¡¬t_off£t
;

344 
	m’d_off£t
;

345 
	m¡d
::
¡ršg
 
Çme
;

346 
	m¡¬t
;

347 
	m’d
;

348 
boŞ
 
	mŒª¥o£
;

350 
Di¡SliûdM©
(
_¡¬t_off£t
, 
_’d_off£t
, 
boŞ
 
_Œª¥o£
, cÚ¡ 
b¬t™e_g¿ph_desütÜ
 &
_šfo
, 
¡d
::
¡ršg
 
_Çme
){

352 
as£¹
(
_¡¬t_off£t
 >= 0);

353 
as£¹
(
_šfo
.
tÙ®
() > 0);

354 
	mŒª¥o£
 = 
_Œª¥o£
;

355 
	mšfo
 = 
_šfo
;

356 
š™
();

357 
	m¡¬t_off£t
 = 
_¡¬t_off£t
;

358 
	m’d_off£t
 = 
_’d_off£t
;

359 
	mÇme
 = 
_Çme
;

362 
	gDi¡SliûdM©
& 
	gİ”©Ü
=(
Di¡M©
 & 
Ùh”
);

364 
	$š™
(){

365 
¡¬t
 = 
šfo
.
	`g‘_¡¬t_node
(!
Œª¥o£
);

366 
’d
 = 
šfo
.
	`g‘_’d_node
(!
Œª¥o£
);

367 
	`as£¹
(
¡¬t
 < 
’d
 && start >= 0 &&ƒnd >= 1);

369 
	}
};

371 
	$size
(
dim
){  (dim =ğ1è? (
’d
-
¡¬t
è: (
’d_off£t
 - 
¡¬t_off£t
è; 
	}
}

373 
	$£t_cŞs
(
¡¬t_cŞ
, 
’d_cŞ
, cÚ¡ 
m©
& 
pm©
){

374 
	`as£¹
(
¡¬t_cŞ
 >= 0);

375 
	`as£¹
(
’d_cŞ
 <ğ
’d_off£t
 - 
¡¬t_off£t
);

376 
	`as£¹
(
pm©
.
	`rows
(è=ğ
’d
-
¡¬t
);

377 
	`as£¹
(
pm©
.
	`cŞs
(è>ğ
’d_cŞ
 - 
¡¬t_cŞ
);

378 
i
=
¡¬t_cŞ
; i< 
’d_cŞ
; i++)

379 
this
->
İ”©Ü
[](
i
èğ
	`g‘_cŞ
(
pm©
, i-
¡¬t_cŞ
);

380 
	}
}

381 
m©
 
	$g‘_cŞs
(
¡¬t_cŞ
, 
’d_cŞ
){

382 
	`as£¹
(
¡¬t_cŞ
 < 
’d_off£t
 - 
¡¬t_off£t
);

383 
	`as£¹
(
¡¬t_off£t
 + 
’d_cŞ
 <ğ
’d_off£t
);

384 
m©
 
»tm©
 = 
	`z”os
(
’d
-
¡¬t
, 
’d_cŞ
 - 
¡¬t_cŞ
);

385 
i
=
¡¬t_cŞ
; i< 
’d_cŞ
; i++)

386 
	`£t_cŞ
(
»tm©
, 
i
-
¡¬t_cŞ
, 
this
->
İ”©Ü
[](i-¡¬t_cŞ).
	`to_vec
());

387  
»tm©
;

388 
	}
}

390 
	gİ”©Ü
=(
m©
 & 
pm©
){

391 
as£¹
(
’d_off£t
-
¡¬t_off£t
 <ğ
pm©
.
cŞs
());

392 
as£¹
(
’d
-
¡¬t
 =ğ
pm©
.
rows
());

393 
£t_cŞs
(0, 
pm©
.
cŞs
(),…mat);

396 
	g¡d
::
¡ršg
 
	$g‘_Çme
(
pos
){

397 
	`as£¹
(
pos
 < 
’d_off£t
 - 
¡¬t_off£t
);

398 
	`as£¹
(
pos
 >= 0);

399  
Çme
;

400 
	}
}

402 
Di¡Vec
 
	gİ”©Ü
[](
	gpos
){

403 
as£¹
(
pos
 < 
’d_off£t
-
¡¬t_off£t
);

404 
as£¹
(
pos
 >= 0);

405 
Di¡Vec
 
»t
(
šfo
, 
¡¬t_off£t
 + 
pos
, 
Œª¥o£
, 
g‘_Çme
(pos));

406 
	g»t
.
	gdi¥Ïy_off£t
 = 
pos
;

407  
	g»t
;

415 şas 
	cDi¡M©
{

416 
	mpublic
:

417 
boŞ
 
Œª¥o£
;

418 
b¬t™e_g¿ph_desütÜ
 
	mšfo
;

420 
	$Di¡M©
(cÚ¡ 
b¬t™e_g¿ph_desütÜ
& 
_šfo
) {

421 
šfo
 = 
_šfo
;

422 
Œª¥o£
 = 
çl£
;

426 
Di¡M©
 &
İ”©Ü
*(cÚ¡ 
Di¡Vec
 & 
v
){

427 
mi
.
x_off£t
 = 
v
.
off£t
;

428 
mi
.
A_off£t
 = 
Œue
;

431  *
this
;

432 
	}
}

433 
	gDi¡M©
 &
	gİ”©Ü
*(cÚ¡ 
	gDi¡DoubË
 &
	gd
);

435 
	gDi¡M©
 &
	gİ”©Ü
-(){

436 
	gmi
.
	gc
=-1.0;

437  *
	gthis
;

440 
	gDi¡M©
 &
	gİ”©Ü
/(cÚ¡ 
	gDi¡Vec
 & 
	gv
){

441 
	gmi
.
	gdiv_off£t
 = 
v
.
off£t
;

442  *
	gthis
;

445 
	gDi¡M©
 &
	gİ”©Ü
+(){

446 
	gmi
.
	gc
=1.0;

447  *
	gthis
;

449 
	gDi¡M©
 &
	gİ”©Ü
+(cÚ¡ 
	gDi¡Vec
 &
	gv
){

450 
	gmi
.
	gy_off£t
 = 
v
.
off£t
;

451 ià(
	gmi
.
	gd
 == 0.0)

452 
mi
.
d
=1.0;

453  *
	gthis
;

455 
	gDi¡M©
 &
	gİ”©Ü
-(cÚ¡ 
	gDi¡Vec
 &
	gv
){

456 
	gmi
.
	gy_off£t
 = 
v
.
off£t
;

457 ià(
	gmi
.
	gd
 == 0.0)

458 
mi
.
d
=-1.0;

460 
	gmi
.
	gd
*=-1.0;

461  *
	gthis
;

463 
	gDi¡M©
 & 
	$_Œª¥o£
(){

464 
Œª¥o£
 = 
Œue
;

465 
mi
.
A_Œª¥o£
 = 
Œue
;

466  *
this
;

467 
	}
}

468 
	gDi¡M©
 & 
	gİ”©Ü
~(){

469  
_Œª¥o£
();

471 
	gDi¡M©
 & 
	$back¦ash
(
Di¡SliûdM©
 & 
U
){

472 
mi
.
di¡_¦iûd_m©_back¦ash
 = 
Œue
;

473 
Œª¥o£
 = 
U
.transpose;

474  *
this
;

475 
	}
}

476 
	$£t_u£_dŸg
(
boŞ
 
u£
){

477 
mi
.
u£_dŸg
 = 
u£
;

478 
	}
}

482 
	gDi¡Vec
& Di¡Vec::
İ”©Ü
=(
Di¡M©
 &
m©
){

483 
mi
.
r_off£t
 = 
off£t
;

484 
as£¹
(
´ev_off£t
 < 
d©a_size
);

485 
	gmi
.
	g´ev_off£t
 = 
´ev_off£t
;

486 
	gŒª¥o£
 = 
m©
.
Œª¥o£
;

487 
	gmi
.
	g¡¬t
 = 
šfo
.
g‘_¡¬t_node
(!
Œª¥o£
);

488 
	gmi
.
	g’d
 = 
šfo
.
g‘_’d_node
(!
Œª¥o£
);

492 
	g³ngše
->
run
(
´og¿m
, 1);

493 
debug_´št
(
Çme
);

494 
	gmi
.
»£t_off£ts
();

495 
	gm©
.
	gŒª¥o£
 = 
çl£
;

496  *
	gthis
;

499 
	gDi¡Vec
& Di¡Vec::
İ”©Ü
+(cÚ¡ 
Di¡M©
 &
Ùh”
){

500 
mi
.
y_off£t
 = 
off£t
;

501 
	gŒª¥o£
 = 
Ùh”
.
Œª¥o£
;

502  *
	gthis
;

505 
	gDi¡Vec
& Di¡Vec::
İ”©Ü
-(cÚ¡ 
Di¡M©
 & 
Ùh”
){

506 
mi
.
y_off£t
 = 
off£t
;

507 
	gŒª¥o£
 = 
Ùh”
.
Œª¥o£
;

508 ià(
	gmi
.
	gc
 == 0)

509 
mi
.
c
 = -1;

510 
	gmi
.
	gc
 *= -1;

511  *
	gthis
;

514 
	gDi¡M©
& 
	gDi¡Vec
::
İ”©Ü
*(
Di¡M©
 & 
v
){

515 
mi
.
x_off£t
 = 
off£t
;

516 
	gmi
.
	gA_off£t
 = 
Œue
;

517  
	gv
;

521 şas 
	cDi¡DoubË
{

522 
	mpublic
:

523 
v®
;

524 
	m¡d
::
¡ršg
 
Çme
;

526 
	$Di¡DoubË
() {};

527 
	$Di¡DoubË
(
_v®
è: 
	$v®
(
_v®
è{
	}
};

530 
	gDi¡Vec
& 
	gİ”©Ü
*(Di¡Veø& 
	gdv®
){

531 
	gmi
.
	gd
=
v®
;

532  
	gdv®
;

534 
	gDi¡M©
& 
	gİ”©Ü
*(Di¡M© & 
	gm©
){

535 
	gmi
.
	gc
 = 
v®
;

536  
	gm©
;

539 
Di¡DoubË
 
	gİ”©Ü
/(cÚ¡ Di¡DoubË 
	gdv®
){

540 
Di¡DoubË
 
	gmv®
;

541 
	gmv®
.
	gv®
 = 
v®
 / 
dv®
.val;

542  
	gmv®
;

544 
boŞ
 
	gİ”©Ü
<(cÚ¡ 
	gÙh”
){

545  
	gv®
 < 
	gÙh”
;

547 
	gDi¡DoubË
 & 
	gİ”©Ü
=(cÚ¡ 
Di¡DoubË
 & 
Ùh”
){

548 
v®
 = 
Ùh”
.val;

549 
debug_´št
(
Çme
);

550  *
	gthis
;

552 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
_v®
){

553  
v®
 =ğ
_v®
;

555 
	$debug_´št
(cÚ¡ * 
Çme
){

556 
¡d
::
cout
<<
Çme
<<" "<<
v®
<<¡d::
’dl
;

557 
	}
}

558 
	$toDoubË
(){

559  
v®
;

560 
	}
}

561 
debug_´št
(
¡d
::
¡ršg
 
Çme
){  debug_´štÒame.
c_¡r
()); }

566 
Di¡DoubË
 
	gDi¡Vec
::
İ”©Ü
*(cÚ¡ 
Di¡Vec
 & 
vec
){

567 
mi
.
y_off£t
 = 
off£t
;

568 
	gmi
.
	gb_off£t
 = 
vec
.
off£t
;

569 ià(
	gmi
.
	gd
 == 0)

570 
mi
.
d
 = 1.0;

571 
as£¹
(
mi
.
y_off£t
 >=0 && mi.
b_off£t
 >= 0);

573 
	gv®
 = 0;

574 
	gi
=
¡¬t
; i< 
	g’d
; i++){

575 cÚ¡ 
v”‹x_d©a
 * 
	gd©a
 = &
Ï‹Á_çùÜs_šmem
[
i
];

576 * 
	gpv
 = (*)&
d©a
->
pvec
[0];

579 
	gv®
 +ğ
mi
.
d
* 
pv
[mi.
y_off£t
] *…v[mi.
b_off£t
];

581 
	gmi
.
»£t_off£ts
();

582 
Di¡DoubË
 
	gmv®
;

583 
	gmv®
.
	gv®
 = 
v®
;

584  
	gmv®
;

586 
	gDi¡Vec
& Di¡Vec::
İ”©Ü
*(cÚ¡ 
Di¡DoubË
 &
dv®
){

587 
mi
.
d
 = 
dv®
.
v®
;

588  *
	gthis
;

592 
	$size
(
Di¡M©
 & 
A
, 
pos
){

593 
	`as£¹
(
pos
 == 1 ||…os == 2);

594  
A
.
šfo
.
	`num_nodes
(!A.
Œª¥o£
);

595 
	}
}

597 
	gDi¡M©
 &Di¡M©::
İ”©Ü
*(cÚ¡ 
Di¡DoubË
 &
d
){

598 
mi
.
c
 = 
d
.
v®
;

599  *
	gthis
;

602 
Di¡DoubË
 
	$sq¹
(
Di¡DoubË
 & 
dv®
){

603 
Di¡DoubË
 
mv®
;

604 
mv®
.
v®
=
	`sq¹
(
dv®
.val);

605  
mv®
;

606 
	}
}

607 
Di¡DoubË
 
	$nÜm
(cÚ¡ 
Di¡Vec
 &
vec
){

608 
	`as£¹
(
vec
.
off£t
>=0);

609 
	`as£¹
(
vec
.
¡¬t
 < vec.
’d
);

611 
Di¡DoubË
 
mv®
;

612 
mv®
.
v®
 = 0;

613 
i
=
vec
.
¡¬t
; i < vec.
’d
; i++){

614 cÚ¡ 
v”‹x_d©a
 * 
d©a
 = &
Ï‹Á_çùÜs_šmem
[
i
];

615 * 
px
 = (*)&
d©a
->
pvec
[0];

616 
mv®
.
v®
 +ğ
px
[
vec
.
off£t
]*px[vec.offset];

618 
mv®
.
v®
 = 
	`sq¹
(mval.val);

619  
mv®
;

620 
	}
}

623 
Di¡DoubË
 
	$nÜm
(
Di¡M©
 & 
m©
){

624 
Di¡Vec
 
	`vec
(
šfo
, 0, 
m©
.
Œª¥o£
, "norm");

625 
vec
 = 
m©
;

626  
	`nÜm
((cÚ¡ 
Di¡Vec
&)
vec
);

627 
	}
}

629 
vec
 
	$dŸg
(
Di¡M©
 & 
m©
){

630 
	`as£¹
(
šfo
.
	`is_squ¬e
());

631 
vec
 
»t
 = 
	`z”os
(
šfo
.
	`tÙ®
());

632 
i
=0; i< 
šfo
.
	`tÙ®
(); i++){

633 
»t
[
i
] = 
Ï‹Á_çùÜs_šmem
[i].
A_ii
;

635  
»t
;

636 
	}
}

638 
	$ÜthogÚ®ize_vs_®l
(
Di¡SliûdM©
 & 
m©
, 
curoff£t
){

639 
	`as£¹
(
mi
.
Ütho_»³©s
 >=1 && mi.ortho_repeats <= 3);

640 
	`INITIALIZE_TRACER
(
ÜthogÚ®ize_vs_®É¿û
, "orthogonalization step");

641 
	`BEGIN_TRACEPOINT
(
ÜthogÚ®ize_vs_®É¿û
);

642 
boŞ
 
Şd_debug
 = 
debug
;

643 
debug
 = 
çl£
;

644 
Di¡Vec
 
cu¼’t
 = 
m©
[
curoff£t
];

647 
j
=0; j < 
mi
.
Ütho_»³©s
; j++){

648 
i
=0; i< 
curoff£t
; i++){

649 
Di¡DoubË
 
®pha
 = 
m©
[
i
]*
cu¼’t
;

652 ià(
®pha
.
	`toDoubË
() > 1e-10)

653 
cu¼’t
 = cu¼’ˆ- 
m©
[
i
]*
®pha
;

656 
	`END_TRACEPOINT
(
ÜthogÚ®ize_vs_®É¿û
);

657 
debug
 = 
Şd_debug
;

658 
cu¼’t
.
	`debug_´št
(cu¼’t.
Çme
);

659 
	}
}

661 
	$ÜthogÚ®ize_vs_®l
(
Di¡SliûdM©
 & 
m©
, 
curoff£t
, &
®pha
){

662 
	`as£¹
(
mi
.
Ütho_»³©s
 >=1 && mi.ortho_repeats <= 3);

663 
boŞ
 
Şd_debug
 = 
debug
;

664 
debug
 = 
çl£
;

665 
Di¡Vec
 
cu¼’t
 = 
m©
[
curoff£t
];

666 
	`as£¹
(
m©
.
¡¬t_off£t
 <ğ
cu¼’t
.
off£t
);

667 * 
®phas
 = 
Ãw
 [
curoff£t
];

670 ià(
curoff£t
 > 0){

671 
j
=0; j < 
mi
.
Ütho_»³©s
; j++){

672 
	`mem£t
(
®phas
, 0, ()*
curoff£t
);

673 #´agm¨
omp
 
·¿Î–
 

674 
i
=
m©
.
¡¬t_off£t
; i< 
cu¼’t
.
off£t
; i++){

675 
k
=
šfo
.
	`g‘_¡¬t_node
(!
cu¼’t
.
Œª¥o£
); k< info.
	`g‘_’d_node
(!current.transpose); k++){

676 
®phas
[
i
-
m©
.
¡¬t_off£t
] +ğ
Ï‹Á_çùÜs_šmem
[
k
].
pvec
[i] *†©’t_çùÜs_šmem[k].pvec[
cu¼’t
.
off£t
];

679 
i
=
m©
.
¡¬t_off£t
; i< 
cu¼’t
.
off£t
; i++){

680 #´agm¨
omp
 
·¿Î–
 

681 
k
=
šfo
.
	`g‘_¡¬t_node
(!
cu¼’t
.
Œª¥o£
); k< info.
	`g‘_’d_node
(!current.transpose); k++){

682 
Ï‹Á_çùÜs_šmem
[
k
].
pvec
[
cu¼’t
.
off£t
] -ğ
®phas
[
i
-
m©
.
¡¬t_off£t
] *†atent_factors_inmem[k].pvec[i];

688 
d–‘e
 [] 
®phas
;

689 
debug
 = 
Şd_debug
;

690 
cu¼’t
.
	`debug_´št
(cu¼’t.
Çme
);

692 
sum
 = 0;

693 
k
;

695 
k
=
šfo
.
	`g‘_¡¬t_node
(!
cu¼’t
.
Œª¥o£
); k< info.
	`g‘_’d_node
(!current.transpose); k++){

696 
sum
 = sum + 
	`pow
(
Ï‹Á_çùÜs_šmem
[
k
].
pvec
[
cu¼’t
.
off£t
],2);

698 
®pha
 = 
	`sq¹
(
sum
);

699 ià(
®pha
 >= 1e-10 ){

700 #´agm¨
omp
 
·¿Î–
 

701 
k
=
šfo
.
	`g‘_¡¬t_node
(!
cu¼’t
.
Œª¥o£
); k< info.
	`g‘_’d_node
(!current.transpose); k++){

702 
Ï‹Á_çùÜs_šmem
[
k
].
pvec
[
cu¼’t
.
off£t
]/=
®pha
;

705 
	}
}

706 
	$muÉly
(
Di¡SliûdM©
 & 
m©
, 
curoff£t
, 
a
){

708 
	`as£¹
(
a
>0);

709 
Di¡Vec
 
cu¼’t
 = 
m©
[
curoff£t
];

710 
	`as£¹
(
m©
.
¡¬t_off£t
 <ğ
cu¼’t
.
off£t
);

711 
vec
 
»suÉ
 = 
	`z”os
(
curoff£t
);

713 ià(
curoff£t
 > 0){

715 #´agm¨
omp
 
·¿Î–
 

716 
i
=
m©
.
¡¬t_off£t
; i< 
cu¼’t
.
off£t
; i++){

717 
k
=
šfo
.
	`g‘_¡¬t_node
(!
cu¼’t
.
Œª¥o£
); k< info.
	`g‘_’d_node
(!current.transpose); k++){

718 
»suÉ
[
i
-
m©
.
¡¬t_off£t
] +ğ
Ï‹Á_çùÜs_šmem
[
k
].
pvec
[i] *†©’t_çùÜs_šmem[k].pvec[
cu¼’t
.
off£t
];

721 #´agm¨
omp
 
·¿Î–
 

722 
k
=
šfo
.
	`g‘_¡¬t_node
(!
cu¼’t
.
Œª¥o£
); k< info.
	`g‘_’d_node
(!current.transpose); k++){

723 
Ï‹Á_çùÜs_šmem
[
k
].
pvec
[
curoff£t
] /ğ
a
;

726 
i
=
m©
.
¡¬t_off£t
; i< 
cu¼’t
.
off£t
; i++){

727 #´agm¨
omp
 
·¿Î–
 

728 
k
=
šfo
.
	`g‘_¡¬t_node
(!
cu¼’t
.
Œª¥o£
); k< info.
	`g‘_’d_node
(!current.transpose); k++){

729 
Ï‹Á_çùÜs_šmem
[
k
].
pvec
[
cu¼’t
.
off£t
] -ğ
»suÉ
[
i
-
m©
.
¡¬t_off£t
]/
a
 *†atent_factors_inmem[k].pvec[i];

734 
cu¼’t
.
	`debug_´št
(cu¼’t.
Çme
);

735 
	}
}

739 
	gDi¡Vec
& Di¡Vec::
İ”©Ü
/(cÚ¡ 
Di¡DoubË
 & 
Ùh”
){

740 
as£¹
(
Ùh”
.
v®
 != 0);

741 
as£¹
(
mi
.
d
 == 0);

742 
	gmi
.
	gd
 = 1/
Ùh”
.
v®
;

743  *
	gthis
;

	@toolkits/collaborative_filtering/metric_eval.cpp

23 
	~<c¡dio
>

24 
	~<m­
>

25 
	~<io¡»am
>

26 
	~<omp.h
>

27 
	~<as£¹.h
>

28 
	~"g¿phchi_basic_šşudes.hµ
"

29 
	~"tim”.hµ
"

30 
	~"ut.hµ
"

31 
	~"eig’_w¿µ”.hµ
"

32 
	~"m‘rics.hµ
"

34 
usšg
 
Çme¥aû
 
	g¡d
;

35 
usšg
 
Çme¥aû
 
	gg¿phchi
;

37 
tim”
 
	gmytime
;

38 
	gK
 = 10;

39 
	gmax_³r_row
 = 1000;

40 
	g¡d
::
¡ršg
 
Œaššg
, 
	g‹¡
;

41 
	gavg_Œaš_size
 = 0;

42 
	gavg_‹¡_size
 = 0;

45 cÚ¡ 
	g¥aûs
[] = {" \r\n\t;:"};

47 
	$g‘_Úe_lše
(
FILE
 * 
pfe
, & 
šdex
, 
vec
 & 
v®ues
, & 
pos
){

49 * 
§v•Œ
 = 
NULL
, * 
lšebuf
 = NULL;

50 
size_t
 
lšesize
 = 0;

52 
rc
 = 
	`g‘lše
(&
lšebuf
, &
lšesize
, 
pfe
);

53 ià(
rc
 < 1){

54 
šdex
 = -1;

58 
pos
 = 0;

59 
boŞ
 
fœ¡_time
 = 
Œue
;

60 
Œue
){

62 *
pch
 = 
	`¡¹ok_r
(
fœ¡_time
 ? 
lšebuf
 : 
NULL
, 
¥aûs
, &
§v•Œ
);

63 ià(!
pch
){

66 
v®
 = 
	`©of
(
pch
);

67 ià(
fœ¡_time
){

68 
šdex
 = ()
v®
;

69 
fœ¡_time
 = 
çl£
;

72 
	`as£¹
(
pos
 < 
v®ues
.
	`size
());

73 
v®ues
[
pos
] = 
v®
;

74 
pos
++;

77 
	}
}

79 
	$ev®_m‘rics
(){

80 
š_fe
 
	`Œf
(
Œaššg
);

81 
š_fe
 
	`‹¡t
(
‹¡
);

83 
vec
 
Œaš_vec
 = 
	`z”os
(
max_³r_row
);

84 
vec
 
‹¡_vec
 = 
	`z”os
(
max_³r_row
);

85 
size_t
 
lše
 = 0;

86 
Œaš_šdex
 = 0, 
‹¡_šdex
 = 0;

87 
­
 = 0;

88 
Œaš_size
 =0, 
‹¡_size
 = 0;

89 
Œue
){

90 
	`g‘_Úe_lše
(
Œf
.
outf
, 
Œaš_šdex
, 
Œaš_vec
, 
Œaš_size
);

91 
	`g‘_Úe_lše
(
‹¡t
.
outf
, 
‹¡_šdex
, 
‹¡_vec
, 
‹¡_size
);

92 ià(
Œaš_šdex
 =ğ-1 || 
‹¡_šdex
 == -1)

94 
‹¡_šdex
 < 
Œaš_šdex
 &&est_index != -1){

95 
	`log¡»am
(
LOG_WARNING
)<<"Skpšg ov”e¡ index: " << 
‹¡_šdex
 << "¿š: " << 
Œaš_šdex
 << 
¡d
::
’dl
;

96 
	`g‘_Úe_lše
(
‹¡t
.
outf
, 
‹¡_šdex
, 
‹¡_vec
, 
‹¡_size
);

98 
Œaš_šdex
 < 
‹¡_šdex
 &&rain_index != -1){

99 
	`log¡»am
(
LOG_WARNING
)<<"Skpšg ov”¿š.e¡ index: " << 
‹¡_šdex
 << "¿š: " << 
Œaš_šdex
 << 
¡d
::
’dl
;

100 
	`g‘_Úe_lše
(
Œf
.
outf
, 
Œaš_šdex
, 
Œaš_vec
, 
Œaš_size
);

103 ià(
Œaš_šdex
 =ğ
‹¡_šdex
){

104 
avg_Œaš_size
 +ğ
Œaš_size
;

105 
avg_‹¡_size
 +ğ
‹¡_size
;

106 
­
+ğ
	`av”age_´ecisiÚ_©_k
(
Œaš_vec
, 
Œaš_size
, 
‹¡_vec
, 
‹¡_size
, 
K
);

107 
lše
++;

110 
	`log¡»am
(
LOG_WARNING
)<<"ProbËm…¬sšg fe, gÙØŒaš index: " << 
Œaš_šdex
 << "e¡_šdex: " << 
‹¡_šdex
 << 
¡d
::
’dl
;

113 ià(
lše
 % 100000 == 0)

114 
	`log¡»am
(
LOG_INFO
)<<
mytime
.
	`cu¼’t_time
(è<<" Fšishedƒv®u©šg " << 
lše
 << " in¡ªûs. " << 
¡d
::
’dl
;

117 
	`log¡»am
(
LOG_INFO
)<<"Compu‹d AP@" << 
K
 << " m‘ric: " << 
­
/()
lše
 << 
¡d
::
’dl
;

118 
	`log¡»am
(
LOG_INFO
)<<"TÙ® com·»d: " << 
lše
 << 
¡d
::
’dl
;

119 
	`log¡»am
(
LOG_INFO
)<<"Avge¡†’gth: " << 
avg_‹¡_size
 / 
lše
 << 
¡d
::
’dl
;

120 
	`log¡»am
(
LOG_INFO
)<<"Avg¿š†’gth: " << 
avg_Œaš_size
 / 
lše
 << 
¡d
::
’dl
;

121 
	}
}

124 
	$maš
(
¬gc
, cÚ¡ *
¬gv
[]) {

126 
	`log¡»am
(
LOG_WARNING
)<<"GraphChi…arsers†ibrary is written by Danny Bickson (c). Send‡ny "

127 " comm’t Ü bug„•Üt tØdªny.bicksÚ@gma.com " << 
¡d
::
’dl
;

128 
	`glob®_logg”
().
	`£t_log_Ëv–
(
LOG_INFO
);

129 
	`glob®_logg”
().
	`£t_log_to_cÚsŞe
(
Œue
);

131 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

133 
K
 = 
	`g‘_İtiÚ_št
("K", K);

134 ià(
K
 < 1)

135 
	`log¡»am
(
LOG_FATAL
)<<"Numb” oàtİƒËm’t (--K=èshould b>ğ1"<<
¡d
::
’dl
;

137 
	`omp_£t_num_th»ads
(
	`g‘_İtiÚ_št
("ncpus", 1));

138 
mytime
.
	`¡¬t
();

140 
Œaššg
 = 
	`g‘_İtiÚ_¡ršg
("training");

141 
‹¡
 = 
	`g‘_İtiÚ_¡ršg
("test");

143 
	`ev®_m‘rics
();

144 
¡d
::
cout
 << "Fšished iÀ" << 
mytime
.
	`cu¼’t_time
(è<< std::
’dl
;

147 
	}
}

	@toolkits/collaborative_filtering/metrics.hpp

22 
	~<®gÜ™hm
>

23 
	~"eig’_w¿µ”.hµ
"

28 
	$av”age_´ecisiÚ_©_k
(
vec
 & 
´ediùiÚs
, 
´ediùiÚ_size
, veø& 
aùu®
, 
aùu®_size
, 
k
){

29 
scÜe
 = 0;

30 
num_h™s
 = 0;

32 
vec
 
sÜ‹d_aùu®
 = 
aùu®
;

33 
aùu®_size
 = 
¡d
::
	`mš
(
k
,‡ctual_size);

34 
¡d
::
	`sÜt
(
sÜ‹d_aùu®
.
	`d©a
(), sÜ‹d_aùu®.d©a()+ 
aùu®_size
);

35 
i
=0; i < 
¡d
::
	`mš
(()
´ediùiÚs
.
	`size
(), 
k
); i++){

36 ià(
¡d
::
	`bš¬y_£¬ch
(
sÜ‹d_aùu®
.
	`d©a
(), sÜ‹d_aùu®.d©a()+ 
aùu®_size
, 
´ediùiÚs
[
i
])){

37 
num_h™s
++;

38 
scÜe
 +ğ
num_h™s
 / (
i
+1.0);

41 
scÜe
 /ğ()
¡d
::
	`mš
(
aùu®_size
, 
k
);

42  
scÜe
;

43 
	}
}

	@toolkits/collaborative_filtering/nmf.cpp

31 
	~"commÚ.hµ
"

32 
	~"eig’_w¿µ”.hµ
"

34 cÚ¡ 
	g•sÚ
 = 1e-16;

35 
	sv”‹x_d©a
 {

36 
vec
 
	mpvec
;

38 
v”‹x_d©a
() {

39 
	mpvec
 = 
z”os
(
D
);

41 
£t_v®
(
šdex
, 
v®
){

42 
	mpvec
[
šdex
] = 
v®
;

44 
g‘_v®
(
šdex
){

45  
	mpvec
[
šdex
];

55 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

56 
	tEdgeD©aTy³
;

58 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

59 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	gpv®id©iÚ_’gše
 = 
NULL
;

60 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

61 
vec
 
	gx1
, 
	gx2
;

62 
	g™”
;

64 
	~"rm£.hµ
"

65 
	~"rm£_’gše.hµ
"

66 
	~"io.hµ
"

69 
	$nmf_´ediù
(cÚ¡ 
v”‹x_d©a
& 
u£r
,

70 cÚ¡ 
v”‹x_d©a
& 
mov›
,

71 cÚ¡ 
¿tšg
,

72 & 
´ediùiÚ
,

73 * 
exŒa
 = 
NULL
){

75 
´ediùiÚ
 = 
	`dÙ_´od
(
u£r
.
pvec
, 
mov›
.pvec);

77 
´ediùiÚ
 = 
¡d
::
	`mš
((í»diùiÚ, 
maxv®
);

78 
´ediùiÚ
 = 
¡d
::
	`max
((í»diùiÚ, 
mšv®
);

80 
”r
 = 
¿tšg
 - 
´ediùiÚ
;

81 
	`as£¹
(!
¡d
::
	`i¢ª
(
”r
));

82  
”r
*err;

84 
	}
}

87 
	$´e_u£r_™”
(){

88 
x1
 = 
	`z”os
(
D
);

89 
ušt
 
i
=
M
; i<M+
N
; i++){

90 
v”‹x_d©a
 & 
d©a
 = 
Ï‹Á_çùÜs_šmem
[
i
];

91 
x1
 +ğ
d©a
.
pvec
;

93 
	}
}

96 
	$´e_mov›_™”
(){

97 
x2
 = 
	`z”os
(
D
);

98 
ušt
 
i
=0; i<
M
; i++){

99 
v”‹x_d©a
 & 
d©a
 = 
Ï‹Á_çùÜs_šmem
[
i
];

100 
x2
 +ğ
d©a
.
pvec
;

102 
	}
}

111 
	gNMFV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

117 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

118 
»£t_rm£
(
gcÚ‹xt
.
exeùh»ads
);

119 
	g™”
 = 
™”©iÚ
;

120 ià(
	g™”©iÚ
 > 0) {

121 ià(
	g™”©iÚ
 % 2 == 1)

122 
´e_u£r_™”
();

123 
´e_mov›_™”
();

130 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

132 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0){

133 ià(
v”‹x
.
num_ou‹dges
(è=ğ0 && v”‹x.
id
(è< 
M
)

134 
log¡»am
(
LOG_FATAL
)<<"NMF‡lgÜ™hm cª‚Ù wÜk wh’hrow " << 
v”‹x
.
id
(è<< " oàthm©rix cÚš ®Èz”os" << 
¡d
::
’dl
;

135 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

136 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

137 ià(
	gob£rv©iÚ
 < 0 ){

138 
log¡»am
(
LOG_FATAL
)<<"Found‡‚eg©iv’Œy iÀm©œx„ow " << 
	gv”‹x
.
id
(è<< " w™h v®ue: " << 
	gob£rv©iÚ
 << 
	g¡d
::
’dl
;

144 
boŞ
 
	gisu£r
 = (
v”‹x
.
id
(è< 
M
);

145 ià((
	g™”
 % 2 =ğ1 && !
isu£r
) ||

146 (
™”
 % 2 =ğ0 && 
isu£r
))

149 
vec
 
	g»t
 = 
z”os
(
D
);

151 
	gv”‹x_d©a
 & 
	gvd©a
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

152 
m©
 
	gXtX
 = m©::
Z”o
(
D
, D);

153 
vec
 
	gXty
 = vec::
Z”o
(
D
);

155 
boŞ
 
	gcompu‹_rm£
 = 
Œue
;

157 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

158 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

159 
	gv”‹x_d©a
 & 
	gnbr_Ï‹Á
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

160 
	g´ediùiÚ
;

161 ià(
	gcompu‹_rm£
)

162 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
nmf_´ediù
(
vd©a
, 
nbr_Ï‹Á
, 
ob£rv©iÚ
, 
´ediùiÚ
);

163 ià(
	g´ediùiÚ
 == 0)

164 
log¡»am
(
LOG_FATAL
)<<"GÙ iÁØnum”iÿÈ”rÜ! PËa£ subm™‡ bug„•Üt." << 
¡d
::
’dl
;

165 
	g»t
 +ğ
nbr_Ï‹Á
.
pvec
 * (
ob£rv©iÚ
 / 
´ediùiÚ
);

168 
vec
 
	gpx
;

169 ià(
	gisu£r
)

170 
	gpx
 = 
x1
;

172 
	gpx
 = 
x2
;

173 
	gi
=0; i<
	gD
; i++){

174 
as£¹
(
px
[
i
] != 0);

175 
	gvd©a
.
	gpvec
[
i
] *ğ
»t
[i] / 
px
[i];

176 ià(
	gvd©a
.
	gpvec
[
i
] < 
	g•sÚ
)

177 
	gvd©a
.
	gpvec
[
i
] = 
•sÚ
;

186 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

188 
	gnow
 = 
™”©iÚ
 % 2;

189 ià(
	gnow
 == 0){

190 
Œaššg_rm£
(
™”©iÚ
/2, 
gcÚ‹xt
);

191 
run_v®id©iÚ
(
pv®id©iÚ_’gše
, 
gcÚ‹xt
);

198 
ouut_nmf_»suÉ
(
¡d
::
¡ršg
 
f’ame
){

199 
MMOuu‰”_m©
<
v”‹x_d©a
> 
u£r_m©
(
f’ame
 + "_U.mm", 0, 
M
, "Thi fcÚš NMF ouuˆm©rix U. IÀ—ch„ow D faùÜ oà¨sšgË u£¸node.", 
Ï‹Á_çùÜs_šmem
);

200 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
™em_m©
(
f’ame
 + "_V.mm", 
M
, M+
N
, "Thi fcÚš NMF ouuˆm©rix V. IÀ—ch„ow D faùÜ oà¨sšgË i‹m‚ode.", 
Ï‹Á_çùÜs_šmem
);

201 
log¡»am
(
LOG_INFO
è<< "NMF ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << "_U.mm" <<

202 ", " << 
	gf’ame
 + "_V.mm " << 
	g¡d
::
’dl
;

205 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

208 
	`´št_cİyright
();

212 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

216 
m‘rics
 
	`m
("nmf-inmemory-factors");

218 
	`·r£_commªd_lše_¬gs
();

219 
	`·r£_im¶ic™_commªd_lše
();

221 
n™”s
 *= 2;

224 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<>(
Œaššg
, 
NULL
, 0, 0, 3, 
TRAINING
, 
çl£
);

225 
š™_ã©u»_veùÜs
<
¡d
::
veùÜ
<
v”‹x_d©a
> >(
M
+
N
, 
Ï‹Á_çùÜs_šmem
, !
lßd_çùÜs_äom_fe
);

226 ià(
v®id©iÚ
 != ""){

227 
vsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
v®id©iÚ
, 
NULL
, 0, 0, 3, 
VALIDATION
, 
çl£
);

228 ià(
vsh¬ds
 != -1)

229 
š™_v®id©iÚ_rm£_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
>(
pv®id©iÚ_’gše
, 
vsh¬ds
, &
nmf_´ediù
);

232 ià(
lßd_çùÜs_äom_fe
){

233 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_U.mm", 0, 
D
);

234 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_V.mm", 
M
, 
D
);

237 
x1
 = 
	`z”os
(
D
);

238 
x2
 = 
	`z”os
(
D
);

241 
NMFV”tiûsInMemProg¿m
 
´og¿m
;

242 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

243 
	`£t_’gše_æags
(
’gše
);

244 
³ngše
 = &
’gše
;

245 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

248 
	`ouut_nmf_»suÉ
(
Œaššg
);

249 
	`‹¡_´ediùiÚs
(&
nmf_´ediù
);

252 ià(!
qu›t
)

253 
	`m‘rics_»pÜt
(
m
);

256 
	}
}

	@toolkits/collaborative_filtering/pmf.cpp

30 
	~"eig’_w¿µ”.hµ
"

31 
	~"commÚ.hµ
"

32 
	~"´ob.hµ
"

34 
	gÏmbda
 = 0.065;

35 
	gpmf_buº_š
 = 10;

36 
	gpmf_add™iÚ®_ouut
 = 0;

37 
	gdebug
 = 0;

40 
	gnuAÍha
 = 1;

41 
	gW®pha
 = 1;

42 
	gnu0
 = 
D
;

43 
	g®pha
 = 0;

44 
	gb‘a
 = 1;

45 
vec
 
	gb‘a0
 = 
š™_vec
("1", 1);

47 
m©
 
	gW0
;

49 
	giW®pha
;

50 
m©
 
	giW0
;

52 
m©
 
	gA_U
, 
	gA_V
;

53 
vec
 
	gmu_U
, 
	gmu_V
;

54 
	gi™”
 = 0;

56 
vec
 
	gv®id©iÚ_avg´od
;

57 
vec
 
	g‹¡_avg´od
;

58 
size_t
 
	grm£_šdex
 = 0;

59 
	grm£_ty³
 = 0;

61 
	sv”‹x_d©a
 {

62 
vec
 
	mpvec
;

64 
v”‹x_d©a
() {

65 
	mpvec
 = 
z”os
(
D
);

67 
£t_v®
(
šdex
, 
v®
){

68 
	mpvec
[
šdex
] = 
v®
;

70 
g‘_v®
(
šdex
){

71  
	mpvec
[
šdex
];

75 
	sedge_d©a
 {

76 
	mweight
;

77 
	mavg´d
;

78 
edge_d©a
(è{ 
	mweight
 = 0; 
	mavg´d
 = 0; }

79 
edge_d©a
(
weight
): weight(weightè{ 
avg´d
 = 0; }

86 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

87 
edge_d©a
 
	tEdgeD©aTy³
;

89 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

90 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

92 
	~"io.hµ
"

93 
	~"rm£.hµ
"

96 
	$pmf_´ediù
(cÚ¡ 
v”‹x_d©a
& 
u£r
,

97 cÚ¡ 
v”‹x_d©a
& 
mov›
,

98 cÚ¡ 
¿tšg
,

99 & 
´ediùiÚ
,

100 * 
³dge
){

103 
´ediùiÚ
 = 
	`dÙ_´od
(
u£r
.
pvec
, 
mov›
.pvec);

105 
´ediùiÚ
 = 
¡d
::
	`mš
((í»diùiÚ, 
maxv®
);

106 
´ediùiÚ
 = 
¡d
::
	`max
((í»diùiÚ, 
mšv®
);

108 
”r
 = 0;

109 ià(
i™”
 > 
pmf_buº_š
){

110 ià(
³dge
){

111 ià(
i™”
 =ğ
pmf_buº_š
+1)

112 (*(*)
³dge
) = 0;

113 (*(*)
³dge
è+ğ
´ediùiÚ
;

114 
”r
 = 
	`pow
(((*(*)
³dge
è/ (
i™”
 - 
pmf_buº_š
)è- 
¿tšg
, 2);

118 
”r
 = 
	`pow
(
´ediùiÚ
 - 
¿tšg
,2);

120 
	`as£¹
(!
¡d
::
	`i¢ª
(
”r
));

121 ià(!
³dge
)

122 
rm£_šdex
++;

123  
”r
;

125 
	}
}

128 
	$š™_£lf_pÙ
(){

130 
W0
 = 
	`eye
(
D
);

132 
iW®pha
 = 1.0/
W®pha
;

133 
iW0
 = 
	`šv
(
W0
);

135 
nu0
 = 
D
;

137 
A_U
 = 
	`eye
(
D
);

138 
A_V
 = 
	`eye
(
D
);

141 
mu_U
 = 
	`z”os
(
D
); 
mu_V
 = zeros(D);

153 
	}
}

159 
	$§m¶e_®pha
(
»s2
){

161 ià(
debug
)

162 
	`´štf
("» i %g\n", 
»s2
);

164 
»s
 = 
»s2
;

165 ià(
nuAÍha
 > 0){

166 
nuAÍha_
 =
nuAÍha
+ 
L
;

167 
m©
 
	`iW®pha_
(1,1);

168 
	`£t_v®
(
iW®pha_
, 0,0,
iW®pha
 + 
»s
);

169 
m©
 
iiW®pha_
 = 
	`z”os
(1,1);

170 
iiW®pha_
 = 
	`šv
(
iW®pha_
);

171 
®pha
 = 
	`g‘_v®
(
	`wishºd
(
iiW®pha_
, 
nuAÍha_
),0,0);

172 
	`as£¹
(
®pha
 != 0);

174 ià(
debug
)

175 
¡d
::
cout
<<"Sam¶šg from‡Íha" <<
nuAÍha_
<<" "<<
iW®pha
<<" "<< 
iiW®pha_
<<" "<<
®pha
<<
’dl
;

178 
	}
}

180 
m©
 
	$ÿlc_MMT
(
¡¬t_pos
, 
’d_pos
, 
vec
 &
Um—n
){

182 
b©chSize
 = 1000;

183 
m©
 
U
 = 
	`z”os
(
b©chSize
,
D
);

184 
m©
 
MMT
 = 
	`z”os
(
D
,D);

185 
út
 = 0;

187 
i
=
¡¬t_pos
; i< 
’d_pos
; i++){

188 ià((
i
-
¡¬t_pos
è% 
b©chSize
 == 0){

189 
U
=
	`z”os
(
b©chSize
, 
D
);

190 
út
 = 1;

193 cÚ¡ 
v”‹x_d©a
 * 
d©a
ğ&
Ï‹Á_çùÜs_šmem
[
i
];

194 
vec
 
m—n
 = 
d©a
->
pvec
;

195 
Um—n
 +ğ
m—n
;

196 
s
=0; s<
D
; s++)

197 
	`U
(
i
%
b©chSize
,
s
)=
	`m—n
(s);

198 ià(
debug
 && (
i
==
¡¬t_pos
 || i =ğ
’d_pos
-1))

199 
¡d
::
cout
<<" clmÀ"<<
i
<< " vec: " << 
m—n
 <<¡d::
’dl
;

201 ià((
út
 =ğ
b©chSize
è|| (úˆ< b©chSiz&& 
i
 =ğ
’d_pos
-1)){

202 
MMT
 = MMT+
	`Œª¥o£
(
U
)*U;

204 
út
++;

206 
Um—n
 /ğ(
’d_pos
-
¡¬t_pos
);

207 ià(
debug
)

208 
cout
<<"m—n: "<<
Um—n
<<
’dl
;

210 
	`as£¹
(
MMT
.
	`rows
(è=ğ
D
 && MMT.
	`cŞs
() == D);

211 
	`as£¹
(
Um—n
.
	`size
(è=ğ
D
);

212  
MMT
;

213 
	}
}

218 
	$§m¶e_U
(){

220 
vec
 
Um—n
 = 
	`z”os
(
D
);

221 
m©
 
UUT
 = 
	`ÿlc_MMT
(0,
M
,
Um—n
);

223 
b‘a0_
 = 
b‘a0
[0] + 
M
;

224 
vec
 
mu0_
 = (
M
*
Um—n
)/
b‘a0_
;

225 
nu0_
 = 
nu0
 +
M
;

226 
vec
 
dMu
 = - 
Um—n
;

227 ià(
debug
)

228 
¡d
::
cout
<<"dMu:"<<
dMu
<<"b‘a0: "<<
b‘a0
[0]<<" b‘a0_ "<<
b‘a0_
<<"‚u0_ " <<
nu0_
<<" mu0_ " << 
mu0_
<<
’dl
;

230 
m©
 
Um—nT
 = 
M
*
	`ou‹r_´oduù
(
Um—n
, Umean);

231 
	`as£¹
(
Um—nT
.
	`rows
(è=ğ
D
 && Um—nT.
	`cŞs
() == D);

232 
m©
 
dMuT
 = (
b‘a0
[0]/
b‘a0_
)*
Um—nT
;

233 
m©
 
iW0_
 = 
iW0
 + 
UUT
 - 
Um—nT
 + 
dMuT
;

234 
m©
 
W0_
;

235 
boŞ
 
»t
 =
	`šv
(
iW0_
, 
W0_
);

236 
	`as£¹
(
»t
);

237 
m©
 
tmp
 = (
W0_
+
	`Œª¥o£
(W0_))*0.5;

238 ià(
debug
)

239 
¡d
::
cout
<<
iW0
<<
UUT
<<
Um—nT
<<
dMuT
<<
W0_
<<
tmp
<<
nu0_
<<
’dl
;

240 
A_U
 = 
	`wishºd
(
tmp
, 
nu0_
);

241 
m©
 
tmp2
;

242 
»t
 = 
	`šv
(
b‘a0_
 * 
A_U
, 
tmp2
);

243 
	`as£¹
(
»t
);

244 
mu_U
 = 
	`mvÄndex
(
mu0_
, 
tmp2
, 
D
, 0);

245 ià(
debug
)

246 
¡d
::
cout
<<"Sam¶šg from U" <<
A_U
<<" "<<
mu_U
<<" "<<
Um—n
<<" "<<
W0_
<<
tmp
<<
’dl
;

247 
	}
}

251 
	$§m¶e_V
(){

253 
vec
 
Vm—n
 = 
	`z”os
(
D
);

254 
m©
 
VVT
 = 
	`ÿlc_MMT
(
M
, M+
N
, 
Vm—n
);

256 
b‘a0_
 = 
b‘a0
[0] + 
N
;

257 
vec
 
mu0_
 = (
N
*
Vm—n
)/
b‘a0_
;

258 
nu0_
 = 
nu0
 +
N
;

259 
vec
 
dMu
 = - 
Vm—n
;

260 ià(
debug
)

261 
¡d
::
cout
<<"dMu:"<<
dMu
<<"b‘a0: "<<
b‘a0
[0]<<" b‘a0_ "<<
b‘a0_
<<"‚u0_ " <<
nu0_
<<
’dl
;

262 
m©
 
Vm—nT
 = 
N
*
	`ou‹r_´oduù
(
Vm—n
, Vmean);

263 
	`as£¹
(
Vm—nT
.
	`rows
(è=ğ
D
 && Vm—nT.
	`cŞs
() == D);

264 
m©
 
dMuT
 = (
b‘a0
[0]/
b‘a0_
)*
Vm—nT
;

265 
m©
 
iW0_
 = 
iW0
 + 
VVT
 - 
Vm—nT
 + 
dMuT
;

266 
m©
 
W0_
;

267 
boŞ
 
»t
 = 
	`šv
(
iW0_
, 
W0_
);

268 
	`as£¹
(
»t
);

269 
m©
 
tmp
 = (
W0_
+
	`Œª¥o£
(W0_))*0.5;

270 ià(
debug
)

271 
¡d
::
cout
<<"iW0: "<<
iW0
<<" VVT: "<<
VVT
<<" Vm—nT: "<<
Vm—nT
<<" dMuT: " <<
dMuT
<<"W0_"<< 
W0_
<<"mp: " << 
tmp
<<"‚u0_: "<<
nu0_
<<
’dl
;

272 
A_V
 = 
	`wishºd
(
tmp
, 
nu0_
);

273 
m©
 
tmp2
;

274 
»t
 = 
	`šv
(
b‘a0_
*
A_V
, 
tmp2
);

275 
	`as£¹
(
»t
);

276 
mu_V
 = 
	`mvÄndex
(
mu0_
, 
tmp2
, 
D
, 0);

277 ià(
debug
)

278 
¡d
::
cout
<<"Sam¶šg from V: A_V" <<
A_V
<<" mu_V: "<<
mu_V
<<" Vm—n: "<<
Vm—n
<<" W0_: "<<
W0_
<<"mp: "<<
tmp
<<
’dl
;

279 
	}
}

283 
	$§m¶e_hy³½riÜs
(
»s
){

284 
	`§m¶e_®pha
(
»s
);

285 
	`§m¶e_U
();

286 
	`§m¶e_V
();

289 
	}
}

291 
ouut_pmf_»suÉ
(
¡d
::
¡ršg
 
f’ame
) {

292 
MMOuu‰”_m©
<
v”‹x_d©a
> 
u£r_m©
(
f’ame
 + "_U.mm", 0, 
M
 , "Thi fcÚš PMF ouuˆm©rix U. IÀ—ch„ow D faùÜ oà¨sšgË u£¸node.", 
Ï‹Á_çùÜs_šmem
);

293 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
™em_m©
(
f’ame
 + "_V.mm", 
M
 ,M+
N
, "Thi fcÚš PMF ouuˆm©rix V. IÀ—ch„ow D faùÜ oà¨sšgË i‹m‚ode.", 
Ï‹Á_çùÜs_šmem
);

294 
log¡»am
(
LOG_INFO
è<< "PMF ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << "_U.mm" <<

295 ", " << 
	gf’ame
 + "_V.mm " << 
	g¡d
::
’dl
;

304 
	gPMFV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

309 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

310 
	gv”‹x_d©a
 & 
	gvd©a
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

311 
boŞ
 
	gisu£r
 = 
v”‹x
.
id
(è< 
M
;

312 
m©
 
	gXtX
 = m©::
Z”o
(
D
, D);

313 
vec
 
	gXty
 = vec::
Z”o
(
D
);

315 
boŞ
 
	gcompu‹_rm£
 = (
v”‹x
.
num_ou‹dges
() > 0);

317 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

318 cÚ¡ 
	gedge_d©a
 & 
	gedge
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

319 
	gob£rv©iÚ
 = 
edge
.
weight
;

320 
	gv”‹x_d©a
 & 
	gnbr_Ï‹Á
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

321 
	gXty
 +ğ
nbr_Ï‹Á
.
pvec
 * 
ob£rv©iÚ
;

322 
	gXtX
.
	gŒŸnguÏrV›w
<
	gEig’
::
Uµ”
>(è+ğ
nbr_Ï‹Á
.
pvec
 *‚br_Ï‹Á.pvec.
Œª¥o£
();

323 ià(
	gcompu‹_rm£
) {

324 
	g´ediùiÚ
;

325 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
pmf_´ediù
(
vd©a
, 
nbr_Ï‹Á
, 
ob£rv©iÚ
, 
´ediùiÚ
, (*)&
edge
.
avg´d
);

326 
	gv”‹x
.
edge
(
e
)->
£t_d©a
(edge);

330 
	gi
=0; i < 
	gD
; i++è
XtX
(
i
,iè+ğ(
Ïmbda
);

333 
m©
 
	giAi_
;

334 
boŞ
 
	g»t
 =
šv
((
isu£r
? 
A_U
 : 
A_V
è+ 
®pha
 * 
XtX
, 
iAi_
);

335 
as£¹
(
»t
);

336 
vec
 
	gmui_
 = 
iAi_
*((
isu£r
? (
A_U
*
mu_U
è: (
A_V
*
mu_V
)è+ 
®pha
 * 
Xty
);

337 
	gvd©a
.
	gpvec
 = 
mvÄndex
(
mui_
, 
iAi_
, 
D
, 0);

338 
as£¹
(
vd©a
.
pvec
.
size
(è=ğ
D
);

345 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

346 
	grm£_vec
 = 
z”os
(
gcÚ‹xt
.
exeùh»ads
);

354 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

355 ià(
	g™”©iÚ
 =ğ
pmf_buº_š
){

356 
´štf
("Finished burn-in…eriod. startingo‡ggregate samples\n");

358 ià(
	gpmf_add™iÚ®_ouut
 && 
	gi™”
 >ğ
pmf_buº_š
){

359 
buf
[256];

360 
¥rštf
(
buf
, "%s-%d", 
Œaššg
.
c_¡r
(), 
i™”
-
pmf_buº_š
);

361 
ouut_pmf_»suÉ
(
buf
);

364 
	g»s
 = 
Œaššg_rm£
(
™”©iÚ
, 
gcÚ‹xt
);

365 
§m¶e_hy³½riÜs
(
»s
);

366 
	grm£_šdex
 = 0;

367 
	grm£_ty³
 = 
VALIDATION
;

368 
v®id©iÚ_rm£
(&
pmf_´ediù
, 
gcÚ‹xt
, 3, &
v®id©iÚ_avg´od
, 
pmf_buº_š
);

369 ià(
	g™”©iÚ
 >ğ
pmf_buº_š
){

370 
rm£_šdex
 = 0;

371 
	grm£_ty³
 = 
TEST
;

372 
‹¡_´ediùiÚs
(&
pmf_´ediù
, &
gcÚ‹xt
, 
i™”
 =ğ
n™”s
-1, &
‹¡_avg´od
);

374 
	gi™”
++;

382 
	$š™_pmf
(){

383 
	`š™_£lf_pÙ
();

384 
	}
}

387 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

389 
	`´št_cİyright
();

393 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

397 
m‘rics
 
	`m
("pmf-inmemory-factors");

399 
Ïmbda
 = 
	`g‘_İtiÚ_æßt
("lambda", 0.065);

400 
debug
 = 
	`g‘_İtiÚ_št
("debug", debug);

401 
pmf_buº_š
 = 
	`g‘_İtiÚ_št
("pmf_burn_in",…mf_burn_in);

402 
pmf_add™iÚ®_ouut
 = 
	`g‘_İtiÚ_št
("pmf_additional_output",…mf_additional_output);

404 
	`·r£_commªd_lše_¬gs
();

405 
	`·r£_im¶ic™_commªd_lše
();

409 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
edge_d©a
>(
Œaššg
, 
NULL
, 0, 0, 3, 
TRAINING
, 
çl£
);

410 
š™_ã©u»_veùÜs
<
¡d
::
veùÜ
<
v”‹x_d©a
> >(
M
+
N
, 
Ï‹Á_çùÜs_šmem
, !
lßd_çùÜs_äom_fe
);

411 
	`š™_pmf
();

413 ià(
lßd_çùÜs_äom_fe
){

414 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_U.mm", 0, 
D
);

415 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_V.mm", 
M
, 
D
);

419 
PMFV”tiûsInMemProg¿m
 
´og¿m
;

420 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

421 
	`£t_’gše_æags
(
’gše
, 
Œue
);

422 
³ngše
 = &
’gše
;

423 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

426 ià(!
qu›t
)

427 
	`m‘rics_»pÜt
(
m
);

430 
	}
}

	@toolkits/collaborative_filtering/printouts.hpp

1 #iâdeà
PRINTOUTS


2 
	#PRINTOUTS


	)

3 
	#MAX_PRINTOUT_LEN
 25

	)

5 
boŞ
 
	gabsŞu‹_v®ue
 = 
Œue
;

7 
šlše
 
	$çbs2
(
v®
){

8 ià(
absŞu‹_v®ue
)

9  
	`çbs
(
v®
);

10  
v®
;

11 
	}
}

13 
	$´št_vec
(cÚ¡ * 
Çme
, cÚ¡ 
Di¡Vec
 & 
vec
, 
boŞ
 
high
 = 
çl£
){

14 ià(!
debug
)

16 
i
;

17 
	`´štf
("%s[%d]\n", 
Çme
, 
vec
.
off£t
);

18 
i
=
vec
.
¡¬t
; i< 
¡d
::
	`mš
(vec.
’d
, 
MAX_PRINTOUT_LEN
); i++){

19 ià(
high
)

20 
	`´štf
("%15.15lg ", 
	`çbs2
(
Ï‹Á_çùÜs_šmem
[
i
].
pvec
[
vec
.
off£t
]));

22 
	`´štf
("%.5lg ", 
	`çbs2
(
Ï‹Á_çùÜs_šmem
[
i
].
pvec
[
vec
.
off£t
]));

24 
	`´štf
("\n");

25 
	}
}

26 
	$´št_vec
(cÚ¡ * 
Çme
, cÚ¡ 
vec
 & 
pvec
, 
boŞ
 
high
 = 
çl£
){

27 ià(!
debug
)

29 
	`´štf
("%s\n", 
Çme
);

30 
i
ğ0; i< 
¡d
::
	`mš
(()
pvec
.
	`size
(), 
MAX_PRINTOUT_LEN
); i++){

31 ià(
high
)

32 
	`´štf
("%15.15lg ", 
	`çbs2
(
pvec
[
i
]));

34 
	`´štf
("%.5lg ", 
	`çbs2
(
pvec
[
i
]));

36 
	`´štf
("\n");

37 
	}
}

38 
	$´št_m©
(cÚ¡ * 
Çme
, cÚ¡ 
m©
 & 
pm©
, 
boŞ
 
high
 = 
çl£
){

39 ià(!
debug
)

41 
	`´štf
("%s\n", 
Çme
);

42 
m©
 
pm©2
 = 
	`Œª¥o£
((m©&)
pm©
);

43 ià(
pm©2
.
	`cŞs
() == 1)

44 
pm©2
 =…m©2.
	`Œª¥o£
();

45 
i
ğ0; i< 
¡d
::
	`mš
(()
pm©2
.
	`rows
(), 
MAX_PRINTOUT_LEN
); i++){

46 
j
=0; j< 
¡d
::
	`mš
(()
pm©2
.
	`cŞs
(), 
MAX_PRINTOUT_LEN
); j++){

47 ià(
high
)

48 
	`´štf
("%15.15lg ", 
	`çbs2
(
	`g‘_v®
(
pm©2
, 
i
, 
j
)));

50 
	`´štf
("%.5lg ", 
	`çbs2
(
	`g‘_v®
(
pm©2
, 
i
, 
j
)));

52 
	`´štf
("\n");

55 
	}
}

57 
´št_vec_pos
(
¡d
::
¡ršg
 
Çme
, 
vec
 & 
v
, 
i
){

58 ià(!
	gdebug
)

60 ià(
	gi
 == -1)

61 
´štf
("%s\n", 
Çme
.
c_¡r
());

63 
´štf
("%s[%d]: %.5lg\n", 
Çme
.
c_¡r
(), 
i
, 
çbs
(
v
[i]));

66 
	gj
=0; j< 
	g¡d
::
mš
(()
v
.
size
(),
MAX_PRINTOUT_LEN
); j++){

67 
´štf
("%.5lg", 
çbs2
(
v
(
j
)));

68 ià(
	gv
.
size
() > 1)

69 
´štf
(" ");

71 
´štf
("\n");

75 
	#PRINT_VEC
(
a
è
	`´št_vec
(#a,a,0)

	)

76 
	#PRINT_VEC2
(
a
,
b
è
	`´št_vec
×,b,0)

	)

77 
	#PRINT_VEC3
(
a
,
b
,
c
è
	`´št_vec_pos
×,b,c)

	)

78 
	#PRINT_VEC2_HIGH
(
a
,
i
è
	`´št_vec
(#a,a[i],1)

	)

79 
	#PRINT_INT
(
a
èià(
debug
è
	`´štf
("%s: %d\n", #a,‡);

	)

80 
	#PRINT_NAMED_INT
(
a
,
b
èià(
debug
è
	`´štf
("%s: %d\n",a, b);

	)

81 
	#PRINT_DBL
(
a
èià(
debug
è
	`´štf
("%s: %.5lg\n", #a,‡);

	)

82 
	#PRINT_NAMED_DBL
(
a
,
b
èià(
debug
è
	`´štf
("%s: %.5lg\n",‡, b);

	)

83 
	#PRINT_MAT
(
a
è
	`´št_m©
(#a,‡, 0);

	)

84 
	#PRINT_MAT2
(
a
,
b
è
	`´št_m©
×,b,0);

	)

	@toolkits/collaborative_filtering/prob.hpp

24 #iâdeà
NPROB_HPP


25 
	#NPROB_HPP


	)

28 
	~<cm©h
>

29 
	#pi
 3.14152965

	)

38 
usšg
 
Çme¥aû
 
	g¡d
;

45 
	$gamdev
(
Ÿ
)

47 
j
;

48 
am
,
e
,
s
,
v1
,
v2
,
x
,
y
;

50 
	`as£¹
(
Ÿ
>=1);

51 ià(
Ÿ
 < 6) {

52 
x
=1.0;

53 
j
=1;j <ğ
Ÿ
;j++è
x
 *ğ
	`d¿nd48
();

54 
x
 = -
	`log
(x);

59 
v1
=
	`d¿nd48
();

60 
v2
=2.0*
	`d¿nd48
()-1.0;

61 } 
v1
*v1+
v2
*v2 > 1.0);

62 
y
=
v2
/
v1
;

63 
am
=
Ÿ
-1;

64 
s
=
	`sq¹
(2.0*
am
+1.0);

65 
x
=
s
*
y
+
am
;

66 } 
x
 <= 0.0);

67 
e
=(1.0+
y
*y)*
	`exp
(
am
*
	`log
(
x
/am)-
s
*y);

68 } 
	`d¿nd48
(è> 
e
);

70  
x
;

71 
	}
}

73 
vec
 
	$chi2ºd
(
vec
 
v
, 
size
){

75 
vec
 
»t
 = 
	`z”os
(
size
);

76 
i
=0; i<
size
; i++)

77 
»t
[
i
] = 2.0* 
	`gamdev
(
v
[i]/2.0);

79 #ifdeà
WISHART_TEST


80 
»t
 = 
	`vec
("9.3343 9.2811 9.3583 9.3652 9.3031");

81 
»t
*= 1e+04;

82 #–ià
	`defšed
(
WISHART_TEST2
)

83 
»t
 = 
	`vec
("4.0822e+03");

85  
»t
;

87 
	}
}

89 
	$¿ndv
(
n
, 
vec
 & 
»t
){

90 
	`as£¹
(
n
>=1);

91 
i
=0; i< 
n
; i++)

92 
»t
[
i
] = 
	`d¿nd48
();

93 
	}
}

95 
m©
 
	$¿ndn1
(
Dx
, 
Dy
, 
cŞ
){

96 ià(
Dx
 == 0)

97 
Dx
 = 1;

98 
	`as£¹
(
Dy
>=1);

99 
m©
 
»t
 = 
	`z”os
(
Dx
,
Dy
);

100 
vec
 
us
 = 
	`z”os
(
	`û
(
Dx
*
Dy
/2.0)*2);

101 
	`¿ndv
(
	`û
(
Dx
*
Dy
/2.0)*2, 
us
);

102 
k
=0;

103 
i
=0; i<
Dx
; i++){

104 
j
=0; j< 
Dy
; j++){

105 ià(
k
 % 2 == 0)

106 
	`»t
(
i
,
j
èğ
	`sq¹
(-2.0*
¡d
::
	`log
(
us
[
k
/2]))*¡d::
	`cos
(2*
pi
*us[k/2+1]);

108 
	`»t
(
i
,
j
èğ
	`sq¹
(-2.0*
¡d
::
	`log
(
us
[
k
/2]))*¡d::
	`sš
(2*
pi
*us[k/2+1]);

109 
k
++;

112 
	`as£¹
(
k
 =ğ
Dx
*
Dy
);

113 
	`as£¹
(
»t
.
	`rows
(è=ğ
Dx
 &&„‘.
	`cŞs
(è=ğ
Dy
);

114  
»t
;

115 
	}
}

117 
vec
 
	$¿ndn1_vec
(
Dx
, 
Dy
, 
cŞ
){

118 
m©
 
»t
 = 
	`¿ndn1
(
Dx
,
Dy
,
cŞ
);

119  
	`g‘_cŞ
(
»t
, 
cŞ
);

120 
	}
}

123 
vec
 
	$mvÄndex
(
vec
 &
mu
, 
m©
 &
sigma
, 
d
, 
»guÏriz©iÚ
){

124 
	`as£¹
(
mu
.
	`size
(è=ğ
d
);

125 ià(
»guÏriz©iÚ
 > 0)

126 
sigma
 = sigma+ 
»guÏriz©iÚ
*
	`eye
(sigma.
	`rows
());

127 
m©
 
tmp
;

128 
boŞ
 
»t
 = 
	`chŞ
(
sigma
, 
tmp
);

129 ià(!
»t
)

130 
	`log¡»am
(
LOG_FATAL
)<<"ChŞesky decompos™iÚ iÀmvÄÃd(ègÙ iÁØnum”iÿÈ”rÜs. TryØ£ˆ--b±f_chŞ_dŸgÚ®_weightšg commªd†š¬gum’ˆtØadd„eguÏriz©iÚ" << 
¡d
::
’dl
;

131 
vec
 
x
 = 
	`z”os
(
d
);

132 
vec
 
cŞ
 = 
	`¿ndn1_vec
(
mu
.
	`size
(), 1,0);

133 
x
 = 
mu
 + 
	`Œª¥o£
(
tmp
è* 
cŞ
;

134 
	`as£¹
(
x
.
	`size
(è=ğ
d
);

135  
x
;

136 
	}
}

138 
m©
 
	$lßd_™œu
(
m©
 &
a
, m©& 
b
){

139 
	`as£¹
(
a
.
	`size
() >= 1);

141 ià(
a
.
	`rows
(è=ğ1 &&‡.
	`cŞs
() == 1)

142  
a
;

144 
	`as£¹
(
b
.
	`cŞs
() == 1);

145 
	`as£¹
(
a
.
	`rows
(è=ğa.
	`cŞs
());

146 
n
 = 
a
.
	`rows
();

147 
k
 = 0;

148 
i
=0; i< 
n
; i++)

149 
j
=
i
+1; j< 
n
; j++){

151 
	`£t_v®
(
a
,
i
,
j
,
	`g‘_v®
(
b
,
k
++,0));

153 
	`as£¹
(
k
 =ğ(
n
*(n-1))/2.0);

154  
a
;

155 
	}
}

157 
vec
 
	$£qu’û
(
df
, 
n
){

158 
	`as£¹
(
n
 >= 1);

159 
	`as£¹
(
df
>= 0);

161 
vec
 
	`»t
(
n
);

162 
i
=0; i<
n
; i++)

163 
»t
[
i
] = 
df
 - i;

165  
»t
;

166 
	}
}

169 
m©
 
	$wishºd
(
m©
& 
sigma
, 
df
){

171 
m©
 
d
;

173 
boŞ
 
»t
 = 
	`chŞ
(
sigma
, 
d
);

175 
	`as£¹
(
»t
);

176 
n
 = 
sigma
.
	`rows
();

177 
m©
 
x
 = 
	`z”os
(
n
,nè,
a
 = zeros(n,n);

178 
m©
 
b
;

180 ià((
df
 <ğ81+
sigma
.
	`rows
()è&& (dà=ğ::
	`round
(df))){

181 
x
 = 
	`¿ndn
(()
df
, 
d
.
	`rows
())*d;

184 
vec
 
£q
 = 
	`£qu’û
(
df
, 
n
);

186 
vec
 
»t
 = 
	`chi2ºd
(
£q
, 
n
);

188 
»t
 = ::
	`sq¹
(ret);

191 ià(
»t
.
	`size
() == 1)

192 
	`£t_v®
(
a
,0,0, 
»t
[0]);

194 
	`£t_dŸg
(
a
,
»t
);

196 
	`as£¹
(
a
.
	`rows
(è=ğ
n
 &&‡.
	`cŞs
() ==‚);

199 ià(
»t
.
	`size
() > 1){

200 
b
 = 
	`¿ndn
(
n
*(n-1)/2,1);

201 
	`as£¹
(
b
.
	`cŞs
() == 1);

203 #ifdeà
WISHART_TEST


204 
b
=
	`z”os
(10,1); b = 
	`m©
("0.1139 ; 1.0668 ; -0.0956 ; -1.3362; 0.0593 ; -0.8323 ; 0.7143; 0.2944 ; 1.6236; -0.6918");

206 #–ià
	`defšed
(
WISHART_TEST2
)

207 
b
 = 
	`m©
(0,0);

210 ià(
»t
.
	`size
() > 1)

211 
a
 = 
	`lßd_™œu
×,
b
);

214 
x
 = 
a
*
d
;

219 
m©
 
c
ğ
	`Œª¥o£
(
x
)*x;

220 
	`as£¹
(
c
.
	`rows
(è=ğ
n
 && c.
	`cŞs
() ==‚);

223 
	`as£¹
(
	`abs_sum
(
c
)!= 0);

224  
c
;

225 
	}
}

227 
	$‹¡_wishºd
(){

228 #iâdeà
WISHART_TEST


229 
	`as£¹
(
çl£
);

231 
m©
 
a
 = 
	`š™_m©
(" 0.2977 -0.0617 -0.1436 -0.0929 0.0136;"

236 
	`as£¹
(
a
.
	`rows
(è=ğa.
	`cŞs
() &&‡.rows() == 5);

237 
a
 *= 1.0e-03;

239 
df
 = 93531;

241 
m©
 
b
 = 
	`wishºd
(
a
,
df
);

242 
m©
 
Œu”‘
 = 
	`š™_m©
(" 27.7883 -5.6442 -13.3231 -8.7063 1.2395;"

247 
diff
 = 
	`sumsum
(
b
-
Œu”‘
)/(25.0);

248 
	`as£¹
(
	`çbs
(
diff
) < 1e-2);

250 
	}
}

251 
	$‹¡_wishºd2
(){

252 #iâdeà
WISHART_TEST2


253 
	`as£¹
(
çl£
);

256 
m©
 
a
 = 
	`š™_m©
("3", 1, 1);

257 
	`as£¹
(
a
.
	`rows
(è=ğa.
	`cŞs
() &&‡.rows() == 1);

258 
df
 = 4122;

260 
m©
 
b
 = 
	`wishºd
(
a
,
df
);

261 
m©
 
Œu”‘
 = 
	`š™_m©
("1.2247e+04",1,1);

262 
diff
 = 
	`sumsum
(
b
-
Œu”‘
);

263 
	`as£¹
(
	`çbs
(
diff
) < 1);

265 
	}
}

267 
	$‹¡_¿ndn
(){

268 #ià(
	`defšed
(
WISHART_TEST2
è|| defšed(
WISHART_TEST
))

269 
	`as£¹
(
çl£
);

272 
m©
 
a
 = 
	`¿ndn
(10000000,1);

273 
»t
 = 
	`çbs
(
	`sumsum
(
a
)/10000000);

274 
	`as£¹
(
»t
 < 4e-3);

278 
	}
}

280 
	$‹¡_mvÄndex
(){

282 
m©
 
sigma
 = 
	`š™_m©
(

289 
vec
 
mu
 = 
	`š™_vec
("95532 -1 2 3 0 22", 5);

291 
vec
 
»t
 = 
	`z”os
(6);

292 
i
=0; i<10000; i++){

293 
»t
+ğ
	`mvÄndex
(
mu
,
sigma
,6,0);

295 
»t
 /= 10000;

297 
vec
 
ªs
 = 
	`š™_vec
("95532.0115 -0.996855354 2.00914034 2.99521376 -0.0105874825 22.0127606", 6);

298 
cout
<<
»t
<<
’dl
<<
	`nÜm
(
ªs
-ret)<<endl;

301 
	}
}

306 
	$‹¡_chi2ºd
(){

307 
vec
 
»t
 = 
	`z”os
(6);

308 
vec
 
v
 = 
	`š™_vec
("95532 95531 95530 95529 95528 95527", 6);

309 
i
=0; i< 1000000; i++){

310 
»t
 +ğ
	`chi2ºd
(
v
, 6);

312 
»t
 /= 1000000;

313 
vec
 
ªs
 = 
	`š™_vec
("95531.99 95531.672 95530.016 95530.005 95527.495 95527.447", 6);

314 
cout
<<
»t
<<
’dl
<<
	`nÜm
(
ªs
-ret)<<endl;

316 
	}
}

318 
	$‹¡_wishºd3
(){

320 
m©
 
sigma
 = 
	`š™_m©
(

327 
df
 = 95532;

329 
m©
 
»t
 = 
	`z”os
(6,6);

330 
i
=0; i<10000; i++){

331 
»t
+ğ
	`wishºd
(
sigma
, 
df
);

333 
»t
 /= 10000;

335 
m©
 
ªs
 = 
	`š™_m©
("9.463425666451165 -0.090326102576222 -0.091016693707751 -0.089933822069320 -0.090108095540542 -0.089915220156678 ;\
-0.090326102576222 9.462305273959634 -0.090071105888907 -0.090355541326424 -0.090556802227637 -0.089887181087950 ;\
-0.091016693707751 -0.090071105888907 9.462973812711439 -0.090185140101184 -0.090013352917616 -0.089803917691135 ;\
-0.089933822069320 -0.090355541326424 -0.090185140101184 9.462292292298272 -0.090233918216433 -0.090557276073727 ;\
-0.090108095540542 -0.090556802227637 -0.090013352917616 -0.090233918216433 9.461377045031403 -0.089774502028808 ;\
-0.089915220156678 -0.089887181087950 -0.089803917691135 -0.090557276073727 -0.089774502028808 9.463220187604252", 6, 6);

341 
ªs
 *= 1.0e+04;

343 
cout
<<
»t
<<
’dl
<<
	`nÜm
(
ªs
-ret)<<endl;

344 
	}
}

	@toolkits/collaborative_filtering/rating.cpp

33 
	~"commÚ.hµ
"

34 
	~"eig’_w¿µ”.hµ
"

35 
	~"tim”.hµ
"

37 
	gdebug
;

38 
	gnum_¿tšgs
;

39 
	gkÂ_§m¶e_³rûÁ
 = 1.0;

40 cÚ¡ 
	g•sÚ
 = 1e-16;

41 
tim”
 
	gmytim”
;

42 
	gtok’s_³r_row
 = 3;

44 
	sv”‹x_d©a
 {

45 
vec
 
	m¿tšgs
;

46 
ivec
 
	mids
;

47 
vec
 
	mpvec
;

49 
v”‹x_d©a
() {

51 
£t_v®
(
šdex
, 
v®
){

52 
	mpvec
[
šdex
] = 
v®
;

54 
g‘_v®
(
šdex
){

55  
	mpvec
[
šdex
];

59 
	sedge_d©a
 {

60 
	mweight
;

62 
edge_d©a
(è{ 
	mweight
 = 0; }

64 
edge_d©a
(
weight
) : weight(weight) { }

67 
	sedge_d©a4
 {

68 
	mweight
;

69 
	mtime
;

71 
edge_d©a4
(è{ 
	mweight
 = 
time
 = 0; }

73 
edge_d©a4
(
weight
, 
time
) : weight(weight),ime(time) { }

81 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

82 
edge_d©a
 
	tEdgeD©aTy³
;

84 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

85 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

87 
	$®s_´ediù
(cÚ¡ 
v”‹x_d©a
& 
u£r
,

88 cÚ¡ 
v”‹x_d©a
& 
mov›
,

89 cÚ¡ 
¿tšg
,

90 & 
´ediùiÚ
){

93 
´ediùiÚ
 = 
	`dÙ_´od
(
u£r
.
pvec
, 
mov›
.pvec);

95 
´ediùiÚ
 = 
¡d
::
	`mš
((í»diùiÚ, 
maxv®
);

96 
´ediùiÚ
 = 
¡d
::
	`max
((í»diùiÚ, 
mšv®
);

98 
”r
 = 
¿tšg
 - 
´ediùiÚ
;

99 
	`as£¹
(!
¡d
::
	`i¢ª
(
”r
));

100  
”r
*err;

102 
	}
}

105 
	$¿tšg_¡©s
(){

107 
mš
=1e100, 
max
=0, 
avg
=0;

108 
út
 = 0;

109 
¡¬tv
 = 0;

110 
’dv
 = 
M
;

112 
i
=
¡¬tv
; i< 
’dv
; i++){

113 
v”‹x_d©a
& 
d©a
 = 
Ï‹Á_çùÜs_šmem
[
i
];

114 ià(
d©a
.
¿tšgs
.
	`size
() > 0){

115 
mš
 = 
¡d
::
	`mš
(mš, 
d©a
.
¿tšgs
[0]);

116 
max
 = 
¡d
::
	`max
(max, 
d©a
.
¿tšgs
[0]);

117 ià(
¡d
::
	`i¢ª
(
d©a
.
¿tšgs
[0]))

118 
	`´štf
("bug:‚ª oÀ%d\n", 
i
);

120 
avg
 +ğ
d©a
.
¿tšgs
[0];

121 
út
++;

126 
	`´štf
("Di¡ªû sti¡ics: mš %g max %g‡vg %g\n", 
mš
, 
max
, 
avg
/
út
);

127 
	}
}

131 
	g‹m¶©e
<
ty³Çme
 
	gv”‹x_d©a
>

132 
»ad_çùÜs
(
¡d
::
¡ršg
 
ba£_f’ame
, 
boŞ
 
u£rs
) {

134 
	g»t_code
;

135 
MM_ty³code
 
	gm©code
;

136 
FILE
 *
	gf
;

137 
size_t
 
	gnz
;

138 
ušt
 
	g_M
, 
	g_N
;

140 
	gf
 = 
fİ’
(
ba£_f’ame
.
c_¡r
(), "r");

141 ià(
	gf
 =ğ
NULL
)

142 
log¡»am
(
LOG_FATAL
è<< "Could‚Ù o³Àfe: " << 
ba£_f’ame
 << 
¡d
::
’dl
;

144 ià(
mm_»ad_bªÃr
(
f
, &
m©code
) != 0)

145 
log¡»am
(
LOG_FATAL
è<< "Could‚Ù…roûs M©rix M¬k‘ bªÃr. Fe: " << 
ba£_f’ame
 << 
¡d
::
’dl
;

147 ià(!
mm_is_d’£
(
m©code
))

148 
log¡»am
(
LOG_FATAL
è<< "ProbËm„—dšg iÅuˆfe: " << 
	gba£_f’ame
 << " Should bš d’£ m©rix m¬k‘ fÜm©"<< 
	g¡d
::
’dl
;

150 
ušt
 
	gã©u»_width
;

151 ià(
	gu£rs
){

152 ià((
	g»t_code
 = 
mm_»ad_mtx_¬¿y_size
(
f
, &
_M
, &
ã©u»_width
)) !=0) {

153 
log¡»am
(
LOG_FATAL
è<< "Faed„—dšg m©rix size:ƒ¼Ü=" << 
»t_code
 << 
¡d
::
’dl
;

155 ià(
	g_M
 !ğ
M
)

156 
log¡»am
(
LOG_FATAL
è<< "WrÚg sizoàã©u» veùÜ m©rix. Should b" << 
M
 << "„ow š¡—d oà" << 
_M
 << 
¡d
::
’dl
;

159 ià((
	g»t_code
 = 
mm_»ad_mtx_¬¿y_size
(
f
, &
_N
, &
ã©u»_width
)) !=0) {

160 
log¡»am
(
LOG_FATAL
è<< "Faed„—dšg m©rix size:ƒ¼Ü=" << 
»t_code
 << 
¡d
::
’dl
;

162 ià(
	g_N
 !ğ
N
)

163 
log¡»am
(
LOG_FATAL
è<< "WrÚg sizoàã©u» veùÜ m©rix. Should b" << 
N
 << "„ow š¡—d oà" << 
_N
 << 
¡d
::
’dl
;

166 
	gD
 = ()
ã©u»_width
;

167 
log¡»am
(
LOG_INFO
) << "Startingo„ead matrix-market input. Matrix dimensions: "

168 << (
	gu£rs
? 
	gM
 :
N
è<< " x " << 
D
 << ",‚Ú-z”os: " << (
u£rs
?
M
:N)*D << 
¡d
::
’dl
;

170 
	gv®
;

171 
	gnz
 = 
M
*
D
;

173 
size_t
 
	gi
=(
u£rs
? 0 : 
M
); i< (
	gu£rs
? 
	gM
 : M+
N
); i++)

174 
size_t
 
	gj
=0; j < (
	gsize_t
)
	gD
; j++)

176 
	grc
 = 
fsÿnf
(
f
, "%lg", &
v®
);

177 ià(
	grc
 != 1)

178 
log¡»am
(
LOG_FATAL
)<<"E¼Ü wh’„—dšg iÅuˆf©†š" << 
i
 << 
¡d
::
’dl
;

179 ià(
	gÏ‹Á_çùÜs_šmem
[
i
].
	gpvec
.
size
() == 0){

180 
Ï‹Á_çùÜs_šmem
[
i
].
pvec
 = 
z”os
(
D
);

181 
	gÏ‹Á_çùÜs_šmem
[
i
].
	g¿tšgs
 = 
z”os
(
num_¿tšgs
);

182 
	gÏ‹Á_çùÜs_šmem
[
i
].
	gids
 = 
ivec
::
Z”o
(
num_¿tšgs
);

184 
	gÏ‹Á_çùÜs_šmem
[
i
].
	gpvec
[
j
] = 
v®
;

187 
fşo£
(
f
);

191 
	~"io.hµ
"

201 
	g‹m¶©e
<
ty³Çme
 
	gV”‹xD©aTy³
,y³Çm
	gEdgeD©aTy³
>

202 
	gR©šgV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

208 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

211 ià(
	gv”‹x
.
id
(è>ğ
M
)

214 
	gv”‹x_d©a
 & 
	gvd©a
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

215 
	ghowmªy
 = ()(
N
*
kÂ_§m¶e_³rûÁ
);

216 
as£¹
(
howmªy
 > 0 );

217 
vec
 
	gdi¡ªûs
 = 
z”os
(
howmªy
);

218 
ivec
 
	gšdiûs
 = ivec::
Z”o
(
howmªy
);

219 
	gi
=0; i< 
	ghowmªy
; i++){

220 
	gšdiûs
[
i
]= -1;

222 
	g¡d
::
veùÜ
<
boŞ
> 
cu¼©šgs
;

223 
	gcu¼©šgs
.
»size
(
N
);

224 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

226 
as£¹
(
v”‹x
.
edge
(
e
)->
v”‹x_id
(è- 
M
 >ğ0 && v”‹x.edgeÓ)->v”‹x_id(è- M < 
N
);

227 
	gcu¼©šgs
[
v”‹x
.
edge
(
e
)->
v”‹x_id
(è- 
M
] = 
Œue
;

229 ià(
	gkÂ_§m¶e_³rûÁ
 == 1.0){

230 
ušt
 
i
=
M
; 
	gi
< 
	gM
+
	gN
; i++){

231 ià(
	gcu¼©šgs
[
i
-
M
])

233 
	gv”‹x_d©a
 & 
	gÙh”
 = 
Ï‹Á_çùÜs_šmem
[
i
];

234 
	gdi¡
;

235 
®s_´ediù
(
vd©a
, 
Ùh”
, 0, 
di¡
);

236 
	gšdiûs
[
i
-
M
] = i-M;

237 
	gdi¡ªûs
[
i
-
M
] = 
di¡
 + 1e-10;

240 
	gi
=0; i<
	ghowmªy
; i++){

241 
	g¿ndom_Ùh”
 = ::
¿ndi
(
M
, M+
N
-1);

242 
	gv”‹x_d©a
 & 
	gÙh”
 = 
Ï‹Á_çùÜs_šmem
[
¿ndom_Ùh”
];

243 
	gdi¡
;

244 
®s_´ediù
(
vd©a
, 
Ùh”
, 0, 
di¡
);

245 
	gšdiûs
[
i
] = 
¿ndom_Ùh”
-
M
;

246 
	gdi¡ªûs
[
i
] = 
di¡
;

249 
vec
 
out_di¡
(
num_¿tšgs
);

250 
ivec
 
	gšdiûs_sÜ‹d
 = 
»v”£_sÜt_šdex2
(
di¡ªûs
, 
šdiûs
, 
out_di¡
, 
num_¿tšgs
);

251 
as£¹
(
šdiûs_sÜ‹d
.
size
(è<ğ
num_¿tšgs
);

252 
as£¹
(
out_di¡
.
size
(è<ğ
num_¿tšgs
);

253 
	gvd©a
.
	gids
 = 
šdiûs_sÜ‹d
;

254 
	gvd©a
.
	g¿tšgs
 = 
out_di¡
;

255 ià(
	gdebug
)

256 
´štf
("Clo£¡ is: %d w™h di¡ªû %g\n", ()
vd©a
.
ids
[0], vd©a.
¿tšgs
[0]);

258 ià(
	gv”‹x
.
id
() % 1000 == 0)

259 
´štf
("Computšg„ecomm’d©iÚ fÜ u£¸%d‡ˆtime: %g\n", 
v”‹x
.
id
()+1, 
mytim”
.
cu¼’t_time
());

264 
	sMMOuu‰”_¿tšgs
{

265 
FILE
 * 
	moutf
;

266 
MMOuu‰”_¿tšgs
(
¡d
::
¡ršg
 
âame
, 
ušt
 
¡¬t
, ušˆ
’d
, std::¡ršg 
comm’t
) {

267 
as£¹
(
¡¬t
 < 
’d
);

268 
MM_ty³code
 
	mm©code
;

269 
£t_m©code
(
m©code
);

270 
	moutf
 = 
fİ’
(
âame
.
c_¡r
(), "w");

271 
as£¹
(
outf
 !ğ
NULL
);

272 
mm_wr™e_bªÃr
(
outf
, 
m©code
);

273 ià(
	mcomm’t
 != "")

274 
årštf
(
outf
, "%%%s\n", 
comm’t
.
c_¡r
());

275 
mm_wr™e_mtx_¬¿y_size
(
outf
, 
’d
-
¡¬t
, 
num_¿tšgs
+1);

276 
ušt
 
	mi
=
¡¬t
; i < 
	m’d
; i++){

277 
årštf
(
outf
, "%u ", 
i
+1);

278 
	mj
=0; j < 
	mÏ‹Á_çùÜs_šmem
[
i
].
	m¿tšgs
.
size
(); j++) {

279 
årštf
(
outf
, "%1.12", 
Ï‹Á_çùÜs_šmem
[
i
].
¿tšgs
[
j
]);

281 
årštf
(
outf
, "\n");

285 ~
MMOuu‰”_¿tšgs
() {

286 ià(
	moutf
 !ğ
NULL
è
fşo£
(
outf
);

290 
	sMMOuu‰”_ids
{

291 
FILE
 * 
	moutf
;

292 
MMOuu‰”_ids
(
¡d
::
¡ršg
 
âame
, 
ušt
 
¡¬t
, ušˆ
’d
, std::¡ršg 
comm’t
) {

293 
as£¹
(
¡¬t
 < 
’d
);

294 
MM_ty³code
 
	mm©code
;

295 
£t_m©code
(
m©code
);

296 
	moutf
 = 
fİ’
(
âame
.
c_¡r
(), "w");

297 
as£¹
(
outf
 !ğ
NULL
);

298 
mm_wr™e_bªÃr
(
outf
, 
m©code
);

299 ià(
	mcomm’t
 != "")

300 
årštf
(
outf
, "%%%s\n", 
comm’t
.
c_¡r
());

301 
mm_wr™e_mtx_¬¿y_size
(
outf
, 
’d
-
¡¬t
, 
num_¿tšgs
+1);

302 
ušt
 
	mi
=
¡¬t
; i < 
	m’d
; i++){

303 
årštf
(
outf
, "%u ", 
i
+1);

304 
	mj
=0; j < 
	mÏ‹Á_çùÜs_šmem
[
i
].
	mids
.
size
(); j++) {

305 
årštf
(
outf
, "%u ", ()
Ï‹Á_çùÜs_šmem
[
i
].
ids
[
j
]+1);

307 
årštf
(
outf
, "\n");

311 ~
MMOuu‰”_ids
() {

312 ià(
	moutf
 !ğ
NULL
è
fşo£
(
outf
);

319 
ouut_kÂ_»suÉ
(
¡d
::
¡ršg
 
f’ame
) {

320 
MMOuu‰”_¿tšgs
 
mmouut_¿tšgs
(
f’ame
 + ".¿tšgs", 0, 
M
, "This file contains user scalar„atings. Inƒach„ow i,‚um_ratingsop scalar„atings of different items for user i. (First column: user id,‚ext columns,op K„atings)");

321 
MMOuu‰”_ids
 
mmouut_ids
(
f’ame
 + ".ids", 0, 
M
 ,"This file contains item ids matchinghe„atings. Inƒach„ow i,‚um_ratingsop item ids for user i. (First column: user id,‚ext columns,op J„atings). Note: 0 item id meanshere‡re‚o more itemso„ecommend forhis user.");

323 
	g¡d
::
cout
 << "R©šg ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
f’ame
 << ".ratings" <<

324 ", " << 
f’ame
 + ".id " << 
¡d
::
’dl
;

327 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

329 
mytim”
.
	`¡¬t
();

330 
	`´št_cİyright
();

334 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

338 
m‘rics
 
	`m
("nmf-inmemory-factors");

340 
kÂ_§m¶e_³rûÁ
 = 
	`g‘_İtiÚ_æßt
("knn_sample_percent", 1.0);

341 ià(
kÂ_§m¶e_³rûÁ
 <= 0 || knn_sample_percent > 1)

342 
	`log¡»am
(
LOG_FATAL
)<<"Sam¶³rûÁshould bšh¿ng(0, 1] " << 
¡d
::
’dl
;

344 
num_¿tšgs
 = 
	`g‘_İtiÚ_št
("num_ratings", 10);

345 ià(
num_¿tšgs
 <= 0)

346 
	`log¡»am
(
LOG_FATAL
)<<"num_¿tšgs,hnumb” oà»com’ded i‹m fÜƒach u£r, should b>=1 " << 
¡d
::
’dl
;

348 
debug
 = 
	`g‘_İtiÚ_št
("debug", 0);

349 
tok’s_³r_row
 = 
	`g‘_İtiÚ_št
("tokens_per_row",okens_per_row);

350 
	`·r£_commªd_lše_¬gs
();

353 
nsh¬ds
 = 0;

354 ià(
tok’s_³r_row
 == 3)

355 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
edge_d©a
>(
Œaššg
, 
NULL
, 0, 0, 3, 
TRAINING
, 
çl£
);

356 ià(
tok’s_³r_row
 == 4)

357 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘4
<
edge_d©a4
>(
Œaššg
);

358 
	`log¡»am
(
LOG_FATAL
)<<"--tok’s_³r_row should be™h” 3 o¸4" << 
¡d
::
’dl
;

360 
	`as£¹
(
M
 > 0 && 
N
 > 0);

361 
Ï‹Á_çùÜs_šmem
.
	`»size
(
M
+
N
);

362 
»ad_çùÜs
<
v”‹x_d©a
>(
Œaššg
 + "_U.mm", 
Œue
);

363 
»ad_çùÜs
<
v”‹x_d©a
>(
Œaššg
 + "_V.mm", 
çl£
);

364 ià((
ušt
)
num_¿tšgs
 > 
N
){

365 
	`log¡»am
(
LOG_WARNING
)<<"num_¿tšg i toØbig - s‘tšg iˆto: " << 
N
 << 
¡d
::
’dl
;

366 
num_¿tšgs
 = 
N
;

368 
	`¤ªd
(
	`time
(
NULL
));

371 ià(
tok’s_³r_row
 == 3){

372 
R©šgV”tiûsInMemProg¿m
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
´og¿m
;

373 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

374 
	`£t_’gše_æags
(
’gše
);

375 
’gše
.
	`run
(
´og¿m
, 1);

377 ià(
tok’s_³r_row
 == 4){

378 
R©šgV”tiûsInMemProg¿m
<
V”‹xD©aTy³
, 
edge_d©a4
> 
´og¿m
;

379 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
edge_d©a4
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

380 
	`£t_’gše_æags
(
’gše
);

381 
’gše
.
	`run
(
´og¿m
, 1);

384 
	`ouut_kÂ_»suÉ
(
Œaššg
);

386 
	`¿tšg_¡©s
();

388 ià(!
qu›t
)

389 
	`m‘rics_»pÜt
(
m
);

391 
	}
}

	@toolkits/collaborative_filtering/rbm.cpp

30 
	~"commÚ.hµ
"

31 
	~"eig’_w¿µ”.hµ
"

33 
	grbm_®pha
 = 0.1;

34 
	grbm_b‘a
 = 0.06;

35 
	grbm_bšs
 = 6;

36 
	grbm_sÿlšg
 = 1;

37 
	grbm_muÉ_¡•_dec
= 0.9;

39 
boŞ
 
	$is_u£r
(
vid_t
 
id
){  id < 
M
; 
	}
}

40 
boŞ
 
	$is_™em
(
vid_t
 
id
){  id >ğ
M
 && id < 
N
; 
	}
}

41 
boŞ
 
	$is_time
(
vid_t
 
id
){  id >ğ
M
+
N
; 
	}
}

43 
	$£tRªd2
(* 
a
, 
d
, 
c
){

44 
i
 = 0; i < 
d
; ++i)

45 
a
[
i
] = ((
	`d¿nd48
(è- 0.5è* 
c
);

46 
	}
}

48 
	$dÙ
(* 
a
, * 
b
){

49 
»t
 = 0;

50 
i
 = 0; i < 
D
; ++i)

51 
»t
 +ğ
a
[
i
] * 
b
[i];

52  
»t
;

53 
	}
}

55 
	#BIAS_POS
 -1

	)

56 
	sv”‹x_d©a
 {

57 
vec
 
	mpvec
;

58 
	mbŸs
;

60 
v”‹x_d©a
() {

61 
	mbŸs
 = 0;

63 
£t_v®
(
šdex
, 
v®
){

64 ià(
	mšdex
 =ğ
BIAS_POS
)

65 
bŸs
 = 
v®
;

66 
	mpvec
[
šdex
] = 
v®
;

68 
g‘_v®
(
šdex
){

69 ià(
	mšdex
=ğ
BIAS_POS
)

70  
bŸs
;

71  
	mpvec
[
šdex
];

82 
	srbm_u£r
{

83 * 
	mh
;

84 * 
	mh0
;

85 * 
	mh1
;

87 
rbm_u£r
(cÚ¡ 
v”‹x_d©a
 & 
vd©a
){

88 
	mh
 = (*)&
vd©a
.
pvec
[0];

89 
	mh0
 = 
h
 + 
D
;

90 
	mh1
 = 
h0
 + 
D
;

93 
	mrbm_u£r
 & 
	mİ”©Ü
=(
v”‹x_d©a
 & 
d©a
){

94 
h
 = &
d©a
.
pvec
[0];

95 
	mh0
 = 
h
 + 
D
;

96 
	mh1
 = 
h0
 + 
D
;

97  * 
	mthis
;

107 
	srbm_mov›
{

108 * 
	mbi
;

109 * 
	mni
;

110 * 
	mw
;

112 
rbm_mov›
(cÚ¡ 
v”‹x_d©a
& 
vd©a
){

113 
	mni
 = (*)&
vd©a
.
bŸs
;

114 
	mbi
 = (*)&
vd©a
.
pvec
[0];

115 
	mw
 = 
bi
 + 
rbm_bšs
;

118 
	mrbm_mov›
 & 
	mİ”©Ü
=(
v”‹x_d©a
 & 
d©a
){

119 
ni
 = (*)&
d©a
.
bŸs
;

120 
	mbi
 = (*)&
d©a
.
pvec
[0];

121 
	mw
 = 
bi
 + 
rbm_bšs
;

122  * 
	mthis
;

129 
	$rbm_´ediù
(cÚ¡ 
rbm_u£r
 & 
u¤
,

130 cÚ¡ 
rbm_mov›
 & 
mov
,

131 cÚ¡ 
¿tšg
,

132 & 
´ediùiÚ
,

133 * 
exŒa
){

135 
»t
 = 0;

136 
Â
 = 0;

137 
r
 = 0;„ < 
rbm_bšs
; ++r){

138 
zz
 = 
	`exp
(
mov
.
bi
[
r
] + 
	`dÙ
(
u¤
.
h
, &mov.
w
[r*
D
]));

139 ià(
¡d
::
	`isšf
(
zz
))

140 
¡d
::
cout
<<" mov.bi[r] " << 
mov
.
bi
[
r
] << " dÙ: " << 
	`dÙ
(
u¤
.
h
, &mov.
w
[r*
D
]è<< std::
’dl
;

141 
»t
 +ğ
zz
 * ()(
r
);

142 
	`as£¹
(!
¡d
::
	`i¢ª
(
»t
));

143 
Â
 +ğ
zz
;

145 
	`as£¹
(!
¡d
::
	`i¢ª
(
»t
));

146 
	`as£¹
(
¡d
::
	`çbs
(
Â
) > 1e-32);

147 
»t
 /ğ
Â
;

148 if(
»t
 < 
mšv®
)„et = minval;

149 if(
»t
 > 
maxv®
)„et = maxval;

150 
	`as£¹
(!
¡d
::
	`i¢ª
(
»t
));

151 
´ediùiÚ
 = 
»t
 * 
rbm_sÿlšg
;

152 
	`as£¹
(!
¡d
::
	`i¢ª
(
´ediùiÚ
));

153  
	`pow
(
´ediùiÚ
 - 
¿tšg
,2);

154 
	}
}

156 
	$rbm_´ediù
(cÚ¡ 
v”‹x_d©a
 & 
u¤
,

157 cÚ¡ 
v”‹x_d©a
 & 
mov
,

158 cÚ¡ 
¿tšg
,

159 & 
´ediùiÚ
,

160 * 
exŒa
){

161  
	`rbm_´ediù
(
	`rbm_u£r
((
v”‹x_d©a
&)
u¤
), 
	`rbm_mov›
((v”‹x_d©a&)
mov
), 
¿tšg
, 
´ediùiÚ
, 
NULL
);

162 
	}
}

164 
	$´ediù1
(cÚ¡ 
rbm_u£r
 & 
u¤
,

165 cÚ¡ 
rbm_mov›
 & 
mov
,

166 cÚ¡ 
¿tšg
,

167 & 
´ediùiÚ
){

169 
vec
 
zz
 = 
	`z”os
(
rbm_bšs
);

170 
szz
 = 0;

171 
r
 = 0;„ < 
rbm_bšs
; ++r){

172 
zz
[
r
] = 
	`exp
(
mov
.
bi
[r] + 
	`dÙ
(
u¤
.
h0
, &mov.
w
[r*
D
]));

173 
szz
 +ğ
zz
[
r
];

175 
rd
 = 
	`d¿nd48
(è* 
szz
;

176 
szz
 = 0;

177 
»t
 = 0;

178 
r
 = 0;„ < 
rbm_bšs
; ++r){

179 
szz
 +ğ
zz
[
r
];

180 if(
rd
 < 
szz
){

181 
»t
 = 
r
;

185 
´ediùiÚ
 = 
»t
 * 
rbm_sÿlšg
;

186 
	`as£¹
(!
¡d
::
	`i¢ª
(
´ediùiÚ
));

187  
	`pow
(
´ediùiÚ
 - 
¿tšg
, 2);

188 
	}
}

190 
šlše
 
	$sigmoid
(
x
){

191  1 / (1 + 
	`exp
(-1 * 
x
));

192 
	}
}

194 
	~"ut.hµ
"

200 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

201 
	tEdgeD©aTy³
;

203 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

204 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	gpv®id©iÚ_’gše
 = 
NULL
;

205 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

207 
	~"rm£.hµ
"

208 
	~"rm£_’gše.hµ
"

209 
	~"io.hµ
"

217 
	gRBMV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

221 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

222 
»£t_rm£
(
gcÚ‹xt
.
exeùh»ads
);

230 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

231 
	grbm_®pha
 *ğ
rbm_muÉ_¡•_dec
;

232 
Œaššg_rm£
(
™”©iÚ
, 
gcÚ‹xt
);

233 ià(
	g™”©iÚ
 >= 2)

234 
run_v®id©iÚ
(
pv®id©iÚ_’gše
, 
gcÚ‹xt
);

235 
	g¡d
::
cout
<<
¡d
::
’dl
;

241 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

244 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0){

245 ià(
is_u£r
(
v”‹x
.
id
()è&& v”‹x.
num_ou‹dges
() > 0){

246 
v”‹x_d©a
& 
u£r
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

247 
	gu£r
.
	gpvec
 = 
z”os
(
D
*3);

248 
	ge
=0;ƒ < 
	gv”‹x
.
num_ou‹dges
();ƒ++) {

249 
rbm_mov›
 
	gmov
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

250 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

251 
	gr
 = ()(
ob£rv©iÚ
/
rbm_sÿlšg
);

252 
as£¹
(
r
 < 
rbm_bšs
);

253 
	gmov
.
	gbi
[
r
]++;

258 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 1){

259 ià(
v”‹x
.
num_šedges
() > 0){

260 
rbm_mov›
 
mov
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

261 
£tRªd2
(
mov
.
w
, 
D
*
rbm_bšs
, 0.001);

262 
	gr
 = 0;„ < 
	grbm_bšs
; ++r){

263 
	gmov
.
	gbi
[
r
] /ğ()
v”‹x
.
num_šedges
();

264 
	gmov
.
	gbi
[
r
] = 
log
(1E-9 + 
mov
.
bi
[r]);

266 ià(
	gmov
.
	gbi
[
r
] > 1000){

267 
as£¹
(
çl£
);

268 
log¡»am
(
LOG_FATAL
)<<"Num”iÿÈov”æow" <<
	g¡d
::
’dl
;

276 ià(
is_u£r
(
v”‹x
.
id
()è&& 
	gv”‹x
.
num_ou‹dges
()){

277 
	gv”‹x_d©a
 & 
	gu£r
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

278 
	gu£r
.
	gpvec
 = 
z”os
(3*
D
);

279 
rbm_u£r
 
u¤
(
u£r
);

281 
vec
 
	gv1
 = 
z”os
(
v”‹x
.
num_ou‹dges
());

283 
	ge
=0;ƒ < 
	gv”‹x
.
num_ou‹dges
();ƒ++) {

284 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

285 
rbm_mov›
 
	gmov
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

286 
	gr
 = ()(
ob£rv©iÚ
 / 
rbm_sÿlšg
);

287 
as£¹
(
r
 < 
rbm_bšs
);

288 
	gk
=0; k < 
	gD
; k++){

289 
	gu¤
.
	gh
[
k
] +ğ
mov
.
w
[
D
*
r
 + k];

290 
as£¹
(!
¡d
::
i¢ª
(
u¤
.
h
[
k
]));

294 
	gk
=0; k < 
	gD
; k++){

295 
	gu¤
.
	gh
[
k
] = 
sigmoid
(
u¤
.
h
[k]);

296 ià(
d¿nd48
(è< 
	gu¤
.
	gh
[
k
])

297 
	gu¤
.
	gh0
[
k
] = 1;

298 
	gu¤
.
	gh0
[
k
] = 0;

302 
	gi
 = 0;

303 
	g´ediùiÚ
;

304 
	ge
=0;ƒ < 
	gv”‹x
.
num_ou‹dges
();ƒ++) {

305 
rbm_mov›
 
	gmov
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

306 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

307 
´ediù1
(
u¤
, 
mov
, 
ob£rv©iÚ
, 
´ediùiÚ
);

308 
	gvi
 = ()(
´ediùiÚ
 / 
rbm_sÿlšg
);

309 
	gv1
[
i
] = 
vi
;

310 
	gi
++;

313 
	gi
 = 0;

314 
	ge
=0;ƒ < 
	gv”‹x
.
num_ou‹dges
();ƒ++) {

315 
rbm_mov›
 
	gmov
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

316 
	gr
 = ()
v1
[
i
];

317 
	gk
=0; k< 
	gD
;k++){

318 
	gu¤
.
	gh1
[
k
] +ğ
mov
.
w
[
r
*
D
+k];

320 
	gi
++;

323 
	gk
=0; k < 
	gD
; k++){

324 
	gu¤
.
	gh1
[
k
] = 
sigmoid
(
u¤
.
h1
[k]);

325 ià(
d¿nd48
(è< 
	gu¤
.
	gh1
[
k
])

326 
	gu¤
.
	gh1
[
k
] = 1;

327 
	gu¤
.
	gh1
[
k
] = 0;

330 
	gi
 = 0;

331 
	ge
=0;ƒ < 
	gv”‹x
.
num_ou‹dges
();ƒ++) {

332 
rbm_mov›
 
	gmov
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

333 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

334 
	g´ediùiÚ
;

335 
rbm_´ediù
(
u£r
, 
mov
, 
ob£rv©iÚ
, 
´ediùiÚ
, 
NULL
);

336 
	gpui
 = 
´ediùiÚ
 / 
rbm_sÿlšg
;

337 
	grui
 = 
ob£rv©iÚ
 / 
rbm_sÿlšg
;

338 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ(
pui
 - 
rui
) * (pui -„ui);

340 
	gvi0
 = ()(
rui
);

341 
	gvi1
 = ()
v1
[
i
];

342 
	gk
 = 0; k < 
	gD
; k++){

343 
	gmov
.
	gw
[
D
*
vi0
+
k
] +ğ
rbm_®pha
 * (
u¤
.
h0
[k] - 
rbm_b‘a
 * 
mov
.
w
[vi0*D+k]);

344 
as£¹
(!
¡d
::
i¢ª
(
mov
.
w
[
D
*
vi0
+
k
]));

345 
	gmov
.
	gw
[
D
*
vi1
+
k
] -ğ
rbm_®pha
 * (
u¤
.
h1
[k] + 
rbm_b‘a
 * 
mov
.
w
[vi1*D+k]);

346 
as£¹
(!
¡d
::
i¢ª
(
mov
.
w
[
D
*
vi1
+
k
]));

348 
	gi
++;

356 
ouut_rbm_»suÉ
(
¡d
::
¡ršg
 
f’ame
) {

357 
MMOuu‰”_m©
<
v”‹x_d©a
> 
u£r_m©
(
f’ame
 + "_U.mm", 0, 
M
, "Thi fcÚš RBM ouuˆm©rix U. IÀ—ch„ow D faùÜ oà¨sšgË u£¸node.", 
Ï‹Á_çùÜs_šmem
);

358 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
mmouut_right
(
f’ame
 + "_V.mm", 
M
 ,M+
N
, "Thi fcÚš RBM ouuˆm©rix V. IÀ—ch„ow D faùÜ oà¨sšgË i‹m‚ode.", 
Ï‹Á_çùÜs_šmem
);

359 
	gMMOuu‰”_vec
<
	gv”‹x_d©a
> 
mmouut_bŸs_right
(
f’ame
 + "_V_bŸs.mm",
M
 ,M+
N
 , 
BIAS_POS
, "Thi fcÚš RBM ouuˆbŸ veùÜ. IÀ—ch„ow‡ sšgË i‹m‚i.", 
Ï‹Á_çùÜs_šmem
);

360 
log¡»am
(
LOG_INFO
è<< "RBM ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << "_U.mm" <<

361 ", " << 
	gf’ame
 + "_V.mm " << 
	g¡d
::
’dl
;

364 
	$rbm_š™
(){

365 
	`¤ªd48
(
	`time
(
NULL
));

367 
Ï‹Á_çùÜs_šmem
.
	`»size
(
M
+
N
);

369 #´agm¨
omp
 
·¿Î–
 

370 
i
 = 0; i < ()
N
; ++i){

371 
v”‹x_d©a
 & 
mov›
 = 
Ï‹Á_çùÜs_šmem
[
M
+
i
];

372 
mov›
.
pvec
 = 
	`z”os
(
rbm_bšs
 + 
D
 *„bm_bins);

373 
mov›
.
bŸs
 = 0;

376 
	`log¡»am
(
LOG_INFO
è<< "RBM in™Ÿliz©iÚ ok" << 
¡d
::
’dl
;

378 
	}
}

379 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

381 
	`´št_cİyright
();

384 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

388 
m‘rics
 
	`m
("rbm-inmemory-factors");

391 
rbm_bšs
 = 
	`g‘_İtiÚ_št
("rbm_bins",„bm_bins);

392 
rbm_®pha
 = 
	`g‘_İtiÚ_æßt
("rbm_alpha",„bm_alpha);

393 
rbm_b‘a
 = 
	`g‘_İtiÚ_æßt
("rbm_beta",„bm_beta);

394 
rbm_muÉ_¡•_dec
 = 
	`g‘_İtiÚ_æßt
("rbm_mult_step_dec",„bm_mult_step_dec);

395 
rbm_sÿlšg
 = 
	`g‘_İtiÚ_æßt
("rbm_scaling",„bm_scaling);

397 
	`·r£_commªd_lše_¬gs
();

398 
	`·r£_im¶ic™_commªd_lše
();

400 
mytim”
.
	`¡¬t
();

403 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<>(
Œaššg
);

405 
	`rbm_š™
();

407 ià(
v®id©iÚ
 != ""){

408 
vsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
v®id©iÚ
, 
NULL
, 0, 0, 3, 
VALIDATION
);

409 
š™_v®id©iÚ_rm£_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
>(
pv®id©iÚ_’gše
, 
vsh¬ds
, &
rbm_´ediù
);

413 ià(
lßd_çùÜs_äom_fe
){

414 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_U.mm", 0, 3*
D
);

415 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_V.mm", 
M
, 
rbm_bšs
*(
D
+1));

416 
vec
 
™em_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 +"_V_bŸs.mm", 
çl£
, 
Œue
);

417 
ušt
 
i
=0; i< 
N
; i++){

418 
Ï‹Á_çùÜs_šmem
[
M
+
i
].
bŸs
 = 
™em_bŸs
[i];

422 
	`´št_cÚfig
();

425 
RBMV”tiûsInMemProg¿m
 
´og¿m
;

426 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

427 
	`£t_’gše_æags
(
’gše
);

428 
³ngše
 = &
’gše
;

429 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

432 
	`ouut_rbm_»suÉ
(
Œaššg
);

433 
	`‹¡_´ediùiÚs
(&
rbm_´ediù
);

437 ià(!
qu›t
)

438 
	`m‘rics_»pÜt
(
m
);

440 
	}
}

	@toolkits/collaborative_filtering/rmse.hpp

1 #iâdeà
DEF_RMSEHPP


2 
	#DEF_RMSEHPP


	)

3 
	~<io¡»am
>

4 
	~<iomª
>

5 
	~<omp.h
>

30 
	~"tim”.hµ
"

31 
	~"eig’_w¿µ”.hµ
"

32 
	~"commÚ.hµ
"

33 
»ad_m©rix_m¬k‘_bªÃr_ªd_size
(
FILE
 * 
pfe
, 
MM_ty³code
 & 
m©code
, 
ušt
 & 
M
, ušˆ& 
N
, 
size_t
 & 
nz
, cÚ¡ 
¡d
::
¡ršg
 & 
f’ame
);

34 
FILE
 * 
İ’_fe
(cÚ¡ * 
f’ame
, cÚ¡ * 
mode
, 
boŞ
 
İtiÚ®
);

36 
tim”
 
	gmytim”
;

37 
	gdŒaššg_rm£
 = 0;

38 
	gÏ¡_Œaššg_rm£
 = 0;

39 
	gdv®id©iÚ_rm£
 = 0;

40 
	gÏ¡_v®id©iÚ_rm£
 = 0;

42 
	$sign
(
x
){ ià(x < 0è -1; ià(x > 0è 1;  0; 
	}
}

45 
	$fš®ize_rm£
(
rm£
, 
num_edges
){

46 
»t
 = 0;

47 
loss_ty³
){

48 
SQUARE
:

49 
»t
 = 
	`sq¹
(
rm£
 / 
num_edges
);

51 
LOGISTIC
:

52 
»t
 = 
rm£
/
num_edges
;

54 
ABS
:

55 
»t
 = 
rm£
 / 
num_edges
;

56 
AP
:

57 
»t
 = 
rm£
 / 
num_edges
;

60  
»t
;

61 
	}
}

64 
	$ÿlc_loss
(
exp_´ediùiÚ
, 
”r
){

65 
»t
 = 0;

66 
loss_ty³
){

67 
LOGISTIC
: 
»t
ğ(
exp_´ediùiÚ
 * 
	`log
(exp_prediction) + (1-exp_prediction)*log(1-exp_prediction));

69 
SQUARE
: 
»t
 = 
”r
*err;

71 
ABS
: 
»t
 = 
	`çbs
(
”r
);

74  
»t
;

75 
	}
}

78 
	$ÿlc_”rÜ_f
(
exp_´ediùiÚ
, 
”r
){

79 
loss_ty³
){

80 
LOGISTIC
:

81  
”r
;

82 
SQUARE
:

83  
”r
 *ğ(
exp_´ediùiÚ
*(1.0-exp_´ediùiÚ)*(
maxv®
-
mšv®
));

84 
ABS
:

85  
”r
 = 
	`sign
Ó¼)*(
exp_´ediùiÚ
*(1-exp_´ediùiÚ)*(
maxv®
-
mšv®
));

87  
NAN
;

88 
	}
}

94 
‹¡_´ediùiÚs
((*
´ediùiÚ_func
)(cÚ¡ 
v”‹x_d©a
 & 
u£r
, cÚ¡ v”‹x_d©¨& 
mov›
, 
¿tšg
, & 
´ediùiÚ
, * 
exŒa
), 
g¿phchi_cÚ‹xt
 * 
gcÚ‹xt
 = 
NULL
, 
boŞ
 
do§ve
 = 
Œue
, 
vec
 * 
avg´d
 = NULL, 
pmf_buº_š
 = 0) {

95 
MM_ty³code
 
m©code
;

96 
FILE
 *
f
;

97 
ušt
 
Me
, 
Ne
;

98 
size_t
 
nz
;

100 ià((
f
 = 
	`fİ’
(
‹¡
.
	`c_¡r
(), "r")è=ğ
NULL
) {

103 
FILE
 * 
fout
 = 
NULL
;

104 ià(
do§ve
)

105 
fout
 = 
	`İ’_fe
((
‹¡
 + ".´ediù").
	`c_¡r
(),"w", 
çl£
);

107 
	`»ad_m©rix_m¬k‘_bªÃr_ªd_size
(
f
, 
m©code
, 
Me
, 
Ne
, 
nz
, 
‹¡
+".predict");

109 ià((
M
 > 0 && 
N
 > 0 ) && (
Me
 !ğM || 
Ne
 != N))

110 
	`log¡»am
(
LOG_FATAL
)<<"IÅuˆsizoà‹¡ m©rix mu¡ bid’tiÿÈtØŒaššg m©rix,‚am–y " << 
M
 << "x" << 
N
 << 
¡d
::
’dl
;

112 ià(
avg´d
 && 
gcÚ‹xt
->
™”©iÚ
 =ğ
pmf_buº_š
)

113 *
avg´d
 = 
	`z”os
(
nz
);

116 ià(
do§ve
){

117 
	`mm_wr™e_bªÃr
(
fout
, 
m©code
);

118 
	`årštf
(
fout
, "%%This file contains…redictions of user/item…air, one…rediction inƒach†ine. The first column is user id. The second column ishe item id. Thehird column ishe computed…rediction.\n");

119 
	`mm_wr™e_mtx_üd_size
(
fout
 ,
M
,
N
,
nz
);

122 
ušt
 
i
=0; i<
nz
; i++)

124 
I
, 
J
;

125 
v®
;

126 
rc
 = 
	`fsÿnf
(
f
, "%d %d %lg\n", &
I
, &
J
, &
v®
);

127 ià(
rc
 != 3)

128 
	`log¡»am
(
LOG_FATAL
)<<"E¼Ü wh’„—dšg iÅuˆfe: " << 
i
 << 
¡d
::
’dl
;

129 
I
--;

130 
J
--;

131 
´ediùiÚ
;

132 (*
´ediùiÚ_func
)(
Ï‹Á_çùÜs_šmem
[
I
],†©’t_çùÜs_šmem[
J
+
M
], 
v®
, 
´ediùiÚ
, 
NULL
);

134 ià(
avg´d
 &&‡vg´d->
	`size
(è> 0 && 
gcÚ‹xt
->
™”©iÚ
 >ğ
pmf_buº_š
)

135 
avg´d
->
İ”©Ü
[](
i
è+ğ
´ediùiÚ
;

137 ià(
do§ve
){

138 ià(
avg´d
 &&‡vg´d->
	`size
() > 0)

139 
´ediùiÚ
 = 
avg´d
->
İ”©Ü
[](
i
è/(
gcÚ‹xt
->
™”©iÚ
 - 
pmf_buº_š
);

140 
	`årštf
(
fout
, "%d %d %12.8lg\n", 
I
+1, 
J
+1, 
´ediùiÚ
);

144 
	`fşo£
(
f
);

145 ià(
do§ve
)

146 
	`fşo£
(
fout
);

148 ià(
do§ve
)

149 
¡d
::
cout
<<"Fšished wr™šg " << 
nz
 << "…»diùiÚ tØfe: " << 
‹¡
 << ".´ediù" << std::
’dl
;

150 
	}
}

152 
‹¡_´ediùiÚs3
((*
´ediùiÚ_func
)(cÚ¡ 
v”‹x_d©a
 & 
u£r
, cÚ¡ v”‹x_d©¨& 
mov›
, 
¿tšg
, & 
´ediùiÚ
, * 
exŒa
), 
time_off£t
 = 0) {

153 
MM_ty³code
 
m©code
;

154 
FILE
 *
f
;

155 
ušt
 
Me
, 
Ne
;

156 
size_t
 
nz
;

158 ià((
f
 = 
	`fİ’
(
‹¡
.
	`c_¡r
(), "r")è=ğ
NULL
) {

161 
FILE
 * 
fout
 = 
	`İ’_fe
((
‹¡
 + ".´ediù").
	`c_¡r
(),"w", 
çl£
);

163 
	`»ad_m©rix_m¬k‘_bªÃr_ªd_size
(
f
, 
m©code
, 
Me
, 
Ne
, 
nz
, 
‹¡
+".predict");

165 ià((
M
 > 0 && 
N
 > 0 ) && (
Me
 !ğM || 
Ne
 != N))

166 
	`log¡»am
(
LOG_FATAL
)<<"IÅuˆsizoà‹¡ m©rix mu¡ bid’tiÿÈtØŒaššg m©rix,‚am–y " << 
M
 << "x" << 
N
 << 
¡d
::
’dl
;

168 
	`mm_wr™e_bªÃr
(
fout
, 
m©code
);

169 
	`mm_wr™e_mtx_üd_size
(
fout
 ,
M
,
N
,
nz
);

171 
ušt
 
i
=0; i<
nz
; i++)

173 
I
, 
J
;

174 
v®
;

175 
time
;

176 
rc
 = 
	`fsÿnf
(
f
, "%d %d %d %lg\n", &
I
, &
J
, &
time
, &
v®
);

177 ià(
rc
 != 4)

178 
	`log¡»am
(
LOG_FATAL
)<<"E¼Ü wh’„—dšg iÅuˆfe: " << 
i
 << 
¡d
::
’dl
;

179 ià(
time
 - 
time_off£t
 < 0)

180 
	`log¡»am
(
LOG_FATAL
)<<"E¼Ü: wassumtimv®ue >ğ" << 
time_off£t
 << 
¡d
::
’dl
;

181 
I
--;

182 
J
--;

183 
´ediùiÚ
;

184 (*
´ediùiÚ_func
)(
Ï‹Á_çùÜs_šmem
[
I
],†©’t_çùÜs_šmem[
J
+
M
], 1, 
´ediùiÚ
, (*)&Ï‹Á_çùÜs_šmem[
time
+M+
N
-
time_off£t
]);

185 
	`årštf
(
fout
, "%d %d %12.8lg\n", 
I
+1, 
J
+1, 
´ediùiÚ
);

187 
	`fşo£
(
f
);

188 
	`fşo£
(
fout
);

190 
	`log¡»am
(
LOG_INFO
)<<"Fšished wr™šg " << 
nz
 << "…»diùiÚ tØfe: " << 
‹¡
 << ".´ediù" << 
¡d
::
’dl
;

191 
	}
}

193 (*
´ediùiÚ_func
)(cÚ¡ 
v”‹x_d©a
 & 
u£r
, cÚ¡ v”‹x_d©¨& 
mov›
, 
¿tšg
, & 
´ediùiÚ
, * 
exŒa
);

200 
	`v®id©iÚ_rm£
((*
´ediùiÚ_func
)(cÚ¡ 
v”‹x_d©a
 & 
u£r
, cÚ¡ v”‹x_d©¨& 
mov›
, 
¿tšg
, & 
´ediùiÚ
, * 
exŒa
)

201 ,
g¿phchi_cÚ‹xt
 & 
gcÚ‹xt
, 
tok’s_³r_row
 = 3, 
vec
 * 
avg´d
 = 
NULL
, 
pmf_buº_š
 = 0) {

202 
MM_ty³code
 
m©code
;

203 
FILE
 *
f
;

204 
size_t
 
nz
;

206 ià((
f
 = 
	`fİ’
(
v®id©iÚ
.
	`c_¡r
(), "r")è=ğ
NULL
) {

207 
¡d
::
cout
<<¡d::
’dl
;

211 
	`»ad_m©rix_m¬k‘_bªÃr_ªd_size
(
f
, 
m©code
, 
Me
, 
Ne
, 
nz
, 
v®id©iÚ
);

212 ià((
M
 > 0 && 
N
 > 0è&& (
Me
 !ğM || 
Ne
 != N))

213 
	`log¡»am
(
LOG_FATAL
)<<"IÅuˆsizoàv®id©iÚ m©rix mu¡ bid’tiÿÈtØŒaššg m©rix,‚am–y " << 
M
 << "x" << 
N
 << 
¡d
::
’dl
;

215 
Le
 = 
nz
;

216 ià(
avg´d
 !ğ
NULL
 && 
gcÚ‹xt
.
™”©iÚ
 == 0)

217 *
avg´d
 = 
	`z”os
(
nz
);

220 
Ï¡_v®id©iÚ_rm£
 = 
dv®id©iÚ_rm£
;

221 
dv®id©iÚ_rm£
 = 0;

222 
I
, 
J
;

223 
v®
, 
time
 = 1.0;

225 
size_t
 
i
=0; i<
nz
; i++)

227 
rc
;

228 ià(
tok’s_³r_row
 == 3)

229 
rc
 = 
	`fsÿnf
(
f
, "%d %d %lg\n", &
I
, &
J
, &
v®
);

230 
rc
 = 
	`fsÿnf
(
f
, "%d %d %lg %lg\n", &
I
, &
J
, &
time
, &
v®
);

232 ià(
rc
 !ğ
tok’s_³r_row
)

233 
	`log¡»am
(
LOG_FATAL
)<<"E¼Ü wh’„—dšg iÅuˆfÚ†še: " << 
i
 << " . should have" << 
tok’s_³r_row
 << 
¡d
::
’dl
;

234 ià(
v®
 < 
mšv®
 || v® > 
maxv®
)

235 
	`log¡»am
(
LOG_FATAL
)<<"V®ui ouˆoà¿nge: " << 
v®
 << " should be: " << 
mšv®
 << "Ø" << 
maxv®
 << 
¡d
::
’dl
;

236 
I
--;

237 
J
--;

238 
´ediùiÚ
;

239 
dv®id©iÚ_rm£
 +ğ
time
 *(*
´ediùiÚ_func
)(
Ï‹Á_çùÜs_šmem
[
I
],†©’t_çùÜs_šmem[
J
+
M
], 
v®
, 
´ediùiÚ
, 
avg´d
 =ğ
NULL
 ? NULL : &avg´d->
İ”©Ü
[](
i
));

242 
	`fşo£
(
f
);

244 
	`as£¹
(
Le
 > 0);

245 
dv®id©iÚ_rm£
 = 
	`fš®ize_rm£
(dv®id©iÚ_rm£ , ()
Le
);

246 
¡d
::
cout
<<" V®id©iÚ " << 
”rÜ_Çmes
[
loss_ty³
] << ":" << std::
	`£tw
(10è<< 
dv®id©iÚ_rm£
 <<

247 "„©šgs_³r_£c: " << 
¡d
::
	`£tw
(10è<< (
gcÚ‹xt
.
™”©iÚ
*
L
/
mytim”
.
	`cu¼’t_time
()è<< std::
’dl
;

248 ià(
h®t_Ú_rm£_šü—£
 > 0 && h®t_Ú_rm£_šü—£ < 
gcÚ‹xt
.
™”©iÚ
 && 
dv®id©iÚ_rm£
 > 
Ï¡_v®id©iÚ_rm£
){

249 
	`log¡»am
(
LOG_WARNING
)<<"Stİpšgƒngšbeÿu£ oàv®id©iÚ RMSE inü—£" << 
¡d
::
’dl
;

250 
gcÚ‹xt
.
	`£t_Ï¡_™”©iÚ
(gcÚ‹xt.
™”©iÚ
);

252 
	}
}

258 
v®id©iÚ_rm£3
((*
´ediùiÚ_func
)(cÚ¡ 
v”‹x_d©a
 & 
u£r
, cÚ¡ v”‹x_d©¨& 
mov›
, cÚ¡ v”‹x_d©¨& 
time
, 
¿tšg
, & 
´ediùiÚ
)

259 ,
g¿phchi_cÚ‹xt
 & 
gcÚ‹xt
,
tok’s_³r_row
 = 4, 
time_off£t
 = 0) {

260 
MM_ty³code
 
m©code
;

261 
FILE
 *
f
;

262 
size_t
 
nz
;

264 ià((
f
 = 
	`fİ’
(
v®id©iÚ
.
	`c_¡r
(), "r")è=ğ
NULL
) {

265 
¡d
::
cout
<<¡d::
’dl
;

269 
	`»ad_m©rix_m¬k‘_bªÃr_ªd_size
(
f
, 
m©code
, 
Me
, 
Ne
, 
nz
, 
v®id©iÚ
);

271 ià((
M
 > 0 && 
N
 > 0è&& (
Me
 !ğM || 
Ne
 != N))

272 
	`log¡»am
(
LOG_FATAL
)<<"IÅuˆsizoàv®id©iÚ m©rix mu¡ bid’tiÿÈtØŒaššg m©rix,‚am–y " << 
M
 << "x" << 
N
 << 
¡d
::
’dl
;

274 
Le
 = 
nz
;

276 
Ï¡_v®id©iÚ_rm£
 = 
dv®id©iÚ_rm£
;

277 
dv®id©iÚ_rm£
 = 0;

278 
I
, 
J
;

279 
v®
, 
time
 = 1.0;

281 
size_t
 
i
=0; i<
nz
; i++)

283 
rc
;

284 
rc
 = 
	`fsÿnf
(
f
, "%d %d %lg %lg\n", &
I
, &
J
, &
time
, &
v®
);

285 
time
 -ğ
time_off£t
;

287 ià(
rc
 != 4)

288 
	`log¡»am
(
LOG_FATAL
)<<"E¼Ü wh’„—dšg iÅuˆfÚ†še: " << 
i
 << " . should hav4 cŞumn " << 
¡d
::
’dl
;

289 ià(
v®
 < 
mšv®
 || v® > 
maxv®
)

290 
	`log¡»am
(
LOG_FATAL
)<<"V®ui ouˆoà¿nge: " << 
v®
 << " should be: " << 
mšv®
 << "Ø" << 
maxv®
 << 
¡d
::
’dl
;

291 ià((
ušt
)
time
 > 
K
)

292 
	`log¡»am
(
LOG_FATAL
)<<"Thœd cŞumÀv®utimshould bsm®Ë¸thª " << 
K
 << " whob£rved " << 
time
 << " iÀlš: " << 
i
 << 
¡d
::
’dl
;

294 
I
--;

295 
J
--;

296 
´ediùiÚ
;

297 
dv®id©iÚ_rm£
 +ğ(*
´ediùiÚ_func
)(
Ï‹Á_çùÜs_šmem
[
I
],†©’t_çùÜs_šmem[
J
+
M
],†©’t_çùÜs_šmem[M+
N
+(
ušt
)
time
], 
v®
, 
´ediùiÚ
);

299 
	`fşo£
(
f
);

301 
	`as£¹
(
Le
 > 0);

302 
dv®id©iÚ_rm£
 = 
	`fš®ize_rm£
(dv®id©iÚ_rm£ , ()
Le
);

303 
¡d
::
cout
<<" V®id©iÚ " << 
”rÜ_Çmes
[
loss_ty³
] << ":" << std::
	`£tw
(10è<< 
dv®id©iÚ_rm£
 << std::
’dl
;

304 ià(
h®t_Ú_rm£_šü—£
 >ğ
gcÚ‹xt
.
™”©iÚ
 && 
dv®id©iÚ_rm£
 > 
Ï¡_v®id©iÚ_rm£
){

305 
	`log¡»am
(
LOG_WARNING
)<<"Stİpšgƒngšbeÿu£ oàv®id©iÚ RMSE inü—£" << 
¡d
::
’dl
;

306 
gcÚ‹xt
.
	`£t_Ï¡_™”©iÚ
(gcÚ‹xt.
™”©iÚ
);

308 
	}
}

310 
vec
 
	grm£_vec
;

313 
	$Œaššg_rm£
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
, 
boŞ
 
™ems
 = 
çl£
){

314 
Ï¡_Œaššg_rm£
 = 
dŒaššg_rm£
;

315 
dŒaššg_rm£
 = 0;

316 
»t
 = 0;

317 
dŒaššg_rm£
 = 
	`sum
(
rm£_vec
);

318 
Şd_loss
 = 
loss_ty³
;

319 ià(
loss_ty³
 =ğ
AP
)

320 
loss_ty³
 = 
SQUARE
;

321 
»t
 = 
dŒaššg_rm£
 = 
	`fš®ize_rm£
(dŒaššg_rm£, 
³ngše
->
	`num_edges
());

322 
¡d
::
cout
<< std::
	`£tw
(10è<< 
mytim”
.
	`cu¼’t_time
(è<< "èI‹¿tiÚ: " << std::£tw(3è<<
™”©iÚ
<<" T¿ššg " << 
”rÜ_Çmes
[
loss_ty³
] << ":"<< std::£tw(10)<< 
dŒaššg_rm£
;

323 
loss_ty³
 = 
Şd_loss
;

325  
»t
;

326 
	}
}

	@toolkits/collaborative_filtering/rmse_engine.hpp

1 #iâdeà
__GRAPHCHI_RMSE_ENGINE


2 
	#__GRAPHCHI_RMSE_ENGINE


	)

27 (*
µ»diùiÚ_func
)(cÚ¡ 
v”‹x_d©a
&, cÚ¡ v”‹x_d©a&, cÚ¡ , &, *èğ
NULL
;

28 
vec
 
v®id©iÚ_rm£_vec
;

29 
vec
 
u£rs_vec
;

30 
vec
 
sum_­_vec
;

31 
boŞ
 
u£r_nodes
 = 
Œue
;

32 
num_th»ads
 = 1;

33 
boŞ
 
cÚv”ged_’gše
 = 
çl£
;

34 
cur_™”©iÚ
 = 0;

39 
V®id©iÚAPProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> {

44 
	`upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

46 ià(
u£r_nodes
 && 
v”‹x
.
	`id
(è>ğ
M
)

48 ià(!
u£r_nodes
 && 
v”‹x
.
	`id
(è< 
M
)

50 
v”‹x_d©a
 & 
vd©a
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
	`id
()];

51 
vec
 
¿tšgs
 = 
	`z”os
(
v”‹x
.
	`num_ou‹dges
());

52 
vec
 
»®_v®s
 = 
	`z”os
(
v”‹x
.
	`num_ou‹dges
());

53 ià(
¿tšgs
.
	`size
() > 0){

54 
u£rs_vec
[
	`omp_g‘_th»ad_num
()]++;

55 
j
=0;

56 
»®_şick_couÁ
 = 0;

57 
e
=0;ƒ < 
v”‹x
.
	`num_ou‹dges
();ƒ++) {

58 cÚ¡ 
EdgeD©aTy³
 & 
ob£rv©iÚ
 = 
v”‹x
.
	`edge
(
e
)->
	`g‘_d©a
();

59 
v”‹x_d©a
 & 
pd©a
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
	`edge
(
e
)->
	`v”‹x_id
()];

60 
´ediùiÚ
;

61 (*
µ»diùiÚ_func
)(
vd©a
, 
pd©a
, 
ob£rv©iÚ
, 
´ediùiÚ
, 
NULL
);

62 
¿tšgs
[
j
] = 
´ediùiÚ
;

63 
»®_v®s
[
j
] = 
ob£rv©iÚ
;

64 ià(
ob£rv©iÚ
 > 0)

65 
»®_şick_couÁ
++;

66 
j
++;

68 
couÁ
 = 0;

69 
­
 = 0;

70 
ivec
 
pos
 = 
	`sÜt_šdex
(
¿tšgs
);

71 
j
=0; j< 
¡d
::
	`mš
(
­_numb”
, ()
¿tšgs
.
	`size
()); j++){

72 ià(
»®_v®s
[
pos
[
¿tšgs
.
	`size
(è- 
j
 - 1]] > 0)

73 
­
 +ğ(++
couÁ
 * 1.0/(
j
+1));

75 ià(
»®_şick_couÁ
 > 0 )

76 
­
 /ğ
»®_şick_couÁ
;

77 
­
 = 0;

78 
sum_­_vec
[
	`omp_g‘_th»ad_num
()] +ğ
­
;

81 
	`befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 & 
gcÚ‹xt
){

82 
Ï¡_v®id©iÚ_rm£
 = 
dv®id©iÚ_rm£
;

83 
u£rs_vec
 = 
	`z”os
(
num_th»ads
);

84 
sum_­_vec
 = 
	`z”os
(
num_th»ads
);

89 
	`aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

90 
	`as£¹
(
Le
 > 0);

91 
dv®id©iÚ_rm£
 = 
	`fš®ize_rm£
(
	`sum
(
sum_­_vec
è, ()sum(
u£rs_vec
));

92 
¡d
::
cout
<<" V®id©iÚ " << 
”rÜ_Çmes
[
loss_ty³
] << ":" << std::
	`£tw
(10è<< 
dv®id©iÚ_rm£
 << std::
’dl
;

93 ià(
h®t_Ú_rm£_šü—£
 > 0 && h®t_Ú_rm£_šü—£ < 
cur_™”©iÚ
 && 
dv®id©iÚ_rm£
 > 
Ï¡_v®id©iÚ_rm£
){

94 
	`log¡»am
(
LOG_WARNING
)<<"Stİpšgƒngšbeÿu£ oàv®id©iÚ " << 
”rÜ_Çmes
[
loss_ty³
] << " inü—£" << 
¡d
::
’dl
;

96 
cÚv”ged_’gše
 = 
Œue
;

99 
	}
};

107 
	gV®id©iÚRMSEProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

112 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

113 ià(
	gu£r_nodes
 && 
	gv”‹x
.
id
(è>ğ
M
)

115 ià(!
	gu£r_nodes
 && 
	gv”‹x
.
id
(è< 
	gM
)

117 
	gv”‹x_d©a
 & 
	gvd©a
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

118 
	ge
=0;ƒ < 
	gv”‹x
.
num_ou‹dges
();ƒ++) {

119 cÚ¡ 
	gEdgeD©aTy³
 & 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

120 
	gv”‹x_d©a
 & 
	gnbr_Ï‹Á
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

121 
	g´ediùiÚ
;

122 
	grm£
 = (*
µ»diùiÚ_func
)(
vd©a
, 
	gnbr_Ï‹Á
, 
	gob£rv©iÚ
, 
	g´ediùiÚ
, 
	gNULL
);

123 
as£¹
(
rm£
 <ğ
pow
(
maxv®
 - 
mšv®
, 2));

124 
as£¹
(
v®id©iÚ_rm£_vec
.
size
(è> 
omp_g‘_th»ad_num
());

125 
	gv®id©iÚ_rm£_vec
[
omp_g‘_th»ad_num
()] +ğ
rm£
;

129 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 & 
gcÚ‹xt
){

130 
	gÏ¡_v®id©iÚ_rm£
 = 
dv®id©iÚ_rm£
;

131 
	gv®id©iÚ_rm£_vec
 = 
z”os
(
num_th»ads
);

136 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

137 
as£¹
(
Le
 > 0);

138 
	gdv®id©iÚ_rm£
 = 
fš®ize_rm£
(
sum
(
v®id©iÚ_rm£_vec
è, ()
Le
);

139 
	g¡d
::
cout
<<" V®id©iÚ " << 
”rÜ_Çmes
[
loss_ty³
] << ":" << 
¡d
::
£tw
(10è<< 
dv®id©iÚ_rm£
 << std::
’dl
;

140 ià(
	gh®t_Ú_rm£_šü—£
 > 0 && h®t_Ú_rm£_šü—£ < 
	gcur_™”©iÚ
 && 
	gdv®id©iÚ_rm£
 > 
	gÏ¡_v®id©iÚ_rm£
){

141 
log¡»am
(
LOG_WARNING
)<<"Stİpšgƒngšbeÿu£ oàv®id©iÚ RMSE inü—£" << 
	g¡d
::
’dl
;

142 
	gcÚv”ged_’gše
 = 
Œue
;

147 
	$»£t_rm£
(
exec_th»ads
){

148 
	`log¡»am
(
LOG_DEBUG
)<<"D‘eùed‚umb” oàth»ads: " << 
exec_th»ads
 << 
¡d
::
’dl
;

149 
num_th»ads
 = 
exec_th»ads
;

150 
rm£_vec
 = 
	`z”os
(
exec_th»ads
);

151 
	}
}

153 
	g‹m¶©e
<
ty³Çme
 
	gV”‹xD©aTy³
,y³Çm
	gEdgeD©aTy³
>

154 
š™_v®id©iÚ_rm£_’gše
(
g¿phchi_’gše
<
V”‹xD©aTy³
,
EdgeD©aTy³
> *& 
pv®id©iÚ_’gše
, 
nsh¬ds
,(*
´ediùiÚ_func
)(cÚ¡ 
v”‹x_d©a
 & 
u£r
, cÚ¡ v”‹x_d©¨& 
mov›
, 
¿tšg
, & 
´ediùiÚ
, * 
exŒa
)){

155 ià(
nsh¬ds
 == -1)

157 
m‘rics
 * 
m
 = 
Ãw
 
	`m‘rics
("validation_rmse_engine");

158 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> * 
’gše
 = 
Ãw
 g¿phchi_’gše<V”‹xD©aTy³, EdgeD©aTy³>(
v®id©iÚ
, 
nsh¬ds
, 
çl£
, *
m
);

159 
	`£t_’gše_æags
(*
’gše
);

160 
pv®id©iÚ_’gše
 = 
’gše
;

161 
µ»diùiÚ_func
 = 
´ediùiÚ_func
;

162 
	}
}

164 
	g‹m¶©e
<
ty³Çme
 
	gV”‹xD©aTy³
,y³Çm
	gEdgeD©aTy³
>

165 
run_v®id©iÚ
(
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> * 
pv®id©iÚ_’gše
, 
g¿phchi_cÚ‹xt
 & 
cÚ‹xt
){

167 
	gcur_™”©iÚ
 = 
cÚ‹xt
.
™”©iÚ
;

168 ià(
	gpv®id©iÚ_’gše
 =ğ
NULL
)

170 ià(
	gÿlc_­
){

171 
V®id©iÚAPProg¿m
 
	g´og¿m
;

172 
	gpv®id©iÚ_’gše
->
run
(
´og¿m
, 1);

175 
V®id©iÚRMSEProg¿m
 
	g´og¿m
;

176 
	gpv®id©iÚ_’gše
->
run
(
´og¿m
, 1);

178 ià(
	gcÚv”ged_’gše
)

179 
	gcÚ‹xt
.
£t_Ï¡_™”©iÚ
(
cÚ‹xt
.
™”©iÚ
);

	@toolkits/collaborative_filtering/rmse_engine4.hpp

1 #iâdeà
__GRAPHCHI_RMSE_ENGINE4


2 
	#__GRAPHCHI_RMSE_ENGINE4


	)

27 (*
µ»diùiÚ_func
)(cÚ¡ 
v”‹x_d©a
&, cÚ¡ v”‹x_d©a&, cÚ¡ , &, *èğ
NULL
;

28 
vec
 
v®id©iÚ_rm£_vec
;

29 
boŞ
 
u£r_nodes
 = 
Œue
;

30 
couÁ”
 = 0;

31 
boŞ
 
time_weightšg
 = 
çl£
;

32 
boŞ
 
time_nodes
 = 
çl£
;

33 
m©Ïb_time_off£t
 = 0;

34 
num_th»ads
 = 1;

35 
boŞ
 
cÚv”ged_’gše
 = 
çl£
;

36 
cur_™”©iÚ
 = 0;

41 
V®id©iÚRMSEProg¿m4
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> {

46 
	`upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

47 ià(
u£r_nodes
 && 
v”‹x
.
	`id
(è>ğ
M
)

49 ià(!
u£r_nodes
 && 
v”‹x
.
	`id
(è< 
M
)

51 
v”‹x_d©a
 & 
vd©a
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
	`id
()];

52 
e
=0;ƒ < 
v”‹x
.
	`num_ou‹dges
();ƒ++) {

53 
ob£rv©iÚ
 = 
v”‹x
.
	`edge
(
e
)->
	`g‘_d©a
().
weight
;

54 
ušt
 
time
 = (ušt)
v”‹x
.
	`edge
(
e
)->
	`g‘_d©a
().tim- 
m©Ïb_time_off£t
;

55 
v”‹x_d©a
 * 
time_node
 = 
NULL
;

56 ià(
time_nodes
){

57 
	`as£¹
(
time
 >ğ0 &&im< 
M
+
N
+
K
);

58 
time_node
 = &
Ï‹Á_çùÜs_šmem
[
time
];

60 
v”‹x_d©a
 & 
nbr_Ï‹Á
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
	`edge
(
e
)->
	`v”‹x_id
()];

61 
´ediùiÚ
;

62 
rm£
 = (*
µ»diùiÚ_func
)(
vd©a
, 
nbr_Ï‹Á
, 
ob£rv©iÚ
, 
´ediùiÚ
, (*)
time_node
);

63 
	`as£¹
(
rm£
 <ğ
	`pow
(
maxv®
 - 
mšv®
, 2));

64 ià(
time_weightšg
)

65 
rm£
 *ğ
v”‹x
.
	`edge
(
e
)->
	`g‘_d©a
().
time
;

66 
	`as£¹
(
v®id©iÚ_rm£_vec
.
	`size
(è> 
	`omp_g‘_th»ad_num
());

67 
v®id©iÚ_rm£_vec
[
	`omp_g‘_th»ad_num
()] +ğ
rm£
;

71 
	`befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 & 
gcÚ‹xt
){

72 
Ï¡_v®id©iÚ_rm£
 = 
dv®id©iÚ_rm£
;

73 
v®id©iÚ_rm£_vec
 = 
	`z”os
(
num_th»ads
);

78 
	`aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

79 
	`as£¹
(
Le
 > 0);

80 
dv®id©iÚ_rm£
 = 
	`fš®ize_rm£
(
	`sum
(
v®id©iÚ_rm£_vec
è, ()
Le
);

81 
¡d
::
cout
<<" V®id©iÚ " << 
”rÜ_Çmes
[
loss_ty³
] << ":" << std::
	`£tw
(10è<< 
dv®id©iÚ_rm£
 << std::
’dl
;

82 ià(
h®t_Ú_rm£_šü—£
 > 0 && h®t_Ú_rm£_šü—£ < 
cur_™”©iÚ
 && 
dv®id©iÚ_rm£
 > 
Ï¡_v®id©iÚ_rm£
){

83 
	`log¡»am
(
LOG_WARNING
)<<"Stİpšgƒngšbeÿu£ oàv®id©iÚ RMSE inü—£" << 
¡d
::
’dl
;

84 
cÚv”ged_’gše
 = 
Œue
;

87 
	}
};

90 
	g‹m¶©e
<
ty³Çme
 
	gV”‹xD©aTy³
,y³Çm
	gEdgeD©aTy³
>

91 
š™_v®id©iÚ_rm£_’gše
(
g¿phchi_’gše
<
V”‹xD©aTy³
,
EdgeD©aTy³
> *& 
pv®id©iÚ_’gše
, 
nsh¬ds
,(*
´ediùiÚ_func
)(cÚ¡ 
v”‹x_d©a
 & 
u£r
, cÚ¡ v”‹x_d©¨& 
mov›
, 
¿tšg
, & 
´ediùiÚ
, * 
exŒa
), 
boŞ
 
_time_weightšg
, boŞ 
_time_nodes
, 
_m©Ïb_time_off£t
){

92 
m‘rics
 * 
m
 = 
Ãw
 
	`m‘rics
("validation_rmse_engine");

93 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> * 
’gše
 = 
Ãw
 g¿phchi_’gše<V”‹xD©aTy³, EdgeD©aTy³>(
v®id©iÚ
, 
nsh¬ds
, 
çl£
, *
m
);

94 
	`£t_’gše_æags
(*
’gše
);

95 
pv®id©iÚ_’gše
 = 
’gše
;

96 
time_weightšg
 = 
_time_weightšg
;

97 
time_nodes
 = 
_time_nodes
;

98 
m©Ïb_time_off£t
 = 
_m©Ïb_time_off£t
;

99 
µ»diùiÚ_func
 = 
´ediùiÚ_func
;

100 
num_th»ads
 = 
	`numb”_of_omp_th»ads
();

101 
	}
}

105 
	g‹m¶©e
<
ty³Çme
 
	gV”‹xD©aTy³
,y³Çm
	gEdgeD©aTy³
>

106 
run_v®id©iÚ4
(
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> * 
pv®id©iÚ_’gše
, 
g¿phchi_cÚ‹xt
 & 
cÚ‹xt
){

108 
	gcur_™”©iÚ
 = 
cÚ‹xt
.
™”©iÚ
;

109 ià(
	gpv®id©iÚ_’gše
 =ğ
NULL
)

111 
V®id©iÚRMSEProg¿m4
 
	g´og¿m
;

112 
	gpv®id©iÚ_’gše
->
run
(
´og¿m
, 1);

113 ià(
	gcÚv”ged_’gše
)

114 
	gcÚ‹xt
.
£t_Ï¡_™”©iÚ
(
cur_™”©iÚ
);

117 
	$»£t_rm£
(
exec_th»ads
){

118 
	`log¡»am
(
LOG_DEBUG
)<<"D‘eùed‚umb” oàth»ads: " << 
exec_th»ads
 << 
¡d
::
’dl
;

119 
num_th»ads
 = 
exec_th»ads
;

120 
rm£_vec
 = 
	`z”os
(
exec_th»ads
);

121 
	}
}

	@toolkits/collaborative_filtering/sgd.cpp

34 
	~"eig’_w¿µ”.hµ
"

35 
	~"commÚ.hµ
"

37 
	gsgd_Ïmbda
 = 1e-3;

38 
	gsgd_gamma
 = 1e-3;

39 
	gsgd_¡•_dec
 = 0.9;

41 
	sv”‹x_d©a
 {

42 
vec
 
	mpvec
;

44 
v”‹x_d©a
() {

45 
	mpvec
 = 
z”os
(
D
);

47 
£t_v®
(
šdex
, 
v®
){

48 
	mpvec
[
šdex
] = 
v®
;

50 
g‘_v®
(
šdex
){

51  
	mpvec
[
šdex
];

56 
	~"ut.hµ
"

62 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

63 
	tEdgeD©aTy³
;

65 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

66 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	gpv®id©iÚ_’gše
 = 
NULL
;

67 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

69 
	~"rm£.hµ
"

70 
	~"rm£_’gše.hµ
"

71 
	~"io.hµ
"

74 
	$sgd_´ediù
(cÚ¡ 
v”‹x_d©a
& 
u£r
,

75 cÚ¡ 
v”‹x_d©a
& 
mov›
,

76 cÚ¡ 
¿tšg
,

77 & 
´ediùiÚ
,

78 * 
exŒa
 = 
NULL
){

81 
´ediùiÚ
 = 
	`dÙ_´od
(
u£r
.
pvec
,
mov›
.pvec);

84 
´ediùiÚ
 = 
¡d
::
	`mš
((í»diùiÚ, 
maxv®
);

85 
´ediùiÚ
 = 
¡d
::
	`max
((í»diùiÚ, 
mšv®
);

87 
”r
 = 
¿tšg
 - 
´ediùiÚ
;

88 
	`as£¹
(!
¡d
::
	`i¢ª
(
”r
));

89  
”r
*err;

91 
	}
}

98 
	gSGDV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

103 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

104 
»£t_rm£
(
gcÚ‹xt
.
exeùh»ads
);

112 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

113 
	gsgd_gamma
 *ğ
sgd_¡•_dec
;

114 
Œaššg_rm£
(
™”©iÚ
, 
gcÚ‹xt
);

115 
run_v®id©iÚ
(
pv®id©iÚ_’gše
, 
gcÚ‹xt
);

121 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

123 iàĞ
	gv”‹x
.
num_ou‹dges
() > 0){

124 
	gv”‹x_d©a
 & 
	gu£r
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

126 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

127 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

128 
	gv”‹x_d©a
 & 
	gmov›
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

129 
	ge¡ScÜe
;

130 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
sgd_´ediù
(
u£r
, 
mov›
, 
ob£rv©iÚ
, 
e¡ScÜe
);

131 
	g”r
 = 
ob£rv©iÚ
 - 
e¡ScÜe
;

132 ià(
	g¡d
::
i¢ª
(
”r
è|| 
¡d
::
isšf
(err))

133 
log¡»am
(
LOG_FATAL
)<<"SGD gÙ iÁØnum”iÿÈ”rÜ. PËa£uÃ s‹°sizusšg --sgd_gamm¨ªd sgd_Ïmbda" << 
¡d
::
’dl
;

141 
	gmov›
.
	gpvec
 +ğ
sgd_gamma
*(
”r
*
u£r
.
pvec
 - 
sgd_Ïmbda
*
mov›
.pvec);

143 
	gu£r
.
	gpvec
 +ğ
sgd_gamma
*(
”r
*
mov›
.
pvec
 - 
sgd_Ïmbda
*
u£r
.pvec);

156 
ouut_sgd_»suÉ
(
¡d
::
¡ršg
 
f’ame
) {

157 
MMOuu‰”_m©
<
v”‹x_d©a
> 
u£r_m©
(
f’ame
 + "_U.mm", 0, 
M
, "Thi fcÚš SGD ouuˆm©rix U. IÀ—ch„ow D faùÜ oà¨sšgË u£¸node.", 
Ï‹Á_çùÜs_šmem
);

158 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
™em_m©
(
f’ame
 + "_V.mm", 
M
 ,M+
N
, "Thi fcÚš SGD ouuˆm©rix V. IÀ—ch„ow D faùÜ oà¨sšgË i‹m‚ode.", 
Ï‹Á_çùÜs_šmem
);

160 
log¡»am
(
LOG_INFO
è<< "SGD ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << "_U.mm" <<

161 ", " << 
	gf’ame
 + "_V.mm " << 
	g¡d
::
’dl
;

165 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

167 
	`´št_cİyright
();

170 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

174 
m‘rics
 
	`m
("sgd-inmemory-factors");

177 
sgd_Ïmbda
 = 
	`g‘_İtiÚ_æßt
("sgd_lambda", 1e-3);

178 
sgd_gamma
 = 
	`g‘_İtiÚ_æßt
("sgd_gamma", 1e-3);

179 
sgd_¡•_dec
 = 
	`g‘_İtiÚ_æßt
("sgd_step_dec", 0.9);

181 
	`·r£_commªd_lše_¬gs
();

182 
	`·r£_im¶ic™_commªd_lše
();

185 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
Œaššg
, 
NULL
, 0, 0, 3, 
TRAINING
, 
çl£
);

186 
š™_ã©u»_veùÜs
<
¡d
::
veùÜ
<
v”‹x_d©a
> >(
M
+
N
, 
Ï‹Á_çùÜs_šmem
, !
lßd_çùÜs_äom_fe
);

187 ià(
v®id©iÚ
 != ""){

188 
vsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
v®id©iÚ
, 
NULL
, 0, 0, 3, 
VALIDATION
, 
çl£
);

189 
š™_v®id©iÚ_rm£_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
>(
pv®id©iÚ_’gše
, 
vsh¬ds
, &
sgd_´ediù
);

193 ià(
lßd_çùÜs_äom_fe
){

194 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_U.mm", 0, 
D
);

195 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_V.mm", 
M
, 
D
);

198 
	`´št_cÚfig
();

201 
SGDV”tiûsInMemProg¿m
 
´og¿m
;

202 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

203 
	`£t_’gše_æags
(
’gše
);

204 
³ngše
 = &
’gše
;

205 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

208 
	`ouut_sgd_»suÉ
(
Œaššg
);

209 
	`‹¡_´ediùiÚs
(&
sgd_´ediù
);

212 ià(!
qu›t
)

213 
	`m‘rics_»pÜt
(
m
);

216 
	}
}

	@toolkits/collaborative_filtering/sparse_als.cpp

32 
	~"co§mp.hµ
"

33 
	~"eig’_w¿µ”.hµ
"

34 
	~"commÚ.hµ
"

36 
	gÏmbda
 = 0.065;

38 
	sv”‹x_d©a
 {

39 
vec
 
	mpvec
;

41 
v”‹x_d©a
() {

42 
	mpvec
 = 
z”os
(
D
);

44 
£t_v®
(
šdex
, 
v®
){

45 
	mpvec
[
šdex
] = 
v®
;

47 
g‘_v®
(
šdex
){

48  
	mpvec
[
šdex
];

57 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

58 
	tEdgeD©aTy³
;

60 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

61 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	gpv®id©iÚ_’gše
 = 
NULL
;

62 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

64 
	~"io.hµ
"

68 
	mSPARSE_USR_FACTOR
 = 1, 
	mSPARSE_ITM_FACTOR
 = 2, 
	mSPARSE_BOTH_FACTORS
 = 3

71 
	g®gÜ™hm
;

72 
	gu£r_¥¬s™y
;

73 
	gmov›_¥¬s™y
;

75 
	~"rm£.hµ
"

76 
	~"rm£_’gše.hµ
"

79 
	$¥¬£_®s_´ediù
(cÚ¡ 
v”‹x_d©a
& 
u£r
,

80 cÚ¡ 
v”‹x_d©a
& 
mov›
,

81 cÚ¡ 
¿tšg
,

82 & 
´ediùiÚ
,

83 * 
exŒa
 = 
NULL
){

86 
´ediùiÚ
 = 
u£r
.
pvec
.
	`dÙ
(
mov›
.pvec);

88 
´ediùiÚ
 = 
¡d
::
	`mš
((í»diùiÚ, 
maxv®
);

89 
´ediùiÚ
 = 
¡d
::
	`max
((í»diùiÚ, 
mšv®
);

91 
”r
 = 
¿tšg
 - 
´ediùiÚ
;

92 
	`as£¹
(!
¡d
::
	`i¢ª
(
”r
));

93  
”r
*err;

95 
	}
}

104 
	gALSV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

110 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

111 
	gv”‹x_d©a
 & 
	gvd©a
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

112 
m©
 
	gXtX
 = m©::
Z”o
(
D
, D);

113 
vec
 
	gXty
 = vec::
Z”o
(
D
);

115 
boŞ
 
	gcompu‹_rm£
 = (
v”‹x
.
num_ou‹dges
() > 0);

117 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

118 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

119 
	gv”‹x_d©a
 & 
	gnbr_Ï‹Á
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

120 
	gXty
 +ğ
nbr_Ï‹Á
.
pvec
 * 
ob£rv©iÚ
;

121 
	gXtX
 +ğ
nbr_Ï‹Á
.
pvec
 *‚br_Ï‹Á.pvec.
Œª¥o£
();

122 ià(
	gcompu‹_rm£
) {

123 
	g´ediùiÚ
;

124 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
¥¬£_®s_´ediù
(
vd©a
, 
nbr_Ï‹Á
, 
ob£rv©iÚ
, 
´ediùiÚ
);

128 
	gi
=0; i < 
	gD
; i++è
XtX
(
i
,iè+ğ(
Ïmbda
);

130 
boŞ
 
	gisu£r
 = 
v”‹x
.
id
(è< (
ušt
)
M
;

131 ià(
	g®gÜ™hm
 =ğ
SPARSE_BOTH_FACTORS
 || (
®gÜ™hm
 =ğ
SPARSE_USR_FACTOR
 && 
isu£r
) ||

132 (
®gÜ™hm
 =ğ
SPARSE_ITM_FACTOR
 && !
isu£r
)){

133 
¥¬s™y_Ëv–
 = 1.0;

134 ià(
	gisu£r
)

135 
	g¥¬s™y_Ëv–
 -ğ
u£r_¥¬s™y
;

136 
	g¥¬s™y_Ëv–
 -ğ
mov›_¥¬s™y
;

137 
	gvd©a
.
	gpvec
 = 
CoSaMP
(
XtX
, 
Xty
, ()
û
(
¥¬s™y_Ëv–
*()
D
), 10, 1e-4, D);

139 
	gvd©a
.
	gpvec
 = 
XtX
.
£lçdjoštV›w
<
Eig’
::
Uµ”
>().
ldÉ
().
sŞve
(
Xty
);

145 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

146 
»£t_rm£
(
gcÚ‹xt
.
exeùh»ads
);

154 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

155 
Œaššg_rm£
(
™”©iÚ
, 
gcÚ‹xt
);

156 
run_v®id©iÚ
(
pv®id©iÚ_’gše
, 
gcÚ‹xt
);

162 
ouut_®s_»suÉ
(
¡d
::
¡ršg
 
f’ame
) {

163 
MMOuu‰”_m©
<
v”‹x_d©a
> 
u£r_m©
(
f’ame
 + "_U.mm", 0, 
M
, "Thi fcÚš ALS ouuˆm©rix U. IÀ—ch„ow D faùÜ oà¨sšgË u£¸node.", 
Ï‹Á_çùÜs_šmem
);

164 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
™em_m©
(
f’ame
 + "_V.mm", 
M
, M+
N
, "Thi fcÚš ALS ouuˆm©rix V. IÀ—ch„ow D faùÜ oà¨sšgË i‹m‚ode.", 
Ï‹Á_çùÜs_šmem
);

165 
log¡»am
(
LOG_INFO
è<< "ALS ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << "_U.mm" <<

166 ", " << 
	gf’ame
 + "_V.mm " << 
	g¡d
::
’dl
;

169 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

171 
	`´št_cİyright
();

175 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

179 
m‘rics
 
	`m
("als-inmemory-factors");

181 
Ïmbda
 = 
	`g‘_İtiÚ_æßt
("lambda", 0.065);

182 
u£r_¥¬s™y
 = 
	`g‘_İtiÚ_æßt
("user_sparsity", 0.9);

183 
mov›_¥¬s™y
 = 
	`g‘_İtiÚ_æßt
("movie_sparsity", 0.9);

184 
®gÜ™hm
 = 
	`g‘_İtiÚ_št
("®gÜ™hm", 
SPARSE_USR_FACTOR
);

186 
	`·r£_commªd_lše_¬gs
();

187 
	`·r£_im¶ic™_commªd_lše
();

189 ià(
u£r_¥¬s™y
 < 0.5 || user_sparsity >= 1)

190 
	`log¡»am
(
LOG_FATAL
)<<"S·rs™y†ev– should b[0.5,1). PËa£„uÀagaš usšg --u£r_¥¬s™y=XX iÀthi ¿nge" << 
¡d
::
’dl
;

192 ià(
mov›_¥¬s™y
 < 0.5 || movie_sparsity >= 1)

193 
	`log¡»am
(
LOG_FATAL
)<<"S·rs™y†ev– should b[0.5,1). PËa£„uÀagaš usšg --mov›_¥¬s™y=XX iÀthi ¿nge" << 
¡d
::
’dl
;

195 ià(
®gÜ™hm
 !ğ
SPARSE_USR_FACTOR
 &&‡lgÜ™hm !ğ
SPARSE_BOTH_FACTORS
 &&‡lgÜ™hm !ğ
SPARSE_ITM_FACTOR
)

196 
	`log¡»am
(
LOG_FATAL
)<<"AlgÜ™hm should b1 fÜ SPARSE_USR_FACTOR, 2 fÜ SPARSE_ITM_FACTOR‡nd 3 fÜ SPARSE_BOTH_FACTORS" << 
¡d
::
’dl
;

199 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
Œaššg
);

200 
š™_ã©u»_veùÜs
<
¡d
::
veùÜ
<
v”‹x_d©a
> >(
M
+
N
, 
Ï‹Á_çùÜs_šmem
, !
lßd_çùÜs_äom_fe
);

201 ià(
v®id©iÚ
 != ""){

202 
vsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
v®id©iÚ
, 
NULL
, 0, 0, 3, 
VALIDATION
);

203 
š™_v®id©iÚ_rm£_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
>(
pv®id©iÚ_’gše
, 
vsh¬ds
, &
¥¬£_®s_´ediù
);

207 ià(
lßd_çùÜs_äom_fe
){

208 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_U.mm", 0, 
D
);

209 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_V.mm", 
M
, 
D
);

213 
ALSV”tiûsInMemProg¿m
 
´og¿m
;

214 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

215 
	`£t_’gše_æags
(
’gše
);

216 
³ngše
 = &
’gše
;

217 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

220 
	`ouut_®s_»suÉ
(
Œaššg
);

221 
	`‹¡_´ediùiÚs
(&
¥¬£_®s_´ediù
);

224 ià(!
qu›t
)

225 
	`m‘rics_»pÜt
(
m
);

227 
	}
}

	@toolkits/collaborative_filtering/sparse_gensgd.cpp

37 
	~<veùÜ
>

38 
	~"commÚ.hµ
"

39 
	~"eig’_w¿µ”.hµ
"

40 
	~"../·r£rs/commÚ.hµ
"

41 
	~<omp.h
>

42 
	#MAX_FEATAURES
 256

	)

43 
	#FEATURE_WIDTH
 21

44 

	)

45 
	gg’sgd_¿‹1
 = 1e-02;

46 
	gg’sgd_¿‹2
 = 1e-02;

47 
	gg’sgd_¿‹3
 = 1e-02;

48 
	gg’sgd_¿‹4
 = 1e-02;

49 
	gg’sgd_¿‹5
 = 1e-02;

50 
	gg’sgd_muÉ_dec
 = 0.9;

51 
	gg’sgd_»gw
 = 1e-3;

52 
	gg’sgd_»gv
 = 1e-3;

53 
	gg’sgd_»g0
 = 1e-1;

54 
boŞ
 
	gdebug
 = 
çl£
;

55 
	g¡d
::
¡ršg
 
u£r_fe
;

56 
	g¡d
::
¡ršg
 
™em_fe
;

57 
	g¡d
::
¡ršg
 
u£r_lšks
;

58 
	glim™_¿tšg
 = 0;

59 
size_t
 
	gv”‹x_w™h_no_edges
 = 0;

60 
	gÿlc_”rÜ
 = 0;

61 
	gÿlc_roc
 = 0;

62 
	gbš¬y
 = 1;

63 
	ground_æßt
 = 0;

64 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
h—d”_t™Ës
;

65 
	ghas_h—d”_t™Ës
 = 0;

66 
	gcutoff
 = 0;

67 
	g¡d
::
¡ršg
 
fÜm©
 = "libsvm";

68 
vec
 
	g”rÜs_vec
;

70 
	ssšgË_m­
{

71 
	m¡d
::
m­
<,
	mušt
> 
	m¡ršg2nodeid
;

72 
sšgË_m­
(){

76 
	sã©u»_cÚŒŞ
{

77 
	m¡d
::
veùÜ
<
sšgË_m­
> 
node_id_m­s
;

78 
sšgË_m­
 
	mv®_m­
;

79 
sšgË_m­
 
	mšdex_m­
;

80 
	m»hash_v®ue
;

81 
	mã©u»_num
;

82 
	mnode_ã©u»s
;

83 
	mnode_lšks
;

84 
	mtÙ®_ã©u»s
;

85 cÚ¡ 
	m¡d
::
¡ršg
 
deçuÉ_ã©u»_¡r
;

86 
	m¡d
::
veùÜ
<> 
off£ts
;

87 
boŞ
 
	mhash_¡ršgs
;

88 
	mäom_pos
;

89 
	mto_pos
;

90 
	mv®_pos
;

92 
ã©u»_cÚŒŞ
(){

93 
	m»hash_v®ue
 = 0;

94 
	mtÙ®_ã©u»s
 = 0;

95 
	mnode_ã©u»s
 = 0;

96 
	mã©u»_num
 = 
FEATURE_WIDTH
;

97 
	mhash_¡ršgs
 = 
çl£
;

98 
	mäom_pos
 = 0;

99 
	mto_pos
 = 1;

100 
	mv®_pos
 = -1;

101 
	mnode_lšks
 = 0;

105 
ã©u»_cÚŒŞ
 
	gfc
;

107 
	$num_ã©u»_bšs
(){

108 
sum
 = 0;

109 ià(
fc
.
hash_¡ršgs
){

110 
	`as£¹
(2+
fc
.
tÙ®_ã©u»s
+fc.
node_ã©u»s
 =ğ()fc.
node_id_m­s
.
	`size
());

111 
i
=2; i < 2+
fc
.
tÙ®_ã©u»s
+fc.
node_ã©u»s
; i++){

112 
sum
+ğ
fc
.
node_id_m­s
[
i
].
¡ršg2nodeid
.
	`size
();

115 
	`as£¹
(
çl£
);

117  
sum
;

118 
	}
}

120 
	$ÿlc_ã©u»_num
(){

121  2+
fc
.
tÙ®_ã©u»s
+fc.
node_ã©u»s
;

122 
	}
}

123 
g‘_off£ts
(
¡d
::
veùÜ
<> & 
off£ts
){

124 
as£¹
(
off£ts
.
size
() > 3);

125 
	goff£ts
[0] = 0;

126 
	goff£ts
[1] = 
M
;

127 
	goff£ts
[2] = 
M
+
N
;

128 
ušt
 
	gi
=3; i< 
	goff£ts
.
size
(); i++){

129 
as£¹
(
fc
.
node_id_m­s
.
size
(è> (
ušt
)
i
);

130 
	goff£ts
[
i
] +ğ
off£ts
[i-1] + 
fc
.
node_id_m­s
[i].
¡ršg2nodeid
.
size
();

134 
boŞ
 
	$is_u£r
(
vid_t
 
id
){  id < 
M
; 
	}
}

135 
boŞ
 
	$is_™em
(
vid_t
 
id
){  id >ğ
M
 && id < 
N
; 
	}
}

136 
boŞ
 
	$is_time
(
vid_t
 
id
){  id >ğ
M
+
N
; 
	}
}

138 
	#BIAS_POS
 -1

	)

139 
	sv”‹x_d©a
 {

140 
fvec
 
	mpvec
;

141 
	mbŸs
;

143 
v”‹x_d©a
() {

144 
	mbŸs
 = 0;

146 
£t_v®
(
šdex
, 
v®
){

147 ià(
	mšdex
 =ğ
BIAS_POS
)

148 
bŸs
 = 
v®
;

149 
	mpvec
[
šdex
] = 
v®
;

151 
g‘_v®
(
šdex
){

152 ià(
	mšdex
=ğ
BIAS_POS
)

153  
bŸs
;

154  
	mpvec
[
šdex
];

161 
	sedge_d©a
 {

162 
ušt
 
	mã©u»s
[
FEATURE_WIDTH
];

163 
ušt
 
	mšdex
[
FEATURE_WIDTH
];

164 
ušt
 
	msize
;

165 
	mweight
;

166 
edge_d©a
() {

167 
	mweight
 = 0;

168 
	msize
 = 0;

169 
mem£t
(
ã©u»s
, 0, (
ušt
)*
FEATURE_WIDTH
);

170 
mem£t
(
šdex
, 0, (
ušt
)*
FEATURE_WIDTH
);

173 
edge_d©a
(
weight
, 
ušt
 * 
v®¬¿y
, ušˆ* 
_šdex
, ušˆ
size
): size(size), weight(weight) {

174 
memıy
(
ã©u»s
, 
v®¬¿y
, (
ušt
)*
FEATURE_WIDTH
);

175 
memıy
(
šdex
, 
_šdex
, (
ušt
)*
FEATURE_WIDTH
);

185 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

186 
edge_d©a
 
	tEdgeD©aTy³
;

188 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

189 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

192 
	$ÿlc_ã©u»_node_¬¿y_size
(
ušt
 
node
, ušˆ
™em
, ušˆ
edge_size
){

193 
	`as£¹
(
node
 <ğ
M
);

194 
	`as£¹
(
™em
 <ğ
N
);

195 
	`as£¹
(
edge_size
 >= 0);

196 
	`as£¹
(
node
 < 
Ï‹Á_çùÜs_šmem
.
	`size
());

197 
	`as£¹
(
fc
.
off£ts
[1]+
™em
 < 
Ï‹Á_çùÜs_šmem
.
	`size
());

198  2+
edge_size
;

199 
	}
}

201 
	$assign_id
(
sšgË_m­
& 
dm­
, & 
outv®
, cÚ¡ 
Çme
){

203 
¡d
::
m­
<,
ušt
>::
™”©Ü
 
™
 = 
dm­
.
¡ršg2nodeid
.
	`fšd
(
Çme
);

205 ià(
™
 !ğ
dm­
.
¡ršg2nodeid
.
	`’d
()){

206 
outv®
 = 
™
->
£cÚd
 - 1;

207 
	`as£¹
(
outv®
 < 
dm­
.
¡ršg2nodeid
.
	`size
());

210 
mymu‹x
.
	`lock
();

212 
outv®
 = 
dm­
.
¡ršg2nodeid
[
Çme
];

213 ià(
outv®
 == 0){

214 
dm­
.
¡ršg2nodeid
[
Çme
] = dm­.¡ršg2nodeid.
	`size
();

215 
outv®
 = 
dm­
.
¡ršg2nodeid
.
	`size
() - 1;

217 
mymu‹x
.
	`uÆock
();

218 
	}
}

224 
	$g‘_node_id
(* 
pch
, 
pos
, 
size_t
 
i
, 
boŞ
 
»ad_Úly
 = 
çl£
){

225 
	`as£¹
(
pch
 !ğ
NULL
);

226 
	`as£¹
(
pch
[0] != 0);

227 
	`as£¹
(
i
 >= 0);

229 
»t
;

231 ià(!
fc
.
hash_¡ršgs
){

232 
»t
 = (
pos
 < 2 ? 
	`©oi
(
pch
è: 
	`©of
(pch));

233 ià(
pos
 < 2)

234 
»t
--;

235 ià(
pos
 =ğ0 && 
»t
 >ğ
M
)

236 
	`log¡»am
(
LOG_FATAL
)<<"Row index†¬g”hªhm©rix„ow siz" << 
»t
 << " > " << 
M
 << " iÀlše: " << 
i
 << 
¡d
::
’dl
;

237 ià(
pos
 =ğ1 && 
»t
 >ğ
N
)

238 
	`log¡»am
(
LOG_FATAL
)<<"CŞ index†¬g”hªhm©rix„ow siz" << 
»t
 << " > " << 
N
 << " iÀlše: " << 
i
 << 
¡d
::
’dl
;

243 
ušt
 
id
;

244 
v®
 = 
	`©of
(
pch
);

245 
	`as£¹
(!
¡d
::
	`i¢ª
(
v®
));

246 ià(
round_æßt
)

247 
v®
 = 
	`æoÜf
(val * 10000 + 0.5) / 10000;

248 ià(
pos
 >= 0)

249 
	`as£¹
(
pos
 < ()
fc
.
node_id_m­s
.
	`size
());

250 
sšgË_m­
 * 
pm­
 = 
NULL
;

251 ià(
pos
 == -1)

252 
pm­
 = &
fc
.
šdex_m­
;

253 
pm­
 = &
fc
.
node_id_m­s
[
pos
];

255 ià(
»ad_Úly
){

256 
¡d
::
m­
<,
ušt
>::
™”©Ü
 
™
 = 
pm­
->
¡ršg2nodeid
.
	`fšd
(
v®
);

257 ià(
™
 !ğ
pm­
->
¡ršg2nodeid
.
	`’d
()){

258 
»t
 = 
™
->
£cÚd
 - 1;

259 
	`as£¹
(
»t
 < 
pm­
->
¡ršg2nodeid
.
	`size
());

261 
»t
 = -1;

264 
	`assign_id
(*
pm­
, 
id
, 
v®
);

265 ià(
pos
 =ğ-1 && 
fc
.
šdex_m­
.
¡ršg2nodeid
.
	`size
(è=ğ
id
+1 && fc.
node_id_m­s
.size() < fc.index_map.string2nodeid.size()+2){

266 
sšgË_m­
 
Ãwm­
;

267 
fc
.
node_id_m­s
.
	`push_back
(
Ãwm­
);

269 
»t
 = 
id
;

273 ià(!
»ad_Úly
)

274 
	`as£¹
(
»t
 != -1);

275  
»t
;

276 
	}
}

279 
	~"io.hµ
"

280 
	~"../·r£rs/commÚ.hµ
"

284 
	$g‘_v®ue
(* 
pch
, 
boŞ
 
»ad_Úly
){

285 
»t
;

286 ià(!
fc
.
»hash_v®ue
){

287 
»t
 = 
	`©of
(
pch
);

290 
ušt
 
id
;

291 ià(
»ad_Úly
){

292 
¡d
::
m­
<,
ušt
>::
™”©Ü
 
™
 = 
fc
.
v®_m­
.
¡ršg2nodeid
.
	`fšd
(
	`©of
(
pch
));

293 ià(
™
 !ğ
fc
.
v®_m­
.
¡ršg2nodeid
.
	`’d
()){

294 
»t
 = 
™
->
£cÚd
 - 1;

296 
»t
 = -1;

299 
	`assign_id
(
fc
.
v®_m­
, 
id
, 
	`©of
(
pch
));

300 
»t
 = 
id
;

304 ià(
¡d
::
	`i¢ª
(
»t
è|| std::
	`isšf
(ret))

305 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad v®ue" << 
¡d
::
’dl
;

306  
»t
;

307 
	}
}

310 
boŞ
 
»ad_lše
(
FILE
 * 
f
, cÚ¡ 
¡d
::
¡ršg
 
f’ame
, 
size_t
 
i
, 
ušt
 & 
I
, ušˆ& 
J
, &
v®
, std::
veùÜ
<ušt>& 
v®¬¿y
, std::veùÜ<ušt>& 
pos™iÚs
, & 
šdex
, 
ty³
, & 
sk³d_ã©u»s
){

312 * 
	glšebuf
 = 
NULL
;

313 
size_t
 
	glšesize
;

314 
	glšebuf_debug
[1024];

316 
	gtok’
 = 0;

317 
	gšdex
 = 0;

319 
	grc
 = 
g‘lše
(&
lšebuf
, &
lšesize
, 
f
);

320 ià(
	grc
 == -1)

321 
log¡»am
(
LOG_FATAL
)<<"FaedØg‘†še: " << 
i
 << " iÀfe: " << 
f’ame
 << 
¡d
::
’dl
;

322 * 
	glšebuf_to_ä“
 = 
lšebuf
;

323 
¡ºıy
(
lšebuf_debug
, 
lšebuf
, 1024);

325 
	gšdex
 < 
	gFEATURE_WIDTH
){

328 ià(
	gtok’
 =ğ
fc
.
äom_pos
){

329 *
pch
 = 
¡r£p
(&
lšebuf
,"\t,\r\n: ");

330 ià(
	gpch
 =ğ
NULL
)

331 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
i
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

332 
	gI
 = (
ušt
)
g‘_node_id
(
pch
, 0, 
i
, 
ty³
 !ğ
TRAINING
);

333 
	gtok’
++;

335 ià(
	gtok’
 =ğ
fc
.
to_pos
){

337 * 
pch
 = 
¡r£p
(&
lšebuf
, "\t,\r\n: ");

338 ià(
	gpch
 =ğ
NULL
)

339 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
i
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

340 
	gJ
 = (
ušt
)
g‘_node_id
(
pch
, 1, 
i
, 
ty³
 !ğ
TRAINING
);

341 
	gtok’
++;

343 ià(
	gtok’
 =ğ
fc
.
v®_pos
){

345 * 
pch
 = 
¡r£p
(&
lšebuf
, "\t,\r\n ");

346 ià(
	gpch
 =ğ
NULL
)

347 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
i
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

349 
	gv®
 = 
g‘_v®ue
(
pch
, 
ty³
 !ğ
TRAINING
);

350 
	gtok’
++;

354 * 
	gpch
 = 
¡r£p
(&
lšebuf
, "\t,\r\n:; ");

355 ià(
	gpch
 =ğ
NULL
 || 
pch
[0] == 0)

358 
ušt
 
	gpos
 = 
g‘_node_id
(
pch
, -1, 
i
, 
ty³
 !ğ
TRAINING
);

359 ià(
	gty³
 !ğ
TRAINING
 && 
pos
 =ğ(
ušt
)-1){

360 * 
pch2
 = 
¡r£p
(&
lšebuf
, "\t\r\n ");

361 ià(
	gpch2
 =ğ
NULL
 || 
pch2
[0] == 0)

362 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
i
 << " f—tu»2 " << 
šdex
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

363 
	gsk³d_ã©u»s
++;

367 
as£¹
(
pos
 !ğ(
ušt
)-1 &&…o < 
fc
.
šdex_m­
.
¡ršg2nodeid
.
size
());

369 * 
	gpch2
 = 
¡r£p
(&
lšebuf
, "\t\r\n ");

370 ià(
	gpch2
 =ğ
NULL
 || 
pch2
[0] == 0)

371 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
i
 << " f—tu»2 " << 
šdex
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

373 
ušt
 
	g£cÚd_šdex
 = 
g‘_node_id
(
pch2
, 
pos
, 
i
, 
ty³
 !ğ
TRAINING
);

374 ià(
	gty³
 !ğ
TRAINING
 && 
£cÚd_šdex
 =ğ(
ušt
)-1){

375 
£cÚd_šdex
 = 0;

378 
as£¹
(
£cÚd_šdex
 !ğ(
ušt
)-1);

379 
as£¹
(
šdex
< ()
v®¬¿y
.
size
());

380 
as£¹
(
šdex
< ()
pos™iÚs
.
size
());

381 
	gv®¬¿y
[
šdex
] = 
£cÚd_šdex
;

382 
	gpos™iÚs
[
šdex
] = 
pos
;

383 
	gšdex
++;

384 
	gtok’
++;

387 
ä“
(
lšebuf_to_ä“
);

388  
	gŒue
;

392 
compu‹_´ediùiÚ
(

393 
ušt
 
I
,

394 
ušt
 
J
,

395 cÚ¡ 
v®
,

396 & 
´ediùiÚ
,

397 
ušt
 * 
v®¬¿y
,

398 
ušt
 * 
pos™iÚs
,

399 
ušt
 
edge_size
,

400 (*
´ediùiÚ_func
)(
¡d
::
veùÜ
<
v”‹x_d©a
*>& 
node_¬¿y
, 
¬¿ysize
, 
¿tšg
, & 
´ediùiÚ
, 
fvec
 * 
psum
),

401 
fvec
 * 
psum
,

402 
¡d
::
veùÜ
<
v”‹x_d©a
*>& 
node_¬¿y
,

403 
ušt
 
node_¬¿y_size
){

408 
šdex
 = 0;

409 
loc
 = 0;

410 
node_¬¿y
[
šdex
] = &
Ï‹Á_çùÜs_šmem
[
I
+
fc
.
off£ts
[index]];

411 
	`as£¹
(
node_¬¿y
[
šdex
]->
pvec
[0] < 1e5);

412 
šdex
++; 
loc
++;

415 
	`as£¹
(
J
+
fc
.
off£ts
[
šdex
] < 
Ï‹Á_çùÜs_šmem
.
	`size
());

416 
node_¬¿y
[
šdex
] = &
Ï‹Á_çùÜs_šmem
[
J
+
fc
.
off£ts
[index]];

417 
	`as£¹
(
node_¬¿y
[
šdex
]->
pvec
[0] < 1e5);

418 
šdex
++; 
loc
++;

421 
j
=0; j< ()
edge_size
; j++){

422 
	`as£¹
(
fc
.
off£ts
.
	`size
(è> 
pos™iÚs
[
j
]);

423 
ušt
 
pos
 = 
fc
.
off£ts
[
pos™iÚs
[
j
]] + 
v®¬¿y
[j];

424 
	`as£¹
(
pos
 >ğ0 &&…o < 
Ï‹Á_çùÜs_šmem
.
	`size
());

425 
	`as£¹
(
j
+
šdex
 < ()
node_¬¿y_size
);

426 
node_¬¿y
[
j
+
šdex
] = & 
Ï‹Á_çùÜs_šmem
[
pos
];

427 
	`as£¹
(
node_¬¿y
[
j
+
šdex
]->
pvec
[0] < 1e5);

429 
šdex
+ğ
edge_size
;

430 
loc
 +ğ
edge_size
;

432 
	`as£¹
(
šdex
 =ğ
	`ÿlc_ã©u»_node_¬¿y_size
(
I
,
J
, 
edge_size
));

433 (*
´ediùiÚ_func
)(
node_¬¿y
, 
node_¬¿y_size
, 
v®
, 
´ediùiÚ
, 
psum
);

434  
	`pow
(
v®
 - 
´ediùiÚ
,2);

435 
	}
}

436 
	~"rm£.hµ
"

447 
	g‹m¶©e
 <
ty³Çme
 
	g®s_edge_ty³
>

448 
cÚv”t_m©rixm¬k‘_N
(
¡d
::
¡ršg
 
ba£_f’ame
, 
boŞ
 
squ¬e
, 
ã©u»_cÚŒŞ
 & 
fc
, 
lim™_¿tšg
 = 0) {

450 
FILE
 *
f
;

451 
size_t
 
	gnz
;

455 
	gnsh¬ds
;

456 
	gsh¬d”
<
	g®s_edge_ty³
> 
sh¬d”obj
(
ba£_f’ame
);

457 
	gsh¬d”obj
.
¡¬t_´•roûssšg
();

459 
d‘eù_m©rix_size
(
ba£_f’ame
, 
f
, 
M
, 
N
, 
nz
);

462 ià(
	gfÜm©
 == "libsvm")

463 
as£¹
(!
has_h—d”_t™Ës
);

465 ià(
	ghas_h—d”_t™Ës
){

466 * 
	glšebuf
 = 
NULL
;

467 
size_t
 
	glšesize
;

468 
	glšebuf_debug
[1024];

471 
	grc
 = 
g‘lše
(&
lšebuf
, &
lšesize
, 
f
);

472 ià(
	grc
 == -1)

473 
log¡»am
(
LOG_FATAL
)<<"E¼Ü h—d”†š" << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

475 
¡ºıy
(
lšebuf_debug
, 
lšebuf
, 1024);

479 *
	gpch
 = 
¡¹ok
(
lšebuf
,"\t,\r; ");

480 ià(
	gpch
 =ğ
NULL
)

481 
log¡»am
(
LOG_FATAL
)<<"E¼Ü h—d”†š" << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

483 
	gh—d”_t™Ës
.
push_back
(
pch
);

486 
	gpch
 !ğ
NULL
){

487 
pch
 = 
¡¹ok
(
NULL
, "\t,\r; ");

488 ià(
	gpch
 =ğ
NULL
)

490 
	gh—d”_t™Ës
.
push_back
(
pch
);

495 ià(
	gM
 =ğ0 && 
N
 == 0)

496 
log¡»am
(
LOG_FATAL
)<<"FaedØd‘eù m©rix size. PËa£…»·»‡ fÇmed: " << 
ba£_f’ame
 << ":šfØw™h m©rix m¬k‘ h—d”,‡ ex¶ašed h”e: h‰p://bicksÚ.blog¥Ù.co./2012/12/cŞÏbÜ©ive-f‹ršg-3rd-g’”©iÚ_14.htmÈ" << 
¡d
::
’dl
;

498 
log¡»am
(
LOG_INFO
è<< "S¹šgØ»ad m©rix-m¬k‘ iÅut. M©rix dim’siÚs: " << 
	gM
 << " x " << 
	gN
 << ",‚Ú-z”os: " << 
	gnz
 << 
	g¡d
::
’dl
;

500 
ušt
 
	gI
, 
	gJ
;

501 
	g¡d
::
veùÜ
<
ušt
> 
v®¬¿y
; 
	gv®¬¿y
.
»size
(
FEATURE_WIDTH
);

502 
	g¡d
::
veùÜ
<
ušt
> 
pos™iÚs
; 
	gpos™iÚs
.
»size
(
FEATURE_WIDTH
);

503 
	gv®
;

505 ià(
	glim™_¿tšg
 > 0)

506 
	gnz
 = 
lim™_¿tšg
;

507 
	gsk³d_ã©u»s
 = 0;

509 
size_t
 
	gi
=0; i<
	gnz
; i++)

511 
	gšdex
;

512 ià(!
»ad_lše
(
f
, 
ba£_f’ame
, 
i
,
I
, 
J
, 
v®
, 
v®¬¿y
, 
pos™iÚs
, 
šdex
, 
TRAINING
, 
sk³d_ã©u»s
))

513 
log¡»am
(
LOG_FATAL
)<<"FaedØ»ad†še: " <<
	gi
<< " iÀfe: " << 
	gba£_f’ame
 << 
	g¡d
::
’dl
;

515 ià(
	gšdex
 < 1)

516 
log¡»am
(
LOG_FATAL
)<<"FaedØ»ad†še: " <<
	gi
<< " iÀfe: " << 
	gba£_f’ame
 << 
	g¡d
::
’dl
;

518 ià(
	gnz
 > 1000000 && (
	gi
 % 1000000) == 0)

519 
log¡»am
(
LOG_INFO
)<< 
mytim”
.
cu¼’t_time
(è<< " Fšished„—dšg " << 
i
 << "†še " << 
¡d
::
’dl
;

521 
	gL
++;

522 
	gglob®M—n
 +ğ
v®
;

523 
	gsh¬d”obj
.
´•roûssšg_add_edge
(
I
, 
squ¬e
?
J
:
M
+J, 
®s_edge_ty³
(
v®
, &
v®¬¿y
[0], &
pos™iÚs
[0], 
šdex
));

526 
	gsh¬d”obj
.
’d_´•roûssšg
();

529 
as£¹
(
L
 > 0);

530 
as£¹
(
glob®M—n
 != 0);

531 
	gglob®M—n
 /ğ
L
;

532 
log¡»am
(
LOG_INFO
)<<"Cİu‹d glob® m—Àis: " << 
	gglob®M—n
 << 
	g¡d
::
’dl
;

534 
fşo£
(
f
);

536 
log¡»am
(
LOG_INFO
è<< "Now c»©šg sh¬ds." << 
	g¡d
::
’dl
;

538 
	gnsh¬ds
 = 
sh¬d”obj
.
execu‹_sh¬dšg
(
g‘_İtiÚ_¡ršg
("nshards", "auto"));

540  
	gnsh¬ds
;

546 
boŞ
 
mySÜt
(cÚ¡ 
¡d
::
·œ
<, > &
p1
,cÚ¡ std::·œ<, > &
p2
)

548  
	gp1
.
	g£cÚd
 > 
	gp2
.second;

555 
v®id©iÚ_rm£_N
(

556 (*
´ediùiÚ_func
)(
¡d
::
veùÜ
<
v”‹x_d©a
*>& 
¬¿y
, 
¬¿ysize
, 
¿tšg
, & 
´ediùiÚ
, 
fvec
 * 
psum
)

557 ,
g¿phchi_cÚ‹xt
 & 
gcÚ‹xt
,

558 
ã©u»_cÚŒŞ
 & 
fc
,

559 
boŞ
 
squ¬e
 = 
çl£
) {

561 ià(
v®id©iÚ
 == "")

564 
FILE
 * 
f
 = 
NULL
;

565 
size_t
 
nz
 = 0;

566 
	`d‘eù_m©rix_size
(
v®id©iÚ
, 
f
, 
Me
, 
Ne
, 
nz
);

567 ià(
f
 =ğ
NULL
){

568 
	`log¡»am
(
LOG_WARNING
)<<"FaedØİ’ v®id©iÚ fe: " << 
v®id©iÚ
 << " - skpšg."<<
¡d
::
’dl
;

571 ià((
M
 > 0 && 
N
 > 0è&& (
Me
 !ğM || 
Ne
 != N))

572 
	`log¡»am
(
LOG_WARNING
)<<"IÅuˆsizoàv®id©iÚ m©rix mu¡ bid’tiÿÈtØŒaššg m©rix,‚am–y " << 
M
 << "x" << 
N
 << 
¡d
::
’dl
;

574 
Le
 = 
nz
;

576 
Ï¡_v®id©iÚ_rm£
 = 
dv®id©iÚ_rm£
;

577 
dv®id©iÚ_rm£
 = 0;

579 
¡d
::
veùÜ
<
ušt
> 
v®¬¿y
; v®¬¿y.
	`»size
(
FEATURE_WIDTH
);

580 
¡d
::
veùÜ
<
ušt
> 
pos™iÚs
;…os™iÚs.
	`»size
(
FEATURE_WIDTH
);

581 
ušt
 
I
, 
J
;

582 
v®
;

583 
sk³d_ã©u»s
 = 0;

584 
sk³d_nodes
 = 0;

585 
”rÜs
 = 0;

588 
_M
 = 0;

589 
_N
 = 0;

590 
¡d
::
veùÜ
<¡d::
·œ
<, > > 
»®P»diùiÚ
;

592 
size_t
 
i
=0; i<
nz
; i++)

594 
šdex
;

595 ià(!
	`»ad_lše
(
f
, 
v®id©iÚ
, 
i
, 
I
, 
J
, 
v®
, 
v®¬¿y
, 
pos™iÚs
, 
šdex
, 
VALIDATION
, 
sk³d_ã©u»s
))

596 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad†še: " << 
i
 << " iÀfe: " << 
v®id©iÚ
 << 
¡d
::
’dl
;

598 ià(
I
 =ğ(
ušt
)-1 || 
J
 == (uint)-1){

599 
sk³d_nodes
++;

603 
´ediùiÚ
;

604 
howmªy
 = 
	`ÿlc_ã©u»_node_¬¿y_size
(
I
,
J
, 
šdex
);

605 
¡d
::
veùÜ
<
v”‹x_d©a
*> 
node_¬¿y
;‚ode_¬¿y.
	`»size
(
howmªy
);

606 
k
=0; k< 
howmªy
; k++)

607 
node_¬¿y
[
k
] = 
NULL
;

609 
fvec
 
sum
;

610 
	`compu‹_´ediùiÚ
(
I
, 
J
, 
v®
, 
´ediùiÚ
, &
v®¬¿y
[0], &
pos™iÚs
[0], 
šdex
, 
´ediùiÚ_func
, &
sum
, 
node_¬¿y
, 
howmªy
);

611 ià(
ÿlc_roc
)

612 
»®P»diùiÚ
.
	`push_back
(
¡d
::
	`make_·œ
(
v®
, 
´ediùiÚ
));

614 
‹mp_´ed
 = 
´ediùiÚ
;

615 
‹mp_´ed
 = 
¡d
::
	`mš
Ñemp_´ed, 
maxv®
);

616 
‹mp_´ed
 = 
¡d
::
	`max
Ñemp_´ed, 
mšv®
);

617 
dv®id©iÚ_rm£
 +ğ
	`pow
(
´ediùiÚ
 - 
v®
, 2);

618 ià(
´ediùiÚ
 < 
cutoff
 && 
v®
 >= cutoff)

619 
”rÜs
++;

620 ià(
´ediùiÚ
 >ğ
cutoff
 && 
v®
 < cutoff)

621 
”rÜs
++;

624 
	`fşo£
(
f
);

626 
	`as£¹
(
Le
 > 0);

627 
dv®id©iÚ_rm£
 = 
	`sq¹
(dv®id©iÚ_rm£ / ()
Le
);

628 
¡d
::
cout
<<" V®id©iÚ RMSE: " << std::
	`£tw
(10è<< 
dv®id©iÚ_rm£
;

629 ià(
ÿlc_”rÜ
)

630 
¡d
::
cout
<<" V®id©iÚ E¼: " << std::
	`£tw
(10è<< (()
”rÜs
/()(
nz
-
sk³d_nodes
));

632 ià(
ÿlc_roc
){

633 
roc
 = 0;

634 
»t
 = 0;

635 
¡d
::
veùÜ
<> 
L
;

636 
¡d
::
	`sÜt
(
»®P»diùiÚ
.
	`begš
(),„—lP»diùiÚ.
	`’d
(),
mySÜt
);

637 
¡d
::
veùÜ
<¡d::
·œ
<, > >::
™”©Ü
 
™”
;

638 
™”
=
»®P»diùiÚ
.
	`begš
();™”!ô—lP»diùiÚ.
	`’d
();iter++)

640 
L
.
	`push_back
(
™”
->
fœ¡
);

641 if(
™”
->
fœ¡
 > 
cutoff
è
_M
++;

642 
_N
++;

644 
¡d
::
veùÜ
<>:: 
™”©Ü
 
™”2
;

645 
i
=0;

646 
™”2
=
L
.
	`begš
();™”2!=L.
	`’d
();iter2++)

648 if(*
™”2
 > 
cutoff
è
»t
 +ğ((
_M
+
_N
è- 
i
);

649 
i
++;

651 
»t2
 = 
_M
 *(_M+1)/2;

652 
roc
ğ(
»t
-
»t2
)/(
_M
*
_N
);

653 
¡d
::
cout
<<" V®id©iÚ ROC: " << 
roc
 << std::
’dl
;

655 
¡d
::
cout
<<¡d::
’dl
;

659 ià(
h®t_Ú_rm£_šü—£
 && 
dv®id©iÚ_rm£
 > 
Ï¡_v®id©iÚ_rm£
 && 
gcÚ‹xt
.
™”©iÚ
 > 0){

660 
	`log¡»am
(
LOG_WARNING
)<<"Stİpšgƒngšbeÿu£ oàv®id©iÚ RMSE inü—£" << 
¡d
::
’dl
;

661 
gcÚ‹xt
.
	`£t_Ï¡_™”©iÚ
(gcÚ‹xt.
™”©iÚ
);

663 ià(
sk³d_ã©u»s
 > 0)

664 
	`log¡»am
(
LOG_DEBUG
)<<"Sk³d " << 
sk³d_ã©u»s
 << " wh’„—dšg from fe. " << 
¡d
::
’dl
;

665 ià(
sk³d_nodes
 > 0)

666 
	`log¡»am
(
LOG_DEBUG
)<<"Sk³d " << 
sk³d_nodes
 << " wh’„—dšg from fe. " << 
¡d
::
’dl
;

667 
	}
}

672 
‹¡_´ediùiÚs_N
(

673 (*
´ediùiÚ_func
)(
¡d
::
veùÜ
<
v”‹x_d©a
*>& 
node_¬¿y
, 
node_¬¿y_size
, 
¿tšg
, & 
´ediùiÚi
, 
fvec
 * 
sum
),

674 
ã©u»_cÚŒŞ
 & 
fc
,

675 
boŞ
 
squ¬e
 = 
çl£
) {

676 
FILE
 *
f
 = 
NULL
;

677 
ušt
 
Me
, 
Ne
;

678 
size_t
 
nz
;

680 ià(
‹¡
 == ""){

681 
	`log¡»am
(
LOG_INFO
)<<"NØ‹¡ fwa found, skpšge¡…»diùiÚ " << 
¡d
::
’dl
;

685 
	`d‘eù_m©rix_size
(
‹¡
, 
f
, 
Me
, 
Ne
, 
nz
);

686 ià(
f
 =ğ
NULL
){

687 
	`log¡»am
(
LOG_WARNING
)<<"FaedØİ’e¡ f" << 
‹¡
<< " skpšge¡…»diùiÚ " << 
¡d
::
’dl
;

691 ià((
M
 > 0 && 
N
 > 0 ) && (
Me
 !ğM || 
Ne
 != N))

692 
	`log¡»am
(
LOG_FATAL
)<<"IÅuˆsizoà‹¡ m©rix mu¡ bid’tiÿÈtØŒaššg m©rix,‚am–y " << 
M
 << "x" << 
N
 << 
¡d
::
’dl
;

694 
FILE
 * 
fout
 = 
	`İ’_fe
((
‹¡
 + ".´ediù").
	`c_¡r
(),"w", 
çl£
);

696 
MM_ty³code
 
m©code
;

697 
	`mm_£t_¬¿y
(&
m©code
);

698 
	`mm_wr™e_bªÃr
(
fout
, 
m©code
);

699 
	`mm_wr™e_mtx_¬¿y_size
(
fout
 ,
nz
, 1);

701 
¡d
::
veùÜ
<
ušt
> 
v®¬¿y
; v®¬¿y.
	`»size
(
FEATURE_WIDTH
);

702 
¡d
::
veùÜ
<
ušt
> 
pos™iÚs
;…os™iÚs.
	`»size
(
FEATURE_WIDTH
);

703 
v®
;

704 
´ediùiÚ
;

705 
ušt
 
I
,
J
;

706 
sk³d_ã©u»s
 = 0;

707 
sk³d_nodes
 = 0;

709 
ušt
 
i
=0; i<
nz
; i++)

711 
šdex
;

712 ià(!
	`»ad_lše
(
f
, 
‹¡
, 
i
, 
I
, 
J
, 
v®
, 
v®¬¿y
, 
pos™iÚs
, 
šdex
, 
TEST
, 
sk³d_ã©u»s
))

713 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad†še: " <<
i
 << " iÀfe: " << 
‹¡
 << 
¡d
::
’dl
;

715 ià(
I
 =ğ(
ušt
)-1 || 
J
 == (uint)-1){

716 
sk³d_nodes
++;

717 
	`årštf
(
fout
, "%d\n", 0);

721 
howmªy
 = 
	`ÿlc_ã©u»_node_¬¿y_size
(
I
,
J
,
šdex
);

722 
¡d
::
veùÜ
<
v”‹x_d©a
*> 
node_¬¿y
;‚ode_¬¿y.
	`»size
(
howmªy
);

723 
k
=0; k< 
howmªy
; k++)

724 
node_¬¿y
[
k
] = 
NULL
;

726 
fvec
 
sum
;

727 
	`compu‹_´ediùiÚ
(
I
, 
J
, 
v®
, 
´ediùiÚ
, &
v®¬¿y
[0], &
pos™iÚs
[0], 
šdex
, 
´ediùiÚ_func
, &
sum
, 
node_¬¿y
, 
howmªy
);

728 
	`årštf
(
fout
, "%12.8lg\n", 
´ediùiÚ
);

730 
	`fşo£
(
f
);

731 
	`fşo£
(
fout
);

733 
	`log¡»am
(
LOG_INFO
)<<"Fšished wr™šg " << 
nz
 << "…»diùiÚ tØfe: " << 
‹¡
 << ".´ediù" << 
¡d
::
’dl
;

734 ià(
sk³d_ã©u»s
 > 0)

735 
	`log¡»am
(
LOG_DEBUG
)<<"Sk³d " << 
sk³d_ã©u»s
 << " wh’„—dšg from fe. " << 
¡d
::
’dl
;

736 ià(
sk³d_nodes
 > 0)

737 
	`log¡»am
(
LOG_WARNING
)<<"Sk³d‚odše¡ d©a£t: " << 
sk³d_nodes
 << 
¡d
::
’dl
;

738 
	}
}

744 
g’sgd_´ediù
(
¡d
::
veùÜ
<
v”‹x_d©a
*> & 
node_¬¿y
, 
node_¬¿y_size
,

745 cÚ¡ 
¿tšg
, & 
´ediùiÚ
, 
fvec
* 
sum
){

747 
fvec
 
	gsum_sqr
 = 
fz”os
(
D
);

748 *
	gsum
 = 
fz”os
(
D
);

749 
	g´ediùiÚ
 = 
glob®M—n
;

750 
as£¹
(!
¡d
::
i¢ª
(
´ediùiÚ
));

751 
	gi
=0; i< 
	gnode_¬¿y_size
; i++)

752 
	g´ediùiÚ
 +ğ
node_¬¿y
[
i
]->
bŸs
;

753 
as£¹
(!
¡d
::
i¢ª
(
´ediùiÚ
));

755 
	gj
=0; j< 
	gD
; j++){

756 
	gi
=0; i< 
	gnode_¬¿y_size
; i++){

757 
	gsum
->
	gİ”©Ü
[](
	gj
è+ğ
node_¬¿y
[
i
]->
pvec
[
j
];

758 
as£¹
(
sum
->
İ”©Ü
[](
j
) < 1e5);

759 
	gsum_sqr
[
j
] +ğ
pow
(
node_¬¿y
[
i
]->
pvec
[j],2);

761 
	g´ediùiÚ
 +ğ0.5 * (
pow
(
sum
->
İ”©Ü
[](
j
),2è- 
	gsum_sqr
[j]);

762 
as£¹
(!
¡d
::
i¢ª
(
´ediùiÚ
));

765 
	g´ediùiÚ
 = 
¡d
::
mš
(()
´ediùiÚ
, 
maxv®
);

766 
	g´ediùiÚ
 = 
¡d
::
max
(()
´ediùiÚ
, 
mšv®
);

768 
	g”r
 = 
¿tšg
 - 
´ediùiÚ
;

769 
as£¹
(!
¡d
::
i¢ª
(
”r
));

770  
”r
*
	g”r
;

773 
g’sgd_´ediù
(
¡d
::
veùÜ
<
v”‹x_d©a
*>& 
node_¬¿y
, 
node_¬¿y_size
,

774 cÚ¡ 
¿tšg
, & 
´ediùiÚ
){

775 
fvec
 
	gsum
;

776  
g’sgd_´ediù
(
node_¬¿y
, 
node_¬¿y_size
, 
¿tšg
, 
´ediùiÚ
, &
sum
);

780 
	$š™_g’sgd
(
boŞ
 
lßd_çùÜs_äom_fe
){

782 
	`¤ªd
(
	`time
(
NULL
));

783 
nodes
 = 
M
+
N
+
	`num_ã©u»_bšs
();

784 
Ï‹Á_çùÜs_šmem
.
	`»size
(
nodes
);

785 
howmªy
 = 
	`ÿlc_ã©u»_num
();

786 
	`log¡»am
(
LOG_DEBUG
)<<"GošgØÿlcuÏ‹: " << 
howmªy
 << " off£ts." << 
¡d
::
’dl
;

787 
fc
.
off£ts
.
	`»size
(
howmªy
);

788 
	`g‘_off£ts
(
fc
.
off£ts
);

789 
	`as£¹
(
D
 > 0);

790 ià(!
lßd_çùÜs_äom_fe
){

791 
çùÜ
 = 0.1/
	`sq¹
(
D
);

792 #´agm¨
omp
 
·¿Î–
 

793 
i
=0; i< 
nodes
; i++){

794 
Ï‹Á_çùÜs_šmem
[
i
].
pvec
 = (
debug
 ? 0.1*
	`fÚes
(
D
è: (::
	`äªdu
(D)*
çùÜ
));

798 
	}
}

801 
	$Œaššg_rm£_N
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
, 
boŞ
 
™ems
 = 
çl£
){

802 
Ï¡_Œaššg_rm£
 = 
dŒaššg_rm£
;

803 
dŒaššg_rm£
 = 0;

804 
size_t
 
tÙ®_”rÜs
 = 0;

805 
¡¬t
 = 0;

806 
’d
 = 
M
;

807 ià(
™ems
){

808 
¡¬t
 = 
M
;

809 
’d
 = 
M
+
N
;

811 
dŒaššg_rm£
 = 
	`sum
(
rm£_vec
);

812 ià(
ÿlc_”rÜ
){

813 
tÙ®_”rÜs
 = 
	`sum
(
”rÜs_vec
);

815 
dŒaššg_rm£
 = 
	`sq¹
(dŒaššg_rm£ / 
³ngše
->
	`num_edges
());

816 ià(
ÿlc_”rÜ
)

817 
¡d
::
cout
<< std::
	`£tw
(10è<< 
mytim”
.
	`cu¼’t_time
(è<< "èI‹¿tiÚ: " << std::£tw(3è<<
™”©iÚ
<<" T¿ššg RMSE: " << std::£tw(10)<< 
dŒaššg_rm£
 << " T¿šƒ¼: " << std::£tw(10è<< (
tÙ®_”rÜs
/()
L
);

819 
¡d
::
cout
<< std::
	`£tw
(10è<< 
mytim”
.
	`cu¼’t_time
(è<< "èI‹¿tiÚ: " << std::£tw(3è<<
™”©iÚ
<<" T¿ššg RMSE: " << std::£tw(10)<< 
dŒaššg_rm£
;

820 
	}
}

826 
	gS·r£_G’sgdV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

831 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

836 ià(
is_u£r
(
v”‹x
.
id
())){

838 
	ge
=0;ƒ < 
	gv”‹x
.
num_ou‹dges
();ƒ++) {

839 cÚ¡ 
	gedge_d©a
 & 
	gd©a
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

840 
	ghowmªy
 = 
ÿlc_ã©u»_node_¬¿y_size
(
v”‹x
.
id
(), v”‹x.
edge
(
e
)->
v”‹x_id
()-
M
, 
d©a
.
size
);

841 
	g¡d
::
veùÜ
<
v”‹x_d©a
*> 
node_¬¿y
; 
	gnode_¬¿y
.
»size
(
howmªy
);

842 
	gi
=0; i< 
	ghowmªy
; i++)

843 
	gnode_¬¿y
[
i
] = 
NULL
;

845 
	grui
 = 
d©a
.
weight
;

846 
	gpui
;

847 
fvec
 
	gsum
;

850 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
compu‹_´ediùiÚ
(
v”‹x
.
id
(), v”‹x.
edge
(
e
)->
v”‹x_id
()-
M
, 
rui
 ,
pui
, (
ušt
*)
d©a
.
ã©u»s
, (ušt*)d©a.
šdex
, d©a.
size
, 
g’sgd_´ediù
, &
sum
, 
node_¬¿y
, 
howmªy
);

851 ià(
	gÿlc_”rÜ
){

852 ià((
	gpui
 < 
	gcutoff
 && 
	grui
 > cutoff) || (pui > cutoff &&„ui < cutoff))

853 
	g”rÜs_vec
[
omp_g‘_th»ad_num
()]++;

855 
	geui
 = 
pui
 - 
rui
;

858 
	gglob®M—n
 -ğ
g’sgd_¿‹1
 * (
eui
 + 
g’sgd_»g0
 * 
glob®M—n
);

861 
	gi
=0; i < 
	ghowmªy
; i++){

863 
	gg’sgd_¿‹
;

864 ià(
	gi
 == 0)

865 
g’sgd_¿‹
 = 
g’sgd_¿‹1
;

866 ià(
	gi
 == 1)

867 
g’sgd_¿‹
 = 
g’sgd_¿‹2
;

868 ià(
	gi
 < ()(
	gd©a
.
	gsize
+2))

869 
	gg’sgd_¿‹
 = 
g’sgd_¿‹3
;

870 ià(
	gi
 < ()(2+
	gd©a
.
	gsize
+
	gfc
.
	gnode_ã©u»s
))

871 
	gg’sgd_¿‹
 = 
g’sgd_¿‹4
;

873 
	gg’sgd_¿‹
 = 
g’sgd_¿‹5
;

875 
	gnode_¬¿y
[
i
]->
	gbŸs
 -ğ
g’sgd_¿‹
 * (
eui
 + 
g’sgd_»gw
* 
node_¬¿y
[i]->
bŸs
);

876 
as£¹
(!
¡d
::
i¢ª
(
node_¬¿y
[
i
]->
bŸs
));

877 
as£¹
(
node_¬¿y
[
i
]->
bŸs
 < 1e3);

879 
fvec
 
	gg¿d
 = 
sum
 - 
node_¬¿y
[
i
]->
pvec
;

880 
	gnode_¬¿y
[
i
]->
	gpvec
 -ğ
g’sgd_¿‹
 * (
eui
*
g¿d
 + 
g’sgd_»gv
 * 
node_¬¿y
[i]->
pvec
);

881 
as£¹
(!
¡d
::
i¢ª
(
node_¬¿y
[
i
]->
pvec
[0]));

882 
as£¹
(
node_¬¿y
[
i
]->
pvec
[0] < 1e3);

895 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

896 ià(
	g™”©iÚ
 =ğ1 && 
v”‹x_w™h_no_edges
 > 0)

897 
log¡»am
(
LOG_WARNING
)<<"Th”¬" << 
v”‹x_w™h_no_edges
 << " u£r w™houˆ¿tšgs" << 
¡d
::
’dl
;

898 
	gg’sgd_¿‹1
 *ğ
g’sgd_muÉ_dec
;

899 
	gg’sgd_¿‹2
 *ğ
g’sgd_muÉ_dec
;

900 
	gg’sgd_¿‹3
 *ğ
g’sgd_muÉ_dec
;

901 
	gg’sgd_¿‹4
 *ğ
g’sgd_muÉ_dec
;

902 
	gg’sgd_¿‹5
 *ğ
g’sgd_muÉ_dec
;

903 
Œaššg_rm£_N
(
™”©iÚ
, 
gcÚ‹xt
);

904 
v®id©iÚ_rm£_N
(&
g’sgd_´ediù
, 
gcÚ‹xt
, 
fc
);

910 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

911 
	grm£_vec
 = 
z”os
(
numb”_of_omp_th»ads
());

912 ià(
	gÿlc_”rÜ
)

913 
	g”rÜs_vec
 = 
z”os
(
numb”_of_omp_th»ads
());

920 
ouut_g’sgd_»suÉ
(
¡d
::
¡ršg
 
f’ame
) {

921 
MMOuu‰”_m©
<
v”‹x_d©a
> 
mmouut
(
f’ame
 + "_U.mm", 0, 
M
+
N
+
num_ã©u»_bšs
(), "Thi fcÚš S·r£_G’sgd ouuˆm©riûs. IÀ—ch„ow D faùÜ oà¨sšgË u£¸node,h’ i‹m‚odes,h’ f—tu»s", 
Ï‹Á_çùÜs_šmem
);

922 
	gMMOuu‰”_vec
<
	gv”‹x_d©a
> 
mmouut_bŸs
(
f’ame
 + "_U_bŸs.mm", 0, 
num_ã©u»_bšs
(), 
BIAS_POS
, "Thi fcÚš S·r£_G’sgd ouuˆbŸ veùÜ. IÀ—ch„ow‡ sšgË u£¸bŸs.", 
Ï‹Á_çùÜs_šmem
);

923 
MMOuu‰”_sÿÏr
 
gm—n
(
f’ame
 + "_glob®_m—n.mm", "Thi fcÚš S·r£_G’sgd glob® m—Àwhich i »quœed fÜ computšg…»diùiÚs.", 
glob®M—n
);

925 
log¡»am
(
LOG_INFO
è<< " GENSGD ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << "_U.mm" << ", "<< f’am<< "_glob®_m—n.mm, " << f’am<< "_U_bŸs.mm " <<
	g¡d
::
’dl
;

928 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

931 
	`´št_cİyright
();

935 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

939 
m‘rics
 
	`m
("als-tensor-inmemory-factors");

942 
g’sgd_¿‹1
 = 
	`g‘_İtiÚ_æßt
("gensgd_rate1", gensgd_rate1);

943 
g’sgd_¿‹2
 = 
	`g‘_İtiÚ_æßt
("gensgd_rate2", gensgd_rate2);

944 
g’sgd_¿‹3
 = 
	`g‘_İtiÚ_æßt
("gensgd_rate3", gensgd_rate3);

945 
g’sgd_¿‹4
 = 
	`g‘_İtiÚ_æßt
("gensgd_rate4", gensgd_rate4);

946 
g’sgd_¿‹5
 = 
	`g‘_İtiÚ_æßt
("gensgd_rate5", gensgd_rate5);

947 
g’sgd_»gw
 = 
	`g‘_İtiÚ_æßt
("gensgd_regw", gensgd_regw);

948 
g’sgd_»gv
 = 
	`g‘_İtiÚ_æßt
("gensgd_regv", gensgd_regv);

949 
g’sgd_»g0
 = 
	`g‘_İtiÚ_æßt
("gensgd_reg0", gensgd_reg0);

950 
g’sgd_muÉ_dec
 = 
	`g‘_İtiÚ_æßt
("gensgd_mult_dec", gensgd_mult_dec);

951 
fc
.
hash_¡ršgs
 = 
	`g‘_İtiÚ_št
("rehash", fc.hash_strings);

952 
u£r_fe
 = 
	`g‘_İtiÚ_¡ršg
("user_file", user_file);

953 
u£r_lšks
 = 
	`g‘_İtiÚ_¡ršg
("user_links", user_links);

954 
™em_fe
 = 
	`g‘_İtiÚ_¡ršg
("item_file", item_file);

955 
D
 = 
	`g‘_İtiÚ_št
("D", D);

956 
fc
.
äom_pos
 = 
	`g‘_İtiÚ_št
("from_pos", fc.from_pos);

957 
fc
.
to_pos
 = 
	`g‘_İtiÚ_št
("to_pos", fc.to_pos);

958 
fc
.
v®_pos
 = 
	`g‘_İtiÚ_št
("val_pos", fc.val_pos);

959 
lim™_¿tšg
 = 
	`g‘_İtiÚ_št
("limit_rating",†imit_rating);

960 
ÿlc_”rÜ
 = 
	`g‘_İtiÚ_št
("calc_error", calc_error);

961 
ÿlc_roc
 = 
	`g‘_İtiÚ_št
("calc_roc", calc_roc);

962 
round_æßt
 = 
	`g‘_İtiÚ_št
("round_float",„ound_float);

963 
has_h—d”_t™Ës
 = 
	`g‘_İtiÚ_št
("has_header_titles", has_header_titles);

964 
fc
.
»hash_v®ue
 = 
	`g‘_İtiÚ_št
("rehash_value", fc.rehash_value);

965 
cutoff
 = 
	`g‘_İtiÚ_æßt
("cutoff", cutoff);

966 
bš¬y
 = 
	`g‘_İtiÚ_št
("binary", binary);

968 
	`·r£_commªd_lše_¬gs
();

969 
	`·r£_im¶ic™_commªd_lše
();

971 
fc
.
node_id_m­s
.
	`»size
(2);

975 ià(
fÜm©
 == "libsvm"){

976 
fc
.
v®_pos
 = 0;

977 
fc
.
to_pos
 = 2;

978 
fc
.
äom_pos
 = 1;

979 
bš¬y
 = 
çl£
;

980 
fc
.
hash_¡ršgs
 = 
Œue
;

983 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘_N
<
edge_d©a
>(
Œaššg
, 
çl£
, 
fc
, 
lim™_¿tšg
);

984 
fc
.
tÙ®_ã©u»s
 = fc.
šdex_m­
.
¡ršg2nodeid
.
	`size
();

986 ià(
lßd_çùÜs_äom_fe
){

987 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_U.mm", 0, 
D
);

988 
vec
 
u£r_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 +"_U_bŸs.mm", 
çl£
, 
Œue
);

989 
	`as£¹
(
u£r_bŸs
.
	`size
(è=ğ
	`num_ã©u»_bšs
());

990 
ušt
 
i
=0; 
	`num_ã©u»_bšs
(); i++){

991 
Ï‹Á_çùÜs_šmem
[
i
].
bŸs
 = 
u£r_bŸs
[i];

993 
vec
 
gm
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 + "_glob®_m—n.mm", 
çl£
, 
Œue
);

994 
glob®M—n
 = 
gm
[0];

997 
	`š™_g’sgd
(
lßd_çùÜs_äom_fe
);

999 ià(
has_h—d”_t™Ës
 && 
h—d”_t™Ës
.
	`size
() == 0)

1000 
	`log¡»am
(
LOG_FATAL
)<<"PËa£ d–‘‹m°fe (usšg : \"rm -à" << 
Œaššg
 << ".*\"èªd„uÀagaš" << 
¡d
::
’dl
;

1002 
	`log¡»am
(
LOG_INFO
)<<"T¬g‘ v¬ŸbË " << 
¡d
::
	`£tw
(3è<< 
fc
.
v®_pos
 << " : " << (
has_h—d”_t™Ës
? 
h—d”_t™Ës
[fc.v®_pos] : ""è<<¡d::
’dl
;

1003 
	`log¡»am
(
LOG_INFO
)<<"From " << 
¡d
::
	`£tw
(3è<< 
fc
.
äom_pos
<< " : " << (
has_h—d”_t™Ës
? 
h—d”_t™Ës
[fc.äom_pos] : ""è<<¡d::
’dl
;

1004 
	`log¡»am
(
LOG_INFO
)<<"TØ " << 
¡d
::
	`£tw
(3è<< 
fc
.
to_pos
 << " : " << (
has_h—d”_t™Ës
? 
h—d”_t™Ës
[fc.to_pos] : ""è<<¡d::
’dl
;

1009 
S·r£_G’sgdV”tiûsInMemProg¿m
 
´og¿m
;

1010 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

1011 
	`£t_’gše_æags
(
’gše
);

1012 
³ngše
 = &
’gše
;

1013 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

1016 
	`ouut_g’sgd_»suÉ
(
Œaššg
);

1017 
	`‹¡_´ediùiÚs_N
(&
g’sgd_´ediù
, 
fc
);

1020 
	`m‘rics_»pÜt
(
m
);

1022 
	}
}

	@toolkits/collaborative_filtering/sparse_gensgd2.cpp

37 
	~<veùÜ
>

38 
	~"commÚ.hµ
"

39 
	~"eig’_w¿µ”.hµ
"

40 
	~"../·r£rs/commÚ.hµ
"

41 
	~<omp.h
>

42 
	#MAX_FEATAURES
 256

	)

43 
	#FEATURE_WIDTH
 56

44 

	)

45 
	gg’sgd_¿‹1
 = 1e-02;

46 
	gg’sgd_¿‹2
 = 1e-02;

47 
	gg’sgd_¿‹3
 = 1e-02;

48 
	gg’sgd_¿‹4
 = 1e-02;

49 
	gg’sgd_¿‹5
 = 1e-02;

50 
	gg’sgd_muÉ_dec
 = 0.9;

51 
	gg’sgd_»gw
 = 1e-3;

52 
	gg’sgd_»gv
 = 1e-3;

53 
	gg’sgd_»g0
 = 1e-1;

54 
boŞ
 
	gdebug
 = 
çl£
;

55 
	g¡d
::
¡ršg
 
u£r_fe
;

56 
	g¡d
::
¡ršg
 
™em_fe
;

57 
	g¡d
::
¡ršg
 
u£r_lšks
;

58 
	glim™_¿tšg
 = 0;

59 
size_t
 
	gv”‹x_w™h_no_edges
 = 0;

60 
	gÿlc_”rÜ
 = 0;

61 
	gÿlc_roc
 = 0;

62 
	gbš¬y
 = 1;

63 
	ground_æßt
 = 0;

64 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
h—d”_t™Ës
;

65 
	ghas_h—d”_t™Ës
 = 0;

66 
	gcutoff
 = 0;

67 
	gv®_cutoff
 = 0;

68 
	g¡d
::
¡ršg
 
fÜm©
 = "libsvm";

69 
vec
 
	g”rÜs_vec
;

71 
	ssšgË_m­
{

72 
	m¡d
::
m­
<,
	mušt
> 
	m¡ršg2nodeid
;

73 
sšgË_m­
(){

77 
	sã©u»_cÚŒŞ
{

78 
	m¡d
::
veùÜ
<
sšgË_m­
> 
node_id_m­s
;

79 
sšgË_m­
 
	mv®_m­
;

80 
sšgË_m­
 
	mšdex_m­
;

81 
	m»hash_v®ue
;

82 
	mã©u»_num
;

83 
	mnode_ã©u»s
;

84 
	mnode_lšks
;

85 
	mtÙ®_ã©u»s
;

86 cÚ¡ 
	m¡d
::
¡ršg
 
deçuÉ_ã©u»_¡r
;

87 
	m¡d
::
veùÜ
<> 
off£ts
;

88 
boŞ
 
	mhash_¡ršgs
;

89 
	mäom_pos
;

90 
	mto_pos
;

91 
	mv®_pos
;

93 
ã©u»_cÚŒŞ
(){

94 
	m»hash_v®ue
 = 0;

95 
	mtÙ®_ã©u»s
 = 0;

96 
	mnode_ã©u»s
 = 0;

97 
	mã©u»_num
 = 
FEATURE_WIDTH
;

98 
	mhash_¡ršgs
 = 
çl£
;

99 
	mäom_pos
 = 0;

100 
	mto_pos
 = 1;

101 
	mv®_pos
 = -1;

102 
	mnode_lšks
 = 0;

106 
ã©u»_cÚŒŞ
 
	gfc
;

108 
	$num_ã©u»_bšs
(){

109 
sum
 = 0;

110 ià(
fc
.
hash_¡ršgs
){

111 
	`as£¹
(2+
fc
.
tÙ®_ã©u»s
+fc.
node_ã©u»s
 =ğ()fc.
node_id_m­s
.
	`size
());

112 
i
=2; i < 2+
fc
.
tÙ®_ã©u»s
+fc.
node_ã©u»s
; i++){

113 
sum
+ğ
fc
.
node_id_m­s
[
i
].
¡ršg2nodeid
.
	`size
();

116 
	`as£¹
(
çl£
);

118  
sum
;

119 
	}
}

121 
	$ÿlc_ã©u»_num
(){

122  2+
fc
.
tÙ®_ã©u»s
+fc.
node_ã©u»s
;

123 
	}
}

124 
g‘_off£ts
(
¡d
::
veùÜ
<> & 
off£ts
){

125 
as£¹
(
off£ts
.
size
() > 3);

126 
	goff£ts
[0] = 0;

127 
	goff£ts
[1] = 
M
;

128 
	goff£ts
[2] = 
M
+
N
;

129 
ušt
 
	gi
=3; i< 
	goff£ts
.
size
(); i++){

130 
as£¹
(
fc
.
node_id_m­s
.
size
(è> (
ušt
)
i
);

131 
	goff£ts
[
i
] +ğ
off£ts
[i-1] + 
fc
.
node_id_m­s
[i].
¡ršg2nodeid
.
size
();

135 
boŞ
 
	$is_u£r
(
vid_t
 
id
){  id < 
M
; 
	}
}

136 
boŞ
 
	$is_™em
(
vid_t
 
id
){  id >ğ
M
 && id < 
N
; 
	}
}

137 
boŞ
 
	$is_time
(
vid_t
 
id
){  id >ğ
M
+
N
; 
	}
}

138 
	#BIAS_POS
 -1

	)

140 
	sv”‹x_d©a
 {

141 
fvec
 
	mpvec
;

142 
	mbŸs
;

144 
v”‹x_d©a
() {

145 
	mbŸs
 = 0;

148 
£t_v®
(
šdex
, 
v®
){

149 ià(
	mšdex
 =ğ
BIAS_POS
)

150 
bŸs
 = 
v®
;

151 
	mpvec
[
šdex
] = 
v®
;

153 
g‘_v®
(
šdex
){

154 ià(
	mšdex
=ğ
BIAS_POS
)

155  
bŸs
;

156  
	mpvec
[
šdex
];

162 
	sedge_d©a
 {

163 
ušt
 
	mã©u»s
[
FEATURE_WIDTH
];

164 
ušt
 
	mšdex
[
FEATURE_WIDTH
];

165 
ušt
 
	msize
;

166 
	mweight
;

167 
edge_d©a
() {

168 
	mweight
 = 0;

169 
	msize
 = 0;

170 
mem£t
(
ã©u»s
, 0, (
ušt
)*
FEATURE_WIDTH
);

171 
mem£t
(
šdex
, 0, (
ušt
)*
FEATURE_WIDTH
);

174 
edge_d©a
(
weight
, 
ušt
 * 
v®¬¿y
, ušˆ* 
_šdex
, ušˆ
size
): size(size), weight(weight) {

175 
memıy
(
ã©u»s
, 
v®¬¿y
, (
ušt
)*
FEATURE_WIDTH
);

176 
memıy
(
šdex
, 
_šdex
, (
ušt
)*
FEATURE_WIDTH
);

186 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

187 
edge_d©a
 
	tEdgeD©aTy³
;

189 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

190 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

193 
	$ÿlc_ã©u»_node_¬¿y_size
(
ušt
 
node
, ušˆ
™em
, ušˆ
edge_size
){

194 
	`as£¹
(
node
 <ğ
M
);

195 
	`as£¹
(
™em
 <ğ
N
);

196 
	`as£¹
(
edge_size
 >= 0);

197 
	`as£¹
(
node
 < 
Ï‹Á_çùÜs_šmem
.
	`size
());

198 
	`as£¹
(
fc
.
off£ts
[1]+
™em
 < 
Ï‹Á_çùÜs_šmem
.
	`size
());

199  2+
edge_size
;

200 
	}
}

202 
	$assign_id
(
sšgË_m­
& 
dm­
, & 
outv®
, cÚ¡ 
Çme
){

204 
¡d
::
m­
<,
ušt
>::
™”©Ü
 
™
 = 
dm­
.
¡ršg2nodeid
.
	`fšd
(
Çme
);

206 ià(
™
 !ğ
dm­
.
¡ršg2nodeid
.
	`’d
()){

207 
outv®
 = 
™
->
£cÚd
 - 1;

208 
	`as£¹
(
outv®
 < 
dm­
.
¡ršg2nodeid
.
	`size
());

211 
mymu‹x
.
	`lock
();

213 
outv®
 = 
dm­
.
¡ršg2nodeid
[
Çme
];

214 ià(
outv®
 == 0){

215 
dm­
.
¡ršg2nodeid
[
Çme
] = dm­.¡ršg2nodeid.
	`size
();

216 
outv®
 = 
dm­
.
¡ršg2nodeid
.
	`size
() - 1;

218 
mymu‹x
.
	`uÆock
();

219 
	}
}

225 
	$g‘_node_id
(* 
pch
, 
pos
, 
size_t
 
i
, 
boŞ
 
»ad_Úly
 = 
çl£
){

226 
	`as£¹
(
pch
 !ğ
NULL
);

227 
	`as£¹
(
pch
[0] != 0);

228 
	`as£¹
(
i
 >= 0);

230 
»t
;

232 ià(!
fc
.
hash_¡ršgs
){

233 
»t
 = (
pos
 < 2 ? 
	`©oi
(
pch
è: 
	`©of
(pch));

234 ià(
pos
 < 2)

235 
»t
--;

236 ià(
pos
 =ğ0 && 
»t
 >ğ
M
)

237 
	`log¡»am
(
LOG_FATAL
)<<"Row index†¬g”hªhm©rix„ow siz" << 
»t
 << " > " << 
M
 << " iÀlše: " << 
i
 << 
¡d
::
’dl
;

238 ià(
pos
 =ğ1 && 
»t
 >ğ
N
)

239 
	`log¡»am
(
LOG_FATAL
)<<"CŞ index†¬g”hªhm©rix„ow siz" << 
»t
 << " > " << 
N
 << " iÀlše: " << 
i
 << 
¡d
::
’dl
;

244 
ušt
 
id
;

245 
v®
 = 
	`©of
(
pch
);

246 
	`as£¹
(!
¡d
::
	`i¢ª
(
v®
));

247 ià(
round_æßt
)

248 
v®
 = 
	`æoÜf
(val * 10000 + 0.5) / 10000;

249 ià(
pos
 >= 0)

250 
	`as£¹
(
pos
 < ()
fc
.
node_id_m­s
.
	`size
());

251 
sšgË_m­
 * 
pm­
 = 
NULL
;

252 ià(
pos
 == -1)

253 
pm­
 = &
fc
.
šdex_m­
;

254 
pm­
 = &
fc
.
node_id_m­s
[
pos
];

256 ià(
»ad_Úly
){

257 
¡d
::
m­
<,
ušt
>::
™”©Ü
 
™
 = 
pm­
->
¡ršg2nodeid
.
	`fšd
(
v®
);

258 ià(
™
 !ğ
pm­
->
¡ršg2nodeid
.
	`’d
()){

259 
»t
 = 
™
->
£cÚd
 - 1;

260 
	`as£¹
(
»t
 < 
pm­
->
¡ršg2nodeid
.
	`size
());

262 
»t
 = -1;

265 
	`assign_id
(*
pm­
, 
id
, 
v®
);

266 ià(
pos
 =ğ-1 && 
fc
.
šdex_m­
.
¡ršg2nodeid
.
	`size
(è=ğ
id
+1 && fc.
node_id_m­s
.size() < fc.index_map.string2nodeid.size()+2){

267 
sšgË_m­
 
Ãwm­
;

268 
fc
.
node_id_m­s
.
	`push_back
(
Ãwm­
);

270 
»t
 = 
id
;

274 ià(!
»ad_Úly
)

275 
	`as£¹
(
»t
 != -1);

276  
»t
;

277 
	}
}

280 
	~"io.hµ
"

281 
	~"../·r£rs/commÚ.hµ
"

285 
	$g‘_v®ue
(* 
pch
, 
boŞ
 
»ad_Úly
){

286 
»t
;

287 ià(!
fc
.
»hash_v®ue
){

288 
»t
 = 
	`©of
(
pch
);

291 
ušt
 
id
;

292 ià(
»ad_Úly
){

293 
¡d
::
m­
<,
ušt
>::
™”©Ü
 
™
 = 
fc
.
v®_m­
.
¡ršg2nodeid
.
	`fšd
(
	`©of
(
pch
));

294 ià(
™
 !ğ
fc
.
v®_m­
.
¡ršg2nodeid
.
	`’d
()){

295 
»t
 = 
™
->
£cÚd
 - 1;

297 
»t
 = -1;

300 
	`assign_id
(
fc
.
v®_m­
, 
id
, 
	`©of
(
pch
));

301 
»t
 = 
id
;

305 ià(
¡d
::
	`i¢ª
(
»t
è|| std::
	`isšf
(ret))

306 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad v®ue" << 
¡d
::
’dl
;

307  
»t
;

308 
	}
}

311 
boŞ
 
»ad_lše
(
FILE
 * 
f
, cÚ¡ 
¡d
::
¡ršg
 
f’ame
, 
size_t
 
i
, 
ušt
 & 
I
, ušˆ& 
J
, &
v®
, std::
veùÜ
<ušt>& 
v®¬¿y
, std::veùÜ<ušt>& 
pos™iÚs
, & 
šdex
, 
ty³
, & 
sk³d_ã©u»s
){

313 * 
	glšebuf
 = 
NULL
;

314 
size_t
 
	glšesize
;

315 
	glšebuf_debug
[1024];

317 
	gtok’
 = 0;

318 
	gšdex
 = 0;

320 
	grc
 = 
g‘lše
(&
lšebuf
, &
lšesize
, 
f
);

321 ià(
	grc
 == -1)

322 
log¡»am
(
LOG_FATAL
)<<"FaedØg‘†še: " << 
i
 << " iÀfe: " << 
f’ame
 << 
¡d
::
’dl
;

323 * 
	glšebuf_to_ä“
 = 
lšebuf
;

324 
¡ºıy
(
lšebuf_debug
, 
lšebuf
, 1024);

326 
	gšdex
 < 
	gFEATURE_WIDTH
){

329 ià(
	gtok’
 =ğ
fc
.
äom_pos
){

330 *
pch
 = 
¡r£p
(&
lšebuf
,"\t,\r\n: ");

331 ià(
	gpch
 =ğ
NULL
)

332 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
i
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

333 
	gI
 = (
ušt
)
g‘_node_id
(
pch
, 0, 
i
, 
ty³
 !ğ
TRAINING
);

334 
ušt
 
	gpos
 = 
g‘_node_id
(
pch
, -1, 
i
, 
ty³
 !ğ
TRAINING
);

335 
	gtok’
++;

336 ià(
	gty³
 !ğ
TRAINING
 && 
pos
 =ğ(
ušt
)-1){

339 
	gv®¬¿y
[
šdex
] = 0;

340 
	gpos™iÚs
[
šdex
] = 
pos
;

341 
	gšdex
++;

343 ià(
	gtok’
 =ğ
fc
.
to_pos
){

345 * 
pch
 = 
¡r£p
(&
lšebuf
, "\t,\r\n: ");

346 ià(
	gpch
 =ğ
NULL
)

347 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
i
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

348 
	gJ
 = (
ušt
)
g‘_node_id
(
pch
, 1, 
i
, 
ty³
 !ğ
TRAINING
);

349 
	gtok’
++;

351 ià(
	gtok’
 =ğ
fc
.
v®_pos
){

353 * 
pch
 = 
¡r£p
(&
lšebuf
, "\t,\r\n ");

354 ià(
	gpch
 =ğ
NULL
)

355 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
i
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

357 
	gv®
 = 
g‘_v®ue
(
pch
, 
ty³
 !ğ
TRAINING
);

358 
	gtok’
++;

362 * 
	gpch
 = 
¡r£p
(&
lšebuf
, "\t,\r\n:; ");

363 ià(
	gpch
 =ğ
NULL
 || 
pch
[0] == 0)

366 
ušt
 
	gpos
 = 
g‘_node_id
(
pch
, -1, 
i
, 
ty³
 !ğ
TRAINING
);

367 ià(
	gty³
 !ğ
TRAINING
 && 
pos
 =ğ(
ušt
)-1){

368 * 
pch2
 = 
¡r£p
(&
lšebuf
, "\t\r\n ");

369 ià(
	gpch2
 =ğ
NULL
 || 
pch2
[0] == 0)

370 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
i
 << " f—tu»2 " << 
šdex
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

371 
	gsk³d_ã©u»s
++;

375 
as£¹
(
pos
 !ğ(
ušt
)-1 &&…o < 
fc
.
šdex_m­
.
¡ršg2nodeid
.
size
());

377 * 
	gpch2
 = 
¡r£p
(&
lšebuf
, "\t\r\n ");

378 ià(
	gpch2
 =ğ
NULL
 || 
pch2
[0] == 0)

379 
log¡»am
(
LOG_FATAL
)<<"E¼Ü„—dšg†š" << 
i
 << " f—tu»2 " << 
šdex
 << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

381 
ušt
 
	g£cÚd_šdex
 = 
g‘_node_id
(
pch2
, 
pos
, 
i
, 
ty³
 !ğ
TRAINING
);

382 ià(
	gty³
 !ğ
TRAINING
 && 
£cÚd_šdex
 =ğ(
ušt
)-1){

383 
£cÚd_šdex
 = 0;

386 
as£¹
(
£cÚd_šdex
 !ğ(
ušt
)-1);

387 
as£¹
(
šdex
< ()
v®¬¿y
.
size
());

388 
as£¹
(
šdex
< ()
pos™iÚs
.
size
());

389 
	gv®¬¿y
[
šdex
] = 
£cÚd_šdex
;

390 
	gpos™iÚs
[
šdex
] = 
pos
;

391 
	gšdex
++;

392 
	gtok’
++;

395 
ä“
(
lšebuf_to_ä“
);

396  
	gŒue
;

400 
compu‹_´ediùiÚ
(

401 
ušt
 
I
,

402 
ušt
 
J
,

403 cÚ¡ 
v®
,

404 & 
´ediùiÚ
,

405 
ušt
 * 
v®¬¿y
,

406 
ušt
 * 
pos™iÚs
,

407 
ušt
 
edge_size
,

408 (*
´ediùiÚ_func
)(
¡d
::
veùÜ
<
v”‹x_d©a
*>& 
node_¬¿y
, 
¬¿ysize
, 
¿tšg
, & 
´ediùiÚ
, 
fvec
 * 
psumi
, * 
exp_´ediùiÚ
),

409 
fvec
 * 
psum
,

410 
¡d
::
veùÜ
<
v”‹x_d©a
*>& 
node_¬¿y
,

411 
ušt
 
node_¬¿y_size
,

412 & 
exp_´ediùiÚ
){

417 
šdex
 = 0;

418 
loc
 = 0;

419 
node_¬¿y
[
šdex
] = &
Ï‹Á_çùÜs_šmem
[
I
+
fc
.
off£ts
[index]];

420 
	`as£¹
(
node_¬¿y
[
šdex
]->
pvec
[0] < 1e5);

421 
šdex
++; 
loc
++;

423 
	`as£¹
(
J
+
fc
.
off£ts
[
šdex
] < 
Ï‹Á_çùÜs_šmem
.
	`size
());

424 
node_¬¿y
[
šdex
] = &
Ï‹Á_çùÜs_šmem
[
J
+
fc
.
off£ts
[index]];

425 
	`as£¹
(
node_¬¿y
[
šdex
]->
pvec
[0] < 1e5);

426 
šdex
++; 
loc
++;

429 
j
=0; j< ()
edge_size
; j++){

430 
	`as£¹
(
fc
.
off£ts
.
	`size
(è> 
pos™iÚs
[
j
]);

431 
ušt
 
pos
 = 
fc
.
off£ts
[
pos™iÚs
[
j
]] + 
v®¬¿y
[j];

432 
	`as£¹
(
pos
 >ğ0 &&…o < 
Ï‹Á_çùÜs_šmem
.
	`size
());

433 
	`as£¹
(
j
+
šdex
 < ()
node_¬¿y_size
);

434 
node_¬¿y
[
j
+
šdex
] = & 
Ï‹Á_çùÜs_šmem
[
pos
];

435 
	`as£¹
(
node_¬¿y
[
j
+
šdex
]->
pvec
[0] < 1e5);

437 
šdex
+ğ
edge_size
;

438 
loc
 +ğ
edge_size
;

439 
	`as£¹
(
šdex
 =ğ
	`ÿlc_ã©u»_node_¬¿y_size
(
I
,
J
, 
edge_size
));

440  (*
´ediùiÚ_func
)(
node_¬¿y
, 
node_¬¿y_size
, 
v®
, 
´ediùiÚ
, 
psum
, &
exp_´ediùiÚ
);

441 
	}
}

442 
	~"rm£.hµ
"

453 
	g‹m¶©e
 <
ty³Çme
 
	g®s_edge_ty³
>

454 
cÚv”t_m©rixm¬k‘_N
(
¡d
::
¡ršg
 
ba£_f’ame
, 
boŞ
 
squ¬e
, 
ã©u»_cÚŒŞ
 & 
fc
, 
lim™_¿tšg
 = 0) {

456 
FILE
 *
f
;

457 
size_t
 
	gnz
;

461 
	gnsh¬ds
;

462 
	gsh¬d”
<
	g®s_edge_ty³
> 
sh¬d”obj
(
ba£_f’ame
);

463 
	gsh¬d”obj
.
¡¬t_´•roûssšg
();

465 
d‘eù_m©rix_size
(
ba£_f’ame
, 
f
, 
M
, 
N
, 
nz
);

468 ià(
	gfÜm©
 == "libsvm")

469 
as£¹
(!
has_h—d”_t™Ës
);

471 ià(
	ghas_h—d”_t™Ës
){

472 * 
	glšebuf
 = 
NULL
;

473 
size_t
 
	glšesize
;

474 
	glšebuf_debug
[1024];

477 
	grc
 = 
g‘lše
(&
lšebuf
, &
lšesize
, 
f
);

478 ià(
	grc
 == -1)

479 
log¡»am
(
LOG_FATAL
)<<"E¼Ü h—d”†š" << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

481 
¡ºıy
(
lšebuf_debug
, 
lšebuf
, 1024);

485 *
	gpch
 = 
¡¹ok
(
lšebuf
,"\t,\r; ");

486 ià(
	gpch
 =ğ
NULL
)

487 
log¡»am
(
LOG_FATAL
)<<"E¼Ü h—d”†š" << " [ " << 
lšebuf_debug
 << " ] " << 
¡d
::
’dl
;

489 
	gh—d”_t™Ës
.
push_back
(
pch
);

492 
	gpch
 !ğ
NULL
){

493 
pch
 = 
¡¹ok
(
NULL
, "\t,\r; ");

494 ià(
	gpch
 =ğ
NULL
)

496 
	gh—d”_t™Ës
.
push_back
(
pch
);

501 ià(
	gM
 =ğ0 && 
N
 == 0)

502 
log¡»am
(
LOG_FATAL
)<<"FaedØd‘eù m©rix size. PËa£…»·»‡ fÇmed: " << 
ba£_f’ame
 << ":šfØw™h m©rix m¬k‘ h—d”,‡ ex¶ašed h”e: h‰p://bicksÚ.blog¥Ù.co./2012/12/cŞÏbÜ©ive-f‹ršg-3rd-g’”©iÚ_14.htmÈ" << 
¡d
::
’dl
;

504 
log¡»am
(
LOG_INFO
è<< "S¹šgØ»ad m©rix-m¬k‘ iÅut. M©rix dim’siÚs: " << 
	gM
 << " x " << 
	gN
 << ",‚Ú-z”os: " << 
	gnz
 << 
	g¡d
::
’dl
;

506 
ušt
 
	gI
, 
	gJ
;

507 
	g¡d
::
veùÜ
<
ušt
> 
v®¬¿y
; 
	gv®¬¿y
.
»size
(
FEATURE_WIDTH
);

508 
	g¡d
::
veùÜ
<
ušt
> 
pos™iÚs
; 
	gpos™iÚs
.
»size
(
FEATURE_WIDTH
);

509 
	gv®
;

511 ià(
	glim™_¿tšg
 > 0)

512 
	gnz
 = 
lim™_¿tšg
;

513 
	gsk³d_ã©u»s
 = 0;

515 
size_t
 
	gi
=0; i<
	gnz
; i++)

517 
	gšdex
;

518 ià(!
»ad_lše
(
f
, 
ba£_f’ame
, 
i
,
I
, 
J
, 
v®
, 
v®¬¿y
, 
pos™iÚs
, 
šdex
, 
TRAINING
, 
sk³d_ã©u»s
))

519 
log¡»am
(
LOG_FATAL
)<<"FaedØ»ad†še: " <<
	gi
<< " iÀfe: " << 
	gba£_f’ame
 << 
	g¡d
::
’dl
;

521 ià(
	gšdex
 < 1)

522 
log¡»am
(
LOG_FATAL
)<<"FaedØ»ad†še: " <<
	gi
<< " iÀfe: " << 
	gba£_f’ame
 << 
	g¡d
::
’dl
;

524 ià(
	gnz
 > 1000000 && (
	gi
 % 1000000) == 0)

525 
log¡»am
(
LOG_INFO
)<< 
mytim”
.
cu¼’t_time
(è<< " Fšished„—dšg " << 
i
 << "†še " << 
¡d
::
’dl
;

527 
	gL
++;

528 
	gglob®M—n
 +ğ
v®
;

529 
	gsh¬d”obj
.
´•roûssšg_add_edge
(
I
, 
squ¬e
?
J
:
M
+J, 
®s_edge_ty³
(
v®
, &
v®¬¿y
[0], &
pos™iÚs
[0], 
šdex
));

532 
	gsh¬d”obj
.
’d_´•roûssšg
();

535 
as£¹
(
L
 > 0);

536 
as£¹
(
glob®M—n
 != 0);

537 
	gglob®M—n
 /ğ
L
;

538 
	g¡d
::
cout
<<"Cİu‹d glob® m—Àis: " << 
glob®M—n
 << 
¡d
::
’dl
;

540 
fşo£
(
f
);

542 
log¡»am
(
LOG_INFO
è<< "Now c»©šg sh¬ds." << 
	g¡d
::
’dl
;

544 
	gnsh¬ds
 = 
sh¬d”obj
.
execu‹_sh¬dšg
(
g‘_İtiÚ_¡ršg
("nshards", "auto"));

546  
	gnsh¬ds
;

552 
boŞ
 
mySÜt
(cÚ¡ 
¡d
::
·œ
<, > &
p1
,cÚ¡ std::·œ<, > &
p2
)

554  
	gp1
.
	g£cÚd
 > 
	gp2
.second;

561 
v®id©iÚ_rm£_N
(

562 (*
´ediùiÚ_func
)(
¡d
::
veùÜ
<
v”‹x_d©a
*>& 
¬¿y
, 
¬¿ysize
, 
¿tšg
, & 
´ediùiÚ
, 
fvec
 * 
psum
, * 
exp_´ediùiÚ
)

563 ,
g¿phchi_cÚ‹xt
 & 
gcÚ‹xt
,

564 
ã©u»_cÚŒŞ
 & 
fc
,

565 
boŞ
 
squ¬e
 = 
çl£
) {

567 ià(
v®id©iÚ
 == "")

570 
FILE
 * 
f
 = 
NULL
;

571 
size_t
 
nz
 = 0;

572 
	`d‘eù_m©rix_size
(
v®id©iÚ
, 
f
, 
Me
, 
Ne
, 
nz
);

573 ià(
f
 =ğ
NULL
){

574 
	`log¡»am
(
LOG_WARNING
)<<"FaedØİ’ v®id©iÚ fe: " << 
v®id©iÚ
 << " - skpšg."<<
¡d
::
’dl
;

577 ià((
M
 > 0 && 
N
 > 0è&& (
Me
 !ğM || 
Ne
 != N))

578 
	`log¡»am
(
LOG_WARNING
)<<"IÅuˆsizoàv®id©iÚ m©rix mu¡ bid’tiÿÈtØŒaššg m©rix,‚am–y " << 
M
 << "x" << 
N
 << 
¡d
::
’dl
;

580 
Le
 = 
nz
;

582 
Ï¡_v®id©iÚ_rm£
 = 
dv®id©iÚ_rm£
;

583 
dv®id©iÚ_rm£
 = 0;

585 
¡d
::
veùÜ
<
ušt
> 
v®¬¿y
; v®¬¿y.
	`»size
(
FEATURE_WIDTH
);

586 
¡d
::
veùÜ
<
ušt
> 
pos™iÚs
;…os™iÚs.
	`»size
(
FEATURE_WIDTH
);

587 
ušt
 
I
, 
J
;

588 
v®
;

589 
sk³d_ã©u»s
 = 0;

590 
sk³d_nodes
 = 0;

591 
”rÜs
 = 0;

594 
_M
 = 0;

595 
_N
 = 0;

596 
¡d
::
veùÜ
<¡d::
·œ
<, > > 
»®P»diùiÚ
;

597 
avg_´ed
 = 0;

599 
size_t
 
i
=0; i<
nz
; i++)

601 
šdex
;

602 ià(!
	`»ad_lše
(
f
, 
v®id©iÚ
, 
i
, 
I
, 
J
, 
v®
, 
v®¬¿y
, 
pos™iÚs
, 
šdex
, 
VALIDATION
, 
sk³d_ã©u»s
))

603 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad†še: " << 
i
 << " iÀfe: " << 
v®id©iÚ
 << 
¡d
::
’dl
;

605 ià(
I
 =ğ(
ušt
)-1 || 
J
 == (uint)-1){

606 
sk³d_nodes
++;

610 
´ediùiÚ
;

611 
howmªy
 = 
	`ÿlc_ã©u»_node_¬¿y_size
(
I
,
J
, 
šdex
);

612 
¡d
::
veùÜ
<
v”‹x_d©a
*> 
node_¬¿y
;‚ode_¬¿y.
	`»size
(
howmªy
);

613 
k
=0; k< 
howmªy
; k++)

614 
node_¬¿y
[
k
] = 
NULL
;

616 
fvec
 
sum
;

617 
exp_´ediùiÚ
 = 0;

618 
dv®id©iÚ_rm£
 +ğ
	`compu‹_´ediùiÚ
(
I
, 
J
, 
v®
, 
´ediùiÚ
, &
v®¬¿y
[0], &
pos™iÚs
[0], 
šdex
, 
´ediùiÚ_func
, &
sum
, 
node_¬¿y
, 
howmªy
, 
exp_´ediùiÚ
);

619 
avg_´ed
 +ğ
´ediùiÚ
;

620 ià(
ÿlc_roc
)

621 
»®P»diùiÚ
.
	`push_back
(
¡d
::
	`make_·œ
(
v®
, 
exp_´ediùiÚ
));

623 ià(
´ediùiÚ
 < 
cutoff
 && 
v®
 >ğ
v®_cutoff
)

624 
”rÜs
++;

625 ià(
´ediùiÚ
 >ğ
cutoff
 && 
v®
 < 
v®_cutoff
)

626 
”rÜs
++;

629 
	`fşo£
(
f
);

631 
¡d
::
cout
<<"avg v®id©iÚ…»diùiÚ: " << 
avg_´ed
/()
nz
 << std::
’dl
;

632 
	`as£¹
(
Le
 > 0);

633 
dv®id©iÚ_rm£
 = 
	`fš®ize_rm£
(dv®id©iÚ_rm£ , ()(
Le
-
sk³d_nodes
));

634 
¡d
::
cout
<<" V®id©iÚ " << 
”rÜ_Çmes
[
loss_ty³
] << " : " << std::
	`£tw
(10è<< 
dv®id©iÚ_rm£
;

635 ià(
ÿlc_”rÜ
)

636 
¡d
::
cout
<<" V®id©iÚ E¼: " << std::
	`£tw
(10è<< (()
”rÜs
/()(
nz
-
sk³d_nodes
));

638 ià(
ÿlc_roc
){

639 
roc
 = 0;

640 
»t
 = 0;

641 
¡d
::
veùÜ
<> 
L
;

642 
¡d
::
	`sÜt
(
»®P»diùiÚ
.
	`begš
(),„—lP»diùiÚ.
	`’d
(),
mySÜt
);

643 
¡d
::
veùÜ
<¡d::
·œ
<, > >::
™”©Ü
 
™”
;

644 
™”
=
»®P»diùiÚ
.
	`begš
();™”!ô—lP»diùiÚ.
	`’d
();iter++)

646 
L
.
	`push_back
(
™”
->
fœ¡
);

647 if(
™”
->
fœ¡
 > 
cutoff
è
_M
++;

648 
_N
++;

650 
¡d
::
veùÜ
<>:: 
™”©Ü
 
™”2
;

651 
i
=0;

652 
™”2
=
L
.
	`begš
();™”2!=L.
	`’d
();iter2++)

654 if(*
™”2
 > 
cutoff
è
»t
 +ğ((
_M
+
_N
è- 
i
);

655 
i
++;

657 
»t2
 = 
_M
 *(_M+1)/2;

658 
roc
ğ(
»t
-
»t2
)/(
_M
*
_N
);

659 
¡d
::
cout
<<" V®id©iÚ ROC: " << 
roc
 << std::
’dl
;

661 
¡d
::
cout
<<¡d::
’dl
;

665 ià(
h®t_Ú_rm£_šü—£
 && 
dv®id©iÚ_rm£
 > 
Ï¡_v®id©iÚ_rm£
 && 
gcÚ‹xt
.
™”©iÚ
 > 0){

666 
	`log¡»am
(
LOG_WARNING
)<<"Stİpšgƒngšbeÿu£ oàv®id©iÚ RMSE inü—£" << 
¡d
::
’dl
;

667 
gcÚ‹xt
.
	`£t_Ï¡_™”©iÚ
(gcÚ‹xt.
™”©iÚ
);

669 ià(
sk³d_ã©u»s
 > 0)

670 
¡d
::
cout
<<"Sk³d " << 
sk³d_ã©u»s
 << " wh’„—dšg from fe. " << std::
’dl
;

671 ià(
sk³d_nodes
 > 0)

672 
¡d
::
cout
<<"Sk³d " << 
sk³d_nodes
 << " wh’„—dšg from fe. " << std::
’dl
;

673 
	}
}

678 
‹¡_´ediùiÚs_N
(

679 (*
´ediùiÚ_func
)(
¡d
::
veùÜ
<
v”‹x_d©a
*>& 
node_¬¿y
, 
node_¬¿y_size
, 
¿tšg
, & 
´ediùiÚ
, 
fvec
 * 
sum
, * 
exp_´ediùiÚ
),

680 
ã©u»_cÚŒŞ
 & 
fc
,

681 
boŞ
 
squ¬e
 = 
çl£
) {

682 
FILE
 *
f
 = 
NULL
;

683 
ušt
 
Me
, 
Ne
;

684 
size_t
 
nz
;

686 ià(
‹¡
 == ""){

687 
	`log¡»am
(
LOG_INFO
)<<"NØ‹¡ fwa found, skpšge¡…»diùiÚ " << 
¡d
::
’dl
;

691 
	`d‘eù_m©rix_size
(
‹¡
, 
f
, 
Me
, 
Ne
, 
nz
);

692 ià(
f
 =ğ
NULL
){

693 
	`log¡»am
(
LOG_WARNING
)<<"FaedØİ’e¡ f" << 
‹¡
<< " skpšge¡…»diùiÚ " << 
¡d
::
’dl
;

697 ià((
M
 > 0 && 
N
 > 0 ) && (
Me
 !ğM || 
Ne
 != N))

698 
	`log¡»am
(
LOG_FATAL
)<<"IÅuˆsizoà‹¡ m©rix mu¡ bid’tiÿÈtØŒaššg m©rix,‚am–y " << 
M
 << "x" << 
N
 << 
¡d
::
’dl
;

700 
FILE
 * 
fout
 = 
	`İ’_fe
((
‹¡
 + ".´ediù").
	`c_¡r
(),"w", 
çl£
);

702 
MM_ty³code
 
m©code
;

703 
	`mm_£t_¬¿y
(&
m©code
);

704 
	`mm_wr™e_bªÃr
(
fout
, 
m©code
);

705 
	`mm_wr™e_mtx_¬¿y_size
(
fout
 ,
nz
, 1);

707 
¡d
::
veùÜ
<
ušt
> 
v®¬¿y
; v®¬¿y.
	`»size
(
FEATURE_WIDTH
);

708 
¡d
::
veùÜ
<
ušt
> 
pos™iÚs
;…os™iÚs.
	`»size
(
FEATURE_WIDTH
);

709 
v®
;

710 
´ediùiÚ
;

711 
ušt
 
I
,
J
;

712 
sk³d_ã©u»s
 = 0;

713 
sk³d_nodes
 = 0;

715 
ušt
 
i
=0; i<
nz
; i++)

717 
šdex
;

718 ià(!
	`»ad_lše
(
f
, 
‹¡
, 
i
, 
I
, 
J
, 
v®
, 
v®¬¿y
, 
pos™iÚs
, 
šdex
, 
TEST
, 
sk³d_ã©u»s
))

719 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad†še: " <<
i
 << " iÀfe: " << 
‹¡
 << 
¡d
::
’dl
;

721 ià(
I
 =ğ(
ušt
)-1 || 
J
 == (uint)-1){

722 
sk³d_nodes
++;

723 
	`årštf
(
fout
, "%d\n", 0);

727 
howmªy
 = 
	`ÿlc_ã©u»_node_¬¿y_size
(
I
,
J
,
šdex
);

728 
¡d
::
veùÜ
<
v”‹x_d©a
*> 
node_¬¿y
;‚ode_¬¿y.
	`»size
(
howmªy
);

729 
k
=0; k< 
howmªy
; k++)

730 
node_¬¿y
[
k
] = 
NULL
;

732 
fvec
 
sum
;

733 
exp_´ediùiÚ
 = 0;

734 
	`compu‹_´ediùiÚ
(
I
, 
J
, 
v®
, 
´ediùiÚ
, &
v®¬¿y
[0], &
pos™iÚs
[0], 
šdex
, 
´ediùiÚ_func
, &
sum
, 
node_¬¿y
, 
howmªy
, 
exp_´ediùiÚ
);

735 
	`årštf
(
fout
, "%12.8lg\n", 
´ediùiÚ
);

737 
	`fşo£
(
f
);

738 
	`fşo£
(
fout
);

740 
	`log¡»am
(
LOG_INFO
)<<"Fšished wr™šg " << 
nz
 << "…»diùiÚ tØfe: " << 
‹¡
 << ".´ediù" << 
¡d
::
’dl
;

741 ià(
sk³d_ã©u»s
 > 0)

742 
	`log¡»am
(
LOG_DEBUG
)<<"Sk³d " << 
sk³d_ã©u»s
 << " wh’„—dšg from fe. " << 
¡d
::
’dl
;

743 ià(
sk³d_nodes
 > 0)

744 
	`log¡»am
(
LOG_WARNING
)<<"Sk³d‚odše¡ d©a£t: " << 
sk³d_nodes
 << 
¡d
::
’dl
;

745 
	}
}

751 
g’sgd_´ediù
(
¡d
::
veùÜ
<
v”‹x_d©a
*> & 
node_¬¿y
, 
node_¬¿y_size
,

752 cÚ¡ 
¿tšg
, & 
´ediùiÚ
, 
fvec
* 
sum
, * 
exŒa
){

754 
fvec
 
	gsum_sqr
 = 
fz”os
(
D
);

755 *
	gsum
 = 
fz”os
(
D
);

756 
	g´ediùiÚ
 = 
glob®M—n
/
maxv®
;

757 
as£¹
(!
¡d
::
i¢ª
(
´ediùiÚ
));

758 
	gi
=0; i< 
	gnode_¬¿y_size
; i++)

759 
	g´ediùiÚ
 +ğ
node_¬¿y
[
i
]->
bŸs
;

760 
as£¹
(!
¡d
::
i¢ª
(
´ediùiÚ
));

762 
	gj
=0; j< 
	gD
; j++){

763 
	gi
=0; i< 
	gnode_¬¿y_size
; i++){

764 
	gsum
->
	gİ”©Ü
[](
	gj
è+ğ
node_¬¿y
[
i
]->
pvec
[
j
];

765 
as£¹
(
sum
->
İ”©Ü
[](
j
) < 1e5);

766 
	gsum_sqr
[
j
] +ğ
pow
(
node_¬¿y
[
i
]->
pvec
[j],2);

768 
	g´ediùiÚ
 +ğ0.5 * (
pow
(
sum
->
İ”©Ü
[](
j
),2è- 
	gsum_sqr
[j]);

769 
as£¹
(!
¡d
::
i¢ª
(
´ediùiÚ
));

772 
	gexp_´ediùiÚ
 = 1.0 / (1.0 + 
exp
(-
´ediùiÚ
));

773 
	g´ediùiÚ
 = 
mšv®
 + 
exp_´ediùiÚ
 *(
maxv®
-minval);

778 
	g”r
 = 
¿tšg
 - 
´ediùiÚ
;

779 ià(
	gexŒa
 !ğ
NULL
)

780 *(*)
exŒa
 = 
exp_´ediùiÚ
;

782  
ÿlc_loss
(
exp_´ediùiÚ
, 
”r
);

787 
	$š™_g’sgd
(
boŞ
 
lßd_çùÜs_äom_fe
){

789 
	`¤ªd
(
	`time
(
NULL
));

790 
nodes
 = 
M
+
N
+
	`num_ã©u»_bšs
();

791 
Ï‹Á_çùÜs_šmem
.
	`»size
(
nodes
);

792 
howmªy
 = 
	`ÿlc_ã©u»_num
();

793 
	`log¡»am
(
LOG_DEBUG
)<<"GošgØÿlcuÏ‹: " << 
howmªy
 << " off£ts." << 
¡d
::
’dl
;

794 
fc
.
off£ts
.
	`»size
(
howmªy
);

795 
	`g‘_off£ts
(
fc
.
off£ts
);

796 
	`as£¹
(
D
 > 0);

797 ià(!
lßd_çùÜs_äom_fe
){

798 
çùÜ
 = 0.1/
	`sq¹
(
D
);

799 #´agm¨
omp
 
·¿Î–
 

800 
i
=0; i< 
nodes
; i++){

801 
Ï‹Á_çùÜs_šmem
[
i
].
pvec
 = (
debug
 ? 0.1*
	`fÚes
(
D
è: (::
	`äªdu
(D)*
çùÜ
));

804 
	}
}

807 
	$Œaššg_rm£_N
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
, 
boŞ
 
™ems
 = 
çl£
){

808 
Ï¡_Œaššg_rm£
 = 
dŒaššg_rm£
;

809 
dŒaššg_rm£
 = 0;

810 
size_t
 
tÙ®_”rÜs
 = 0;

811 
¡¬t
 = 0;

812 
’d
 = 
M
;

813 ià(
™ems
){

814 
¡¬t
 = 
M
;

815 
’d
 = 
M
+
N
;

817 
dŒaššg_rm£
 = 
	`sum
(
rm£_vec
);

818 ià(
ÿlc_”rÜ
){

819 
tÙ®_”rÜs
 = 
	`sum
(
”rÜs_vec
);

821 
dŒaššg_rm£
 = 
	`fš®ize_rm£
(dŒaššg_rm£, ()
³ngše
->
	`num_edges
());

822 ià(
ÿlc_”rÜ
)

823 
¡d
::
cout
<< std::
	`£tw
(10è<< 
mytim”
.
	`cu¼’t_time
(è<< "èI‹¿tiÚ: " << std::£tw(3è<<
™”©iÚ
<<" T¿ššg " << 
”rÜ_Çmes
[
loss_ty³
] << " : " <<¡d::£tw(10)<< 
dŒaššg_rm£
 << " T¿šƒ¼: " << std::£tw(10è<< (
tÙ®_”rÜs
/()
L
);

825 
¡d
::
cout
<< std::
	`£tw
(10è<< 
mytim”
.
	`cu¼’t_time
(è<< "èI‹¿tiÚ: " << std::£tw(3è<<
™”©iÚ
<<" T¿ššg " << 
”rÜ_Çmes
[
loss_ty³
] << " : " << std::£tw(10)<< 
dŒaššg_rm£
;

826 
	}
}

832 
	gS·r£_G’sgdV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

837 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

842 ià(
is_u£r
(
v”‹x
.
id
())){

844 
	ge
=0;ƒ < 
	gv”‹x
.
num_ou‹dges
();ƒ++) {

845 cÚ¡ 
	gedge_d©a
 & 
	gd©a
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

846 
	ghowmªy
 = 
ÿlc_ã©u»_node_¬¿y_size
(
v”‹x
.
id
(), v”‹x.
edge
(
e
)->
v”‹x_id
()-
M
, 
d©a
.
size
);

847 
	g¡d
::
veùÜ
<
v”‹x_d©a
*> 
node_¬¿y
; 
	gnode_¬¿y
.
»size
(
howmªy
);

848 
	gi
=0; i< 
	ghowmªy
; i++)

849 
	gnode_¬¿y
[
i
] = 
NULL
;

851 
	grui
 = 
d©a
.
weight
;

852 
	gpui
;

853 
fvec
 
	gsum
;

856 
	gexp_´ediùiÚ
 = 0;

857 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
compu‹_´ediùiÚ
(
v”‹x
.
id
(), v”‹x.
edge
(
e
)->
v”‹x_id
()-
M
, 
rui
 ,
pui
, (
ušt
*)
d©a
.
ã©u»s
, (ušt*)d©a.
šdex
, d©a.
size
, 
g’sgd_´ediù
, &
sum
, 
node_¬¿y
, 
howmªy
, 
exp_´ediùiÚ
);

858 ià(
	gÿlc_”rÜ
){

859 ià((
	gpui
 < 
	gcutoff
 && 
	grui
 > cutoff) || (pui > cutoff &&„ui < cutoff))

860 
	g”rÜs_vec
[
omp_g‘_th»ad_num
()]++;

862 
	geui
 = 
pui
 - 
rui
;

863 
	geui
 = 
ÿlc_”rÜ_f
(
exp_´ediùiÚ
, 
eui
);

866 
	gglob®M—n
 -ğ
g’sgd_¿‹1
 * (
eui
 + 
g’sgd_»g0
 * 
glob®M—n
);

869 
	gi
=0; i < 
	ghowmªy
; i++){

871 
	gg’sgd_¿‹
;

872 ià(
	gi
 == 0)

873 
g’sgd_¿‹
 = 
g’sgd_¿‹1
;

874 ià(
	gi
 == 1)

875 
g’sgd_¿‹
 = 
g’sgd_¿‹2
;

876 ià(
	gi
 < ()(
	gd©a
.
	gsize
+2))

877 
	gg’sgd_¿‹
 = 
g’sgd_¿‹3
;

878 ià(
	gi
 < ()(2+
	gd©a
.
	gsize
+
	gfc
.
	gnode_ã©u»s
))

879 
	gg’sgd_¿‹
 = 
g’sgd_¿‹4
;

881 
	gg’sgd_¿‹
 = 
g’sgd_¿‹5
;

883 
	gnode_¬¿y
[
i
]->
	gbŸs
 -ğ
g’sgd_¿‹
 * (
eui
 + 
g’sgd_»gw
* 
node_¬¿y
[i]->
bŸs
);

884 
as£¹
(!
¡d
::
i¢ª
(
node_¬¿y
[
i
]->
bŸs
));

885 
as£¹
(
node_¬¿y
[
i
]->
bŸs
 < 1e3);

887 
fvec
 
	gg¿d
 = 
sum
 - 
node_¬¿y
[
i
]->
pvec
;

888 
	gnode_¬¿y
[
i
]->
	gpvec
 -ğ
g’sgd_¿‹
 * (
eui
*
g¿d
 + 
g’sgd_»gv
 * 
node_¬¿y
[i]->
pvec
);

889 
as£¹
(!
¡d
::
i¢ª
(
node_¬¿y
[
i
]->
pvec
[0]));

890 
as£¹
(
node_¬¿y
[
i
]->
pvec
[0] < 1e3);

903 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

904 ià(
	g™”©iÚ
 =ğ1 && 
v”‹x_w™h_no_edges
 > 0)

905 
log¡»am
(
LOG_WARNING
)<<"Th”¬" << 
v”‹x_w™h_no_edges
 << " u£r w™houˆ¿tšgs" << 
¡d
::
’dl
;

906 
	gg’sgd_¿‹1
 *ğ
g’sgd_muÉ_dec
;

907 
	gg’sgd_¿‹2
 *ğ
g’sgd_muÉ_dec
;

908 
	gg’sgd_¿‹3
 *ğ
g’sgd_muÉ_dec
;

909 
	gg’sgd_¿‹4
 *ğ
g’sgd_muÉ_dec
;

910 
	gg’sgd_¿‹5
 *ğ
g’sgd_muÉ_dec
;

911 
Œaššg_rm£_N
(
™”©iÚ
, 
gcÚ‹xt
);

912 
v®id©iÚ_rm£_N
(&
g’sgd_´ediù
, 
gcÚ‹xt
, 
fc
);

918 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

919 
	grm£_vec
 = 
z”os
(
numb”_of_omp_th»ads
());

920 ià(
	gÿlc_”rÜ
)

921 
	g”rÜs_vec
 = 
z”os
(
numb”_of_omp_th»ads
());

927 
ouut_g’sgd_»suÉ
(
¡d
::
¡ršg
 
f’ame
) {

928 
MMOuu‰”_m©
<
v”‹x_d©a
> 
mmouut
(
f’ame
 + "_U.mm", 0, 
M
+
N
+
num_ã©u»_bšs
(), "Thi fcÚš S·r£_G’sgd ouuˆm©riûs. IÀ—ch„ow D faùÜ oà¨sšgË u£¸node,h’ i‹m‚odes,h’ f—tu»s", 
Ï‹Á_çùÜs_šmem
);

929 
	gMMOuu‰”_vec
<
	gv”‹x_d©a
> 
mmouut_bŸs
(
f’ame
 + "_U_bŸs.mm", 0, 
num_ã©u»_bšs
(), 
BIAS_POS
,"Thi fcÚš S·r£_G’sgd ouuˆbŸ veùÜ. IÀ—ch„ow‡ sšgË u£¸bŸs.", 
Ï‹Á_çùÜs_šmem
);

930 
MMOuu‰”_sÿÏr
 
gm—n
(
f’ame
 + "_glob®_m—n.mm", "Thi fcÚš S·r£_G’sgd glob® m—Àwhich i »quœed fÜ computšg…»diùiÚs.", 
glob®M—n
);

932 
log¡»am
(
LOG_INFO
è<< " GENSGD ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << "_U.mm" << ", "<< f’am<< "_glob®_m—n.mm, " << f’am<< "_U_bŸs.mm " <<
	g¡d
::
’dl
;

935 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

938 
	`´št_cİyright
();

942 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

946 
m‘rics
 
	`m
("als-tensor-inmemory-factors");

949 
g’sgd_¿‹1
 = 
	`g‘_İtiÚ_æßt
("gensgd_rate1", gensgd_rate1);

950 
g’sgd_¿‹2
 = 
	`g‘_İtiÚ_æßt
("gensgd_rate2", gensgd_rate2);

951 
g’sgd_¿‹3
 = 
	`g‘_İtiÚ_æßt
("gensgd_rate3", gensgd_rate3);

952 
g’sgd_¿‹4
 = 
	`g‘_İtiÚ_æßt
("gensgd_rate4", gensgd_rate4);

953 
g’sgd_¿‹5
 = 
	`g‘_İtiÚ_æßt
("gensgd_rate5", gensgd_rate5);

954 
g’sgd_»gw
 = 
	`g‘_İtiÚ_æßt
("gensgd_regw", gensgd_regw);

955 
g’sgd_»gv
 = 
	`g‘_İtiÚ_æßt
("gensgd_regv", gensgd_regv);

956 
g’sgd_»g0
 = 
	`g‘_İtiÚ_æßt
("gensgd_reg0", gensgd_reg0);

957 
g’sgd_muÉ_dec
 = 
	`g‘_İtiÚ_æßt
("gensgd_mult_dec", gensgd_mult_dec);

958 
fc
.
hash_¡ršgs
 = 
	`g‘_İtiÚ_št
("rehash", fc.hash_strings);

959 
u£r_fe
 = 
	`g‘_İtiÚ_¡ršg
("user_file", user_file);

960 
u£r_lšks
 = 
	`g‘_İtiÚ_¡ršg
("user_links", user_links);

961 
™em_fe
 = 
	`g‘_İtiÚ_¡ršg
("item_file", item_file);

962 
D
 = 
	`g‘_İtiÚ_št
("D", D);

963 
fc
.
äom_pos
 = 
	`g‘_İtiÚ_št
("from_pos", fc.from_pos);

964 
fc
.
to_pos
 = 
	`g‘_İtiÚ_št
("to_pos", fc.to_pos);

965 
fc
.
v®_pos
 = 
	`g‘_İtiÚ_št
("val_pos", fc.val_pos);

966 
lim™_¿tšg
 = 
	`g‘_İtiÚ_št
("limit_rating",†imit_rating);

967 
ÿlc_”rÜ
 = 
	`g‘_İtiÚ_št
("calc_error", calc_error);

968 
ÿlc_roc
 = 
	`g‘_İtiÚ_št
("calc_roc", calc_roc);

969 
round_æßt
 = 
	`g‘_İtiÚ_št
("round_float",„ound_float);

970 
has_h—d”_t™Ës
 = 
	`g‘_İtiÚ_št
("has_header_titles", has_header_titles);

971 
fc
.
»hash_v®ue
 = 
	`g‘_İtiÚ_št
("rehash_value", fc.rehash_value);

972 
cutoff
 = 
	`g‘_İtiÚ_æßt
("cutoff", cutoff);

973 
v®_cutoff
 = 
	`g‘_İtiÚ_æßt
("val_cutoff", val_cutoff);

974 
bš¬y
 = 
	`g‘_İtiÚ_št
("binary", binary);

976 
	`·r£_commªd_lše_¬gs
();

977 
	`·r£_im¶ic™_commªd_lše
();

979 
fc
.
node_id_m­s
.
	`»size
(2);

983 ià(
fÜm©
 == "libsvm"){

984 
fc
.
v®_pos
 = 0;

985 
fc
.
to_pos
 = 2;

986 
fc
.
äom_pos
 = 1;

987 
bš¬y
 = 
çl£
;

988 
fc
.
hash_¡ršgs
 = 
Œue
;

991 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘_N
<
edge_d©a
>(
Œaššg
, 
çl£
, 
fc
, 
lim™_¿tšg
);

992 
fc
.
tÙ®_ã©u»s
 = fc.
šdex_m­
.
¡ršg2nodeid
.
	`size
();

994 ià(
lßd_çùÜs_äom_fe
){

995 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_U.mm", 0, 
D
);

996 
vec
 
u£r_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 +"_U_bŸs.mm", 
çl£
, 
Œue
);

997 
	`as£¹
(
u£r_bŸs
.
	`size
(è=ğ
	`num_ã©u»_bšs
());

998 
ušt
 
i
=0; 
	`num_ã©u»_bšs
(); i++){

999 
Ï‹Á_çùÜs_šmem
[
i
].
bŸs
 = 
u£r_bŸs
[i];

1001 
vec
 
gm
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 + "_glob®_m—n.mm", 
çl£
, 
Œue
);

1002 
glob®M—n
 = 
gm
[0];

1005 
	`š™_g’sgd
(
lßd_çùÜs_äom_fe
);

1007 ià(
has_h—d”_t™Ës
 && 
h—d”_t™Ës
.
	`size
() == 0)

1008 
	`log¡»am
(
LOG_FATAL
)<<"PËa£ d–‘‹m°fe (usšg : \"rm -à" << 
Œaššg
 << ".*\"èªd„uÀagaš" << 
¡d
::
’dl
;

1010 
	`log¡»am
(
LOG_INFO
)<<"T¬g‘ v¬ŸbË " << 
¡d
::
	`£tw
(3è<< 
fc
.
v®_pos
 << " : " << (
has_h—d”_t™Ës
? 
h—d”_t™Ës
[fc.v®_pos] : ""è<<¡d::
’dl
;

1011 
	`log¡»am
(
LOG_INFO
)<<"From " << 
¡d
::
	`£tw
(3è<< 
fc
.
äom_pos
<< " : " << (
has_h—d”_t™Ës
? 
h—d”_t™Ës
[fc.äom_pos] : ""è<<¡d::
’dl
;

1012 
	`log¡»am
(
LOG_INFO
)<<"TØ " << 
¡d
::
	`£tw
(3è<< 
fc
.
to_pos
 << " : " << (
has_h—d”_t™Ës
? 
h—d”_t™Ës
[fc.to_pos] : ""è<<¡d::
’dl
;

1017 
S·r£_G’sgdV”tiûsInMemProg¿m
 
´og¿m
;

1018 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

1019 
	`£t_’gše_æags
(
’gše
);

1020 
³ngše
 = &
’gše
;

1021 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

1024 
	`ouut_g’sgd_»suÉ
(
Œaššg
);

1025 
	`‹¡_´ediùiÚs_N
(&
g’sgd_´ediù
, 
fc
);

1028 
	`m‘rics_»pÜt
(
m
);

1030 
	}
}

	@toolkits/collaborative_filtering/svd.cpp

26 
	~"commÚ.hµ
"

27 
	~"ty³s.hµ
"

28 
	~"eig’_w¿µ”.hµ
"

29 
	~"tim”.hµ
"

31 
usšg
 
Çme¥aû
 
	g¡d
;

34 
	gnsh¬ds
;

35 
	gšput_cŞs
 = 3;

38 
m‘rics
 
m
("svd-inmemory-factors");

41 
	sv”‹x_d©a
 {

42 
vec
 
	mpvec
;

43 
	mv®ue
;

44 
	mA_ii
;

45 
v”‹x_d©a
(){ 
	mv®ue
 = 0; 
	mA_ii
 = 1; }

48 
£t_v®
(
v®ue
, 
f›ld_ty³
) {

49 
	mpvec
[
f›ld_ty³
] = 
v®ue
;

54 
	sedge_d©a
 {

55 
	mweight
;

56 
edge_d©a
(
weight
 = 0) : weight(weight) { }

57 
edge_d©a
(
weight
, 
ignÜed
) : weight(weight) { }

67 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

68 
edge_d©a
 
	tEdgeD©aTy³
;

70 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

71 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

74 
	~"io.hµ
"

89 
	gmax_™”
 = 10;

90 
boŞ
 
	gno_edge_d©a
 = 
çl£
;

91 
	gaùu®_veùÜ_Ën
;

92 
	gnv
 = 0;

93 
	gnsv
 = 0;

94 
	gtŞ
 = 1e-8;

95 
boŞ
 
	gfšished
 = 
çl£
;

96 
	gÜtho_»³©s
 = 3;

97 
boŞ
 
	g§ve_veùÜs
 = 
çl£
;

98 
	g¡d
::
¡ršg
 
fÜm©
 = "matrixmarket";

99 
	gnodes
 = 0;

101 
	gd©a_size
 = 
max_™”
;

102 
	~"m©h.hµ
"

103 
	~"´štouts.hµ
"

105 
	$š™_Ïnczos
(
b¬t™e_g¿ph_desütÜ
 & 
šfo
){

106 
	`¤ªd48
(
	`time
(
NULL
));

107 
Ï‹Á_çùÜs_šmem
.
	`»size
(
šfo
.
	`tÙ®
());

108 
d©a_size
 = 
nsv
 + 
nv
+1 + 
max_™”
;

109 ià(
šfo
.
	`is_squ¬e
())

110 
d©a_size
 *= 2;

111 
aùu®_veùÜ_Ën
 = 
d©a_size
;

112 #´agm¨
omp
 
·¿Î–
 

113 
i
=0; i< 
šfo
.
	`tÙ®
(); i++){

114 
Ï‹Á_çùÜs_šmem
[
i
].
pvec
 = 
	`z”os
(
aùu®_veùÜ_Ën
);

116 
	`log¡»am
(
LOG_INFO
)<<"AÎoÿ‹d‡Ù® of: " << (()
aùu®_veùÜ_Ën
 * 
šfo
.
	`tÙ®
(è* ()/ 1e6è<< " MB fÜ stÜšg veùÜs." << 
¡d
::
’dl
;

117 
	}
}

119 
vec
 
Ïnczos
Ğ
b¬t™e_g¿ph_desütÜ
 & 
šfo
, 
tim”
 & 
mytim”
, veø& 
”»¡
,

120 cÚ¡ 
¡d
::
¡ršg
 & 
vecfe
){

123 
ncÚv
 = 0;

124 
	g™s
 = 1;

125 
Di¡M©
 
A
(
šfo
);

126 
Di¡SliûdM©
 
U
(
šfo
.
is_squ¬e
(è? 
d©a_size
 : 0, info.is_squ¬e(è? 2*d©a_siz: d©a_size, 
Œue
, info, "U");

127 
Di¡SliûdM©
 
V
(0, 
d©a_size
, 
çl£
, 
šfo
, "V");

128 
vec
 
	g®pha
, 
	gb‘a
, 
	gb
;

129 
vec
 
	gsigma
 = 
z”os
(
d©a_size
);

130 
	g”»¡
 = 
z”os
(
nv
);

131 
Di¡Vec
 
v_0
(
šfo
, 0, 
çl£
, "v_0");

132 ià(
	gvecfe
.
size
() == 0)

133 
v_0
 = 
¿ndu
(
size
(
A
,2));

134 
PRINT_VEC2
("svd->V", 
v_0
);

136 
Di¡DoubË
 
	gvnÜm
 = 
nÜm
(
v_0
);

137 
	gv_0
=
v_0
/
vnÜm
;

138 
PRINT_INT
(
nv
);

140 
	gncÚv
 < 
	gnsv
 && 
	g™s
 < 
	gmax_™”
){

141 
	g¡d
::
cout
<<"S¹šg i‹¿tiÚ: " << 
™s
 << "‡ˆtime: " << 
mytim”
.
cu¼’t_time
(è<< 
¡d
::
’dl
;

142 
	gk
 = 
ncÚv
;

143 
	gn
 = 
nv
;

144 
PRINT_INT
(
k
);

145 
PRINT_INT
(
n
);

147 
	g®pha
 = 
z”os
(
n
);

148 
	gb‘a
 = 
z”os
(
n
);

150 
	gU
[
k
] = 
V
[k]*
A
.
_Œª¥o£
();

151 
ÜthogÚ®ize_vs_®l
(
U
, 
k
, 
®pha
(0));

153 
PRINT_VEC3
("®pha", 
®pha
, 0);

156 
	gi
=
k
+1; i<
	gn
; i++){

157 
	g¡d
::
cout
 <<"S¹šg s‹p: " << 
i
 << "‡ˆtime: " << 
mytim”
.
cu¼’t_time
(è<< 
¡d
::
’dl
;

158 
PRINT_INT
(
i
);

160 
	gV
[
i
]=
U
[i-1]*
A
;

161 
ÜthogÚ®ize_vs_®l
(
V
, 
i
, 
b‘a
(i-
k
-1));

165 
PRINT_VEC3
("b‘a", 
b‘a
, 
i
-
k
-1);

167 
	gU
[
i
] = 
V
[i]*
A
.
_Œª¥o£
();

168 
ÜthogÚ®ize_vs_®l
(
U
, 
i
, 
®pha
(i-
k
));

172 
PRINT_VEC3
("®pha", 
®pha
, 
i
-
k
);

175 
	gV
[
n
]ğ
U
[n-1]*
A
;

176 
ÜthogÚ®ize_vs_®l
(
V
, 
n
, 
b‘a
Ò-
k
-1));

178 
PRINT_VEC3
("b‘a", 
b‘a
, 
n
-
k
-1);

181 
PRINT_INT
(
nv
);

182 
PRINT_NAMED_INT
("svd->ncÚv", 
ncÚv
);

183 
	gn
 = 
nv
 - 
ncÚv
;

184 
PRINT_INT
(
n
);

185 
	g®pha
.
cÚ£rv©iveResize
(
n
);

186 
	gb‘a
.
cÚ£rv©iveResize
(
n
);

188 
PRINT_MAT2
("Q",
eye
(
n
));

189 
PRINT_MAT2
("PT",
eye
(
n
));

190 
PRINT_VEC2
("®pha",
®pha
);

191 
PRINT_VEC2
("b‘a",
b‘a
);

193 
m©
 
	gT
=
dŸg
(
®pha
);

194 
	gi
=0; i<
	gn
-1; i++)

195 
£t_v®
(
T
, 
i
, i+1, 
b‘a
(i));

196 
PRINT_MAT2
("T", 
T
);

197 
m©
 
	ga
,
	gPT
;

198 
svd
(
T
, 
a
, 
PT
, 
b
);

199 
PRINT_MAT2
("Q", 
a
);

200 
	g®pha
=
b
.
Œª¥o£
();

201 
PRINT_MAT2
("®pha", 
®pha
);

202 
	gt
=0;< 
	gn
-1;++)

203 
b‘a
(
t
) = 0;

204 
PRINT_VEC2
("b‘a",
b‘a
);

205 
PRINT_MAT2
("PT", 
PT
.
Œª¥o£
());

208 
	gkk
 = 0;

209 
	gi
=
ncÚv
; i < 
	gnv
; i++){

210 
	gj
 = 
i
-
ncÚv
;

211 
PRINT_INT
(
j
);

212 
sigma
(
i
èğ
®pha
(
j
);

213 
PRINT_NAMED_DBL
("svd->sigma[i]", 
sigma
(
i
));

214 
PRINT_NAMED_DBL
("Q[j*n+n-1]",
a
(
n
-1,
j
));

215 
PRINT_NAMED_DBL
("b‘a[n-1]",
b‘a
(
n
-1));

216 
”»¡
(
i
èğ
abs
(
a
(
n
-1,
j
)*
b‘a
(n-1));

217 
PRINT_NAMED_DBL
("svd->”»¡[i]", 
”»¡
(
i
));

218 ià(
®pha
(
j
è> 
	gtŞ
){

219 
”»¡
(
i
èğ”»¡(iè/ 
®pha
(
j
);

220 
PRINT_NAMED_DBL
("svd->”»¡[i]", 
”»¡
(
i
));

222 ià(
”»¡
(
i
è< 
	gtŞ
){

223 
	gkk
 = 
kk
+1;

224 
PRINT_NAMED_INT
("k",
kk
);

228 ià(
	gncÚv
 +
	gkk
 >ğ
nsv
){

229 
´štf
("set statusool\n");

230 
	gfšished
 = 
Œue
;

233 
PRINT_NAMED_INT
("k",
kk
);

236 
vec
 
	gv
;

237 ià(!
	gfšished
){

238 
vec
 
	gswÜk
=
g‘_cŞ
(
PT
,
kk
);

239 
PRINT_MAT2
("swÜk", 
swÜk
);

240 
	gv
 = 
z”os
(
size
(
A
,1));

241 
	g‰t
=
ncÚv
;‰ < 
	gncÚv
+
	gn
;tt++){

242 
	gv
 = 
v
+
swÜk
(
‰t
-
ncÚv
)*(
V
[‰t].
to_vec
());

244 
PRINT_VEC2
("svd->V",
V
[
ncÚv
]);

245 
PRINT_VEC2
("v[0]",
v
);

250 ià(
	gkk
 > 0){

251 
PRINT_VEC2
("svd->V", 
V
[
ncÚv
]);

252 
m©
 
	gtmp
ğ
V
.
g‘_cŞs
(
ncÚv
,ncÚv+
n
)*
	gPT
;

253 
	gV
.
£t_cŞs
(
ncÚv
,‚cÚv+
kk
, 
g‘_cŞs
(
tmp
, 0, kk));

254 
PRINT_VEC2
("svd->V", 
V
[
ncÚv
]);

255 
PRINT_VEC2
("svd->U", 
U
[
ncÚv
]);

256 
	gtmp
ğ
U
.
g‘_cŞs
(
ncÚv
,‚cÚv+
n
)*
	ga
;

257 
	gU
.
£t_cŞs
(
ncÚv
,‚cÚv+
kk
,
g‘_cŞs
(
tmp
,0,kk));

258 
PRINT_VEC2
("svd->U", 
U
[
ncÚv
]);

261 
	gncÚv
=
ncÚv
+
kk
;

262 ià(
	gfšished
)

265 
	gV
[
ncÚv
]=
v
;

266 
PRINT_VEC2
("svd->V", 
V
[
ncÚv
]);

267 
PRINT_NAMED_INT
("svd->ncÚv", 
ncÚv
);

269 
	g™s
++;

270 
PRINT_NAMED_INT
("svd->™s", 
™s
);

271 
PRINT_NAMED_INT
("svd->ncÚv", 
ncÚv
);

275 
PRINT_NAMED_INT
("nv",
nv
);

279 
´štf
(" Numb” oàcompu‹d signuÏ¸v®ue %d",
ncÚv
);

280 
´štf
("\n");

281 
Di¡Vec
 
nÜm»t
(
šfo
, 
ncÚv
, 
çl£
, "normret");

282 
Di¡Vec
 
nÜm»t_Œªpo£
(
šfo
, 
ncÚv
, 
Œue
, "normret_tranpose");

283 
	gi
=0; i < 
	gncÚv
; i++){

284 
	gnÜm»t
 = 
V
[
i
]*
A
.
_Œª¥o£
(è-
U
[i]*
sigma
(i);

285 
	gn1
 = 
nÜm
(
nÜm»t
).
toDoubË
();

286 
PRINT_DBL
(
n1
);

287 
	gnÜm»t_Œªpo£
 = 
U
[
i
]*
A
 -
V
[i]*
sigma
(i);

288 
	gn2
 = 
nÜm
(
nÜm»t_Œªpo£
).
toDoubË
();

289 
PRINT_DBL
(
n2
);

290 
	g”r
=
sq¹
(
n1
*n1+
n2
*n2);

291 
PRINT_DBL
(
”r
);

292 
PRINT_DBL
(
tŞ
);

293 ià(
sigma
(
i
)>
	gtŞ
){

294 
	g”r
 = 
”r
/
sigma
(
i
);

296 
PRINT_DBL
(
”r
);

297 
PRINT_DBL
(
sigma
(
i
));

298 
´štf
("SšguÏ¸v®u%d \t%13.6g\tE¼Üƒ¡im©e: %13.6g\n", 
i
, 
sigma
(i),
”r
);

301 ià(
	g§ve_veùÜs
){

302 
	g¡d
::
cout
<<"GošgØ§vouuˆveùÜ U‡nd V" << 
¡d
::
’dl
;

303 ià(
	gncÚv
 == 0)

304 
log¡»am
(
LOG_FATAL
)<<"NØcÚv”ged veùÜs. AbÜtšgh§vİ”©iÚ" << 
¡d
::
’dl
;

305 
	gouut_f’ame
[256];

306 
	gi
=0; i< 
	gncÚv
; i++){

307 
¥rštf
(
ouut_f’ame
, "%s.U.%d", 
Œaššg
.
c_¡r
(), 
i
);

308 
wr™e_ouut_veùÜ
(
ouut_f’ame
, 
U
[
i
].
to_vec
(), 
çl£
, "GraphLab v2 SVD output. This file containsƒigenvector‚umber i ofhe matrix U");

309 
¥rštf
(
ouut_f’ame
, "%s.V.%d", 
Œaššg
.
c_¡r
(), 
i
);

310 
wr™e_ouut_veùÜ
(
ouut_f’ame
, 
V
[
i
].
to_vec
(), 
çl£
, "GraphLab v2 SVD output. This file containsƒigenvector‚umber i ofhe matrix V'");

313  
	gsigma
;

316 
	$maš
(
¬gc
, cÚ¡ *
¬gv
[]) {

318 
	`´št_cİyright
();

321 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

325 
¡d
::
¡ršg
 
vecfe
;

327 
vecfe
 = 
	`g‘_İtiÚ_¡ršg
("initial_vector", "");

328 
debug
 = 
	`g‘_İtiÚ_št
("debug", 0);

329 
Ütho_»³©s
 = 
	`g‘_İtiÚ_št
("ortho_repeats", 3);

330 
nv
 = 
	`g‘_İtiÚ_št
("nv", 1);

331 
nsv
 = 
	`g‘_İtiÚ_št
("nsv", 1);

332 
tŞ
 = 
	`g‘_İtiÚ_æßt
("tol", 1e-5);

333 
§ve_veùÜs
 = 
	`g‘_İtiÚ_št
("save_vectors", 1);

334 
šput_cŞs
 = 
	`g‘_İtiÚ_št
("input_cols", 3);

335 
max_™”
 = 
	`g‘_İtiÚ_št
("max_iter", max_iter);

337 
	`·r£_commªd_lše_¬gs
();

338 
	`·r£_im¶ic™_commªd_lše
();

340 ià(
nv
 < 
nsv
){

341 
	`log¡»am
(
LOG_FATAL
)<<"PËa£ s‘hnumb” oàveùÜ --nv=XX,Øb©†—¡hnumb” oàsuµÜˆveùÜ --nsv=XX o¸Ïrg”" << 
¡d
::
’dl
;

346 ià(
un™‹¡
 == 1){

347 
Œaššg
 = "gklanczos_testA";

348 
vecfe
 = "gklanczos_testA_v0";

349 
nsv
 = 3; 
nv
 = 3;

350 
debug
 = 
Œue
;

353 ià(
un™‹¡
 == 2){

354 
Œaššg
 = "gklanczos_testB";

355 
vecfe
 = "gklanczos_testB_v0";

356 
nsv
 = 10; 
nv
 = 10;

357 
debug
 = 
Œue
; 
max_™”
 = 100;

360 ià(
un™‹¡
 == 3){

361 
Œaššg
 = "gklanczos_testC";

362 
vecfe
 = "gklanczos_testC_v0";

363 
nsv
 = 4; 
nv
 = 10;

364 
debug
 = 
Œue
; 
max_™”
 = 100;

368 
¡d
::
cout
 << "Lßd m©rix " << 
Œaššg
 << std::
’dl
;

370 ià(
šput_cŞs
 == 3)

371 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
edge_d©a
>(
Œaššg
);

372 ià(
šput_cŞs
 == 4)

373 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘4
<
edge_d©a
>(
Œaššg
);

374 
	`log¡»am
(
LOG_FATAL
)<<"--šput_cŞs=XX should be™h” 3 o¸4 iÅuˆcŞumns" << 
¡d
::
’dl
;

377 
šfo
.
rows
 = 
M
; info.
cŞs
 = 
N
; info.
nÚz”os
 = 
L
;

378 
	`as£¹
(
šfo
.
rows
 > 0 && info.
cŞs
 > 0 && info.
nÚz”os
 > 0);

380 
tim”
 
mytim”
; mytim”.
	`¡¬t
();

381 
	`š™_Ïnczos
(
šfo
);

382 
	`š™_m©h
(
šfo
, 
Ütho_»³©s
);

385 ià(
vecfe
.
	`size
() > 0){

386 
¡d
::
cout
 << "Lßd in™® veùÜ from fe" << 
vecfe
 << std::
’dl
;

387 
	`lßd_m©rix_m¬k‘_veùÜ
(
vecfe
, 
šfo
, 0, 
Œue
, 
çl£
);

391 #´agm¨
omp
 
·¿Î–
 

392 
i
=0; i< ()
M
; i++)

393 
Ï‹Á_çùÜs_šmem
[
i
].
pvec
[0] = 
	`d¿nd48
();

396 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

397 
	`£t_’gše_æags
(
’gše
);

398 
³ngše
 = &
’gše
;

400 
vec
 
”»¡
;

401 
vec
 
sšguÏr_v®ues
 = 
	`Ïnczos
(
šfo
, 
mytim”
, 
”»¡
, 
vecfe
);

403 
¡d
::
cout
 << "Lªczo fšished " << 
mytim”
.
	`cu¼’t_time
(è<< std::
’dl
;

405 
	`wr™e_ouut_veùÜ
(
Œaššg
 + ".sšguÏr_v®ues", 
sšguÏr_v®ues
,
çl£
, "%GraphLab SVD Solver†ibrary. This file containshe singular values.");

407 ià(
un™‹¡
 == 1){

408 
	`as£¹
(
”»¡
.
	`size
() == 3);

409 
i
=0; i< 
”»¡
.
	`size
(); i++)

410 
	`as£¹
(
”»¡
[
i
] < 1e-30);

412 ià(
un™‹¡
 == 2){

413 
	`as£¹
(
”»¡
.
	`size
() == 10);

414 
i
=0; i< 
”»¡
.
	`size
(); i++)

415 
	`as£¹
(
”»¡
[
i
] < 1e-15);

419 ià(!
qu›t
)

420 
	`m‘rics_»pÜt
(
m
);

423 
	}
}

	@toolkits/collaborative_filtering/svd_onesided.cpp

24 
	~"commÚ.hµ
"

25 
	~"ty³s.hµ
"

26 
	~"eig’_w¿µ”.hµ
"

27 
	~"tim”.hµ
"

29 
usšg
 
Çme¥aû
 
	g¡d
;

32 
	gšput_cŞs
 = 3;

35 
m‘rics
 
m
("svd-onesided-inmemory-factors");

36 
	gnsh¬ds
;

38 
	sv”‹x_d©a
 {

39 
vec
 
	mpvec
;

40 
	mv®ue
;

41 
	mA_ii
;

42 
v”‹x_d©a
(){ 
	mv®ue
 = 0; 
	mA_ii
 = 1; }

45 
£t_v®
(
v®ue
, 
f›ld_ty³
) {

46 
	mpvec
[
f›ld_ty³
] = 
v®ue
;

51 
	sedge_d©a
 {

52 
	mweight
;

53 
edge_d©a
(
weight
 = 0) : weight(weight) { }

54 
edge_d©a
(
weight
, 
ignÜed
) : weight(weight) { }

65 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

66 
edge_d©a
 
	tEdgeD©aTy³
;

68 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

69 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

72 
	~"io.hµ
"

86 
	gmax_™”
 = 10;

87 
boŞ
 
	gno_edge_d©a
 = 
çl£
;

88 
	gaùu®_veùÜ_Ën
;

89 
	gnv
 = 0;

90 
	gnsv
 = 0;

91 
	gtŞ
 = 1e-8;

92 
boŞ
 
	gfšished
 = 
çl£
;

93 
	gÜtho_»³©s
 = 3;

94 
boŞ
 
	g§ve_veùÜs
 = 
çl£
;

95 
	g¡d
::
¡ršg
 
fÜm©
 = "matrixmarket";

96 
	gnodes
 = 0;

98 
	gd©a_size
 = 
max_™”
;

99 
	~"m©h.hµ
"

100 
	~"´štouts.hµ
"

105 
	$š™_Ïnczos
(
b¬t™e_g¿ph_desütÜ
 & 
šfo
){

106 
	`¤ªd48
(
	`time
(
NULL
));

107 
Ï‹Á_çùÜs_šmem
.
	`»size
(
šfo
.
	`tÙ®
());

108 
d©a_size
 = 
nsv
 + 
nv
+1 + 
max_™”
;

109 
aùu®_veùÜ_Ën
 = 
d©a_size
;

110 ià(
šfo
.
	`is_squ¬e
())

111 
aùu®_veùÜ_Ën
 = 
d©a_size
 + 3;

112 #´agm¨
omp
 
·¿Î–
 

113 
i
=0; i< 
šfo
.
	`tÙ®
(); i++){

114 ià(
i
 < 
šfo
.
	`g‘_¡¬t_node
(
çl£
è|| info.
	`is_squ¬e
())

115 
Ï‹Á_çùÜs_šmem
[
i
].
pvec
 = 
	`z”os
(
aùu®_veùÜ_Ën
);

116 
Ï‹Á_çùÜs_šmem
[
i
].
pvec
 = 
	`z”os
(3);

118 
	`log¡»am
(
LOG_INFO
)<<"Allocated‡otal of: " <<

119 (()(
d©a_size
 * 
šfo
.
	`num_nodes
(
Œue
è+3.0*šfo.num_nodes(
çl£
)è* ()/ 1e6è<< " MB fÜ stÜšg veùÜs." << "„ows: " << info.num_nodesÑrueè<< 
¡d
::
’dl
;

120 
	}
}

122 
vec
 
Úe_sided_Ïnczos
Ğ
b¬t™e_g¿ph_desütÜ
 & 
šfo
, 
tim”
 & 
mytim”
, veø& 
”»¡
,

123 cÚ¡ 
¡d
::
¡ršg
 & 
vecfe
){

126 
ncÚv
 = 0;

127 
	g™s
 = 1;

128 
Di¡M©
 
A
(
šfo
);

129 
	gÙh”_size_off£t
 = 
šfo
.
is_squ¬e
(è? 
d©a_size
 : 0;

130 
Di¡SliûdM©
 
U
(
Ùh”_size_off£t
, oth”_size_off£ˆ+ 3, 
Œue
, 
šfo
, "U");

131 
Di¡SliûdM©
 
V
(0, 
d©a_size
, 
çl£
, 
šfo
, "V");

132 
Di¡Vec
 
v
(
šfo
, 1, 
çl£
, "v");

133 
Di¡Vec
 
u
(
šfo
, 
Ùh”_size_off£t
+ 0, 
Œue
, "u");

134 
Di¡Vec
 
u_1
(
šfo
, 
Ùh”_size_off£t
+ 1, 
Œue
, "u_1");

135 
Di¡Vec
 
tmp
(
šfo
, 
Ùh”_size_off£t
 + 2, 
Œue
, "tmp");

136 
vec
 
	g®pha
, 
	gb‘a
, 
	gb
;

137 
vec
 
	gsigma
 = 
z”os
(
d©a_size
);

138 
	g”»¡
 = 
z”os
(
nv
);

139 
Di¡Vec
 
v_0
(
šfo
, 0, 
çl£
, "v_0");

140 ià(
	gvecfe
.
size
() == 0)

141 
v_0
 = 
¿ndu
(
size
(
A
,2));

142 
PRINT_VEC2
("svd->V", 
v_0
);

144 
Di¡DoubË
 
	gvnÜm
 = 
nÜm
(
v_0
);

145 
	gv_0
=
v_0
/
vnÜm
;

146 
PRINT_INT
(
nv
);

148 
	gncÚv
 < 
	gnsv
 && 
	g™s
 < 
	gmax_™”
){

149 
	g¡d
::
cout
<<"S¹šg i‹¿tiÚ: " << 
™s
 << "‡ˆtime: " << 
mytim”
.
cu¼’t_time
(è<< 
¡d
::
’dl
;

150 
	gk
 = 
ncÚv
;

151 
	gn
 = 
nv
;

152 
PRINT_INT
(
k
);

153 
PRINT_INT
(
n
);

154 
PRINT_VEC2
("v", 
v
);

155 
PRINT_VEC2
("u", 
u
);

157 
	g®pha
 = 
z”os
(
n
);

158 
	gb‘a
 = 
z”os
(
n
);

160 
	gu
 = 
V
[
k
]*
A
.
_Œª¥o£
();

161 
PRINT_VEC2
("u",
u
);

163 
	gi
=
k
+1; i<
	gn
; i++){

164 
	g¡d
::
cout
 <<"S¹šg s‹p: " << 
i
 << "‡ˆtime: " << 
mytim”
.
cu¼’t_time
(è<< 
¡d
::
’dl
;

165 
PRINT_INT
(
i
);

167 
	gV
[
i
]=
u
*
A
;

168 
	ga
 = 
nÜm
(
u
).
toDoubË
();

169 
	gu
 = 
u
 / 
a
;

170 
muÉly
(
V
, 
i
, 
a
);

171 
PRINT_DBL
(
a
);

173 
	gb
;

174 
ÜthogÚ®ize_vs_®l
(
V
, 
i
, 
b
);

175 
PRINT_DBL
(
b
);

176 
	gu_1
 = 
V
[
i
]*
A
.
_Œª¥o£
();

177 
	gu_1
 = 
u_1
 - 
u
*
b
;

178 
®pha
(
i
-
k
-1èğ
a
;

179 
b‘a
(
i
-
k
-1èğ
b
;

180 
PRINT_VEC3
("®pha", 
®pha
, 
i
-
k
-1);

181 
PRINT_VEC3
("b‘a", 
b‘a
, 
i
-
k
-1);

182 
	gtmp
 = 
u
;

183 
	gu
 = 
u_1
;

184 
	gu_1
 = 
tmp
;

187 
	gV
[
n
]ğ
u
*
A
;

188 
	ga
 = 
nÜm
(
u
).
toDoubË
();

189 
PRINT_DBL
(
a
);

190 
	gu
 = 
u
/
a
;

191 
	gb
;

192 
muÉly
(
V
, 
n
, 
a
);

193 
ÜthogÚ®ize_vs_®l
(
V
, 
n
, 
b
);

194 
®pha
(
n
-
k
-1)ğ
a
;

195 
b‘a
(
n
-
k
-1èğ
b
;

196 
PRINT_VEC3
("®pha", 
®pha
, 
n
-
k
-1);

197 
PRINT_VEC3
("b‘a", 
b‘a
, 
n
-
k
-1);

200 
PRINT_INT
(
nv
);

201 
PRINT_NAMED_INT
("svd->ncÚv", 
ncÚv
);

202 
	gn
 = 
nv
 - 
ncÚv
;

203 
PRINT_INT
(
n
);

204 
	g®pha
.
cÚ£rv©iveResize
(
n
);

205 
	gb‘a
.
cÚ£rv©iveResize
(
n
);

207 
PRINT_MAT2
("Q",
eye
(
n
));

208 
PRINT_MAT2
("PT",
eye
(
n
));

209 
PRINT_VEC2
("®pha",
®pha
);

210 
PRINT_VEC2
("b‘a",
b‘a
);

212 
m©
 
	gT
=
dŸg
(
®pha
);

213 
	gi
=0; i<
	gn
-1; i++)

214 
£t_v®
(
T
, 
i
, i+1, 
b‘a
(i));

215 
PRINT_MAT2
("T", 
T
);

216 
m©
 
	g¯
,
	gPT
;

217 
vec
 
	gbb
;

218 
svd
(
T
, 
¯
, 
PT
, 
bb
);

219 
PRINT_MAT2
("Q", 
¯
);

220 
	g®pha
=
bb
.
Œª¥o£
();

221 
PRINT_MAT2
("®pha", 
®pha
);

222 
	gt
=0;< 
	gn
-1;++)

223 
b‘a
(
t
) = 0;

224 
PRINT_VEC2
("b‘a",
b‘a
);

225 
PRINT_MAT2
("PT", 
PT
.
Œª¥o£
());

228 
	gkk
 = 0;

229 
	gi
=
ncÚv
; i < 
	gnv
; i++){

230 
	gj
 = 
i
-
ncÚv
;

231 
PRINT_INT
(
j
);

232 
sigma
(
i
èğ
®pha
(
j
);

233 
PRINT_NAMED_DBL
("svd->sigma[i]", 
sigma
(
i
));

234 
PRINT_NAMED_DBL
("Q[j*n+n-1]",
¯
(
n
-1,
j
));

235 
PRINT_NAMED_DBL
("b‘a[n-1]",
b‘a
(
n
-1));

236 
”»¡
(
i
èğ
abs
(
¯
(
n
-1,
j
)*
b‘a
(n-1));

237 
PRINT_NAMED_DBL
("svd->”»¡[i]", 
”»¡
(
i
));

238 ià(
®pha
(
j
è> 
	gtŞ
){

239 
”»¡
(
i
èğ”»¡(iè/ 
®pha
(
j
);

240 
PRINT_NAMED_DBL
("svd->”»¡[i]", 
”»¡
(
i
));

242 ià(
”»¡
(
i
è< 
	gtŞ
){

243 
	gkk
 = 
kk
+1;

244 
PRINT_NAMED_INT
("k",
kk
);

248 ià(
	gncÚv
 +
	gkk
 >ğ
nsv
){

249 
´štf
("set statusool\n");

250 
	gfšished
 = 
Œue
;

253 
PRINT_NAMED_INT
("k",
kk
);

256 
vec
 
	gv
;

257 ià(!
	gfšished
){

258 
vec
 
	gswÜk
=
g‘_cŞ
(
PT
,
kk
);

259 
PRINT_MAT2
("swÜk", 
swÜk
);

260 
	gv
 = 
z”os
(
size
(
A
,1));

261 
	g‰t
=
ncÚv
;‰ < 
	gncÚv
+
	gn
;tt++){

262 
	gv
 = 
v
+
swÜk
(
‰t
-
ncÚv
)*(
V
[‰t].
to_vec
());

264 
PRINT_VEC2
("svd->V",
V
[
ncÚv
]);

265 
PRINT_VEC2
("v[0]",
v
);

270 ià(
	gkk
 > 0){

271 
PRINT_VEC2
("svd->V", 
V
[
ncÚv
]);

272 
m©
 
	gtmp
ğ
V
.
g‘_cŞs
(
ncÚv
,ncÚv+
n
)*
	gPT
;

273 
	gV
.
£t_cŞs
(
ncÚv
,‚cÚv+
kk
, 
g‘_cŞs
(
tmp
, 0, kk));

274 
PRINT_VEC2
("svd->V", 
V
[
ncÚv
]);

277 
	gncÚv
=
ncÚv
+
kk
;

278 ià(
	gfšished
)

281 
	gV
[
ncÚv
]=
v
;

282 
PRINT_VEC2
("svd->V", 
V
[
ncÚv
]);

283 
PRINT_NAMED_INT
("svd->ncÚv", 
ncÚv
);

285 
	g™s
++;

286 
PRINT_NAMED_INT
("svd->™s", 
™s
);

287 
PRINT_NAMED_INT
("svd->ncÚv", 
ncÚv
);

291 
PRINT_NAMED_INT
("nv",
nv
);

295 
´štf
(" Numb” oàcompu‹d signuÏ¸v®ue %d",
ncÚv
);

296 
´štf
("\n");

297 
Di¡Vec
 
nÜm»t
(
šfo
, 
Ùh”_size_off£t
 + 1, 
Œue
, "normret");

298 
Di¡Vec
 
nÜm»t_Œªpo£
(
šfo
, 
ncÚv
, 
çl£
, "normret_tranpose");

299 
	gi
=0; i < 
	gncÚv
; i++){

300 
	gu
 = 
V
[
i
]*
A
.
_Œª¥o£
();

301 
	ga
 = 
nÜm
(
u
).
toDoubË
();

302 
	gu
 = 
u
 / 
a
;

303 ià(
	g§ve_veùÜs
){

304 
	gouut_f’ame
[256];

305 
¥rštf
(
ouut_f’ame
, "%s.U.%d", 
Œaššg
.
c_¡r
(), 
i
);

306 
wr™e_ouut_veùÜ
(
ouut_f’ame
, 
u
.
to_vec
(), 
çl£
, "GraphLab v2 SVD output. This file containsƒigenvector‚umber i ofhe matrix U");

308 
	gnÜm»t
 = 
V
[
i
]*
A
.
_Œª¥o£
(è- 
u
*
sigma
(i);

309 
	gn1
 = 
nÜm
(
nÜm»t
).
toDoubË
();

310 
PRINT_DBL
(
n1
);

311 
	gnÜm»t_Œªpo£
 = 
u
*
A
 -
V
[
i
]*
sigma
(i);

312 
	gn2
 = 
nÜm
(
nÜm»t_Œªpo£
).
toDoubË
();

313 
PRINT_DBL
(
n2
);

314 
	g”r
=
sq¹
(
n1
*n1+
n2
*n2);

315 
PRINT_DBL
(
”r
);

316 
PRINT_DBL
(
tŞ
);

317 ià(
sigma
(
i
)>
	gtŞ
){

318 
	g”r
 = 
”r
/
sigma
(
i
);

320 
PRINT_DBL
(
”r
);

321 
PRINT_DBL
(
sigma
(
i
));

322 
´štf
("SšguÏ¸v®u%d \t%13.6g\tE¼Üƒ¡im©e: %13.6g\n", 
i
, 
sigma
(i),
”r
);

325 ià(
	g§ve_veùÜs
){

326 ià(
	gncÚv
 == 0)

327 
log¡»am
(
LOG_FATAL
)<<"NØcÚv”ged veùÜs. AbÜtšgh§vİ”©iÚ" << 
¡d
::
’dl
;

328 
	gouut_f’ame
[256];

329 
	gi
=0; i< 
	gncÚv
; i++){

330 
¥rštf
(
ouut_f’ame
, "%s.V.%d", 
Œaššg
.
c_¡r
(), 
i
);

331 
wr™e_ouut_veùÜ
(
ouut_f’ame
, 
V
[
i
].
to_vec
(), 
çl£
, "GraphLab v2 SVD output. This file containsƒigenvector‚umber i ofhe matrix V'");

334  
	gsigma
;

337 
	$maš
(
¬gc
, cÚ¡ *
¬gv
[]) {

339 
	`´št_cİyright
();

342 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

344 
¡d
::
¡ršg
 
vecfe
;

345 
vecfe
 = 
	`g‘_İtiÚ_¡ršg
("initial_vector", "");

346 
debug
 = 
	`g‘_İtiÚ_št
("debug", 0);

347 
Ütho_»³©s
 = 
	`g‘_İtiÚ_št
("ortho_repeats", 3);

348 
nv
 = 
	`g‘_İtiÚ_št
("nv", 1);

349 
nsv
 = 
	`g‘_İtiÚ_št
("nsv", 1);

350 
tŞ
 = 
	`g‘_İtiÚ_æßt
("tol", 1e-5);

351 
§ve_veùÜs
 = 
	`g‘_İtiÚ_št
("save_vectors", 1);

352 
šput_cŞs
 = 
	`g‘_İtiÚ_št
("input_cols", 3);

353 
max_™”
 = 
	`g‘_İtiÚ_št
("max_iter", max_iter);

355 
	`·r£_commªd_lše_¬gs
();

356 
	`·r£_im¶ic™_commªd_lše
();

358 ià(
nv
 < 
nsv
){

359 
	`log¡»am
(
LOG_FATAL
)<<"PËa£ s‘hnumb” oàveùÜ --nv=XX,Øbg»©”hªhnumb” oàsuµÜˆveùÜ --nsv=XX " << 
¡d
::
’dl
;

365 ià(
un™‹¡
 == 1){

366 
Œaššg
 = "gklanczos_testA";

367 
vecfe
 = "gklanczos_testA_v0";

368 
nsv
 = 3; 
nv
 = 3;

369 
debug
 = 
Œue
;

372 ià(
un™‹¡
 == 2){

373 
Œaššg
 = "gklanczos_testB";

374 
vecfe
 = "gklanczos_testB_v0";

375 
nsv
 = 10; 
nv
 = 10;

376 
debug
 = 
Œue
; 
max_™”
 = 100;

379 ià(
un™‹¡
 == 3){

380 
Œaššg
 = "gklanczos_testC";

381 
vecfe
 = "gklanczos_testC_v0";

382 
nsv
 = 25; 
nv
 = 25;

383 
debug
 = 
Œue
; 
max_™”
 = 100;

387 
¡d
::
cout
 << "Lßd m©rix " << 
Œaššg
 << std::
’dl
;

389 ià(
šput_cŞs
 == 3)

390 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
edge_d©a
>(
Œaššg
);

391 ià(
šput_cŞs
 == 4)

392 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘4
<
edge_d©a
>(
Œaššg
);

393 
	`log¡»am
(
LOG_FATAL
)<<"--šput_cŞs=XX should be™h” 3 o¸4 iÅuˆcŞumns" << 
¡d
::
’dl
;

395 
šfo
.
rows
 = 
M
; info.
cŞs
 = 
N
; info.
nÚz”os
 = 
L
;

396 
	`as£¹
(
šfo
.
rows
 > 0 && info.
cŞs
 > 0 && info.
nÚz”os
 > 0);

398 
tim”
 
mytim”
; mytim”.
	`¡¬t
();

399 
	`š™_Ïnczos
(
šfo
);

400 
	`š™_m©h
(
šfo
, 
Ütho_»³©s
);

403 ià(
vecfe
.
	`size
() > 0){

404 
¡d
::
cout
 << "Lßd in™® veùÜ from fe" << 
vecfe
 << std::
’dl
;

405 
	`lßd_m©rix_m¬k‘_veùÜ
(
vecfe
, 
šfo
, 0, 
Œue
, 
çl£
);

409 #´agm¨
omp
 
·¿Î–
 

410 
i
=0; i< ()
M
; i++)

411 
Ï‹Á_çùÜs_šmem
[
i
].
pvec
[0] = 
	`d¿nd48
();

414 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

415 
	`£t_’gše_æags
(
’gše
);

416 
³ngše
 = &
’gše
;

418 
vec
 
”»¡
;

419 
vec
 
sšguÏr_v®ues
 = 
	`Úe_sided_Ïnczos
(
šfo
, 
mytim”
, 
”»¡
, 
vecfe
);

421 
¡d
::
cout
 << "Lªczo fšished iÀ" << 
mytim”
.
	`cu¼’t_time
(è<< std::
’dl
;

423 
	`wr™e_ouut_veùÜ
(
Œaššg
 + ".sšguÏr_v®ues", 
sšguÏr_v®ues
,
çl£
, "%GraphLab SVD Solver†ibrary. This file containshe singular values.");

425 ià(
un™‹¡
 == 1){

426 
	`as£¹
(
”»¡
.
	`size
() == 3);

427 
i
=0; i< 
”»¡
.
	`size
(); i++)

428 
	`as£¹
(
”»¡
[
i
] < 1e-30);

430 ià(
un™‹¡
 == 2){

431 
	`as£¹
(
”»¡
.
	`size
() == 10);

432 
i
=0; i< 
”»¡
.
	`size
(); i++)

433 
	`as£¹
(
”»¡
[
i
] < 1e-15);

437 ià(!
qu›t
)

438 
	`m‘rics_»pÜt
(
m
);

440 
	}
}

	@toolkits/collaborative_filtering/svdpp.cpp

32 
	~"commÚ.hµ
"

33 
	~"eig’_w¿µ”.hµ
"

35 
	ssvdµ_·¿ms
{

36 
	m™mBŸsS‹p
;

37 
	m™mBŸsReg
;

38 
	mu¤BŸsS‹p
;

39 
	mu¤BŸsReg
;

40 
	mu¤FùrS‹p
;

41 
	mu¤FùrReg
;

42 
	m™mFùrS‹p
;

43 
	m™mFùrReg
;

44 
	m™mFùr2S‹p
;

45 
	m™mFùr2Reg
;

46 
	m¡•_dec
;

48 
svdµ_·¿ms
(){

49 
	m™mBŸsS‹p
 = 1e-4f;

50 
	m™mBŸsReg
 = 1e-4f;

51 
	mu¤BŸsS‹p
 = 1e-4f;

52 
	mu¤BŸsReg
 = 2e-4f;

53 
	mu¤FùrS‹p
 = 1e-4f;

54 
	mu¤FùrReg
 = 2e-4f;

55 
	m™mFùrS‹p
 = 1e-4f;

56 
	m™mFùrReg
 = 1e-4f;

57 
	m™mFùr2S‹p
 = 1e-4f;

58 
	m™mFùr2Reg
 = 1e-4f;

59 
	m¡•_dec
 = 0.9;

63 
svdµ_·¿ms
 
	gsvdµ
;

64 
	#BIAS_POS
 -1

	)

66 
	sv”‹x_d©a
 {

67 
vec
 
	mpvec
;

68 
vec
 
	mweight
;

69 
	mbŸs
;

71 
v”‹x_d©a
() {

72 
	mpvec
 = 
z”os
(
D
);

73 
	mweight
 = 
z”os
(
D
);

74 
	mbŸs
 = 0;

76 
£t_v®
(
šdex
, 
v®
){

77 ià(
	mšdex
 =ğ
BIAS_POS
)

78 
bŸs
 = 
v®
;

79 ià(
	mšdex
 < 
	mD
)

80 
	mpvec
[
šdex
] = 
v®
;

81 
	mweight
[
šdex
-
D
] = 
v®
;

83 
g‘_v®
(
šdex
){

84 ià(
	mšdex
=ğ
BIAS_POS
)

85  
bŸs
;

86 ià(
	mšdex
 < 
	mD
)

87  
	mpvec
[
šdex
];

88  
	mweight
[
šdex
-
D
];

98 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

99 
	tEdgeD©aTy³
;

101 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

102 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	gpv®id©iÚ_’gše
 = 
NULL
;

103 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

105 
	~"io.hµ
"

106 
	~"rm£.hµ
"

107 
	~"rm£_’gše.hµ
"

110 
	$svdµ_´ediù
(cÚ¡ 
v”‹x_d©a
& 
u£r
, cÚ¡ v”‹x_d©a& 
mov›
, cÚ¡ 
¿tšg
, & 
´ediùiÚ
, * 
exŒa
 = 
NULL
){

112 
´ediùiÚ
 = 
glob®M—n
;

114 
´ediùiÚ
 +ğ
u£r
.
bŸs
 + 
mov›
.bias;

117 
j
=0; j< 
D
; j++)

118 
´ediùiÚ
 +ğ
mov›
.
pvec
[
j
] * (
u£r
.pvec[j] + u£r.
weight
[j]);

120 
´ediùiÚ
 = 
¡d
::
	`mš
((í»diùiÚ, 
maxv®
);

121 
´ediùiÚ
 = 
¡d
::
	`max
((í»diùiÚ, 
mšv®
);

122 
”r
 = 
¿tšg
 - 
´ediùiÚ
;

123 ià(
¡d
::
	`i¢ª
(
”r
))

124 
	`log¡»am
(
LOG_FATAL
)<<"GÙ iÁØnum”iÿÈ”rÜs. TryØdeü—£ s‹°sizusšghcommªd†še: svdµ_u£r_bŸs_¡•, svdµ_™em_bŸs_¡•, svdµ_u£r_çùÜ2_¡•, svdµ_u£r_çùÜ_¡•, svdµ_™em_¡•" << 
¡d
::
’dl
;

125  
”r
*err;

126 
	}
}

133 
	gSVDPPV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

138 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

139 
»£t_rm£
(
gcÚ‹xt
.
exeùh»ads
);

146 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

147 
	gsvdµ
.
	g™mFùrS‹p
 *ğ
svdµ
.
¡•_dec
;

148 
	gsvdµ
.
	g™mFùr2S‹p
 *ğ
svdµ
.
¡•_dec
;

149 
	gsvdµ
.
	gu¤FùrS‹p
 *ğ
svdµ
.
¡•_dec
;

150 
	gsvdµ
.
	g™mBŸsS‹p
 *ğ
svdµ
.
¡•_dec
;

151 
	gsvdµ
.
	gu¤BŸsS‹p
 *ğ
svdµ
.
¡•_dec
;

153 
Œaššg_rm£
(
™”©iÚ
, 
gcÚ‹xt
);

154 
v®id©iÚ_rm£
(&
svdµ_´ediù
, 
gcÚ‹xt
);

160 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

161 iàĞ
	gv”‹x
.
num_ou‹dges
() > 0){

162 
	gv”‹x_d©a
 & 
	gu£r
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

164 
mem£t
(&
u£r
.
weight
[0], 0, ()*
D
);

165 
	ge
=0;ƒ < 
	gv”‹x
.
num_ou‹dges
();ƒ++) {

166 
	gv”‹x_d©a
 & 
	gmov›
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

167 
	gu£r
.
	gweight
 +ğ
mov›
.
weight
;

171 
	gu¤NÜm
 = (1.0/
sq¹
(
v”‹x
.
num_ou‹dges
()));

173 
	gu£r
.
	gweight
 *ğ
u¤NÜm
;

175 
vec
 
	g¡•
 = 
z”os
(
D
);

178 
	ge
=0;ƒ < 
	gv”‹x
.
num_ou‹dges
();ƒ++) {

179 
	gv”‹x_d©a
 & 
	gmov›
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

180 
	gob£rv©iÚ
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

181 
	ge¡ScÜe
;

182 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
svdµ_´ediù
(
u£r
, 
mov›
,
ob£rv©iÚ
, 
e¡ScÜe
);

184 
	g”r
 = 
ob£rv©iÚ
 - 
e¡ScÜe
;

185 
as£¹
(!
¡d
::
i¢ª
(
rm£_vec
[
omp_g‘_th»ad_num
()]));

186 
vec
 
	g™mFùr
 = 
mov›
.
pvec
;

187 
vec
 
	gu¤Fùr
 = 
u£r
.
pvec
;

190 
	gj
=0; j< 
	gD
; j++)

191 
	gmov›
.
	gpvec
[
j
] +ğ
svdµ
.
™mFùrS‹p
*(
”r
*(
u¤Fùr
[j] + 
u£r
.
weight
[j]è- svdµ.
™mFùrReg
*
™mFùr
[j]);

193 
	gj
=0; j< 
	gD
; j++)

194 
	gu£r
.
	gpvec
[
j
] +ğ
svdµ
.
u¤FùrS‹p
*(
”r
 *
™mFùr
[j] - svdµ.
u¤FùrReg
*
u¤Fùr
[j]);

195 
	g¡•
 +ğ
”r
*
™mFùr
;

198 
	gmov›
.
	gbŸs
 +ğ
svdµ
.
™mBŸsS‹p
*(
”r
-svdµ.
™mBŸsReg
* 
mov›
.
bŸs
);

200 
	gu£r
.
	gbŸs
 +ğ
svdµ
.
u¤BŸsS‹p
*(
”r
-svdµ.
u¤BŸsReg
* 
u£r
.
bŸs
);

203 
	g¡•
 *ğ(
svdµ
.
™mFùr2S‹p
*
u¤NÜm
);

205 
	gmuÉ
 = 
svdµ
.
™mFùr2S‹p
*svdµ.
™mFùr2Reg
;

206 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

207 
	gv”‹x_d©a
& 
	gmov›
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

209 
	gmov›
.
	gweight
 +ğ
¡•
 - 
muÉ
 * 
mov›
.
weight
;

220 
ouut_svdµ_»suÉ
(
¡d
::
¡ršg
 
f’ame
) {

221 
MMOuu‰”_m©
<
v”‹x_d©a
> 
u£r_ouut
(
f’ame
 + "_U.mm", 0, 
M
, "Thi fcÚš SVD++ ouuˆm©rix U. IÀ—ch„ow D faùÜ oà¨sšgË u£¸node. Th’‡dd™iÚ® D weighˆçùÜs.", 
Ï‹Á_çùÜs_šmem
, 2*
D
);

222 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
™em_ouut
(
f’ame
 + "_V.mm", 
M
 ,M+
N
, "Thi fcÚš SVD++ ouuˆm©rix V. IÀ—ch„ow D faùÜ oà¨sšgË i‹m‚ode.", 
Ï‹Á_çùÜs_šmem
);

223 
	gMMOuu‰”_vec
<
	gv”‹x_d©a
> 
bŸs_u£r_vec
(
f’ame
 + "_U_bŸs.mm", 0, 
M
, 
BIAS_POS
, "Thi fcÚš SVD++ ouuˆbŸ veùÜ. IÀ—ch„ow‡ sšgË u£¸bŸs.", 
Ï‹Á_çùÜs_šmem
);

224 
	gMMOuu‰”_vec
<
	gv”‹x_d©a
> 
bŸs_mov_vec
(
f’ame
 + "_V_bŸs.mm", 
M
, M+
N
, 
BIAS_POS
, "Thi fcÚš SVD++ ouuˆbŸ veùÜ. IÀ—ch„ow‡ sšgË i‹m bŸs.", 
Ï‹Á_çùÜs_šmem
);

225 
MMOuu‰”_sÿÏr
 
gm—n
(
f’ame
 + "_glob®_m—n.mm", "Thi fcÚš SVD++ glob® m—Àwhich i »quœed fÜ computšg…»diùiÚs.", 
glob®M—n
);

227 
log¡»am
(
LOG_INFO
è<< "SVDPP ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << "_U.mm" <<

228 ", " << 
	gf’ame
 + "_V.mm, " << f’am<< "_U_bŸs.mm, " << f’am<< "_V_bŸs.mm, " << f’am<< "_glob®_m—n.mm" << 
	g¡d
::
’dl
;

231 
	$svdµ_š™
(){

232 
	`¤ªd48
(
	`time
(
NULL
));

233 
Ï‹Á_çùÜs_šmem
.
	`»size
(
M
+
N
);

235 #´agm¨
omp
 
·¿Î–
 

236 
i
 = 0; i < ()(
M
+
N
); ++i){

237 
v”‹x_d©a
 & 
d©a
 = 
Ï‹Á_çùÜs_šmem
[
i
];

238 
d©a
.
pvec
 = 
	`z”os
(
D
);

239 ià(
i
 < ()
M
)

240 
d©a
.
weight
 = 
	`z”os
(
D
);

241 
j
=0; j<
D
; j++)

242 
Ï‹Á_çùÜs_šmem
[
i
].
pvec
[
j
] = 
	`d¿nd48
();

244 
	`log¡»am
(
LOG_INFO
è<< "SVD++ in™Ÿliz©iÚ ok" << 
¡d
::
’dl
;

246 
	}
}

248 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

250 
	`´št_cİyright
();

253 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

257 
m‘rics
 
	`m
("svdpp-inmemory-factors");

259 
svdµ
.
¡•_dec
 = 
	`g‘_İtiÚ_æßt
("svdpp_step_dec", 0.9);

260 
svdµ
.
™mBŸsS‹p
 = 
	`g‘_İtiÚ_æßt
("svdpp_item_bias_step", 1e-3);

261 
svdµ
.
™mBŸsReg
 = 
	`g‘_İtiÚ_æßt
("svdpp_item_bias_reg", 1e-3);

262 
svdµ
.
u¤BŸsS‹p
 = 
	`g‘_İtiÚ_æßt
("svdpp_user_bias_step", 1e-3);

263 
svdµ
.
u¤BŸsReg
 = 
	`g‘_İtiÚ_æßt
("svdpp_user_bias_reg", 1e-3);

264 
svdµ
.
u¤FùrS‹p
 = 
	`g‘_İtiÚ_æßt
("svdpp_user_factor_step", 1e-3);

265 
svdµ
.
u¤FùrReg
 = 
	`g‘_İtiÚ_æßt
("svdpp_user_factor_reg", 1e-3);

266 
svdµ
.
™mFùrReg
 = 
	`g‘_İtiÚ_æßt
("svdpp_item_factor_reg", 1e-3);

267 
svdµ
.
™mFùrS‹p
 = 
	`g‘_İtiÚ_æßt
("svdpp_item_factor_step", 1e-3);

268 
svdµ
.
™mFùr2Reg
 = 
	`g‘_İtiÚ_æßt
("svdpp_item_factor2_reg", 1e-3);

269 
svdµ
.
™mFùr2S‹p
 = 
	`g‘_İtiÚ_æßt
("svdpp_item_factor2_step", 1e-3);

271 
	`·r£_commªd_lše_¬gs
();

272 
	`·r£_im¶ic™_commªd_lše
();

275 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
Œaššg
, 
NULL
, 0, 0, 3, 
TRAINING
, 
çl£
);

276 ià(
v®id©iÚ
 != ""){

277 
vsh¬ds
 = 
cÚv”t_m©rixm¬k‘
<
EdgeD©aTy³
>(
v®id©iÚ
, 
NULL
, 0, 0, 3, 
VALIDATION
, 
çl£
);

278 
š™_v®id©iÚ_rm£_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
>(
pv®id©iÚ_’gše
, 
vsh¬ds
, &
svdµ_´ediù
);

281 
	`svdµ_š™
();

283 ià(
lßd_çùÜs_äom_fe
){

284 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_U.mm", 0, 2*
D
);

285 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_V.mm", 
M
, 
D
);

286 
vec
 
u£r_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 +"_U_bŸs.mm", 
çl£
, 
Œue
);

287 
	`as£¹
(
u£r_bŸs
.
	`size
(è=ğ
M
);

288 
vec
 
™em_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 +"_V_bŸs.mm", 
çl£
, 
Œue
);

289 
	`as£¹
(
™em_bŸs
.
	`size
(è=ğ
N
);

290 
ušt
 
i
=0; i<
M
+
N
; i++){

291 
Ï‹Á_çùÜs_šmem
[
i
].
bŸs
 = ((i<
M
)?
u£r_bŸs
[i] : 
™em_bŸs
[i-M]);

293 
vec
 
gm
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 + "_glob®_m—n.mm", 
çl£
, 
Œue
);

294 
glob®M—n
 = 
gm
[0];

298 
SVDPPV”tiûsInMemProg¿m
 
´og¿m
;

299 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

300 
	`£t_’gše_æags
(
’gše
);

301 
³ngše
 = &
’gše
;

302 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

305 
	`ouut_svdµ_»suÉ
(
Œaššg
);

306 
	`‹¡_´ediùiÚs
(&
svdµ_´ediù
);

310 ià(!
qu›t
)

311 
	`m‘rics_»pÜt
(
m
);

313 
	}
}

	@toolkits/collaborative_filtering/timer.hpp

24 #iâdeà
GRAPHLAB_TIMER_HPP


25 
	#GRAPHLAB_TIMER_HPP


	)

27 
	~<sys/time.h
>

28 
	~<¡dio.h
>

30 
	~<io¡»am
>

64 şas 
	ctim”
 {

65 
	m´iv©e
:

69 
timev®
 
¡¬t_time_
;

70 
	mpublic
:

75 
šlše
 
	$tim”
(è{ 
	`¡¬t
(); }

80 
šlše
 
	$¡¬t
(è{ 
	`g‘timeofday
(&
¡¬t_time_
, 
NULL
); 
	}
}

88 
šlše
 
	$cu¼’t_time
() const {

89 
timev®
 
cu¼’t_time
;

90 
	`g‘timeofday
(&
cu¼’t_time
, 
NULL
);

91 
ªsw”
 =

94 ()(
cu¼’t_time
.
tv_£c
 - 
¡¬t_time_
.tv_sec) +

95 (()(
cu¼’t_time
.
tv_u£c
 - 
¡¬t_time_
.tv_usec))/1.0E6;

96  
ªsw”
;

97 
	}
}

105 
šlše
 
	$cu¼’t_time_mlis
(ècÚ¡ {  
	`cu¼’t_time
(è* 1000; 
	}
}

	@toolkits/collaborative_filtering/timesvdpp.cpp

32 
	~"commÚ.hµ
"

33 
	~"eig’_w¿µ”.hµ
"

36 
	stimesvdµ_·¿ms
{

37 
	mÌ©e
;

38 
	mb‘a
;

39 
	mgamma
;

40 
	mÌ©e_muÉ_dec
;

42 
timesvdµ_·¿ms
(){

43 
	mÌ©e
 =0.0001;

44 
	mb‘a
 = 0.00001;

45 
	mgamma
 = 0.0001;

46 
	mÌ©e_muÉ_dec
 = 0.9;

50 
timesvdµ_·¿ms
 
	gt¥
;

52 
boŞ
 
	$is_u£r
(
vid_t
 
id
){  id < 
M
; 
	}
}

53 
boŞ
 
	$is_™em
(
vid_t
 
id
){  id >ğ
M
 && id < 
N
; 
	}
}

54 
boŞ
 
	$is_time
(
vid_t
 
id
){  id >ğ
M
+
N
; 
	}
}

56 
	#BIAS_POS
 -1

	)

58 
	sv”‹x_d©a
 {

59 
vec
 
	mpvec
;

60 
	mbŸs
;

61 
v”‹x_d©a
() {

62 
	mbŸs
 = 0;

64 
£t_v®
(
šdex
, 
v®
){

65 ià(
	mšdex
 =ğ
BIAS_POS
)

66 
bŸs
 = 
v®
;

67 
	mpvec
[
šdex
] = 
v®
;

69 
g‘_v®
(
šdex
){

70 ià(
	mšdex
 =ğ
BIAS_POS
)

71  
bŸs
;

72  
	mpvec
[
šdex
];

77 
	sedge_d©a
 {

78 
	mweight
;

79 
	mtime
;

81 
edge_d©a
(è{ 
	mweight
 = 
time
 = 0; }

83 
edge_d©a
(
weight
, 
time
) : weight(weight),ime(time) { }

86 
	stime_svdµ_u¤
{

87 * 
	mbu
;

88 * 
	mp
;

89 * 
	mpu
;

90 * 
	mx
;

91 * 
	m±emp
;

93 
time_svdµ_u¤
(
v”‹x_d©a
 & 
vd©a
){

94 
	mbu
 = &
vd©a
.
bŸs
;

95 
as£¹
(
vd©a
.
pvec
.
size
(è=ğ
D
*4);

96 
	mp
 = &
vd©a
.
pvec
[0];

97 
	mpu
 = 
p
+
D
;

98 
	mx
 = 
pu
+
D
;

99 
	m±emp
 = 
x
+
D
;

101 
	mtime_svdµ_u¤
 & 
	mİ”©Ü
 = (
v”‹x_d©a
 & 
vd©a
){

102 
bu
 = &
vd©a
.
bŸs
;

103 
as£¹
(
vd©a
.
pvec
.
size
(è=ğ
D
*4);

104 
	mp
 = &
vd©a
.
pvec
[0];

105 
	mpu
 = 
p
+
D
;

106 
	mx
 = 
pu
+
D
;

107 
	m±emp
 = 
x
+
D
;

108  *
	mthis
;

112 
	stime_svdµ_mov›
{

113 * 
	mbi
;

114 * 
	mq
;

115 * 
	my
;

117 
time_svdµ_mov›
(
v”‹x_d©a
& 
vd©a
){

118 
as£¹
(
vd©a
.
pvec
.
size
(è=ğ
D
*2);

119 
	mbi
 = &
vd©a
.
bŸs
;

120 
	mq
 = &
vd©a
.
pvec
[0];

121 
	my
 = 
q
+
D
;

123 
	mtime_svdµ_mov›
 & 
	mİ”©Ü
=(cÚ¡ 
v”‹x_d©a
& 
vd©a
){

124 
as£¹
(
vd©a
.
pvec
.
size
(è=ğ
D
*2);

125 
	mbi
 = (*)&
vd©a
.
bŸs
;

126 
	mq
 = (*)&
vd©a
.
pvec
[0];

127 
	my
 = (*)(
q
+
D
);

128  *
	mthis
;

132 
	stime_svdµ_time
{

133 * 
	mbt
;

134 * 
	mz
;

135 * 
	m±
;

137 
time_svdµ_time
(
v”‹x_d©a
& 
vd©a
){

138 
	mbt
 = &
vd©a
.
bŸs
;

139 
	mz
 = &
vd©a
.
pvec
[0];

140 
	m±
 = 
z
+
D
;

141 
as£¹
(
vd©a
.
pvec
.
size
(è=ğ
D
*2);

143 
	mtime_svdµ_time
 & 
	mİ”©Ü
=(
v”‹x_d©a
 & 
vd©a
){

144 
bt
 = &
vd©a
.
bŸs
;

145 
	mz
 = &
vd©a
.
pvec
[0];

146 
	m±
 = 
z
+
D
;

147 
as£¹
(
vd©a
.
pvec
.
size
(è=ğ
D
*2);

148  *
	mthis
;

154 
	$time_svdµ_´ediù
(cÚ¡ 
time_svdµ_u¤
 & 
u¤
,

155 cÚ¡ 
time_svdµ_mov›
 & 
mov
,

156 cÚ¡ 
time_svdµ_time
 & 
±ime
,

157 cÚ¡ 
¿tšg
,

158 & 
´ediùiÚ
){

161 
pui
 = 
glob®M—n
 + *
u¤
.
bu
 + *
mov
.
bi
;

162 
dim
 = 
D
;

163 
k
=0;k<
dim
;k++){

164 
pui
 +ğ(
u¤
.
±emp
[
k
] * 
mov
.
q
[k]);

165 
pui
 +ğ
u¤
.
x
[
k
] * 
±ime
.
z
[k];

166 
pui
 +ğ
u¤
.
pu
[
k
] * 
±ime
.
±
[k] * 
mov
.
q
[k];

168 
pui
 = 
¡d
::
	`mš
Õui,
maxv®
);

169 
pui
 = 
¡d
::
	`max
Õui,
mšv®
);

170 
´ediùiÚ
 = 
pui
;

171 
	`as£¹
(!
¡d
::
	`i¢ª
(
´ediùiÚ
));

172 
”r
 = 
¿tšg
 - 
´ediùiÚ
;

173  
”r
*err;

174 
	}
}

178 
	$time_svdµ_´ediù
(cÚ¡ 
v”‹x_d©a
& 
u£r
,

179 cÚ¡ 
v”‹x_d©a
& 
mov›
,

180 cÚ¡ 
¿tšg
,

181 & 
´ediùiÚ
,

182 * 
exŒa
){

183  
	`time_svdµ_´ediù
(
	`time_svdµ_u¤
((
v”‹x_d©a
&)
u£r
), 
	`time_svdµ_mov›
((v”‹x_d©a&)
mov›
), 
	`time_svdµ_time
(*(v”‹x_d©a*)
exŒa
), 
¿tšg
, 
´ediùiÚ
);

184 
	}
}

190 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

191 
edge_d©a
 
	tEdgeD©aTy³
;

193 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

194 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	gpv®id©iÚ_’gše
 = 
NULL
;

195 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

197 
	$š™_time_svdµ_node_d©a
(){

198 
k
 = 
D
;

199 #´agm¨
omp
 
·¿Î–
 

200 
u
 = 0; u < ()
M
; u++) {

201 
v”‹x_d©a
 & 
d©a
 = 
Ï‹Á_çùÜs_šmem
[
u
];

202 
d©a
.
pvec
 = 
	`z”os
(4*
k
);

203 
time_svdµ_u¤
 
	`u¤
(
d©a
);

204 *
u¤
.
bu
 = 0;

205 
m
=0; m< 
k
; m++){

206 
u¤
.
p
[
m
] = 0.01*
	`d¿nd48
(è/ (è(
k
);

207 
u¤
.
pu
[
m
] = 0.001 * 
	`d¿nd48
(è/ (è(
k
);

208 
u¤
.
x
[
m
] = 0.001 * 
	`d¿nd48
(è/ (è(
k
);

209 
u¤
.
±emp
[
m
] = u¤.
p
[m];

213 #´agm¨
omp
 
·¿Î–
 

214 
i
 = 
M
; i < ()(
N
+M); i++) {

215 
v”‹x_d©a
 & 
d©a
 = 
Ï‹Á_çùÜs_šmem
[
i
];

216 
d©a
.
pvec
 = 
	`z”os
(2*
k
);

217 
time_svdµ_mov›
 
	`mov›
(
d©a
);

218 *
mov›
.
bi
 = 0;

219 
m
 = 0; m < 
k
; m++){

220 
mov›
.
q
[
m
] = 0.01 * 
	`d¿nd48
(è/ (è(
k
);

221 
mov›
.
y
[
m
] = 0.001 * 
	`d¿nd48
(è/ (è(
k
);

224 
	}
}

226 
	$š™_time_svdµ
(){

227 
	`årštf
(
¡d”r
, "time-SVD++ %d faùÜs\n", 
D
);

229 
k
 = 
D
;

231 
Ï‹Á_çùÜs_šmem
.
	`»size
(
M
+
N
+
K
);

233 
	`š™_time_svdµ_node_d©a
();

235 #´agm¨
omp
 
·¿Î–
 

236 
i
 = 
M
+
N
; i < ()(M+N+
K
); i++) {

237 
v”‹x_d©a
 & 
d©a
 = 
Ï‹Á_çùÜs_šmem
[
i
];

238 
d©a
.
pvec
 = 
	`z”os
(2*
k
);

239 
time_svdµ_time
 
	`tim’ode
(
d©a
);

240 *
tim’ode
.
bt
 = 0;

241 
m
 = 0; m < 
k
; m++){

242 
tim’ode
.
z
[
m
] = 0.001 * 
	`d¿nd48
(è/ (è(
k
);

243 
tim’ode
.
±
[
m
] = 0.001 * 
	`d¿nd48
(è/ (è(
k
);

246 
	}
}

249 
	~"io.hµ
"

250 
	~"rm£.hµ
"

251 
	~"rm£_’gše4.hµ
"

257 
	gTIMESVDPPV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

262 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

265 ià(
is_u£r
(
v”‹x
.
id
())){

266 
	gv”‹x_d©a
 & 
	gu£r
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

267 
time_svdµ_u¤
 
u¤
(
u£r
);

269 
	gu£rR©šgs
 = 
v”‹x
.
num_ou‹dges
();

270 
	grRuNum
 = 1/
sq¹
(
u£rR©šgs
+10);

271 
	gdim
 = 
D
;

272 
	gsumY
 = 0.0;

275 
	ge
=0;ƒ < 
	gv”‹x
.
num_ou‹dges
();ƒ++) {

276 
ušt
 
	gpos
 = 
v”‹x
.
edge
(
e
)->
v”‹x_id
();

277 
as£¹
(
pos
 >ğ
M
 &&…o < M+
N
);

278 
	gv”‹x_d©a
 & 
	gd©a
 = 
Ï‹Á_çùÜs_šmem
[
pos
];

279 
time_svdµ_mov›
 
mov›
(
d©a
);

280 
	gM­
<
	gvec
> 
y
(
mov›
.y, 
D
);

281 
	gsumY
 +ğ
sum
((cÚ¡ 
vec
&)
y
);

284  
	gk
=0; k<
	gdim
; ++k) {

285 
	gu¤
.
	g±emp
[
k
] = 
u¤
.
pu
[k] + 
rRuNum
 * 
sumY
;

287 
vec
 
	gsum
 = 
z”os
(
dim
);

288 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

291 
	grui
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
().
weight
;

292 
ušt
 
	gt
 = (ušt)(
v”‹x
.
edge
(
e
)->
g‘_d©a
().
time
 - 1);

293 
as£¹
(
t
 < 
M
+
N
+
K
);

294 
	gv”‹x_d©a
 & 
	gd©a
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

295 
time_svdµ_mov›
 
mov
(
d©a
);

296 
time_svdµ_time
 
time
(
Ï‹Á_çùÜs_šmem
[
t
]);

297 
	gpui
 = 0;

298 
time_svdµ_´ediù
(
u¤
, 
mov
, 
time
, 
rui
, 
pui
);

299 
	geui
 = 
rui
 - 
pui
;

300 *
	gu¤
.
	gbu
 +ğ
t¥
.
Ì©e
*(
eui
 -¥.
b‘a
* *
u¤
.
bu
);

301 *
	gmov
.
	gbi
 +ğ
t¥
.
Ì©e
 * (
eui
 -¥.
b‘a
* *
mov
.
bi
);

303 
	gk
 = 0; k < 
	gdim
; k++) {

304 
	gŞdV®ue
 = 
mov
.
q
[
k
];

305 
	gu£rV®ue
 = 
u¤
.
±emp
[
k
] + u¤.
pu
[k] * 
time
.
±
[k];

306 
	gsum
[
k
] +ğ
eui
 * 
mov
.
q
[k];

307 
	gmov
.
	gq
[
k
] +ğ
t¥
.
Ì©e
 * (
eui
 * 
u£rV®ue
 -¥.
gamma
*
mov
.
q
[k]);

308 
	gu¤
.
	g±emp
[
k
] +ğ
t¥
.
Ì©e
 * ( 
eui
 * 
ŞdV®ue
 -¥.
gamma
 * 
u¤
.
±emp
[k]);

309 
	gu¤
.
	gp
[
k
] +ğ
t¥
.
Ì©e
 * ( 
eui
 * 
ŞdV®ue
 -¥.
gamma
*
u¤
.
p
[k] );

310 
	gu¤
.
	gpu
[
k
] +ğ
t¥
.
Ì©e
 * (
eui
 * 
ŞdV®ue
 * 
time
.
±
[k] -¥.
gamma
 * 
u¤
.
pu
[k]);

311 
	gtime
.
	g±
[
k
] +ğ
t¥
.
Ì©e
 * (
eui
 * 
ŞdV®ue
 * 
u¤
.
pu
[k] -¥.
gamma
 * 
time
.
±
[k]);

312 
	gxOldV®ue
 = 
u¤
.
x
[
k
];

313 
	gzOldV®ue
 = 
time
.
z
[
k
];

314 
	gu¤
.
	gx
[
k
] +ğ
t¥
.
Ì©e
 * (
eui
 * 
zOldV®ue
 -¥.
gamma
 * 
xOldV®ue
);

315 
	gtime
.
	gz
[
k
] +ğ
t¥
.
Ì©e
 * (
eui
 * 
xOldV®ue
 -¥.
gamma
 * 
zOldV®ue
);

318 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
eui
*eui;

321 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

322 
time_svdµ_mov›
 
	gmov
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

323 
	gk
=0;k<
	gdim
;k++){

324 
	gmov
.
	gy
[
k
] +ğ
t¥
.
Ì©e
 * (
rRuNum
 * 
sum
[k]-¥.
gamma
*
mov
.
y
[k]);

335 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

336 
»£t_rm£
(
gcÚ‹xt
.
exeùh»ads
);

343 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

344 
	gt¥
.
	gÌ©e
 *ğ
t¥
.
Ì©e_muÉ_dec
;

345 
Œaššg_rm£
(
™”©iÚ
, 
gcÚ‹xt
);

346 
run_v®id©iÚ4
(
pv®id©iÚ_’gše
, 
gcÚ‹xt
);

353 
ouut_timesvdµ_»suÉ
(
¡d
::
¡ršg
 
f’ame
) {

354 
MMOuu‰”_m©
<
v”‹x_d©a
> 
u£r_m©
(
f’ame
 + "_U.mm", 0, 
M
, "Thi fcÚš TIMESVDPP ouuˆm©rix U. IÀ—ch„ow 4xD faùÜ oà¨sšgË u£¸node. ThveùÜ ¬[°pu x…‹mp]", 
Ï‹Á_çùÜs_šmem
);

355 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
™em_m©
(
f’ame
 + "_V.mm", 
M
 ,M+
N
, "Thi fcÚš -TIMESVDPP ouuˆm©rix V. IÀ—ch„ow 2xD faùÜ oà¨sšgË i‹m‚ode. ThveùÜ ¬[q y]", 
Ï‹Á_çùÜs_šmem
);

356 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
time_m©
(
f’ame
 + "_T.mm", 
M
+
N
 ,M+N+
K
, "Thi fcÚš -TIMESVDPP ouuˆm©rix T. IÀ—ch„ow 2xD faùÜ oà¨sšgËimnode. ThveùÜ ¬[z…t]", 
Ï‹Á_çùÜs_šmem
);

357 
	gMMOuu‰”_vec
<
	gv”‹x_d©a
> 
mmouut_bŸs_Ëá
(
f’ame
 + "_U_bŸs.mm", 0, 
M
, 
BIAS_POS
, "Thi fcÚš time-svd++ ouuˆbŸ veùÜ. IÀ—ch„ow‡ sšgË u£¸bŸs.", 
Ï‹Á_çùÜs_šmem
);

358 
	gMMOuu‰”_vec
<
	gv”‹x_d©a
> 
mmouut_bŸs_right
(
f’ame
 + "_V_bŸs.mm",
M
 ,M+
N
 , 
BIAS_POS
, "Thi fcÚš time-svd++ ouuˆbŸ veùÜ. IÀ—ch„ow‡ sšgË i‹m bŸs.", 
Ï‹Á_çùÜs_šmem
);

359 
MMOuu‰”_sÿÏr
 
gm—n
(
f’ame
 + "_glob®_m—n.mm", "Thi fcÚš time-svd++ glob® m—Àwhich i »quœed fÜ computšg…»diùiÚs.", 
glob®M—n
);

361 
log¡»am
(
LOG_INFO
è<< "ime-svd++ ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << "_U.mm" << ", " << f’am+ "_V.mm " << f’am+ "_T.mm, " << f’am<< " _glob®_m—n.mm, " << f’am<< "_U_bŸs.mm " << f’am<< "_V_bŸs.mm " << 
	g¡d
::
’dl
;

364 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

367 
	`´št_cİyright
();

371 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

375 
m‘rics
 
	`m
("time-svdpp-inmemory-factors");

378 
t¥
.
Ì©e
 = 
	`g‘_İtiÚ_æßt
("lrate",sp.lrate);

379 
t¥
.
b‘a
 = 
	`g‘_İtiÚ_æßt
("beta",sp.beta);

380 
t¥
.
gamma
 = 
	`g‘_İtiÚ_æßt
("gamma",sp.gamma);

381 
t¥
.
Ì©e_muÉ_dec
 = 
	`g‘_İtiÚ_æßt
("lrate_mult_dec",sp.lrate_mult_dec);

383 
	`·r£_commªd_lše_¬gs
();

384 
	`·r£_im¶ic™_commªd_lše
();

387 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘4
<
edge_d©a
>(
Œaššg
, 
çl£
);

388 
	`š™_time_svdµ
();

389 ià(
v®id©iÚ
 != ""){

390 
vsh¬ds
 = 
cÚv”t_m©rixm¬k‘4
<
EdgeD©aTy³
>(
v®id©iÚ
, 
çl£
, 
M
==
N
, 
VALIDATION
);

391 
š™_v®id©iÚ_rm£_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
>(
pv®id©iÚ_’gše
, 
vsh¬ds
, &
time_svdµ_´ediù
, 
çl£
, 
Œue
, 1);

395 ià(
lßd_çùÜs_äom_fe
){

396 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_U.mm", 0, 4*
D
);

397 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_V.mm", 
M
, 2*
D
);

398 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_T.mm", 
M
+
N
, 2*
D
);

399 
vec
 
u£r_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 +"_U_bŸs.mm", 
çl£
, 
Œue
);

400 
vec
 
™em_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 +"_V_bŸs.mm", 
çl£
, 
Œue
);

401 
vec
 
time_bŸs
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
+ "_T_bŸs.mm", 
çl£
, 
Œue
);

402 
ušt
 
i
=0; i<
M
+
N
+
K
; i++){

403 ià(
i
 < 
M
)

404 
Ï‹Á_çùÜs_šmem
[
i
].
bŸs
 = 
u£r_bŸs
[i];

405 ià(
i
 <
M
+
N
)

406 
Ï‹Á_çùÜs_šmem
[
i
].
bŸs
 = 
™em_bŸs
[i-
M
];

408 
Ï‹Á_çùÜs_šmem
[
i
].
bŸs
 = 
time_bŸs
[i-
M
-
N
];

410 
vec
 
gm
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
Œaššg
 + "_glob®_m—n.mm", 
çl£
, 
Œue
);

411 
glob®M—n
 = 
gm
[0];

416 
TIMESVDPPV”tiûsInMemProg¿m
 
´og¿m
;

417 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

418 
	`£t_’gše_æags
(
’gše
);

419 
³ngše
 = &
’gše
;

420 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

423 
	`ouut_timesvdµ_»suÉ
(
Œaššg
);

424 
	`‹¡_´ediùiÚs3
(&
time_svdµ_´ediù
, 1);

427 ià(!
qu›t
)

428 
	`m‘rics_»pÜt
(
m
);

430 
	}
}

	@toolkits/collaborative_filtering/types.hpp

1 #iâdeà
TYPES_COMMON


2 
	#TYPES_COMMON


	)

4 
	t»®_ty³
;

9 
	sb¬t™e_g¿ph_desütÜ
 {

10 
	mrows
, 
	mcŞs
;

11 
size_t
 
	mnÚz”os
;

12 
boŞ
 
	mfÜû_nÚ_squ¬e
;

14 
b¬t™e_g¿ph_desütÜ
(è: 
rows
(0), 
cŞs
(0), 
nÚz”os
(0), 
fÜû_nÚ_squ¬e
(
çl£
) { }

17 
boŞ
 
is_squ¬e
(ècÚ¡ {  
	mrows
 =ğ
cŞs
 && !
fÜû_nÚ_squ¬e
; }

19 
g‘_¡¬t_node
(
boŞ
 
_rows
ècÚ¡ { ià(
is_squ¬e
()è 0;  (
	m_rows
?0:
rows
); }

21 
g‘_’d_node
(
boŞ
 
_rows
ècÚ¡ { ià(
is_squ¬e
()è 
	mrows
;  (
	m_rows
?rows:(
rows
+
cŞs
)); }

23 
num_nodes
(
boŞ
 
_rows
ècÚ¡ { ià(
	m_rows
è 
	mrows
;  
	mcŞs
; }

25 
tÙ®
(ècÚ¡ { ià(
is_squ¬e
()è 
	mrows
; „ows+
	mcŞs
; }

27 
boŞ
 
is_row_node
(
id
ècÚ¡ {  
	mid
 < 
	mrows
; }

29 
boŞ
 
tİršt
(
id
ècÚ¡ {  (
	mid
 =ğ0è|| (id =ğ
rows
 - 1è|| (id =ğrowsè|| (id =ğrows+
cŞs
-1); }

	@toolkits/collaborative_filtering/util.hpp

1 #iâdeà
__CF_UTILS__


2 
	#__CF_UTILS__


	)

4 
	~<omp.h
>

5 
	~<¡dio.h
>

6 
	~<io¡»am
>

8 
	$numb”_of_omp_th»ads
(){

9 
num_th»ads
 = 0;

10 
id
;

11 #´agm¨
omp
 
·¿Î–
 
	`´iv©e
(
id
)

13 
id
 = 
	`omp_g‘_th»ad_num
();

14 ià(
id
 == 0)

15 
num_th»ads
 = 
	`omp_g‘_num_th»ads
();

17  
num_th»ads
;

18 
	}
}

20 
	sš_fe
{

21 
FILE
 * 
	moutf
;

22 
š_fe
(
¡d
::
¡ršg
 
âame
) {

23 
outf
 = 
fİ’
(
âame
.
c_¡r
(), "r");

24 ià(
	moutf
 =ğ
NULL
){

25 
¡d
::
û¼
<<"FaedØİ’ fe: " << 
âame
 << std::
’dl
;

26 
ex™
(1);

30 ~
š_fe
() {

31 ià(
	moutf
 !ğ
NULL
è
fşo£
(
outf
);

36 
	sout_fe
{

38 
FILE
 * 
	moutf
;

39 
out_fe
(cÚ¡ 
¡d
::
¡ršg
 
âame
){

40 
outf
 = 
fİ’
(
âame
.
c_¡r
(), "w");

43 ~
out_fe
(){

44 ià(
	moutf
 !ğ
NULL
è
fşo£
(
outf
);

	@toolkits/collaborative_filtering/wals.cpp

35 
	~"commÚ.hµ
"

36 
	~"eig’_w¿µ”.hµ
"

38 
	gÏmbda
 = 1e-3;

40 
	sv”‹x_d©a
 {

41 
vec
 
	mpvec
;

43 
v”‹x_d©a
() {

44 
	mpvec
 = 
z”os
(
D
);

46 
£t_v®
(
šdex
, 
v®
){

47 
	mpvec
[
šdex
] = 
v®
;

49 
g‘_v®
(
šdex
){

50  
	mpvec
[
šdex
];

55 
	sedge_d©a
 {

56 
	mweight
;

57 
	mtime
;

59 
edge_d©a
(è{ 
	mweight
 = 
time
 = 0; }

61 
edge_d©a
(
weight
, 
time
) : weight(weight),ime(time) { }

69 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

70 
edge_d©a
 
	tEdgeD©aTy³
;

72 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

73 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	gpv®id©iÚ_’gše
 = 
NULL
;

74 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

76 
	~"io.hµ
"

77 
	~"rm£.hµ
"

78 
	~"rm£_’gše4.hµ
"

81 
	$w®s_´ediù
(cÚ¡ 
v”‹x_d©a
& 
u£r
,

82 cÚ¡ 
v”‹x_d©a
& 
mov›
,

83 cÚ¡ 
¿tšg
,

84 & 
´ediùiÚ
,

85 * 
exŒa
 = 
NULL
){

88 
´ediùiÚ
 = 
	`dÙ_´od
(
u£r
.
pvec
, 
mov›
.pvec);

90 
´ediùiÚ
 = 
¡d
::
	`mš
((í»diùiÚ, 
maxv®
);

91 
´ediùiÚ
 = 
¡d
::
	`max
((í»diùiÚ, 
mšv®
);

93 
”r
 = 
¿tšg
 - 
´ediùiÚ
;

94 
	`as£¹
(!
¡d
::
	`i¢ª
(
”r
));

95  
”r
*err;

97 
	}
}

106 
	gWALSV”tiûsInMemProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

111 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

112 
	gv”‹x_d©a
 & 
	gvd©a
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

113 
m©
 
	gXtX
 = m©::
Z”o
(
D
, D);

114 
vec
 
	gXty
 = vec::
Z”o
(
D
);

116 
boŞ
 
	gcompu‹_rm£
 = (
v”‹x
.
num_ou‹dges
() > 0);

118 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

119 cÚ¡ 
	gedge_d©a
 & 
	gedge
 = 
v”‹x
.
edge
(
e
)->
g‘_d©a
();

120 
	gv”‹x_d©a
 & 
	gnbr_Ï‹Á
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

121 
	gXty
 +ğ
nbr_Ï‹Á
.
pvec
 * 
edge
.
weight
 *ƒdge.
time
;

122 
	gXtX
.
	gŒŸnguÏrV›w
<
	gEig’
::
Uµ”
>(è+ğ
nbr_Ï‹Á
.
pvec
 *‚br_Ï‹Á.pvec.
Œª¥o£
(è* 
edge
.
time
;

123 ià(
	gcompu‹_rm£
) {

124 
	g´ediùiÚ
;

125 
	grm£_vec
[
omp_g‘_th»ad_num
()] +ğ
w®s_´ediù
(
vd©a
, 
nbr_Ï‹Á
, 
edge
.
weight
, 
´ediùiÚ
è* 
	gedge
.
	gtime
;

129 
	gi
=0; i < 
	gD
; i++è
XtX
(
i
,iè+ğ(
Ïmbda
);

131 
	gvd©a
.
	gpvec
 = 
XtX
.
£lçdjoštV›w
<
Eig’
::
Uµ”
>().
ldÉ
().
sŞve
(
Xty
);

138 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

139 
»£t_rm£
(
gcÚ‹xt
.
exeùh»ads
);

146 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

147 
Œaššg_rm£
(
™”©iÚ
, 
gcÚ‹xt
);

148 
run_v®id©iÚ4
(
pv®id©iÚ_’gše
, 
gcÚ‹xt
);

156 
ouut_®s_»suÉ
(
¡d
::
¡ršg
 
f’ame
) {

157 
MMOuu‰”_m©
<
v”‹x_d©a
> 
u£r_m©
(
f’ame
 + "_U.mm", 0, 
M
, "Thi fcÚš WALS ouuˆm©rix U. IÀ—ch„ow D faùÜ oà¨sšgË u£¸node.", 
Ï‹Á_çùÜs_šmem
);

158 
	gMMOuu‰”_m©
<
	gv”‹x_d©a
> 
™em_m©
(
f’ame
 + "_V.mm", 
M
, M+
N
, "Thi fcÚš WALS ouuˆm©rix V. IÀ—ch„ow D faùÜ oà¨sšgË i‹m‚ode.", 
Ï‹Á_çùÜs_šmem
);

159 
log¡»am
(
LOG_INFO
è<< "WALS ouuˆfe (š m©rix m¬k‘ fÜm©): " << 
	gf’ame
 << "_U.mm" <<

160 ", " << 
	gf’ame
 + "_V.mm " << 
	g¡d
::
’dl
;

163 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

165 
	`´št_cİyright
();

169 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

173 
m‘rics
 
	`m
("als-inmemory-factors");

175 
Ïmbda
 = 
	`g‘_İtiÚ_æßt
("lambda", 0.065);

177 
	`·r£_commªd_lše_¬gs
();

178 
	`·r£_im¶ic™_commªd_lše
();

179 ià(
un™‹¡
 == 1){

180 ià(
Œaššg
 == "")raining = "test_wals";

181 
n™”s
 = 100;

185 
nsh¬ds
 = 
cÚv”t_m©rixm¬k‘4
<
edge_d©a
>(
Œaššg
);

186 
š™_ã©u»_veùÜs
<
¡d
::
veùÜ
<
v”‹x_d©a
> >(
M
+
N
, 
Ï‹Á_çùÜs_šmem
, !
lßd_çùÜs_äom_fe
);

187 ià(
v®id©iÚ
 != ""){

188 
vsh¬ds
 = 
cÚv”t_m©rixm¬k‘4
<
EdgeD©aTy³
>(
v®id©iÚ
, 
çl£
, 
M
==
N
, 
VALIDATION
, 0);

189 
š™_v®id©iÚ_rm£_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
>(
pv®id©iÚ_’gše
, 
vsh¬ds
, &
w®s_´ediù
, 
Œue
, 
çl£
, 0);

192 ià(
lßd_çùÜs_äom_fe
){

193 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_U.mm", 0, 
D
);

194 
	`lßd_m©rix_m¬k‘_m©rix
(
Œaššg
 + "_V.mm", 
M
, 
D
);

199 
WALSV”tiûsInMemProg¿m
 
´og¿m
;

200 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
Œaššg
, 
nsh¬ds
, 
çl£
, 
m
);

201 
	`£t_’gše_æags
(
’gše
);

202 
³ngše
 = &
’gše
;

203 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

206 
	`ouut_®s_»suÉ
(
Œaššg
);

207 
	`‹¡_´ediùiÚs
(&
w®s_´ediù
);

209 ià(
un™‹¡
 == 1){

210 ià(
dŒaššg_rm£
 > 0.03)

211 
	`log¡»am
(
LOG_FATAL
)<<"Un™e¡ 1 faed. T¿ššg RMSE is: " << 
Œaššg_rm£
 << 
¡d
::
’dl
;

212 ià(
dv®id©iÚ_rm£
 > 0.61)

213 
	`log¡»am
(
LOG_FATAL
)<<"Un™e¡ 1 faed. V®id©iÚ RMSE is: " << 
v®id©iÚ_rm£
 << 
¡d
::
’dl
;

218 ià(!
qu›t
)

219 
	`m‘rics_»pÜt
(
m
);

221 
	}
}

	@toolkits/graph_analytics/connectedcomponents.cpp

47 
	~<cm©h
>

48 
	~<¡ršg
>

50 
	~"g¿phchi_basic_šşudes.hµ
"

51 
	~"Ïb–_ª®ysis.hµ
"

52 
	~"../cŞÏbÜ©ive_f‹ršg/eig’_w¿µ”.hµ
"

54 
usšg
 
Çme¥aû
 
	gg¿phchi
;

56 
FILE
 * 
	gpfe
 = 
NULL
;

62 
vid_t
 
	tV”‹xD©aTy³
;

63 
vid_t
 
	tEdgeD©aTy³
;

65 
vec
 
	gunique_Ïb–s
;

66 
	gn™”s
;

71 
	gCÚÃùedCompÚ’tsProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

79 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

81 
as£¹
(
gcÚ‹xt
.
scheduËr
 !ğ
NULL
);

83 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0) {

84 
v”‹x
.
£t_d©a
(v”‹x.
id
());

85 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
v”‹x
.
id
());

89 
vid_t
 
	gcurmš
 = 
v”‹x
.
g‘_d©a
();

90 
	gi
=0; i < 
	gv”‹x
.
num_edges
(); i++) {

91 
vid_t
 
	gnbÏb–
 = 
v”‹x
.
edge
(
i
)->
g‘_d©a
();

92 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 =ğ0è
nbÏb–
 = 
v”‹x
.
edge
(
i
)->
v”‹x_id
();

93 
	gcurmš
 = 
¡d
::
mš
(
nbÏb–
, 
curmš
);

97 
	gv”‹x
.
£t_d©a
(
curmš
);

105 
vid_t
 
	gÏb–
 = 
v”‹x
.
g‘_d©a
();

107 ià(
	ggcÚ‹xt
.
	g™”©iÚ
 > 0) {

108 
	gi
=0; i < 
	gv”‹x
.
num_edges
(); i++) {

109 ià(
	gÏb–
 < 
	gv”‹x
.
edge
(
i
)->
g‘_d©a
()) {

110 
	gv”‹x
.
edge
(
i
)->
£t_d©a
(
Ïb–
);

112 
	ggcÚ‹xt
.
	gscheduËr
->
add_sk
(
v”‹x
.
edge
(
i
)->
v”‹x_id
());

115 } ià(
	ggcÚ‹xt
.
	g™”©iÚ
 == 0) {

116 
i
=0; 
	gi
 < 
	gv”‹x
.
num_ou‹dges
(); i++) {

117 
	gv”‹x
.
ou‹dge
(
i
)->
£t_d©a
(
Ïb–
);

125 
şass
 
	gOuutV”‹xC®lback
 : 
public
 
VC®lback
<
V”‹xD©aTy³
> {

126 
public
:

128 
vœtu®
 
ÿÎback
(
vid_t
 
v”‹x_id
, 
V”‹xD©aTy³
 &
v®ue
) {

129 
årštf
(
pfe
, "%u 1 %u\n", 
v”‹x_id
+1, 
v®ue
);

130 
	gunique_Ïb–s
[
v®ue
] = 1;

135 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

138 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

142 
m‘rics
 
	`m
("connected-components");

145 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

146 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 10);

147 
ouut_Ïb–s
 = 
	`g‘_İtiÚ_št
("output_labels", 0);

148 
boŞ
 
scheduËr
 = 
Œue
;

151 
nsh¬ds
 = 
cÚv”t_if_nÙexi¡s
<
EdgeD©aTy³
>(
f’ame
, 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"));

153 ià(
	`g‘_İtiÚ_št
("onlyresult", 0) == 0) {

155 
CÚÃùedCompÚ’tsProg¿m
 
´og¿m
;

156 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
, 
nsh¬ds
, 
scheduËr
, 
m
);

157 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

160 ià(
ouut_Ïb–s
){

161 
pfe
 = 
	`fİ’
((
f’ame
 + "-compÚ’ts").
	`c_¡r
(), "w");

162 ià(!
pfe
)

163 
	`log¡»am
(
LOG_FATAL
)<<"FaedØİ’ fe: " << 
f’ame
 << 
¡d
::
’dl
;

164 
	`årštf
(
pfe
, "%%%%MatrixMarket matrix coordinate„eal general\n");

165 
	`årštf
(
pfe
, "%lu %u %lu\n", 
’gše
.
	`num_v”tiûs
()-1, 1,ƒngine.num_vertices()-1);

166 
OuutV”‹xC®lback
 
ÿÎback
;

170 
	`log¡»am
(
LOG_INFO
)<<"Found: " << 
	`sum
(
unique_Ïb–s
è<< " uniquÏb– " << 
¡d
::
’dl
;

172 
m
.
	`¡¬t_time
("label-analysis");

173 
ª®yze_Ïb–s2
<
vid_t
>(
f’ame
, 
pfe
);

174 
m
.
	`¡İ_time
("label-analysis");

175 
	`fşo£
(
pfe
);

181 
	}
}

	@toolkits/graph_analytics/inmemconncomps.cpp

42 
	~<cm©h
>

43 
	~<¡ršg
>

45 
	~"g¿phchi_basic_šşudes.hµ
"

46 
	~"Ïb–_ª®ysis.hµ
"

47 
	~"../cŞÏbÜ©ive_f‹ršg/eig’_w¿µ”.hµ
"

49 
usšg
 
Çme¥aû
 
	gg¿phchi
;

57 
vid_t
 
	tV”‹xD©aTy³
;

58 
vid_t
 
	tEdgeD©aTy³
;

59 
V”‹xD©aTy³
 * 
	gv”‹x_v®ues
;

60 
size_t
 
	gchªges
 = 0;

66 
	gCÚÃùedCompÚ’tsProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

72 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gšfo
) {

73 
log¡»am
(
LOG_DEBUG
)<<"™”©iÚ: " << 
	g™”©iÚ
 << " chªges: " << 
	gchªges
 << 
	g¡d
::
’dl
;

74 ià(
	gchªges
 == 0)

75 
gšfo
.
£t_Ï¡_™”©iÚ
(
™”©iÚ
);

76 
	gchªges
 = 0;

80 
vid_t
 
ÃighbÜ_v®ue
(
g¿phchi_edge
<
EdgeD©aTy³
> * 
edge
) {

81  
	gv”‹x_v®ues
[
edge
->
v”‹x_id
()];

84 
£t_d©a
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
vid_t
 
v®ue
) {

85 
	gv”‹x_v®ues
[
v”‹x
.
id
()] = 
v®ue
;

94 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

97 
vid_t
 
	gcurmš
 = 
v”‹x_v®ues
[
v”‹x
.
id
()];

98 
	gi
=0; i < 
	gv”‹x
.
num_edges
(); i++) {

99 
vid_t
 
	gnbÏb–
 = 
ÃighbÜ_v®ue
(
v”‹x
.
edge
(
i
));

100 
	gcurmš
 = 
¡d
::
mš
(
nbÏb–
, 
curmš
);

103 ià(
	gv”‹x_v®ues
[
v”‹x
.
id
()] > 
	gcurmš
) {

104 
	gchªges
++;

105 
£t_d©a
(
v”‹x
, 
curmš
);

112 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
ùx
) {

113 
	gchªges
 = 0;

114 ià(
	g™”©iÚ
 == 0) {

116 
v”‹x_v®ues
 = 
Ãw
 
V”‹xD©aTy³
[
ùx
.
nv”tiûs
];

117 
	gi
=0; i < ()
	gùx
.
	gnv”tiûs
; i++) {

118 
	gv”‹x_v®ues
[
i
] = i;

126 
	$maš
(
¬gc
, cÚ¡ ** 
¬gv
) {

129 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

133 
m‘rics
 
	`m
("connected-components-inmem");

136 
¡d
::
¡ršg
 
f’ame
 = 
	`g‘_İtiÚ_¡ršg
("file");

137 
n™”s
 = 
	`g‘_İtiÚ_št
("niters", 100);

138 
ouut_Ïb–s
 = 
	`g‘_İtiÚ_št
("output_labels", 0);

139 
boŞ
 
scheduËr
 = 
çl£
;

142 
nsh¬ds
 = (è
cÚv”t_if_nÙexi¡s
<
EdgeD©aTy³
>(
f’ame
, 
	`g‘_İtiÚ_¡ršg
("nshards", "auto"));

145 
CÚÃùedCompÚ’tsProg¿m
 
´og¿m
;

146 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
f’ame
, 
nsh¬ds
, 
scheduËr
, 
m
);

147 
’gše
.
	`£t_di§bË_v”‹xd©a_¡Üage
();

148 
’gše
.
	`£t_’abË_d‘”mši¡ic_·¿Î–ism
(
çl£
);

149 
’gše
.
	`£t_modif›s_šedges
(
çl£
);

150 
’gše
.
	`£t_modif›s_ou‹dges
(
çl£
);

151 
’gše
.
	`£t_´–ßd_comm™
(
çl£
);

152 
’gše
.
	`£t_maxwšdow
Óngše.
	`num_v”tiûs
());

154 
’gše
.
	`run
(
´og¿m
, 
n™”s
);

157 ià(
ouut_Ïb–s
){

158 
FILE
 * 
pfe
 = 
	`fİ’
((
f’ame
 + "-compÚ’ts").
	`c_¡r
(), "w");

159 ià(!
pfe
)

160 
	`log¡»am
(
LOG_FATAL
)<<"FaedØİ’ fe: " << 
f’ame
 << 
¡d
::
’dl
;

161 
	`årštf
(
pfe
, "%%%%MatrixMarket matrix‡rray„eal general\n");

162 
	`årštf
(
pfe
, "%lu %u\n", 
’gše
.
	`num_v”tiûs
()-1, 1);

163 
ušt
 
i
=1; i< 
’gše
.
	`num_v”tiûs
(); i++){

164 
	`årštf
(
pfe
, "%u\n", 
v”‹x_v®ues
[
i
]);

165 
	`as£¹
(
v”‹x_v®ues
[
i
] >ğ0 && v”‹x_v®ues[i] < 
’gše
.
	`num_v”tiûs
());

167 
	`fşo£
(
pfe
);

168 
	`log¡»am
(
LOG_INFO
)<<"Saved sucûsfuÎyØouˆfe: " << 
f’ame
 << "-compÚ’ts" << 
¡d
::
’dl
;

171 
	}
}

	@toolkits/graph_analytics/kcores.cpp

25 
	~<cm©h
>

26 
	~<c¡dio
>

27 
	~<lim™s
>

28 
	~<io¡»am
>

29 
	~"g¿phchi_basic_šşudes.hµ
"

30 
	~"­i/chif’ames.hµ
"

31 
	~"­i/v”‹x_agg»g©Ü.hµ
"

32 
	~"´•roûssšg/sh¬d”.hµ
"

33 
	~"../cŞÏbÜ©ive_f‹ršg/eig’_w¿µ”.hµ
"

34 
	~"../cŞÏbÜ©ive_f‹ršg/tim”.hµ
"

35 
	~"../cŞÏbÜ©ive_f‹ršg/commÚ.hµ
"

37 
usšg
 
Çme¥aû
 
	gg¿phchi
;

39 
	gsqu¬e
 = 0;

40 
	gtok’s_³r_row
 = 3;

42 
boŞ
 
	gdebug
 = 
çl£
;

43 
	gmax_™”
 = 50;

44 
ivec
 
	gaùive_nodes_num
;

45 
ivec
 
	gaùive_lšks_num
;

46 
	gi™”
 = 0;

47 
ušt
 
	gnodes
 = 0;

48 
ušt
 
	gÜig_edges
 = 0;

49 
ušt
 
	gnum_aùive
 = 0;

50 
ušt
 
	glšks
 = 0;

51 
mu‹x
 
	gmymu‹x
;

52 
tim”
 
	gmytim”
;

55 
	sv”‹x_d©a
 {

56 
boŞ
 
	maùive
;

57 
	mkcÜe
, 
	mdeg»e
;

58 
vec
 
	mpvec
;

59 
v”‹x_d©a
(è: 
aùive
(
Œue
), 
kcÜe
(-1), 
deg»e
(0) {}

60 
£t_v®
(
šdex
, 
v®
){}

61 
g‘_v®
(
šdex
){  0;}

65 
	sedge_d©a
 {

66 
edge_d©a
() { }

68 
edge_d©a
(
v®
) { }

69 
edge_d©a
(
v®
, 
time
) { }

74 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

75 
edge_d©a
 
	tEdgeD©aTy³
;

77 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

78 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

80 
	~"../cŞÏbÜ©ive_f‹ršg/io.hµ
"

82 
	gKcÜesProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

87 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

89 
	gv”‹x_d©a
 & 
	gvd©a
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

90 ià(
	gdebug
 && 
	gi™”
 > 99 && 
	gv”‹x
.
id
() % 1000 == 0)

91 
¡d
::
cout
<<"EÁ”šg‚ode: " << 
v”‹x
.
id
(è<< std::
’dl
;

93 ià(!
	gvd©a
.
	gaùive
)

96 
	gcur_™”
 = 
i™”
;

97 
	gcur_lšks
 = 0;

98 
	gšü—sšg_lšks
 = 0;

100 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

101 cÚ¡ 
	gv”‹x_d©a
 & 
	gÙh”
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

102 ià(
	gÙh”
.
	gaùive
){

103 ià(
	gdebug
 && 
	gi™”
 > 99)

104 
	g¡d
::
cout
<<"ÃighbÜ: "<<
v”‹x
.
edge
(
e
)->
v”‹x_id
()<<"‡ùive"<<
¡d
::
’dl
;

105 
	gcur_lšks
++;

106 ià(
	gv”‹x
.
edge
(
e
)->
v”‹x_id
(è> v”‹x.
id
())

107 
	gšü—sšg_lšks
++;

111 ià(
	gcur_lšks
 <ğ
cur_™”
){

112 
vd©a
.
aùive
 = 
çl£
;

113 
	gvd©a
.
	gkcÜe
 = 
cur_™”
;

116 ià(
	gdebug
 && 
	gi™”
 > 99)

117 
	g¡d
::
cout
<<
v”‹x
.
id
()<<": cu¸lšks: " << 
cur_lšks
 << 
¡d
::
’dl
;

118 
	gmymu‹x
.
lock
();

119 
	glšks
 +ğ
šü—sšg_lšks
;

120 
	gmymu‹x
.
uÆock
();

123 ià(
	gvd©a
.
	gaùive
){

124 
	gmymu‹x
.
lock
();

125 
	gnum_aùive
++;

126 
	gmymu‹x
.
uÆock
();

130 
aá”_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

131 
	gaùive_nodes_num
[
i™”
] = 
num_aùive
;

132 ià(
	gnum_aùive
 == 0)

133 
lšks
 = 0;

134 
´štf
("Numb” oàaùivnode š„ound %d i %di,†šks: %d\n", 
i™”
, 
num_aùive
, 
lšks
);

135 
	gaùive_lšks_num
[
i™”
] = 
lšks
;

139 
befÜe_™”©iÚ
(
™”©iÚ
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

140 
	gnum_aùive
 = 0;

141 
	glšks
 = 0;

147 
vec
 
	$fl_ouut
(){

148 
vec
 
»t
 = vec::
	`Z”o
(
Ï‹Á_çùÜs_šmem
.
	`size
());

149 
ušt
 
i
=0; i < 
Ï‹Á_çùÜs_šmem
.
	`size
(); i++)

150 
»t
[
i
] = 
Ï‹Á_çùÜs_šmem
[i].
kcÜe
;

151  
»t
;

152 
	}
}

154 
	$maš
(
¬gc
, cÚ¡ *
¬gv
[]) {

156 
	`log¡»am
(
LOG_WARNING
)<<"GraphChi graph‡nalytics†ibrary is written by Danny Bickson (c). Send‡ny "

157 " comm’t Ü bug„•Üt tØdªny.bicksÚ@gma.com " << 
¡d
::
’dl
;

160 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

164 
m‘rics
 
	`m
("kcores-inmemory-factors");

166 
¡d
::
¡ršg
 
d©afe
;

167 
un™‹¡
 = 0;

169 
max_™”
 = 
	`g‘_İtiÚ_št
("max_iter", 15000);

170 
maxv®
 = 
	`g‘_İtiÚ_æßt
("maxval", 1e100);

171 
mšv®
 = 
	`g‘_İtiÚ_æßt
("minval", -1e100);

172 
boŞ
 
qu›t
 = 
	`g‘_İtiÚ_št
("quiet", 0);

173 ià(
qu›t
)

174 
	`glob®_logg”
().
	`£t_log_Ëv–
(
LOG_ERROR
);

175 
debug
 = 
	`g‘_İtiÚ_št
("debug", 0);

176 
un™‹¡
 = 
	`g‘_İtiÚ_št
("unittest", 0);

177 
d©afe
 = 
	`g‘_İtiÚ_¡ršg
("training");

178 
squ¬e
 = 
	`g‘_İtiÚ_št
("square", 0);

179 
tok’s_³r_row
 = 
	`g‘_İtiÚ_št
("tokens_per_row",okens_per_row);

180 
nodes
 = 
	`g‘_İtiÚ_št
("nodes",‚odes);

181 
Üig_edges
 = 
	`g‘_İtiÚ_št
("orig_edges", orig_edges);

183 
aùive_nodes_num
 = 
	`ivec
(
max_™”
+1);

184 
aùive_lšks_num
 = 
	`ivec
(
max_™”
+1);

189 ià(
un™‹¡
 == 1){

190 
d©afe
 = "kcores_unittest1";

192 
mytim”
.
	`¡¬t
();

196 
nsh¬ds
 = 0;

197 ià(
tok’s_³r_row
 == 4 )

198 
cÚv”t_m©rixm¬k‘4
<
edge_d©a
>(
d©afe
, 
çl£
, 
squ¬e
);

199 ià(
tok’s_³r_row
 == 3 ||okens_per_row == 2)

200 
cÚv”t_m©rixm¬k‘
<
edge_d©a
>(
d©afe
, 
NULL
, 
nodes
, 
Üig_edges
, 
tok’s_³r_row
);

201 
	`log¡»am
(
LOG_FATAL
)<<"PËa£ u£ --tok’s_³r_row=3 o¸--tok’s_³r_row=4" << 
¡d
::
’dl
;

203 
Ï‹Á_çùÜs_šmem
.
	`»size
(
squ¬e
? 
¡d
::
	`max
(
M
,
N
) : M+N);

205 
KcÜesProg¿m
 
´og¿m
;

206 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
d©afe
, 
nsh¬ds
, 
çl£
, 
m
);

207 
	`£t_’gše_æags
(
’gše
);

208 
’gše
.
	`£t_maxwšdow
(
nodes
+1);

209 
·ss
 = 0;

210 
i™”
=1; i™”< 
max_™”
+1; iiter++){

211 
	`log¡»am
(
LOG_INFO
)<<
mytim”
.
	`cu¼’t_time
(è<< "èGošgØruÀk-cÜe ™”©iÚ " << 
i™”
 << 
¡d
::
’dl
;

212 
Œue
){

213 
´ev_nodes
 = 
aùive_nodes_num
[
i™”
];

215 
’gše
.
	`run
(
´og¿m
, 1);

216 
·ss
++;

217 
cur_nodes
 = 
aùive_nodes_num
[
i™”
];

218 ià(
´ev_nodes
 =ğ
cur_nodes
)

221 ià(
aùive_nodes_num
[
i™”
] == 0){

222 
max_™”
 = 
i™”
;

227 
¡d
::
cout
 << "KCORES fšished iÀ" << 
mytim”
.
	`cu¼’t_time
(è<< std::
’dl
;

228 
¡d
::
cout
 << "Numb” oàupd©es: " << 
·ss
*(
M
+
N
è<< "…ass: " <<…as << std::
’dl
;

229 
im©
 
»tm©
 = 
	`im©
(
max_™”
+1, 4);

230 
	`mem£t
((*)
	`d©a
(
»tm©
),0,()*»tm©.
	`size
());

233 
aùive_nodes_num
[0] = (
squ¬e
? 
¡d
::
	`max
(
M
,
N
) : M+N);

234 
aùive_lšks_num
[0] = 
L
;

235 
	`as£¹
(
L
>0);

237 
¡d
::
cout
<<" CÜRemoved TÙ® Removed"<<¡d::
’dl
;

238 
¡d
::
cout
<<" Num Node  Removed Lšks" <<¡d::
’dl
;

239 
i
=0; i <ğ
max_™”
; i++){

240 
	`£t_v®
(
»tm©
, 
i
, 0, i);

241 ià(
i
 >= 1){

242 
	`£t_v®
(
»tm©
, 
i
, 1, 
aùive_nodes_num
[i-1]-active_nodes_num[i]);

243 
	`£t_v®
(
»tm©
, 
i
, 2, 
aùive_nodes_num
[0]-active_nodes_num[i]);

244 
	`as£¹
(
aùive_nodes_num
[
i
] >= 0);

245 
	`£t_v®
(
»tm©
, 
i
, 3, 
L
 - 
aùive_lšks_num
[i]);

249 
¡d
::
cout
<<
»tm©
<<¡d::
’dl
;

251 
vec
 
»t
 = 
	`fl_ouut
();

252 
	`wr™e_ouut_veùÜ
(
d©afe
 + "x.out", 
»t
,
çl£
, "This vector holds forƒach‚ode its kcore degree");

254 ià(
un™‹¡
 == 1){

255 
im©
 
sŞ
 = 
	`š™_im©
("0 0 0 0; 1 1 1 1; 2 4 5 7; 3 4 9 13", 4, 4);

256 
	`as£¹
(
	`sumsum
(
sŞ
 - 
»tm©
) == 0);

259  
EXIT_SUCCESS
;

260 
	}
}

	@toolkits/graph_analytics/label_analysis.hpp

32 
	~<veùÜ
>

33 
	~<®gÜ™hm
>

34 
	~<”ºo.h
>

35 
	~<as£¹.h
>

37 
	~"io/¡redio.hµ
"

38 
	~"logg”/logg”.hµ
"

39 
	~"ut/m”ge.hµ
"

40 
	~"ut/iout.hµ
"

41 
	~"ut/qsÜt.hµ
"

42 
	~"­i/chif’ames.hµ
"

44 #iâdeà
DEF_GRAPHCHI_LABELANALYSIS


45 
	#DEF_GRAPHCHI_LABELANALYSIS


	)

47 
usšg
 
Çme¥aû
 
	gg¿phchi
;

49 
	g‹m¶©e
 <
ty³Çme
 
	gLab–Ty³
>

50 
	sÏb–couÁ_‰
 {

51 
Lab–Ty³
 
	mÏb–
;

52 
	mcouÁ
;

53 
Ïb–couÁ_‰
(
Lab–Ty³
 
l
, 
c
è: 
Ïb–
Ö), 
couÁ
(c) {}

54 
Ïb–couÁ_‰
() {}

57 
	g‹m¶©e
 <
ty³Çme
 
	gLab–Ty³
>

58 
boŞ
 
Ïb–_couÁ_g»©”
(cÚ¡ 
Ïb–couÁ_‰
<
Lab–Ty³
> &
a
, cÚ¡†ab–couÁ_‰<Lab–Ty³> &
b
) {

59  
	ga
.
	gcouÁ
 > 
	gb
.count;

62 
	g‹m¶©e
 <
ty³Çme
 
	gLab–Ty³
>

63 
ª®yze_Ïb–s2
(
¡d
::
¡ršg
 
ba£_f’ame
, 
FILE
 * 
pfe
, 
´š‰İ
 = 20) {

64 
Ïb–couÁ_‰
<
	tLab–Ty³
> 
	tÏb–couÁ_t
;

70 
	g¡d
::
¡ršg
 
f’ame
 = 
f’ame_v”‹x_d©a
<
Lab–Ty³
>(
ba£_f’ame
);

71 
m‘rics
 
m
("labelanalysis");

72 
¡redio
 * 
	giomgr
 = 
Ãw
 sŒedio(
m
);

73 
	gf
 = 
iomgr
->
İ’_£ssiÚ
(
f’ame
, 
Œue
);

74 
size_t
 
	gsz
 = 
g‘_fesize
(
f’ame
);

77 
size_t
 
	gbufsize
 = 1024 * 1024;

78 
	gnbuf
 = (è(
bufsize
 / (
Lab–Ty³
));

80 
	g¡d
::
veùÜ
<
Ïb–couÁ_t
> 
cu¾ab–s
;

81 
size_t
 
	gÄ—d
 = 0;

82 
boŞ
 
	gfœ¡
 = 
Œue
;

83 
vid_t
 
	gcurvid
 = 0;

84 
Lab–Ty³
 * 
	gbufãr
 = (Lab–Ty³*è
ÿÎoc
(
nbuf
, (LabelType));

86 
	gÄ—d
 < 
	gsz
) {

87 
size_t
 
	gËn
 = 
¡d
::
mš
(
sz
 - 
Ä—d
, 
bufsize
);

88 
	giomgr
->
´—da_now
(
f
, 
bufãr
, 
Ën
, 
Ä—d
);

89 
	gÄ—d
 +ğ
Ën
;

91 
	gÁ
 = (è(
Ën
 / (
Lab–Ty³
));

94 
	gi
=0; i < 
	gÁ
; i++) {

95 
Lab–Ty³
 
	gl
 = 
bufãr
[
i
];

96 ià(
	gcurvid
 > 0)

97 
årštf
(
pfe
, "%d 1 %d\n", 
curvid
, 
l
);

98 ià(
	gl
 =ğ
curvid
è
bufãr
[
i
] = 0xffffffff;

99 
	gcurvid
++;

103 
quickSÜt
(
bufãr
, 
Á
, 
¡d
::
Ëss
<
Lab–Ty³
>());

106 
	g¡d
::
veùÜ
<
Ïb–couÁ_t
> 
ÃwÏb–s
;

107 
	gÃwÏb–s
.
»£rve
(
Á
);

108 
vid_t
 
	gÏ¡Ïb–
 = 0xffffffff;

109 
	gi
=0; i < 
	gÁ
; i++) {

110 ià(
	gbufãr
[
i
] != 0xffffffff) {

111 ià(
bufãr
[
i
] !ğ
Ï¡Ïb–
) {

112 
ÃwÏb–s
.
push_back
(
Ïb–couÁ_t
(
bufãr
[
i
], 1));

114 
	gÃwÏb–s
[
ÃwÏb–s
.
size
(è- 1].
	gcouÁ
 ++;

116 
	gÏ¡Ïb–
 = 
bufãr
[
i
];

120 ià(
	gfœ¡
) {

121 
	gi
=0; i < ()
	gÃwÏb–s
.
size
(); i++) {

122 
	gcu¾ab–s
.
push_back
(
ÃwÏb–s
[
i
]);

127 
	gş
 = 0;

128 
	gÆ
 = 0;

129 
	g¡d
::
veùÜ
< 
Ïb–couÁ_t
 > 
m”ged
;

130 
	gm”ged
.
»£rve
(
cu¾ab–s
.
size
(è+ 
ÃwÏb–s
.size());

131 
	gş
 < ()
	gcu¾ab–s
.
size
(è&& 
	gÆ
 < ()
	gÃwÏb–s
.size()) {

132 ià(
	gÃwÏb–s
[
Æ
].
	gÏb–
 =ğ
cu¾ab–s
[
ş
].
Ïb–
) {

133 
m”ged
.
push_back
(
Ïb–couÁ_t
(
ÃwÏb–s
[
Æ
].
Ïb–
,‚ewÏb–s[Æ].
couÁ
 + 
cu¾ab–s
[
ş
].count));

134 
	gÆ
++; 
	gş
++;

136 ià(
	gÃwÏb–s
[
Æ
].
	gÏb–
 < 
	gcu¾ab–s
[
ş
].label) {

137 
	gm”ged
.
push_back
(
ÃwÏb–s
[
Æ
]);

138 
	gÆ
++;

140 
	gm”ged
.
push_back
(
cu¾ab–s
[
ş
]);

141 
	gş
++;

145 
	gş
 < ()
	gcu¾ab–s
.
size
()è
	gm”ged
.
push_back
(
cu¾ab–s
[
ş
++]);

146 
	gÆ
 < ()
	gÃwÏb–s
.
size
()è
	gm”ged
.
push_back
(
ÃwÏb–s
[
Æ
++]);

148 
	gcu¾ab–s
 = 
m”ged
;

151 
	gfœ¡
 = 
çl£
;

155 
	g¡d
::
sÜt
(
cu¾ab–s
.
begš
(), cu¾ab–s.
’d
(), 
Ïb–_couÁ_g»©”
<
Lab–Ty³
>);

158 
	g¡d
::
¡ršg
 
ouŠame
 = 
ba£_f’ame
 + "_components.txt";

159 
FILE
 * 
	g»sf
 = 
fİ’
(
ouŠame
.
c_¡r
(), "w");

160 ià(
	g»sf
 =ğ
NULL
) {

161 
log¡»am
(
LOG_ERROR
è<< "Could‚Ù wr™Ïb– ouutf: " << 
ouŠame
 << 
¡d
::
’dl
;

164 
	gi
=0; i < (è
	gcu¾ab–s
.
size
(); i++) {

165 
årštf
(
»sf
, "%u,%u\n", 
cu¾ab–s
[
i
].
Ïb–
, cu¾ab–s[i].
couÁ
 + 1);

167 
fşo£
(
»sf
);

169 
	g¡d
::
cout
 << "TÙ®‚umb” oàdifã»Á†ab– (compÚ’ts/commun™›s): " << 
cu¾ab–s
.
size
(è<< 
¡d
::
’dl
;

170 
	g¡d
::
cout
 << "Li¡ oàÏb– wa wr™‹ÀtØfe: " << 
ouŠame
 << 
¡d
::
’dl
;

172 
	gi
=0; i < ()
	g¡d
::
mš
((
size_t
)
´š‰İ
, 
cu¾ab–s
.
size
()); i++) {

173 
	g¡d
::
cout
 << (
i
+1è<< ".†ab–: " << 
cu¾ab–s
[i].
Ïb–
 << ", size: " << cu¾ab–s[i].
couÁ
 << 
¡d
::
’dl
;

176 
	giomgr
->
şo£_£ssiÚ
(
f
);

177 
d–‘e
 
	giomgr
;

	@toolkits/graph_analytics/subgraph.cpp

31 
	~<cm©h
>

32 
	~<c¡dio
>

33 
	~<lim™s
>

34 
	~<io¡»am
>

35 
	~<£t
>

36 
	~"g¿phchi_basic_šşudes.hµ
"

37 
	~"­i/chif’ames.hµ
"

38 
	~"­i/v”‹x_agg»g©Ü.hµ
"

39 
	~"´•roûssšg/sh¬d”.hµ
"

40 
	~"../cŞÏbÜ©ive_f‹ršg/ut.hµ
"

41 
	~"../cŞÏbÜ©ive_f‹ršg/eig’_w¿µ”.hµ
"

42 
	~"../cŞÏbÜ©ive_f‹ršg/tim”.hµ
"

43 
	~"../cŞÏbÜ©ive_f‹ršg/commÚ.hµ
"

45 
usšg
 
Çme¥aû
 
	gg¿phchi
;

46 
usšg
 
Çme¥aû
 
	g¡d
;

48 
	gsqu¬e
 = 0;

49 
	gtok’s_³r_row
 = 3;

50 
	g_deg»e
 = 0;

51 
	g£ed_edges_Úly
 = 0;

52 
	gundœeùed
 = 1;

53 
	g¡d
::
¡ršg
 
cc
;

54 
size_t
 
	gsšgËtÚ_nodes
 = 0;

55 
boŞ
 
	gdebug
 = 
çl£
;

56 
	gmax_™”
 = 50;

57 
	gi™”
 = 0;

58 
ušt
 
	gnum_aùive
 = 0;

59 
ušt
 
	glšks
 = 0;

60 
mu‹x
 
	gmymu‹x
;

61 
tim”
 
	gmytim”
;

62 
FILE
 * 
	gpfe
 = 
NULL
;

63 
size_t
 
	gedges
 = 1000;

64 
size_t
 
	gnodes
 = 0;

65 
size_t
 
	gÜig_edges
 = 0;

66 
	gmš_¿nge
 = 0;

67 
	gmax_¿nge
 = 2400000000;

69 
	sv”‹x_d©a
 {

70 
boŞ
 
	maùive
;

71 
boŞ
 
	mdÚe
;

72 
boŞ
 
	mÃxt_aùive
;

73 
	mcompÚ’t
;

74 
vec
 
	mpvec
;

75 
v”‹x_d©a
(è: 
aùive
(
çl£
), 
dÚe
(çl£), 
Ãxt_aùive
(çl£), 
compÚ’t
(0) {}

76 
£t_v®
(
šdex
, 
v®
){};

77 
g‘_v®
(
šdex
){  0; }

82 
	sedge_d©a
 {

83 
edge_d©a
() { }

85 
edge_d©a
(
v®
) { }

86 
edge_d©a
(
v®
, 
time
) { }

91 
v”‹x_d©a
 
	tV”‹xD©aTy³
;

92 
edge_d©a
 
	tEdgeD©aTy³
;

94 
	gg¿phchi_’gše
<
	gV”‹xD©aTy³
, 
	gEdgeD©aTy³
> * 
	g³ngše
 = 
NULL
;

95 
	g¡d
::
veùÜ
<
v”‹x_d©a
> 
Ï‹Á_çùÜs_šmem
;

97 
vec
 
	gcompÚ’t_edges
;

98 
vec
 
	gcompÚ’t_nodes
;

99 
vec
 
	gcompÚ’t_£eds
;

100 
size_t
 
	gchªges
 = 0;

101 
	~"../cŞÏbÜ©ive_f‹ršg/io.hµ
"

103 
	gSubg¿phsProg¿m
 : 
public
 
G¿phChiProg¿m
<
V”‹xD©aTy³
, 
	gEdgeD©aTy³
> {

108 
upd©e
(
g¿phchi_v”‹x
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> &
v”‹x
, 
g¿phchi_cÚ‹xt
 &
gcÚ‹xt
) {

110 
	gv”‹x_d©a
 & 
	gvd©a
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
id
()];

113 ià(
	g_deg»e
){

114 ià(
	gv”‹x
.
num_edges
(è> 0 || 
	gmax_¿nge
 != 2400000000)

115 ià(
v”‹x
.
id
(è>ğ(
ušt
)
mš_¿nge
 && v”‹x.id(è< (ušt)
max_¿nge
)

116 
årštf
(
pfe
, "%u %u\n", 
v”‹x
.
id
()+1, v”‹x.
num_edges
());

120 ià(
	gcc
 != ""){

121 
as£¹
(
vd©a
.
compÚ’t
>ğ0 && vd©a.compÚ’ˆ< 
compÚ’t_nodes
.
size
());

122 ià(
	gdebug
 && 
	gvd©a
.
	gcompÚ’t
 == 9322220)

123 
log¡»am
(
LOG_DEBUG
)<<"Nod" << 
v”‹x
.
id
(è<< " ha " << v”‹x.
num_edges
(è<< 
¡d
::
’dl
;

125 ià(
	gvd©a
.
	gcompÚ’t
 == 0)

128 
	gmymu‹x
.
lock
();

129 
	gcompÚ’t_nodes
[
vd©a
.
compÚ’t
]++;

130 
	gmymu‹x
.
uÆock
();

132 ià(
	gv”‹x
.
num_edges
() == 0){

133 
mymu‹x
.
lock
();

134 
	gsšgËtÚ_nodes
++;

135 
	gmymu‹x
.
uÆock
();

138 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

139 
	gv”‹x_d©a
 & 
	gÙh”
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

140 ià(
	gdebug
 && 
	gvd©a
.
	gcompÚ’t
 == 9322220)

141 
log¡»am
(
LOG_DEBUG
)<<"Gošg ov”ƒdge: " << 
v”‹x
.
id
(è<< "=>" << v”‹x.
edge
(
e
)->
v”‹x_id
(è<< " compÚ’t: " << 
vd©a
.
compÚ’t
 <<" : "<<
Ùh”
.compÚ’t<< " s“d? " << vd©a.
aùive
 << 
¡d
::
’dl
;

143 ià(
	gvd©a
.
	gcompÚ’t
 !ğ
Ùh”
.
compÚ’t
)

144 
log¡»am
(
LOG_FATAL
)<<"BUG Gošg ov”ƒdge: " << 
v”‹x
.
id
(è<< "=>" << v”‹x.
edge
(
e
)->
v”‹x_id
(è<< " compÚ’t: " << 
vd©a
.
compÚ’t
 <<" : "<<
Ùh”
.compÚ’t<< " s“d? " << vd©a.
aùive
 << 
¡d
::
’dl
;

145 ià(
	gv”‹x
.
id
(è< v”‹x.
edge
(
e
)->
v”‹x_id
()){

147 ià(
	gdebug
 && 
	gÙh”
.
	gcompÚ’t
 == 9322220)

148 
log¡»am
(
LOG_INFO
)<<"Added‡ÀedgfÜ compÚ’t: " << 
Ùh”
.
compÚ’t
 << 
¡d
::
’dl
;

149 
	gmymu‹x
.
lock
();

150 
	gcompÚ’t_edges
[
vd©a
.
compÚ’t
]++;

151 
	gmymu‹x
.
uÆock
();

157 ià(!
	gvd©a
.
	gaùive
)

160 
	gmymu‹x
.
lock
();

161 
	gnum_aùive
++;

163 
	g¡d
::
£t
<
ušt
> 
my£t
;

164 
	g¡d
::
£t
<
ušt
>::
™”©Ü
 
™
;

166 
	ge
=0;ƒ < 
	gv”‹x
.
num_edges
();ƒ++) {

167 
	gv”‹x_d©a
 & 
	gÙh”
 = 
Ï‹Á_çùÜs_šmem
[
v”‹x
.
edge
(
e
)->
v”‹x_id
()];

168 ià(
	glšks
 >ğ
edges
)

170 ià(
	gÙh”
.
	gdÚe
)

172 ià(
	g£ed_edges_Úly
 && !
	gÙh”
.
	gaùive
)

175 ià(
	gundœeùed
){

176 
	g™
 = 
my£t
.
fšd
(
v”‹x
.
edge
(
e
)->
v”‹x_id
());

177 ià(
	g™
 !ğ
my£t
.
’d
())

180 
årštf
(
pfe
, "%u %u %u\n", 
v”‹x
.
id
()+1, v”‹x.
edge
(
e
)->
v”‹x_id
()+1,
i™”
+1);

181 ià(
	gundœeùed
)

182 
	gmy£t
.
š£¹
(
v”‹x
.
edge
(
e
)->
v”‹x_id
());

183 ià(
	gdebug
 && (
	gv”‹x
.
id
()+1 =ğ9322220 || 
v”‹x
.
edge
(
e
)->
v”‹x_id
()+1 == 9322220))

184 
cout
<<"Foundƒdge: $$$$ " << 
v”‹x
.
id
(è<< " => " << v”‹x.
edge
(
e
)->
v”‹x_id
()+1 << " oth”.dÚ" << 
Ùh”
.
dÚe
 << 
’dl
;

185 
	glšks
++;

186 ià(!
	gÙh”
.
	gdÚe
){

187 
	gÙh”
.
	gÃxt_aùive
 = 
Œue
;

190 
	gvd©a
.
	gaùive
=
çl£
;

191 
	gvd©a
.
	gdÚe
 = 
Œue
;

192 
	gmymu‹x
.
uÆock
();

201 
	$maš
(
¬gc
, cÚ¡ *
¬gv
[]) {

203 
	`log¡»am
(
LOG_WARNING
)<<"GraphChi graph‡nalytics†ibrary is written by Danny Bickson (c). Send‡ny "

204 " comm’t Ü bug„•Üt tØdªny.bicksÚ@gma.com " << 
¡d
::
’dl
;

207 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

211 
m‘rics
 
	`m
("subgraph-inmemory-factors");

213 
¡d
::
¡ršg
 
d©afe
;

214 
max_™”
 = 
	`g‘_İtiÚ_št
("hops", 3);

215 
boŞ
 
qu›t
 = 
	`g‘_İtiÚ_št
("quiet", 0);

216 
undœeùed
 = 
	`g‘_İtiÚ_št
("undirected", undirected);

217 ià(
qu›t
)

218 
	`glob®_logg”
().
	`£t_log_Ëv–
(
LOG_ERROR
);

219 
debug
 = 
	`g‘_İtiÚ_št
("debug", 0);

220 
d©afe
 = 
	`g‘_İtiÚ_¡ršg
("training");

221 
squ¬e
 = 
	`g‘_İtiÚ_št
("square", 0);

222 
tok’s_³r_row
 = 
	`g‘_İtiÚ_št
("tokens_per_row",okens_per_row);

223 
edges
 = 
	`g‘_İtiÚ_št
("edges", 2460000000);

224 
nodes
 = 
	`g‘_İtiÚ_št
("nodes",‚odes);

225 
Üig_edges
 = 
	`g‘_İtiÚ_št
("orig_edges", orig_edges);

226 
_deg»e
 = 
	`g‘_İtiÚ_št
("degree", _degree);

227 
cc
 = 
	`g‘_İtiÚ_¡ršg
("cc", cc);

228 
£ed_edges_Úly
 = 
	`g‘_İtiÚ_št
("seed_edges_only", seed_edges_only);

230 ià(
_deg»e
 || 
cc
 !ğ"" || 
£ed_edges_Úly
)

231 
max_™”
 = 1;

233 
¡d
::
¡ršg
 
£eds
 = 
	`g‘_İtiÚ_¡ršg
("seeds","");

234 
¡d
::
¡ršg
 
£ed_fe
 = 
	`g‘_İtiÚ_¡ršg
("seed_file", "");

235 
mš_¿nge
 = 
	`g‘_İtiÚ_št
("min_range", min_range);

236 
max_¿nge
 = 
	`g‘_İtiÚ_št
("max_range", max_range);

238 
mytim”
.
	`¡¬t
();

243 
nsh¬ds
 = 0;

244 ià(
tok’s_³r_row
 == 4 )

245 
cÚv”t_m©rixm¬k‘4
<
edge_d©a
>(
d©afe
, 
çl£
, 
squ¬e
);

246 ià(
tok’s_³r_row
 == 3 ||okens_per_row == 2)

247 
cÚv”t_m©rixm¬k‘
<
edge_d©a
>(
d©afe
, 
NULL
, 
nodes
, 
Üig_edges
, 
tok’s_³r_row
);

248 
	`log¡»am
(
LOG_FATAL
)<<"PËa£ u£ --tok’s_³r_row=2 o¸--tok’s_³r_row=3 o¸--tok’s_³r_row=4" << 
¡d
::
’dl
;

250 
Ï‹Á_çùÜs_šmem
.
	`»size
(
squ¬e
? 
¡d
::
	`max
(
M
,
N
) : M+N);

252 
vec
 
v£ed
;

253 ià(!
_deg»e
){

254 ià(
£ed_fe
 == ""){

255 ià(
£eds
 == "")

256 
	`log¡»am
(
LOG_FATAL
)<<"Mu¡ s³cifyƒ™h” s“d Ü s“d_fe"<<
¡d
::
’dl
;

257 * 
p£eds
 = 
	`¡rdup
(
£eds
.
	`c_¡r
());

258 * 
pch
 = 
	`¡¹ok
(
p£eds
, ",\n\r\t ");

259 
node
 = 
	`©oi
(
pch
);

260 
Ï‹Á_çùÜs_šmem
[
node
-1].
aùive
 = 
Œue
;

261 (
pch
 = 
	`¡¹ok
(
NULL
, ",\n\r\t "))!= NULL){

262 
node
 = 
	`©oi
(
pch
);

263 
Ï‹Á_çùÜs_šmem
[
node
-1].
aùive
 = 
Œue
;

267 
v£ed
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
£ed_fe
, 
çl£
, false);

268 
i
=0; i< 
v£ed
.
	`size
(); i++){

269 
	`as£¹
(
v£ed
[
i
] > 0 && v£ed[i] <ğ
Ï‹Á_çùÜs_šmem
.
	`size
());

270 
Ï‹Á_çùÜs_šmem
[
v£ed
[
i
]-1].
aùive
 = 
Œue
;

274 
vec
 
compÚ’ts
;

277 ià(
cc
 != ""){

278 
compÚ’ts
 = 
	`lßd_m©rix_m¬k‘_veùÜ
(
cc
, 
çl£
,
Œue
);

279 
	`as£¹
(()
compÚ’ts
.
	`size
(è<ğ(è
Ï‹Á_çùÜs_šmem
.size());

280 
ušt
 
i
=0; i< 
compÚ’ts
.
	`size
(); i++){

281 
	`as£¹
(
i
+1 < 
Ï‹Á_çùÜs_šmem
.
	`size
());

282 
	`as£¹
(
compÚ’ts
[
i
] >ğ1 && compÚ’ts[i] <ğ
nodes
);

283 ià(
debug
 && 
compÚ’ts
[
i
] == 9322220)

284 
	`log¡»am
(
LOG_DEBUG
)<<"S‘tšg‚od: " <<
i
<<" compÚ’ˆ: " << 
compÚ’ts
[i] << 
¡d
::
’dl
;

285 
Ï‹Á_çùÜs_šmem
[
i
].
compÚ’t
 = 
compÚ’ts
[i];

287 
compÚ’t_edges
 = 
	`z”os
(
nodes
);

288 
compÚ’t_nodes
 = 
	`z”os
(
nodes
);

289 
compÚ’t_£eds
 = 
	`z”os
(
nodes
);

290 
ušt
 
i
=0; i< 
v£ed
.
	`size
(); i++){

291 
	`as£¹
(
v£ed
[
i
] >ğ1 && v£ed[i] <ğ
Ï‹Á_çùÜs_šmem
.
	`size
());

292 
compÚ’t_£eds
[
Ï‹Á_çùÜs_šmem
[
v£ed
[
i
]-1].
compÚ’t
]++;

294 
	`as£¹
(
	`sum
(
compÚ’t_£eds
è=ğ
v£ed
.
	`size
());

296 ià(
£ed_edges_Úly
){

297 
ušt
 
i
=0; i< 
Ï‹Á_çùÜs_šmem
.
	`size
(); i++){

298 
v”‹x_d©a
 & 
vd©a
 = 
Ï‹Á_çùÜs_šmem
[
i
];

299 ià(!
vd©a
.
aùive
)

300 
vd©a
.
dÚe
 = 
Œue
;

304 
¡d
::
¡ršg
 
suffix
;

305 ià(
cc
 != "")

306 
suffix
 = "-cc.txt";

307 ià(
£ed_edges_Úly
)

308 
suffix
 = "-subset.txt";

309 ià(
_deg»e
)

310 
suffix
 = "-degree.txt";

311 
suffix
 = "-subgraph.txt";

313 
pfe
 = 
	`İ’_fe
((
d©afe
 + 
suffix
).
	`c_¡r
(), "w", 
çl£
);

314 
¡d
::
cout
<<"Wr™šg ouuˆto: " << 
d©afe
 << 
suffix
 << std::
’dl
;

316 
num_aùive
 = 0;

317 
g¿phchi_’gše
<
V”‹xD©aTy³
, 
EdgeD©aTy³
> 
	`’gše
(
d©afe
, 
nsh¬ds
, 
çl£
, 
m
);

318 
	`£t_’gše_æags
(
’gše
);

319 
’gše
.
	`£t_maxwšdow
(
nodes
+1);

320 
Subg¿phsProg¿m
 
´og¿m
;

321 
i™”
=0; i™”< 
max_™”
; iiter++){

325 
’gše
.
	`run
(
´og¿m
, 1);

326 
¡d
::
cout
<< 
i™”
 << "è" << 
mytim”
.
	`cu¼’t_time
(è<< " Numb” oàaùivnodes: " << 
num_aùive
 <<" Numb” oàlšks: " << 
lšks
 << std::
’dl
;

327 
ušt
 
i
=0; i< 
Ï‹Á_çùÜs_šmem
.
	`size
(); i++){

328 ià(
Ï‹Á_çùÜs_šmem
[
i
].
Ãxt_aùive
 && !Ï‹Á_çùÜs_šmem[i].
dÚe
){

329 
Ï‹Á_çùÜs_šmem
[
i
].
Ãxt_aùive
 = 
çl£
;

330 
Ï‹Á_çùÜs_šmem
[
i
].
aùive
 = 
Œue
;

333 ià(
lšks
 >ğ
edges
){

334 
¡d
::
cout
<<"G¿bbedƒnoughƒdges!" << std::
’dl
;

339 ià(
cc
 != ""){

340 
	`log¡»am
(
LOG_INFO
)<<"compÚ’ˆnode sum: " << 
	`sum
(
compÚ’t_nodes
è<< 
¡d
::
’dl
;

341 
	`log¡»am
(
LOG_INFO
)<<"compÚ’ˆedge sum: " << 
	`sum
(
compÚ’t_edges
è<< 
¡d
::
’dl
;

343 
tÙ®_wr™‹n
 = 0;

344 
	`as£¹
(
	`sum
(
compÚ’t_nodes
è=ğ
compÚ’ts
.
	`size
());

345 
	`as£¹
(
pfe
 !ğ
NULL
);

346 
tÙ®_£eds
 = 0;

347 
ušt
 
i
=0; i< 
compÚ’t_nodes
.
	`size
(); i++){

348 ià(
compÚ’t_nodes
[
i
] > 1 || 
compÚ’t_edges
[i] > 0){

349 
	`årštf
(
pfe
, "%d %d %d %d\n", 
i
, ()
compÚ’t_nodes
[i], ()
compÚ’t_edges
[i], ()
compÚ’t_£eds
[i]);

350 
tÙ®_wr™‹n
++;

351 
tÙ®_£eds
+ğ
compÚ’t_£eds
[
i
];

353 ià(
compÚ’t_nodes
[
i
] > 1 && 
compÚ’t_edges
[i] == 0)

354 
	`log¡»am
(
LOG_FATAL
)<<"Bug: compÚ’ˆ" << 
i
 << " ha " << 
compÚ’t_nodes
[i] << " buˆnÙƒdges!" <<
¡d
::
’dl
;

355 ià(
compÚ’t_nodes
[
i
] =ğ0 && 
compÚ’t_edges
[i] > 0)

356 
	`log¡»am
(
LOG_FATAL
)<<"Bug: compÚ’ˆ" << 
i
 << " ha " << 
compÚ’t_edges
[i] << " buˆnÙ‚odes!" <<
¡d
::
’dl
;

357 ià(
compÚ’t_£eds
[
i
] =ğ0 && 
compÚ’t_edges
[i] > 0)

358 
	`log¡»am
(
LOG_FATAL
)<<"Bug: compÚ’ˆ" << 
i
 << " ha " << 
compÚ’t_edges
[i] << " buˆnÙ s“ds!" << 
¡d
::
’dl
;

359 ià(
compÚ’t_edges
[
i
] > 0 && compÚ’t_edges[i]+2 < 
compÚ’t_nodes
[i] )

360 
	`log¡»am
(
LOG_FATAL
)<<"Bug: compÚ’ˆ" << 
i
 << " ha missšgƒdges: " << 
compÚ’t_edges
[i] << "‚odes: " << 
compÚ’t_nodes
[i] << 
¡d
::
’dl
;

361 ià(
compÚ’t_nodes
[
i
] =ğ2 && 
compÚ’t_edges
[i] == 2)

362 
	`log¡»am
(
LOG_FATAL
)<<"Bug: compÚ’ˆ" << 
i
 << " 2‚ode +2ƒdges: " << 
compÚ’t_edges
[i] << "‚odes: " << 
compÚ’t_nodes
[i] << 
¡d
::
’dl
;

365 
	`log¡»am
(
LOG_INFO
)<<"tÙ® wr™‹ÀcompÚ’ts: " << 
tÙ®_wr™‹n
 << " sum : " << 
	`sum
(
compÚ’t_nodes
è<< 
¡d
::
’dl
;

366 
	`log¡»am
(
LOG_INFO
)<<"SšgËtÚ‚ode ÒØedges): " << 
sšgËtÚ_nodes
 << 
¡d
::
’dl
;

367 
	`log¡»am
(
LOG_INFO
)<<"TÙ® s“ds: " << 
tÙ®_£eds
 << 
¡d
::
’dl
;

370 
¡d
::
cout
<< 
i™”
 << "èNumb” oàaùivnodes: " << 
num_aùive
 <<" Numb” oàlšks: " << 
lšks
 << std::
’dl
;

372 
¡d
::
cout
 << "subg¿ph fšished iÀ" << 
mytim”
.
	`cu¼’t_time
(è<< std::
’dl
;

373 
¡d
::
cout
 << "Numb” oà·s£s: " << 
i™”
<< std::
’dl
;

374 
¡d
::
cout
 << "TÙ®‡ùivnodes: " << 
num_aùive
 << "ƒdges: " << 
lšks
 << std::
’dl
;

376 
	`fæush
(
pfe
);

377 
	`fşo£
(
pfe
);

379  
EXIT_SUCCESS
;

380 
	}
}

	@toolkits/parsers/adj.cpp

25 
	~<c¡dio
>

26 
	~<m­
>

27 
	~<io¡»am
>

28 
	~<m­
>

29 
	~<omp.h
>

30 
	~<as£¹.h
>

31 
	~"g¿phchi_basic_šşudes.hµ
"

32 
	~"../cŞÏbÜ©ive_f‹ršg/tim”.hµ
"

33 
	~"../cŞÏbÜ©ive_f‹ršg/ut.hµ
"

34 
	~"../../exam¶e_­ps/m©rix_çùÜiz©iÚ/m©rixm¬k‘/mmio.h
"

35 
	~"../../exam¶e_­ps/m©rix_çùÜiz©iÚ/m©rixm¬k‘/mmio.c
"

37 
usšg
 
Çme¥aû
 
	g¡d
;

38 
usšg
 
Çme¥aû
 
	gg¿phchi
;

40 
boŞ
 
	gdebug
 = 
çl£
;

41 
	gm­
<
	g¡ršg
,
	gušt
> 
	g¡ršg2nodeid
;

42 
	gm­
<
	gušt
,
	g¡ršg
> 
	gnodeid2hash
;

43 
	gm­
<
	g¡ršg
,
	gušt
> 
	g¡ršg2nodeid2
;

44 
	gm­
<
	gušt
,
	g¡ršg
> 
	gnodeid2hash2
;

45 
ušt
 
	gcÚ£q_id
;

46 
ušt
 
	gcÚ£q_id2
;

47 
mu‹x
 
	gmymu‹x
;

48 
tim”
 
	gmytime
;

49 
size_t
 
	glšes
;

50 
	gtÙ®_lšes
 = 0;

51 
¡ršg
 
	gdœ
;

52 
¡ršg
 
	goutdœ
;

53 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
š_fes
;

54 
ušt
 
	gM
,
	gN
;

55 
size_t
 
	gÂz
 = 0;

56 cÚ¡ * 
	g¡ršg_to_tok’ize
;

57 
	gcsv
 = 0;

58 
	gtsv
 = 0;

59 
	gbš¬y
 = 0;

60 
	gsšgË_domaš
 = 0;

61 cÚ¡ * 
	g¥aûs
 = " \r\n\t";

62 cÚ¡ * 
	gtsv_¥aûs
 = "\t\n";

63 cÚ¡ * 
	gcsv_¥aûs
 = ",\n";

66 
§ve_m­_to_‹xt_fe
(cÚ¡ 
¡d
::
m­
<¡d::
¡ršg
,
ušt
> & m­, cÚ¡ std::¡ršg 
f’ame
){

67 
¡d
::
m­
<¡d::
¡ršg
,
	gušt
>::
cÚ¡_™”©Ü
 
™
;

68 
out_fe
 
fout
(
f’ame
);

69 
	gtÙ®
 = 0;

70 
	g™
 = 
m­
.
begš
(); iˆ!ğm­.
’d
(); it++){

71 
årštf
(
fout
.
outf
, "% %u\n", 
™
->
fœ¡
.
c_¡r
(), it->
£cÚd
);

72 
	gtÙ®
++;

74 
log¡»am
(
LOG_INFO
)<<"WrÙ¨tÙ® oà" << 
	gtÙ®
 << " m­ƒÁr› tØ‹xˆfe: " << 
	gf’ame
 << 
	g¡d
::
’dl
;

78 
§ve_m­_to_‹xt_fe
(cÚ¡ 
¡d
::
m­
<
ušt
,¡d::
¡ršg
> & m­, cÚ¡ std::¡ršg 
f’ame
){

79 
¡d
::
m­
<
ušt
,
	g¡d
::
¡ršg
>::
cÚ¡_™”©Ü
 
™
;

80 
out_fe
 
fout
(
f’ame
);

81 
	gtÙ®
 = 0;

82 
	g™
 = 
m­
.
begš
(); iˆ!ğm­.
’d
(); it++){

83 
årštf
(
fout
.
outf
, "%u %s\n", 
™
->
fœ¡
, it->
£cÚd
.
c_¡r
());

84 
	gtÙ®
++;

86 
log¡»am
(
LOG_INFO
)<<"WrÙ¨tÙ® oà" << 
	gtÙ®
 << " m­ƒÁr› tØ‹xˆfe: " << 
	gf’ame
 << 
	g¡d
::
’dl
;

92 
assign_id
(
m­
<
¡ršg
,
ušt
> & 
¡ršg2nodeid
, m­<ušt,¡ršg> & 
nodeid2hash
, ušˆ& 
outv®
, cÚ¡ sŒšg &
Çme
, 
boŞ
 
äom
){

94 
	gm­
<
	g¡ršg
,
	gušt
>::
™”©Ü
 
™
 = 
¡ršg2nodeid
.
fšd
(
Çme
);

96 ià(
	g™
 !ğ
¡ršg2nodeid
.
’d
()){

97 
outv®
 = 
™
->
£cÚd
;

100 
	gmymu‹x
.
lock
();

102 
	goutv®
 = 
¡ršg2nodeid
[
Çme
];

103 ià(
	goutv®
 == 0){

105 
¡ršg2nodeid
[
Çme
] = (
äom
? ++
cÚ£q_id
 : ++
cÚ£q_id2
);

107 
	goutv®
 = (
äom
? 
cÚ£q_id
 : 
cÚ£q_id2
);

109 
	gnodeid2hash
[
outv®
] = 
Çme
;

110 ià(
	gäom
)

111 
	gM
 = 
¡d
::
max
(
M
, 
cÚ£q_id
);

113 
	gN
 = 
¡d
::
max
(
N
, 
cÚ£q_id2
);

115 
	gmymu‹x
.
uÆock
();

127 
	$·r£
(
i
){

128 
š_fe
 
	`fš
(
š_fes
[
i
]);

129 
out_fe
 
	`fout
((
outdœ
 + 
š_fes
[
i
] + ".out"));

131 
size_t
 
lšesize
 = 0;

132 * 
§v•Œ
 = 
NULL
, * 
lšebuf
 = NULL;

133 
lšebuf_debug
[1024];

134 
size_t
 
lše
 = 1;

135 
ušt
 
äom
,
to
;

136 
boŞ
 
m©rix_m¬k‘
 = 
çl£
;

138 
Œue
){

139 
rc
 = 
	`g‘lše
(&
lšebuf
, &
lšesize
, 
fš
.
outf
);

140 
	`¡ºıy
(
lšebuf_debug
, 
lšebuf
, 1024);

141 ià(
rc
 < 1)

143 ià(
	`¡¾’
(
lšebuf
) <= 1)

146 ià(!
	`¡ºcmp
(
lšebuf
, "%%MatrixMarket", 14)){

147 
m©rix_m¬k‘
 = 
Œue
;

150 ià(
m©rix_m¬k‘
 && 
lšebuf
[0] == '%'){

153 ià(
m©rix_m¬k‘
 && 
lšebuf
[0] != '%'){

154 
m©rix_m¬k‘
 = 
çl£
;

159 *
pch
 = 
	`¡¹ok_r
(
lšebuf
,
¡ršg_to_tok’ize
, &
§v•Œ
);

160 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf_debug
 << "]" << 
¡d
::
’dl
; ; }

161 
	`assign_id
(
¡ršg2nodeid
,
nodeid2hash
, 
äom
, 
pch
, 
Œue
);

164 
pch
 = 
	`¡¹ok_r
(
NULL
,
¡ršg_to_tok’ize
, &
§v•Œ
);

165 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf_debug
 << "]" << 
¡d
::
’dl
; ; }

166 
num_edges
 = 
	`©oi
(
pch
);

167 ià(
num_edges
 < 0)

168 { 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf_debug
 << "] -‚umb” oàedge < 0" << 
¡d
::
’dl
; ; }

170 
k
=0; k< 
num_edges
; k++){

171 
pch
 = 
	`¡¹ok_r
(
NULL
, "\n\t\r, ", &
§v•Œ
);

172 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf_debug
 << "]" << 
¡d
::
’dl
; ; }

174 
	`assign_id
(
sšgË_domaš
 ? 
¡ršg2nodeid
:
¡ršg2nodeid2
,

175 
sšgË_domaš
 ? 
nodeid2hash
 : 
nodeid2hash2
, 
to
, 
pch
, sšgË_domaš ? 
Œue
 : 
çl£
);

176 ià(
tsv
)

177 
	`årštf
(
fout
.
outf
, "%u\t%u\n", 
äom
, 
to
);

178 ià(
csv
)

179 
	`årštf
(
fout
.
outf
, "%u,%un", 
äom
, 
to
);

181 
	`årštf
(
fout
.
outf
, "%u %u\n", 
äom
, 
to
);

182 
Âz
++;

185 
lše
++;

186 
tÙ®_lšes
++;

187 ià(
lšes
 && 
lše
>=lines)

190 ià(
debug
 && (
lše
 % 50000 == 0))

191 
	`log¡»am
(
LOG_INFO
è<< "P¬£d†še: " << 
lše
 << " m­ sizis: " << 
¡ršg2nodeid
.
	`size
(è<< 
¡d
::
’dl
;

192 ià(
¡ršg2nodeid
.
	`size
() % 500000 == 0)

193 
	`log¡»am
(
LOG_INFO
è<< "Hash m­ size: " << 
¡ršg2nodeid
.
	`size
(è<< "‡ˆtime: " << 
mytime
.
	`cu¼’t_time
(è<< "ƒdges: " << 
tÙ®_lšes
 << 
¡d
::
’dl
;

196 
	`log¡»am
(
LOG_INFO
è<<"Fšished…¬sšgÙ® oà" << 
lše
 << "†še š f" << 
š_fes
[
i
] << 
’dl
 <<

197 "tÙ® m­ size: " << 
¡ršg2nodeid
.
	`size
(è<< 
’dl
;

199 
	}
}

202 
	$maš
(
¬gc
, cÚ¡ *
¬gv
[]) {

204 
	`log¡»am
(
LOG_WARNING
)<<"GraphChi…arsers†ibrary is written by Danny Bickson (c). Send‡ny "

205 " comm’t Ü bug„•Üt tØdªny.bicksÚ@gma.com " << 
¡d
::
’dl
;

206 
	`glob®_logg”
().
	`£t_log_Ëv–
(
LOG_INFO
);

207 
	`glob®_logg”
().
	`£t_log_to_cÚsŞe
(
Œue
);

209 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

211 
debug
 = 
	`g‘_İtiÚ_št
("debug", 0);

212 
dœ
 = 
	`g‘_İtiÚ_¡ršg
("file_list");

213 
lšes
 = 
	`g‘_İtiÚ_št
("lines", 0);

214 
	`omp_£t_num_th»ads
(
	`g‘_İtiÚ_št
("ncpus", 1));

215 
tsv
 = 
	`g‘_İtiÚ_št
("tsv", 0);

216 
csv
 = 
	`g‘_İtiÚ_št
("csv", 0);

217 
bš¬y
 = 
	`g‘_İtiÚ_št
("binary", 0);

218 
sšgË_domaš
 = 
	`g‘_İtiÚ_št
("single_domain", 0);

219 
mytime
.
	`¡¬t
();

222 
¡ršg_to_tok’ize
 = 
¥aûs
;

223 ià(
tsv
)

224 
¡ršg_to_tok’ize
 = 
tsv_¥aûs
;

225 ià(
csv
)

226 
¡ršg_to_tok’ize
 = 
csv_¥aûs
;

228 
FILE
 * 
f
 = 
	`fİ’
(
dœ
.
	`c_¡r
(), "r");

229 ià(
f
 =ğ
NULL
)

230 
	`log¡»am
(
LOG_FATAL
)<<"FaedØİ’ fli¡!"<<
¡d
::
’dl
;

232 
Œue
){

233 
buf
[256];

234 
rc
 = 
	`fsÿnf
(
f
, "%s\n", 
buf
);

235 ià(
rc
 < 1)

237 
š_fes
.
	`push_back
(
buf
);

240 ià(
š_fes
.
	`size
() == 0)

241 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad‡ny fÇme äomhli¡ fe: " << 
dœ
 << 
¡d
::
’dl
;

244 
ušt
 
i
=0; i< 
š_fes
.
	`size
(); i++)

245 
	`·r£
(
i
);

247 
¡d
::
cout
 << "Fšished iÀ" << 
mytime
.
	`cu¼’t_time
(è<< std::
’dl
;

249 
	`§ve_m­_to_‹xt_fe
(
¡ršg2nodeid
, 
outdœ
 + 
dœ
 + "user.map.text");

250 
	`§ve_m­_to_‹xt_fe
(
nodeid2hash
, 
outdœ
 + 
dœ
 + "user.reverse.map.text");

251 ià(!
sšgË_domaš
){

252 
	`§ve_m­_to_‹xt_fe
(
¡ršg2nodeid2
, 
outdœ
 + 
dœ
 + "movie.map.text");

253 
	`§ve_m­_to_‹xt_fe
(
nodeid2hash2
, 
outdœ
 + 
dœ
 + "movie.reverse.map.text");

255 
	`log¡»am
(
LOG_INFO
)<<"Wr™šg m©rix m¬k‘ h—d” iÁØfe: m©rix_m¬k‘.šfo" << 
¡d
::
’dl
;

256 
out_fe
 
	`fout
("matrix_market.info");

257 
MM_ty³code
 
out_ty³code
;

258 
	`mm_ş—r_ty³code
(&
out_ty³code
);

259 
	`mm_£t_š‹g”
(&
out_ty³code
);

260 
	`mm_£t_¥¬£
(&
out_ty³code
);

261 
	`mm_£t_m©rix
(&
out_ty³code
);

262 
	`mm_wr™e_bªÃr
(
fout
.
outf
, 
out_ty³code
);

263 
	`mm_wr™e_mtx_üd_size
(
fout
.
outf
, 
M
, 
sšgË_domaš
 ? M : 
N
, 
Âz
);

265 
	}
}

	@toolkits/parsers/aggregator.cpp

47 
	~<c¡dio
>

48 
	~<m­
>

49 
	~<io¡»am
>

50 
	~<m­
>

51 
	~<omp.h
>

52 
	~<as£¹.h
>

53 
	~"g¿phchi_basic_šşudes.hµ
"

54 
	~"../cŞÏbÜ©ive_f‹ršg/tim”.hµ
"

55 
	~"../cŞÏbÜ©ive_f‹ršg/ut.hµ
"

57 
usšg
 
Çme¥aû
 
	g¡d
;

58 
usšg
 
Çme¥aû
 
	gg¿phchi
;

60 
boŞ
 
	gdebug
 = 
çl£
;

61 
tim”
 
	gmytime
;

62 
size_t
 
	glšes
;

63 
	gtÙ®_lšes
 = 0;

64 
¡ršg
 
	gdœ
;

65 
¡ršg
 
	goutdœ
;

66 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
š_fes
;

67 
	gcŞ
 = 3;

71 cÚ¡ 
	g¥aûs
[] = {" \r\n\t!?@#$%^&*()-+.,~`'\";:"};

76 
	$·r£
(
i
){

77 
š_fe
 
	`fš
(
š_fes
[
i
]);

78 
out_fe
 
	`fout
((
outdœ
 + 
š_fes
[
i
] + ".out"));

80 
size_t
 
lšesize
 = 0;

81 * 
§v•Œ
 = 
NULL
, * 
lšebuf
 = NULL;

82 
size_t
 
lše
 = 1;

83 
tÙ®
 = 0;

84 
ušt
 
äom
 = 0, 
to
 = 0;

85 
ušt
 
Ï¡_äom
 = 0, 
Ï¡_to
 = 0;

86 
Œue
){

87 
rc
 = 
	`g‘lše
(&
lšebuf
, &
lšesize
, 
fš
.
outf
);

88 ià(
rc
 < 1)

90 ià(
	`¡¾’
(
lšebuf
) <= 1)

94 *
pch
 = 
	`¡¹ok_r
(
lšebuf
, 
¥aûs
, &
§v•Œ
);

95 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
; ; }

96 
äom
 = 
	`©oi
(
pch
);

98 
pch
 = 
	`¡¹ok_r
(
NULL
, 
¥aûs
 ,&
§v•Œ
);

99 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
; ; }

100 
to
 = 
	`©oi
(
pch
);

102 
cŞ_num
 = 3;

104 
Œue
){

105 
pch
 = 
	`¡¹ok_r
(
NULL
, 
¥aûs
 ,&
§v•Œ
);

106 ià(
pch
 =ğ
NULL
 && 
cŞ_num
 > 
cŞ
)

108 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
; ; }

111 ià(
cŞ
 =ğ
cŞ_num
){

112 ià(
äom
 !ğ
Ï¡_äom
 || 
to
 !ğ
Ï¡_to
){

113 ià(
Ï¡_äom
 !ğ0 && 
Ï¡_to
 != 0)

114 
	`årštf
(
fout
.
outf
, "%u %u %g\n", 
Ï¡_äom
, 
Ï¡_to
, 
tÙ®
);

115 
tÙ®
 = 
	`©of
(
pch
);

118 
tÙ®
 +ğ
	`©of
(
pch
);

120 
cŞ_num
++;

124 
Ï¡_äom
 = 
äom
; 
Ï¡_to
 = 
to
;

125 
tÙ®_lšes
++;

126 
lše
++;

127 ià(
lšes
 && 
lše
>=lines)

130 ià(
debug
 && (
lše
 % 50000 == 0))

131 
	`log¡»am
(
LOG_INFO
è<< "P¬£d†še: " << 
lše
 << 
¡d
::
’dl
;

135 ià(
Ï¡_äom
 !ğ0 && 
Ï¡_to
 != 0)

136 
	`årštf
(
fout
.
outf
, "%u %u %g\n", 
Ï¡_äom
, 
Ï¡_to
, 
tÙ®
);

139 
	`log¡»am
(
LOG_INFO
è<<"Fšished…¬sšgÙ® oà" << 
lše
 << "†še š f" << 
š_fes
[
i
] << 
’dl
;

140 
	}
}

143 
	$maš
(
¬gc
, cÚ¡ *
¬gv
[]) {

145 
	`log¡»am
(
LOG_WARNING
)<<"GraphChi…arsers†ibrary is written by Danny Bickson (c). Send‡ny "

146 " comm’t Ü bug„•Üt tØdªny.bicksÚ@gma.com " << 
¡d
::
’dl
;

147 
	`glob®_logg”
().
	`£t_log_Ëv–
(
LOG_INFO
);

148 
	`glob®_logg”
().
	`£t_log_to_cÚsŞe
(
Œue
);

150 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

152 
debug
 = 
	`g‘_İtiÚ_št
("debug", 0);

153 
dœ
 = 
	`g‘_İtiÚ_¡ršg
("file_list");

154 
lšes
 = 
	`g‘_İtiÚ_št
("lines", 0);

155 
cŞ
 = 
	`g‘_İtiÚ_št
("col", 3);

156 
	`omp_£t_num_th»ads
(
	`g‘_İtiÚ_št
("ncpus", 1));

157 
mytime
.
	`¡¬t
();

159 
FILE
 * 
f
 = 
	`fİ’
(
dœ
.
	`c_¡r
(), "r");

160 ià(
f
 =ğ
NULL
)

161 
	`log¡»am
(
LOG_FATAL
)<<"FaedØİ’ fli¡!"<<
¡d
::
’dl
;

163 
Œue
){

164 
buf
[256];

165 
rc
 = 
	`fsÿnf
(
f
, "%s\n", 
buf
);

166 ià(
rc
 < 1)

168 
š_fes
.
	`push_back
(
buf
);

171 ià(
š_fes
.
	`size
() == 0)

172 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad‡ny fÇme äomhli¡ fe: " << 
dœ
 << 
¡d
::
’dl
;

174 #´agm¨
omp
 
·¿Î–
 

175 
i
=0; i< ()
š_fes
.
	`size
(); i++)

176 
	`·r£
(
i
);

178 
¡d
::
cout
 << "Fšished iÀ" << 
mytime
.
	`cu¼’t_time
(è<< std::
’dl
;

181 
	}
}

	@toolkits/parsers/cdr.cpp

21 
	~<c¡dio
>

22 
	~<io¡»am
>

23 
	~<omp.h
>

24 
	~<as£¹.h
>

25 
	~<®gÜ™hm
>

26 
	~"g¿phchi_basic_šşudes.hµ
"

27 
	~"../cŞÏbÜ©ive_f‹ršg/tim”.hµ
"

28 
	~"../cŞÏbÜ©ive_f‹ršg/ut.hµ
"

31 
usšg
 
Çme¥aû
 
	g¡d
;

32 
usšg
 
Çme¥aû
 
	gg¿phchi
;

34 
boŞ
 
	gdebug
 = 
çl£
;

35 
tim”
 
	gmytime
;

36 
size_t
 
	glšes
 = 0;

37 
	gtÙ®_lšes
 = 0;

38 
¡ršg
 
	gdœ
;

39 
¡ršg
 
	goutdœ
;

40 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
š_fes
;

41 cÚ¡ 
	gu£r_ch¬s_tok’s
[] = {" \r\n\t,.\"!?#%^&*()|-\'+$/:"};

42 
ušt
 
	gmaxäom
 = 0;

43 
ušt
 
	gmaxto
 = 0;

49 
boŞ
 
	$cÚv”t_¡ršg_to_time
(* 
lšebuf
, 
size_t
 
lše
, 
i
, & 
ou‰ime
){

50 * 
§v•Œ
 = 
NULL
;

51 
tm
 
±m
;

52 
	`mem£t
(&
±m
, 0, (ptm));

54 *
y—r
 = 
	`¡¹ok_r
(
lšebuf
," \r\n\t:/-",&
§v•Œ
);

55 ià(!
y—r
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;  
çl£
; }

56 
±m
.
tm_y—r
 = 
	`©oi
(
y—r
) - 1900;

58 *
mÚth
 = 
	`¡¹ok_r
(
NULL
," \r\n\t:/-",&
§v•Œ
);

59 ià(!
mÚth
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;  
çl£
; }

60 
±m
.
tm_mÚ
 = 
	`©oi
(
mÚth
) - 1;

62 *
day
 = 
	`¡¹ok_r
(
NULL
," \r\n\t:/-",&
§v•Œ
);

63 ià(!
day
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;  
çl£
; }

64 
±m
.
tm_mday
 = 
	`©oi
(
day
);

66 *
hour
 = 
	`¡¹ok_r
(
NULL
," \r\n\t:/-",&
§v•Œ
);

67 ià(!
hour
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;  
çl£
; }

68 
±m
.
tm_hour
 = 
	`©oi
(
hour
);

70 *
mšu‹
 = 
	`¡¹ok_r
(
NULL
," \r\n\t:/-",&
§v•Œ
);

71 ià(!
mšu‹
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;  
çl£
; }

72 
±m
.
tm_mš
 = 
	`©oi
(
mšu‹
);

74 *
£cÚd
 = 
	`¡¹ok_r
(
NULL
," \r\n\t:/-",&
§v•Œ
);

75 ià(!
£cÚd
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;  
çl£
; }

76 
±m
.
tm_£c
 = 
	`©oi
(
£cÚd
);

78 
ou‰ime
 = 
	`mktime
(&
±m
);

79  
Œue
;

81 
	}
}

96 
	$·r£
(
i
){

97 
š_fe
 
	`fš
(
š_fes
[
i
]);

98 
out_fe
 
	`fout
((
outdœ
 + 
š_fes
[
i
] + ".out"));

100 
size_t
 
lšesize
 = 0;

101 * 
§v•Œ2
 = 
NULL
, * 
lšebuf
 = NULL, 
lšebuf_debug
[1024];

102 
size_t
 
lše
 = 1;

103 
ušt
 
äom
, 
to
, 
du¿tiÚ1
, 
du¿tiÚ2
;

104 
±ime
;

106 
Œue
){

107 
rc
 = 
	`g‘lše
(&
lšebuf
, &
lšesize
, 
fš
.
outf
);

108 
	`¡ºıy
(
lšebuf_debug
, 
lšebuf
, 1024);

109 
tÙ®_lšes
++;

110 ià(
rc
 < 1)

113 
boŞ
 
ok
 = 
	`cÚv”t_¡ršg_to_time
(
lšebuf_debug
, 
tÙ®_lšes
, 
i
, 
±ime
);

114 ià(!
ok
)

117 *
pch
 = 
	`¡¹ok_r
(
lšebuf
,"\t", &
§v•Œ2
);

118 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
; ; }

120 
pch
 = 
	`¡¹ok_r
(
NULL
," \r\n\t:/-", &
§v•Œ2
);

121 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
; ; }

122 
äom
 = 
	`©oi
(
pch
);

123 
maxäom
 = 
¡d
::
	`max
(
äom
, maxfrom);

125 
pch
 = 
	`¡¹ok_r
(
NULL
," \r\n\t:/-", &
§v•Œ2
);

126 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
; ; }

127 
to
 = 
	`©oi
(
pch
);

128 
maxto
 = 
¡d
::
	`max
(
to
, maxto);

130 
pch
 = 
	`¡¹ok_r
(
NULL
," \r\n\t:/-", &
§v•Œ2
);

131 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
; ; }

132 
du¿tiÚ1
 = 
	`©oi
(
pch
);

134 
pch
 = 
	`¡¹ok_r
(
NULL
," \r\n\t:/-", &
§v•Œ2
);

135 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
; ; }

136 
du¿tiÚ2
 = 
	`©oi
(
pch
);

139 
lše
++;

140 ià(
lšes
 && 
lše
>=lines)

143 ià(
debug
 && (
lše
 % 100000 == 0))

144 
	`log¡»am
(
LOG_INFO
)<<"P¬£d†še: " << 
lše
 << 
’dl
;

146 
	`årštf
(
fout
.
outf
, "%u %u %lu %u\n", 
äom
, 
to
, 
±ime
, 
du¿tiÚ2
);

149 
	`log¡»am
(
LOG_INFO
è<<"Fšished…¬sšgÙ® oà" << 
lše
 << "†še š f" << 
š_fes
[
i
] << 
’dl
;

150 
	}
}

153 
	$maš
(
¬gc
, cÚ¡ *
¬gv
[]) {

155 
	`log¡»am
(
LOG_WARNING
)<<"GraphChi…arsers†ibrary is written by Danny Bickson (c). Send‡ny "

156 " comm’t Ü bug„•Üt tØdªny.bicksÚ@gma.com " << 
¡d
::
’dl
;

157 
	`glob®_logg”
().
	`£t_log_Ëv–
(
LOG_INFO
);

158 
	`glob®_logg”
().
	`£t_log_to_cÚsŞe
(
Œue
);

160 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

162 
debug
 = 
	`g‘_İtiÚ_št
("debug", 0);

163 
dœ
 = 
	`g‘_İtiÚ_¡ršg
("file_list");

164 
lšes
 = 
	`g‘_İtiÚ_št
("lines", 0);

165 
	`omp_£t_num_th»ads
(
	`g‘_İtiÚ_št
("ncpus", 1));

166 
mytime
.
	`¡¬t
();

168 
FILE
 * 
f
 = 
	`fİ’
(
dœ
.
	`c_¡r
(), "r");

169 ià(
f
 =ğ
NULL
)

170 
	`log¡»am
(
LOG_FATAL
)<<"FaedØİ’ fli¡!"<<
¡d
::
’dl
;

172 
Œue
){

173 
buf
[256];

174 
rc
 = 
	`fsÿnf
(
f
, "%s\n", 
buf
);

175 ià(
rc
 < 1)

177 
š_fes
.
	`push_back
(
buf
);

180 ià(
š_fes
.
	`size
() == 0)

181 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad‡ny fÇme äomhli¡ fe: " << 
dœ
 << 
¡d
::
’dl
;

184 
ušt
 
i
=0; i< 
š_fes
.
	`size
(); i++)

185 
	`·r£
(
i
);

187 
¡d
::
cout
 << "Fšished iÀ" << 
mytime
.
	`cu¼’t_time
(è<< std::
’dl
 <<

188 "\ˆtÙ®†še š iÅuˆf: " << 
tÙ®_lšes
 << "\ˆmax from: " << 
maxäom
 << "\ˆmaxo: " <<
maxto
 << 
¡d
::
’dl
;

191 
	}
}

	@toolkits/parsers/common.hpp

20 #iâdeà
_GRAPHCHI_PARSERS_COMMON


21 
	#_GRAPHCHI_PARSERS_COMMON


	)

23 
	~<m­
>

24 
	~<¡ršg
>

25 
	~"g¿phchi_basic_šşudes.hµ
"

26 
	~"commÚ.hµ
"

27 
usšg
 
Çme¥aû
 
	gg¿phchi
;

29 
mu‹x
 
	gmymu‹x
;

31 
	sdoubË_m­
{

32 
	m¡d
::
m­
<
¡d
::
¡ršg
,
	mušt
> 
	m¡ršg2nodeid
;

33 
	m¡d
::
m­
<
ušt
,¡d::
¡ršg
> 
nodeid2hash
;

34 
ušt
 
	mmaxid
;

35 
doubË_m­
(){

36 
	mmaxid
 = 0;

39 
doubË_m­
 
	gäomm­
;

40 
doubË_m­
 
	gtom­
;

42 
	g‹m¶©e
<
ty³Çme
 
	gT1
>

43 
lßd_m­_äom_txt_fe
(
T1
 & 
m­
, cÚ¡ 
¡d
::
¡ršg
 
f’ame
, 
f›lds
){

44 
log¡»am
(
LOG_INFO
)<<"lßdšg m­ fromxˆfe: " << 
	gf’ame
 << 
	g¡d
::
’dl
;

45 
FILE
 * 
	gf
 = 
fİ’
(
f’ame
.
c_¡r
(), "r");

46 ià(
	gf
 =ğ
NULL
)

47 
log¡»am
(
LOG_FATAL
)<<"FaedØİ’ fe: " << 
f’ame
 << 
¡d
::
’dl
;

49 * 
	glšebuf
 = 
NULL
;

50 
size_t
 
	glšesize
;

51 
	glše
 = 0;

52 
	gŒue
){

53 
	grc
 = 
g‘lše
(&
lšebuf
, &
lšesize
, 
f
);

54 ià(
	grc
 == -1)

57 *
	gpch
 = 
¡¹ok
(
lšebuf
," \r\n\t");

58 ià(!
	gpch
){

59 
log¡»am
(
LOG_FATAL
è<< "E¼Ü wh’…¬sšg fe: " << 
	gf’ame
 << ":" << 
	glše
 <<
	g¡d
::
’dl
;

61 * 
	gpch2
 = 
¡¹ok
(
NULL
,"\n");

62 ià(!
	gpch2
)

63 
log¡»am
(
LOG_FATAL
è<< "E¼Ü wh’…¬sšg fe: " << 
	gf’ame
 << ":" << 
	glše
 <<
	g¡d
::
’dl
;

64 
	gm­
[
pch
] = 
©oi
(
pch2
);

65 
	glše
++;

67 
log¡»am
(
LOG_INFO
)<<"M­ sizis: " << 
	gm­
.
size
(è<< 
	g¡d
::
’dl
;

68 
fşo£
(
f
);

72 
§ve_m­_to_‹xt_fe
(cÚ¡ 
¡d
::
m­
<¡d::
¡ršg
,
ušt
> & m­, cÚ¡ std::¡ršg 
f’ame
){

73 
¡d
::
m­
<¡d::
¡ršg
,
	gušt
>::
cÚ¡_™”©Ü
 
™
;

74 
out_fe
 
fout
(
f’ame
);

75 
	gtÙ®
 = 0;

76 
	g™
 = 
m­
.
begš
(); iˆ!ğm­.
’d
(); it++){

77 
årštf
(
fout
.
outf
, "% %u\n", 
™
->
fœ¡
.
c_¡r
(), it->
£cÚd
);

78 
	gtÙ®
++;

80 
log¡»am
(
LOG_INFO
)<<"WrÙ¨tÙ® oà" << 
	gtÙ®
 << " m­ƒÁr› tØ‹xˆfe: " << 
	gf’ame
 << 
	g¡d
::
’dl
;

84 
§ve_m­_to_‹xt_fe
(cÚ¡ 
¡d
::
m­
<
ušt
,¡d::
¡ršg
> & m­, cÚ¡ std::¡ršg 
f’ame
){

85 
¡d
::
m­
<
ušt
,
	g¡d
::
¡ršg
>::
cÚ¡_™”©Ü
 
™
;

86 
out_fe
 
fout
(
f’ame
);

87 
	gtÙ®
 = 0;

88 
	g™
 = 
m­
.
begš
(); iˆ!ğm­.
’d
(); it++){

89 
årštf
(
fout
.
outf
, "%u %s\n", 
™
->
fœ¡
, it->
£cÚd
.
c_¡r
());

90 
	gtÙ®
++;

92 
log¡»am
(
LOG_INFO
)<<"WrÙ¨tÙ® oà" << 
	gtÙ®
 << " m­ƒÁr› tØ‹xˆfe: " << 
	gf’ame
 << 
	g¡d
::
’dl
;

98 
assign_id
(
doubË_m­
& 
dm­
, & 
outv®
, cÚ¡ 
¡d
::
¡ršg
 &
Çme
){

100 
¡d
::
m­
<¡d::
¡ršg
,
	gušt
>::
™”©Ü
 
™
 = 
dm­
.
¡ršg2nodeid
.
fšd
(
Çme
);

102 ià(
	g™
 !ğ
dm­
.
¡ršg2nodeid
.
’d
()){

103 
outv®
 = 
™
->
£cÚd
;

106 
	gmymu‹x
.
lock
();

108 
	goutv®
 = 
dm­
.
¡ršg2nodeid
[
Çme
];

109 ià(
	goutv®
 == 0){

110 
dm­
.
¡ršg2nodeid
[
Çme
] = dm­.
maxid
;

111 
	gdm­
.
	gnodeid2hash
[
dm­
.
maxid
] = 
Çme
;

112 
	goutv®
 = 
dm­
.
maxid
;

113 
	gdm­
.
	gmaxid
++;

115 
	gmymu‹x
.
uÆock
();

	@toolkits/parsers/consecutive_matrix_market.cpp

21 
	~<c¡dio
>

22 
	~<m­
>

23 
	~<io¡»am
>

24 
	~<m­
>

25 
	~<omp.h
>

26 
	~<as£¹.h
>

27 
	~"g¿phchi_basic_šşudes.hµ
"

28 
	~"../cŞÏbÜ©ive_f‹ršg/tim”.hµ
"

29 
	~"../cŞÏbÜ©ive_f‹ršg/ut.hµ
"

30 
	~"../../exam¶e_­ps/m©rix_çùÜiz©iÚ/m©rixm¬k‘/mmio.h
"

31 
	~"../../exam¶e_­ps/m©rix_çùÜiz©iÚ/m©rixm¬k‘/mmio.c
"

33 
usšg
 
Çme¥aû
 
	g¡d
;

34 
usšg
 
Çme¥aû
 
	gg¿phchi
;

36 
boŞ
 
	gdebug
 = 
çl£
;

37 
	gm­
<
	g¡ršg
,
	gušt
> 
	g¡ršg2nodeid
;

38 
	gm­
<
	gušt
,
	g¡ršg
> 
	gnodeid2hash
;

39 
	gm­
<
	g¡ršg
,
	gušt
> 
	g¡ršg2nodeid2
;

40 
	gm­
<
	gušt
,
	g¡ršg
> 
	gnodeid2hash2
;

41 
ušt
 
	gcÚ£q_id
;

42 
ušt
 
	gcÚ£q_id2
;

43 
mu‹x
 
	gmymu‹x
;

44 
tim”
 
	gmytime
;

45 
size_t
 
	glšes
;

46 
	gtÙ®_lšes
 = 0;

47 
¡ršg
 
	gdœ
;

48 
¡ršg
 
	goutdœ
;

49 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
š_fes
;

50 
ušt
 
	gM
,
	gN
;

51 
size_t
 
	gÂz
 = 0;

52 cÚ¡ * 
	g¡ršg_to_tok’ize
;

53 
	gcsv
 = 0;

54 
	gtsv
 = 0;

55 
	gbš¬y
 = 0;

56 
	gsšgË_domaš
 = 0;

57 cÚ¡ * 
	g¥aûs
 = " \r\n\t";

58 cÚ¡ * 
	gtsv_¥aûs
 = "\t\n";

59 cÚ¡ * 
	gcsv_¥aûs
 = ",\n";

62 
§ve_m­_to_‹xt_fe
(cÚ¡ 
¡d
::
m­
<¡d::
¡ršg
,
ušt
> & m­, cÚ¡ std::¡ršg 
f’ame
){

63 
¡d
::
m­
<¡d::
¡ršg
,
	gušt
>::
cÚ¡_™”©Ü
 
™
;

64 
out_fe
 
fout
(
f’ame
);

65 
	gtÙ®
 = 0;

66 
	g™
 = 
m­
.
begš
(); iˆ!ğm­.
’d
(); it++){

67 
årštf
(
fout
.
outf
, "% %u\n", 
™
->
fœ¡
.
c_¡r
(), it->
£cÚd
);

68 
	gtÙ®
++;

70 
log¡»am
(
LOG_INFO
)<<"WrÙ¨tÙ® oà" << 
	gtÙ®
 << " m­ƒÁr› tØ‹xˆfe: " << 
	gf’ame
 << 
	g¡d
::
’dl
;

74 
§ve_m­_to_‹xt_fe
(cÚ¡ 
¡d
::
m­
<
ušt
,¡d::
¡ršg
> & m­, cÚ¡ std::¡ršg 
f’ame
){

75 
¡d
::
m­
<
ušt
,
	g¡d
::
¡ršg
>::
cÚ¡_™”©Ü
 
™
;

76 
out_fe
 
fout
(
f’ame
);

77 
	gtÙ®
 = 0;

78 
	g™
 = 
m­
.
begš
(); iˆ!ğm­.
’d
(); it++){

79 
årštf
(
fout
.
outf
, "%u %s\n", 
™
->
fœ¡
, it->
£cÚd
.
c_¡r
());

80 
	gtÙ®
++;

82 
log¡»am
(
LOG_INFO
)<<"WrÙ¨tÙ® oà" << 
	gtÙ®
 << " m­ƒÁr› tØ‹xˆfe: " << 
	gf’ame
 << 
	g¡d
::
’dl
;

88 
assign_id
(
m­
<
¡ršg
,
ušt
> & 
¡ršg2nodeid
, m­<ušt,¡ršg> & 
nodeid2hash
, ušˆ& 
outv®
, cÚ¡ sŒšg &
Çme
, 
boŞ
 
äom
){

90 
	gm­
<
	g¡ršg
,
	gušt
>::
™”©Ü
 
™
 = 
¡ršg2nodeid
.
fšd
(
Çme
);

92 ià(
	g™
 !ğ
¡ršg2nodeid
.
’d
()){

93 
outv®
 = 
™
->
£cÚd
;

96 
	gmymu‹x
.
lock
();

98 
	goutv®
 = 
¡ršg2nodeid
[
Çme
];

99 ià(
	goutv®
 == 0){

101 
¡ršg2nodeid
[
Çme
] = (
äom
? ++
cÚ£q_id
 : ++
cÚ£q_id2
);

103 
	goutv®
 = (
äom
? 
cÚ£q_id
 : 
cÚ£q_id2
);

105 
	gnodeid2hash
[
outv®
] = 
Çme
;

106 ià(
	gäom
)

107 
	gM
 = 
¡d
::
max
(
M
, 
cÚ£q_id
);

109 
	gN
 = 
¡d
::
max
(
N
, 
cÚ£q_id2
);

111 
	gmymu‹x
.
uÆock
();

116 
	$·r£
(
i
){

117 
š_fe
 
	`fš
(
š_fes
[
i
]);

118 
out_fe
 
	`fout
((
outdœ
 + 
š_fes
[
i
] + ".out"));

120 
size_t
 
lšesize
 = 0;

121 * 
§v•Œ
 = 
NULL
, * 
lšebuf
 = NULL;

122 
size_t
 
lše
 = 1;

123 
ušt
 
äom
,
to
;

124 
boŞ
 
m©rix_m¬k‘
 = 
çl£
;

126 
Œue
){

127 
rc
 = 
	`g‘lše
(&
lšebuf
, &
lšesize
, 
fš
.
outf
);

128 ià(
rc
 < 1)

130 ià(
	`¡¾’
(
lšebuf
) <= 1)

133 ià(!
	`¡ºcmp
(
lšebuf
, "%%MatrixMarket", 14)){

134 
m©rix_m¬k‘
 = 
Œue
;

137 ià(
m©rix_m¬k‘
 && 
lšebuf
[0] == '%'){

140 ià(
m©rix_m¬k‘
 && 
lšebuf
[0] != '%'){

141 
m©rix_m¬k‘
 = 
çl£
;

146 *
pch
 = 
	`¡¹ok_r
(
lšebuf
,
¡ršg_to_tok’ize
, &
§v•Œ
);

147 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
; ; }

148 
	`assign_id
(
¡ršg2nodeid
,
nodeid2hash
, 
äom
, 
pch
, 
Œue
);

151 
pch
 = 
	`¡¹ok_r
(
NULL
,
¡ršg_to_tok’ize
, &
§v•Œ
);

152 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
; ; }

153 
	`assign_id
(
sšgË_domaš
 ? 
¡ršg2nodeid
:
¡ršg2nodeid2
,

154 
sšgË_domaš
 ? 
nodeid2hash
 : 
nodeid2hash2
, 
to
, 
pch
, sšgË_domaš ? 
Œue
 : 
çl£
);

157 ià(!
bš¬y
){

158 
pch
 = 
	`¡¹ok_r
(
NULL
, "\n", &
§v•Œ
);

159 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
; ; }

161 ià(
tsv
)

162 
	`årštf
(
fout
.
outf
, "%u\t%u\t%s\n", 
äom
, 
to
, 
bš¬y
? "": 
pch
);

163 ià(
csv
)

164 
	`årštf
(
fout
.
outf
, "%u,%u,%s\n", 
äom
, 
to
, 
bš¬y
? "" : 
pch
);

166 
	`årštf
(
fout
.
outf
, "%u %u %s\n", 
äom
, 
to
, 
bš¬y
? "" : 
pch
);

167 
Âz
++;

169 
lše
++;

170 
tÙ®_lšes
++;

171 ià(
lšes
 && 
lše
>=lines)

174 ià(
debug
 && (
lše
 % 50000 == 0))

175 
	`log¡»am
(
LOG_INFO
è<< "P¬£d†še: " << 
lše
 << " m­ sizis: " << 
¡ršg2nodeid
.
	`size
(è<< 
¡d
::
’dl
;

176 ià(
¡ršg2nodeid
.
	`size
() % 500000 == 0)

177 
	`log¡»am
(
LOG_INFO
è<< "Hash m­ size: " << 
¡ršg2nodeid
.
	`size
(è<< "‡ˆtime: " << 
mytime
.
	`cu¼’t_time
(è<< "ƒdges: " << 
tÙ®_lšes
 << 
¡d
::
’dl
;

180 
	`log¡»am
(
LOG_INFO
è<<"Fšished…¬sšgÙ® oà" << 
lše
 << "†še š f" << 
š_fes
[
i
] << 
’dl
 <<

181 "tÙ® m­ size: " << 
¡ršg2nodeid
.
	`size
(è<< 
’dl
;

183 
	}
}

186 
	$maš
(
¬gc
, cÚ¡ *
¬gv
[]) {

188 
	`log¡»am
(
LOG_WARNING
)<<"GraphChi…arsers†ibrary is written by Danny Bickson (c). Send‡ny "

189 " comm’t Ü bug„•Üt tØdªny.bicksÚ@gma.com " << 
¡d
::
’dl
;

190 
	`glob®_logg”
().
	`£t_log_Ëv–
(
LOG_INFO
);

191 
	`glob®_logg”
().
	`£t_log_to_cÚsŞe
(
Œue
);

193 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

195 
debug
 = 
	`g‘_İtiÚ_št
("debug", 0);

196 
dœ
 = 
	`g‘_İtiÚ_¡ršg
("file_list");

197 
lšes
 = 
	`g‘_İtiÚ_št
("lines", 0);

198 
	`omp_£t_num_th»ads
(
	`g‘_İtiÚ_št
("ncpus", 1));

199 
tsv
 = 
	`g‘_İtiÚ_št
("tsv", 0);

200 
csv
 = 
	`g‘_İtiÚ_št
("csv", 0);

201 
bš¬y
 = 
	`g‘_İtiÚ_št
("binary", 0);

202 
sšgË_domaš
 = 
	`g‘_İtiÚ_št
("single_domain", 0);

203 
mytime
.
	`¡¬t
();

206 
¡ršg_to_tok’ize
 = 
¥aûs
;

207 ià(
tsv
)

208 
¡ršg_to_tok’ize
 = 
tsv_¥aûs
;

209 ià(
csv
)

210 
¡ršg_to_tok’ize
 = 
csv_¥aûs
;

212 
FILE
 * 
f
 = 
	`fİ’
(
dœ
.
	`c_¡r
(), "r");

213 ià(
f
 =ğ
NULL
)

214 
	`log¡»am
(
LOG_FATAL
)<<"FaedØİ’ fli¡!"<<
¡d
::
’dl
;

216 
Œue
){

217 
buf
[256];

218 
rc
 = 
	`fsÿnf
(
f
, "%s\n", 
buf
);

219 ià(
rc
 < 1)

221 
š_fes
.
	`push_back
(
buf
);

224 ià(
š_fes
.
	`size
() == 0)

225 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad‡ny fÇme äomhli¡ fe: " << 
dœ
 << 
¡d
::
’dl
;

228 
ušt
 
i
=0; i< 
š_fes
.
	`size
(); i++)

229 
	`·r£
(
i
);

231 
¡d
::
cout
 << "Fšished iÀ" << 
mytime
.
	`cu¼’t_time
(è<< std::
’dl
;

233 
	`§ve_m­_to_‹xt_fe
(
¡ršg2nodeid
, 
outdœ
 + 
dœ
 + "user.map.text");

234 
	`§ve_m­_to_‹xt_fe
(
nodeid2hash
, 
outdœ
 + 
dœ
 + "user.reverse.map.text");

235 ià(!
sšgË_domaš
){

236 
	`§ve_m­_to_‹xt_fe
(
¡ršg2nodeid2
, 
outdœ
 + 
dœ
 + "movie.map.text");

237 
	`§ve_m­_to_‹xt_fe
(
nodeid2hash2
, 
outdœ
 + 
dœ
 + "movie.reverse.map.text");

239 
	`log¡»am
(
LOG_INFO
)<<"Wr™šg m©rix m¬k‘ h—d” iÁØfe: m©rix_m¬k‘.šfo" << 
¡d
::
’dl
;

240 
out_fe
 
	`fout
("matrix_market.info");

241 
MM_ty³code
 
out_ty³code
;

242 
	`mm_ş—r_ty³code
(&
out_ty³code
);

243 
	`mm_£t_š‹g”
(&
out_ty³code
);

244 
	`mm_£t_¥¬£
(&
out_ty³code
);

245 
	`mm_£t_m©rix
(&
out_ty³code
);

246 
	`mm_wr™e_bªÃr
(
fout
.
outf
, 
out_ty³code
);

247 
	`mm_wr™e_mtx_üd_size
(
fout
.
outf
, 
M
, 
N
, 
Âz
);

249 
	}
}

	@toolkits/parsers/ips2ids.cpp

22 
	~<c¡dio
>

23 
	~<m­
>

24 
	~<omp.h
>

25 
	~<ÿs£¹
>

26 
	~<sys/sock‘.h
>

27 
	~<Ãtš‘/š.h
>

28 
	~<¬·/š‘.h
>

30 
	~"g¿phchi_basic_šşudes.hµ
"

31 
	~"../cŞÏbÜ©ive_f‹ršg/ut.hµ
"

32 
usšg
 
Çme¥aû
 
	gg¿phchi
;

36 
	gdebug
 = 0;

37 
	gcsv
 = 0;

38 
	gtsv
 = 0;

39 cÚ¡ * 
	gtok’
;

40 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
š_fes
;

43 
mu‹x
 
	gids_mu‹x
;

44 
	g¡d
::
m­
<, > 
	gids
;

54 
	$·r£
(
i
) {

55 
ušt64_t
 
max_id
 = 1;

57 
š_fe
 
	`fš
(
š_fes
[
i
].
	`c_¡r
());

58 
out_fe
 
	`fout
(
¡d
::
	`¡ršg
(
š_fes
[
i
] + ".out").
	`c_¡r
());

60 
ušt64_t
 
lšes
 = 0;

61 
ušt64_t
 
h™s
 = 0;

62 
Œue
) {

63 
š_addr
 
ÿÎ”
;

64 
š_addr
 
ÿÎ“
;

65 
lše
[256];

67 * 
»s
 = 
	`fg‘s
(
lše
, 256, 
fš
.
outf
);

69 ià(
»s
 =ğ
NULL
) {

73 * 
ÿÎ”_¡r
 = 
	`¡¹ok
(
lše
, 
tok’
);

74 
	`as£¹
(
ÿÎ”_¡r
 !ğ
NULL
);

75 * 
ÿÎ“_¡r
 = 
	`¡¹ok
(
NULL
, 
tok’
);

76 
	`as£¹
(
ÿÎ“_¡r
 !ğ
NULL
);

77 * 
©Œibu‹
 = 
	`¡¹ok
(
NULL
, 
tok’
);

78 
	`as£¹
(
©Œibu‹
 !ğ
NULL
);

81 ià(
	`š‘_©Ú
(
ÿÎ”_¡r
, &
ÿÎ”
) == 0) {

82 ià(
debug
è
	`log¡»am
(
LOG_WARNING
è<< "could‚Ù cÚv”ˆÿÎ”-:" << 
ÿÎ”_¡r
 << 
¡d
::
’dl
;

86 ià(
	`š‘_©Ú
(
ÿÎ“_¡r
, &
ÿÎ“
) == 0) {

87 ià(
debug
è
	`log¡»am
(
LOG_WARNING
è<< "could‚Ù cÚv”ˆÿÎ“-:" << 
ÿÎ”_¡r
 << 
¡d
::
’dl
;

92 ià(
ids
.
	`fšd
(
ÿÎ”
.
s_addr
è=ğids.
	`’d
()) {

95 
ids_mu‹x
.
	`lock
();

99 ià(
ids
[
ÿÎ”
.
s_addr
] == 0) {

101 
ids
[
ÿÎ”
.
s_addr
] = 
max_id
;

102 ++
max_id
;

104 
ids_mu‹x
.
	`uÆock
();

106 ++
h™s
;

110 ià(
ids
.
	`fšd
(
ÿÎ“
.
s_addr
è=ğids.
	`’d
()) {

111 
ids_mu‹x
.
	`lock
();

112 ià(
ids
[
ÿÎ“
.
s_addr
] == 0) {

113 
ids
[
ÿÎ“
.
s_addr
] = 
max_id
;

114 ++
max_id
;

116 
ids_mu‹x
.
	`uÆock
();

118 ++
h™s
;

123 ià(
tsv
) {

124 
	`årštf
(
fout
.
outf
, "%u\t%u\t%s", 
ids
[
ÿÎ”
.
s_addr
], ids[
ÿÎ“
.s_addr], 
©Œibu‹
);

125 } ià(
csv
) {

126 
	`årštf
(
fout
.
outf
, "%u,%u,%s", 
ids
[
ÿÎ”
.
s_addr
], ids[
ÿÎ“
.s_addr], 
©Œibu‹
);

128 
	`årštf
(
fout
.
outf
, "%u %u %s", 
ids
[
ÿÎ”
.
s_addr
], ids[
ÿÎ“
.s_addr], 
©Œibu‹
);

130 ià(++
lšes
 % 100000 == 0) {

131 
	`log¡»am
(
LOG_INFO
è<< "Edges: " << 
lšes


132 << ", Ids: " << 
ids
.
	`size
()

133 << ", H™s: " << 
h™s
 << "\n";

137 
	`log¡»am
(
LOG_INFO
è<< "Fšished…¬sšg " << 
š_fes
[
i
] << 
¡d
::
’dl
;

138 
	}
}

141 
	$maš
(
¬gc
, cÚ¡ *
¬gv
[]) {

142 
	`glob®_logg”
().
	`£t_log_Ëv–
(
LOG_INFO
);

143 
	`glob®_logg”
().
	`£t_log_to_cÚsŞe
(
Œue
);

145 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

148 
debug
 = 
	`g‘_İtiÚ_št
("debug", 0);

149 
¡d
::
¡ršg
 
dœ
 = 
	`g‘_İtiÚ_¡ršg
("file");

150 
	`omp_£t_num_th»ads
(
	`g‘_İtiÚ_št
("ncpus", 1));

151 
tsv
 = 
	`g‘_İtiÚ_št
("tsv", 0);

152 
csv
 = 
	`g‘_İtiÚ_št
("csv", 0);

153 ià(
tsv
è
tok’
 = "\t";

154 ià(
csv
è
tok’
 = ",";

155 
tok’
 = " ";

159 
FILE
 * 
f
 = 
	`fİ’
(
dœ
.
	`c_¡r
(), "r");

160 ià(
f
 =ğ
NULL
)

161 
	`log¡»am
(
LOG_FATAL
è<< "FaedØİ’ fli¡!" << 
¡d
::
’dl
;

163 
Œue
){

164 
buf
[256];

165 
rc
 = 
	`fsÿnf
(
f
, "%s\n", 
buf
);

166 ià(
rc
 < 1)

168 
š_fes
.
	`push_back
(
buf
);

172 #´agm¨
omp
 
·¿Î–


173 
i
 = 0; i < 
š_fes
.
	`size
(); ++i) {

174 
	`·r£
(
i
);

178 
	`log¡»am
(
LOG_INFO
è<< "£rŸlizšg ids..." << 
¡d
::
’dl
;

179 
out_fe
 
	`fout
(
¡d
::
	`¡ršg
(
dœ
 + ".m­").
	`c_¡r
());

180 
¡d
::
m­
<, >::
cÚ¡_™”©Ü
 
™
 = 
ids
.
	`begš
();

181 
™
 !ğ
ids
.
	`’d
();

182 ++
™
)

184 ià(
tsv
è
	`årštf
(
fout
.
outf
, "%u\t%u\n", 
™
->
fœ¡
, it->
£cÚd
);

185 ià(
csv
è
	`årštf
(
fout
.
outf
, "%u,%u\n", 
™
->
fœ¡
, it->
£cÚd
);

186 
	`årštf
(
fout
.
outf
, "%u %u\n", 
™
->
fœ¡
, it->
£cÚd
);

190 
	}
}

	@toolkits/parsers/texttokens.cpp

27 
	~<c¡dio
>

28 
	~<io¡»am
>

29 
	~<m­
>

30 
	~<omp.h
>

31 
	~<as£¹.h
>

32 
	~"g¿phchi_basic_šşudes.hµ
"

33 
	~"../cŞÏbÜ©ive_f‹ršg/tim”.hµ
"

34 
	~"../cŞÏbÜ©ive_f‹ršg/ut.hµ
"

35 
	~"commÚ.hµ
"

37 
usšg
 
Çme¥aû
 
	g¡d
;

38 
usšg
 
Çme¥aû
 
	gg¿phchi
;

40 
boŞ
 
	gdebug
 = 
çl£
;

41 
tim”
 
	gmytime
;

42 
size_t
 
	glšes
;

43 
	gtÙ®_lšes
 = 0;

44 
¡ršg
 
	gdœ
;

45 
¡ršg
 
	goutdœ
;

46 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
š_fes
;

47 
	gmš_th»shŞd
 = 1;

48 
	gmax_th»shŞd
 = 1234567890;

51 cÚ¡ 
	g¥aûs
[] = {" \r\n\t!?@#$%^&*()-+.,~`'\";:"};

54 
	$·r£
(
i
){

55 
š_fe
 
	`fš
(
š_fes
[
i
]);

56 
out_fe
 
	`fout
((
outdœ
 + 
š_fes
[
i
] + ".out"));

58 
size_t
 
lšesize
 = 0;

59 * 
§v•Œ
 = 
NULL
, * 
lšebuf
 = NULL;

60 
size_t
 
lše
 = 1;

61 
ušt
 
id
;

63 
Œue
){

64 
¡d
::
m­
<
ušt
,ušt> 
wÜdcouÁ
;

65 
rc
 = 
	`g‘lše
(&
lšebuf
, &
lšesize
, 
fš
.
outf
);

66 ià(
rc
 < 1)

68 ià(
	`¡¾’
(
lšebuf
) <= 1)

71 *
pch
 = 
	`¡¹ok_r
(
lšebuf
, 
¥aûs
, &
§v•Œ
);

72 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
; ; }

73 
	`assign_id
(
äomm­
, 
id
, 
pch
);

74 
wÜdcouÁ
[
id
]+= 1;

76 
pch
 !ğ
NULL
){

77 
pch
 = 
	`¡¹ok_r
(
NULL
, 
¥aûs
 ,&
§v•Œ
);

78 ià(
pch
 !ğ
NULL
 && 
	`¡¾’
(pch) > 1){

79 
	`assign_id
(
äomm­
, 
id
, 
pch
);

80 
wÜdcouÁ
[
id
]+= 1;

84 
tÙ®_lšes
++;

86 
¡d
::
m­
<
ušt
,ušt>::
cÚ¡_™”©Ü
 
™
;

87 
™
 = 
wÜdcouÁ
.
	`begš
(); iˆ!ğwÜdcouÁ.
	`’d
(); it++){

88 ià(()
™
->
£cÚd
 >ğ
mš_th»shŞd
 && ()™->£cÚd <ğ
max_th»shŞd
)

89 
	`årštf
(
fout
.
outf
, "%lu %u %u\n", 
lše
, 
™
->
fœ¡
, it->
£cÚd
);

92 
lše
++;

93 ià(
lšes
 && 
lše
>=lines)

96 ià(
debug
 && (
lše
 % 50000 == 0))

97 
	`log¡»am
(
LOG_INFO
è<< "P¬£d†še: " << 
lše
 << " m­ sizis: " << 
äomm­
.
¡ršg2nodeid
.
	`size
(è<< 
¡d
::
’dl
;

98 ià(
äomm­
.
¡ršg2nodeid
.
	`size
() % 500000 == 0)

99 
	`log¡»am
(
LOG_INFO
è<< "Hash m­ size: " << 
äomm­
.
¡ršg2nodeid
.
	`size
(è<< "‡ˆtime: " << 
mytime
.
	`cu¼’t_time
(è<< "ƒdges: " << 
tÙ®_lšes
 << 
¡d
::
’dl
;

102 
	`log¡»am
(
LOG_INFO
è<<"Fšished…¬sšgÙ® oà" << 
lše
 << "†še š f" << 
š_fes
[
i
] << 
’dl
 <<

103 "tÙ® m­ size: " << 
äomm­
.
¡ršg2nodeid
.
	`size
(è<< 
’dl
;

105 
	}
}

108 
	$maš
(
¬gc
, cÚ¡ *
¬gv
[]) {

110 
	`log¡»am
(
LOG_WARNING
)<<"GraphChi…arsers†ibrary is written by Danny Bickson (c). Send‡ny "

111 " comm’t Ü bug„•Üt tØdªny.bicksÚ@gma.com " << 
¡d
::
’dl
;

112 
	`glob®_logg”
().
	`£t_log_Ëv–
(
LOG_INFO
);

113 
	`glob®_logg”
().
	`£t_log_to_cÚsŞe
(
Œue
);

115 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

117 
debug
 = 
	`g‘_İtiÚ_št
("debug", 0);

118 
dœ
 = 
	`g‘_İtiÚ_¡ršg
("file_list");

119 
lšes
 = 
	`g‘_İtiÚ_št
("lines", 0);

120 
mš_th»shŞd
 = 
	`g‘_İtiÚ_št
("min_threshold", min_threshold);

121 
max_th»shŞd
 = 
	`g‘_İtiÚ_št
("max_threshold", max_threshold);

122 
	`omp_£t_num_th»ads
(
	`g‘_İtiÚ_št
("ncpus", 1));

123 
mytime
.
	`¡¬t
();

125 
FILE
 * 
f
 = 
	`fİ’
(
dœ
.
	`c_¡r
(), "r");

126 ià(
f
 =ğ
NULL
)

127 
	`log¡»am
(
LOG_FATAL
)<<"FaedØİ’ fli¡!"<<
¡d
::
’dl
;

129 
Œue
){

130 
buf
[256];

131 
rc
 = 
	`fsÿnf
(
f
, "%s\n", 
buf
);

132 ià(
rc
 < 1)

134 
š_fes
.
	`push_back
(
buf
);

137 ià(
š_fes
.
	`size
() == 0)

138 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad‡ny fÇme äomhli¡ fe: " << 
dœ
 << 
¡d
::
’dl
;

140 #´agm¨
omp
 
·¿Î–
 

141 
i
=0; i< ()
š_fes
.
	`size
(); i++)

142 
	`·r£
(
i
);

144 
¡d
::
cout
 << "Fšished iÀ" << 
mytime
.
	`cu¼’t_time
(è<< std::
’dl
;

146 
	`§ve_m­_to_‹xt_fe
(
äomm­
.
¡ršg2nodeid
, 
outdœ
 + 
dœ
 + "map.text");

147 
	`§ve_m­_to_‹xt_fe
(
äomm­
.
nodeid2hash
, 
outdœ
 + 
dœ
 + "reverse.map.text");

149 
	}
}

	@toolkits/parsers/topk.cpp

43 
	~<c¡dio
>

44 
	~<m­
>

45 
	~<io¡»am
>

46 
	~<m­
>

47 
	~<omp.h
>

48 
	~<as£¹.h
>

49 
	~"g¿phchi_basic_šşudes.hµ
"

50 
	~"../cŞÏbÜ©ive_f‹ršg/tim”.hµ
"

51 
	~"../cŞÏbÜ©ive_f‹ršg/ut.hµ
"

52 
	~"../cŞÏbÜ©ive_f‹ršg/eig’_w¿µ”.hµ
"

54 
usšg
 
Çme¥aû
 
	g¡d
;

55 
usšg
 
Çme¥aû
 
	gg¿phchi
;

57 
boŞ
 
	gdebug
 = 
çl£
;

58 
tim”
 
	gmytime
;

59 
size_t
 
	glšes
;

60 
	gtÙ®_lšes
 = 0;

61 
¡ršg
 
	gdœ
;

62 
¡ršg
 
	goutdœ
;

63 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
š_fes
;

64 
	gcŞ
 = 3;

65 
	gK
 = 10;

66 
	ghas_v®ue
 = 1;

69 cÚ¡ 
	g¥aûs
[] = {" \r\n\t;:"};

71 
	$dump_’Œy
(
ušt
 
äom
, 
vec
 & 
to_vec
, veø& 
v®s_vec
, 
pos
, 
FILE
 * 
out_ids
, FILE * 
out_v®s
){

72 
	`as£¹
(
pos
 <ğ
K
);

73 
	`årštf
(
out_ids
, "%u ", 
äom
);

74 ià(
has_v®ue
)

75 
	`årštf
(
out_v®s
, "%u ", 
äom
);

76 
i
=0; i< 
pos
; i++){

77 
	`årštf
(
out_ids
, "%u ", (
ušt
)
to_vec
[
i
]);

78 ià(
has_v®ue
)

79 
	`årštf
(
out_v®s
, "%12.6g ", 
v®s_vec
[
i
]);

81 
	`årštf
(
out_ids
, "\n");

82 ià(
has_v®ue
)

83 
	`årštf
(
out_v®s
, "\n");

84 
	}
}

85 
	$·r£
(
i
){

86 
š_fe
 
	`fš
(
š_fes
[
i
]);

87 
out_fe
 
	`ids_out
((
outdœ
 + 
š_fes
[
i
] + ".ids"));

88 
out_fe
 
	`v®_out
((
outdœ
 + 
š_fes
[
i
] + ".vals"));

91 
vec
 
to_vec
 = 
	`z”os
(
K
);

92 
vec
 
v®_vec
 = 
	`z”os
(
K
);

93 
pos
 = 0;

94 
size_t
 
lšesize
 = 0;

95 * 
§v•Œ
 = 
NULL
, * 
lšebuf
 = NULL;

96 
size_t
 
lše
 = 1;

97 
ušt
 
äom
 = 0, 
to
 = 0;

98 
ušt
 
Ï¡_äom
 = 0;

99 
Œue
){

100 
rc
 = 
	`g‘lše
(&
lšebuf
, &
lšesize
, 
fš
.
outf
);

101 ià(
rc
 < 1)

107 *
pch
 = 
	`¡¹ok_r
(
lšebuf
, 
¥aûs
, &
§v•Œ
);

108 ià(!
pch
 || 
	`©oi
(pch)<= 0)

109 
	`log¡»am
(
LOG_FATAL
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;

110 
äom
 = 
	`©oi
(
pch
);

113 
pch
 = 
	`¡¹ok_r
(
NULL
, 
¥aûs
 ,&
§v•Œ
);

114 ià(!
pch
 || 
	`©oi
(pch)<=0)

115 
	`log¡»am
(
LOG_FATAL
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;

116 
to
 = 
	`©oi
(
pch
);

119 ià(
has_v®ue
){

120 
pch
 = 
	`¡¹ok_r
(
NULL
, 
¥aûs
 ,&
§v•Œ
);

121 ià(!
pch
)

122 
	`log¡»am
(
LOG_FATAL
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;

125 ià(
äom
 !ğ
Ï¡_äom
){

127 ià(
Ï¡_äom
 != 0){

128 
	`dump_’Œy
(
Ï¡_äom
, 
to_vec
, 
v®_vec
, 
pos
, 
ids_out
.
outf
, 
v®_out
.outf);

129 
pos
 = 0;

132 ià(
pos
>ğ
K
)

134 
v®_vec
[
pos
] = 
has_v®ue
?
	`©of
(
pch
):1.0;

135 
to_vec
[
pos
] = 
to
;

136 
pos
++;

139 
Ï¡_äom
 = 
äom
;

140 
tÙ®_lšes
++;

141 
lše
++;

142 ià(
lšes
 && 
lše
>=lines)

145 ià(
debug
 && (
lše
 % 50000 == 0))

146 
	`log¡»am
(
LOG_INFO
è<< "P¬£d†še: " << 
lše
 << 
¡d
::
’dl
;

148 ià(
Ï¡_äom
 != 0)

149 
	`dump_’Œy
(
Ï¡_äom
, 
to_vec
, 
v®_vec
, 
pos
, 
ids_out
.
outf
, 
v®_out
.outf);

151 
	`log¡»am
(
LOG_INFO
è<<"Fšished…¬sšgÙ® oà" << 
lše
 << "†še š f" << 
š_fes
[
i
] << 
’dl
;

152 
	}
}

155 
	$maš
(
¬gc
, cÚ¡ *
¬gv
[]) {

157 
	`log¡»am
(
LOG_WARNING
)<<"GraphChi…arsers†ibrary is written by Danny Bickson (c). Send‡ny "

158 " comm’t Ü bug„•Üt tØdªny.bicksÚ@gma.com " << 
¡d
::
’dl
;

159 
	`glob®_logg”
().
	`£t_log_Ëv–
(
LOG_INFO
);

160 
	`glob®_logg”
().
	`£t_log_to_cÚsŞe
(
Œue
);

162 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

164 
debug
 = 
	`g‘_İtiÚ_št
("debug", 0);

165 
lšes
 = 
	`g‘_İtiÚ_št
("lines", 0);

166 
has_v®ue
 = 
	`g‘_İtiÚ_št
("has_value", has_value);

167 
K
 = 
	`g‘_İtiÚ_št
("K", K);

169 ià(
K
 < 1)

170 
	`log¡»am
(
LOG_FATAL
)<<"Numb” oàtİƒËm’t (--K=èshould b>ğ1"<<
¡d
::
’dl
;

172 
	`omp_£t_num_th»ads
(
	`g‘_İtiÚ_št
("ncpus", 1));

173 
mytime
.
	`¡¬t
();

175 
¡d
::
¡ršg
 
Œaššg
 = 
	`g‘_İtiÚ_¡ršg
("training");

176 
š_fes
.
	`push_back
(
Œaššg
);

178 ià(
š_fes
.
	`size
() == 0)

179 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad‡ny fÇme äomhli¡ fe: " << 
dœ
 << 
¡d
::
’dl
;

181 
	`·r£
(0);

182 
¡d
::
cout
 << "Fšished iÀ" << 
mytime
.
	`cu¼’t_time
(è<< std::
’dl
;

185 
	}
}

	@toolkits/parsers/twitter.cpp

21 
	~<c¡dio
>

22 
	~<m­
>

23 
	~<io¡»am
>

24 
	~<m­
>

25 
	~<omp.h
>

26 
	~<as£¹.h
>

27 
	~<®gÜ™hm
>

28 
	~"g¿phchi_basic_šşudes.hµ
"

30 
	~"../cŞÏbÜ©ive_f‹ršg/tim”.hµ
"

31 
	~"../cŞÏbÜ©ive_f‹ršg/ut.hµ
"

34 
usšg
 
Çme¥aû
 
	g¡d
;

35 
usšg
 
Çme¥aû
 
	gg¿phchi
;

37 
boŞ
 
	gdebug
 = 
çl£
;

38 
	gm­
<
	g¡ršg
,
	gušt
> 
	g¡ršg2nodeid
;

39 
	gm­
<
	gušt
,
	g¡ršg
> 
	gnodeid2hash
;

40 
	gm­
<
	gušt
,ušt> 
	gtw“ts_³r_u£r
;

41 
ušt
 
	gcÚ£q_id
;

42 
mu‹x
 
	gmymu‹x
;

43 
tim”
 
	gmytime
;

44 
size_t
 
	glšes
 = 0, 
	glšks_found
 = 0, 
	gh‰p_lšks
 = 0, 
	gmissšg_Çmes
 = 0, 
	g»tw“t_found
 = 0, 
	gwide_tw“ts
 = 0;

45 
	gtÙ®_lšes
 = 0;

46 
¡ršg
 
	gdœ
;

47 
¡ršg
 
	goutdœ
;

48 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
š_fes
;

49 cÚ¡ 
	gu£r_ch¬s_tok’s
[] = {" \r\n\t,.\"!?#%^&*()|-\'+$/:"};

50 
ušt
 
	gmaxäom
 = 0;

51 
ušt
 
	gmaxto
 = 0;

53 
§ve_m­_to_‹xt_fe
(cÚ¡ 
¡d
::
m­
<¡d::
¡ršg
,
ušt
> & m­, cÚ¡ std::¡ršg 
f’ame
){

54 
¡d
::
m­
<¡d::
¡ršg
,
	gušt
>::
cÚ¡_™”©Ü
 
™
;

55 
out_fe
 
fout
(
f’ame
);

56 
	gtÙ®
 = 0;

57 
	g™
 = 
m­
.
begš
(); iˆ!ğm­.
’d
(); it++){

58 
årštf
(
fout
.
outf
, "% %u\n", 
™
->
fœ¡
.
c_¡r
(), it->
£cÚd
);

59 
	gtÙ®
++;

61 
log¡»am
(
LOG_INFO
)<<"WrÙ¨tÙ® oà" << 
	gtÙ®
 << " m­ƒÁr› tØ‹xˆfe: " << 
	gf’ame
 << 
	g¡d
::
’dl
;

65 
§ve_m­_to_‹xt_fe
(cÚ¡ 
¡d
::
m­
<
ušt
,¡d::
¡ršg
> & m­, cÚ¡ std::¡ršg 
f’ame
){

66 
¡d
::
m­
<
ušt
,
	g¡d
::
¡ršg
>::
cÚ¡_™”©Ü
 
™
;

67 
out_fe
 
fout
(
f’ame
);

68 
	gtÙ®
 = 0;

69 
	g™
 = 
m­
.
begš
(); iˆ!ğm­.
’d
(); it++){

70 
årštf
(
fout
.
outf
, "%u %s\n", 
™
->
fœ¡
, it->
£cÚd
.
c_¡r
());

71 
	gtÙ®
++;

73 
log¡»am
(
LOG_INFO
)<<"WrÙ¨tÙ® oà" << 
	gtÙ®
 << " m­ƒÁr› tØ‹xˆfe: " << 
	gf’ame
 << 
	g¡d
::
’dl
;

76 
§ve_m­_to_‹xt_fe
(cÚ¡ 
¡d
::
m­
<
ušt
,ušt> & m­, cÚ¡ std::
¡ršg
 
f’ame
){

77 
¡d
::
m­
<
ušt
,
	gušt
>::
cÚ¡_™”©Ü
 
™
;

78 
out_fe
 
fout
(
f’ame
);

79 
	gtÙ®
 = 0;

80 
	g™
 = 
m­
.
begš
(); iˆ!ğm­.
’d
(); it++){

81 
årštf
(
fout
.
outf
, "%u %u\n", 
™
->
fœ¡
, it->
£cÚd
);

82 
	gtÙ®
++;

84 
log¡»am
(
LOG_INFO
)<<"WrÙ¨tÙ® oà" << 
	gtÙ®
 << " m­ƒÁr› tØ‹xˆfe: " << 
	gf’ame
 << 
	g¡d
::
’dl
;

103 
boŞ
 
	$assign_id
(
ušt
 & 
outv®
, 
¡ršg
 
Çme
, cÚ¡ 
lše
, cÚ¡ sŒšg &
f’ame
){

105 ià(
Çme
.
	`size
(è=ğ0 || 
	`¡r¡r
Òame.
	`c_¡r
(), "/") || strstr(name.c_str(), ":") ||‚ame.size() > 15)

106  
çl£
;

108 
ušt
 
i
=0; i< 
Çme
.
	`size
(); i++)

109 
Çme
[
i
] = 
	`tŞow”
(name[i]);

111 cÚ¡ 
shŒud–
[]= {"@"};

112 
Çme
.
	`”a£
 (
¡d
::
	`»move
Òame.
	`begš
(),‚ame.
	`’d
(), 
shŒud–
[0]),‚ame.end());

114 
m­
<
¡ršg
,
ušt
>::
™”©Ü
 
™
 = 
¡ršg2nodeid
.
	`fšd
(
Çme
);

115 ià(
™
 !ğ
¡ršg2nodeid
.
	`’d
()){

116 
outv®
 = 
™
->
£cÚd
;

117  
Œue
;

119 
mymu‹x
.
	`lock
();

120 
outv®
 = 
¡ršg2nodeid
[
Çme
];

121 ià(
outv®
 == 0){

122 
¡ršg2nodeid
[
Çme
] = ++
cÚ£q_id
;

123 
outv®
 = 
cÚ£q_id
;

124 
nodeid2hash
[
outv®
] = 
Çme
;

126 
mymu‹x
.
	`uÆock
();

127  
Œue
;

128 
	}
}

137 
boŞ
 
	$exŒaù_u£r_Çme
(cÚ¡ * 
lšebuf
, 
size_t
 
lše
, 
i
, * 
§v•Œ
, * 
u£rid
){

140 *
pch
 = 
	`¡¹ok_r
(
NULL
, 
u£r_ch¬s_tok’s
,&
§v•Œ
);

141 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;  
çl£
; }

142 
pch
 = 
	`¡¹ok_r
(
NULL
,
u£r_ch¬s_tok’s
,&
§v•Œ
);

143 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;  
çl£
; }

144 
pch
 = 
	`¡¹ok_r
(
NULL
,
u£r_ch¬s_tok’s
,&
§v•Œ
);

145 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;  
çl£
; }

146 
pch
 = 
	`¡¹ok_r
(
NULL
,
u£r_ch¬s_tok’s
,&
§v•Œ
);

147 ià(!
pch
){ 
	`log¡»am
(
LOG_WARNING
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
; 
missšg_Çmes
++;  
çl£
; }

148 
ušt
 
j
=0; j< 
	`¡¾’
(
pch
); j++èpch[j] = 
	`tŞow”
(pch[j]);

149 
	`¡ºıy
(
u£rid
, 
pch
, 256);

150  
Œue
;

151 
	}
}

154 
boŞ
 
	$cÚv”t_¡ršg_to_time
(cÚ¡ * 
lšebuf
, 
size_t
 
lše
, 
i
, * 
§v•Œ
, & 
ou‰ime
){

155 
tm
 
±m
;

157 *
y—r
 = 
	`¡¹ok_r
(
NULL
," \r\n\t:/-",&
§v•Œ
);

158 ià(!
y—r
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;  
çl£
; }

159 
±m
.
tm_y—r
 = 
	`©oi
(
y—r
) - 1900;

161 *
mÚth
 = 
	`¡¹ok_r
(
NULL
," \r\n\t:/-",&
§v•Œ
);

162 ià(!
mÚth
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;  
çl£
; }

163 
±m
.
tm_mÚ
 = 
	`©oi
(
mÚth
) - 1;

165 *
day
 = 
	`¡¹ok_r
(
NULL
," \r\n\t:/-",&
§v•Œ
);

166 ià(!
day
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;  
çl£
; }

167 
±m
.
tm_mday
 = 
	`©oi
(
day
);

169 *
hour
 = 
	`¡¹ok_r
(
NULL
," \r\n\t:/-",&
§v•Œ
);

170 ià(!
hour
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;  
çl£
; }

171 
±m
.
tm_hour
 = 
	`©oi
(
hour
);

173 *
mšu‹
 = 
	`¡¹ok_r
(
NULL
," \r\n\t:/-",&
§v•Œ
);

174 ià(!
mšu‹
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;  
çl£
; }

175 
±m
.
tm_mš
 = 
	`©oi
(
mšu‹
);

177 *
£cÚd
 = 
	`¡¹ok_r
(
NULL
," \r\n\t:/-",&
§v•Œ
);

178 ià(!
£cÚd
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
;  
çl£
; }

179 
±m
.
tm_£c
 = 
	`©oi
(
£cÚd
);

181 
ou‰ime
 = 
	`mktime
(&
±m
);

182  
Œue
;

184 
	}
}

185 
boŞ
 
	$·r£_lšks
(cÚ¡ * 
lšebuf
, 
size_t
 
lše
, 
i
, * 
§v•Œ
, 
ušt
 
id
, 
±ime
, 
FILE
 * 
f
){

187 
ušt
 
Ùh”id
 = 0;

188 ià(
	`¡r¡r
(
lšebuf
, "http://"))

189 
h‰p_lšks
++;

191 
boŞ
 
found
 = 
çl£
;

193 * 
pch
 = 
NULL
;

195 
pch
 = 
	`¡¹ok_r
(
NULL
, 
u£r_ch¬s_tok’s
, &
§v•Œ
);

196 ià(!
pch
 || 
	`¡¾’
(pch) == 0)

197  
found
;

199 ià(
pch
[0] == '@'){

200 
boŞ
 
ok
 = 
	`assign_id
(
Ùh”id
, 
pch
+1, 
lše
, 
lšebuf
);

201 ià(
ok
){

202 
	`årštf
(
f
, "%u %u %ld 1\n", 
id
, 
Ùh”id
, 
±ime
);

203 
maxäom
 = 
¡d
::
	`max
(maxäom, 
id
);

204 
maxto
 = 
¡d
::
	`max
(maxto, 
Ùh”id
);

205 
lšks_found
++;

206 
found
 = 
Œue
;

208 ià(
debug
 && 
lše
 < 20)

209 
	`´štf
("found†šk b‘w“À: %u %u iÀtim%ld\n", 
id
, 
Ùh”id
, 
±ime
);

211 ià(!
	`¡ºcmp
(
pch
, "RT", 2)){

212 
pch
 = 
	`¡¹ok_r
(
NULL
, 
u£r_ch¬s_tok’s
, &
§v•Œ
);

213 ià(!
pch
 || 
	`¡¾’
(pch) == 0)

216 
boŞ
 
ok
 = 
	`assign_id
(
Ùh”id
, 
pch
, 
lše
, 
lšebuf
);

217 ià(
ok
){

218 
	`årštf
(
f
, "%u %u %ld 2\n", 
id
, 
Ùh”id
, 
±ime
);

219 
»tw“t_found
++;

220 
found
 = 
Œue
;

223 } 
pch
 !ğ
NULL
);

224  
found
;

226 
	}
}

246 
	$·r£
(
i
){

247 
š_fe
 
	`fš
(
š_fes
[
i
]);

248 
out_fe
 
	`fout
((
outdœ
 + 
š_fes
[
i
] + ".out"));

250 
size_t
 
lšesize
 = 0;

251 * 
§v•Œ
 = 
NULL
, * 
lšebuf
 = NULL, 
buf1
[256], 
lšebuf_debug
[1024];

252 
size_t
 
lše
 = 1;

253 
ušt
 
id
;

254 
±ime
;

255 
boŞ
 
ok
;

256 
boŞ
 
fœ¡
 = 
Œue
;

258 
Œue
){

259 
rc
 = 
	`g‘lše
(&
lšebuf
, &
lšesize
, 
fš
.
outf
);

260 
	`¡ºıy
(
lšebuf_debug
, 
lšebuf
, 1024);

261 
tÙ®_lšes
++;

262 ià(
rc
 < 1)

264 ià(
	`¡¾’
(
lšebuf
) <= 1)

266 ià(
fœ¡
){ fœ¡ = 
çl£
; ; }

268 *
pch
 = 
	`¡¹ok_r
(
lšebuf
," \r\n\t:/-", &
§v•Œ
);

269 ià(!
pch
){ 
	`log¡»am
(
LOG_ERROR
è<< "E¼Ü wh’…¬sšg fe: " << 
š_fes
[
i
] << ":" << 
lše
 << "[" << 
lšebuf
 << "]" << 
¡d
::
’dl
; ; }

271 *
pch
){

273 
ok
 = 
	`cÚv”t_¡ršg_to_time
(
lšebuf_debug
, 
tÙ®_lšes
, 
i
, 
§v•Œ
, 
±ime
);

274 ià(!
ok
)

279 
ok
 = 
	`exŒaù_u£r_Çme
(
lšebuf_debug
, 
tÙ®_lšes
, 
i
, 
§v•Œ
, 
buf1
);

280 ià(
ok
)

281 
	`assign_id
(
id
, 
buf1
, 
lše
, 
š_fes
[
i
]);

282 
tw“ts_³r_u£r
[
id
]++;

286 
ok
 = 
	`·r£_lšks
(
lšebuf_debug
, 
tÙ®_lšes
, 
i
, 
§v•Œ
, 
id
, 
±ime
, 
fout
.
outf
);

287 ià(
debug
 && 
lše
 < 20)

288 
	`´štf
("Found u£r: % id %uim%ld\n", 
buf1
, 
id
, 
±ime
);

289 ià(!
ok
)

290 
wide_tw“ts
++;

294 
	`log¡»am
(
LOG_ERROR
)<<"E¼Ü:ƒx³ùšg w™h T U o¸W fœ¡ ch¬aù”" << 
¡d
::
’dl
;

299 
lše
++;

300 ià(
lšes
 && 
lše
>=lines)

303 ià(
debug
 && (
lše
 % 50000 == 0))

304 
	`log¡»am
(
LOG_INFO
è<< "P¬£d†še: " << 
lše
 << " m­ sizis: " << 
¡ršg2nodeid
.
	`size
(è<< 
¡d
::
’dl
;

305 ià(
¡ršg2nodeid
.
	`size
() % 500000 == 0)

306 
	`log¡»am
(
LOG_INFO
è<< "Hash m­ size: " << 
¡ršg2nodeid
.
	`size
(è<< "‡ˆtime: " << 
mytime
.
	`cu¼’t_time
(è<< "ƒdges: " << 
tÙ®_lšes
 << 
¡d
::
’dl
;

309 
	`log¡»am
(
LOG_INFO
è<<"Fšished…¬sšgÙ® oà" << 
lše
 << "†še š f" << 
š_fes
[
i
] << 
’dl
 <<

310 "tÙ® m­ size: " << 
¡ršg2nodeid
.
	`size
(è<< 
’dl
;

312 
	}
}

315 
	$maš
(
¬gc
, cÚ¡ *
¬gv
[]) {

317 
	`log¡»am
(
LOG_WARNING
)<<"GraphChi…arsers†ibrary is written by Danny Bickson (c). Send‡ny "

318 " comm’t Ü bug„•Üt tØdªny.bicksÚ@gma.com " << 
¡d
::
’dl
;

319 
	`glob®_logg”
().
	`£t_log_Ëv–
(
LOG_INFO
);

320 
	`glob®_logg”
().
	`£t_log_to_cÚsŞe
(
Œue
);

322 
	`g¿phchi_š™
(
¬gc
, 
¬gv
);

324 
debug
 = 
	`g‘_İtiÚ_št
("debug", 0);

325 
dœ
 = 
	`g‘_İtiÚ_¡ršg
("file_list");

326 
lšes
 = 
	`g‘_İtiÚ_št
("lines", 0);

327 
	`omp_£t_num_th»ads
(
	`g‘_İtiÚ_št
("ncpus", 1));

328 
mytime
.
	`¡¬t
();

330 
FILE
 * 
f
 = 
	`fİ’
(
dœ
.
	`c_¡r
(), "r");

331 ià(
f
 =ğ
NULL
)

332 
	`log¡»am
(
LOG_FATAL
)<<"FaedØİ’ fli¡!"<<
¡d
::
’dl
;

334 
Œue
){

335 
buf
[256];

336 
rc
 = 
	`fsÿnf
(
f
, "%s\n", 
buf
);

337 ià(
rc
 < 1)

339 
š_fes
.
	`push_back
(
buf
);

342 ià(
š_fes
.
	`size
() == 0)

343 
	`log¡»am
(
LOG_FATAL
)<<"FaedØ»ad‡ny fÇme äomhli¡ fe: " << 
dœ
 << 
¡d
::
’dl
;

345 #´agm¨
omp
 
·¿Î–
 

346 
ušt
 
i
=0; i< 
š_fes
.
	`size
(); i++)

347 
	`·r£
(
i
);

349 
¡d
::
cout
 << "Fšished iÀ" << 
mytime
.
	`cu¼’t_time
(è<< std::
’dl
 << "\ˆdœeùw“t found: " << 
lšks_found
 <<

350 " \ˆglob®w“ts: " << 
wide_tw“ts
 <<

351 "\ˆh‰°lšks: " << 
h‰p_lšks
 <<

352 "\ˆ»tw“ts: " << 
»tw“t_found
 <<

353 "\ˆtÙ®†še š iÅuˆf: " << 
tÙ®_lšes
 <<

354 " \ˆšv®id„ecÜd (missšg‚amesè" << 
missšg_Çmes
 << 
¡d
::
’dl
;

356 
	`§ve_m­_to_‹xt_fe
(
¡ršg2nodeid
, 
outdœ
 + "map.text");

357 
	`§ve_m­_to_‹xt_fe
(
nodeid2hash
, 
outdœ
 + "reverse.map.text");

358 
	`§ve_m­_to_‹xt_fe
(
tw“ts_³r_u£r
, 
outdœ
 + "tweets_per_user.text");

360 
out_fe
 
	`fout
("mm.info");

361 
	`årštf
(
fout
.
outf
, "%%%%MatrixMarket matrix coordinate„eal general\n");

362 
	`årštf
(
fout
.
outf
, "%u %u %lu\n", 
maxäom
+1, 
maxto
+1, 
lšks_found
);

364 
	}
}

	@/usr/include/arpa/inet.h

19 #iâdeà
_ARPA_INET_H


20 
	#_ARPA_INET_H
 1

	)

22 
	~<ã©u»s.h
>

23 
	~<Ãtš‘/š.h
>

26 #iâdeà
__sockËn_t_defšed


27 
__sockËn_t
 
	tsockËn_t
;

28 
	#__sockËn_t_defšed


	)

31 
__BEGIN_DECLS


35 
š_addr_t
 
	$š‘_addr
 (
__cÚ¡
 *
__ı
è
__THROW
;

38 
š_addr_t
 
	$š‘_Êaof
 (
š_addr
 
__š
è
__THROW
;

42 
š_addr
 
	$š‘_mak—ddr
 (
š_addr_t
 
__Ãt
, in_addr_ˆ
__ho¡
)

43 
__THROW
;

46 
š_addr_t
 
	$š‘_Ãtof
 (
š_addr
 
__š
è
__THROW
;

50 
š_addr_t
 
	$š‘_ÃtwÜk
 (
__cÚ¡
 *
__ı
è
__THROW
;

54 *
	$š‘_Áß
 (
š_addr
 
__š
è
__THROW
;

59 
	$š‘_±Ú
 (
__af
, 
__cÚ¡
 *
__»¡riù
 
__ı
,

60 *
__»¡riù
 
__buf
è
__THROW
;

65 
__cÚ¡
 *
	$š‘_Áİ
 (
__af
, 
__cÚ¡
 *
__»¡riù
 
__ı
,

66 *
__»¡riù
 
__buf
, 
sockËn_t
 
__Ën
)

67 
__THROW
;

71 #ifdeà
__USE_MISC


74 
	$š‘_©Ú
 (
__cÚ¡
 *
__ı
, 
š_addr
 *
__šp
è
__THROW
;

78 *
	$š‘_Ã
 (
š_addr_t
 
__Ãt
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

83 *
	$š‘_Ãt_Áİ
 (
__af
, 
__cÚ¡
 *
__ı
, 
__b™s
,

84 *
__buf
, 
size_t
 
__Ën
è
__THROW
;

89 
	$š‘_Ãt_±Ú
 (
__af
, 
__cÚ¡
 *
__ı
,

90 *
__buf
, 
size_t
 
__Ën
è
__THROW
;

95 
	$š‘_n§p_addr
 (
__cÚ¡
 *
__ı
,

96 *
__buf
, 
__Ën
è
__THROW
;

100 *
	$š‘_n§p_Áß
 (
__Ën
, 
__cÚ¡
 *
__ı
,

101 *
__buf
è
__THROW
;

104 
__END_DECLS


	@/usr/include/assert.h

24 #ifdef 
_ASSERT_H


26 #undeà
_ASSERT_H


27 #undeà
as£¹


28 #undeà
__ASSERT_VOID_CAST


30 #ifdef 
__USE_GNU


31 #undeà
as£¹_³¼Ü


36 
	#_ASSERT_H
 1

	)

37 
	~<ã©u»s.h
>

39 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,95)

40 
	#__ASSERT_VOID_CAST
 
¡©ic_ÿ¡
<>

	)

42 
	#__ASSERT_VOID_CAST
 ()

	)

50 #ifdef 
NDEBUG


52 
	#as£¹
(
ex´
è(
	`__ASSERT_VOID_CAST
 (0))

	)

60 #ifdef 
__USE_GNU


61 
	#as£¹_³¼Ü
(
”ºum
è(
	`__ASSERT_VOID_CAST
 (0))

	)

66 #iâdeà
_ASSERT_H_DECLS


67 
	#_ASSERT_H_DECLS


	)

68 
__BEGIN_DECLS


71 
	$__as£¹_ç
 (
__cÚ¡
 *
__as£¹iÚ
, __cÚ¡ *
__fe
,

72 
__lše
, 
__cÚ¡
 *
__funùiÚ
)

73 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

76 
	$__as£¹_³¼Ü_ç
 (
__”ºum
, 
__cÚ¡
 *
__fe
,

77 
__lše
,

78 
__cÚ¡
 *
__funùiÚ
)

79 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

84 
	$__as£¹
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fe
, 
__lše
)

85 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

88 
__END_DECLS


91 
	#as£¹
(
ex´
) \

92 ((
ex´
) \

93 ? 
	`__ASSERT_VOID_CAST
 (0) \

94 : 
	`__as£¹_ç
 (
	`__STRING
(
ex´
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

96 #ifdef 
__USE_GNU


97 
	#as£¹_³¼Ü
(
”ºum
) \

98 (!(
”ºum
) \

99 ? 
	`__ASSERT_VOID_CAST
 (0) \

100 : 
	`__as£¹_³¼Ü_ç
 ((
”ºum
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

108 #ià
defšed
 
__ılu¥lus
 ? 
	`__GNUC_PREREQ
 (2, 6) : __GNUC_PREREQ (2, 4)

109 
	#__ASSERT_FUNCTION
 
__PRETTY_FUNCTION__


	)

111 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

112 
	#__ASSERT_FUNCTION
 
__func__


	)

114 
	#__ASSERT_FUNCTION
 ((
__cÚ¡
 *è0)

	)

	@/usr/include/ctype.h

24 #iâdef 
_CTYPE_H


25 
	#_CTYPE_H
 1

	)

27 
	~<ã©u»s.h
>

28 
	~<b™s/ty³s.h
>

30 
	g__BEGIN_DECLS


32 #iâdeà
_ISb™


41 
	~<’dŸn.h
>

42 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


43 
	#_ISb™
(
b™
è(1 << (b™))

	)

45 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

50 
	m_ISuµ”
 = 
_ISb™
 (0),

51 
	m_ISlow”
 = 
_ISb™
 (1),

52 
	m_IS®pha
 = 
_ISb™
 (2),

53 
	m_ISdig™
 = 
_ISb™
 (3),

54 
	m_ISxdig™
 = 
_ISb™
 (4),

55 
	m_IS¥aû
 = 
_ISb™
 (5),

56 
	m_IS´št
 = 
_ISb™
 (6),

57 
	m_ISg¿ph
 = 
_ISb™
 (7),

58 
	m_ISbÏnk
 = 
_ISb™
 (8),

59 
	m_ISúŒl
 = 
_ISb™
 (9),

60 
	m_ISpunù
 = 
_ISb™
 (10),

61 
	m_IS®num
 = 
_ISb™
 (11)

81 
__cÚ¡
 **
	$__ùy³_b_loc
 ()

82 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

83 
__cÚ¡
 
__št32_t
 **
	$__ùy³_tŞow”_loc
 ()

84 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

85 
__cÚ¡
 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

86 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

89 #iâdeà
__ılu¥lus


90 
	#__isùy³
(
c
, 
ty³
) \

91 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

92 #–ià
defšed
 
__USE_EXTERN_INLINES


93 
	#__isùy³_f
(
ty³
) \

94 
__ex‹º_šlše
 \

95 
is
##
	`ty³
 (
__c
è
__THROW
 \

97  (*
	`__ùy³_b_loc
 ())[(è(
__c
)] & (è
_IS
##
ty³
; \

98 
	}

	)
}

101 
	#__i§scii
(
c
è(((cè& ~0x7fè=ğ0è

	)

102 
	#__tßscii
(
c
è((cè& 0x7fè

	)

104 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

106 
__BEGIN_NAMESPACE_STD


112 
__exùy³
 (
i§Êum
);

113 
__exùy³
 (
i§Íha
);

114 
__exùy³
 (
isúŒl
);

115 
__exùy³
 (
isdig™
);

116 
__exùy³
 (
i¦ow”
);

117 
__exùy³
 (
isg¿ph
);

118 
__exùy³
 (
i¥ršt
);

119 
__exùy³
 (
i¥unù
);

120 
__exùy³
 (
is¥aû
);

121 
__exùy³
 (
isuµ”
);

122 
__exùy³
 (
isxdig™
);

126 
	$tŞow”
 (
__c
è
__THROW
;

129 
	$touµ”
 (
__c
è
__THROW
;

131 
__END_NAMESPACE_STD


135 #ifdef 
__USE_ISOC99


136 
__BEGIN_NAMESPACE_C99


138 
	`__exùy³
 (
isbÏnk
);

140 
__END_NAMESPACE_C99


143 #ifdeà
__USE_GNU


145 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

148 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


152 
	$i§scii
 (
__c
è
__THROW
;

156 
	$tßscii
 (
__c
è
__THROW
;

160 
	`__exùy³
 (
_touµ”
);

161 
	`__exùy³
 (
_tŞow”
);

165 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

166 (
__ex‹nsiÚ__
 \

167 ({ 
__»s
; \

168 ià( (
c
) > 1) \

170 ià(
	`__butš_cÚ¡ªt_p
 (
c
)) \

172 
__c
 = (
c
); \

173 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

176 
__»s
 = 
f
 
¬gs
; \

179 
__»s
 = (
a
)[(è(
c
)]; \

180 
__»s
; 
	}
}))

	)

182 #ià!
defšed
 
__NO_CTYPE


183 #ifdeà
__isùy³_f


184 
	$__isùy³_f
 (
®num
)

185 
	$__isùy³_f
 (
®pha
)

186 
	$__isùy³_f
 (
úŒl
)

187 
	$__isùy³_f
 (
dig™
)

188 
	$__isùy³_f
 (
low”
)

189 
	$__isùy³_f
 (
g¿ph
)

190 
	$__isùy³_f
 (
´št
)

191 
	$__isùy³_f
 (
punù
)

192 
	$__isùy³_f
 (
¥aû
)

193 
	$__isùy³_f
 (
uµ”
)

194 
	$__isùy³_f
 (
xdig™
)

195 #ifdeà
__USE_ISOC99


196 
	$__isùy³_f
 (
bÏnk
)

198 #–ià
defšed
 
__isùy³


199 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

200 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

201 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

202 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

203 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

204 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

205 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

206 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

207 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

208 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

209 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

210 #ifdeà
__USE_ISOC99


211 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

215 #ifdeà
__USE_EXTERN_INLINES


216 
__ex‹º_šlše
 

217 
	`__NTH
 (
	$tŞow”
 (
__c
))

219  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_tŞow”_loc
 ())[__c] : __c;

220 
	}
}

222 
__ex‹º_šlše
 

223 
__NTH
 (
	$touµ”
 (
__c
))

225  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

226 
	}
}

229 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


230 
	#tŞow”
(
c
è
	`__tobody
 (c, 
tŞow”
, *
	`__ùy³_tŞow”_loc
 (), (c))

	)

231 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

234 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


235 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

236 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

238 
	#_tŞow”
(
c
è((è(*
	`__ùy³_tŞow”_loc
 ())[(è(c)])

	)

239 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

245 #ifdeà
__USE_XOPEN2K8


259 
	~<xloÿË.h
>

263 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

264 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

266 
	#__exùy³_l
(
Çme
) \

267 
	`Çme
 (, 
__loÿË_t
è
__THROW


	)

273 
__exùy³_l
 (
i§Êum_l
);

274 
__exùy³_l
 (
i§Íha_l
);

275 
__exùy³_l
 (
isúŒl_l
);

276 
__exùy³_l
 (
isdig™_l
);

277 
__exùy³_l
 (
i¦ow”_l
);

278 
__exùy³_l
 (
isg¿ph_l
);

279 
__exùy³_l
 (
i¥ršt_l
);

280 
__exùy³_l
 (
i¥unù_l
);

281 
__exùy³_l
 (
is¥aû_l
);

282 
__exùy³_l
 (
isuµ”_l
);

283 
__exùy³_l
 (
isxdig™_l
);

285 
__exùy³_l
 (
isbÏnk_l
);

289 
	$__tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

290 
	$tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

293 
	$__touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

294 
	$touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

296 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


297 
	#__tŞow”_l
(
c
, 
loÿË
) \

298 
	`__tobody
 (
c
, 
__tŞow”_l
, (
loÿË
)->
__ùy³_tŞow”
, (c,†oÿË))

	)

299 
	#__touµ”_l
(
c
, 
loÿË
) \

300 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

301 
	#tŞow”_l
(
c
, 
loÿË
è
	`__tŞow”_l
 ((c), (loÿË))

	)

302 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

306 #iâdeà
__NO_CTYPE


307 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

308 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

309 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

310 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

311 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

312 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

313 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

314 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

315 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

316 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

317 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

319 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

321 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


322 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

323 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

326 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

327 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

328 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

329 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

330 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

331 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

332 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

333 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

334 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

335 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

336 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

338 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

340 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


341 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

342 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

349 
__END_DECLS


	@/usr/include/dirent.h

24 #iâdef 
_DIRENT_H


25 
	#_DIRENT_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


31 
	~<b™s/ty³s.h
>

33 #ifdeà
__USE_XOPEN


34 #iâdeà
__šo_t_defšed


35 #iâdeà
__USE_FILE_OFFSET64


36 
__šo_t
 
	tšo_t
;

38 
__šo64_t
 
	tšo_t
;

40 
	#__šo_t_defšed


	)

42 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__šo64_t_defšed


43 
__šo64_t
 
	tšo64_t
;

44 
	#__šo64_t_defšed


	)

63 
	~<b™s/dœ’t.h
>

65 #ià(
defšed
 
__USE_BSD
 || defšed 
__USE_MISC
è&& !defšed 
d_f’o


66 
	#d_šo
 
d_f’o


	)

83 #ifdeà
_DIRENT_HAVE_D_NAMLEN


84 
	#_D_EXACT_NAMLEN
(
d
è((d)->
d_ÇmËn
)

	)

85 
	#_D_ALLOC_NAMLEN
(
d
è(
	`_D_EXACT_NAMLEN
 (dè+ 1)

	)

87 
	#_D_EXACT_NAMLEN
(
d
è(
	`¡¾’
 ((d)->
d_Çme
))

	)

88 #ifdeà
_DIRENT_HAVE_D_RECLEN


89 
	#_D_ALLOC_NAMLEN
(
d
è(((*è(dè+ (d)->
d_»ş’
è- &(d)->
d_Çme
[0])

	)

91 
	#_D_ALLOC_NAMLEN
(
d
è( (d)->
d_Çme
 > 1 ?  (d)->d_name : \

92 
	`_D_EXACT_NAMLEN
 (
d
è+ 1)

	)

97 #ifdeà
__USE_BSD


101 
	mDT_UNKNOWN
 = 0,

102 
	#DT_UNKNOWN
 
DT_UNKNOWN


	)

103 
	mDT_FIFO
 = 1,

104 
	#DT_FIFO
 
DT_FIFO


	)

105 
	mDT_CHR
 = 2,

106 
	#DT_CHR
 
DT_CHR


	)

107 
	mDT_DIR
 = 4,

108 
	#DT_DIR
 
DT_DIR


	)

109 
	mDT_BLK
 = 6,

110 
	#DT_BLK
 
DT_BLK


	)

111 
	mDT_REG
 = 8,

112 
	#DT_REG
 
DT_REG


	)

113 
	mDT_LNK
 = 10,

114 
	#DT_LNK
 
DT_LNK


	)

115 
	mDT_SOCK
 = 12,

116 
	#DT_SOCK
 
DT_SOCK


	)

117 
	mDT_WHT
 = 14

118 
	#DT_WHT
 
DT_WHT


	)

122 
	#IFTODT
(
mode
è(((modeè& 0170000è>> 12)

	)

123 
	#DTTOIF
(
dœty³
è((dœty³è<< 12)

	)

129 
__dœ¡»am
 
	tDIR
;

136 
DIR
 *
	$İ’dœ
 (
__cÚ¡
 *
__Çme
è
	`__nÚnuÎ
 ((1));

138 #ifdeà
__USE_XOPEN2K8


143 
DIR
 *
	`fdİ’dœ
 (
__fd
);

151 
	$şo£dœ
 (
DIR
 *
__dœp
è
	`__nÚnuÎ
 ((1));

163 #iâdeà
__USE_FILE_OFFSET64


164 
dœ’t
 *
	$»addœ
 (
DIR
 *
__dœp
è
	`__nÚnuÎ
 ((1));

166 #ifdeà
__REDIRECT


167 
dœ’t
 *
	`__REDIRECT
 (
»addœ
, (
DIR
 *
__dœp
), 
»addœ64
)

168 
	`__nÚnuÎ
 ((1));

170 
	#»addœ
 
»addœ64


	)

174 #ifdeà
__USE_LARGEFILE64


175 
dœ’t64
 *
	$»addœ64
 (
DIR
 *
__dœp
è
	`__nÚnuÎ
 ((1));

178 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


184 #iâdeà
__USE_FILE_OFFSET64


185 
	$»addœ_r
 (
DIR
 *
__»¡riù
 
__dœp
,

186 
dœ’t
 *
__»¡riù
 
__’Œy
,

187 
dœ’t
 **
__»¡riù
 
__»suÉ
)

188 
	`__nÚnuÎ
 ((1, 2, 3));

190 #ifdeà
__REDIRECT


191 
	`__REDIRECT
 (
»addœ_r
,

192 (
DIR
 *
__»¡riù
 
__dœp
,

193 
dœ’t
 *
__»¡riù
 
__’Œy
,

194 
dœ’t
 **
__»¡riù
 
__»suÉ
),

195 
»addœ64_r
è
	`__nÚnuÎ
 ((1, 2, 3));

197 
	#»addœ_r
 
»addœ64_r


	)

201 #ifdeà
__USE_LARGEFILE64


202 
	$»addœ64_r
 (
DIR
 *
__»¡riù
 
__dœp
,

203 
dœ’t64
 *
__»¡riù
 
__’Œy
,

204 
dœ’t64
 **
__»¡riù
 
__»suÉ
)

205 
	`__nÚnuÎ
 ((1, 2, 3));

210 
	$»wšddœ
 (
DIR
 *
__dœp
è
__THROW
 
	`__nÚnuÎ
 ((1));

212 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


213 
	~<b™s/ty³s.h
>

216 
	$£ekdœ
 (
DIR
 *
__dœp
, 
__pos
è
__THROW
 
	`__nÚnuÎ
 ((1));

219 
	$‹Îdœ
 (
DIR
 *
__dœp
è
__THROW
 
	`__nÚnuÎ
 ((1));

222 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN2K8


225 
	$dœfd
 (
DIR
 *
__dœp
è
__THROW
 
	`__nÚnuÎ
 ((1));

227 #ià
defšed
 
__OPTIMIZE__
 && defšed 
_DIR_dœfd


228 
	#dœfd
(
dœp
è
	`_DIR_dœfd
 (dœp)

	)

231 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_MISC


232 #iâdeà
MAXNAMLEN


234 
	~<b™s/posix1_lim.h
>

237 #ifdeà
NAME_MAX


238 
	#MAXNAMLEN
 
NAME_MAX


	)

240 
	#MAXNAMLEN
 255

	)

245 
	#__Ãed_size_t


	)

246 
	~<¡ddef.h
>

255 #iâdeà
__USE_FILE_OFFSET64


256 
	`sÿndœ
 (
__cÚ¡
 *
__»¡riù
 
__dœ
,

257 
dœ’t
 ***
__»¡riù
 
__Çm–i¡
,

258 (*
__£ËùÜ
è(
__cÚ¡
 
dœ’t
 *),

259 (*
__cmp
è(
__cÚ¡
 
dœ’t
 **,

260 
__cÚ¡
 
dœ’t
 **))

261 
	`__nÚnuÎ
 ((1, 2));

263 #ifdeà
__REDIRECT


264 
	`__REDIRECT
 (
sÿndœ
,

265 (
__cÚ¡
 *
__»¡riù
 
__dœ
,

266 
dœ’t
 ***
__»¡riù
 
__Çm–i¡
,

267 (*
__£ËùÜ
è(
__cÚ¡
 
dœ’t
 *),

268 (*
__cmp
è(
__cÚ¡
 
dœ’t
 **,

269 
__cÚ¡
 
dœ’t
 **)),

270 
sÿndœ64
è
	`__nÚnuÎ
 ((1, 2));

272 
	#sÿndœ
 
sÿndœ64


	)

276 #ià
defšed
 
__USE_GNU
 && defšed 
__USE_LARGEFILE64


279 
	`sÿndœ64
 (
__cÚ¡
 *
__»¡riù
 
__dœ
,

280 
dœ’t64
 ***
__»¡riù
 
__Çm–i¡
,

281 (*
__£ËùÜ
è(
__cÚ¡
 
dœ’t64
 *),

282 (*
__cmp
è(
__cÚ¡
 
dœ’t64
 **,

283 
__cÚ¡
 
dœ’t64
 **))

284 
	`__nÚnuÎ
 ((1, 2));

287 #ifdeà
__USE_GNU


293 #iâdeà
__USE_FILE_OFFSET64


294 
	`sÿndœ©
 (
__dfd
, 
__cÚ¡
 *
__»¡riù
 
__dœ
,

295 
dœ’t
 ***
__»¡riù
 
__Çm–i¡
,

296 (*
__£ËùÜ
è(
__cÚ¡
 
dœ’t
 *),

297 (*
__cmp
è(
__cÚ¡
 
dœ’t
 **,

298 
__cÚ¡
 
dœ’t
 **))

299 
	`__nÚnuÎ
 ((2, 3));

301 #ifdeà
__REDIRECT


302 
	`__REDIRECT
 (
sÿndœ©
,

303 (
__dfd
, 
__cÚ¡
 *
__»¡riù
 
__dœ
,

304 
dœ’t
 ***
__»¡riù
 
__Çm–i¡
,

305 (*
__£ËùÜ
è(
__cÚ¡
 
dœ’t
 *),

306 (*
__cmp
è(
__cÚ¡
 
dœ’t
 **,

307 
__cÚ¡
 
dœ’t
 **)),

308 
sÿndœ©64
è
	`__nÚnuÎ
 ((2, 3));

310 
	#sÿndœ©
 
sÿndœ©64


	)

316 
	`sÿndœ©64
 (
__dfd
, 
__cÚ¡
 *
__»¡riù
 
__dœ
,

317 
dœ’t64
 ***
__»¡riù
 
__Çm–i¡
,

318 (*
__£ËùÜ
è(
__cÚ¡
 
dœ’t64
 *),

319 (*
__cmp
è(
__cÚ¡
 
dœ’t64
 **,

320 
__cÚ¡
 
dœ’t64
 **))

321 
	`__nÚnuÎ
 ((2, 3));

325 #iâdeà
__USE_FILE_OFFSET64


326 
	$®phasÜt
 (
__cÚ¡
 
dœ’t
 **
__e1
,

327 
__cÚ¡
 
dœ’t
 **
__e2
)

328 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

330 #ifdeà
__REDIRECT


331 
	`__REDIRECT_NTH
 (
®phasÜt
,

332 (
__cÚ¡
 
dœ’t
 **
__e1
,

333 
__cÚ¡
 
dœ’t
 **
__e2
),

334 
®phasÜt64
è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

336 
	#®phasÜt
 
®phasÜt64


	)

340 #ià
defšed
 
__USE_GNU
 && defšed 
__USE_LARGEFILE64


341 
	$®phasÜt64
 (
__cÚ¡
 
dœ’t64
 **
__e1
,

342 
__cÚ¡
 
dœ’t64
 **
__e2
)

343 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

348 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_MISC


353 #iâdeà
__USE_FILE_OFFSET64


354 
__ssize_t
 
	$g‘dœ’Œ›s
 (
__fd
, *
__»¡riù
 
__buf
,

355 
size_t
 
__nby‹s
,

356 
__off_t
 *
__»¡riù
 
__ba£p
)

357 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

359 #ifdeà
__REDIRECT


360 
__ssize_t
 
	`__REDIRECT_NTH
 (
g‘dœ’Œ›s
,

361 (
__fd
, *
__»¡riù
 
__buf
,

362 
size_t
 
__nby‹s
,

363 
__off64_t
 *
__»¡riù
 
__ba£p
),

364 
g‘dœ’Œ›s64
è
	`__nÚnuÎ
 ((2, 4));

366 
	#g‘dœ’Œ›s
 
g‘dœ’Œ›s64


	)

370 #ifdeà
__USE_LARGEFILE64


371 
__ssize_t
 
	$g‘dœ’Œ›s64
 (
__fd
, *
__»¡riù
 
__buf
,

372 
size_t
 
__nby‹s
,

373 
__off64_t
 *
__»¡riù
 
__ba£p
)

374 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

378 #ifdeà
__USE_GNU


380 #iâdeà
__USE_FILE_OFFSET64


381 
	$v”siÚsÜt
 (
__cÚ¡
 
dœ’t
 **
__e1
,

382 
__cÚ¡
 
dœ’t
 **
__e2
)

383 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

385 #ifdeà
__REDIRECT


386 
	`__REDIRECT_NTH
 (
v”siÚsÜt
,

387 (
__cÚ¡
 
dœ’t
 **
__e1
,

388 
__cÚ¡
 
dœ’t
 **
__e2
),

389 
v”siÚsÜt64
)

390 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

392 
	#v”siÚsÜt
 
v”siÚsÜt64


	)

396 #ifdeà
__USE_LARGEFILE64


397 
	$v”siÚsÜt64
 (
__cÚ¡
 
dœ’t64
 **
__e1
,

398 
__cÚ¡
 
dœ’t64
 **
__e2
)

399 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

403 
__END_DECLS


	@/usr/include/dlfcn.h

20 #iâdef 
_DLFCN_H


21 
	#_DLFCN_H
 1

	)

23 
	~<ã©u»s.h
>

24 
	#__Ãed_size_t


	)

25 
	~<¡ddef.h
>

28 
	~<b™s/dlfú.h
>

31 #ifdeà
__USE_GNU


36 
	#RTLD_NEXT
 ((*è-1l)

	)

41 
	#RTLD_DEFAULT
 ((*è0)

	)

45 
	tLmid_t
;

48 
	#LM_ID_BASE
 0

	)

49 
	#LM_ID_NEWLM
 -1

	)

53 
__BEGIN_DECLS


57 *
	$dlİ’
 (
__cÚ¡
 *
__fe
, 
__mode
è
__THROW
;

61 
	$dlşo£
 (*
__hªdË
è
__THROW
 
	`__nÚnuÎ
 ((1));

65 *
	$dlsym
 (*
__»¡riù
 
__hªdË
,

66 
__cÚ¡
 *
__»¡riù
 
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((2));

68 #ifdeà
__USE_GNU


70 *
	$dlmİ’
 (
Lmid_t
 
__nsid
, 
__cÚ¡
 *
__fe
, 
__mode
è
__THROW
;

74 *
	$dlvsym
 (*
__»¡riù
 
__hªdË
,

75 
__cÚ¡
 *
__»¡riù
 
__Çme
,

76 
__cÚ¡
 *
__»¡riù
 
__v”siÚ
)

77 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

83 *
	$dË¼Ü
 (è
__THROW
;

86 #ifdeà
__USE_GNU


91 
__cÚ¡
 *
dli_âame
;

92 *
dli_fba£
;

93 
__cÚ¡
 *
dli_¢ame
;

94 *
dli_§ddr
;

95 } 
	tDl_šfo
;

99 
	$dÏddr
 (
__cÚ¡
 *
__add»ss
, 
Dl_šfo
 *
__šfo
)

100 
__THROW
 
	`__nÚnuÎ
 ((2));

103 
	$dÏddr1
 (
__cÚ¡
 *
__add»ss
, 
Dl_šfo
 *
__šfo
,

104 **
__exŒa_šfo
, 
__æags
è
__THROW
 
	`__nÚnuÎ
 ((2));

112 
RTLD_DL_SYMENT
 = 1,

115 
RTLD_DL_LINKMAP
 = 2

124 
	$dlšfo
 (*
__»¡riù
 
__hªdË
,

125 
__»que¡
, *
__»¡riù
 
__¬g
)

126 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

132 
RTLD_DI_LMID
 = 1,

136 
RTLD_DI_LINKMAP
 = 2,

138 
RTLD_DI_CONFIGADDR
 = 3,

145 
RTLD_DI_SERINFO
 = 4,

146 
RTLD_DI_SERINFOSIZE
 = 5,

150 
RTLD_DI_ORIGIN
 = 6,

152 
RTLD_DI_PROFILENAME
 = 7,

153 
RTLD_DI_PROFILEOUT
 = 8,

158 
RTLD_DI_TLS_MODID
 = 9,

164 
RTLD_DI_TLS_DATA
 = 10,

166 
RTLD_DI_MAX
 = 10

174 *
dls_Çme
;

175 
dls_æags
;

176 } 
	tDl_£½©h
;

182 
size_t
 
dls_size
;

183 
dls_út
;

184 
Dl_£½©h
 
dls_£½©h
[1];

185 } 
	tDl_£ršfo
;

189 
__END_DECLS


	@/usr/include/errno.h

23 #iâdef 
_ERRNO_H


27 #iâdef 
__Ãed_Em©h


28 
	#_ERRNO_H
 1

	)

29 
	~<ã©u»s.h
>

32 
	g__BEGIN_DECLS


36 
	~<b™s/”ºo.h
>

37 #undeà
__Ãed_Em©h


39 #ifdef 
_ERRNO_H


46 #iâdef 
”ºo


47 
”ºo
;

50 #ifdeà
__USE_GNU


55 *
´og¿m_švoÿtiÚ_Çme
, *
´og¿m_švoÿtiÚ_shÜt_Çme
;

59 
	g__END_DECLS


67 #ià
defšed
 
__USE_GNU
 || defšed 
__Ãed_”rÜ_t


68 #iâdeà
__”rÜ_t_defšed


69 
	t”rÜ_t
;

70 
	#__”rÜ_t_defšed
 1

	)

72 #undeà
__Ãed_”rÜ_t


	@/usr/include/fcntl.h

24 #iâdef 
_FCNTL_H


25 
	#_FCNTL_H
 1

	)

27 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


34 
	~<b™s/fú.h
>

37 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


38 
	~<b™s/ty³s.h
>

39 
	#__Ãed_time¥ec


	)

40 
	~<time.h
>

41 
	~<b™s/¡©.h
>

43 
	#S_IFMT
 
__S_IFMT


	)

44 
	#S_IFDIR
 
__S_IFDIR


	)

45 
	#S_IFCHR
 
__S_IFCHR


	)

46 
	#S_IFBLK
 
__S_IFBLK


	)

47 
	#S_IFREG
 
__S_IFREG


	)

48 #ifdeà
__S_IFIFO


49 
	#S_IFIFO
 
__S_IFIFO


	)

51 #ifdeà
__S_IFLNK


52 
	#S_IFLNK
 
__S_IFLNK


	)

54 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8
è&& defšed 
__S_IFSOCK


55 
	#S_IFSOCK
 
__S_IFSOCK


	)

60 
	#S_ISUID
 
__S_ISUID


	)

61 
	#S_ISGID
 
__S_ISGID


	)

63 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


65 
	#S_ISVTX
 
__S_ISVTX


	)

68 
	#S_IRUSR
 
__S_IREAD


	)

69 
	#S_IWUSR
 
__S_IWRITE


	)

70 
	#S_IXUSR
 
__S_IEXEC


	)

72 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

74 
	#S_IRGRP
 (
S_IRUSR
 >> 3è

	)

75 
	#S_IWGRP
 (
S_IWUSR
 >> 3è

	)

76 
	#S_IXGRP
 (
S_IXUSR
 >> 3è

	)

78 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

80 
	#S_IROTH
 (
S_IRGRP
 >> 3è

	)

81 
	#S_IWOTH
 (
S_IWGRP
 >> 3è

	)

82 
	#S_IXOTH
 (
S_IXGRP
 >> 3è

	)

84 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

87 #ifdef 
__USE_MISC


88 #iâdeà
R_OK


91 
	#R_OK
 4

	)

92 
	#W_OK
 2

	)

93 
	#X_OK
 1

	)

94 
	#F_OK
 0

	)

99 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


100 
	#SEEK_SET
 0

	)

101 
	#SEEK_CUR
 1

	)

102 
	#SEEK_END
 2

	)

110 
fú
 (
__fd
, 
__cmd
, ...);

118 #iâdeà
__USE_FILE_OFFSET64


119 
	$İ’
 (
__cÚ¡
 *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

121 #ifdeà
__REDIRECT


122 
	`__REDIRECT
 (
İ’
, (
__cÚ¡
 *
__fe
, 
__oæag
, ...), 
İ’64
)

123 
	`__nÚnuÎ
 ((1));

125 
	#İ’
 
İ’64


	)

128 #ifdeà
__USE_LARGEFILE64


129 
	$İ’64
 (
__cÚ¡
 *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

132 #ifdeà
__USE_ATFILE


142 #iâdeà
__USE_FILE_OFFSET64


143 
	$İ’©
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__oæag
, ...)

144 
	`__nÚnuÎ
 ((2));

146 #ifdeà
__REDIRECT


147 
	`__REDIRECT
 (
İ’©
, (
__fd
, 
__cÚ¡
 *
__fe
, 
__oæag
,

148 ...), 
İ’©64
è
	`__nÚnuÎ
 ((2));

150 
	#İ’©
 
İ’©64


	)

153 #ifdeà
__USE_LARGEFILE64


154 
	$İ’©64
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__oæag
, ...)

155 
	`__nÚnuÎ
 ((2));

164 #iâdeà
__USE_FILE_OFFSET64


165 
	$ü—t
 (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

167 #ifdeà
__REDIRECT


168 
	`__REDIRECT
 (
ü—t
, (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
),

169 
ü—t64
è
	`__nÚnuÎ
 ((1));

171 
	#ü—t
 
ü—t64


	)

174 #ifdeà
__USE_LARGEFILE64


175 
	$ü—t64
 (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

178 #ià!
defšed
 
F_LOCK
 && (defšed 
__USE_MISC
 || (defšed 
__USE_XOPEN_EXTENDED
 \

179 && !
defšed
 
__USE_POSIX
))

188 
	#F_ULOCK
 0

	)

189 
	#F_LOCK
 1

	)

190 
	#F_TLOCK
 2

	)

191 
	#F_TEST
 3

	)

193 #iâdeà
__USE_FILE_OFFSET64


194 
	`lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
);

196 #ifdeà
__REDIRECT


197 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
), 
lockf64
);

199 
	#lockf
 
lockf64


	)

202 #ifdeà
__USE_LARGEFILE64


203 
	`lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
);

207 #ifdeà
__USE_XOPEN2K


210 #iâdeà
__USE_FILE_OFFSET64


211 
	$posix_çdvi£
 (
__fd
, 
__off_t
 
__off£t
, __off_ˆ
__Ën
,

212 
__advi£
è
__THROW
;

214 #ifdeà
__REDIRECT_NTH


215 
	`__REDIRECT_NTH
 (
posix_çdvi£
, (
__fd
, 
__off64_t
 
__off£t
,

216 
__off64_t
 
__Ën
, 
__advi£
),

217 
posix_çdvi£64
);

219 
	#posix_çdvi£
 
posix_çdvi£64


	)

222 #ifdeà
__USE_LARGEFILE64


223 
	$posix_çdvi£64
 (
__fd
, 
__off64_t
 
__off£t
, __off64_ˆ
__Ën
,

224 
__advi£
è
__THROW
;

232 #iâdeà
__USE_FILE_OFFSET64


233 
	`posix_çÎoÿ‹
 (
__fd
, 
__off_t
 
__off£t
, __off_ˆ
__Ën
);

235 #ifdeà
__REDIRECT


236 
	`__REDIRECT
 (
posix_çÎoÿ‹
, (
__fd
, 
__off64_t
 
__off£t
,

237 
__off64_t
 
__Ën
),

238 
posix_çÎoÿ‹64
);

240 
	#posix_çÎoÿ‹
 
posix_çÎoÿ‹64


	)

243 #ifdeà
__USE_LARGEFILE64


244 
	`posix_çÎoÿ‹64
 (
__fd
, 
__off64_t
 
__off£t
, __off64_ˆ
__Ën
);

250 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše
 \

251 && 
defšed
 
__va_¬g_·ck_Ën


252 
	~<b™s/fú2.h
>

255 
__END_DECLS


	@/usr/include/inttypes.h

23 #iâdeà
_INTTYPES_H


24 
	#_INTTYPES_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	~<¡dšt.h
>

31 #iâdeà
____gwch¬_t_defšed


32 #ifdeà
__ılu¥lus


33 
	#__gwch¬_t
 
wch¬_t


	)

34 #–ià
defšed
 
__WCHAR_TYPE__


35 
__WCHAR_TYPE__
 
	t__gwch¬_t
;

37 
	#__Ãed_wch¬_t


	)

38 
	~<¡ddef.h
>

39 
wch¬_t
 
	t__gwch¬_t
;

41 
	#____gwch¬_t_defšed
 1

	)

47 #ià!
defšed
 
__ılu¥lus
 || defšed 
__STDC_FORMAT_MACROS


49 #ià
__WORDSIZE
 == 64

50 
	#__PRI64_PREFIX
 "l"

	)

51 
	#__PRIPTR_PREFIX
 "l"

	)

53 
	#__PRI64_PREFIX
 "Î"

	)

54 
	#__PRIPTR_PREFIX


	)

60 
	#PRId8
 "d"

	)

61 
	#PRId16
 "d"

	)

62 
	#PRId32
 "d"

	)

63 
	#PRId64
 
__PRI64_PREFIX
 "d"

	)

65 
	#PRIdLEAST8
 "d"

	)

66 
	#PRIdLEAST16
 "d"

	)

67 
	#PRIdLEAST32
 "d"

	)

68 
	#PRIdLEAST64
 
__PRI64_PREFIX
 "d"

	)

70 
	#PRIdFAST8
 "d"

	)

71 
	#PRIdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

72 
	#PRIdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

73 
	#PRIdFAST64
 
__PRI64_PREFIX
 "d"

	)

76 
	#PRIi8
 "i"

	)

77 
	#PRIi16
 "i"

	)

78 
	#PRIi32
 "i"

	)

79 
	#PRIi64
 
__PRI64_PREFIX
 "i"

	)

81 
	#PRIiLEAST8
 "i"

	)

82 
	#PRIiLEAST16
 "i"

	)

83 
	#PRIiLEAST32
 "i"

	)

84 
	#PRIiLEAST64
 
__PRI64_PREFIX
 "i"

	)

86 
	#PRIiFAST8
 "i"

	)

87 
	#PRIiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

88 
	#PRIiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

89 
	#PRIiFAST64
 
__PRI64_PREFIX
 "i"

	)

92 
	#PRIo8
 "o"

	)

93 
	#PRIo16
 "o"

	)

94 
	#PRIo32
 "o"

	)

95 
	#PRIo64
 
__PRI64_PREFIX
 "o"

	)

97 
	#PRIoLEAST8
 "o"

	)

98 
	#PRIoLEAST16
 "o"

	)

99 
	#PRIoLEAST32
 "o"

	)

100 
	#PRIoLEAST64
 
__PRI64_PREFIX
 "o"

	)

102 
	#PRIoFAST8
 "o"

	)

103 
	#PRIoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

104 
	#PRIoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

105 
	#PRIoFAST64
 
__PRI64_PREFIX
 "o"

	)

108 
	#PRIu8
 "u"

	)

109 
	#PRIu16
 "u"

	)

110 
	#PRIu32
 "u"

	)

111 
	#PRIu64
 
__PRI64_PREFIX
 "u"

	)

113 
	#PRIuLEAST8
 "u"

	)

114 
	#PRIuLEAST16
 "u"

	)

115 
	#PRIuLEAST32
 "u"

	)

116 
	#PRIuLEAST64
 
__PRI64_PREFIX
 "u"

	)

118 
	#PRIuFAST8
 "u"

	)

119 
	#PRIuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

120 
	#PRIuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

121 
	#PRIuFAST64
 
__PRI64_PREFIX
 "u"

	)

124 
	#PRIx8
 "x"

	)

125 
	#PRIx16
 "x"

	)

126 
	#PRIx32
 "x"

	)

127 
	#PRIx64
 
__PRI64_PREFIX
 "x"

	)

129 
	#PRIxLEAST8
 "x"

	)

130 
	#PRIxLEAST16
 "x"

	)

131 
	#PRIxLEAST32
 "x"

	)

132 
	#PRIxLEAST64
 
__PRI64_PREFIX
 "x"

	)

134 
	#PRIxFAST8
 "x"

	)

135 
	#PRIxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

136 
	#PRIxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

137 
	#PRIxFAST64
 
__PRI64_PREFIX
 "x"

	)

140 
	#PRIX8
 "X"

	)

141 
	#PRIX16
 "X"

	)

142 
	#PRIX32
 "X"

	)

143 
	#PRIX64
 
__PRI64_PREFIX
 "X"

	)

145 
	#PRIXLEAST8
 "X"

	)

146 
	#PRIXLEAST16
 "X"

	)

147 
	#PRIXLEAST32
 "X"

	)

148 
	#PRIXLEAST64
 
__PRI64_PREFIX
 "X"

	)

150 
	#PRIXFAST8
 "X"

	)

151 
	#PRIXFAST16
 
__PRIPTR_PREFIX
 "X"

	)

152 
	#PRIXFAST32
 
__PRIPTR_PREFIX
 "X"

	)

153 
	#PRIXFAST64
 
__PRI64_PREFIX
 "X"

	)

157 
	#PRIdMAX
 
__PRI64_PREFIX
 "d"

	)

158 
	#PRIiMAX
 
__PRI64_PREFIX
 "i"

	)

159 
	#PRIoMAX
 
__PRI64_PREFIX
 "o"

	)

160 
	#PRIuMAX
 
__PRI64_PREFIX
 "u"

	)

161 
	#PRIxMAX
 
__PRI64_PREFIX
 "x"

	)

162 
	#PRIXMAX
 
__PRI64_PREFIX
 "X"

	)

166 
	#PRIdPTR
 
__PRIPTR_PREFIX
 "d"

	)

167 
	#PRIiPTR
 
__PRIPTR_PREFIX
 "i"

	)

168 
	#PRIoPTR
 
__PRIPTR_PREFIX
 "o"

	)

169 
	#PRIuPTR
 
__PRIPTR_PREFIX
 "u"

	)

170 
	#PRIxPTR
 
__PRIPTR_PREFIX
 "x"

	)

171 
	#PRIXPTR
 
__PRIPTR_PREFIX
 "X"

	)

177 
	#SCNd8
 "hhd"

	)

178 
	#SCNd16
 "hd"

	)

179 
	#SCNd32
 "d"

	)

180 
	#SCNd64
 
__PRI64_PREFIX
 "d"

	)

182 
	#SCNdLEAST8
 "hhd"

	)

183 
	#SCNdLEAST16
 "hd"

	)

184 
	#SCNdLEAST32
 "d"

	)

185 
	#SCNdLEAST64
 
__PRI64_PREFIX
 "d"

	)

187 
	#SCNdFAST8
 "hhd"

	)

188 
	#SCNdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

189 
	#SCNdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

190 
	#SCNdFAST64
 
__PRI64_PREFIX
 "d"

	)

193 
	#SCNi8
 "hhi"

	)

194 
	#SCNi16
 "hi"

	)

195 
	#SCNi32
 "i"

	)

196 
	#SCNi64
 
__PRI64_PREFIX
 "i"

	)

198 
	#SCNiLEAST8
 "hhi"

	)

199 
	#SCNiLEAST16
 "hi"

	)

200 
	#SCNiLEAST32
 "i"

	)

201 
	#SCNiLEAST64
 
__PRI64_PREFIX
 "i"

	)

203 
	#SCNiFAST8
 "hhi"

	)

204 
	#SCNiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

205 
	#SCNiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

206 
	#SCNiFAST64
 
__PRI64_PREFIX
 "i"

	)

209 
	#SCNu8
 "hhu"

	)

210 
	#SCNu16
 "hu"

	)

211 
	#SCNu32
 "u"

	)

212 
	#SCNu64
 
__PRI64_PREFIX
 "u"

	)

214 
	#SCNuLEAST8
 "hhu"

	)

215 
	#SCNuLEAST16
 "hu"

	)

216 
	#SCNuLEAST32
 "u"

	)

217 
	#SCNuLEAST64
 
__PRI64_PREFIX
 "u"

	)

219 
	#SCNuFAST8
 "hhu"

	)

220 
	#SCNuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

221 
	#SCNuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

222 
	#SCNuFAST64
 
__PRI64_PREFIX
 "u"

	)

225 
	#SCNo8
 "hho"

	)

226 
	#SCNo16
 "ho"

	)

227 
	#SCNo32
 "o"

	)

228 
	#SCNo64
 
__PRI64_PREFIX
 "o"

	)

230 
	#SCNoLEAST8
 "hho"

	)

231 
	#SCNoLEAST16
 "ho"

	)

232 
	#SCNoLEAST32
 "o"

	)

233 
	#SCNoLEAST64
 
__PRI64_PREFIX
 "o"

	)

235 
	#SCNoFAST8
 "hho"

	)

236 
	#SCNoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

237 
	#SCNoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

238 
	#SCNoFAST64
 
__PRI64_PREFIX
 "o"

	)

241 
	#SCNx8
 "hhx"

	)

242 
	#SCNx16
 "hx"

	)

243 
	#SCNx32
 "x"

	)

244 
	#SCNx64
 
__PRI64_PREFIX
 "x"

	)

246 
	#SCNxLEAST8
 "hhx"

	)

247 
	#SCNxLEAST16
 "hx"

	)

248 
	#SCNxLEAST32
 "x"

	)

249 
	#SCNxLEAST64
 
__PRI64_PREFIX
 "x"

	)

251 
	#SCNxFAST8
 "hhx"

	)

252 
	#SCNxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

253 
	#SCNxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

254 
	#SCNxFAST64
 
__PRI64_PREFIX
 "x"

	)

258 
	#SCNdMAX
 
__PRI64_PREFIX
 "d"

	)

259 
	#SCNiMAX
 
__PRI64_PREFIX
 "i"

	)

260 
	#SCNoMAX
 
__PRI64_PREFIX
 "o"

	)

261 
	#SCNuMAX
 
__PRI64_PREFIX
 "u"

	)

262 
	#SCNxMAX
 
__PRI64_PREFIX
 "x"

	)

265 
	#SCNdPTR
 
__PRIPTR_PREFIX
 "d"

	)

266 
	#SCNiPTR
 
__PRIPTR_PREFIX
 "i"

	)

267 
	#SCNoPTR
 
__PRIPTR_PREFIX
 "o"

	)

268 
	#SCNuPTR
 
__PRIPTR_PREFIX
 "u"

	)

269 
	#SCNxPTR
 
__PRIPTR_PREFIX
 "x"

	)

274 
	g__BEGIN_DECLS


276 #ià
__WORDSIZE
 == 64

281 
	mquÙ
;

282 
	m»m
;

283 } 
	timaxdiv_t
;

290 
	mquÙ
;

291 
	m»m
;

292 } 
	timaxdiv_t
;

298 
štmax_t
 
	$imaxabs
 (
štmax_t
 
__n
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

301 
imaxdiv_t
 
	$imaxdiv
 (
štmax_t
 
__num”
, iÁmax_ˆ
__d’om
)

302 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

305 
štmax_t
 
	$¡¹oimax
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

306 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

309 
uštmax_t
 
	$¡¹oumax
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

310 ** 
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

313 
štmax_t
 
	$wc¡oimax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

314 
__gwch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

315 
__THROW
;

318 
uštmax_t
 
	$wc¡oumax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

319 
__gwch¬_t
 ** 
__»¡riù
 
__’d±r
, 
__ba£
)

320 
__THROW
;

322 #ifdeà
__USE_EXTERN_INLINES


324 #ià
__WORDSIZE
 == 64

326 
	$__¡¹Ş_š‹º®
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

327 **
__»¡riù
 
__’d±r
,

328 
__ba£
, 
__group
)

329 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

331 
__ex‹º_šlše
 
štmax_t


332 
	`__NTH
 (
	$¡¹oimax
 (
__cÚ¡
 *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

333 
ba£
))

335  
	`__¡¹Ş_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

336 
	}
}

338 
	$__¡¹oul_š‹º®
 (
__cÚ¡
 *

339 
__»¡riù
 
__ÅŒ
,

340 ** 
__»¡riù
 
__’d±r
,

341 
__ba£
, 
__group
)

342 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

344 
__ex‹º_šlše
 
uštmax_t


345 
	`__NTH
 (
	$¡¹oumax
 (
__cÚ¡
 *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

346 
ba£
))

348  
	`__¡¹oul_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

349 
	}
}

351 
	$__wc¡Ş_š‹º®
 (
__cÚ¡
 
__gwch¬_t
 * 
__»¡riù
 
__ÅŒ
,

352 
__gwch¬_t
 **
__»¡riù
 
__’d±r
,

353 
__ba£
, 
__group
)

354 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

356 
__ex‹º_šlše
 
štmax_t


357 
	`__NTH
 (
	$wc¡oimax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

358 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

360  
	`__wc¡Ş_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

361 
	}
}

363 
	$__wc¡oul_š‹º®
 (
__cÚ¡
 
__gwch¬_t
 *

364 
__»¡riù
 
__ÅŒ
,

365 
__gwch¬_t
 **

366 
__»¡riù
 
__’d±r
,

367 
__ba£
, 
__group
)

368 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

370 
__ex‹º_šlše
 
uštmax_t


371 
	`__NTH
 (
	$wc¡oumax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

372 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

374  
	`__wc¡oul_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

375 
	}
}

379 
__ex‹nsiÚ__


380 
	$__¡¹Şl_š‹º®
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

381 **
__»¡riù
 
__’d±r
,

382 
__ba£
, 
__group
)

383 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

385 
__ex‹º_šlše
 
štmax_t


386 
	`__NTH
 (
	$¡¹oimax
 (
__cÚ¡
 *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

387 
ba£
))

389  
	`__¡¹Şl_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

390 
	}
}

392 
__ex‹nsiÚ__


393 
	$__¡¹ouÎ_š‹º®
 (
__cÚ¡
 *

394 
__»¡riù
 
__ÅŒ
,

396 
__»¡riù
 
__’d±r
,

397 
__ba£
,

398 
__group
)

399 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

401 
__ex‹º_šlše
 
uštmax_t


402 
	`__NTH
 (
	$¡¹oumax
 (
__cÚ¡
 *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

403 
ba£
))

405  
	`__¡¹ouÎ_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

406 
	}
}

408 
__ex‹nsiÚ__


409 
	$__wc¡Şl_š‹º®
 (
__cÚ¡
 
__gwch¬_t
 *

410 
__»¡riù
 
__ÅŒ
,

411 
__gwch¬_t
 **
__»¡riù
 
__’d±r
,

412 
__ba£
, 
__group
)

413 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

415 
__ex‹º_šlše
 
štmax_t


416 
	`__NTH
 (
	$wc¡oimax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

417 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

419  
	`__wc¡Şl_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

420 
	}
}

423 
__ex‹nsiÚ__


424 
	$__wc¡ouÎ_š‹º®
 (
__cÚ¡
 
__gwch¬_t
 *

425 
__»¡riù
 
__ÅŒ
,

426 
__gwch¬_t
 **

427 
__»¡riù
 
__’d±r
,

428 
__ba£
,

429 
__group
)

430 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

432 
__ex‹º_šlše
 
uštmax_t


433 
	`__NTH
 (
	$wc¡oumax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

434 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

436  
	`__wc¡ouÎ_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

437 
	}
}

442 
	g__END_DECLS


	@/usr/include/limits.h

24 #iâdeà
_LIBC_LIMITS_H_


25 
	#_LIBC_LIMITS_H_
 1

	)

27 
	~<ã©u»s.h
>

33 
	#MB_LEN_MAX
 16

	)

38 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

43 #iâdeà
_LIMITS_H


44 
	#_LIMITS_H
 1

	)

46 
	~<b™s/wÜdsize.h
>

55 
	#CHAR_BIT
 8

	)

58 
	#SCHAR_MIN
 (-128)

	)

59 
	#SCHAR_MAX
 127

	)

62 
	#UCHAR_MAX
 255

	)

65 #ifdeà
__CHAR_UNSIGNED__


66 
	#CHAR_MIN
 0

	)

67 
	#CHAR_MAX
 
UCHAR_MAX


	)

69 
	#CHAR_MIN
 
SCHAR_MIN


	)

70 
	#CHAR_MAX
 
SCHAR_MAX


	)

74 
	#SHRT_MIN
 (-32768)

	)

75 
	#SHRT_MAX
 32767

	)

78 
	#USHRT_MAX
 65535

	)

81 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

82 
	#INT_MAX
 2147483647

	)

85 
	#UINT_MAX
 4294967295U

	)

88 #ià
__WORDSIZE
 == 64

89 
	#LONG_MAX
 9223372036854775807L

	)

91 
	#LONG_MAX
 2147483647L

	)

93 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

96 #ià
__WORDSIZE
 == 64

97 
	#ULONG_MAX
 18446744073709551615UL

	)

99 
	#ULONG_MAX
 4294967295UL

	)

102 #ifdeà
__USE_ISOC99


105 
	#LLONG_MAX
 9223372036854775807LL

	)

106 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

109 
	#ULLONG_MAX
 18446744073709551615ULL

	)

123 #ià
defšed
 
__GNUC__
 && !defšed 
_GCC_LIMITS_H_


125 #šşude_Ãxˆ<
lim™s
.
h
>

131 #ià
defšed
 
__USE_ISOC99
 && defšed 
__GNUC__


132 #iâdeà
LLONG_MIN


133 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

135 #iâdeà
LLONG_MAX


136 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

138 #iâdeà
ULLONG_MAX


139 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

143 #ifdef 
__USE_POSIX


145 
	~<b™s/posix1_lim.h
>

148 #ifdef 
__USE_POSIX2


149 
	~<b™s/posix2_lim.h
>

152 #ifdef 
__USE_XOPEN


153 
	~<b™s/xİ’_lim.h
>

	@/usr/include/memory.h

23 #iâdef 
_MEMORY_H


24 
	#_MEMORY_H
 1

	)

26 
	~<ã©u»s.h
>

29 #iâdef 
_STRING_H


30 
	~<¡ršg.h
>

	@/usr/include/netdb.h

23 #iâdef 
_NETDB_H


24 
	#_NETDB_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	~<Ãtš‘/š.h
>

29 
	~<¡dšt.h
>

30 #ifdeà
__USE_MISC


33 
	~<½c/Ãtdb.h
>

36 #ifdeà
__USE_GNU


37 
	#__Ãed_sigev’t_t


	)

38 
	~<b™s/sigšfo.h
>

39 
	#__Ãed_time¥ec


	)

40 
	~<time.h
>

43 
	~<b™s/Ãtdb.h
>

46 
	#_PATH_HEQUIV
 "/‘c/ho¡s.equiv"

	)

47 
	#_PATH_HOSTS
 "/‘c/ho¡s"

	)

48 
	#_PATH_NETWORKS
 "/‘c/ÃtwÜks"

	)

49 
	#_PATH_NSSWITCH_CONF
 "/‘c/nssw™ch.cÚf"

	)

50 
	#_PATH_PROTOCOLS
 "/‘c/´ÙocŞs"

	)

51 
	#_PATH_SERVICES
 "/‘c/£rviûs"

	)

54 
	g__BEGIN_DECLS


56 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


59 
	#h_”ºo
 (*
	`__h_”ºo_loÿtiÚ
 ())

	)

62 *
	$__h_”ºo_loÿtiÚ
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

66 
	#HOST_NOT_FOUND
 1

	)

67 
	#TRY_AGAIN
 2

	)

69 
	#NO_RECOVERY
 3

	)

71 
	#NO_DATA
 4

	)

74 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


75 
	#NETDB_INTERNAL
 -1

	)

76 
	#NETDB_SUCCESS
 0

	)

77 
	#NO_ADDRESS
 
NO_DATA


	)

80 #ifdeà
__USE_XOPEN2K


82 
	#IPPORT_RESERVED
 1024

	)

85 #ifdeà
__USE_GNU


87 
	#SCOPE_DELIMITER
 '%'

	)

90 #ifdeà
__USE_MISC


93 
	$h”rÜ
 (
__cÚ¡
 *
__¡r
è
__THROW
;

96 
__cÚ¡
 *
	$h¡»¼Ü
 (
__”r_num
è
__THROW
;

101 
	sho¡’t


103 *
h_Çme
;

104 **
h_®Ÿ£s
;

105 
h_add¹y³
;

106 
h_Ëngth
;

107 **
h_addr_li¡
;

108 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


109 
	#h_addr
 
h_addr_li¡
[0]

	)

118 
	`£tho¡’t
 (
__¡ay_İ’
);

124 
	`’dho¡’t
 ();

131 
ho¡’t
 *
	`g‘ho¡’t
 ();

138 
ho¡’t
 *
	`g‘ho¡byaddr
 (
__cÚ¡
 *
__addr
, 
__sockËn_t
 
__Ën
,

139 
__ty³
);

145 
ho¡’t
 *
	`g‘ho¡byÇme
 (
__cÚ¡
 *
__Çme
);

147 #ifdeà
__USE_MISC


156 
ho¡’t
 *
	`g‘ho¡byÇme2
 (
__cÚ¡
 *
__Çme
, 
__af
);

168 
	`g‘ho¡’t_r
 (
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

169 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

170 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

171 *
__»¡riù
 
__h_”ºİ
);

173 
	`g‘ho¡byaddr_r
 (
__cÚ¡
 *
__»¡riù
 
__addr
, 
__sockËn_t
 
__Ën
,

174 
__ty³
,

175 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

176 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

177 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

178 *
__»¡riù
 
__h_”ºİ
);

180 
	`g‘ho¡byÇme_r
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

181 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

182 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

183 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

184 *
__»¡riù
 
__h_”ºİ
);

186 
	`g‘ho¡byÇme2_r
 (
__cÚ¡
 *
__»¡riù
 
__Çme
, 
__af
,

187 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

188 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

189 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

190 *
__»¡riù
 
__h_”ºİ
);

199 
	`£Š‘’t
 (
__¡ay_İ’
);

205 
	`’dÃ‹Á
 ();

212 
Ã‹Á
 *
	`g‘Ã‹Á
 ();

219 
Ã‹Á
 *
	`g‘Ãtbyaddr
 (
ušt32_t
 
__Ãt
, 
__ty³
);

225 
Ã‹Á
 *
	`g‘ÃtbyÇme
 (
__cÚ¡
 *
__Çme
);

227 #ifdef 
__USE_MISC


238 
	`g‘Ã‹Á_r
 (
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

239 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

240 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

241 *
__»¡riù
 
__h_”ºİ
);

243 
	`g‘Ãtbyaddr_r
 (
ušt32_t
 
__Ãt
, 
__ty³
,

244 
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

245 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

246 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

247 *
__»¡riù
 
__h_”ºİ
);

249 
	`g‘ÃtbyÇme_r
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

250 
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

251 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

252 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

253 *
__»¡riù
 
__h_”ºİ
);

258 
	s£rv’t


260 *
s_Çme
;

261 **
s_®Ÿ£s
;

262 
s_pÜt
;

263 *
s_´Ùo
;

271 
	`£t£rv’t
 (
__¡ay_İ’
);

277 
	`’d£rv’t
 ();

284 
£rv’t
 *
	`g‘£rv’t
 ();

291 
£rv’t
 *
	`g‘£rvbyÇme
 (
__cÚ¡
 *
__Çme
,

292 
__cÚ¡
 *
__´Ùo
);

299 
£rv’t
 *
	`g‘£rvbypÜt
 (
__pÜt
, 
__cÚ¡
 *
__´Ùo
);

302 #ifdef 
__USE_MISC


310 
	`g‘£rv’t_r
 (
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

311 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

312 
£rv’t
 **
__»¡riù
 
__»suÉ
);

314 
	`g‘£rvbyÇme_r
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

315 
__cÚ¡
 *
__»¡riù
 
__´Ùo
,

316 
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

317 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

318 
£rv’t
 **
__»¡riù
 
__»suÉ
);

320 
	`g‘£rvbypÜt_r
 (
__pÜt
, 
__cÚ¡
 *
__»¡riù
 
__´Ùo
,

321 
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

322 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

323 
£rv’t
 **
__»¡riù
 
__»suÉ
);

328 
	s´ÙÛÁ


330 *
p_Çme
;

331 **
p_®Ÿ£s
;

332 
p_´Ùo
;

340 
	`£rÙÛÁ
 (
__¡ay_İ’
);

346 
	`’d´ÙÛÁ
 ();

353 
´ÙÛÁ
 *
	`g‘´ÙÛÁ
 ();

359 
´ÙÛÁ
 *
	`g‘´ÙobyÇme
 (
__cÚ¡
 *
__Çme
);

365 
´ÙÛÁ
 *
	`g‘´Ùobynumb”
 (
__´Ùo
);

368 #ifdef 
__USE_MISC


376 
	`g‘´ÙÛÁ_r
 (
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

377 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

378 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

380 
	`g‘´ÙobyÇme_r
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

381 
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

382 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

383 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

385 
	`g‘´Ùobynumb”_r
 (
__´Ùo
,

386 
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

387 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

388 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

397 
	`£Š‘g»Á
 (
__cÚ¡
 *
__Ãtgroup
);

405 
	`’dÃtg»Á
 ();

414 
	`g‘Ãtg»Á
 (**
__»¡riù
 
__ho¡p
,

415 **
__»¡riù
 
__u£½
,

416 **
__»¡riù
 
__domašp
);

425 
	`šÃtgr
 (
__cÚ¡
 *
__Ãtgroup
, __cÚ¡ *
__ho¡
,

426 
__cÚ¡
 *
__u£r
, __cÚ¡ *
__domaš
);

434 
	`g‘Ãtg»Á_r
 (**
__»¡riù
 
__ho¡p
,

435 **
__»¡riù
 
__u£½
,

436 **
__»¡riù
 
__domašp
,

437 *
__»¡riù
 
__bufãr
, 
size_t
 
__buæ’
);

441 #ifdeà
__USE_BSD


453 
	`rcmd
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

454 
__cÚ¡
 *
__»¡riù
 
__locu£r
,

455 
__cÚ¡
 *
__»¡riù
 
__»mu£r
,

456 
__cÚ¡
 *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
);

465 
	`rcmd_af
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

466 
__cÚ¡
 *
__»¡riù
 
__locu£r
,

467 
__cÚ¡
 *
__»¡riù
 
__»mu£r
,

468 
__cÚ¡
 *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
,

469 
§_çmy_t
 
__af
);

481 
	`»xec
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

482 
__cÚ¡
 *
__»¡riù
 
__Çme
,

483 
__cÚ¡
 *
__»¡riù
 
__·ss
,

484 
__cÚ¡
 *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
);

493 
	`»xec_af
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

494 
__cÚ¡
 *
__»¡riù
 
__Çme
,

495 
__cÚ¡
 *
__»¡riù
 
__·ss
,

496 
__cÚ¡
 *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
,

497 
§_çmy_t
 
__af
);

507 
	`ru£rok
 (
__cÚ¡
 *
__rho¡
, 
__su£r
,

508 
__cÚ¡
 *
__»mu£r
, __cÚ¡ *
__locu£r
);

517 
	`ru£rok_af
 (
__cÚ¡
 *
__rho¡
, 
__su£r
,

518 
__cÚ¡
 *
__»mu£r
, __cÚ¡ *
__locu£r
,

519 
§_çmy_t
 
__af
);

530 
	`œu£rok
 (
ušt32_t
 
__¿ddr
, 
__su£r
,

531 
__cÚ¡
 *
__»mu£r
, __cÚ¡ *
__locu£r
);

541 
	`œu£rok_af
 (
__cÚ¡
 *
__¿ddr
, 
__su£r
,

542 
__cÚ¡
 *
__»mu£r
, __cÚ¡ *
__locu£r
,

543 
§_çmy_t
 
__af
);

553 
	`¼esvpÜt
 (*
__®pÜt
);

562 
	`¼esvpÜt_af
 (*
__®pÜt
, 
§_çmy_t
 
__af
);

567 #ifdef 
__USE_POSIX


569 
	saddršfo


571 
ai_æags
;

572 
ai_çmy
;

573 
ai_sockty³
;

574 
ai_´ÙocŞ
;

575 
sockËn_t
 
ai_add¾’
;

576 
sockaddr
 *
ai_addr
;

577 *
ai_ÿnÚÇme
;

578 
addršfo
 *
ai_Ãxt
;

581 #ifdeà
__USE_GNU


583 
	sgaicb


585 cÚ¡ *
¬_Çme
;

586 cÚ¡ *
¬_£rviû
;

587 cÚ¡ 
addršfo
 *
¬_»que¡
;

588 
addršfo
 *
¬_»suÉ
;

590 
__»tuº
;

591 
__unu£d
[5];

595 
	#GAI_WAIT
 0

	)

596 
	#GAI_NOWAIT
 1

	)

600 
	#AI_PASSIVE
 0x0001

	)

601 
	#AI_CANONNAME
 0x0002

	)

602 
	#AI_NUMERICHOST
 0x0004

	)

603 
	#AI_V4MAPPED
 0x0008

	)

604 
	#AI_ALL
 0x0010

	)

605 
	#AI_ADDRCONFIG
 0x0020

	)

607 #ifdeà
__USE_GNU


608 
	#AI_IDN
 0x0040

	)

611 
	#AI_CANONIDN
 0x0080

	)

612 
	#AI_IDN_ALLOW_UNASSIGNED
 0x0100

	)

614 
	#AI_IDN_USE_STD3_ASCII_RULES
 0x0200

	)

617 
	#AI_NUMERICSERV
 0x0400

	)

620 
	#EAI_BADFLAGS
 -1

	)

621 
	#EAI_NONAME
 -2

	)

622 
	#EAI_AGAIN
 -3

	)

623 
	#EAI_FAIL
 -4

	)

624 
	#EAI_FAMILY
 -6

	)

625 
	#EAI_SOCKTYPE
 -7

	)

626 
	#EAI_SERVICE
 -8

	)

627 
	#EAI_MEMORY
 -10

	)

628 
	#EAI_SYSTEM
 -11

	)

629 
	#EAI_OVERFLOW
 -12

	)

630 #ifdeà
__USE_GNU


631 
	#EAI_NODATA
 -5

	)

632 
	#EAI_ADDRFAMILY
 -9

	)

633 
	#EAI_INPROGRESS
 -100

	)

634 
	#EAI_CANCELED
 -101

	)

635 
	#EAI_NOTCANCELED
 -102

	)

636 
	#EAI_ALLDONE
 -103

	)

637 
	#EAI_INTR
 -104

	)

638 
	#EAI_IDN_ENCODE
 -105

	)

641 #ifdeà
__USE_MISC


642 
	#NI_MAXHOST
 1025

	)

643 
	#NI_MAXSERV
 32

	)

646 
	#NI_NUMERICHOST
 1

	)

647 
	#NI_NUMERICSERV
 2

	)

648 
	#NI_NOFQDN
 4

	)

649 
	#NI_NAMEREQD
 8

	)

650 
	#NI_DGRAM
 16

	)

651 #ifdeà
__USE_GNU


652 
	#NI_IDN
 32

	)

653 
	#NI_IDN_ALLOW_UNASSIGNED
 64

	)

655 
	#NI_IDN_USE_STD3_ASCII_RULES
 128

	)

664 
	`g‘addršfo
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

665 
__cÚ¡
 *
__»¡riù
 
__£rviû
,

666 
__cÚ¡
 
addršfo
 *
__»¡riù
 
__»q
,

667 
addršfo
 **
__»¡riù
 
__·i
);

670 
	$ä“addršfo
 (
addršfo
 *
__ai
è
__THROW
;

673 
__cÚ¡
 *
	$gai_¡»¼Ü
 (
__ecode
è
__THROW
;

679 
	`g‘Çmešfo
 (
__cÚ¡
 
sockaddr
 *
__»¡riù
 
__§
,

680 
sockËn_t
 
__§Ën
, *
__»¡riù
 
__ho¡
,

681 
sockËn_t
 
__ho¡Ën
, *
__»¡riù
 
__£rv
,

682 
sockËn_t
 
__£rvËn
, 
__æags
);

685 #ifdeà
__USE_GNU


694 
	`g‘addršfo_a
 (
__mode
, 
gaicb
 *
__li¡
[
__»¡riù_¬r
],

695 
__’t
, 
sigev’t
 *
__»¡riù
 
__sig
);

705 
	`gai_su¥’d
 (
__cÚ¡
 
gaicb
 *__cÚ¡ 
__li¡
[], 
__’t
,

706 
__cÚ¡
 
time¥ec
 *
__timeout
);

709 
	$gai_”rÜ
 (
gaicb
 *
__»q
è
__THROW
;

712 
	$gai_ÿnûl
 (
gaicb
 *
__gaicbp
è
__THROW
;

715 
__END_DECLS


	@/usr/include/netinet/in.h

20 #iâdef 
_NETINET_IN_H


21 
	#_NETINET_IN_H
 1

	)

23 
	~<ã©u»s.h
>

24 
	~<¡dšt.h
>

25 
	~<sys/sock‘.h
>

26 
	~<b™s/ty³s.h
>

29 
__BEGIN_DECLS


34 
	mIPPROTO_IP
 = 0,

35 
	#IPPROTO_IP
 
IPPROTO_IP


	)

36 
	mIPPROTO_HOPOPTS
 = 0,

37 
	#IPPROTO_HOPOPTS
 
IPPROTO_HOPOPTS


	)

38 
	mIPPROTO_ICMP
 = 1,

39 
	#IPPROTO_ICMP
 
IPPROTO_ICMP


	)

40 
	mIPPROTO_IGMP
 = 2,

41 
	#IPPROTO_IGMP
 
IPPROTO_IGMP


	)

42 
	mIPPROTO_IPIP
 = 4,

43 
	#IPPROTO_IPIP
 
IPPROTO_IPIP


	)

44 
	mIPPROTO_TCP
 = 6,

45 
	#IPPROTO_TCP
 
IPPROTO_TCP


	)

46 
	mIPPROTO_EGP
 = 8,

47 
	#IPPROTO_EGP
 
IPPROTO_EGP


	)

48 
	mIPPROTO_PUP
 = 12,

49 
	#IPPROTO_PUP
 
IPPROTO_PUP


	)

50 
	mIPPROTO_UDP
 = 17,

51 
	#IPPROTO_UDP
 
IPPROTO_UDP


	)

52 
	mIPPROTO_IDP
 = 22,

53 
	#IPPROTO_IDP
 
IPPROTO_IDP


	)

54 
	mIPPROTO_TP
 = 29,

55 
	#IPPROTO_TP
 
IPPROTO_TP


	)

56 
	mIPPROTO_DCCP
 = 33,

57 
	#IPPROTO_DCCP
 
IPPROTO_DCCP


	)

58 
	mIPPROTO_IPV6
 = 41,

59 
	#IPPROTO_IPV6
 
IPPROTO_IPV6


	)

60 
	mIPPROTO_ROUTING
 = 43,

61 
	#IPPROTO_ROUTING
 
IPPROTO_ROUTING


	)

62 
	mIPPROTO_FRAGMENT
 = 44,

63 
	#IPPROTO_FRAGMENT
 
IPPROTO_FRAGMENT


	)

64 
	mIPPROTO_RSVP
 = 46,

65 
	#IPPROTO_RSVP
 
IPPROTO_RSVP


	)

66 
	mIPPROTO_GRE
 = 47,

67 
	#IPPROTO_GRE
 
IPPROTO_GRE


	)

68 
	mIPPROTO_ESP
 = 50,

69 
	#IPPROTO_ESP
 
IPPROTO_ESP


	)

70 
	mIPPROTO_AH
 = 51,

71 
	#IPPROTO_AH
 
IPPROTO_AH


	)

72 
	mIPPROTO_ICMPV6
 = 58,

73 
	#IPPROTO_ICMPV6
 
IPPROTO_ICMPV6


	)

74 
	mIPPROTO_NONE
 = 59,

75 
	#IPPROTO_NONE
 
IPPROTO_NONE


	)

76 
	mIPPROTO_DSTOPTS
 = 60,

77 
	#IPPROTO_DSTOPTS
 
IPPROTO_DSTOPTS


	)

78 
	mIPPROTO_MTP
 = 92,

79 
	#IPPROTO_MTP
 
IPPROTO_MTP


	)

80 
	mIPPROTO_ENCAP
 = 98,

81 
	#IPPROTO_ENCAP
 
IPPROTO_ENCAP


	)

82 
	mIPPROTO_PIM
 = 103,

83 
	#IPPROTO_PIM
 
IPPROTO_PIM


	)

84 
	mIPPROTO_COMP
 = 108,

85 
	#IPPROTO_COMP
 
IPPROTO_COMP


	)

86 
	mIPPROTO_SCTP
 = 132,

87 
	#IPPROTO_SCTP
 
IPPROTO_SCTP


	)

88 
	mIPPROTO_UDPLITE
 = 136,

89 
	#IPPROTO_UDPLITE
 
IPPROTO_UDPLITE


	)

90 
	mIPPROTO_RAW
 = 255,

91 
	#IPPROTO_RAW
 
IPPROTO_RAW


	)

92 
	mIPPROTO_MAX


97 
ušt16_t
 
	tš_pÜt_t
;

102 
	mIPPORT_ECHO
 = 7,

103 
	mIPPORT_DISCARD
 = 9,

104 
	mIPPORT_SYSTAT
 = 11,

105 
	mIPPORT_DAYTIME
 = 13,

106 
	mIPPORT_NETSTAT
 = 15,

107 
	mIPPORT_FTP
 = 21,

108 
	mIPPORT_TELNET
 = 23,

109 
	mIPPORT_SMTP
 = 25,

110 
	mIPPORT_TIMESERVER
 = 37,

111 
	mIPPORT_NAMESERVER
 = 42,

112 
	mIPPORT_WHOIS
 = 43,

113 
	mIPPORT_MTP
 = 57,

115 
	mIPPORT_TFTP
 = 69,

116 
	mIPPORT_RJE
 = 77,

117 
	mIPPORT_FINGER
 = 79,

118 
	mIPPORT_TTYLINK
 = 87,

119 
	mIPPORT_SUPDUP
 = 95,

122 
	mIPPORT_EXECSERVER
 = 512,

123 
	mIPPORT_LOGINSERVER
 = 513,

124 
	mIPPORT_CMDSERVER
 = 514,

125 
	mIPPORT_EFSSERVER
 = 520,

128 
	mIPPORT_BIFFUDP
 = 512,

129 
	mIPPORT_WHOSERVER
 = 513,

130 
	mIPPORT_ROUTESERVER
 = 520,

133 
	mIPPORT_RESERVED
 = 1024,

136 
	mIPPORT_USERRESERVED
 = 5000

141 
ušt32_t
 
	tš_addr_t
;

142 
	sš_addr


144 
š_addr_t
 
	ms_addr
;

153 
	#IN_CLASSA
(
a
è((((
š_addr_t
)×)è& 0x80000000è=ğ0)

	)

154 
	#IN_CLASSA_NET
 0xff000000

	)

155 
	#IN_CLASSA_NSHIFT
 24

	)

156 
	#IN_CLASSA_HOST
 (0xfffffffà& ~
IN_CLASSA_NET
)

	)

157 
	#IN_CLASSA_MAX
 128

	)

159 
	#IN_CLASSB
(
a
è((((
š_addr_t
)×)è& 0xc0000000è=ğ0x80000000)

	)

160 
	#IN_CLASSB_NET
 0xffff0000

	)

161 
	#IN_CLASSB_NSHIFT
 16

	)

162 
	#IN_CLASSB_HOST
 (0xfffffffà& ~
IN_CLASSB_NET
)

	)

163 
	#IN_CLASSB_MAX
 65536

	)

165 
	#IN_CLASSC
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xc0000000)

	)

166 
	#IN_CLASSC_NET
 0xffffff00

	)

167 
	#IN_CLASSC_NSHIFT
 8

	)

168 
	#IN_CLASSC_HOST
 (0xfffffffà& ~
IN_CLASSC_NET
)

	)

170 
	#IN_CLASSD
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xe0000000)

	)

171 
	#IN_MULTICAST
(
a
è
	`IN_CLASSD
×)

	)

173 
	#IN_EXPERIMENTAL
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xe0000000)

	)

174 
	#IN_BADCLASS
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xf0000000)

	)

177 
	#INADDR_ANY
 ((
š_addr_t
è0x00000000)

	)

179 
	#INADDR_BROADCAST
 ((
š_addr_t
è0xffffffff)

	)

181 
	#INADDR_NONE
 ((
š_addr_t
è0xffffffff)

	)

184 
	#IN_LOOPBACKNET
 127

	)

186 #iâdeà
INADDR_LOOPBACK


187 
	#INADDR_LOOPBACK
 ((
š_addr_t
è0x7f000001è

	)

191 
	#INADDR_UNSPEC_GROUP
 ((
š_addr_t
è0xe0000000è

	)

192 
	#INADDR_ALLHOSTS_GROUP
 ((
š_addr_t
è0xe0000001è

	)

193 
	#INADDR_ALLRTRS_GROUP
 ((
š_addr_t
è0xe0000002è

	)

194 
	#INADDR_MAX_LOCAL_GROUP
 ((
š_addr_t
è0xe00000ffè

	)

198 
	sš6_addr


202 
ušt8_t
 
	m__u6_addr8
[16];

203 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


204 
ušt16_t
 
	m__u6_addr16
[8];

205 
ušt32_t
 
	m__u6_addr32
[4];

207 } 
	m__š6_u
;

208 
	#s6_addr
 
__š6_u
.
__u6_addr8


	)

209 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


210 
	#s6_addr16
 
__š6_u
.
__u6_addr16


	)

211 
	#s6_addr32
 
__š6_u
.
__u6_addr32


	)

215 cÚ¡ 
š6_addr
 
š6addr_ªy
;

216 cÚ¡ 
š6_addr
 
š6addr_loİback
;

217 
	#IN6ADDR_ANY_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } } }

	)

218 
	#IN6ADDR_LOOPBACK_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 } } }

	)

220 
	#INET_ADDRSTRLEN
 16

	)

221 
	#INET6_ADDRSTRLEN
 46

	)

225 
	ssockaddr_š


227 
__SOCKADDR_COMMON
 (
sš_
);

228 
š_pÜt_t
 
	msš_pÜt
;

229 
š_addr
 
	msš_addr
;

232 
	msš_z”o
[ (
sockaddr
) -

233 
__SOCKADDR_COMMON_SIZE
 -

234  (
š_pÜt_t
) -

235  (
š_addr
)];

239 
	ssockaddr_š6


241 
__SOCKADDR_COMMON
 (
sš6_
);

242 
š_pÜt_t
 
	msš6_pÜt
;

243 
ušt32_t
 
	msš6_æowšfo
;

244 
š6_addr
 
	msš6_addr
;

245 
ušt32_t
 
	msš6_scİe_id
;

249 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


251 
	s_m»q


254 
š_addr
 
	mimr_muÉŸddr
;

257 
š_addr
 
	mimr_š‹rçû
;

260 
	s_m»q_sourû


263 
š_addr
 
	mimr_muÉŸddr
;

266 
š_addr
 
	mimr_š‹rçû
;

269 
š_addr
 
	mimr_sourûaddr
;

275 
	sv6_m»q


278 
š6_addr
 
	mv6mr_muÉŸddr
;

281 
	mv6mr_š‹rçû
;

285 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


287 
	sgroup_»q


290 
ušt32_t
 
	mgr_š‹rçû
;

293 
sockaddr_¡Üage
 
	mgr_group
;

296 
	sgroup_sourû_»q


299 
ušt32_t
 
	mg¤_š‹rçû
;

302 
sockaddr_¡Üage
 
	mg¤_group
;

305 
sockaddr_¡Üage
 
	mg¤_sourû
;

310 
	s_msf‹r


313 
š_addr
 
	mimsf_muÉŸddr
;

316 
š_addr
 
	mimsf_š‹rçû
;

319 
ušt32_t
 
	mimsf_fmode
;

322 
ušt32_t
 
	mimsf_num¤c
;

324 
š_addr
 
	mimsf_¦i¡
[1];

327 
	#IP_MSFILTER_SIZE
(
num¤c
è( (
_msf‹r
) \

328 -  (
š_addr
) \

329 + (
num¤c
è*  (
š_addr
))

	)

331 
	sgroup_f‹r


334 
ušt32_t
 
	mgf_š‹rçû
;

337 
sockaddr_¡Üage
 
	mgf_group
;

340 
ušt32_t
 
	mgf_fmode
;

343 
ušt32_t
 
	mgf_num¤c
;

345 
sockaddr_¡Üage
 
	mgf_¦i¡
[1];

348 
	#GROUP_FILTER_SIZE
(
num¤c
è( (
group_f‹r
) \

349 -  (
sockaddr_¡Üage
) \

350 + ((
num¤c
) \

351 *  (
sockaddr_¡Üage
)))

	)

356 
	~<b™s/š.h
>

365 
ušt32_t
 
	$Áohl
 (
ušt32_t
 
__ÃÚg
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

366 
ušt16_t
 
	$Áohs
 (
ušt16_t
 
__ÃtshÜt
)

367 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

368 
ušt32_t
 
	$htÚl
 (
ušt32_t
 
__ho¡lÚg
)

369 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

370 
ušt16_t
 
	$htÚs
 (
ušt16_t
 
__ho¡shÜt
)

371 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

373 
	~<’dŸn.h
>

376 
	~<b™s/by‹sw­.h
>

378 #ifdeà
__OPTIMIZE__


382 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


385 
	#Áohl
(
x
è(x)

	)

386 
	#Áohs
(
x
è(x)

	)

387 
	#htÚl
(
x
è(x)

	)

388 
	#htÚs
(
x
è(x)

	)

390 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


391 
	#Áohl
(
x
è
	`__bsw­_32
 (x)

	)

392 
	#Áohs
(
x
è
	`__bsw­_16
 (x)

	)

393 
	#htÚl
(
x
è
	`__bsw­_32
 (x)

	)

394 
	#htÚs
(
x
è
	`__bsw­_16
 (x)

	)

399 #ifdeà
__GNUC__


400 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

401 (
__ex‹nsiÚ__
 \

402 ({ 
__cÚ¡
 
š6_addr
 *
__a
 = (__cÚ¡ š6_add¸*è(
a
); \

403 
__a
->
s6_addr32
[0] == 0 \

404 && 
__a
->
s6_addr32
[1] == 0 \

405 && 
__a
->
s6_addr32
[2] == 0 \

406 && 
__a
->
s6_addr32
[3] =ğ0; 
	}
}))

	)

408 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

409 (
__ex‹nsiÚ__
 \

410 ({ 
__cÚ¡
 
š6_addr
 *
__a
 = (__cÚ¡ š6_add¸*è(
a
); \

411 
__a
->
s6_addr32
[0] == 0 \

412 && 
__a
->
s6_addr32
[1] == 0 \

413 && 
__a
->
s6_addr32
[2] == 0 \

414 && 
__a
->
s6_addr32
[3] =ğ
	`htÚl
 (1); }))

	)

416 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

417 (
__ex‹nsiÚ__
 \

418 ({ 
__cÚ¡
 
š6_addr
 *
__a
 = (__cÚ¡ š6_add¸*è(
a
); \

419 (
__a
->
s6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ğhtÚÈ(0xã800000); }))

	)

421 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

422 (
__ex‹nsiÚ__
 \

423 ({ 
__cÚ¡
 
š6_addr
 *
__a
 = (__cÚ¡ š6_add¸*è(
a
); \

424 (
__a
->
s6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ğhtÚÈ(0xãc00000); }))

	)

426 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

427 (
__ex‹nsiÚ__
 \

428 ({ 
__cÚ¡
 
š6_addr
 *
__a
 = (__cÚ¡ š6_add¸*è(
a
); \

429 
__a
->
s6_addr32
[0] == 0 \

430 && 
__a
->
s6_addr32
[1] == 0 \

431 && 
__a
->
s6_addr32
[2] =ğ
	`htÚl
 (0xffff); }))

	)

433 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

434 (
__ex‹nsiÚ__
 \

435 ({ 
__cÚ¡
 
š6_addr
 *
__a
 = (__cÚ¡ š6_add¸*è(
a
); \

436 
__a
->
s6_addr32
[0] == 0 \

437 && 
__a
->
s6_addr32
[1] == 0 \

438 && 
__a
->
s6_addr32
[2] == 0 \

439 && 
	`Áohl
 (
__a
->
s6_addr32
[3]è> 1; }))

	)

441 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

442 (
__ex‹nsiÚ__
 \

443 ({ 
__cÚ¡
 
š6_addr
 *
__a
 = (__cÚ¡ š6_add¸*è(
a
); \

444 
__cÚ¡
 
š6_addr
 *
__b
 = (__cÚ¡ š6_add¸*è(
b
); \

445 
__a
->
s6_addr32
[0] =ğ
__b
->s6_addr32[0] \

446 && 
__a
->
s6_addr32
[1] =ğ
__b
->s6_addr32[1] \

447 && 
__a
->
s6_addr32
[2] =ğ
__b
->s6_addr32[2] \

448 && 
__a
->
s6_addr32
[3] =ğ
__b
->s6_addr32[3]; }))

	)

450 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

451 (((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] == 0 \

452 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[1] == 0 \

453 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[2] == 0 \

454 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[3] =ğ0)

	)

456 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

457 (((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] == 0 \

458 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[1] == 0 \

459 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[2] == 0 \

460 && ((
__cÚ¡
 
ušt32_t
 *è(
a
))[3] =ğ
	`htÚl
 (1))

	)

462 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

463 ((((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

464 =ğ
	`htÚl
 (0xã800000))

	)

466 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

467 ((((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

468 =ğ
	`htÚl
 (0xãc00000))

	)

470 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

471 ((((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] == 0) \

472 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[1] == 0) \

473 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[2] =ğ
	`htÚl
 (0xffff)))

	)

475 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

476 ((((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] == 0) \

477 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[1] == 0) \

478 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[2] == 0) \

479 && (
	`Áohl
 (((
__cÚ¡
 
ušt32_t
 *è(
a
))[3]è> 1))

	)

481 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

482 ((((
__cÚ¡
 
ušt32_t
 *è(
a
))[0] =ğ((__cÚ¡ ušt32_ˆ*è(
b
))[0]) \

483 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[1] =ğ((__cÚ¡ ušt32_ˆ*è(
b
))[1]) \

484 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[2] =ğ((__cÚ¡ ušt32_ˆ*è(
b
))[2]) \

485 && (((
__cÚ¡
 
ušt32_t
 *è(
a
))[3] =ğ((__cÚ¡ ušt32_ˆ*è(
b
))[3]))

	)

488 
	#IN6_IS_ADDR_MULTICAST
(
a
è(((
__cÚ¡
 
ušt8_t
 *è×))[0] =ğ0xff)

	)

490 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


492 
	$bšd»svpÜt
 (
__sockfd
, 
sockaddr_š
 *
__sock_š
è
__THROW
;

495 
	$bšd»svpÜt6
 (
__sockfd
, 
sockaddr_š6
 *
__sock_š
)

496 
__THROW
;

500 
	#IN6_IS_ADDR_MC_NODELOCAL
(
a
) \

501 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

502 && ((((
__cÚ¡
 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x1))

	)

504 
	#IN6_IS_ADDR_MC_LINKLOCAL
(
a
) \

505 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

506 && ((((
__cÚ¡
 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x2))

	)

508 
	#IN6_IS_ADDR_MC_SITELOCAL
(
a
) \

509 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

510 && ((((
__cÚ¡
 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x5))

	)

512 
	#IN6_IS_ADDR_MC_ORGLOCAL
(
a
) \

513 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

514 && ((((
__cÚ¡
 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x8))

	)

516 
	#IN6_IS_ADDR_MC_GLOBAL
(
a
) \

517 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

518 && ((((
__cÚ¡
 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0xe))

	)

521 #ifdeà
__USE_GNU


523 
	sš6_pktšfo


525 
š6_addr
 
i6_addr
;

526 
i6_ifšdex
;

530 
	s6_mtušfo


532 
sockaddr_š6
 
6m_addr
;

533 
ušt32_t
 
6m_mtu
;

538 
	$š‘6_İtiÚ_¥aû
 (
__nby‹s
)

539 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

540 
	$š‘6_İtiÚ_š™
 (*
__bp
, 
cmsghdr
 **
__cmsgp
,

541 
__ty³
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

542 
	$š‘6_İtiÚ_­³nd
 (
cmsghdr
 *
__cmsg
,

543 
__cÚ¡
 
ušt8_t
 *
__ty³p
, 
__muÉx
,

544 
__¶usy
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

545 
ušt8_t
 *
	$š‘6_İtiÚ_®loc
 (
cmsghdr
 *
__cmsg
, 
__d©®’
,

546 
__muÉx
, 
__¶usy
)

547 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

548 
	$š‘6_İtiÚ_Ãxt
 (
__cÚ¡
 
cmsghdr
 *
__cmsg
,

549 
ušt8_t
 **
__Œp
)

550 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

551 
	$š‘6_İtiÚ_fšd
 (
__cÚ¡
 
cmsghdr
 *
__cmsg
,

552 
ušt8_t
 **
__Œp
, 
__ty³
)

553 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

557 
	$š‘6_İt_š™
 (*
__extbuf
, 
sockËn_t
 
__ex’
è
__THROW
;

558 
	$š‘6_İt_­³nd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

559 
ušt8_t
 
__ty³
, 
sockËn_t
 
__Ën
, ušt8_ˆ
__®ign
,

560 **
__d©abuå
è
__THROW
;

561 
	$š‘6_İt_fšish
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
)

562 
__THROW
;

563 
	$š‘6_İt_£t_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

564 
sockËn_t
 
__v®Ën
è
__THROW
;

565 
	$š‘6_İt_Ãxt
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

566 
ušt8_t
 *
__ty³p
, 
sockËn_t
 *
__ËÅ
,

567 **
__d©abuå
è
__THROW
;

568 
	$š‘6_İt_fšd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

569 
ušt8_t
 
__ty³
, 
sockËn_t
 *
__ËÅ
,

570 **
__d©abuå
è
__THROW
;

571 
	$š‘6_İt_g‘_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

572 
sockËn_t
 
__v®Ën
è
__THROW
;

576 
sockËn_t
 
	$š‘6_¹h_¥aû
 (
__ty³
, 
__£gm’ts
è
__THROW
;

577 *
	$š‘6_¹h_š™
 (*
__bp
, 
sockËn_t
 
__bp_Ën
, 
__ty³
,

578 
__£gm’ts
è
__THROW
;

579 
	$š‘6_¹h_add
 (*
__bp
, 
__cÚ¡
 
š6_addr
 *
__addr
è
__THROW
;

580 
	$š‘6_¹h_»v”£
 (
__cÚ¡
 *
__š
, *
__out
è
__THROW
;

581 
	$š‘6_¹h_£gm’ts
 (
__cÚ¡
 *
__bp
è
__THROW
;

582 
š6_addr
 *
	$š‘6_¹h_g‘addr
 (
__cÚ¡
 *
__bp
, 
__šdex
)

583 
__THROW
;

589 
	$g‘v4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

590 
š_addr
 
__group
, 
ušt32_t
 *
__fmode
,

591 
ušt32_t
 *
__num¤c
, 
š_addr
 *
__¦i¡
)

592 
__THROW
;

595 
	$£tv4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

596 
š_addr
 
__group
, 
ušt32_t
 
__fmode
,

597 
ušt32_t
 
__num¤c
,

598 
__cÚ¡
 
š_addr
 *
__¦i¡
)

599 
__THROW
;

603 
	$g‘sourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

604 
__cÚ¡
 
sockaddr
 *
__group
,

605 
sockËn_t
 
__grou¶’
, 
ušt32_t
 *
__fmode
,

606 
ušt32_t
 *
__num¤c
,

607 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

610 
	$£tsourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

611 
__cÚ¡
 
sockaddr
 *
__group
,

612 
sockËn_t
 
__grou¶’
, 
ušt32_t
 
__fmode
,

613 
ušt32_t
 
__num¤c
,

614 
__cÚ¡
 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

617 
__END_DECLS


	@/usr/include/pthread.h

20 #iâdeà
_PTHREAD_H


21 
	#_PTHREAD_H
 1

	)

23 
	~<ã©u»s.h
>

24 
	~<’dŸn.h
>

25 
	~<sched.h
>

26 
	~<time.h
>

28 
	~<b™s/±h»adty³s.h
>

29 
	~<b™s/£tjmp.h
>

30 
	~<b™s/wÜdsize.h
>

36 
	mPTHREAD_CREATE_JOINABLE
,

37 
	#PTHREAD_CREATE_JOINABLE
 
PTHREAD_CREATE_JOINABLE


	)

38 
	mPTHREAD_CREATE_DETACHED


39 
	#PTHREAD_CREATE_DETACHED
 
PTHREAD_CREATE_DETACHED


	)

46 
	mPTHREAD_MUTEX_TIMED_NP
,

47 
	mPTHREAD_MUTEX_RECURSIVE_NP
,

48 
	mPTHREAD_MUTEX_ERRORCHECK_NP
,

49 
	mPTHREAD_MUTEX_ADAPTIVE_NP


50 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


52 
	mPTHREAD_MUTEX_NORMAL
 = 
PTHREAD_MUTEX_TIMED_NP
,

53 
	mPTHREAD_MUTEX_RECURSIVE
 = 
PTHREAD_MUTEX_RECURSIVE_NP
,

54 
	mPTHREAD_MUTEX_ERRORCHECK
 = 
PTHREAD_MUTEX_ERRORCHECK_NP
,

55 
	mPTHREAD_MUTEX_DEFAULT
 = 
PTHREAD_MUTEX_NORMAL


57 #ifdeà
__USE_GNU


59 , 
	mPTHREAD_MUTEX_FAST_NP
 = 
PTHREAD_MUTEX_TIMED_NP


64 #ifdeà
__USE_XOPEN2K


68 
	mPTHREAD_MUTEX_STALLED
,

69 
	mPTHREAD_MUTEX_STALLED_NP
 = 
PTHREAD_MUTEX_STALLED
,

70 
	mPTHREAD_MUTEX_ROBUST
,

71 
	mPTHREAD_MUTEX_ROBUST_NP
 = 
PTHREAD_MUTEX_ROBUST


76 #ifdeà
__USE_UNIX98


80 
	mPTHREAD_PRIO_NONE
,

81 
	mPTHREAD_PRIO_INHERIT
,

82 
	mPTHREAD_PRIO_PROTECT


88 #ià
__WORDSIZE
 == 64

89 
	#PTHREAD_MUTEX_INITIALIZER
 \

90 { { 0, 0, 0, 0, 0, 0, { 0, 0 } } }

	)

91 #ifdeà
__USE_GNU


92 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

93 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 0, 0 } } }

	)

94 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

95 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 0, 0 } } }

	)

96 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

97 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 0, 0 } } }

	)

100 
	#PTHREAD_MUTEX_INITIALIZER
 \

101 { { 0, 0, 0, 0, 0, { 0 } } }

	)

102 #ifdeà
__USE_GNU


103 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

104 { { 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 0 } } }

	)

105 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

106 { { 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 0 } } }

	)

107 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

108 { { 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 0 } } }

	)

114 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


117 
	mPTHREAD_RWLOCK_PREFER_READER_NP
,

118 
	mPTHREAD_RWLOCK_PREFER_WRITER_NP
,

119 
	mPTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,

120 
	mPTHREAD_RWLOCK_DEFAULT_NP
 = 
PTHREAD_RWLOCK_PREFER_READER_NP


124 
	#PTHREAD_RWLOCK_INITIALIZER
 \

125 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 } }

	)

126 #ifdeà
__USE_GNU


127 #ià
__WORDSIZE
 == 64

128 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

130 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
 } }

	)

132 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


133 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

134 { { 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
, \

135 0, 0, 0, 0 } }

	)

137 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

138 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,\

139 0 } }

	)

149 
	mPTHREAD_INHERIT_SCHED
,

150 
	#PTHREAD_INHERIT_SCHED
 
PTHREAD_INHERIT_SCHED


	)

151 
	mPTHREAD_EXPLICIT_SCHED


152 
	#PTHREAD_EXPLICIT_SCHED
 
PTHREAD_EXPLICIT_SCHED


	)

159 
	mPTHREAD_SCOPE_SYSTEM
,

160 
	#PTHREAD_SCOPE_SYSTEM
 
PTHREAD_SCOPE_SYSTEM


	)

161 
	mPTHREAD_SCOPE_PROCESS


162 
	#PTHREAD_SCOPE_PROCESS
 
PTHREAD_SCOPE_PROCESS


	)

169 
	mPTHREAD_PROCESS_PRIVATE
,

170 
	#PTHREAD_PROCESS_PRIVATE
 
PTHREAD_PROCESS_PRIVATE


	)

171 
	mPTHREAD_PROCESS_SHARED


172 
	#PTHREAD_PROCESS_SHARED
 
PTHREAD_PROCESS_SHARED


	)

178 
	#PTHREAD_COND_INITIALIZER
 { { 0, 0, 0, 0, 0, (*è0, 0, 0 } }

	)

182 
	s_±h»ad_ş—nup_bufãr


184 (*
	m__routše
) (*);

185 *
	m__¬g
;

186 
	m__ÿnûÉy³
;

187 
_±h»ad_ş—nup_bufãr
 *
	m__´ev
;

193 
	mPTHREAD_CANCEL_ENABLE
,

194 
	#PTHREAD_CANCEL_ENABLE
 
PTHREAD_CANCEL_ENABLE


	)

195 
	mPTHREAD_CANCEL_DISABLE


196 
	#PTHREAD_CANCEL_DISABLE
 
PTHREAD_CANCEL_DISABLE


	)

200 
	mPTHREAD_CANCEL_DEFERRED
,

201 
	#PTHREAD_CANCEL_DEFERRED
 
PTHREAD_CANCEL_DEFERRED


	)

202 
	mPTHREAD_CANCEL_ASYNCHRONOUS


203 
	#PTHREAD_CANCEL_ASYNCHRONOUS
 
PTHREAD_CANCEL_ASYNCHRONOUS


	)

205 
	#PTHREAD_CANCELED
 ((*è-1)

	)

209 
	#PTHREAD_ONCE_INIT
 0

	)

212 #ifdeà
__USE_XOPEN2K


216 
	#PTHREAD_BARRIER_SERIAL_THREAD
 -1

	)

220 
__BEGIN_DECLS


225 
±h»ad_ü—‹
 (
±h»ad_t
 *
__»¡riù
 
__Ãwth»ad
,

226 
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

227 *(*
__¡¬t_routše
) (*),

228 *
__»¡riù
 
__¬g
è
__THROWNL
 
__nÚnuÎ
 ((1, 3));

234 
	$±h»ad_ex™
 (*
__»tv®
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

242 
	`±h»ad_još
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
);

244 #ifdeà
__USE_GNU


247 
	$±h»ad_Œyjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
è
__THROW
;

255 
	`±h»ad_timedjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
,

256 
__cÚ¡
 
time¥ec
 *
__ab¡ime
);

263 
	$±h»ad_d‘ach
 (
±h»ad_t
 
__th
è
__THROW
;

267 
±h»ad_t
 
	$±h»ad_£lf
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

270 
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
è
__THROW
;

278 
	$±h»ad_©Œ_š™
 (
±h»ad_©Œ_t
 *
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

281 
	$±h»ad_©Œ_de¡roy
 (
±h»ad_©Œ_t
 *
__©Œ
)

282 
__THROW
 
	`__nÚnuÎ
 ((1));

285 
	$±h»ad_©Œ_g‘d‘ach¡©e
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__©Œ
,

286 *
__d‘ach¡©e
)

287 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

290 
	$±h»ad_©Œ_£td‘ach¡©e
 (
±h»ad_©Œ_t
 *
__©Œ
,

291 
__d‘ach¡©e
)

292 
__THROW
 
	`__nÚnuÎ
 ((1));

296 
	$±h»ad_©Œ_g‘gu¬dsize
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__©Œ
,

297 
size_t
 *
__gu¬dsize
)

298 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

301 
	$±h»ad_©Œ_£tgu¬dsize
 (
±h»ad_©Œ_t
 *
__©Œ
,

302 
size_t
 
__gu¬dsize
)

303 
__THROW
 
	`__nÚnuÎ
 ((1));

307 
	$±h»ad_©Œ_g‘sched·¿m
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù


308 
__©Œ
,

309 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

310 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

313 
	$±h»ad_©Œ_£tsched·¿m
 (
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

314 
__cÚ¡
 
sched_·¿m
 *
__»¡riù


315 
__·¿m
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

318 
	$±h»ad_©Œ_g‘schedpŞicy
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù


319 
__©Œ
, *
__»¡riù
 
__pŞicy
)

320 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

323 
	$±h»ad_©Œ_£tschedpŞicy
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__pŞicy
)

324 
__THROW
 
	`__nÚnuÎ
 ((1));

327 
	$±h»ad_©Œ_g‘šh”™sched
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù


328 
__©Œ
, *
__»¡riù
 
__šh”™
)

329 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

332 
	$±h»ad_©Œ_£tšh”™sched
 (
±h»ad_©Œ_t
 *
__©Œ
,

333 
__šh”™
)

334 
__THROW
 
	`__nÚnuÎ
 ((1));

338 
	$±h»ad_©Œ_g‘scİe
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

339 *
__»¡riù
 
__scİe
)

340 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

343 
	$±h»ad_©Œ_£tscİe
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__scİe
)

344 
__THROW
 
	`__nÚnuÎ
 ((1));

347 
	$±h»ad_©Œ_g‘¡ackaddr
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù


348 
__©Œ
, **
__»¡riù
 
__¡ackaddr
)

349 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__©Œibu‹_d•»ÿ‹d__
;

355 
	$±h»ad_©Œ_£t¡ackaddr
 (
±h»ad_©Œ_t
 *
__©Œ
,

356 *
__¡ackaddr
)

357 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
;

360 
	$±h»ad_©Œ_g‘¡acksize
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù


361 
__©Œ
, 
size_t
 *
__»¡riù
 
__¡acksize
)

362 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

367 
	$±h»ad_©Œ_£t¡acksize
 (
±h»ad_©Œ_t
 *
__©Œ
,

368 
size_t
 
__¡acksize
)

369 
__THROW
 
	`__nÚnuÎ
 ((1));

371 #ifdeà
__USE_XOPEN2K


373 
	$±h»ad_©Œ_g‘¡ack
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

374 **
__»¡riù
 
__¡ackaddr
,

375 
size_t
 *
__»¡riù
 
__¡acksize
)

376 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

381 
	$±h»ad_©Œ_£t¡ack
 (
±h»ad_©Œ_t
 *
__©Œ
, *
__¡ackaddr
,

382 
size_t
 
__¡acksize
è
__THROW
 
	`__nÚnuÎ
 ((1));

385 #ifdeà
__USE_GNU


388 
	$±h»ad_©Œ_£ffš™y_Å
 (
±h»ad_©Œ_t
 *
__©Œ
,

389 
size_t
 
__ıu£tsize
,

390 
__cÚ¡
 
ıu_£t_t
 *
__ıu£t
)

391 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

395 
	$±h»ad_©Œ_g‘affš™y_Å
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__©Œ
,

396 
size_t
 
__ıu£tsize
,

397 
ıu_£t_t
 *
__ıu£t
)

398 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

404 
	$±h»ad_g‘©Œ_Å
 (
±h»ad_t
 
__th
, 
±h»ad_©Œ_t
 *
__©Œ
)

405 
__THROW
 
	`__nÚnuÎ
 ((2));

413 
	$±h»ad_£tsched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
, 
__pŞicy
,

414 
__cÚ¡
 
sched_·¿m
 *
__·¿m
)

415 
__THROW
 
	`__nÚnuÎ
 ((3));

418 
	$±h»ad_g‘sched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
,

419 *
__»¡riù
 
__pŞicy
,

420 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

421 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

424 
	$±h»ad_£tsched´io
 (
±h»ad_t
 
__rg‘_th»ad
, 
__´io
)

425 
__THROW
;

428 #ifdeà
__USE_GNU


430 
	$±h»ad_g‘Çme_Å
 (
±h»ad_t
 
__rg‘_th»ad
, *
__buf
,

431 
size_t
 
__buæ’
)

432 
__THROW
 
	`__nÚnuÎ
 ((2));

435 
	$±h»ad_£Šame_Å
 (
±h»ad_t
 
__rg‘_th»ad
, 
__cÚ¡
 *
__Çme
)

436 
__THROW
 
	`__nÚnuÎ
 ((2));

440 #ifdeà
__USE_UNIX98


442 
	$±h»ad_g‘cÚcu¼’cy
 (è
__THROW
;

445 
	$±h»ad_£tcÚcu¼’cy
 (
__Ëv–
è
__THROW
;

448 #ifdeà
__USE_GNU


453 
	$±h»ad_y›ld
 (è
__THROW
;

458 
	$±h»ad_£ffš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

459 
__cÚ¡
 
ıu_£t_t
 *
__ıu£t
)

460 
__THROW
 
	`__nÚnuÎ
 ((3));

463 
	$±h»ad_g‘affš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

464 
ıu_£t_t
 *
__ıu£t
)

465 
__THROW
 
	`__nÚnuÎ
 ((3));

478 
	`±h»ad_Úû
 (
±h»ad_Úû_t
 *
__Úû_cÚŒŞ
,

479 (*
__š™_routše
è()è
	`__nÚnuÎ
 ((1, 2));

490 
	`±h»ad_£tÿnûl¡©e
 (
__¡©e
, *
__Şd¡©e
);

494 
	`±h»ad_£tÿnûÉy³
 (
__ty³
, *
__Şdty³
);

497 
	`±h»ad_ÿnûl
 (
±h»ad_t
 
__th
);

502 
	`±h»ad_‹¡ÿnûl
 ();

511 
__jmp_buf
 
__ÿnûl_jmp_buf
;

512 
__mask_was_§ved
;

513 } 
__ÿnûl_jmp_buf
[1];

514 *
__·d
[4];

515 } 
	t__±h»ad_unwšd_buf_t
 
	t__©Œibu‹__
 ((
	t__®igÃd__
));

518 #iâdeà
__ş—nup_fù_©Œibu‹


519 
	#__ş—nup_fù_©Œibu‹


	)

524 
	s__±h»ad_ş—nup_äame


526 (*
__ÿnûl_routše
) (*);

527 *
__ÿnûl_¬g
;

528 
__do_™
;

529 
__ÿnûl_ty³
;

532 #ià
defšed
 
__GNUC__
 && defšed 
__EXCEPTIONS


533 #ifdeà
__ılu¥lus


535 şas 
	c__±h»ad_ş—nup_şass


537 (*
__ÿnûl_routše
) (*);

538 *
__ÿnûl_¬g
;

539 
__do_™
;

540 
__ÿnûl_ty³
;

542 
public
:

543 
	`__±h»ad_ş—nup_şass
 ((*
__fù
è(*), *
__¬g
)

544 : 
	`__ÿnûl_routše
 (
__fù
), 
	`__ÿnûl_¬g
 (
__¬g
), 
	$__do_™
 (1) { }

545 ~
	$__±h»ad_ş—nup_şass
 (è{ ià(
__do_™
è
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); 
	}
}

546 
	$__£tdo™
 (
__Ãwv®
è{ 
__do_™
 = __Ãwv®; 
	}
}

547 
	$__deãr
 (è{ 
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
,

548 &
__ÿnûl_ty³
); 
	}
}

549 
	$__»¡Üe
 (ècÚ¡ { 
	`±h»ad_£tÿnûÉy³
 (
__ÿnûl_ty³
, 0); 
	}
}

559 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

561 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
)

	)

565 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

566 
__şäame
.
	`__£tdo™
 (
execu‹
); \

567 } 0)

	)

569 #ifdeà
__USE_GNU


573 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

575 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
); \

576 
__şäame
.
	`__deãr
 ()

	)

581 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

582 
__şäame
.
	`__»¡Üe
 (); \

583 
__şäame
.
	`__£tdo™
 (
execu‹
); \

584 } 0)

	)

591 
__ex‹º_šlše
 

592 
	$__±h»ad_ş—nup_routše
 (
__±h»ad_ş—nup_äame
 *
__äame
)

594 ià(
__äame
->
__do_™
)

595 
__äame
->
	`__ÿnûl_routše
 (__äame->
__ÿnûl_¬g
);

596 
	}
}

605 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

607 
__±h»ad_ş—nup_äame
 
__şäame
 \

608 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

609 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

610 .
__do_™
 = 1 };

	)

614 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

615 
__şäame
.
__do_™
 = (
execu‹
); \

616 } 0)

	)

618 #ifdeà
__USE_GNU


622 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

624 
__±h»ad_ş—nup_äame
 
__şäame
 \

625 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

626 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

627 .
__do_™
 = 1 }; \

628 (è
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
, \

629 &
__şäame
.
__ÿnûl_ty³
)

	)

634 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

635 (è
	`±h»ad_£tÿnûÉy³
 (
__şäame
.
__ÿnûl_ty³
, 
NULL
); \

636 
__şäame
.
__do_™
 = (
execu‹
); \

637 } 0)

	)

648 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

650 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

651 (*
__ÿnûl_routše
è(*èğ(
routše
); \

652 *
__ÿnûl_¬g
 = (
¬g
); \

653 
__nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

654 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

655 ià(
	`__butš_ex³ù
 (
__nÙ_fœ¡_ÿÎ
, 0)) \

657 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

658 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

662 
	`__±h»ad_»gi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

663 dØ{

	)

664 
__±h»ad_»gi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

665 
__ş—nup_fù_©Œibu‹
;

669 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

672 
	`__±h»ad_uÄegi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

673 ià(
execu‹
) \

674 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

675 } 0)

	)

676 
	$__±h»ad_uÄegi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

677 
__ş—nup_fù_©Œibu‹
;

679 #ifdeà
__USE_GNU


683 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

685 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

686 (*
__ÿnûl_routše
è(*èğ(
routše
); \

687 *
__ÿnûl_¬g
 = (
¬g
); \

688 
__nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

689 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

690 ià(
	`__butš_ex³ù
 (
__nÙ_fœ¡_ÿÎ
, 0)) \

692 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

693 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

697 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (&
__ÿnûl_buf
); \

698 dØ{

	)

699 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

700 
__ş—nup_fù_©Œibu‹
;

705 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

708 
	`__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (&
__ÿnûl_buf
); \

709 ià(
execu‹
) \

710 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

711 
	}
} 0)

	)

712 
	$__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

713 
__ş—nup_fù_©Œibu‹
;

717 
	$__±h»ad_unwšd_Ãxt
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

718 
__ş—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
))

719 #iâdeà
SHARED


720 
	`__©Œibu‹__
 ((
__w—k__
))

726 
__jmp_buf_g
;

727 
	$__sig£tjmp
 (
__jmp_buf_g
 *
__’v
, 
__§vemask
è
__THROW
;

733 
	$±h»ad_mu‹x_š™
 (
±h»ad_mu‹x_t
 *
__mu‹x
,

734 
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *
__mu‹x©Œ
)

735 
__THROW
 
	`__nÚnuÎ
 ((1));

738 
	$±h»ad_mu‹x_de¡roy
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

739 
__THROW
 
	`__nÚnuÎ
 ((1));

742 
	$±h»ad_mu‹x_Œylock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

743 
__THROWNL
 
	`__nÚnuÎ
 ((1));

746 
	$±h»ad_mu‹x_lock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

747 
__THROWNL
 
	`__nÚnuÎ
 ((1));

749 #ifdeà
__USE_XOPEN2K


751 
	$±h»ad_mu‹x_timedlock
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

752 
__cÚ¡
 
time¥ec
 *
__»¡riù


753 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

757 
	$±h»ad_mu‹x_uÆock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

758 
__THROWNL
 
	`__nÚnuÎ
 ((1));

762 
	$±h»ad_mu‹x_g‘´ioûšg
 (
__cÚ¡
 
±h»ad_mu‹x_t
 *

763 
__»¡riù
 
__mu‹x
,

764 *
__»¡riù
 
__´ioûšg
)

765 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

769 
	$±h»ad_mu‹x_£rioûšg
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

770 
__´ioûšg
,

771 *
__»¡riù
 
__Şd_ûšg
)

772 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

775 #ifdeà
__USE_XOPEN2K8


777 
	$±h»ad_mu‹x_cÚsi¡’t
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

778 
__THROW
 
	`__nÚnuÎ
 ((1));

779 #ifdeà
__USE_GNU


780 
	$±h»ad_mu‹x_cÚsi¡’t_Å
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

781 
__THROW
 
	`__nÚnuÎ
 ((1));

790 
	$±h»ad_mu‹x©Œ_š™
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

791 
__THROW
 
	`__nÚnuÎ
 ((1));

794 
	$±h»ad_mu‹x©Œ_de¡roy
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

795 
__THROW
 
	`__nÚnuÎ
 ((1));

798 
	$±h»ad_mu‹x©Œ_g‘psh¬ed
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *

799 
__»¡riù
 
__©Œ
,

800 *
__»¡riù
 
__psh¬ed
)

801 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

804 
	$±h»ad_mu‹x©Œ_£sh¬ed
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

805 
__psh¬ed
)

806 
__THROW
 
	`__nÚnuÎ
 ((1));

808 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


810 
	$±h»ad_mu‹x©Œ_g‘ty³
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *
__»¡riù


811 
__©Œ
, *
__»¡riù
 
__kšd
)

812 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

817 
	$±h»ad_mu‹x©Œ_£‰y³
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
, 
__kšd
)

818 
__THROW
 
	`__nÚnuÎ
 ((1));

822 
	$±h»ad_mu‹x©Œ_g‘´ÙocŞ
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *

823 
__»¡riù
 
__©Œ
,

824 *
__»¡riù
 
__´ÙocŞ
)

825 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

829 
	$±h»ad_mu‹x©Œ_£rÙocŞ
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

830 
__´ÙocŞ
)

831 
__THROW
 
	`__nÚnuÎ
 ((1));

834 
	$±h»ad_mu‹x©Œ_g‘´ioûšg
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *

835 
__»¡riù
 
__©Œ
,

836 *
__»¡riù
 
__´ioûšg
)

837 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

840 
	$±h»ad_mu‹x©Œ_£rioûšg
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

841 
__´ioûšg
)

842 
__THROW
 
	`__nÚnuÎ
 ((1));

844 #ifdeà
__USE_XOPEN2K


846 
	$±h»ad_mu‹x©Œ_g‘robu¡
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

847 *
__robu¡Ãss
)

848 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

849 #ifdeà
__USE_GNU


850 
	$±h»ad_mu‹x©Œ_g‘robu¡_Å
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

851 *
__robu¡Ãss
)

852 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

856 
	$±h»ad_mu‹x©Œ_£Œobu¡
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

857 
__robu¡Ãss
)

858 
__THROW
 
	`__nÚnuÎ
 ((1));

859 #ifdeà
__USE_GNU


860 
	$±h»ad_mu‹x©Œ_£Œobu¡_Å
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

861 
__robu¡Ãss
)

862 
__THROW
 
	`__nÚnuÎ
 ((1));

867 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


872 
	$±h»ad_rwlock_š™
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

873 
__cÚ¡
 
±h»ad_rwlock©Œ_t
 *
__»¡riù


874 
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

877 
	$±h»ad_rwlock_de¡roy
 (
±h»ad_rwlock_t
 *
__rwlock
)

878 
__THROW
 
	`__nÚnuÎ
 ((1));

881 
	$±h»ad_rwlock_rdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

882 
__THROWNL
 
	`__nÚnuÎ
 ((1));

885 
	$±h»ad_rwlock_Œyrdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

886 
__THROWNL
 
	`__nÚnuÎ
 ((1));

888 #ifdeà
__USE_XOPEN2K


890 
	$±h»ad_rwlock_timedrdlock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

891 
__cÚ¡
 
time¥ec
 *
__»¡riù


892 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

896 
	$±h»ad_rwlock_w¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

897 
__THROWNL
 
	`__nÚnuÎ
 ((1));

900 
	$±h»ad_rwlock_Œyw¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

901 
__THROWNL
 
	`__nÚnuÎ
 ((1));

903 #ifdeà
__USE_XOPEN2K


905 
	$±h»ad_rwlock_timedw¾ock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

906 
__cÚ¡
 
time¥ec
 *
__»¡riù


907 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

911 
	$±h»ad_rwlock_uÆock
 (
±h»ad_rwlock_t
 *
__rwlock
)

912 
__THROWNL
 
	`__nÚnuÎ
 ((1));

918 
	$±h»ad_rwlock©Œ_š™
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

919 
__THROW
 
	`__nÚnuÎ
 ((1));

922 
	$±h»ad_rwlock©Œ_de¡roy
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

923 
__THROW
 
	`__nÚnuÎ
 ((1));

926 
	$±h»ad_rwlock©Œ_g‘psh¬ed
 (
__cÚ¡
 
±h»ad_rwlock©Œ_t
 *

927 
__»¡riù
 
__©Œ
,

928 *
__»¡riù
 
__psh¬ed
)

929 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

932 
	$±h»ad_rwlock©Œ_£sh¬ed
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

933 
__psh¬ed
)

934 
__THROW
 
	`__nÚnuÎ
 ((1));

937 
	$±h»ad_rwlock©Œ_g‘kšd_Å
 (
__cÚ¡
 
±h»ad_rwlock©Œ_t
 *

938 
__»¡riù
 
__©Œ
,

939 *
__»¡riù
 
__´ef
)

940 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

943 
	$±h»ad_rwlock©Œ_£tkšd_Å
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

944 
__´ef
è
__THROW
 
	`__nÚnuÎ
 ((1));

952 
	$±h»ad_cÚd_š™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

953 
__cÚ¡
 
±h»ad_cÚd©Œ_t
 *
__»¡riù


954 
__cÚd_©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

957 
	$±h»ad_cÚd_de¡roy
 (
±h»ad_cÚd_t
 *
__cÚd
)

958 
__THROW
 
	`__nÚnuÎ
 ((1));

961 
	$±h»ad_cÚd_sigÇl
 (
±h»ad_cÚd_t
 *
__cÚd
)

962 
__THROWNL
 
	`__nÚnuÎ
 ((1));

965 
	$±h»ad_cÚd_brßdÿ¡
 (
±h»ad_cÚd_t
 *
__cÚd
)

966 
__THROWNL
 
	`__nÚnuÎ
 ((1));

973 
	$±h»ad_cÚd_wa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

974 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
)

975 
	`__nÚnuÎ
 ((1, 2));

984 
	$±h»ad_cÚd_timedwa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

985 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

986 
__cÚ¡
 
time¥ec
 *
__»¡riù


987 
__ab¡ime
è
	`__nÚnuÎ
 ((1, 2, 3));

992 
	$±h»ad_cÚd©Œ_š™
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

993 
__THROW
 
	`__nÚnuÎ
 ((1));

996 
	$±h»ad_cÚd©Œ_de¡roy
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

997 
__THROW
 
	`__nÚnuÎ
 ((1));

1000 
	$±h»ad_cÚd©Œ_g‘psh¬ed
 (
__cÚ¡
 
±h»ad_cÚd©Œ_t
 *

1001 
__»¡riù
 
__©Œ
,

1002 *
__»¡riù
 
__psh¬ed
)

1003 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1006 
	$±h»ad_cÚd©Œ_£sh¬ed
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1007 
__psh¬ed
è
__THROW
 
	`__nÚnuÎ
 ((1));

1009 #ifdeà
__USE_XOPEN2K


1011 
	$±h»ad_cÚd©Œ_g‘şock
 (
__cÚ¡
 
±h»ad_cÚd©Œ_t
 *

1012 
__»¡riù
 
__©Œ
,

1013 
__şockid_t
 *
__»¡riù
 
__şock_id
)

1014 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1017 
	$±h»ad_cÚd©Œ_£tşock
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1018 
__şockid_t
 
__şock_id
)

1019 
__THROW
 
	`__nÚnuÎ
 ((1));

1023 #ifdeà
__USE_XOPEN2K


1028 
	$±h»ad_¥š_š™
 (
±h»ad_¥šlock_t
 *
__lock
, 
__psh¬ed
)

1029 
__THROW
 
	`__nÚnuÎ
 ((1));

1032 
	$±h»ad_¥š_de¡roy
 (
±h»ad_¥šlock_t
 *
__lock
)

1033 
__THROW
 
	`__nÚnuÎ
 ((1));

1036 
	$±h»ad_¥š_lock
 (
±h»ad_¥šlock_t
 *
__lock
)

1037 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1040 
	$±h»ad_¥š_Œylock
 (
±h»ad_¥šlock_t
 *
__lock
)

1041 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1044 
	$±h»ad_¥š_uÆock
 (
±h»ad_¥šlock_t
 *
__lock
)

1045 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1052 
	$±h»ad_b¬r›r_š™
 (
±h»ad_b¬r›r_t
 *
__»¡riù
 
__b¬r›r
,

1053 
__cÚ¡
 
±h»ad_b¬r›¿‰r_t
 *
__»¡riù


1054 
__©Œ
, 
__couÁ
)

1055 
__THROW
 
	`__nÚnuÎ
 ((1));

1058 
	$±h»ad_b¬r›r_de¡roy
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1059 
__THROW
 
	`__nÚnuÎ
 ((1));

1062 
	$±h»ad_b¬r›r_wa™
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1063 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1067 
	$±h»ad_b¬r›¿‰r_š™
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1068 
__THROW
 
	`__nÚnuÎ
 ((1));

1071 
	$±h»ad_b¬r›¿‰r_de¡roy
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1072 
__THROW
 
	`__nÚnuÎ
 ((1));

1075 
	$±h»ad_b¬r›¿‰r_g‘psh¬ed
 (
__cÚ¡
 
±h»ad_b¬r›¿‰r_t
 *

1076 
__»¡riù
 
__©Œ
,

1077 *
__»¡riù
 
__psh¬ed
)

1078 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1081 
	$±h»ad_b¬r›¿‰r_£sh¬ed
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
,

1082 
__psh¬ed
)

1083 
__THROW
 
	`__nÚnuÎ
 ((1));

1095 
	`±h»ad_key_ü—‹
 (
±h»ad_key_t
 *
__key
,

1096 (*
__de¡r_funùiÚ
) (*))

1097 
__THROW
 
	`__nÚnuÎ
 ((1));

1100 
	$±h»ad_key_d–‘e
 (
±h»ad_key_t
 
__key
è
__THROW
;

1103 *
	$±h»ad_g‘¥ecific
 (
±h»ad_key_t
 
__key
è
__THROW
;

1106 
	$±h»ad_£t¥ecific
 (
±h»ad_key_t
 
__key
,

1107 
__cÚ¡
 *
__poš‹r
è
__THROW
 ;

1110 #ifdeà
__USE_XOPEN2K


1112 
	$±h»ad_g‘ıuşockid
 (
±h»ad_t
 
__th»ad_id
,

1113 
__şockid_t
 *
__şock_id
)

1114 
__THROW
 
	`__nÚnuÎ
 ((2));

1129 
	`±h»ad_©fÜk
 ((*
__´•¬e
) (),

1130 (*
__·»Á
) (),

1131 (*
__chd
è()è
__THROW
;

1134 #ifdeà
__USE_EXTERN_INLINES


1136 
__ex‹º_šlše
 

1137 
	`__NTH
 (
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
))

1139  
__th»ad1
 =ğ
__th»ad2
;

1140 
	}
}

1143 
	g__END_DECLS


	@/usr/include/pwd.h

23 #iâdef 
_PWD_H


24 
	#_PWD_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


30 
	~<b™s/ty³s.h
>

32 
	#__Ãed_size_t


	)

33 
	~<¡ddef.h
>

35 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


38 #iâdeà
__gid_t_defšed


39 
__gid_t
 
	tgid_t
;

40 
	#__gid_t_defšed


	)

43 #iâdeà
__uid_t_defšed


44 
__uid_t
 
	tuid_t
;

45 
	#__uid_t_defšed


	)

50 
	s·sswd


52 *
	mpw_Çme
;

53 *
	mpw_·sswd
;

54 
__uid_t
 
	mpw_uid
;

55 
__gid_t
 
	mpw_gid
;

56 *
	mpw_gecos
;

57 *
	mpw_dœ
;

58 *
	mpw_sh–l
;

62 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_GNU


63 
	#__Ãed_FILE


	)

64 
	~<¡dio.h
>

68 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


73 
£w’t
 ();

79 
’dpw’t
 ();

85 
·sswd
 *
g‘pw’t
 ();

88 #ifdef 
__USE_SVID


95 
·sswd
 *
fg‘pw’t
 (
FILE
 *
__¡»am
);

103 
puw’t
 (
__cÚ¡
 
·sswd
 *
__»¡riù
 
__p
,

104 
FILE
 *
__»¡riù
 
__f
);

111 
·sswd
 *
g‘pwuid
 (
__uid_t
 
__uid
);

117 
·sswd
 *
g‘pwÇm
 (
__cÚ¡
 *
__Çme
);

119 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


121 #ifdeà
__USE_MISC


124 
	#NSS_BUFLEN_PASSWD
 1024

	)

135 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


140 
g‘pw’t_r
 (
·sswd
 *
__»¡riù
 
__»suÉbuf
,

141 *
__»¡riù
 
__bufãr
, 
size_t
 
__buæ’
,

142 
·sswd
 **
__»¡riù
 
__»suÉ
);

145 
g‘pwuid_r
 (
__uid_t
 
__uid
,

146 
·sswd
 *
__»¡riù
 
__»suÉbuf
,

147 *
__»¡riù
 
__bufãr
, 
size_t
 
__buæ’
,

148 
·sswd
 **
__»¡riù
 
__»suÉ
);

150 
g‘pwÇm_r
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

151 
·sswd
 *
__»¡riù
 
__»suÉbuf
,

152 *
__»¡riù
 
__bufãr
, 
size_t
 
__buæ’
,

153 
·sswd
 **
__»¡riù
 
__»suÉ
);

156 #ifdef 
__USE_SVID


164 
fg‘pw’t_r
 (
FILE
 *
__»¡riù
 
__¡»am
,

165 
·sswd
 *
__»¡riù
 
__»suÉbuf
,

166 *
__»¡riù
 
__bufãr
, 
size_t
 
__buæ’
,

167 
·sswd
 **
__»¡riù
 
__»suÉ
);

172 #ifdeà
__USE_GNU


181 
g‘pw
 (
__uid_t
 
__uid
, *
__bufãr
);

184 
	g__END_DECLS


	@/usr/include/sched.h

21 #iâdef 
_SCHED_H


22 
	#_SCHED_H
 1

	)

24 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

29 
	#__Ãed_size_t


	)

30 
	~<¡ddef.h
>

32 
	#__Ãed_time_t


	)

33 
	#__Ãed_time¥ec


	)

34 
	~<time.h
>

36 #iâdeà
__pid_t_defšed


37 
__pid_t
 
	tpid_t
;

38 
	#__pid_t_defšed


	)

43 
	~<b™s/sched.h
>

45 
	#sched_´iÜ™y
 
__sched_´iÜ™y


	)

48 
__BEGIN_DECLS


51 
	$sched_£¬am
 (
__pid_t
 
__pid
, 
__cÚ¡
 
sched_·¿m
 *
__·¿m
)

52 
__THROW
;

55 
	$sched_g‘·¿m
 (
__pid_t
 
__pid
, 
sched_·¿m
 *
__·¿m
è
__THROW
;

58 
	$sched_£tscheduËr
 (
__pid_t
 
__pid
, 
__pŞicy
,

59 
__cÚ¡
 
sched_·¿m
 *
__·¿m
è
__THROW
;

62 
	$sched_g‘scheduËr
 (
__pid_t
 
__pid
è
__THROW
;

65 
	$sched_y›ld
 (è
__THROW
;

68 
	$sched_g‘_´iÜ™y_max
 (
__®gÜ™hm
è
__THROW
;

71 
	$sched_g‘_´iÜ™y_mš
 (
__®gÜ™hm
è
__THROW
;

74 
	$sched_¼_g‘_š‹rv®
 (
__pid_t
 
__pid
, 
time¥ec
 *
__t
è
__THROW
;

77 #ifdeà
__USE_GNU


79 
	#CPU_SETSIZE
 
__CPU_SETSIZE


	)

80 
	#CPU_SET
(
ıu
, 
ıu£
è
	`__CPU_SET_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

81 
	#CPU_CLR
(
ıu
, 
ıu£
è
	`__CPU_CLR_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

82 
	#CPU_ISSET
(
ıu
, 
ıu£
è
	`__CPU_ISSET_S
 (ıu,  (
ıu_£t_t
), \

83 
ıu£
)

	)

84 
	#CPU_ZERO
(
ıu£
è
	`__CPU_ZERO_S
 ( (
ıu_£t_t
), cpu£)

	)

85 
	#CPU_COUNT
(
ıu£
è
	`__CPU_COUNT_S
 ( (
ıu_£t_t
), cpu£)

	)

87 
	#CPU_SET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_SET_S
 (ıu, s‘size, cpu£)

	)

88 
	#CPU_CLR_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_CLR_S
 (ıu, s‘size, cpu£)

	)

89 
	#CPU_ISSET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_ISSET_S
 (cpu, setsize, \

90 
ıu£
)

	)

91 
	#CPU_ZERO_S
(
£tsize
, 
ıu£
è
	`__CPU_ZERO_S
 (£tsize, cpu£)

	)

92 
	#CPU_COUNT_S
(
£tsize
, 
ıu£
è
	`__CPU_COUNT_S
 (£tsize, cpu£)

	)

94 
	#CPU_EQUAL
(
ıu£1
, 
ıu£2
) \

95 
	`__CPU_EQUAL_S
 ( (
ıu_£t_t
), 
ıu£1
, 
ıu£2
)

	)

96 
	#CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

97 
	`__CPU_EQUAL_S
 (
£tsize
, 
ıu£1
, 
ıu£2
)

	)

99 
	#CPU_AND
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

100 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

101 
	#CPU_OR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

102 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

103 
	#CPU_XOR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

104 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

105 
	#CPU_AND_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

106 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

107 
	#CPU_OR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

108 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

109 
	#CPU_XOR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

110 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

112 
	#CPU_ALLOC_SIZE
(
couÁ
è
	`__CPU_ALLOC_SIZE
 (couÁ)

	)

113 
	#CPU_ALLOC
(
couÁ
è
	`__CPU_ALLOC
 (couÁ)

	)

114 
	#CPU_FREE
(
ıu£t
è
	`__CPU_FREE
 (ıu£t)

	)

118 
	$sched_£ffš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

119 
__cÚ¡
 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

122 
	$sched_g‘affš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

123 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

126 
__END_DECLS


	@/usr/include/semaphore.h

19 #iâdeà
_SEMAPHORE_H


20 
	#_SEMAPHORE_H
 1

	)

22 
	~<ã©u»s.h
>

23 
	~<sys/ty³s.h
>

24 #ifdeà
__USE_XOPEN2K


25 
	#__Ãed_time¥ec


	)

26 
	~<time.h
>

30 
	~<b™s/£m­hÜe.h
>

33 
__BEGIN_DECLS


37 
	$£m_š™
 (
£m_t
 *
__£m
, 
__psh¬ed
, 
__v®ue
)

38 
__THROW
;

40 
	$£m_de¡roy
 (
£m_t
 *
__£m
è
__THROW
;

43 
£m_t
 *
	$£m_İ’
 (
__cÚ¡
 *
__Çme
, 
__oæag
, ...è
__THROW
;

46 
	$£m_şo£
 (
£m_t
 *
__£m
è
__THROW
;

49 
	$£m_uÆšk
 (
__cÚ¡
 *
__Çme
è
__THROW
;

55 
	`£m_wa™
 (
£m_t
 *
__£m
);

57 #ifdeà
__USE_XOPEN2K


62 
	`£m_timedwa™
 (
£m_t
 *
__»¡riù
 
__£m
,

63 
__cÚ¡
 
time¥ec
 *
__»¡riù
 
__ab¡ime
);

67 
	$£m_Œywa™
 (
£m_t
 *
__£m
è
__THROWNL
;

70 
	$£m_po¡
 (
£m_t
 *
__£m
è
__THROWNL
;

73 
	$£m_g‘v®ue
 (
£m_t
 *
__»¡riù
 
__£m
, *__»¡riù 
__sv®
)

74 
__THROW
;

77 
__END_DECLS


	@/usr/include/signal.h

23 #iâdef 
_SIGNAL_H


25 #ià!
defšed
 
__Ãed_sig_©omic_t
 && !defšed 
__Ãed_sig£t_t


26 
	#_SIGNAL_H


	)

29 
	~<ã©u»s.h
>

31 
	g__BEGIN_DECLS


33 
	~<b™s/sig£t.h
>

37 #ià
defšed
 
__Ãed_sig_©omic_t
 || defšed 
_SIGNAL_H


38 #iâdeà
__sig_©omic_t_defšed


39 
	#__sig_©omic_t_defšed


	)

40 
__BEGIN_NAMESPACE_STD


41 
__sig_©omic_t
 
	tsig_©omic_t
;

42 
	g__END_NAMESPACE_STD


44 #undeà
__Ãed_sig_©omic_t


47 #ià
defšed
 
__Ãed_sig£t_t
 || (defšed 
_SIGNAL_H
 && defšed 
__USE_POSIX
)

48 #iâdeà
__sig£t_t_defšed


49 
	#__sig£t_t_defšed


	)

50 
__sig£t_t
 
	tsig£t_t
;

52 #undeà
__Ãed_sig£t_t


55 #ifdeà
_SIGNAL_H


57 
	~<b™s/ty³s.h
>

58 
	~<b™s/signum.h
>

60 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


61 #iâdeà
__pid_t_defšed


62 
__pid_t
 
	tpid_t
;

63 
	#__pid_t_defšed


	)

65 #ifdeà
__USE_XOPEN


67 #iâdeà
__uid_t_defšed


68 
__uid_t
 
	tuid_t
;

69 
	#__uid_t_defšed


	)

73 #ifdeà
__USE_POSIX199309


75 
	#__Ãed_time¥ec


	)

76 
	~<time.h
>

79 
	~<b™s/sigšfo.h
>

84 (*
	t__sighªdËr_t
) ();

89 
__sighªdËr_t
 
	$__sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

90 
__THROW
;

91 #ifdeà
__USE_GNU


92 
__sighªdËr_t
 
	$sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

93 
__THROW
;

99 
__BEGIN_NAMESPACE_STD


100 #ifdeà
__USE_BSD


101 
__sighªdËr_t
 
	$sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

102 
__THROW
;

105 #ifdeà
__REDIRECT_NTH


106 
__sighªdËr_t
 
	`__REDIRECT_NTH
 (
sigÇl
,

107 (
__sig
, 
__sighªdËr_t
 
__hªdËr
),

108 
__sysv_sigÇl
);

110 
	#sigÇl
 
__sysv_sigÇl


	)

113 
__END_NAMESPACE_STD


115 #ifdeà
__USE_XOPEN


118 
__sighªdËr_t
 
	$bsd_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

119 
__THROW
;

125 #ifdeà
__USE_POSIX


126 
	$kl
 (
__pid_t
 
__pid
, 
__sig
è
__THROW
;

129 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


133 
	$kÍg
 (
__pid_t
 
__pg½
, 
__sig
è
__THROW
;

136 
__BEGIN_NAMESPACE_STD


138 
	$¿i£
 (
__sig
è
__THROW
;

139 
__END_NAMESPACE_STD


141 #ifdeà
__USE_SVID


143 
__sighªdËr_t
 
	$ssigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

144 
__THROW
;

145 
	$gsigÇl
 (
__sig
è
__THROW
;

148 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN2K


150 
	`psigÇl
 (
__sig
, 
__cÚ¡
 *
__s
);

153 #ifdeà
__USE_XOPEN2K


155 
	`psigšfo
 (
__cÚ¡
 
sigšfo_t
 *
__pšfo
, __cÚ¡ *
__s
);

168 
	`__sig·u£
 (
__sig_Ü_mask
, 
__is_sig
);

170 #ifdeà
__FAVOR_BSD


173 
	$sig·u£
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

175 #ifdeà
__USE_XOPEN


176 #ifdeà
__GNUC__


177 
	$sig·u£
 (
__sig
è
	`__asm__
 ("__xpg_sigpause");

180 
	#sig·u£
(
sig
è
	`__sig·u£
 ((sig), 1)

	)

186 #ifdeà
__USE_BSD


193 
	#sigmask
(
sig
è
	`__sigmask
(sig)

	)

196 
	$sigblock
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

199 
	$sig£tmask
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

202 
	$sigg‘mask
 (è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

206 #ifdeà
__USE_MISC


207 
	#NSIG
 
_NSIG


	)

210 #ifdeà
__USE_GNU


211 
__sighªdËr_t
 
	tsighªdËr_t
;

215 #ifdeà
__USE_BSD


216 
__sighªdËr_t
 
	tsig_t
;

219 #ifdeà
__USE_POSIX


222 
	$sigem±y£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

225 
	$sigfl£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

228 
	$sigadd£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

231 
	$sigd–£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

234 
	$sigismemb”
 (
__cÚ¡
 
sig£t_t
 *
__£t
, 
__signo
)

235 
__THROW
 
	`__nÚnuÎ
 ((1));

237 #ifdeà
__USE_GNU


239 
	$sigi£m±y£t
 (
__cÚ¡
 
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

242 
	$sigªd£t
 (
sig£t_t
 *
__£t
, 
__cÚ¡
 sig£t_ˆ*
__Ëá
,

243 
__cÚ¡
 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

246 
	$sigÜ£t
 (
sig£t_t
 *
__£t
, 
__cÚ¡
 sig£t_ˆ*
__Ëá
,

247 
__cÚ¡
 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

252 
	~<b™s/sigaùiÚ.h
>

255 
	$sig´ocmask
 (
__how
, 
__cÚ¡
 
sig£t_t
 *
__»¡riù
 
__£t
,

256 
sig£t_t
 *
__»¡riù
 
__o£t
è
__THROW
;

263 
	$sigsu¥’d
 (
__cÚ¡
 
sig£t_t
 *
__£t
è
	`__nÚnuÎ
 ((1));

266 
	$sigaùiÚ
 (
__sig
, 
__cÚ¡
 
sigaùiÚ
 *
__»¡riù
 
__aù
,

267 
sigaùiÚ
 *
__»¡riù
 
__ßù
è
__THROW
;

270 
	$sig³ndšg
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

277 
	$sigwa™
 (
__cÚ¡
 
sig£t_t
 *
__»¡riù
 
__£t
, *__»¡riù 
__sig
)

278 
	`__nÚnuÎ
 ((1, 2));

280 #ifdeà
__USE_POSIX199309


285 
	$sigwa™šfo
 (
__cÚ¡
 
sig£t_t
 *
__»¡riù
 
__£t
,

286 
sigšfo_t
 *
__»¡riù
 
__šfo
è
	`__nÚnuÎ
 ((1));

293 
	$sigtimedwa™
 (
__cÚ¡
 
sig£t_t
 *
__»¡riù
 
__£t
,

294 
sigšfo_t
 *
__»¡riù
 
__šfo
,

295 
__cÚ¡
 
time¥ec
 *
__»¡riù
 
__timeout
)

296 
	`__nÚnuÎ
 ((1));

300 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, 
__cÚ¡
 
sigv®
 
__v®
)

301 
__THROW
;

306 #ifdeà
__USE_BSD


310 
__cÚ¡
 *__cÚ¡ 
_sys_sigli¡
[
_NSIG
];

311 
__cÚ¡
 *__cÚ¡ 
sys_sigli¡
[
_NSIG
];

314 
	ssigvec


316 
__sighªdËr_t
 
sv_hªdËr
;

317 
sv_mask
;

319 
sv_æags
;

320 
	#sv_Ú¡ack
 
sv_æags


	)

324 
	#SV_ONSTACK
 (1 << 0)

	)

325 
	#SV_INTERRUPT
 (1 << 1)

	)

326 
	#SV_RESETHAND
 (1 << 2)

	)

334 
	$sigvec
 (
__sig
, 
__cÚ¡
 
sigvec
 *
__vec
,

335 
sigvec
 *
__ovec
è
__THROW
;

339 
	~<b™s/sigcÚ‹xt.h
>

342 
	$sig»tuº
 (
sigcÚ‹xt
 *
__sı
è
__THROW
;

347 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


348 
	#__Ãed_size_t


	)

349 
	~<¡ddef.h
>

354 
	$sigš‹¼u±
 (
__sig
, 
__š‹¼u±
è
__THROW
;

356 
	~<b™s/sig¡ack.h
>

357 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


359 
	~<sys/ucÚ‹xt.h
>

365 
	$sig¡ack
 (
sig¡ack
 *
__ss
, sig¡ack *
__oss
)

366 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

370 
	$sig®t¡ack
 (
__cÚ¡
 
sig®t¡ack
 *
__»¡riù
 
__ss
,

371 
sig®t¡ack
 *
__»¡riù
 
__oss
è
__THROW
;

375 #ifdeà
__USE_XOPEN_EXTENDED


379 
	$sighŞd
 (
__sig
è
__THROW
;

382 
	$sig»l£
 (
__sig
è
__THROW
;

385 
	$sigignÜe
 (
__sig
è
__THROW
;

388 
__sighªdËr_t
 
	$sig£t
 (
__sig
, 
__sighªdËr_t
 
__di¥
è
__THROW
;

391 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


394 
	~<b™s/±h»adty³s.h
>

395 
	~<b™s/sigth»ad.h
>

402 
	$__libc_cu¼’t_sig¹mš
 (è
__THROW
;

404 
	$__libc_cu¼’t_sig¹max
 (è
__THROW
;

408 
__END_DECLS


	@/usr/include/stdint.h

23 #iâdeà
_STDINT_H


24 
	#_STDINT_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/wch¬.h
>

28 
	~<b™s/wÜdsize.h
>

35 #iâdeà
__št8_t_defšed


36 
	#__št8_t_defšed


	)

37 sigÃd 
	tšt8_t
;

38 
	tšt16_t
;

39 
	tšt32_t
;

40 #ià
__WORDSIZE
 == 64

41 
	tšt64_t
;

43 
__ex‹nsiÚ__


44 
	tšt64_t
;

49 
	tušt8_t
;

50 
	tušt16_t
;

51 #iâdeà
__ušt32_t_defšed


52 
	tušt32_t
;

53 
	#__ušt32_t_defšed


	)

55 #ià
__WORDSIZE
 == 64

56 
	tušt64_t
;

58 
__ex‹nsiÚ__


59 
	tušt64_t
;

66 sigÃd 
	tšt_Ëa¡8_t
;

67 
	tšt_Ëa¡16_t
;

68 
	tšt_Ëa¡32_t
;

69 #ià
__WORDSIZE
 == 64

70 
	tšt_Ëa¡64_t
;

72 
__ex‹nsiÚ__


73 
	tšt_Ëa¡64_t
;

77 
	tušt_Ëa¡8_t
;

78 
	tušt_Ëa¡16_t
;

79 
	tušt_Ëa¡32_t
;

80 #ià
__WORDSIZE
 == 64

81 
	tušt_Ëa¡64_t
;

83 
__ex‹nsiÚ__


84 
	tušt_Ëa¡64_t
;

91 sigÃd 
	tšt_ç¡8_t
;

92 #ià
__WORDSIZE
 == 64

93 
	tšt_ç¡16_t
;

94 
	tšt_ç¡32_t
;

95 
	tšt_ç¡64_t
;

97 
	tšt_ç¡16_t
;

98 
	tšt_ç¡32_t
;

99 
__ex‹nsiÚ__


100 
	tšt_ç¡64_t
;

104 
	tušt_ç¡8_t
;

105 #ià
__WORDSIZE
 == 64

106 
	tušt_ç¡16_t
;

107 
	tušt_ç¡32_t
;

108 
	tušt_ç¡64_t
;

110 
	tušt_ç¡16_t
;

111 
	tušt_ç¡32_t
;

112 
__ex‹nsiÚ__


113 
	tušt_ç¡64_t
;

118 #ià
__WORDSIZE
 == 64

119 #iâdeà
__šŒ_t_defšed


120 
	tšŒ_t
;

121 
	#__šŒ_t_defšed


	)

123 
	tušŒ_t
;

125 #iâdeà
__šŒ_t_defšed


126 
	tšŒ_t
;

127 
	#__šŒ_t_defšed


	)

129 
	tušŒ_t
;

134 #ià
__WORDSIZE
 == 64

135 
	tštmax_t
;

136 
	tuštmax_t
;

138 
__ex‹nsiÚ__


139 
	tštmax_t
;

140 
__ex‹nsiÚ__


141 
	tuštmax_t
;

147 #ià!
defšed
 
__ılu¥lus
 || defšed 
__STDC_LIMIT_MACROS


149 #ià
__WORDSIZE
 == 64

150 
	#__INT64_C
(
c
èø## 
L


	)

151 
	#__UINT64_C
(
c
èø## 
UL


	)

153 
	#__INT64_C
(
c
èø## 
LL


	)

154 
	#__UINT64_C
(
c
èø## 
ULL


	)

160 
	#INT8_MIN
 (-128)

	)

161 
	#INT16_MIN
 (-32767-1)

	)

162 
	#INT32_MIN
 (-2147483647-1)

	)

163 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

165 
	#INT8_MAX
 (127)

	)

166 
	#INT16_MAX
 (32767)

	)

167 
	#INT32_MAX
 (2147483647)

	)

168 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

171 
	#UINT8_MAX
 (255)

	)

172 
	#UINT16_MAX
 (65535)

	)

173 
	#UINT32_MAX
 (4294967295U)

	)

174 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

178 
	#INT_LEAST8_MIN
 (-128)

	)

179 
	#INT_LEAST16_MIN
 (-32767-1)

	)

180 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

181 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

183 
	#INT_LEAST8_MAX
 (127)

	)

184 
	#INT_LEAST16_MAX
 (32767)

	)

185 
	#INT_LEAST32_MAX
 (2147483647)

	)

186 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

189 
	#UINT_LEAST8_MAX
 (255)

	)

190 
	#UINT_LEAST16_MAX
 (65535)

	)

191 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

192 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

196 
	#INT_FAST8_MIN
 (-128)

	)

197 #ià
__WORDSIZE
 == 64

198 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

199 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

201 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

202 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

204 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

206 
	#INT_FAST8_MAX
 (127)

	)

207 #ià
__WORDSIZE
 == 64

208 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

209 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

211 
	#INT_FAST16_MAX
 (2147483647)

	)

212 
	#INT_FAST32_MAX
 (2147483647)

	)

214 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

217 
	#UINT_FAST8_MAX
 (255)

	)

218 #ià
__WORDSIZE
 == 64

219 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

220 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

222 
	#UINT_FAST16_MAX
 (4294967295U)

	)

223 
	#UINT_FAST32_MAX
 (4294967295U)

	)

225 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

229 #ià
__WORDSIZE
 == 64

230 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

231 
	#INTPTR_MAX
 (9223372036854775807L)

	)

232 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

234 
	#INTPTR_MIN
 (-2147483647-1)

	)

235 
	#INTPTR_MAX
 (2147483647)

	)

236 
	#UINTPTR_MAX
 (4294967295U)

	)

241 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

243 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

246 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

252 #ià
__WORDSIZE
 == 64

253 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

254 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

256 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

257 
	#PTRDIFF_MAX
 (2147483647)

	)

261 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

262 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

265 #ià
__WORDSIZE
 == 64

266 
	#SIZE_MAX
 (18446744073709551615UL)

	)

268 
	#SIZE_MAX
 (4294967295U)

	)

272 #iâdeà
WCHAR_MIN


274 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

275 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

279 
	#WINT_MIN
 (0u)

	)

280 
	#WINT_MAX
 (4294967295u)

	)

287 #ià!
defšed
 
__ılu¥lus
 || defšed 
__STDC_CONSTANT_MACROS


290 
	#INT8_C
(
c
è
	)
c

291 
	#INT16_C
(
c
è
	)
c

292 
	#INT32_C
(
c
è
	)
c

293 #ià
__WORDSIZE
 == 64

294 
	#INT64_C
(
c
èø## 
L


	)

296 
	#INT64_C
(
c
èø## 
LL


	)

300 
	#UINT8_C
(
c
è
	)
c

301 
	#UINT16_C
(
c
è
	)
c

302 
	#UINT32_C
(
c
èø## 
U


	)

303 #ià
__WORDSIZE
 == 64

304 
	#UINT64_C
(
c
èø## 
UL


	)

306 
	#UINT64_C
(
c
èø## 
ULL


	)

310 #ià
__WORDSIZE
 == 64

311 
	#INTMAX_C
(
c
èø## 
L


	)

312 
	#UINTMAX_C
(
c
èø## 
UL


	)

314 
	#INTMAX_C
(
c
èø## 
LL


	)

315 
	#UINTMAX_C
(
c
èø## 
ULL


	)

	@/usr/include/stdio.h

24 #iâdeà
_STDIO_H


26 #ià!
defšed
 
__Ãed_FILE
 && !defšed 
__Ãed___FILE


27 
	#_STDIO_H
 1

	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


32 
	#__Ãed_size_t


	)

33 
	#__Ãed_NULL


	)

34 
	~<¡ddef.h
>

36 
	~<b™s/ty³s.h
>

37 
	#__Ãed_FILE


	)

38 
	#__Ãed___FILE


	)

42 #ià!
defšed
 
__FILE_defšed
 && defšed 
__Ãed_FILE


45 
	g_IO_FILE
;

47 
__BEGIN_NAMESPACE_STD


49 
_IO_FILE
 
	tFILE
;

50 
	g__END_NAMESPACE_STD


51 #ià
defšed
 
__USE_LARGEFILE64
 || defšed 
__USE_SVID
 || defšed 
__USE_POSIX
 \

52 || 
defšed
 
	g__USE_BSD
 || defšed 
	g__USE_ISOC99
 || defšed 
	g__USE_XOPEN
 \

53 || 
defšed
 
__USE_POSIX2


54 
	$__USING_NAMESPACE_STD
(
FILE
)

57 
	#__FILE_defšed
 1

	)

59 #undeà
__Ãed_FILE


62 #ià!
defšed
 
____FILE_defšed
 && defšed 
__Ãed___FILE


65 
_IO_FILE
 
	t__FILE
;

67 
	#____FILE_defšed
 1

	)

69 #undeà
__Ãed___FILE


72 #ifdef 
_STDIO_H


73 
	#_STDIO_USES_IOSTREAM


	)

75 
	~<libio.h
>

77 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


78 #ifdeà
__GNUC__


79 #iâdeà
_VA_LIST_DEFINED


80 
_G_va_li¡
 
	tva_li¡
;

81 
	#_VA_LIST_DEFINED


	)

84 
	~<¡d¬g.h
>

88 #ifdeà
__USE_XOPEN2K8


89 #iâdeà
__off_t_defšed


90 #iâdeà
__USE_FILE_OFFSET64


91 
__off_t
 
	toff_t
;

93 
__off64_t
 
	toff_t
;

95 
	#__off_t_defšed


	)

97 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


98 
__off64_t
 
	toff64_t
;

99 
	#__off64_t_defšed


	)

102 #iâdeà
__ssize_t_defšed


103 
__ssize_t
 
	tssize_t
;

104 
	#__ssize_t_defšed


	)

109 
__BEGIN_NAMESPACE_STD


110 #iâdeà
__USE_FILE_OFFSET64


111 
_G_åos_t
 
	tåos_t
;

113 
_G_åos64_t
 
	tåos_t
;

115 
__END_NAMESPACE_STD


116 #ifdeà
__USE_LARGEFILE64


117 
_G_åos64_t
 
	tåos64_t
;

121 
	#_IOFBF
 0

	)

122 
	#_IOLBF
 1

	)

123 
	#_IONBF
 2

	)

127 #iâdeà
BUFSIZ


128 
	#BUFSIZ
 
_IO_BUFSIZ


	)

134 #iâdeà
EOF


135 
	#EOF
 (-1)

	)

141 
	#SEEK_SET
 0

	)

142 
	#SEEK_CUR
 1

	)

143 
	#SEEK_END
 2

	)

144 #ifdeà
__USE_GNU


145 
	#SEEK_DATA
 3

	)

146 
	#SEEK_HOLE
 4

	)

150 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


152 
	#P_tmpdœ
 "/tmp"

	)

165 
	~<b™s/¡dio_lim.h
>

169 
_IO_FILE
 *
¡dš
;

170 
_IO_FILE
 *
¡dout
;

171 
_IO_FILE
 *
¡d”r
;

173 
	#¡dš
 
¡dš


	)

174 
	#¡dout
 
¡dout


	)

175 
	#¡d”r
 
¡d”r


	)

177 
__BEGIN_NAMESPACE_STD


179 
	$»move
 (
__cÚ¡
 *
__f’ame
è
__THROW
;

181 
	$»Çme
 (
__cÚ¡
 *
__Şd
, __cÚ¡ *
__Ãw
è
__THROW
;

182 
__END_NAMESPACE_STD


184 #ifdeà
__USE_ATFILE


186 
	$»Çm—t
 (
__Şdfd
, 
__cÚ¡
 *
__Şd
, 
__Ãwfd
,

187 
__cÚ¡
 *
__Ãw
è
__THROW
;

190 
__BEGIN_NAMESPACE_STD


195 #iâdeà
__USE_FILE_OFFSET64


196 
FILE
 *
	$tmpfe
 (è
__wur
;

198 #ifdeà
__REDIRECT


199 
FILE
 *
	`__REDIRECT
 (
tmpfe
, (), 
tmpfe64
è
__wur
;

201 
	#tmpfe
 
tmpfe64


	)

205 #ifdeà
__USE_LARGEFILE64


206 
FILE
 *
	$tmpfe64
 (è
__wur
;

210 *
	$tm²am
 (*
__s
è
__THROW
 
__wur
;

211 
__END_NAMESPACE_STD


213 #ifdeà
__USE_MISC


216 *
	$tm²am_r
 (*
__s
è
__THROW
 
__wur
;

220 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


228 *
	$‹m²am
 (
__cÚ¡
 *
__dœ
, __cÚ¡ *
__pfx
)

229 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

233 
__BEGIN_NAMESPACE_STD


238 
	`fşo£
 (
FILE
 *
__¡»am
);

243 
	`fæush
 (
FILE
 *
__¡»am
);

244 
__END_NAMESPACE_STD


246 #ifdeà
__USE_MISC


253 
	`fæush_uÆocked
 (
FILE
 *
__¡»am
);

256 #ifdeà
__USE_GNU


263 
	`fşo£®l
 ();

267 
__BEGIN_NAMESPACE_STD


268 #iâdeà
__USE_FILE_OFFSET64


273 
FILE
 *
	$fİ’
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

274 
__cÚ¡
 *
__»¡riù
 
__modes
è
__wur
;

279 
FILE
 *
	$äeİ’
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

280 
__cÚ¡
 *
__»¡riù
 
__modes
,

281 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

283 #ifdeà
__REDIRECT


284 
FILE
 *
	`__REDIRECT
 (
fİ’
, (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

285 
__cÚ¡
 *
__»¡riù
 
__modes
), 
fİ’64
)

286 
__wur
;

287 
FILE
 *
	`__REDIRECT
 (
äeİ’
, (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

288 
__cÚ¡
 *
__»¡riù
 
__modes
,

289 
FILE
 *
__»¡riù
 
__¡»am
), 
äeİ’64
)

290 
__wur
;

292 
	#fİ’
 
fİ’64


	)

293 
	#äeİ’
 
äeİ’64


	)

296 
__END_NAMESPACE_STD


297 #ifdeà
__USE_LARGEFILE64


298 
FILE
 *
	$fİ’64
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

299 
__cÚ¡
 *
__»¡riù
 
__modes
è
__wur
;

300 
FILE
 *
	$äeİ’64
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

301 
__cÚ¡
 *
__»¡riù
 
__modes
,

302 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

305 #ifdef 
__USE_POSIX


307 
FILE
 *
	$fdİ’
 (
__fd
, 
__cÚ¡
 *
__modes
è
__THROW
 
__wur
;

310 #ifdef 
__USE_GNU


313 
FILE
 *
	$fİ’cook›
 (*
__»¡riù
 
__magic_cook›
,

314 
__cÚ¡
 *
__»¡riù
 
__modes
,

315 
_IO_cook›_io_funùiÚs_t
 
__io_funcs
è
__THROW
 
__wur
;

318 #ifdeà
__USE_XOPEN2K8


320 
FILE
 *
	$fmemİ’
 (*
__s
, 
size_t
 
__Ën
, 
__cÚ¡
 *
__modes
)

321 
__THROW
 
__wur
;

326 
FILE
 *
	$İ’_mem¡»am
 (**
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
 
__wur
;

330 
__BEGIN_NAMESPACE_STD


333 
	$£tbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
è
__THROW
;

337 
	$£tvbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

338 
__modes
, 
size_t
 
__n
è
__THROW
;

339 
__END_NAMESPACE_STD


341 #ifdef 
__USE_BSD


344 
	$£tbufãr
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

345 
size_t
 
__size
è
__THROW
;

348 
	$£šebuf
 (
FILE
 *
__¡»am
è
__THROW
;

352 
__BEGIN_NAMESPACE_STD


357 
	`årštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

358 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...);

363 
	`´štf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...);

365 
	$¥rštf
 (*
__»¡riù
 
__s
,

366 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROWNL
;

372 
	`vårštf
 (
FILE
 *
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fÜm©
,

373 
_G_va_li¡
 
__¬g
);

378 
	`v´štf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
);

380 
	$v¥rštf
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fÜm©
,

381 
_G_va_li¡
 
__¬g
è
__THROWNL
;

382 
__END_NAMESPACE_STD


384 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_ISOC99
 || defšed 
__USE_UNIX98


385 
__BEGIN_NAMESPACE_C99


387 
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

388 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...)

389 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

391 
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

392 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

393 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

394 
__END_NAMESPACE_C99


397 #ifdeà
__USE_GNU


400 
	$va¥rštf
 (**
__»¡riù
 
__±r
, 
__cÚ¡
 *__»¡riù 
__f
,

401 
_G_va_li¡
 
__¬g
)

402 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 0))è
__wur
;

403 
	$__a¥rštf
 (**
__»¡riù
 
__±r
,

404 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

405 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

406 
	$a¥rštf
 (**
__»¡riù
 
__±r
,

407 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

408 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

411 #ifdeà
__USE_XOPEN2K8


418 
	$vd´štf
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fmt
,

419 
_G_va_li¡
 
__¬g
)

420 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

421 
	$d´štf
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

422 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

426 
__BEGIN_NAMESPACE_STD


431 
	$fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

432 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

437 
	$sÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

439 
	$ssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

440 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

442 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

443 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

444 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

445 #ifdeà
__REDIRECT


449 
	`__REDIRECT
 (
fsÿnf
, (
FILE
 *
__»¡riù
 
__¡»am
,

450 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...),

451 
__isoc99_fsÿnf
è
__wur
;

452 
	`__REDIRECT
 (
sÿnf
, (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...),

453 
__isoc99_sÿnf
è
__wur
;

454 
	`__REDIRECT_NTH
 (
ssÿnf
, (
__cÚ¡
 *
__»¡riù
 
__s
,

455 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...),

456 
__isoc99_ssÿnf
);

458 
	$__isoc99_fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

459 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

460 
	$__isoc99_sÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

461 
	$__isoc99_ssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

462 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

463 
	#fsÿnf
 
__isoc99_fsÿnf


	)

464 
	#sÿnf
 
__isoc99_sÿnf


	)

465 
	#ssÿnf
 
__isoc99_ssÿnf


	)

469 
__END_NAMESPACE_STD


471 #ifdef 
__USE_ISOC99


472 
__BEGIN_NAMESPACE_C99


477 
	$vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fÜm©
,

478 
_G_va_li¡
 
__¬g
)

479 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

485 
	$vsÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

486 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

489 
	$vssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

490 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

491 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

493 #ià!
defšed
 
__USE_GNU
 \

494 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

495 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

496 #ifdeà
__REDIRECT


500 
	`__REDIRECT
 (
vfsÿnf
,

501 (
FILE
 *
__»¡riù
 
__s
,

502 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

503 
__isoc99_vfsÿnf
)

504 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

505 
	`__REDIRECT
 (
vsÿnf
, (
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

506 
_G_va_li¡
 
__¬g
), 
__isoc99_vsÿnf
)

507 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

508 
	`__REDIRECT_NTH
 (
vssÿnf
,

509 (
__cÚ¡
 *
__»¡riù
 
__s
,

510 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

511 
_G_va_li¡
 
__¬g
), 
__isoc99_vssÿnf
)

512 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

514 
	$__isoc99_vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
,

515 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

516 
_G_va_li¡
 
__¬g
è
__wur
;

517 
	$__isoc99_vsÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

518 
_G_va_li¡
 
__¬g
è
__wur
;

519 
	$__isoc99_vssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

520 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

521 
_G_va_li¡
 
__¬g
è
__THROW
;

522 
	#vfsÿnf
 
__isoc99_vfsÿnf


	)

523 
	#vsÿnf
 
__isoc99_vsÿnf


	)

524 
	#vssÿnf
 
__isoc99_vssÿnf


	)

528 
__END_NAMESPACE_C99


532 
__BEGIN_NAMESPACE_STD


537 
	`fg‘c
 (
FILE
 *
__¡»am
);

538 
	`g‘c
 (
FILE
 *
__¡»am
);

544 
	`g‘ch¬
 ();

545 
__END_NAMESPACE_STD


549 
	#g‘c
(
_å
è
	`_IO_g‘c
 (_å)

	)

551 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


556 
	`g‘c_uÆocked
 (
FILE
 *
__¡»am
);

557 
	`g‘ch¬_uÆocked
 ();

560 #ifdeà
__USE_MISC


567 
	`fg‘c_uÆocked
 (
FILE
 *
__¡»am
);

571 
__BEGIN_NAMESPACE_STD


579 
	`åutc
 (
__c
, 
FILE
 *
__¡»am
);

580 
	`putc
 (
__c
, 
FILE
 *
__¡»am
);

586 
	`putch¬
 (
__c
);

587 
__END_NAMESPACE_STD


591 
	#putc
(
_ch
, 
_å
è
	`_IO_putc
 (_ch, _å)

	)

593 #ifdeà
__USE_MISC


600 
	`åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

603 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


608 
	`putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

609 
	`putch¬_uÆocked
 (
__c
);

613 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 \

614 || (
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

616 
	`g‘w
 (
FILE
 *
__¡»am
);

619 
	`putw
 (
__w
, 
FILE
 *
__¡»am
);

623 
__BEGIN_NAMESPACE_STD


628 *
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

629 
__wur
;

636 *
	$g‘s
 (*
__s
è
__wur
;

637 
__END_NAMESPACE_STD


639 #ifdeà
__USE_GNU


646 *
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
,

647 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

651 #ifdef 
__USE_XOPEN2K8


662 
_IO_ssize_t
 
	$__g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

663 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

664 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

665 
_IO_ssize_t
 
	$g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

666 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

667 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

675 
_IO_ssize_t
 
	$g‘lše
 (**
__»¡riù
 
__lš•Œ
,

676 
size_t
 *
__»¡riù
 
__n
,

677 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

681 
__BEGIN_NAMESPACE_STD


686 
	`åuts
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
FILE
 *__»¡riù 
__¡»am
);

692 
	`puts
 (
__cÚ¡
 *
__s
);

699 
	`ung‘c
 (
__c
, 
FILE
 *
__¡»am
);

706 
size_t
 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

707 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

712 
size_t
 
	`fwr™e
 (
__cÚ¡
 *
__»¡riù
 
__±r
, size_ˆ
__size
,

713 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__s
);

714 
__END_NAMESPACE_STD


716 #ifdeà
__USE_GNU


723 
	`åuts_uÆocked
 (
__cÚ¡
 *
__»¡riù
 
__s
,

724 
FILE
 *
__»¡riù
 
__¡»am
);

727 #ifdeà
__USE_MISC


734 
size_t
 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

735 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

736 
size_t
 
	`fwr™e_uÆocked
 (
__cÚ¡
 *
__»¡riù
 
__±r
, size_ˆ
__size
,

737 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
);

741 
__BEGIN_NAMESPACE_STD


746 
	`f£ek
 (
FILE
 *
__¡»am
, 
__off
, 
__wh’û
);

751 
	$á–l
 (
FILE
 *
__¡»am
è
__wur
;

756 
	`»wšd
 (
FILE
 *
__¡»am
);

757 
__END_NAMESPACE_STD


764 #ià
defšed
 
__USE_LARGEFILE
 || defšed 
__USE_XOPEN2K


765 #iâdeà
__USE_FILE_OFFSET64


770 
	`f£eko
 (
FILE
 *
__¡»am
, 
__off_t
 
__off
, 
__wh’û
);

775 
__off_t
 
	$á–lo
 (
FILE
 *
__¡»am
è
__wur
;

777 #ifdeà
__REDIRECT


778 
	`__REDIRECT
 (
f£eko
,

779 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
),

780 
f£eko64
);

781 
__off64_t
 
	`__REDIRECT
 (
á–lo
, (
FILE
 *
__¡»am
), 
á–lo64
);

783 
	#f£eko
 
f£eko64


	)

784 
	#á–lo
 
á–lo64


	)

789 
__BEGIN_NAMESPACE_STD


790 #iâdeà
__USE_FILE_OFFSET64


795 
	`fg‘pos
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos_t
 *__»¡riù 
__pos
);

800 
	`f£os
 (
FILE
 *
__¡»am
, 
__cÚ¡
 
åos_t
 *
__pos
);

802 #ifdeà
__REDIRECT


803 
	`__REDIRECT
 (
fg‘pos
, (
FILE
 *
__»¡riù
 
__¡»am
,

804 
åos_t
 *
__»¡riù
 
__pos
), 
fg‘pos64
);

805 
	`__REDIRECT
 (
f£os
,

806 (
FILE
 *
__¡»am
, 
__cÚ¡
 
åos_t
 *
__pos
), 
f£os64
);

808 
	#fg‘pos
 
fg‘pos64


	)

809 
	#f£os
 
f£os64


	)

812 
__END_NAMESPACE_STD


814 #ifdeà
__USE_LARGEFILE64


815 
	`f£eko64
 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
);

816 
__off64_t
 
	$á–lo64
 (
FILE
 *
__¡»am
è
__wur
;

817 
	`fg‘pos64
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos64_t
 *__»¡riù 
__pos
);

818 
	`f£os64
 (
FILE
 *
__¡»am
, 
__cÚ¡
 
åos64_t
 *
__pos
);

821 
__BEGIN_NAMESPACE_STD


823 
	$ş—»¼
 (
FILE
 *
__¡»am
è
__THROW
;

825 
	$ãof
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

827 
	$ã¼Ü
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

828 
__END_NAMESPACE_STD


830 #ifdeà
__USE_MISC


832 
	$ş—»¼_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
;

833 
	$ãof_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

834 
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

838 
__BEGIN_NAMESPACE_STD


843 
	`³¼Ü
 (
__cÚ¡
 *
__s
);

844 
__END_NAMESPACE_STD


850 
	~<b™s/sys_”¾i¡.h
>

853 #ifdef 
__USE_POSIX


855 
	$f’o
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

858 #ifdeà
__USE_MISC


860 
	$f’o_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

864 #ià(
defšed
 
__USE_POSIX2
 || defšed 
__USE_SVID
 || defšed 
__USE_BSD
 || \

865 
defšed
 
__USE_MISC
)

870 
FILE
 *
	$pİ’
 (
__cÚ¡
 *
__commªd
, __cÚ¡ *
__modes
è
__wur
;

876 
	`pşo£
 (
FILE
 *
__¡»am
);

880 #ifdef 
__USE_POSIX


882 *
	$ù”mid
 (*
__s
è
__THROW
;

886 #ifdeà
__USE_XOPEN


888 *
	`cu£rid
 (*
__s
);

892 #ifdef 
__USE_GNU


893 
ob¡ack
;

896 
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

897 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...)

898 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

899 
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

900 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

901 
_G_va_li¡
 
__¬gs
)

902 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

906 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


910 
	$æockfe
 (
FILE
 *
__¡»am
è
__THROW
;

914 
	$árylockfe
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

917 
	$fuÆockfe
 (
FILE
 *
__¡»am
è
__THROW
;

920 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


924 
	#__Ãed_g‘İt


	)

925 
	~<g‘İt.h
>

930 #ifdeà
__USE_EXTERN_INLINES


931 
	~<b™s/¡dio.h
>

933 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


934 
	~<b™s/¡dio2.h
>

936 #ifdeà
__LDBL_COMPAT


937 
	~<b™s/¡dio-ldbl.h
>

940 
__END_DECLS


	@/usr/include/stdlib.h

23 #iâdef 
_STDLIB_H


25 
	~<ã©u»s.h
>

28 
	#__Ãed_size_t


	)

29 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


30 
	#__Ãed_wch¬_t


	)

31 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

35 
	g__BEGIN_DECLS


37 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


38 
	#_STDLIB_H
 1

	)

40 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
è&& !defšed 
_SYS_WAIT_H


42 
	~<b™s/wa™æags.h
>

43 
	~<b™s/wa™¡©us.h
>

45 #ifdeà
__USE_BSD


50 #ià
defšed
 
__GNUC__
 && !defšed 
__ılu¥lus


51 
	#__WAIT_INT
(
¡©us
) \

52 (
	`__ex‹nsiÚ__
 (((uniÚ { 
	`__ty³of
(
¡©us
è
__š
; 
__i
; }) \

53 { .
__š
 = (
¡©us
è}).
__i
))

	)

55 
	#__WAIT_INT
(
¡©us
è(*(*è&(¡©us))

	)

63 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2 || defšed 
__ılu¥lus


64 
	#__WAIT_STATUS
 *

	)

65 
	#__WAIT_STATUS_DEFN
 *

	)

70 
wa™
 *
	m__u±r
;

71 *
	m__Œ
;

72 } 
	t__WAIT_STATUS
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

73 
	#__WAIT_STATUS_DEFN
 *

	)

78 
	#__WAIT_INT
(
¡©us
è(¡©us)

	)

79 
	#__WAIT_STATUS
 *

	)

80 
	#__WAIT_STATUS_DEFN
 *

	)

85 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (¡©us))

	)

86 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (
	`__WAIT_INT
 (¡©us))

	)

87 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (
	`__WAIT_INT
 (¡©us))

	)

88 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (
	`__WAIT_INT
 (¡©us))

	)

89 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (¡©us))

	)

90 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (¡©us))

	)

91 #ifdeà
__WIFCONTINUED


92 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (¡©us))

	)

96 
__BEGIN_NAMESPACE_STD


100 
	mquÙ
;

101 
	m»m
;

102 } 
	tdiv_t
;

105 #iâdeà
__ldiv_t_defšed


108 
	mquÙ
;

109 
	m»m
;

110 } 
	tldiv_t
;

111 
	#__ldiv_t_defšed
 1

	)

113 
	g__END_NAMESPACE_STD


115 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__Îdiv_t_defšed


116 
__BEGIN_NAMESPACE_C99


118 
__ex‹nsiÚ__
 struct

120 
	mquÙ
;

121 
	m»m
;

122 } 
	tÎdiv_t
;

123 
	#__Îdiv_t_defšed
 1

	)

124 
	g__END_NAMESPACE_C99


129 
	#RAND_MAX
 2147483647

	)

134 
	#EXIT_FAILURE
 1

	)

135 
	#EXIT_SUCCESS
 0

	)

139 
	#MB_CUR_MAX
 (
	`__ùy³_g‘_mb_cur_max
 ())

	)

140 
size_t
 
	$__ùy³_g‘_mb_cur_max
 (è
__THROW
 
__wur
;

143 
__BEGIN_NAMESPACE_STD


145 
	$©of
 (
__cÚ¡
 *
__ÅŒ
)

146 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

148 
	$©oi
 (
__cÚ¡
 *
__ÅŒ
)

149 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

151 
	$©Ş
 (
__cÚ¡
 *
__ÅŒ
)

152 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

153 
__END_NAMESPACE_STD


155 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_MISC
)

156 
__BEGIN_NAMESPACE_C99


158 
__ex‹nsiÚ__
 
	$©Şl
 (
__cÚ¡
 *
__ÅŒ
)

159 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

160 
__END_NAMESPACE_C99


163 
__BEGIN_NAMESPACE_STD


165 
	$¡¹od
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

166 **
__»¡riù
 
__’d±r
)

167 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

168 
__END_NAMESPACE_STD


170 #ifdef 
__USE_ISOC99


171 
__BEGIN_NAMESPACE_C99


173 
	$¡¹of
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

174 **
__»¡riù
 
__’d±r
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

176 
	$¡¹Şd
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

177 **
__»¡riù
 
__’d±r
)

178 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

179 
__END_NAMESPACE_C99


182 
__BEGIN_NAMESPACE_STD


184 
	$¡¹Ş
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

185 **
__»¡riù
 
__’d±r
, 
__ba£
)

186 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

188 
	$¡¹oul
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

189 **
__»¡riù
 
__’d±r
, 
__ba£
)

190 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

191 
__END_NAMESPACE_STD


193 #ià
defšed
 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_BSD


195 
__ex‹nsiÚ__


196 
	$¡¹oq
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

197 **
__»¡riù
 
__’d±r
, 
__ba£
)

198 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

200 
__ex‹nsiÚ__


201 
	$¡¹ouq
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

202 **
__»¡riù
 
__’d±r
, 
__ba£
)

203 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

206 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_MISC
)

207 
__BEGIN_NAMESPACE_C99


209 
__ex‹nsiÚ__


210 
	$¡¹Şl
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

211 **
__»¡riù
 
__’d±r
, 
__ba£
)

212 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

214 
__ex‹nsiÚ__


215 
	$¡¹ouÎ
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

216 **
__»¡riù
 
__’d±r
, 
__ba£
)

217 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

218 
__END_NAMESPACE_C99


222 #ifdeà
__USE_GNU


236 
	~<xloÿË.h
>

240 
	$¡¹Ş_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

241 **
__»¡riù
 
__’d±r
, 
__ba£
,

242 
__loÿË_t
 
__loc
è
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

244 
	$¡¹oul_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

245 **
__»¡riù
 
__’d±r
,

246 
__ba£
, 
__loÿË_t
 
__loc
)

247 
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

249 
__ex‹nsiÚ__


250 
	$¡¹Şl_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

251 **
__»¡riù
 
__’d±r
, 
__ba£
,

252 
__loÿË_t
 
__loc
)

253 
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

255 
__ex‹nsiÚ__


256 
	$¡¹ouÎ_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

257 **
__»¡riù
 
__’d±r
,

258 
__ba£
, 
__loÿË_t
 
__loc
)

259 
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

261 
	$¡¹od_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

262 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

263 
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

265 
	$¡¹of_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

266 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

267 
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

269 
	$¡¹Şd_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

270 **
__»¡riù
 
__’d±r
,

271 
__loÿË_t
 
__loc
)

272 
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

276 #ifdeà
__USE_EXTERN_INLINES


277 
__BEGIN_NAMESPACE_STD


278 
__ex‹º_šlše
 

279 
	`__NTH
 (
	$©of
 (
__cÚ¡
 *
__ÅŒ
))

281  
	`¡¹od
 (
__ÅŒ
, (**è
NULL
);

282 
	}
}

283 
__ex‹º_šlše
 

284 
__NTH
 (
	$©oi
 (
__cÚ¡
 *
__ÅŒ
))

286  (è
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

287 
	}
}

288 
__ex‹º_šlše
 

289 
__NTH
 (
	$©Ş
 (
__cÚ¡
 *
__ÅŒ
))

291  
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

292 
	}
}

293 
	g__END_NAMESPACE_STD


295 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ISOC99


296 
__BEGIN_NAMESPACE_C99


297 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

298 
__NTH
 (
	$©Şl
 (
__cÚ¡
 *
__ÅŒ
))

300  
	`¡¹Şl
 (
__ÅŒ
, (**è
NULL
, 10);

301 
	}
}

302 
	g__END_NAMESPACE_C99


307 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED


311 *
	$l64a
 (
__n
è
__THROW
 
__wur
;

314 
	$a64l
 (
__cÚ¡
 *
__s
)

315 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

319 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_BSD


320 
	~<sys/ty³s.h
>

327 
	$¿ndom
 (è
__THROW
;

330 
	$¤ªdom
 (
__£ed
è
__THROW
;

336 *
	$š™¡©e
 (
__£ed
, *
__¡©ebuf
,

337 
size_t
 
__¡©–’
è
__THROW
 
	`__nÚnuÎ
 ((2));

341 *
	$£t¡©e
 (*
__¡©ebuf
è
__THROW
 
	`__nÚnuÎ
 ((1));

344 #ifdeà
__USE_MISC


349 
	s¿ndom_d©a


351 
št32_t
 *
åŒ
;

352 
št32_t
 *
½Œ
;

353 
št32_t
 *
¡©e
;

354 
¿nd_ty³
;

355 
¿nd_deg
;

356 
¿nd_£p
;

357 
št32_t
 *
’d_±r
;

360 
	$¿ndom_r
 (
¿ndom_d©a
 *
__»¡riù
 
__buf
,

361 
št32_t
 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

363 
	$¤ªdom_r
 (
__£ed
, 
¿ndom_d©a
 *
__buf
)

364 
__THROW
 
	`__nÚnuÎ
 ((2));

366 
	$š™¡©e_r
 (
__£ed
, *
__»¡riù
 
__¡©ebuf
,

367 
size_t
 
__¡©–’
,

368 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

369 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

371 
	$£t¡©e_r
 (*
__»¡riù
 
__¡©ebuf
,

372 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

373 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

378 
__BEGIN_NAMESPACE_STD


380 
	$¿nd
 (è
__THROW
;

382 
	$¤ªd
 (
__£ed
è
__THROW
;

383 
__END_NAMESPACE_STD


385 #ifdeà
__USE_POSIX


387 
	$¿nd_r
 (*
__£ed
è
__THROW
;

391 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


395 
	$d¿nd48
 (è
__THROW
;

396 
	$”ªd48
 (
__xsubi
[3]è
__THROW
 
	`__nÚnuÎ
 ((1));

399 
	$Ìªd48
 (è
__THROW
;

400 
	$Äªd48
 (
__xsubi
[3])

401 
__THROW
 
	`__nÚnuÎ
 ((1));

404 
	$m¿nd48
 (è
__THROW
;

405 
	$j¿nd48
 (
__xsubi
[3])

406 
__THROW
 
	`__nÚnuÎ
 ((1));

409 
	$¤ªd48
 (
__£edv®
è
__THROW
;

410 *
	$£ed48
 (
__£ed16v
[3])

411 
__THROW
 
	`__nÚnuÎ
 ((1));

412 
	$lcÚg48
 (
__·¿m
[7]è
__THROW
 
	`__nÚnuÎ
 ((1));

414 #ifdeà
__USE_MISC


418 
	sd¿nd48_d©a


420 
__x
[3];

421 
__Şd_x
[3];

422 
__c
;

423 
__š™
;

424 
__a
;

428 
	$d¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

429 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

430 
	$”ªd48_r
 (
__xsubi
[3],

431 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

432 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

435 
	$Ìªd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

436 *
__»¡riù
 
__»suÉ
)

437 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

438 
	$Äªd48_r
 (
__xsubi
[3],

439 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

440 *
__»¡riù
 
__»suÉ
)

441 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

444 
	$m¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

445 *
__»¡riù
 
__»suÉ
)

446 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

447 
	$j¿nd48_r
 (
__xsubi
[3],

448 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

449 *
__»¡riù
 
__»suÉ
)

450 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

453 
	$¤ªd48_r
 (
__£edv®
, 
d¿nd48_d©a
 *
__bufãr
)

454 
__THROW
 
	`__nÚnuÎ
 ((2));

456 
	$£ed48_r
 (
__£ed16v
[3],

457 
d¿nd48_d©a
 *
__bufãr
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 
	$lcÚg48_r
 (
__·¿m
[7],

460 
d¿nd48_d©a
 *
__bufãr
)

461 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

467 #iâdeà
__m®loc_ªd_ÿÎoc_defšed


468 
	#__m®loc_ªd_ÿÎoc_defšed


	)

469 
__BEGIN_NAMESPACE_STD


471 *
	$m®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

473 *
	$ÿÎoc
 (
size_t
 
__nmemb
, size_ˆ
__size
)

474 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

475 
__END_NAMESPACE_STD


478 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


479 
__BEGIN_NAMESPACE_STD


485 *
	$»®loc
 (*
__±r
, 
size_t
 
__size
)

486 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

488 
	$ä“
 (*
__±r
è
__THROW
;

489 
__END_NAMESPACE_STD


491 #ifdef 
__USE_MISC


493 
	$cä“
 (*
__±r
è
__THROW
;

496 #ià
defšed
 
__USE_GNU
 || defšed 
__USE_BSD
 || defšed 
__USE_MISC


497 
	~<®loÿ.h
>

500 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

501 || 
defšed
 
__USE_BSD


503 *
	$v®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

506 #ifdeà
__USE_XOPEN2K


508 
	$posix_mem®ign
 (**
__mem±r
, 
size_t
 
__®ignm’t
, size_ˆ
__size
)

509 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

512 
__BEGIN_NAMESPACE_STD


514 
	$abÜt
 (è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

518 
	`©ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

520 #ifdeà
__USE_GNU


524 #ifdeà
__ılu¥lus


525 "C++" 
	`©_quick_ex™
 ((*
__func
) ())

526 
__THROW
 
	`__asm
 ("©_quick_ex™"è
	`__nÚnuÎ
 ((1));

528 
	`©_quick_ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

531 
__END_NAMESPACE_STD


533 #ifdef 
__USE_MISC


536 
	`Ú_ex™
 ((*
__func
è(
__¡©us
, *
__¬g
), *__arg)

537 
__THROW
 
	`__nÚnuÎ
 ((1));

540 
__BEGIN_NAMESPACE_STD


544 
	$ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

546 #ifdeà
__USE_GNU


552 
	$quick_ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

554 
__END_NAMESPACE_STD


556 #ifdeà
__USE_ISOC99


557 
__BEGIN_NAMESPACE_C99


560 
	$_Ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

561 
__END_NAMESPACE_C99


565 
__BEGIN_NAMESPACE_STD


567 *
	$g‘’v
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

568 
__END_NAMESPACE_STD


572 *
	$__£cu»_g‘’v
 (
__cÚ¡
 *
__Çme
)

573 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

575 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


579 
	$pu‹nv
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

582 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


585 
	$£‹nv
 (
__cÚ¡
 *
__Çme
, __cÚ¡ *
__v®ue
, 
__»¶aû
)

586 
__THROW
 
	`__nÚnuÎ
 ((2));

589 
	$un£‹nv
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

592 #ifdef 
__USE_MISC


596 
	$ş—»nv
 (è
__THROW
;

600 #ià
defšed
 
__USE_MISC
 \

601 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
)

606 *
	$mk‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

609 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 \

610 || 
defšed
 
__USE_XOPEN2K8


619 #iâdeà
__USE_FILE_OFFSET64


620 
	$mk¡emp
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

622 #ifdeà
__REDIRECT


623 
	`__REDIRECT
 (
mk¡emp
, (*
__‹m¶©e
), 
mk¡emp64
)

624 
	`__nÚnuÎ
 ((1)è
__wur
;

626 
	#mk¡emp
 
mk¡emp64


	)

629 #ifdeà
__USE_LARGEFILE64


630 
	$mk¡emp64
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

634 #ifdeà
__USE_MISC


641 #iâdeà
__USE_FILE_OFFSET64


642 
	$mk¡emps
 (*
__‹m¶©e
, 
__suffixËn
è
	`__nÚnuÎ
 ((1)è
__wur
;

644 #ifdeà
__REDIRECT


645 
	`__REDIRECT
 (
mk¡emps
, (*
__‹m¶©e
, 
__suffixËn
),

646 
mk¡emps64
è
	`__nÚnuÎ
 ((1)è
__wur
;

648 
	#mk¡emps
 
mk¡emps64


	)

651 #ifdeà
__USE_LARGEFILE64


652 
	$mk¡emps64
 (*
__‹m¶©e
, 
__suffixËn
)

653 
	`__nÚnuÎ
 ((1)è
__wur
;

657 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K8


663 *
	$mkd‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

666 #ifdeà
__USE_GNU


673 #iâdeà
__USE_FILE_OFFSET64


674 
	$mko¡emp
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

676 #ifdeà
__REDIRECT


677 
	`__REDIRECT
 (
mko¡emp
, (*
__‹m¶©e
, 
__æags
), 
mko¡emp64
)

678 
	`__nÚnuÎ
 ((1)è
__wur
;

680 
	#mko¡emp
 
mko¡emp64


	)

683 #ifdeà
__USE_LARGEFILE64


684 
	$mko¡emp64
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

693 #iâdeà
__USE_FILE_OFFSET64


694 
	$mko¡emps
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

695 
	`__nÚnuÎ
 ((1)è
__wur
;

697 #ifdeà
__REDIRECT


698 
	`__REDIRECT
 (
mko¡emps
, (*
__‹m¶©e
, 
__suffixËn
,

699 
__æags
), 
mko¡emps64
)

700 
	`__nÚnuÎ
 ((1)è
__wur
;

702 
	#mko¡emps
 
mko¡emps64


	)

705 #ifdeà
__USE_LARGEFILE64


706 
	$mko¡emps64
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

707 
	`__nÚnuÎ
 ((1)è
__wur
;

712 
__BEGIN_NAMESPACE_STD


717 
	$sy¡em
 (
__cÚ¡
 *
__commªd
è
__wur
;

718 
__END_NAMESPACE_STD


721 #ifdef 
__USE_GNU


724 *
	$ÿnÚiÿlize_fe_Çme
 (
__cÚ¡
 *
__Çme
)

725 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

728 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


734 *
	$»®·th
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

735 *
__»¡riù
 
__»sŞved
è
__THROW
 
__wur
;

740 #iâdeà
__COMPAR_FN_T


741 
	#__COMPAR_FN_T


	)

742 (*
	t__com·r_â_t
è(
	t__cÚ¡
 *, __const *);

744 #ifdef 
__USE_GNU


745 
__com·r_â_t
 
	tcom·risÚ_â_t
;

748 #ifdeà
__USE_GNU


749 (*
	t__com·r_d_â_t
è(
	t__cÚ¡
 *, __const *, *);

752 
__BEGIN_NAMESPACE_STD


755 *
	$b£¬ch
 (
__cÚ¡
 *
__key
, __cÚ¡ *
__ba£
,

756 
size_t
 
__nmemb
, size_ˆ
__size
, 
__com·r_â_t
 
__com·r
)

757 
	`__nÚnuÎ
 ((1, 2, 5)è
__wur
;

761 
	$qsÜt
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

762 
__com·r_â_t
 
__com·r
è
	`__nÚnuÎ
 ((1, 4));

763 #ifdeà
__USE_GNU


764 
	$qsÜt_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

765 
__com·r_d_â_t
 
__com·r
, *
__¬g
)

766 
	`__nÚnuÎ
 ((1, 4));

771 
	$abs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

772 
	$Ïbs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

773 
__END_NAMESPACE_STD


775 #ifdeà
__USE_ISOC99


776 
__ex‹nsiÚ__
 
	$Îabs
 (
__x
)

777 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

781 
__BEGIN_NAMESPACE_STD


785 
div_t
 
	$div
 (
__num”
, 
__d’om
)

786 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

787 
ldiv_t
 
	$ldiv
 (
__num”
, 
__d’om
)

788 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

789 
__END_NAMESPACE_STD


791 #ifdeà
__USE_ISOC99


792 
__BEGIN_NAMESPACE_C99


793 
__ex‹nsiÚ__
 
Îdiv_t
 
	$Îdiv
 (
__num”
,

794 
__d’om
)

795 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

796 
__END_NAMESPACE_C99


800 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

801 || 
defšed
 
__USE_SVID


808 *
	$ecvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

809 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

814 *
	$fcvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

815 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

820 *
	$gcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

821 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

824 #ifdeà
__USE_MISC


826 *
	$qecvt
 (
__v®ue
, 
__ndig™
,

827 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

828 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

829 *
	$qfcvt
 (
__v®ue
, 
__ndig™
,

830 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

831 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

832 *
	$qgcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

833 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

838 
	$ecvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

839 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

840 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

841 
	$fcvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

842 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

843 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

845 
	$qecvt_r
 (
__v®ue
, 
__ndig™
,

846 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

847 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

848 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

849 
	$qfcvt_r
 (
__v®ue
, 
__ndig™
,

850 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

851 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

852 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

857 
__BEGIN_NAMESPACE_STD


860 
	$mbËn
 (
__cÚ¡
 *
__s
, 
size_t
 
__n
è
__THROW
 
__wur
;

863 
	$mbtowc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

864 
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
 
__wur
;

867 
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
è
__THROW
 
__wur
;

871 
size_t
 
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__pwcs
,

872 
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

874 
size_t
 
	$wc¡ombs
 (*
__»¡riù
 
__s
,

875 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__pwcs
, 
size_t
 
__n
)

876 
__THROW
;

877 
__END_NAMESPACE_STD


880 #ifdeà
__USE_SVID


885 
	$½m©ch
 (
__cÚ¡
 *
__»¥Ú£
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

889 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


896 
	$g‘subİt
 (**
__»¡riù
 
__İtiÚp
,

897 *
__cÚ¡
 *
__»¡riù
 
__tok’s
,

898 **
__»¡riù
 
__v®u•
)

899 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3)è
__wur
;

903 #ifdeà
__USE_XOPEN


905 
	$£tkey
 (
__cÚ¡
 *
__key
è
__THROW
 
	`__nÚnuÎ
 ((1));

911 #ifdeà
__USE_XOPEN2KXSI


913 
	$posix_İ’±
 (
__oæag
è
__wur
;

916 #ifdeà
__USE_XOPEN


921 
	$g¿Á±
 (
__fd
è
__THROW
;

925 
	$uÆock±
 (
__fd
è
__THROW
;

930 *
	$±¢ame
 (
__fd
è
__THROW
 
__wur
;

933 #ifdeà
__USE_GNU


937 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

938 
__THROW
 
	`__nÚnuÎ
 ((2));

941 
	`g‘±
 ();

944 #ifdeà
__USE_BSD


948 
	$g‘lßdavg
 (
__lßdavg
[], 
__ÃËm
)

949 
__THROW
 
	`__nÚnuÎ
 ((1));

954 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


955 
	~<b™s/¡dlib.h
>

957 #ifdeà
__LDBL_COMPAT


958 
	~<b™s/¡dlib-ldbl.h
>

962 #undeà
__Ãed_m®loc_ªd_ÿÎoc


964 
__END_DECLS


	@/usr/include/string.h

24 #iâdef 
_STRING_H


25 
	#_STRING_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


32 
	#__Ãed_size_t


	)

33 
	#__Ãed_NULL


	)

34 
	~<¡ddef.h
>

37 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

38 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

42 
__BEGIN_NAMESPACE_STD


44 *
	$memıy
 (*
__»¡riù
 
__de¡
,

45 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

46 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

49 *
	$memmove
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__n
)

50 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

51 
__END_NAMESPACE_STD


56 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN


57 *
	$memcıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

58 
__c
, 
size_t
 
__n
)

59 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

63 
__BEGIN_NAMESPACE_STD


65 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

68 
	$memcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

69 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

72 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


75 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

76 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

77 
__cÚ¡
 *
	`memchr
 (__cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

78 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

80 #ifdeà
__OPTIMIZE__


81 
__ex‹º_®ways_šlše
 *

82 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


84  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

87 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

88 
	`memchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


90  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

93 
	}
}

95 *
	$memchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

96 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

98 
__END_NAMESPACE_STD


100 #ifdeà
__USE_GNU


103 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


104 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

105 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

106 "C++" 
__cÚ¡
 *
	$¿wmemchr
 (
__cÚ¡
 *
__s
, 
__c
)

107 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

109 *
	$¿wmemchr
 (
__cÚ¡
 *
__s
, 
__c
)

110 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

114 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


115 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

116 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

117 "C++" 
__cÚ¡
 *
	$memrchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

118 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

120 *
	$memrchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

121 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

126 
__BEGIN_NAMESPACE_STD


128 *
	$¡rıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

129 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

131 *
	$¡ºıy
 (*
__»¡riù
 
__de¡
,

132 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

133 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

136 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

137 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

139 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

140 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

143 
	$¡rcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

144 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

146 
	$¡ºcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

147 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

150 
	$¡rcŞl
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

151 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

153 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

154 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

155 
__THROW
 
	`__nÚnuÎ
 ((2));

156 
__END_NAMESPACE_STD


158 #ifdeà
__USE_XOPEN2K8


162 
	~<xloÿË.h
>

165 
	$¡rcŞl_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
__loÿË_t
 
__l
)

166 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

168 
size_t
 
	$¡rxäm_l
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__n
,

169 
__loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

172 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 \

173 || 
defšed
 
__USE_XOPEN2K8


175 *
	$¡rdup
 (
__cÚ¡
 *
__s
)

176 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

182 #ià
defšed
 
__USE_XOPEN2K8


183 *
	$¡ºdup
 (
__cÚ¡
 *
__¡ršg
, 
size_t
 
__n
)

184 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

187 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


189 
	#¡rdu·
(
s
) \

190 (
__ex‹nsiÚ__
 \

192 
__cÚ¡
 *
__Şd
 = (
s
); \

193 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Şd
) + 1; \

194 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
); \

195 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

196 
	}
}))

	)

199 
	#¡ºdu·
(
s
, 
n
) \

200 (
__ex‹nsiÚ__
 \

202 
__cÚ¡
 *
__Şd
 = (
s
); \

203 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Şd
, (
n
)); \

204 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
 + 1); \

205 
__Ãw
[
__Ën
] = '\0'; \

206 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

207 }))

	)

210 
	g__BEGIN_NAMESPACE_STD


212 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


215 *
¡rchr
 (*
__s
, 
__c
)

216 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

217 
__cÚ¡
 *
¡rchr
 (__cÚ¡ *
__s
, 
__c
)

218 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

220 #ifdeà
__OPTIMIZE__


221 
__ex‹º_®ways_šlše
 *

222 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


224  
__butš_¡rchr
 (
__s
, 
__c
);

227 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

228 
¡rchr
 (
__cÚ¡
 *
__s
, 
__c
è
	g__THROW


230  
__butš_¡rchr
 (
__s
, 
__c
);

235 *
	$¡rchr
 (
__cÚ¡
 *
__s
, 
__c
)

236 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

239 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


242 *
	`¡¼chr
 (*
__s
, 
__c
)

243 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

244 
__cÚ¡
 *
	`¡¼chr
 (__cÚ¡ *
__s
, 
__c
)

245 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

247 #ifdeà
__OPTIMIZE__


248 
__ex‹º_®ways_šlše
 *

249 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


251  
	`__butš_¡¼chr
 (
__s
, 
__c
);

254 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

255 
	`¡¼chr
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


257  
	`__butš_¡¼chr
 (
__s
, 
__c
);

260 
	}
}

262 *
	$¡¼chr
 (
__cÚ¡
 *
__s
, 
__c
)

263 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

265 
__END_NAMESPACE_STD


267 #ifdeà
__USE_GNU


270 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


271 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

272 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

273 "C++" 
__cÚ¡
 *
	$¡rchºul
 (
__cÚ¡
 *
__s
, 
__c
)

274 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

276 *
	$¡rchºul
 (
__cÚ¡
 *
__s
, 
__c
)

277 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

281 
__BEGIN_NAMESPACE_STD


284 
size_t
 
	$¡rc¥n
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__»jeù
)

285 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

288 
size_t
 
	$¡r¥n
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
)

289 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

291 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


294 *
	`¡½brk
 (*
__s
, 
__cÚ¡
 *
__acû±
)

295 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

296 
__cÚ¡
 *
	`¡½brk
 (__cÚ¡ *
__s
, __cÚ¡ *
__acû±
)

297 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

299 #ifdeà
__OPTIMIZE__


300 
__ex‹º_®ways_šlše
 *

301 
	`¡½brk
 (*
__s
, 
__cÚ¡
 *
__acû±
è
__THROW


303  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

306 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

307 
	`¡½brk
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
è
__THROW


309  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

312 
	}
}

314 *
	$¡½brk
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
)

315 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

318 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


321 *
	`¡r¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
)

322 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

323 
__cÚ¡
 *
	`¡r¡r
 (__cÚ¡ *
__hay¡ack
,

324 
__cÚ¡
 *
__ÃedË
)

325 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

327 #ifdeà
__OPTIMIZE__


328 
__ex‹º_®ways_šlše
 *

329 
	`¡r¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
è
__THROW


331  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

334 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

335 
	`¡r¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
è
__THROW


337  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

340 
	}
}

342 *
	$¡r¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
)

343 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

348 *
	$¡¹ok
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__d–im
)

349 
__THROW
 
	`__nÚnuÎ
 ((2));

350 
__END_NAMESPACE_STD


354 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

355 
__cÚ¡
 *
__»¡riù
 
__d–im
,

356 **
__»¡riù
 
__§ve_±r
)

357 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

358 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


359 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__d–im
,

360 **
__»¡riù
 
__§ve_±r
)

361 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

364 #ifdeà
__USE_GNU


366 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


367 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
)

368 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

369 "C++" 
__cÚ¡
 *
	$¡rÿ£¡r
 (
__cÚ¡
 *
__hay¡ack
,

370 
__cÚ¡
 *
__ÃedË
)

371 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

373 *
	$¡rÿ£¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
)

374 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

378 #ifdeà
__USE_GNU


382 *
	$memmem
 (
__cÚ¡
 *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

383 
__cÚ¡
 *
__ÃedË
, 
size_t
 
__ÃedËËn
)

384 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3));

388 *
	$__mempıy
 (*
__»¡riù
 
__de¡
,

389 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

390 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

391 *
	$mempıy
 (*
__»¡riù
 
__de¡
,

392 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

393 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

397 
__BEGIN_NAMESPACE_STD


399 
size_t
 
	$¡¾’
 (
__cÚ¡
 *
__s
)

400 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

401 
__END_NAMESPACE_STD


403 #ifdef 
__USE_XOPEN2K8


406 
size_t
 
	$¡ºËn
 (
__cÚ¡
 *
__¡ršg
, 
size_t
 
__maxËn
)

407 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

411 
__BEGIN_NAMESPACE_STD


413 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

414 
__END_NAMESPACE_STD


415 #ià
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_MISC


423 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


426 #ifdeà
__REDIRECT_NTH


427 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

428 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

429 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2));

431 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

432 
__THROW
 
	`__nÚnuÎ
 ((2));

433 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

438 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

439 
__THROW
 
	`__nÚnuÎ
 ((2));

443 #ifdeà
__USE_XOPEN2K8


445 *
	$¡»¼Ü_l
 (
__”ºum
, 
__loÿË_t
 
__l
è
__THROW
;

451 
	$__bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

453 #ifdeà
__USE_BSD


455 
	$bcİy
 (
__cÚ¡
 *
__¤c
, *
__de¡
, 
size_t
 
__n
)

456 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

462 
	$bcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

463 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

466 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


469 *
	`šdex
 (*
__s
, 
__c
)

470 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

471 
__cÚ¡
 *
	`šdex
 (__cÚ¡ *
__s
, 
__c
)

472 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

474 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


475 
__ex‹º_®ways_šlše
 *

476 
	`šdex
 (*
__s
, 
__c
è
__THROW


478  
	`__butš_šdex
 (
__s
, 
__c
);

481 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

482 
	`šdex
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


484  
	`__butš_šdex
 (
__s
, 
__c
);

487 
	}
}

489 *
	$šdex
 (
__cÚ¡
 *
__s
, 
__c
)

490 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

494 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


497 *
	`ršdex
 (*
__s
, 
__c
)

498 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

499 
__cÚ¡
 *
	`ršdex
 (__cÚ¡ *
__s
, 
__c
)

500 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

502 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


503 
__ex‹º_®ways_šlše
 *

504 
	`ršdex
 (*
__s
, 
__c
è
__THROW


506  
	`__butš_ršdex
 (
__s
, 
__c
);

509 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

510 
	`ršdex
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


512  
	`__butš_ršdex
 (
__s
, 
__c
);

515 
	}
}

517 *
	$ršdex
 (
__cÚ¡
 *
__s
, 
__c
)

518 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

523 
	$ffs
 (
__i
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

527 #ifdef 
__USE_GNU


528 
	$ff¦
 (
__l
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

529 #ifdeà
__GNUC__


530 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

531 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

536 
	$¡rÿ£cmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

537 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

540 
	$¡ºÿ£cmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

541 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

544 #ifdef 
__USE_GNU


547 
	$¡rÿ£cmp_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
,

548 
__loÿË_t
 
__loc
)

549 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

551 
	$¡ºÿ£cmp_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
,

552 
size_t
 
__n
, 
__loÿË_t
 
__loc
)

553 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

556 #ifdef 
__USE_BSD


559 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

560 
__cÚ¡
 *
__»¡riù
 
__d–im
)

561 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

564 #ifdef 
__USE_XOPEN2K8


566 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

569 *
	$__¡pıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

570 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

571 *
	$¡pıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

572 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

576 *
	$__¡²ıy
 (*
__»¡riù
 
__de¡
,

577 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

578 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

579 *
	$¡²ıy
 (*
__»¡riù
 
__de¡
,

580 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

581 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

584 #ifdef 
__USE_GNU


586 
	$¡rv”scmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

587 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

590 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

593 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

595 #iâdeà
ba£Çme


600 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


601 "C++" *
	$ba£Çme
 (*
__f’ame
)

602 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

603 "C++" 
__cÚ¡
 *
	$ba£Çme
 (
__cÚ¡
 *
__f’ame
)

604 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

606 *
	$ba£Çme
 (
__cÚ¡
 *
__f’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

612 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

613 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__OPTIMIZE_SIZE__
 \

614 && !
defšed
 
__NO_INLINE__
 && !defšed 
__ılu¥lus


634 
	~<b™s/¡ršg.h
>

637 
	~<b™s/¡ršg2.h
>

640 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


642 
	~<b™s/¡ršg3.h
>

646 
__END_DECLS


	@/usr/include/time.h

23 #iâdef 
_TIME_H


25 #ià(! 
defšed
 
__Ãed_time_t
 && !defšed 
__Ãed_şock_t
 && \

26 ! 
defšed
 
	g__Ãed_time¥ec
)

27 
	#_TIME_H
 1

	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


34 #ifdef 
_TIME_H


36 
	#__Ãed_size_t


	)

37 
	#__Ãed_NULL


	)

38 
	~<¡ddef.h
>

42 
	~<b™s/time.h
>

45 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


46 #iâdeà
CLK_TCK


47 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

53 #ià!
defšed
 
__şock_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_şock_t
)

54 
	#__şock_t_defšed
 1

	)

56 
	~<b™s/ty³s.h
>

58 
__BEGIN_NAMESPACE_STD


60 
__şock_t
 
	tşock_t
;

61 
	g__END_NAMESPACE_STD


62 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


63 
	$__USING_NAMESPACE_STD
(
şock_t
)

67 #undeà
__Ãed_şock_t


69 #ià!
defšed
 
__time_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_time_t
)

70 
	#__time_t_defšed
 1

	)

72 
	~<b™s/ty³s.h
>

74 
__BEGIN_NAMESPACE_STD


76 
__time_t
 
	ttime_t
;

77 
__END_NAMESPACE_STD


78 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC
 || defšed 
__USE_SVID


79 
	$__USING_NAMESPACE_STD
(
time_t
)

83 #undeà
__Ãed_time_t


85 #ià!
defšed
 
__şockid_t_defšed
 && \

86 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_şockid_t
)

87 
	#__şockid_t_defšed
 1

	)

89 
	~<b™s/ty³s.h
>

92 
__şockid_t
 
	tşockid_t
;

95 #undeà
__şockid_time_t


97 #ià!
defšed
 
__tim”_t_defšed
 && \

98 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_tim”_t
)

99 
	#__tim”_t_defšed
 1

	)

101 
	~<b™s/ty³s.h
>

104 
__tim”_t
 
	ttim”_t
;

107 #undeà
__Ãed_tim”_t


110 #ià!
defšed
 
__time¥ec_defšed
 && \

111 ((
defšed
 
_TIME_H
 && \

112 (
defšed
 
__USE_POSIX199309
 || defšed 
__USE_MISC
)) || \

113 
defšed
 
__Ãed_time¥ec
)

114 
	#__time¥ec_defšed
 1

	)

116 
	~<b™s/ty³s.h
>

120 
	stime¥ec


122 
__time_t
 
tv_£c
;

123 
tv_n£c
;

127 #undeà
__Ãed_time¥ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mš
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_mÚ
;

140 
tm_y—r
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd¡
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 
__cÚ¡
 *
tm_zÚe
;

149 
__tm_gmtoff
;

150 
__cÚ¡
 *
__tm_zÚe
;

153 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifdeà
__USE_POSIX199309


161 
	s™im”¥ec


163 
time¥ec
 
™_š‹rv®
;

164 
time¥ec
 
™_v®ue
;

168 
sigev’t
;

172 #ifdeà
__USE_XOPEN2K


173 #iâdeà
__pid_t_defšed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defšed


	)

180 
__BEGIN_NAMESPACE_STD


183 
şock_t
 
	$şock
 (è
__THROW
;

186 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

189 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

190 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

193 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

199 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

200 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

201 
__cÚ¡
 
tm
 *
__»¡riù
 
__
è
__THROW
;

202 
__END_NAMESPACE_STD


204 #ifdeà
__USE_XOPEN


207 *
	$¡½time
 (
__cÚ¡
 *
__»¡riù
 
__s
,

208 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
tm
 *
__
)

209 
__THROW
;

212 #ifdeà
__USE_XOPEN2K8


215 
	~<xloÿË.h
>

217 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

218 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

219 
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

220 
__loÿË_t
 
__loc
è
__THROW
;

223 #ifdeà
__USE_GNU


224 *
	$¡½time_l
 (
__cÚ¡
 *
__»¡riù
 
__s
,

225 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
tm
 *
__
,

226 
__loÿË_t
 
__loc
è
__THROW
;

230 
__BEGIN_NAMESPACE_STD


233 
tm
 *
	$gmtime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

237 
tm
 *
	$loÿÉime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

238 
__END_NAMESPACE_STD


240 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


243 
tm
 *
	$gmtime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

244 
tm
 *
__»¡riù
 
__
è
__THROW
;

248 
tm
 *
	$loÿÉime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

249 
tm
 *
__»¡riù
 
__
è
__THROW
;

252 
__BEGIN_NAMESPACE_STD


255 *
	$asùime
 (
__cÚ¡
 
tm
 *
__
è
__THROW
;

258 *
	$ùime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

259 
__END_NAMESPACE_STD


261 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


266 *
	$asùime_r
 (
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

267 *
__»¡riù
 
__buf
è
__THROW
;

270 *
	$ùime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

271 *
__»¡riù
 
__buf
è
__THROW
;

276 *
__tzÇme
[2];

277 
__daylight
;

278 
__timezÚe
;

281 #ifdef 
__USE_POSIX


283 *
tzÇme
[2];

287 
	$tz£t
 (è
__THROW
;

290 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


291 
daylight
;

292 
timezÚe
;

295 #ifdeà
__USE_SVID


298 
	$¡ime
 (
__cÚ¡
 
time_t
 *
__wh’
è
__THROW
;

304 
	#__i¦—p
(
y—r
) \

305 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

308 #ifdeà
__USE_MISC


313 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

316 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

319 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

323 #ifdeà
__USE_POSIX199309


328 
	`Çno¦“p
 (
__cÚ¡
 
time¥ec
 *
__»que¡ed_time
,

329 
time¥ec
 *
__»maššg
);

333 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

336 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

339 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, 
__cÚ¡
 
time¥ec
 *
__
)

340 
__THROW
;

342 #ifdeà
__USE_XOPEN2K


347 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

348 
__cÚ¡
 
time¥ec
 *
__»q
,

349 
time¥ec
 *
__»m
);

352 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

357 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

358 
sigev’t
 *
__»¡riù
 
__evp
,

359 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

362 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

365 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

366 
__cÚ¡
 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

367 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

370 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

371 
__THROW
;

374 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

378 #ifdeà
__USE_XOPEN_EXTENDED


390 
g‘d©e_”r
;

399 
tm
 *
	`g‘d©e
 (
__cÚ¡
 *
__¡ršg
);

402 #ifdeà
__USE_GNU


413 
	`g‘d©e_r
 (
__cÚ¡
 *
__»¡riù
 
__¡ršg
,

414 
tm
 *
__»¡riù
 
__»sbuå
);

417 
__END_DECLS


	@/usr/include/unistd.h

23 #iâdef 
_UNISTD_H


24 
	#_UNISTD_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


33 #ifdeà
__USE_XOPEN2K8


35 
	#_POSIX_VERSION
 200809L

	)

36 #–ià
defšed
 
__USE_XOPEN2K


38 
	#_POSIX_VERSION
 200112L

	)

39 #–ià
defšed
 
__USE_POSIX199506


41 
	#_POSIX_VERSION
 199506L

	)

42 #–ià
defšed
 
__USE_POSIX199309


44 
	#_POSIX_VERSION
 199309L

	)

47 
	#_POSIX_VERSION
 199009L

	)

53 #ifdeà
__USE_XOPEN2K8


54 
	#__POSIX2_THIS_VERSION
 200809L

	)

56 #–ià
defšed
 
__USE_XOPEN2K


58 
	#__POSIX2_THIS_VERSION
 200112L

	)

59 #–ià
defšed
 
__USE_POSIX199506


61 
	#__POSIX2_THIS_VERSION
 199506L

	)

64 
	#__POSIX2_THIS_VERSION
 199209L

	)

68 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

72 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

76 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

80 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

84 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

87 #ifdeà
__USE_XOPEN2K8


88 
	#_XOPEN_VERSION
 700

	)

89 #–ià
defšed
 
__USE_XOPEN2K


90 
	#_XOPEN_VERSION
 600

	)

91 #–ià
defšed
 
__USE_UNIX98


92 
	#_XOPEN_VERSION
 500

	)

94 
	#_XOPEN_VERSION
 4

	)

98 
	#_XOPEN_XCU_VERSION
 4

	)

101 
	#_XOPEN_XPG2
 1

	)

102 
	#_XOPEN_XPG3
 1

	)

103 
	#_XOPEN_XPG4
 1

	)

106 
	#_XOPEN_UNIX
 1

	)

109 
	#_XOPEN_CRYPT
 1

	)

113 
	#_XOPEN_ENH_I18N
 1

	)

116 
	#_XOPEN_LEGACY
 1

	)

203 
	~<b™s/posix_İt.h
>

206 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


207 
	~<b™s/’vœÚm’ts.h
>

211 
	#STDIN_FILENO
 0

	)

212 
	#STDOUT_FILENO
 1

	)

213 
	#STDERR_FILENO
 2

	)

218 
	~<b™s/ty³s.h
>

220 #iâdef 
__ssize_t_defšed


221 
__ssize_t
 
	tssize_t
;

222 
	#__ssize_t_defšed


	)

225 
	#__Ãed_size_t


	)

226 
	#__Ãed_NULL


	)

227 
	~<¡ddef.h
>

229 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


232 #iâdeà
__gid_t_defšed


233 
__gid_t
 
	tgid_t
;

234 
	#__gid_t_defšed


	)

237 #iâdeà
__uid_t_defšed


238 
__uid_t
 
	tuid_t
;

239 
	#__uid_t_defšed


	)

242 #iâdeà
__off_t_defšed


243 #iâdeà
__USE_FILE_OFFSET64


244 
__off_t
 
	toff_t
;

246 
__off64_t
 
	toff_t
;

248 
	#__off_t_defšed


	)

250 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


251 
__off64_t
 
	toff64_t
;

252 
	#__off64_t_defšed


	)

255 #iâdeà
__u£cÚds_t_defšed


256 
__u£cÚds_t
 
	tu£cÚds_t
;

257 
	#__u£cÚds_t_defšed


	)

260 #iâdeà
__pid_t_defšed


261 
__pid_t
 
	tpid_t
;

262 
	#__pid_t_defšed


	)

266 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


267 #iâdeà
__šŒ_t_defšed


268 
__šŒ_t
 
	tšŒ_t
;

269 
	#__šŒ_t_defšed


	)

273 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN


274 #iâdeà
__sockËn_t_defšed


275 
__sockËn_t
 
	tsockËn_t
;

276 
	#__sockËn_t_defšed


	)

282 
	#R_OK
 4

	)

283 
	#W_OK
 2

	)

284 
	#X_OK
 1

	)

285 
	#F_OK
 0

	)

288 
	$acûss
 (
__cÚ¡
 *
__Çme
, 
__ty³
è
__THROW
 
	`__nÚnuÎ
 ((1));

290 #ifdeà
__USE_GNU


293 
	$euidacûss
 (
__cÚ¡
 *
__Çme
, 
__ty³
)

294 
__THROW
 
	`__nÚnuÎ
 ((1));

297 
	$—cûss
 (
__cÚ¡
 *
__Çme
, 
__ty³
)

298 
__THROW
 
	`__nÚnuÎ
 ((1));

301 #ifdeà
__USE_ATFILE


305 
	$çcûs§t
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__ty³
, 
__æag
)

306 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

311 #iâdef 
_STDIO_H


312 
	#SEEK_SET
 0

	)

313 
	#SEEK_CUR
 1

	)

314 
	#SEEK_END
 2

	)

315 #ifdeà
__USE_GNU


316 
	#SEEK_DATA
 3

	)

317 
	#SEEK_HOLE
 4

	)

321 #ià
defšed
 
__USE_BSD
 && !defšed 
L_SET


323 
	#L_SET
 
SEEK_SET


	)

324 
	#L_INCR
 
SEEK_CUR


	)

325 
	#L_XTND
 
SEEK_END


	)

334 #iâdeà
__USE_FILE_OFFSET64


335 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__wh’û
è
__THROW
;

337 #ifdeà
__REDIRECT_NTH


338 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

339 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
),

340 
l£ek64
);

342 
	#l£ek
 
l£ek64


	)

345 #ifdeà
__USE_LARGEFILE64


346 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
)

347 
__THROW
;

354 
	`şo£
 (
__fd
);

361 
ssize_t
 
	$»ad
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
è
__wur
;

367 
ssize_t
 
	$wr™e
 (
__fd
, 
__cÚ¡
 *
__buf
, 
size_t
 
__n
è
__wur
;

369 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


370 #iâdeà
__USE_FILE_OFFSET64


377 
ssize_t
 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

378 
__off_t
 
__off£t
è
__wur
;

385 
ssize_t
 
	$pwr™e
 (
__fd
, 
__cÚ¡
 *
__buf
, 
size_t
 
__n
,

386 
__off_t
 
__off£t
è
__wur
;

388 #ifdeà
__REDIRECT


389 
ssize_t
 
	`__REDIRECT
 (
´—d
, (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

390 
__off64_t
 
__off£t
),

391 
´—d64
è
__wur
;

392 
ssize_t
 
	`__REDIRECT
 (
pwr™e
, (
__fd
, 
__cÚ¡
 *
__buf
,

393 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
),

394 
pwr™e64
è
__wur
;

396 
	#´—d
 
´—d64


	)

397 
	#pwr™e
 
pwr™e64


	)

401 #ifdeà
__USE_LARGEFILE64


405 
ssize_t
 
	$´—d64
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

406 
__off64_t
 
__off£t
è
__wur
;

409 
ssize_t
 
	$pwr™e64
 (
__fd
, 
__cÚ¡
 *
__buf
, 
size_t
 
__n
,

410 
__off64_t
 
__off£t
è
__wur
;

418 
	$pe
 (
__pedes
[2]è
__THROW
 
__wur
;

420 #ifdeà
__USE_GNU


423 
	$pe2
 (
__pedes
[2], 
__æags
è
__THROW
 
__wur
;

433 
	$®¬m
 (
__£cÚds
è
__THROW
;

445 
	`¦“p
 (
__£cÚds
);

447 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

448 || 
defšed
 
__USE_BSD


453 
__u£cÚds_t
 
	$u®¬m
 (
__u£cÚds_t
 
__v®ue
, __u£cÚds_ˆ
__š‹rv®
)

454 
__THROW
;

461 
	`u¦“p
 (
__u£cÚds_t
 
__u£cÚds
);

470 
	`·u£
 ();

474 
	$chown
 (
__cÚ¡
 *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

475 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

477 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


479 
	$fchown
 (
__fd
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
è
__THROW
 
__wur
;

484 
	$lchown
 (
__cÚ¡
 *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

485 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

489 #ifdeà
__USE_ATFILE


492 
	$fchowÇt
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__uid_t
 
__owÃr
,

493 
__gid_t
 
__group
, 
__æag
)

494 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

498 
	$chdœ
 (
__cÚ¡
 *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

500 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


502 
	$fchdœ
 (
__fd
è
__THROW
 
__wur
;

512 *
	$g‘cwd
 (*
__buf
, 
size_t
 
__size
è
__THROW
 
__wur
;

514 #ifdef 
__USE_GNU


518 *
	$g‘_cu¼’t_dœ_Çme
 (è
__THROW
;

521 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

522 || 
defšed
 
__USE_BSD


526 *
	$g‘wd
 (*
__buf
)

527 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
 
__wur
;

532 
	$dup
 (
__fd
è
__THROW
 
__wur
;

535 
	$dup2
 (
__fd
, 
__fd2
è
__THROW
;

537 #ifdeà
__USE_GNU


540 
	$dup3
 (
__fd
, 
__fd2
, 
__æags
è
__THROW
;

544 **
__’vœÚ
;

545 #ifdeà
__USE_GNU


546 **
’vœÚ
;

552 
	$execve
 (
__cÚ¡
 *
__·th
, *__cÚ¡ 
__¬gv
[],

553 *
__cÚ¡
 
__’vp
[]è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

555 #ifdeà
__USE_XOPEN2K8


558 
	$ãxecve
 (
__fd
, *
__cÚ¡
 
__¬gv
[], *__cÚ¡ 
__’vp
[])

559 
__THROW
 
	`__nÚnuÎ
 ((2));

564 
	$execv
 (
__cÚ¡
 *
__·th
, *__cÚ¡ 
__¬gv
[])

565 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

569 
	$exeşe
 (
__cÚ¡
 *
__·th
, __cÚ¡ *
__¬g
, ...)

570 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

574 
	$exeş
 (
__cÚ¡
 *
__·th
, __cÚ¡ *
__¬g
, ...)

575 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

579 
	$execvp
 (
__cÚ¡
 *
__fe
, *__cÚ¡ 
__¬gv
[])

580 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

585 
	$exeşp
 (
__cÚ¡
 *
__fe
, __cÚ¡ *
__¬g
, ...)

586 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

588 #ifdeà
__USE_GNU


591 
	$execv³
 (
__cÚ¡
 *
__fe
, *__cÚ¡ 
__¬gv
[],

592 *
__cÚ¡
 
__’vp
[])

593 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

597 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


599 
	$niû
 (
__šc
è
__THROW
 
__wur
;

604 
	$_ex™
 (
__¡©us
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

610 
	~<b™s/cÚâame.h
>

613 
	$·thcÚf
 (
__cÚ¡
 *
__·th
, 
__Çme
)

614 
__THROW
 
	`__nÚnuÎ
 ((1));

617 
	$å©hcÚf
 (
__fd
, 
__Çme
è
__THROW
;

620 
	$syscÚf
 (
__Çme
è
__THROW
;

622 #ifdef 
__USE_POSIX2


624 
size_t
 
	$cÚf¡r
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

629 
__pid_t
 
	$g‘pid
 (è
__THROW
;

632 
__pid_t
 
	$g‘µid
 (è
__THROW
;

636 #iâdeà
__FAVOR_BSD


637 
__pid_t
 
	$g‘pg½
 (è
__THROW
;

639 #ifdeà
__REDIRECT_NTH


640 
__pid_t
 
	`__REDIRECT_NTH
 (
g‘pg½
, (__pid_ˆ
__pid
), 
__g‘pgid
);

642 
	#g‘pg½
 
__g‘pgid


	)

647 
__pid_t
 
	$__g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

648 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


649 
__pid_t
 
	$g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

656 
	$£gid
 (
__pid_t
 
__pid
, __pid_ˆ
__pgid
è
__THROW
;

658 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


669 #iâdeà
__FAVOR_BSD


673 
	$£g½
 (è
__THROW
;

678 #ifdeà
__REDIRECT_NTH


679 
	`__REDIRECT_NTH
 (
£g½
, (
__pid_t
 
__pid
, __pid_ˆ
__pg½
), 
£gid
);

681 
	#£g½
 
£gid


	)

690 
__pid_t
 
	$£tsid
 (è
__THROW
;

692 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


694 
__pid_t
 
	$g‘sid
 (
__pid_t
 
__pid
è
__THROW
;

698 
__uid_t
 
	$g‘uid
 (è
__THROW
;

701 
__uid_t
 
	$g‘euid
 (è
__THROW
;

704 
__gid_t
 
	$g‘gid
 (è
__THROW
;

707 
__gid_t
 
	$g‘egid
 (è
__THROW
;

712 
	$g‘groups
 (
__size
, 
__gid_t
 
__li¡
[]è
__THROW
 
__wur
;

714 #ifdef 
__USE_GNU


716 
	$group_memb”
 (
__gid_t
 
__gid
è
__THROW
;

723 
	$£tuid
 (
__uid_t
 
__uid
è
__THROW
;

725 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


728 
	$£Œeuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
è
__THROW
;

731 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


733 
	$£‹uid
 (
__uid_t
 
__uid
è
__THROW
;

740 
	$£tgid
 (
__gid_t
 
__gid
è
__THROW
;

742 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


745 
	$£Œegid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
è
__THROW
;

748 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


750 
	$£‹gid
 (
__gid_t
 
__gid
è
__THROW
;

753 #ifdeà
__USE_GNU


756 
	$g‘»suid
 (
__uid_t
 *
__ruid
, __uid_ˆ*
__euid
, __uid_ˆ*
__suid
)

757 
__THROW
;

761 
	$g‘»sgid
 (
__gid_t
 *
__rgid
, __gid_ˆ*
__egid
, __gid_ˆ*
__sgid
)

762 
__THROW
;

766 
	$£Œesuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
, __uid_ˆ
__suid
)

767 
__THROW
;

771 
	$£Œesgid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
, __gid_ˆ
__sgid
)

772 
__THROW
;

779 
__pid_t
 
	$fÜk
 (è
__THROWNL
;

781 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

782 || 
defšed
 
__USE_BSD


787 
__pid_t
 
	$vfÜk
 (è
__THROW
;

793 *
	$‰yÇme
 (
__fd
è
__THROW
;

797 
	$‰yÇme_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

798 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

802 
	$i§‰y
 (
__fd
è
__THROW
;

804 #ià
defšed
 
__USE_BSD
 \

805 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_UNIX98
)

808 
	$‰y¦Ù
 (è
__THROW
;

813 
	$lšk
 (
__cÚ¡
 *
__äom
, __cÚ¡ *
__to
)

814 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

816 #ifdeà
__USE_ATFILE


819 
	$lšk©
 (
__äomfd
, 
__cÚ¡
 *
__äom
, 
__tofd
,

820 
__cÚ¡
 *
__to
, 
__æags
)

821 
__THROW
 
	`__nÚnuÎ
 ((2, 4)è
__wur
;

824 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


826 
	$symlšk
 (
__cÚ¡
 *
__äom
, __cÚ¡ *
__to
)

827 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

832 
ssize_t
 
	$»adlšk
 (
__cÚ¡
 *
__»¡riù
 
__·th
,

833 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

834 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

837 #ifdeà
__USE_ATFILE


839 
	$symlšk©
 (
__cÚ¡
 *
__äom
, 
__tofd
,

840 
__cÚ¡
 *
__to
è
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

843 
ssize_t
 
	$»adlšk©
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__·th
,

844 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

845 
__THROW
 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

849 
	$uÆšk
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

851 #ifdeà
__USE_ATFILE


853 
	$uÆšk©
 (
__fd
, 
__cÚ¡
 *
__Çme
, 
__æag
)

854 
__THROW
 
	`__nÚnuÎ
 ((2));

858 
	$rmdœ
 (
__cÚ¡
 *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1));

862 
__pid_t
 
	$tcg‘pg½
 (
__fd
è
__THROW
;

865 
	$tc£g½
 (
__fd
, 
__pid_t
 
__pg½_id
è
__THROW
;

872 *
	`g‘logš
 ();

873 #ià
defšed
 
__USE_REENTRANT
 || defšed 
__USE_POSIX199506


880 
	$g‘logš_r
 (*
__Çme
, 
size_t
 
__Çme_Ën
è
	`__nÚnuÎ
 ((1));

883 #ifdef 
__USE_BSD


885 
	$£ogš
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

889 #ifdef 
__USE_POSIX2


893 
	#__Ãed_g‘İt


	)

894 
	~<g‘İt.h
>

898 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


902 
	$g‘ho¡Çme
 (*
__Çme
, 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((1));

906 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_UNIX98
)

909 
	$£tho¡Çme
 (
__cÚ¡
 *
__Çme
, 
size_t
 
__Ën
)

910 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

914 
	$£tho¡id
 (
__id
è
__THROW
 
__wur
;

920 
	$g‘domašÇme
 (*
__Çme
, 
size_t
 
__Ën
)

921 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

922 
	$£tdomašÇme
 (
__cÚ¡
 *
__Çme
, 
size_t
 
__Ën
)

923 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

929 
	$vhªgup
 (è
__THROW
;

932 
	$»voke
 (
__cÚ¡
 *
__fe
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

940 
	$´of
 (*
__§m¶e_bufãr
, 
size_t
 
__size
,

941 
size_t
 
__off£t
, 
__sÿË
)

942 
__THROW
 
	`__nÚnuÎ
 ((1));

948 
	$acù
 (
__cÚ¡
 *
__Çme
è
__THROW
;

952 *
	$g‘u£rsh–l
 (è
__THROW
;

953 
	$’du£rsh–l
 (è
__THROW
;

954 
	$£tu£rsh–l
 (è
__THROW
;

960 
	$d«mÚ
 (
__nochdœ
, 
__noşo£
è
__THROW
 
__wur
;

964 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

967 
	$chroÙ
 (
__cÚ¡
 *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

971 *
	$g‘·ss
 (
__cÚ¡
 *
__´om±
è
	`__nÚnuÎ
 ((1));

975 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


980 
	`fsync
 (
__fd
);

984 #ifdeà
__USE_GNU


987 
	$syncfs
 (
__fd
è
__THROW
;

991 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


994 
	`g‘ho¡id
 ();

997 
	$sync
 (è
__THROW
;

1000 #ià
defšed
 
__USE_BSD
 || !defšed 
__USE_XOPEN2K


1003 
	$g‘·gesize
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

1008 
	$g‘dbËsize
 (è
__THROW
;

1014 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


1017 #iâdeà
__USE_FILE_OFFSET64


1018 
	$Œunÿ‹
 (
__cÚ¡
 *
__fe
, 
__off_t
 
__Ëngth
)

1019 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1021 #ifdeà
__REDIRECT_NTH


1022 
	`__REDIRECT_NTH
 (
Œunÿ‹
,

1023 (
__cÚ¡
 *
__fe
, 
__off64_t
 
__Ëngth
),

1024 
Œunÿ‹64
è
	`__nÚnuÎ
 ((1)è
__wur
;

1026 
	#Œunÿ‹
 
Œunÿ‹64


	)

1029 #ifdeà
__USE_LARGEFILE64


1030 
	$Œunÿ‹64
 (
__cÚ¡
 *
__fe
, 
__off64_t
 
__Ëngth
)

1031 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1036 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


1039 #iâdeà
__USE_FILE_OFFSET64


1040 
	$árunÿ‹
 (
__fd
, 
__off_t
 
__Ëngth
è
__THROW
 
__wur
;

1042 #ifdeà
__REDIRECT_NTH


1043 
	`__REDIRECT_NTH
 (
árunÿ‹
, (
__fd
, 
__off64_t
 
__Ëngth
),

1044 
árunÿ‹64
è
__wur
;

1046 
	#árunÿ‹
 
árunÿ‹64


	)

1049 #ifdeà
__USE_LARGEFILE64


1050 
	$árunÿ‹64
 (
__fd
, 
__off64_t
 
__Ëngth
è
__THROW
 
__wur
;

1056 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

1057 || 
defšed
 
__USE_MISC


1061 
	$brk
 (*
__addr
è
__THROW
 
__wur
;

1067 *
	$sbrk
 (
šŒ_t
 
__d–
è
__THROW
;

1071 #ifdeà
__USE_MISC


1082 
	$sysÿÎ
 (
__sy¢o
, ...è
__THROW
;

1087 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
è&& !defšed 
F_LOCK


1099 
	#F_ULOCK
 0

	)

1100 
	#F_LOCK
 1

	)

1101 
	#F_TLOCK
 2

	)

1102 
	#F_TEST
 3

	)

1104 #iâdeà
__USE_FILE_OFFSET64


1105 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
è
__wur
;

1107 #ifdeà
__REDIRECT


1108 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
),

1109 
lockf64
è
__wur
;

1111 
	#lockf
 
lockf64


	)

1114 #ifdeà
__USE_LARGEFILE64


1115 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
è
__wur
;

1120 #ifdeà
__USE_GNU


1125 
	#TEMP_FAILURE_RETRY
(
ex´essiÚ
) \

1126 (
__ex‹nsiÚ__
 \

1127 ({ 
__»suÉ
; \

1128 dØ
__»suÉ
 = (è(
ex´essiÚ
); \

1129 
__»suÉ
 =ğ-1L && 
”ºo
 =ğ
EINTR
); \

1130 
__»suÉ
; 
	}
}))

	)

1133 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_UNIX98


1136 
fd©async
 (
__fdes
);

1142 #ifdef 
__USE_XOPEN


1144 *
	$üy±
 (
__cÚ¡
 *
__key
, __cÚ¡ *
__§É
)

1145 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1149 
	$’üy±
 (*
__libc_block
, 
__edæag
è
__THROW
 
	`__nÚnuÎ
 ((1));

1156 
	$swab
 (
__cÚ¡
 *
__»¡riù
 
__äom
, *__»¡riù 
__to
,

1157 
ssize_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1163 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


1165 *
	$ù”mid
 (*
__s
è
__THROW
;

1170 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


1171 
	~<b™s/uni¡d.h
>

1174 
__END_DECLS


	@/usr/include/alloca.h

19 #iâdef 
_ALLOCA_H


20 
	#_ALLOCA_H
 1

	)

22 
	~<ã©u»s.h
>

24 
	#__Ãed_size_t


	)

25 
	~<¡ddef.h
>

27 
	g__BEGIN_DECLS


30 #undeà
®loÿ


33 *
	$®loÿ
 (
size_t
 
__size
è
__THROW
;

35 #ifdef 
__GNUC__


36 
	#®loÿ
(
size
è
	`__butš_®loÿ
 (size)

	)

39 
__END_DECLS


	@/usr/include/endian.h

19 #iâdef 
_ENDIAN_H


20 
	#_ENDIAN_H
 1

	)

22 
	~<ã©u»s.h
>

32 
	#__LITTLE_ENDIAN
 1234

	)

33 
	#__BIG_ENDIAN
 4321

	)

34 
	#__PDP_ENDIAN
 3412

	)

37 
	~<b™s/’dŸn.h
>

41 #iâdeà
__FLOAT_WORD_ORDER


42 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

45 #ifdef 
__USE_BSD


46 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

47 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

48 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

49 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

52 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


53 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

54 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


55 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

59 #ifdeà
__USE_BSD


61 
	~<b™s/by‹sw­.h
>

63 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


64 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

65 
	#htŞe16
(
x
è(x)

	)

66 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

67 
	#Ë16toh
(
x
è(x)

	)

69 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

70 
	#htŞe32
(
x
è(x)

	)

71 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

72 
	#Ë32toh
(
x
è(x)

	)

74 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

75 
	#htŞe64
(
x
è(x)

	)

76 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

77 
	#Ë64toh
(
x
è(x)

	)

79 
	#htobe16
(
x
è(x)

	)

80 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

81 
	#be16toh
(
x
è(x)

	)

82 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

84 
	#htobe32
(
x
è(x)

	)

85 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

86 
	#be32toh
(
x
è(x)

	)

87 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

89 
	#htobe64
(
x
è(x)

	)

90 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

91 
	#be64toh
(
x
è(x)

	)

92 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/features.h

20 #iâdef 
_FEATURES_H


21 
	#_FEATURES_H
 1

	)

98 #undeà
__USE_ISOC99


99 #undeà
__USE_ISOC95


100 #undeà
__USE_POSIX


101 #undeà
__USE_POSIX2


102 #undeà
__USE_POSIX199309


103 #undeà
__USE_POSIX199506


104 #undeà
__USE_XOPEN


105 #undeà
__USE_XOPEN_EXTENDED


106 #undeà
__USE_UNIX98


107 #undeà
__USE_XOPEN2K


108 #undeà
__USE_XOPEN2KXSI


109 #undeà
__USE_XOPEN2K8


110 #undeà
__USE_XOPEN2K8XSI


111 #undeà
__USE_LARGEFILE


112 #undeà
__USE_LARGEFILE64


113 #undeà
__USE_FILE_OFFSET64


114 #undeà
__USE_BSD


115 #undeà
__USE_SVID


116 #undeà
__USE_MISC


117 #undeà
__USE_ATFILE


118 #undeà
__USE_GNU


119 #undeà
__USE_REENTRANT


120 #undeà
__USE_FORTIFY_LEVEL


121 #undeà
__FAVOR_BSD


122 #undeà
__KERNEL_STRICT_NAMES


126 #iâdeà
_LOOSE_KERNEL_NAMES


127 
	#__KERNEL_STRICT_NAMES


	)

131 
	#__USE_ANSI
 1

	)

140 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


141 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

142 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

144 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

149 #ià
defšed
 
_BSD_SOURCE
 && \

150 !(
defšed
 
	g_POSIX_SOURCE
 || defšed 
	g_POSIX_C_SOURCE
 || \

151 
defšed
 
	g_XOPEN_SOURCE
 || defšed 
	g_GNU_SOURCE
 || defšed 
	g_SVID_SOURCE
)

152 
	#__FAVOR_BSD
 1

	)

156 #ifdeà
_GNU_SOURCE


157 #undeà
_ISOC95_SOURCE


158 
	#_ISOC95_SOURCE
 1

	)

159 #undeà
_ISOC99_SOURCE


160 
	#_ISOC99_SOURCE
 1

	)

161 #undeà
_POSIX_SOURCE


162 
	#_POSIX_SOURCE
 1

	)

163 #undeà
_POSIX_C_SOURCE


164 
	#_POSIX_C_SOURCE
 200809L

	)

165 #undeà
_XOPEN_SOURCE


166 
	#_XOPEN_SOURCE
 700

	)

167 #undeà
_XOPEN_SOURCE_EXTENDED


168 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

169 #undeà
_LARGEFILE64_SOURCE


170 
	#_LARGEFILE64_SOURCE
 1

	)

171 #undeà
_BSD_SOURCE


172 
	#_BSD_SOURCE
 1

	)

173 #undeà
_SVID_SOURCE


174 
	#_SVID_SOURCE
 1

	)

175 #undeà
_ATFILE_SOURCE


176 
	#_ATFILE_SOURCE
 1

	)

181 #ià(!
defšed
 
__STRICT_ANSI__
 && !defšed 
_ISOC99_SOURCE
 && \

182 !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 && \

183 !
defšed
 
	g_XOPEN_SOURCE
 && !defšed 
	g_BSD_SOURCE
 && !defšed 
	g_SVID_SOURCE
)

184 
	#_BSD_SOURCE
 1

	)

185 
	#_SVID_SOURCE
 1

	)

192 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC9X_SOURCE
 \

193 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

194 
	#__USE_ISOC99
 1

	)

198 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC9X_SOURCE
 \

199 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

200 
	#__USE_ISOC95
 1

	)

205 #ià((!
defšed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

206 !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

207 
	#_POSIX_SOURCE
 1

	)

208 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

209 
	#_POSIX_C_SOURCE
 2

	)

210 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

211 
	#_POSIX_C_SOURCE
 199506L

	)

212 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

213 
	#_POSIX_C_SOURCE
 200112L

	)

215 
	#_POSIX_C_SOURCE
 200809L

	)

217 
	#__USE_POSIX_IMPLICITLY
 1

	)

220 #ià
defšed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >ğ1 || defšed 
_XOPEN_SOURCE


221 
	#__USE_POSIX
 1

	)

224 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


225 
	#__USE_POSIX2
 1

	)

228 #ià(
_POSIX_C_SOURCE
 - 0) >= 199309L

229 
	#__USE_POSIX199309
 1

	)

232 #ià(
_POSIX_C_SOURCE
 - 0) >= 199506L

233 
	#__USE_POSIX199506
 1

	)

236 #ià(
_POSIX_C_SOURCE
 - 0) >= 200112L

237 
	#__USE_XOPEN2K
 1

	)

238 #undeà
__USE_ISOC95


239 
	#__USE_ISOC95
 1

	)

240 #undeà
__USE_ISOC99


241 
	#__USE_ISOC99
 1

	)

244 #ià(
_POSIX_C_SOURCE
 - 0) >= 200809L

245 
	#__USE_XOPEN2K8
 1

	)

246 #undeà
_ATFILE_SOURCE


247 
	#_ATFILE_SOURCE
 1

	)

250 #ifdef 
_XOPEN_SOURCE


251 
	#__USE_XOPEN
 1

	)

252 #ià(
_XOPEN_SOURCE
 - 0) >= 500

253 
	#__USE_XOPEN_EXTENDED
 1

	)

254 
	#__USE_UNIX98
 1

	)

255 #undeà
_LARGEFILE_SOURCE


256 
	#_LARGEFILE_SOURCE
 1

	)

257 #ià(
_XOPEN_SOURCE
 - 0) >= 600

258 #ià(
_XOPEN_SOURCE
 - 0) >= 700

259 
	#__USE_XOPEN2K8
 1

	)

260 
	#__USE_XOPEN2K8XSI
 1

	)

262 
	#__USE_XOPEN2K
 1

	)

263 
	#__USE_XOPEN2KXSI
 1

	)

264 #undeà
__USE_ISOC95


265 
	#__USE_ISOC95
 1

	)

266 #undeà
__USE_ISOC99


267 
	#__USE_ISOC99
 1

	)

270 #ifdeà
_XOPEN_SOURCE_EXTENDED


271 
	#__USE_XOPEN_EXTENDED
 1

	)

276 #ifdeà
_LARGEFILE_SOURCE


277 
	#__USE_LARGEFILE
 1

	)

280 #ifdeà
_LARGEFILE64_SOURCE


281 
	#__USE_LARGEFILE64
 1

	)

284 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

285 
	#__USE_FILE_OFFSET64
 1

	)

288 #ià
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE


289 
	#__USE_MISC
 1

	)

292 #ifdef 
_BSD_SOURCE


293 
	#__USE_BSD
 1

	)

296 #ifdef 
_SVID_SOURCE


297 
	#__USE_SVID
 1

	)

300 #ifdef 
_ATFILE_SOURCE


301 
	#__USE_ATFILE
 1

	)

304 #ifdef 
_GNU_SOURCE


305 
	#__USE_GNU
 1

	)

308 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


309 
	#__USE_REENTRANT
 1

	)

312 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

313 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

314 #ià
_FORTIFY_SOURCE
 > 1

315 
	#__USE_FORTIFY_LEVEL
 2

	)

317 
	#__USE_FORTIFY_LEVEL
 1

	)

320 
	#__USE_FORTIFY_LEVEL
 0

	)

324 
	~<b™s/´edefs.h
>

327 
	#__STDC_ISO_10646__
 200009L

	)

335 #undeà
__GNU_LIBRARY__


336 
	#__GNU_LIBRARY__
 6

	)

340 
	#__GLIBC__
 2

	)

341 
	#__GLIBC_MINOR__
 15

	)

343 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

344 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

347 #ià
defšed
 
__GNUC__
 \

348 || (
defšed
 
	g__PGI
 && defšed 
	g__i386__
 ) \

349 || (
defšed
 
	g__INTEL_COMPILER
 && (defšed 
	g__i386__
 || defšed 
	g__Ÿ64__
)) \

350 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L)

351 
	#__GLIBC_HAVE_LONG_LONG
 1

	)

355 #iâdeà
__ASSEMBLER__


356 #iâdeà
_SYS_CDEFS_H


357 
	~<sys/cdefs.h
>

362 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


363 
	#__USE_LARGEFILE
 1

	)

364 
	#__USE_LARGEFILE64
 1

	)

370 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

371 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

372 && 
defšed
 
	g__ex‹º_šlše


373 
	#__USE_EXTERN_INLINES
 1

	)

378 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

379 && (
defšed
 
	g_LIBC
 || !defšed 
	g__OPTIMIZE_SIZE__
è&& !defšed 
	g__NO_INLINE__
 \

380 && 
defšed
 
	g__ex‹º_šlše


381 
	#__USE_EXTERN_INLINES_IN_LIBC
 1

	)

389 
	~<gnu/¡ubs.h
>

	@/usr/include/getopt.h

21 #iâdeà
_GETOPT_H


23 #iâdeà
__Ãed_g‘İt


24 
	#_GETOPT_H
 1

	)

34 #ià!
defšed
 
__GNU_LIBRARY__


35 
	~<ùy³.h
>

38 #iâdeà
__THROW


39 #iâdeà
__GNUC_PREREQ


40 
	#__GNUC_PREREQ
(
maj
, 
mš
è(0)

	)

42 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

43 
	#__THROW
 
	`throw
 ()

	)

45 
	#__THROW


	)

49 #ifdef 
__ılu¥lus


59 *
İrg
;

73 
İtšd
;

78 
İ‹¼
;

82 
İtİt
;

84 #iâdeà
__Ãed_g‘İt


106 
	sİtiÚ


108 cÚ¡ *
	gÇme
;

111 
	ghas_¬g
;

112 *
	gæag
;

113 
	gv®
;

118 
	#no_¬gum’t
 0

	)

119 
	#»quœed_¬gum’t
 1

	)

120 
	#İtiÚ®_¬gum’t
 2

	)

148 #ifdeà
__GNU_LIBRARY__


152 
g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
, cÚ¡ *
__shÜtİts
)

153 
__THROW
;

155 #ià
defšed
 
__Ãed_g‘İt
 && defšed 
__USE_POSIX2
 \

156 && !
defšed
 
	g__USE_POSIX_IMPLICITLY
 && !defšed 
	g__USE_GNU


160 #ifdeà
__REDIRECT


161 
__REDIRECT_NTH
 (
g‘İt
, (
___¬gc
, *cÚ¡ *
___¬gv
,

162 cÚ¡ *
__shÜtİts
),

163 
__posix_g‘İt
);

165 
__posix_g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
,

166 cÚ¡ *
__shÜtİts
è
__THROW
;

167 
	#g‘İt
 
__posix_g‘İt


	)

171 
g‘İt
 ();

174 #iâdeà
__Ãed_g‘İt


175 
g‘İt_lÚg
 (
___¬gc
, *cÚ¡ *
___¬gv
,

176 cÚ¡ *
__shÜtİts
,

177 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

178 
__THROW
;

179 
g‘İt_lÚg_Úly
 (
___¬gc
, *cÚ¡ *
___¬gv
,

180 cÚ¡ *
__shÜtİts
,

181 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

182 
__THROW
;

186 #ifdef 
__ılu¥lus


191 #undeà
__Ãed_g‘İt


	@/usr/include/libio.h

29 #iâdeà
_IO_STDIO_H


30 
	#_IO_STDIO_H


	)

32 
	~<_G_cÚfig.h
>

34 
	#_IO_pos_t
 
_G_åos_t


	)

35 
	#_IO_åos_t
 
_G_åos_t


	)

36 
	#_IO_åos64_t
 
_G_åos64_t


	)

37 
	#_IO_size_t
 
_G_size_t


	)

38 
	#_IO_ssize_t
 
_G_ssize_t


	)

39 
	#_IO_off_t
 
_G_off_t


	)

40 
	#_IO_off64_t
 
_G_off64_t


	)

41 
	#_IO_pid_t
 
_G_pid_t


	)

42 
	#_IO_uid_t
 
_G_uid_t


	)

43 
	#_IO_icÚv_t
 
_G_icÚv_t


	)

44 
	#_IO_HAVE_SYS_WAIT
 
_G_HAVE_SYS_WAIT


	)

45 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

46 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

47 
	#_IO_va_li¡
 
_G_va_li¡


	)

48 
	#_IO_wšt_t
 
_G_wšt_t


	)

50 #ifdeà
_G_NEED_STDARG_H


52 
	#__Ãed___va_li¡


	)

53 
	~<¡d¬g.h
>

54 #ifdeà
__GNUC_VA_LIST


55 #undeà
_IO_va_li¡


56 
	#_IO_va_li¡
 
__gnuc_va_li¡


	)

60 #iâdeà
__P


61 #ià
_G_HAVE_SYS_CDEFS


62 
	~<sys/cdefs.h
>

64 #ifdeà
__STDC__


65 
	#__P
(
p
è
	)
p

66 
	#__PMT
(
p
è
	)
p

68 
	#__P
(
p
è()

	)

69 
	#__PMT
(
p
è()

	)

75 #iâdeà
_PARAMS


76 
	#_PARAMS
(
´Ùos
è
	`__P
ÕrÙos)

	)

79 #iâdeà
__STDC__


81 cÚ¡

	)

84 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

85 #iâdeà
_G_HAVE_PRINTF_FP


86 
	#_IO_USE_DTOA
 1

	)

89 #iâdeà
EOF


90 
	#EOF
 (-1)

	)

92 #iâdeà
NULL


93 #ià
defšed
 
__GNUG__
 && \

94 (
	g__GNUC__
 > 2 || (__GNUC__ =ğ2 && 
__GNUC_MINOR__
 >= 8))

95 
	#NULL
 (
__nuÎ
)

	)

97 #ià!
defšed
(
__ılu¥lus
)

98 
	#NULL
 ((*)0)

	)

100 
	#NULL
 (0)

	)

105 
	#_IOS_INPUT
 1

	)

106 
	#_IOS_OUTPUT
 2

	)

107 
	#_IOS_ATEND
 4

	)

108 
	#_IOS_APPEND
 8

	)

109 
	#_IOS_TRUNC
 16

	)

110 
	#_IOS_NOCREATE
 32

	)

111 
	#_IOS_NOREPLACE
 64

	)

112 
	#_IOS_BIN
 128

	)

120 
	#_IO_MAGIC
 0xFBAD0000

	)

121 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

122 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

123 
	#_IO_USER_BUF
 1

	)

124 
	#_IO_UNBUFFERED
 2

	)

125 
	#_IO_NO_READS
 4

	)

126 
	#_IO_NO_WRITES
 8

	)

127 
	#_IO_EOF_SEEN
 0x10

	)

128 
	#_IO_ERR_SEEN
 0x20

	)

129 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

130 
	#_IO_LINKED
 0x80

	)

131 
	#_IO_IN_BACKUP
 0x100

	)

132 
	#_IO_LINE_BUF
 0x200

	)

133 
	#_IO_TIED_PUT_GET
 0x400

	)

134 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

135 
	#_IO_IS_APPENDING
 0x1000

	)

136 
	#_IO_IS_FILEBUF
 0x2000

	)

137 
	#_IO_BAD_SEEN
 0x4000

	)

138 
	#_IO_USER_LOCK
 0x8000

	)

140 
	#_IO_FLAGS2_MMAP
 1

	)

141 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

142 #ifdeà
_LIBC


143 
	#_IO_FLAGS2_FORTIFY
 4

	)

145 
	#_IO_FLAGS2_USER_WBUF
 8

	)

146 #ifdeà
_LIBC


147 
	#_IO_FLAGS2_SCANF_STD
 16

	)

148 
	#_IO_FLAGS2_NOCLOSE
 32

	)

149 
	#_IO_FLAGS2_CLOEXEC
 64

	)

153 
	#_IO_SKIPWS
 01

	)

154 
	#_IO_LEFT
 02

	)

155 
	#_IO_RIGHT
 04

	)

156 
	#_IO_INTERNAL
 010

	)

157 
	#_IO_DEC
 020

	)

158 
	#_IO_OCT
 040

	)

159 
	#_IO_HEX
 0100

	)

160 
	#_IO_SHOWBASE
 0200

	)

161 
	#_IO_SHOWPOINT
 0400

	)

162 
	#_IO_UPPERCASE
 01000

	)

163 
	#_IO_SHOWPOS
 02000

	)

164 
	#_IO_SCIENTIFIC
 04000

	)

165 
	#_IO_FIXED
 010000

	)

166 
	#_IO_UNITBUF
 020000

	)

167 
	#_IO_STDIO
 040000

	)

168 
	#_IO_DONT_CLOSE
 0100000

	)

169 
	#_IO_BOOLALPHA
 0200000

	)

172 
_IO_jump_t
; 
	g_IO_FILE
;

175 #ifdeà
_IO_MTSAFE_IO


176 #ià
defšed
 
__GLIBC__
 && __GLIBC__ >= 2

177 
	~<b™s/¡dio-lock.h
>

182 
	t_IO_lock_t
;

188 
	s_IO_m¬k”
 {

189 
_IO_m¬k”
 *
	m_Ãxt
;

190 
_IO_FILE
 *
	m_sbuf
;

194 
	m_pos
;

196 
£t_¡»ampos
(
¡»ampos
 
¥
è{ 
	m_¥os
 = sp; }

197 
£t_off£t
(
off£t
è{ 
	m_pos
 = off£t; 
	m_¥os
 = (
¡»ampos
)(-2); }

198 
	mpublic
:

199 
¡»amm¬k”
(
¡»ambuf
 *
sb
);

200 ~
¡»amm¬k”
();

201 
§všg
(è{  
	m_¥os
 == -2; }

202 
d–
(
¡»amm¬k”
&);

203 
d–
();

208 
	e__codecvt_»suÉ


210 
	m__codecvt_ok
,

211 
	m__codecvt_·¹Ÿl
,

212 
	m__codecvt_”rÜ
,

213 
	m__codecvt_nocÚv


216 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


219 
	s_IO_codecvt


221 (*
	m__codecvt_de¡r
è(
	m_IO_codecvt
 *);

222 
__codecvt_»suÉ
 (*
__codecvt_do_out
è(
	m_IO_codecvt
 *,

223 
	m__mb¡©e_t
 *,

224 cÚ¡ 
	mwch¬_t
 *,

225 cÚ¡ 
	mwch¬_t
 *,

226 cÚ¡ 
	mwch¬_t
 **, *,

228 
__codecvt_»suÉ
 (*
__codecvt_do_unshiá
è(
	m_IO_codecvt
 *,

229 
	m__mb¡©e_t
 *, *,

231 
__codecvt_»suÉ
 (*
__codecvt_do_š
è(
	m_IO_codecvt
 *,

232 
	m__mb¡©e_t
 *,

234 cÚ¡ **, 
	mwch¬_t
 *,

235 
	mwch¬_t
 *, wchar_t **);

236 (*
	m__codecvt_do_’codšg
è(
	m_IO_codecvt
 *);

237 (*
	m__codecvt_do_®ways_nocÚv
è(
	m_IO_codecvt
 *);

238 (*
	m__codecvt_do_Ëngth
è(
	m_IO_codecvt
 *, 
	m__mb¡©e_t
 *,

239 cÚ¡ *, cÚ¡ *, 
	m_IO_size_t
);

240 (*
	m__codecvt_do_max_Ëngth
è(
	m_IO_codecvt
 *);

242 
_IO_icÚv_t
 
	m__cd_š
;

243 
_IO_icÚv_t
 
	m__cd_out
;

247 
	s_IO_wide_d©a


249 
wch¬_t
 *
	m_IO_»ad_±r
;

250 
wch¬_t
 *
	m_IO_»ad_’d
;

251 
wch¬_t
 *
	m_IO_»ad_ba£
;

252 
wch¬_t
 *
	m_IO_wr™e_ba£
;

253 
wch¬_t
 *
	m_IO_wr™e_±r
;

254 
wch¬_t
 *
	m_IO_wr™e_’d
;

255 
wch¬_t
 *
	m_IO_buf_ba£
;

256 
wch¬_t
 *
	m_IO_buf_’d
;

258 
wch¬_t
 *
	m_IO_§ve_ba£
;

259 
wch¬_t
 *
	m_IO_backup_ba£
;

261 
wch¬_t
 *
	m_IO_§ve_’d
;

263 
__mb¡©e_t
 
	m_IO_¡©e
;

264 
__mb¡©e_t
 
	m_IO_Ï¡_¡©e
;

265 
_IO_codecvt
 
	m_codecvt
;

267 
wch¬_t
 
	m_shÜtbuf
[1];

269 cÚ¡ 
_IO_jump_t
 *
	m_wide_vbË
;

273 
	s_IO_FILE
 {

274 
	m_æags
;

275 
	#_IO_fe_æags
 
_æags


	)

279 * 
	m_IO_»ad_±r
;

280 * 
	m_IO_»ad_’d
;

281 * 
	m_IO_»ad_ba£
;

282 * 
	m_IO_wr™e_ba£
;

283 * 
	m_IO_wr™e_±r
;

284 * 
	m_IO_wr™e_’d
;

285 * 
	m_IO_buf_ba£
;

286 * 
	m_IO_buf_’d
;

288 *
	m_IO_§ve_ba£
;

289 *
	m_IO_backup_ba£
;

290 *
	m_IO_§ve_’d
;

292 
_IO_m¬k”
 *
	m_m¬k”s
;

294 
_IO_FILE
 *
	m_chaš
;

296 
	m_f’o
;

298 
	m_blksize
;

300 
	m_æags2
;

302 
_IO_off_t
 
	m_Şd_off£t
;

304 
	#__HAVE_COLUMN


	)

306 
	m_cur_cŞumn
;

307 sigÃd 
	m_vbË_off£t
;

308 
	m_shÜtbuf
[1];

312 
_IO_lock_t
 *
	m_lock
;

313 #ifdeà
_IO_USE_OLD_IO_FILE


316 
	s_IO_FILE_com¶‘e


318 
_IO_FILE
 
	m_fe
;

320 #ià
defšed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

321 
_IO_off64_t
 
	m_off£t
;

322 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


324 
_IO_codecvt
 *
	m_codecvt
;

325 
_IO_wide_d©a
 *
	m_wide_d©a
;

326 
_IO_FILE
 *
	m_ä“»s_li¡
;

327 *
	m_ä“»s_buf
;

328 
size_t
 
	m_ä“»s_size
;

330 *
	m__·d1
;

331 *
	m__·d2
;

332 *
	m__·d3
;

333 *
	m__·d4
;

334 
size_t
 
	m__·d5
;

336 
	m_mode
;

338 
	m_unu£d2
[15 *  (è- 4 *  (*è-  (
size_t
)];

342 #iâdeà
__ılu¥lus


343 
_IO_FILE
 
	t_IO_FILE
;

346 
	g_IO_FILE_¶us
;

348 
_IO_FILE_¶us
 
_IO_2_1_¡dš_
;

349 
_IO_FILE_¶us
 
_IO_2_1_¡dout_
;

350 
_IO_FILE_¶us
 
_IO_2_1_¡d”r_
;

351 #iâdeà
_LIBC


352 
	#_IO_¡dš
 ((
_IO_FILE
*)(&
_IO_2_1_¡dš_
))

	)

353 
	#_IO_¡dout
 ((
_IO_FILE
*)(&
_IO_2_1_¡dout_
))

	)

354 
	#_IO_¡d”r
 ((
_IO_FILE
*)(&
_IO_2_1_¡d”r_
))

	)

356 
_IO_FILE
 *
_IO_¡dš
 
©Œibu‹_hidd’
;

357 
_IO_FILE
 *
_IO_¡dout
 
©Œibu‹_hidd’
;

358 
_IO_FILE
 *
_IO_¡d”r
 
©Œibu‹_hidd’
;

366 
__ssize_t
 
	t__io_»ad_â
 (*
	t__cook›
, *
	t__buf
, 
	tsize_t
 
	t__nby‹s
);

374 
__ssize_t
 
	t__io_wr™e_â
 (*
	t__cook›
, 
	t__cÚ¡
 *
	t__buf
,

375 
	tsize_t
 
	t__n
);

383 
	t__io_£ek_â
 (*
	t__cook›
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

386 
	t__io_şo£_â
 (*
	t__cook›
);

389 #ifdeà
_GNU_SOURCE


391 
__io_»ad_â
 
	tcook›_»ad_funùiÚ_t
;

392 
__io_wr™e_â
 
	tcook›_wr™e_funùiÚ_t
;

393 
__io_£ek_â
 
	tcook›_£ek_funùiÚ_t
;

394 
__io_şo£_â
 
	tcook›_şo£_funùiÚ_t
;

399 
__io_»ad_â
 *
	m»ad
;

400 
__io_wr™e_â
 *
	mwr™e
;

401 
__io_£ek_â
 *
	m£ek
;

402 
__io_şo£_â
 *
	mşo£
;

403 } 
	t_IO_cook›_io_funùiÚs_t
;

404 
_IO_cook›_io_funùiÚs_t
 
	tcook›_io_funùiÚs_t
;

406 
	g_IO_cook›_fe
;

409 
_IO_cook›_š™
 (
_IO_cook›_fe
 *
__cfe
, 
__»ad_wr™e
,

410 *
__cook›
, 
_IO_cook›_io_funùiÚs_t
 
__âs
);

414 #ifdeà
__ılu¥lus


418 
__und”æow
 (
_IO_FILE
 *);

419 
__uæow
 (
_IO_FILE
 *);

420 
__ov”æow
 (
_IO_FILE
 *, );

421 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


422 
_IO_wšt_t
 
__wund”æow
 (
_IO_FILE
 *);

423 
_IO_wšt_t
 
__wuæow
 (
_IO_FILE
 *);

424 
_IO_wšt_t
 
__wov”æow
 (
_IO_FILE
 *, _IO_wint_t);

427 #ià 
__GNUC__
 >= 3

428 
	#_IO_BE
(
ex´
, 
»s
è
	`__butš_ex³ù
 (Óx´),„es)

	)

430 
	#_IO_BE
(
ex´
, 
»s
èÓx´)

	)

433 
	#_IO_g‘c_uÆocked
(
_å
) \

434 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

435 ? 
	`__uæow
 (
_å
è: *(*è(_å)->
_IO_»ad_±r
++)

	)

436 
	#_IO_³ekc_uÆocked
(
_å
) \

437 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

438 && 
	`__und”æow
 (
_å
è=ğ
EOF
 ? EOF \

439 : *(*è(
_å
)->
_IO_»ad_±r
)

	)

440 
	#_IO_putc_uÆocked
(
_ch
, 
_å
) \

441 (
	`_IO_BE
 ((
_å
)->
_IO_wr™e_±r
 >ğ(_å)->
_IO_wr™e_’d
, 0) \

442 ? 
	`__ov”æow
 (
_å
, (è(
_ch
)) \

443 : (è(*(
_å
)->
_IO_wr™e_±r
++ = (
_ch
)))

	)

445 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


446 
	#_IO_g‘wc_uÆocked
(
_å
) \

447 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

448 || ((
_å
)->
_wide_d©a
->
_IO_»ad_±r
 \

449 >ğ(
_å
)->
_wide_d©a
->
_IO_»ad_’d
), 0) \

450 ? 
	`__wuæow
 (
_å
è: (
_IO_wšt_t
è*(_å)->
_wide_d©a
->
_IO_»ad_±r
++)

	)

451 
	#_IO_putwc_uÆocked
(
_wch
, 
_å
) \

452 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

453 || ((
_å
)->
_wide_d©a
->
_IO_wr™e_±r
 \

454 >ğ(
_å
)->
_wide_d©a
->
_IO_wr™e_’d
), 0) \

455 ? 
	`__wov”æow
 (
_å
, 
_wch
) \

456 : (
_IO_wšt_t
è(*(
_å
)->
_wide_d©a
->
_IO_wr™e_±r
++ = (
_wch
)))

	)

459 
	#_IO_ãof_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_EOF_SEEN
è!ğ0)

	)

460 
	#_IO_ã¼Ü_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_ERR_SEEN
è!ğ0)

	)

462 
_IO_g‘c
 (
_IO_FILE
 *
__å
);

463 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__å
);

464 
_IO_ãof
 (
_IO_FILE
 *
__å
è
__THROW
;

465 
_IO_ã¼Ü
 (
_IO_FILE
 *
__å
è
__THROW
;

467 
_IO_³ekc_locked
 (
_IO_FILE
 *
__å
);

470 
	#_IO_PENDING_OUTPUT_COUNT
(
_å
) \

471 ((
_å
)->
_IO_wr™e_±r
 - (_å)->
_IO_wr™e_ba£
)

	)

473 
_IO_æockfe
 (
_IO_FILE
 *è
__THROW
;

474 
_IO_fuÆockfe
 (
_IO_FILE
 *è
__THROW
;

475 
_IO_árylockfe
 (
_IO_FILE
 *è
__THROW
;

477 #ifdeà
_IO_MTSAFE_IO


478 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_locked
 (_å)

	)

479 
	#_IO_æockfe
(
_å
) \

480 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_æockfe
 (_å)

	)

481 
	#_IO_fuÆockfe
(
_å
) \

482 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_fuÆockfe
 (_å)

	)

484 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_uÆocked
 (_å)

	)

485 
	#_IO_æockfe
(
_å
è

	)

486 
	#_IO_fuÆockfe
(
_å
è

	)

487 
	#_IO_árylockfe
(
_å
è

	)

488 
	#_IO_ş—nup_»giÚ_¡¬t
(
_fù
, 
_å
è

	)

489 
	#_IO_ş—nup_»giÚ_’d
(
_Do™
è

	)

492 
_IO_vfsÿnf
 (
_IO_FILE
 * 
__»¡riù
, const * __restrict,

493 
_IO_va_li¡
, *
__»¡riù
);

494 
_IO_vårštf
 (
_IO_FILE
 *
__»¡riù
, const *__restrict,

495 
_IO_va_li¡
);

496 
_IO_ssize_t
 
_IO_·dn
 (
_IO_FILE
 *, , _IO_ssize_t);

497 
_IO_size_t
 
_IO_sg‘n
 (
_IO_FILE
 *, *, _IO_size_t);

499 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

500 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

502 
_IO_ä“_backup_¬—
 (
_IO_FILE
 *è
__THROW
;

504 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


505 
_IO_wšt_t
 
_IO_g‘wc
 (
_IO_FILE
 *
__å
);

506 
_IO_wšt_t
 
_IO_putwc
 (
wch¬_t
 
__wc
, 
_IO_FILE
 *
__å
);

507 
_IO_fwide
 (
_IO_FILE
 *
__å
, 
__mode
è
__THROW
;

508 #ià
__GNUC__
 >= 2

511 #ià
defšed
 
_LIBC
 && defšed 
SHARED


512 
	~<shlib-com·t.h
>

513 #ià
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

514 
	#_IO_fwide_maybe_šcom·tibË
 \

515 (
	`__butš_ex³ù
 (&
_IO_¡dš_u£d
 =ğ
NULL
, 0))

	)

516 cÚ¡ 
_IO_¡dš_u£d
;

517 
w—k_ex‹º
 (
_IO_¡dš_u£d
);

520 #iâdeà
_IO_fwide_maybe_šcom·tibË


521 
	#_IO_fwide_maybe_šcom·tibË
 (0)

	)

525 
	#_IO_fwide
(
__å
, 
__mode
) \

526 ({ 
__»suÉ
 = (
__mode
); \

527 ià(
__»suÉ
 < 0 && ! 
_IO_fwide_maybe_šcom·tibË
) \

529 ià((
__å
)->
_mode
 == 0) \

531 (
__å
)->
_mode
 = -1; \

532 
__»suÉ
 = (
__å
)->
_mode
; \

534 ià(
	`__butš_cÚ¡ªt_p
 (
__mode
) && (__mode) == 0) \

535 
__»suÉ
 = 
_IO_fwide_maybe_šcom·tibË
 ? -1 : (
__å
)->
_mode
; \

537 
__»suÉ
 = 
	`_IO_fwide
 (
__å
, __result); \

538 
__»suÉ
; })

	)

541 
_IO_vfwsÿnf
 (
_IO_FILE
 * 
__»¡riù
, cÚ¡ 
wch¬_t
 * __restrict,

542 
_IO_va_li¡
, *
__»¡riù
);

543 
_IO_vfw´štf
 (
_IO_FILE
 *
__»¡riù
, cÚ¡ 
wch¬_t
 *__restrict,

544 
_IO_va_li¡
);

545 
_IO_ssize_t
 
_IO_w·dn
 (
_IO_FILE
 *, 
wšt_t
, _IO_ssize_t);

546 
_IO_ä“_wbackup_¬—
 (
_IO_FILE
 *è
__THROW
;

549 #ifdeà
__LDBL_COMPAT


550 
	~<b™s/libio-ldbl.h
>

553 #ifdeà
__ılu¥lus


	@/usr/include/rpc/netdb.h

36 #iâdeà
_RPC_NETDB_H


37 
	#_RPC_NETDB_H
 1

	)

39 
	~<ã©u»s.h
>

41 
	#__Ãed_size_t


	)

42 
	~<¡ddef.h
>

44 
__BEGIN_DECLS


46 
	s½ûÁ


48 *
	mr_Çme
;

49 **
	mr_®Ÿ£s
;

50 
	mr_numb”
;

53 
	$£ŒpûÁ
 (
__¡ayİ’
è
__THROW
;

54 
	$’d½ûÁ
 (è
__THROW
;

55 
½ûÁ
 *
	$g‘½cbyÇme
 (
__cÚ¡
 *
__Çme
è
__THROW
;

56 
½ûÁ
 *
	$g‘½cbynumb”
 (
__numb”
è
__THROW
;

57 
½ûÁ
 *
	$g‘½ûÁ
 (è
__THROW
;

59 #ifdeà
__USE_MISC


60 
	$g‘½cbyÇme_r
 (
__cÚ¡
 *
__Çme
, 
½ûÁ
 *
__»suÉ_buf
,

61 *
__bufãr
, 
size_t
 
__buæ’
,

62 
½ûÁ
 **
__»suÉ
è
__THROW
;

64 
	$g‘½cbynumb”_r
 (
__numb”
, 
½ûÁ
 *
__»suÉ_buf
,

65 *
__bufãr
, 
size_t
 
__buæ’
,

66 
½ûÁ
 **
__»suÉ
è
__THROW
;

68 
	$g‘½ûÁ_r
 (
½ûÁ
 *
__»suÉ_buf
, *
__bufãr
,

69 
size_t
 
__buæ’
, 
½ûÁ
 **
__»suÉ
è
__THROW
;

72 
__END_DECLS


	@/usr/include/xlocale.h

21 #iâdeà
_XLOCALE_H


22 
	#_XLOCALE_H
 1

	)

28 
	s__loÿË_¡ruù


31 
__loÿË_d©a
 *
	m__loÿËs
[13];

34 cÚ¡ *
	m__ùy³_b
;

35 cÚ¡ *
	m__ùy³_tŞow”
;

36 cÚ¡ *
	m__ùy³_touµ”
;

39 cÚ¡ *
	m__Çmes
[13];

40 } *
	t__loÿË_t
;

43 
__loÿË_t
 
	tloÿË_t
;

	@/usr/include/_G_config.h

4 #iâdeà
_G_cÚfig_h


5 
	#_G_cÚfig_h
 1

	)

9 
	~<b™s/ty³s.h
>

10 
	#__Ãed_size_t


	)

11 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


12 
	#__Ãed_wch¬_t


	)

14 
	#__Ãed_NULL


	)

15 
	~<¡ddef.h
>

16 
	#__Ãed_mb¡©e_t


	)

17 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


18 
	#__Ãed_wšt_t


	)

20 
	~<wch¬.h
>

21 
	#_G_size_t
 
size_t


	)

24 
__off_t
 
	m__pos
;

25 
__mb¡©e_t
 
	m__¡©e
;

26 } 
	t_G_åos_t
;

29 
__off64_t
 
	m__pos
;

30 
__mb¡©e_t
 
	m__¡©e
;

31 } 
	t_G_åos64_t
;

32 
	#_G_ssize_t
 
__ssize_t


	)

33 
	#_G_off_t
 
__off_t


	)

34 
	#_G_off64_t
 
__off64_t


	)

35 
	#_G_pid_t
 
__pid_t


	)

36 
	#_G_uid_t
 
__uid_t


	)

37 
	#_G_wch¬_t
 
wch¬_t


	)

38 
	#_G_wšt_t
 
wšt_t


	)

39 
	#_G_¡©64
 
¡©64


	)

40 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


41 
	~<gcÚv.h
>

44 
__gcÚv_šfo
 
	m__cd
;

47 
__gcÚv_šfo
 
	m__cd
;

48 
__gcÚv_¡•_d©a
 
	m__d©a
;

49 } 
	m__combšed
;

50 } 
	t_G_icÚv_t
;

53 
	t_G_št16_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__HI__
)));

54 
	t_G_št32_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__SI__
)));

55 
	t_G_ušt16_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__HI__
)));

56 
	t_G_ušt32_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__SI__
)));

58 
	#_G_HAVE_BOOL
 1

	)

62 
	#_G_HAVE_ATEXIT
 1

	)

63 
	#_G_HAVE_SYS_CDEFS
 1

	)

64 
	#_G_HAVE_SYS_WAIT
 1

	)

65 
	#_G_NEED_STDARG_H
 1

	)

66 
	#_G_va_li¡
 
__gnuc_va_li¡


	)

68 
	#_G_HAVE_PRINTF_FP
 1

	)

69 
	#_G_HAVE_MMAP
 1

	)

70 
	#_G_HAVE_MREMAP
 1

	)

71 
	#_G_HAVE_LONG_DOUBLE_IO
 1

	)

72 
	#_G_HAVE_IO_FILE_OPEN
 1

	)

73 
	#_G_HAVE_IO_GETLINE_INFO
 1

	)

75 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

77 
	#_G_OPEN64
 
__İ’64


	)

78 
	#_G_LSEEK64
 
__l£ek64


	)

79 
	#_G_MMAP64
 
__mm­64


	)

80 
	#_G_FSTAT64
(
fd
,
buf
è
	`__fx¡©64
 (
_STAT_VER
, fd, buf)

	)

83 
	#_G_HAVE_ST_BLKSIZE
 
	`defšed
 (
_STATBUF_ST_BLKSIZE
)

	)

85 
	#_G_BUFSIZ
 8192

	)

88 
	#_G_NAMES_HAVE_UNDERSCORE
 0

	)

89 
	#_G_VTABLE_LABEL_HAS_LENGTH
 1

	)

90 
	#_G_USING_THUNKS
 1

	)

91 
	#_G_VTABLE_LABEL_PREFIX
 "__vt_"

	)

92 
	#_G_VTABLE_LABEL_PREFIX_ID
 
__vt_


	)

95 #ià
defšed
 
__ılu¥lus
 || defšed 
__STDC__


96 
	#_G_ARGS
(
ARGLIST
è
	)
ARGLIST

98 
	#_G_ARGS
(
ARGLIST
è()

	)

	@/usr/include/gconv.h

23 #iâdeà
_GCONV_H


24 
	#_GCONV_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	#__Ãed_mb¡©e_t


	)

28 
	#__Ãed_wšt_t


	)

29 
	~<wch¬.h
>

30 
	#__Ãed_size_t


	)

31 
	#__Ãed_wch¬_t


	)

32 
	~<¡ddef.h
>

35 
	#__UNKNOWN_10646_CHAR
 ((
wch¬_t
è0xfffd)

	)

40 
	m__GCONV_OK
 = 0,

41 
	m__GCONV_NOCONV
,

42 
	m__GCONV_NODB
,

43 
	m__GCONV_NOMEM
,

45 
	m__GCONV_EMPTY_INPUT
,

46 
	m__GCONV_FULL_OUTPUT
,

47 
	m__GCONV_ILLEGAL_INPUT
,

48 
	m__GCONV_INCOMPLETE_INPUT
,

50 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

51 
	m__GCONV_INTERNAL_ERROR


58 
	m__GCONV_IS_LAST
 = 0x0001,

59 
	m__GCONV_IGNORE_ERRORS
 = 0x0002,

60 
	m__GCONV_SWAP
 = 0x0004

65 
	g__gcÚv_¡•
;

66 
	g__gcÚv_¡•_d©a
;

67 
	g__gcÚv_lßded_objeù
;

68 
	g__gcÚv_Œªs_d©a
;

72 (*
	t__gcÚv_fù
è(
	t__gcÚv_¡•
 *, 
	t__gcÚv_¡•_d©a
 *,

73 
	t__cÚ¡
 **, __const *,

74 **, 
	tsize_t
 *, , );

77 
	$wšt_t
 (*
	t__gcÚv_btowc_fù
è(
	t__gcÚv_¡•
 *, );

80 (*
	t__gcÚv_š™_fù
è(
	t__gcÚv_¡•
 *);

81 (*
	t__gcÚv_’d_fù
è(
	t__gcÚv_¡•
 *);

85 (*
	t__gcÚv_Œªs_fù
è(
	t__gcÚv_¡•
 *,

86 
	t__gcÚv_¡•_d©a
 *, *,

87 
	t__cÚ¡
 *,

88 
	t__cÚ¡
 **,

89 
	t__cÚ¡
 *, **,

90 
	tsize_t
 *);

93 (*
	t__gcÚv_Œªs_cÚ‹xt_fù
è(*, 
	t__cÚ¡
 *,

94 
	t__cÚ¡
 *,

98 (*
	t__gcÚv_Œªs_qu”y_fù
è(
	t__cÚ¡
 *, __const ***,

99 
	tsize_t
 *);

102 (*
	t__gcÚv_Œªs_š™_fù
) (**, const *);

103 (*
	t__gcÚv_Œªs_’d_fù
) (*);

105 
	s__gcÚv_Œªs_d©a


108 
__gcÚv_Œªs_fù
 
__Œªs_fù
;

109 
__gcÚv_Œªs_cÚ‹xt_fù
 
__Œªs_cÚ‹xt_fù
;

110 
__gcÚv_Œªs_’d_fù
 
__Œªs_’d_fù
;

111 *
__d©a
;

112 
__gcÚv_Œªs_d©a
 *
__Ãxt
;

117 
	s__gcÚv_¡•


119 
__gcÚv_lßded_objeù
 *
__shlib_hªdË
;

120 
__cÚ¡
 *
__modÇme
;

122 
__couÁ”
;

124 *
__äom_Çme
;

125 *
__to_Çme
;

127 
__gcÚv_fù
 
__fù
;

128 
__gcÚv_btowc_fù
 
__btowc_fù
;

129 
__gcÚv_š™_fù
 
__š™_fù
;

130 
__gcÚv_’d_fù
 
__’d_fù
;

134 
__mš_Ãeded_äom
;

135 
__max_Ãeded_äom
;

136 
__mš_Ãeded_to
;

137 
__max_Ãeded_to
;

140 
__¡©eful
;

142 *
__d©a
;

147 
	s__gcÚv_¡•_d©a


149 *
__outbuf
;

150 *
__outbuãnd
;

154 
__æags
;

158 
__švoÿtiÚ_couÁ”
;

162 
__š‹º®_u£
;

164 
__mb¡©e_t
 *
__¡©•
;

165 
__mb¡©e_t
 
__¡©e
;

169 
__gcÚv_Œªs_d©a
 *
__Œªs
;

174 
	s__gcÚv_šfo


176 
size_t
 
__n¡•s
;

177 
__gcÚv_¡•
 *
__¡•s
;

178 
__ex‹nsiÚ__
 
__gcÚv_¡•_d©a
 
__d©a
 
__æex¬r
;

179 } *
	t__gcÚv_t
;

	@/usr/include/wchar.h

24 #iâdeà
_WCHAR_H


26 #ià!
defšed
 
__Ãed_mb¡©e_t
 && !defšed 
__Ãed_wšt_t


27 
	#_WCHAR_H
 1

	)

28 
	~<ã©u»s.h
>

31 #ifdeà
_WCHAR_H


33 
	#__Ãed___FILE


	)

34 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


35 
	#__Ãed_FILE


	)

37 
	~<¡dio.h
>

39 
	#__Ãed___va_li¡


	)

40 
	~<¡d¬g.h
>

42 
	~<b™s/wch¬.h
>

45 
	#__Ãed_size_t


	)

46 
	#__Ãed_wch¬_t


	)

47 
	#__Ãed_NULL


	)

49 #ià
defšed
 
_WCHAR_H
 || defšed 
__Ãed_wšt_t
 || !defšed 
__WINT_TYPE__


50 #undeà
__Ãed_wšt_t


51 
	#__Ãed_wšt_t


	)

52 
	~<¡ddef.h
>

56 #iâdeà
_WINT_T


61 
	#_WINT_T


	)

62 
	twšt_t
;

66 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES
 \

67 && 
defšed
 
__WINT_TYPE__


68 
__BEGIN_NAMESPACE_STD


69 
__WINT_TYPE__
 
	twšt_t
;

70 
	g__END_NAMESPACE_STD


75 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

76 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

80 #ià(
defšed
 
_WCHAR_H
 || defšed 
__Ãed_mb¡©e_t
è&& !defšed 
__mb¡©e_t_defšed


81 
	#__mb¡©e_t_defšed
 1

	)

85 
	m__couÁ
;

88 #ifdeà
__WINT_TYPE__


89 
__WINT_TYPE__
 
	m__wch
;

91 
wšt_t
 
	m__wch
;

93 
	m__wchb
[4];

94 } 
	m__v®ue
;

95 } 
	t__mb¡©e_t
;

97 #undeà
__Ãed_mb¡©e_t


102 #ifdeà
_WCHAR_H


104 
__BEGIN_NAMESPACE_C99


106 
__mb¡©e_t
 
	tmb¡©e_t
;

107 
	g__END_NAMESPACE_C99


108 #ifdeà
__USE_GNU


109 
	$__USING_NAMESPACE_C99
(
mb¡©e_t
)

112 #iâdeà
WCHAR_MIN


114 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

115 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

118 #iâdeà
WEOF


119 
	#WEOF
 (0xffffffffu)

	)

124 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_UNIX98


125 
	~<wùy³.h
>

129 
__BEGIN_DECLS


131 
__BEGIN_NAMESPACE_STD


134 
tm
;

135 
__END_NAMESPACE_STD


139 
	$__USING_NAMESPACE_STD
(
tm
)

142 
__BEGIN_NAMESPACE_STD


144 
wch¬_t
 *
	$wcsıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

145 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

147 
wch¬_t
 *
	$wc¢ıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

148 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

149 
__THROW
;

152 
wch¬_t
 *
	$wcsÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

153 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

155 
wch¬_t
 *
	$wc¢ÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

156 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

157 
__THROW
;

160 
	$wcscmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
)

161 
__THROW
 
__©Œibu‹_pu»__
;

163 
	$wc¢cmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

164 
__THROW
 
__©Œibu‹_pu»__
;

165 
__END_NAMESPACE_STD


167 #ifdeà
__USE_XOPEN2K8


169 
	$wcsÿ£cmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

172 
	$wc¢ÿ£cmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

173 
size_t
 
__n
è
__THROW
;

177 
	~<xloÿË.h
>

179 
	$wcsÿ£cmp_l
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

180 
__loÿË_t
 
__loc
è
__THROW
;

182 
	$wc¢ÿ£cmp_l
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

183 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

186 
__BEGIN_NAMESPACE_STD


189 
	$wcscŞl
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

193 
size_t
 
	$wcsxäm
 (
wch¬_t
 *
__»¡riù
 
__s1
,

194 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

195 
__END_NAMESPACE_STD


197 #ifdeà
__USE_XOPEN2K8


203 
	$wcscŞl_l
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

204 
__loÿË_t
 
__loc
è
__THROW
;

209 
size_t
 
	$wcsxäm_l
 (
wch¬_t
 *
__s1
, 
__cÚ¡
 wch¬_ˆ*
__s2
,

210 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

213 
wch¬_t
 *
	$wcsdup
 (
__cÚ¡
 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_m®loc__
;

216 
__BEGIN_NAMESPACE_STD


218 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


219 "C++" 
wch¬_t
 *
	$wcschr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

220 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

221 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wcschr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

222 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

224 
wch¬_t
 *
	$wcschr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

225 
__THROW
 
__©Œibu‹_pu»__
;

228 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


229 "C++" 
wch¬_t
 *
	$wc¤chr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

230 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

231 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wc¤chr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

232 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

234 
wch¬_t
 *
	$wc¤chr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

235 
__THROW
 
__©Œibu‹_pu»__
;

237 
__END_NAMESPACE_STD


239 #ifdeà
__USE_GNU


242 
wch¬_t
 *
	$wcschºul
 (
__cÚ¡
 
wch¬_t
 *
__s
, wch¬_ˆ
__wc
)

243 
__THROW
 
__©Œibu‹_pu»__
;

246 
__BEGIN_NAMESPACE_STD


249 
size_t
 
	$wcsc¥n
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, __cÚ¡ wch¬_ˆ*
__»jeù
)

250 
__THROW
 
__©Œibu‹_pu»__
;

253 
size_t
 
	$wcs¥n
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, __cÚ¡ wch¬_ˆ*
__acû±
)

254 
__THROW
 
__©Œibu‹_pu»__
;

256 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


257 "C++" 
wch¬_t
 *
	$wc¥brk
 (
wch¬_t
 *
__wcs
, 
__cÚ¡
 wch¬_ˆ*
__acû±
)

258 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

259 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wc¥brk
 (
__cÚ¡
 
wch¬_t
 *
__wcs
,

260 
__cÚ¡
 
wch¬_t
 *
__acû±
)

261 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

263 
wch¬_t
 *
	$wc¥brk
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, __cÚ¡ wch¬_ˆ*
__acû±
)

264 
__THROW
 
__©Œibu‹_pu»__
;

267 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


268 "C++" 
wch¬_t
 *
	$wcs¡r
 (
wch¬_t
 *
__hay¡ack
, 
__cÚ¡
 wch¬_ˆ*
__ÃedË
)

269 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

270 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wcs¡r
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
,

271 
__cÚ¡
 
wch¬_t
 *
__ÃedË
)

272 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

274 
wch¬_t
 *
	$wcs¡r
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
, __cÚ¡ wch¬_ˆ*
__ÃedË
)

275 
__THROW
 
__©Œibu‹_pu»__
;

279 
wch¬_t
 *
	$wc¡ok
 (
wch¬_t
 *
__»¡riù
 
__s
,

280 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__d–im
,

281 
wch¬_t
 **
__»¡riù
 
__±r
è
__THROW
;

284 
size_t
 
	$wc¦’
 (
__cÚ¡
 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_pu»__
;

285 
__END_NAMESPACE_STD


287 #ifdeà
__USE_XOPEN


289 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


290 "C++" 
wch¬_t
 *
	$wcswcs
 (
wch¬_t
 *
__hay¡ack
, 
__cÚ¡
 wch¬_ˆ*
__ÃedË
)

291 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

292 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wcswcs
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
,

293 
__cÚ¡
 
wch¬_t
 *
__ÃedË
)

294 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

296 
wch¬_t
 *
	$wcswcs
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
, __cÚ¡ wch¬_ˆ*
__ÃedË
)

297 
__THROW
 
__©Œibu‹_pu»__
;

301 #ifdeà
__USE_XOPEN2K8


303 
size_t
 
	$wc¢Ën
 (
__cÚ¡
 
wch¬_t
 *
__s
, 
size_t
 
__maxËn
)

304 
__THROW
 
__©Œibu‹_pu»__
;

308 
__BEGIN_NAMESPACE_STD


310 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


311 "C++" 
wch¬_t
 *
	$wmemchr
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

312 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

313 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wmemchr
 (
__cÚ¡
 
wch¬_t
 *
__s
, wch¬_ˆ
__c
,

314 
size_t
 
__n
)

315 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

317 
wch¬_t
 *
	$wmemchr
 (
__cÚ¡
 
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

318 
__THROW
 
__©Œibu‹_pu»__
;

322 
	$wmemcmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

323 
__THROW
 
__©Œibu‹_pu»__
;

326 
wch¬_t
 *
	$wmemıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

327 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

331 
wch¬_t
 *
	$wmemmove
 (
wch¬_t
 *
__s1
, 
__cÚ¡
 wch¬_ˆ*
__s2
, 
size_t
 
__n
)

332 
__THROW
;

335 
wch¬_t
 *
	$wmem£t
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
è
__THROW
;

336 
__END_NAMESPACE_STD


338 #ifdeà
__USE_GNU


341 
wch¬_t
 *
	$wmempıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

342 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
)

343 
__THROW
;

347 
__BEGIN_NAMESPACE_STD


350 
wšt_t
 
	$btowc
 (
__c
è
__THROW
;

354 
	$wùob
 (
wšt_t
 
__c
è
__THROW
;

358 
	$mbsš™
 (
__cÚ¡
 
mb¡©e_t
 *
__ps
è
__THROW
 
__©Œibu‹_pu»__
;

362 
size_t
 
	$mb¹owc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

363 
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

364 
mb¡©e_t
 *
__p
è
__THROW
;

367 
size_t
 
	$wütomb
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wc
,

368 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

371 
size_t
 
	$__mb¾’
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

372 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

373 
size_t
 
	$mb¾’
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

374 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

375 
__END_NAMESPACE_STD


377 #ifdeà
__USE_EXTERN_INLINES


383 
wšt_t
 
	$__btowc_®Ÿs
 (
__c
è
	`__asm
 ("btowc");

384 
__ex‹º_šlše
 
wšt_t


385 
	`__NTH
 (
	$btowc
 (
__c
))

386 {  (
	`__butš_cÚ¡ªt_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

387 ? (
wšt_t
è
__c
 : 
	`__btowc_®Ÿs
 (__c)); 
	}
}

389 
	$__wùob_®Ÿs
 (
wšt_t
 
__c
è
	`__asm
 ("wctob");

390 
__ex‹º_šlše
 

391 
	`__NTH
 (
	$wùob
 (
wšt_t
 
__wc
))

392 {  (
	`__butš_cÚ¡ªt_p
 (
__wc
è&& __wø>ğ
L
'\0' && __wc <= L'\x7f'

393 ? (è
__wc
 : 
	`__wùob_®Ÿs
 (__wc)); 
	}
}

395 
__ex‹º_šlše
 
size_t


396 
__NTH
 (
	$mb¾’
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

397 
mb¡©e_t
 *
__»¡riù
 
__ps
))

398 {  (
__ps
 !ğ
NULL


399 ? 
	`mb¹owc
 (
NULL
, 
__s
, 
__n
, 
__ps
è: 
	`__mb¾’
 (__s, __n, NULL)); 
	}
}

402 
__BEGIN_NAMESPACE_STD


405 
size_t
 
	$mb¤towcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

406 
__cÚ¡
 **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

407 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

411 
size_t
 
	$wc¤tombs
 (*
__»¡riù
 
__d¡
,

412 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

413 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

414 
__END_NAMESPACE_STD


417 #ifdef 
__USE_XOPEN2K8


420 
size_t
 
	$mb¢¹owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

421 
__cÚ¡
 **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

422 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

426 
size_t
 
	$wc¢¹ombs
 (*
__»¡riù
 
__d¡
,

427 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

428 
size_t
 
__nwc
, size_ˆ
__Ën
,

429 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

434 #ifdeà
__USE_XOPEN


436 
	$wcwidth
 (
wch¬_t
 
__c
è
__THROW
;

440 
	$wcswidth
 (
__cÚ¡
 
wch¬_t
 *
__s
, 
size_t
 
__n
è
__THROW
;

444 
__BEGIN_NAMESPACE_STD


447 
	$wc¡od
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

448 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

449 
__END_NAMESPACE_STD


451 #ifdeà
__USE_ISOC99


452 
__BEGIN_NAMESPACE_C99


454 
	$wc¡of
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

455 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

456 
	$wc¡Şd
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

457 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

458 
__END_NAMESPACE_C99


462 
__BEGIN_NAMESPACE_STD


465 
	$wc¡Ş
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

466 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

470 
	$wc¡oul
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

471 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

472 
__THROW
;

473 
__END_NAMESPACE_STD


475 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GNUC__
 && defšed 
__USE_GNU
)

476 
__BEGIN_NAMESPACE_C99


479 
__ex‹nsiÚ__


480 
	$wc¡Şl
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

481 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

482 
__THROW
;

486 
__ex‹nsiÚ__


487 
	$wc¡ouÎ
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

488 
wch¬_t
 **
__»¡riù
 
__’d±r
,

489 
__ba£
è
__THROW
;

490 
__END_NAMESPACE_C99


493 #ià
defšed
 
__GNUC__
 && defšed 
__USE_GNU


496 
__ex‹nsiÚ__


497 
	$wc¡oq
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

498 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

499 
__THROW
;

503 
__ex‹nsiÚ__


504 
	$wc¡ouq
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

505 
wch¬_t
 **
__»¡riù
 
__’d±r
,

506 
__ba£
è
__THROW
;

509 #ifdeà
__USE_GNU


523 
	~<xloÿË.h
>

527 
	$wc¡Ş_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

528 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
,

529 
__loÿË_t
 
__loc
è
__THROW
;

531 
	$wc¡oul_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

532 
wch¬_t
 **
__»¡riù
 
__’d±r
,

533 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

535 
__ex‹nsiÚ__


536 
	$wc¡Şl_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

537 
wch¬_t
 **
__»¡riù
 
__’d±r
,

538 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

540 
__ex‹nsiÚ__


541 
	$wc¡ouÎ_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

542 
wch¬_t
 **
__»¡riù
 
__’d±r
,

543 
__ba£
, 
__loÿË_t
 
__loc
)

544 
__THROW
;

546 
	$wc¡od_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

547 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

548 
__THROW
;

550 
	$wc¡of_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

551 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

552 
__THROW
;

554 
	$wc¡Şd_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

555 
wch¬_t
 **
__»¡riù
 
__’d±r
,

556 
__loÿË_t
 
__loc
è
__THROW
;

560 #ifdeà
__USE_XOPEN2K8


563 
wch¬_t
 *
	$wııy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

564 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

568 
wch¬_t
 *
	$wınıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

569 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

570 
__THROW
;

577 
__FILE
 *
	$İ’_wmem¡»am
 (
wch¬_t
 **
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
;

580 #ià
defšed
 
__USE_ISOC95
 || defšed 
__USE_UNIX98


581 
__BEGIN_NAMESPACE_STD


584 
	$fwide
 (
__FILE
 *
__å
, 
__mode
è
__THROW
;

591 
	`fw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

592 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

598 
	`w´štf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

601 
	$sw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

602 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

603 
__THROW
 ;

609 
	`vfw´štf
 (
__FILE
 *
__»¡riù
 
__s
,

610 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

611 
__gnuc_va_li¡
 
__¬g
)

617 
	`vw´štf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

618 
__gnuc_va_li¡
 
__¬g
)

622 
	$vsw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

623 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

624 
__gnuc_va_li¡
 
__¬g
)

625 
__THROW
 ;

632 
	`fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

633 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

639 
	`wsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

642 
	$swsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

643 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

644 
__THROW
 ;

646 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

647 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

648 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

649 #ifdeà
__REDIRECT


653 
	`__REDIRECT
 (
fwsÿnf
, (
__FILE
 *
__»¡riù
 
__¡»am
,

654 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

655 
__isoc99_fwsÿnf
)

657 
	`__REDIRECT
 (
wsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

658 
__isoc99_wsÿnf
)

660 
	`__REDIRECT_NTH
 (
swsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

661 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

662 ...), 
__isoc99_swsÿnf
)

665 
	`__isoc99_fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

666 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

667 
	`__isoc99_wsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

668 
	$__isoc99_swsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

669 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

670 
__THROW
;

671 
	#fwsÿnf
 
__isoc99_fwsÿnf


	)

672 
	#wsÿnf
 
__isoc99_wsÿnf


	)

673 
	#swsÿnf
 
__isoc99_swsÿnf


	)

677 
__END_NAMESPACE_STD


680 #ifdeà
__USE_ISOC99


681 
__BEGIN_NAMESPACE_C99


686 
	`vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

687 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

688 
__gnuc_va_li¡
 
__¬g
)

694 
	`vwsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

695 
__gnuc_va_li¡
 
__¬g
)

698 
	$vswsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

699 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

700 
__gnuc_va_li¡
 
__¬g
)

701 
__THROW
 ;

703 #ià!
defšed
 
__USE_GNU
 \

704 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

705 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

706 #ifdeà
__REDIRECT


707 
	`__REDIRECT
 (
vfwsÿnf
, (
__FILE
 *
__»¡riù
 
__s
,

708 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

709 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vfwsÿnf
)

711 
	`__REDIRECT
 (
vwsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

712 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vwsÿnf
)

714 
	`__REDIRECT_NTH
 (
vswsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

715 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

716 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vswsÿnf
)

719 
	`__isoc99_vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

720 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

721 
__gnuc_va_li¡
 
__¬g
);

722 
	`__isoc99_vwsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

723 
__gnuc_va_li¡
 
__¬g
);

724 
	$__isoc99_vswsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

725 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

726 
__gnuc_va_li¡
 
__¬g
è
__THROW
;

727 
	#vfwsÿnf
 
__isoc99_vfwsÿnf


	)

728 
	#vwsÿnf
 
__isoc99_vwsÿnf


	)

729 
	#vswsÿnf
 
__isoc99_vswsÿnf


	)

733 
__END_NAMESPACE_C99


737 
__BEGIN_NAMESPACE_STD


742 
wšt_t
 
	`fg‘wc
 (
__FILE
 *
__¡»am
);

743 
wšt_t
 
	`g‘wc
 (
__FILE
 *
__¡»am
);

749 
wšt_t
 
	`g‘wch¬
 ();

756 
wšt_t
 
	`åutwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

757 
wšt_t
 
	`putwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

763 
wšt_t
 
	`putwch¬
 (
wch¬_t
 
__wc
);

771 
wch¬_t
 *
	`fg‘ws
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

772 
__FILE
 *
__»¡riù
 
__¡»am
);

778 
	`åutws
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ws
,

779 
__FILE
 *
__»¡riù
 
__¡»am
);

786 
wšt_t
 
	`ung‘wc
 (wšt_ˆ
__wc
, 
__FILE
 *
__¡»am
);

787 
__END_NAMESPACE_STD


790 #ifdeà
__USE_GNU


798 
wšt_t
 
	`g‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

799 
wšt_t
 
	`g‘wch¬_uÆocked
 ();

807 
wšt_t
 
	`fg‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

815 
wšt_t
 
	`åutwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

824 
wšt_t
 
	`putwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

825 
wšt_t
 
	`putwch¬_uÆocked
 (
wch¬_t
 
__wc
);

834 
wch¬_t
 *
	`fg‘ws_uÆocked
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

835 
__FILE
 *
__»¡riù
 
__¡»am
);

843 
	`åutws_uÆocked
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ws
,

844 
__FILE
 *
__»¡riù
 
__¡»am
);

848 
__BEGIN_NAMESPACE_C99


852 
size_t
 
	$wcsáime
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

853 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

854 
__cÚ¡
 
tm
 *
__»¡riù
 
__
è
__THROW
;

855 
__END_NAMESPACE_C99


857 #ifdeà
__USE_GNU


858 
	~<xloÿË.h
>

862 
size_t
 
	$wcsáime_l
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

863 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

864 
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

865 
__loÿË_t
 
__loc
è
__THROW
;

874 #ià
defšed
 
__USE_UNIX98
 && !defšed 
__USE_GNU


875 
	#__Ãed_iswxxx


	)

876 
	~<wùy³.h
>

880 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


881 
	~<b™s/wch¬2.h
>

884 #ifdeà
__LDBL_COMPAT


885 
	~<b™s/wch¬-ldbl.h
>

888 
__END_DECLS


896 #undeà
__Ãed_mb¡©e_t


897 #undeà
__Ãed_wšt_t


	@/usr/include/wctype.h

24 #iâdeà
_WCTYPE_H


26 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

29 #iâdeà
__Ãed_iswxxx


30 
	#_WCTYPE_H
 1

	)

33 
	#__Ãed_wšt_t


	)

34 
	~<wch¬.h
>

38 #iâdeà
WEOF


39 
	#WEOF
 (0xffffffffu)

	)

42 #undeà
__Ãed_iswxxx


47 #iâdeà
__iswxxx_defšed


48 
	#__iswxxx_defšed
 1

	)

50 
__BEGIN_NAMESPACE_C99


53 
	twùy³_t
;

54 
	g__END_NAMESPACE_C99


56 #iâdeà
_ISwb™


61 
	~<’dŸn.h
>

62 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


63 
	#_ISwb™
(
b™
è(1 << (b™))

	)

65 
	#_ISwb™
(
b™
) \

66 ((
b™
) < 8 ? () ((1UL << (bit)) << 24) \

67 : ((
b™
) < 16 ? () ((1UL << (bit)) << 8) \

68 : ((
b™
) < 24 ? () ((1UL << (bit)) >> 8) \

69 : (è((1UL << (
b™
)è>> 24))))

	)

74 
	m__ISwuµ”
 = 0,

75 
	m__ISwlow”
 = 1,

76 
	m__ISw®pha
 = 2,

77 
	m__ISwdig™
 = 3,

78 
	m__ISwxdig™
 = 4,

79 
	m__ISw¥aû
 = 5,

80 
	m__ISw´št
 = 6,

81 
	m__ISwg¿ph
 = 7,

82 
	m__ISwbÏnk
 = 8,

83 
	m__ISwúŒl
 = 9,

84 
	m__ISwpunù
 = 10,

85 
	m__ISw®num
 = 11,

87 
	m_ISwuµ”
 = 
_ISwb™
 (
__ISwuµ”
),

88 
	m_ISwlow”
 = 
_ISwb™
 (
__ISwlow”
),

89 
	m_ISw®pha
 = 
_ISwb™
 (
__ISw®pha
),

90 
	m_ISwdig™
 = 
_ISwb™
 (
__ISwdig™
),

91 
	m_ISwxdig™
 = 
_ISwb™
 (
__ISwxdig™
),

92 
	m_ISw¥aû
 = 
_ISwb™
 (
__ISw¥aû
),

93 
	m_ISw´št
 = 
_ISwb™
 (
__ISw´št
),

94 
	m_ISwg¿ph
 = 
_ISwb™
 (
__ISwg¿ph
),

95 
	m_ISwbÏnk
 = 
_ISwb™
 (
__ISwbÏnk
),

96 
	m_ISwúŒl
 = 
_ISwb™
 (
__ISwúŒl
),

97 
	m_ISwpunù
 = 
_ISwb™
 (
__ISwpunù
),

98 
	m_ISw®num
 = 
_ISwb™
 (
__ISw®num
)

103 
__BEGIN_DECLS


105 
__BEGIN_NAMESPACE_C99


112 
	$isw®num
 (
wšt_t
 
__wc
è
__THROW
;

118 
	$isw®pha
 (
wšt_t
 
__wc
è
__THROW
;

121 
	$iswúŒl
 (
wšt_t
 
__wc
è
__THROW
;

125 
	$iswdig™
 (
wšt_t
 
__wc
è
__THROW
;

129 
	$iswg¿ph
 (
wšt_t
 
__wc
è
__THROW
;

134 
	$iswlow”
 (
wšt_t
 
__wc
è
__THROW
;

137 
	$isw´št
 (
wšt_t
 
__wc
è
__THROW
;

142 
	$iswpunù
 (
wšt_t
 
__wc
è
__THROW
;

147 
	$isw¥aû
 (
wšt_t
 
__wc
è
__THROW
;

152 
	$iswuµ”
 (
wšt_t
 
__wc
è
__THROW
;

157 
	$iswxdig™
 (
wšt_t
 
__wc
è
__THROW
;

162 #ifdeà
__USE_ISOC99


163 
	$iswbÏnk
 (
wšt_t
 
__wc
è
__THROW
;

172 
wùy³_t
 
	$wùy³
 (
__cÚ¡
 *
__´İ”ty
è
__THROW
;

176 
	$iswùy³
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
è
__THROW
;

177 
__END_NAMESPACE_C99


184 
__BEGIN_NAMESPACE_C99


187 
__cÚ¡
 
	t__št32_t
 *
	twù¿ns_t
;

188 
__END_NAMESPACE_C99


189 #ifdeà
__USE_GNU


190 
	$__USING_NAMESPACE_C99
(
wù¿ns_t
)

193 
__BEGIN_NAMESPACE_C99


195 
wšt_t
 
	$towlow”
 (
wšt_t
 
__wc
è
__THROW
;

198 
wšt_t
 
	$towuµ”
 (
wšt_t
 
__wc
è
__THROW
;

199 
__END_NAMESPACE_C99


201 
__END_DECLS


208 #ifdeà
_WCTYPE_H


214 
__BEGIN_DECLS


216 
__BEGIN_NAMESPACE_C99


219 
wù¿ns_t
 
	$wù¿ns
 (
__cÚ¡
 *
__´İ”ty
è
__THROW
;

222 
wšt_t
 
	$towù¿ns
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
è
__THROW
;

223 
__END_NAMESPACE_C99


225 #ifdeà
__USE_XOPEN2K8


227 
	~<xloÿË.h
>

231 
	$isw®num_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

237 
	$isw®pha_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

240 
	$iswúŒl_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

244 
	$iswdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

248 
	$iswg¿ph_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

253 
	$iswlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

256 
	$isw´št_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

261 
	$iswpunù_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

266 
	$isw¥aû_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

271 
	$iswuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

276 
	$iswxdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

281 
	$iswbÏnk_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

285 
wùy³_t
 
	$wùy³_l
 (
__cÚ¡
 *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

286 
__THROW
;

290 
	$iswùy³_l
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
, 
__loÿË_t
 
__loÿË
)

291 
__THROW
;

299 
wšt_t
 
	$towlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

302 
wšt_t
 
	$towuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

306 
wù¿ns_t
 
	$wù¿ns_l
 (
__cÚ¡
 *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

307 
__THROW
;

310 
wšt_t
 
	$towù¿ns_l
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
,

311 
__loÿË_t
 
__loÿË
è
__THROW
;

315 
__END_DECLS


	@
1
.
1
/usr/include
182
6517
example_apps/application_template.cpp
example_apps/communitydetection.cpp
example_apps/connectedcomponents.cpp
example_apps/convert_to_adjacency.cpp
example_apps/demotools/create_streaminggraph_demofiles.cpp
example_apps/inmemconncomps.cpp
example_apps/matrix_factorization/als.hpp
example_apps/matrix_factorization/als_edgefactors.cpp
example_apps/matrix_factorization/als_vertices_inmem.cpp
example_apps/matrix_factorization/graphlab_gas/als_graphlab.cpp
example_apps/matrix_factorization/graphlab_gas/als_vertex_program.hpp
example_apps/matrix_factorization/matrixmarket/mmio.c
example_apps/matrix_factorization/matrixmarket/mmio.h
example_apps/pagerank.cpp
example_apps/pagerank_functional.cpp
example_apps/randomwalks.cpp
example_apps/streaming_pagerank.cpp
example_apps/trianglecounting.cpp
graphlab_toolkit_ports/lda/cgs_lda.cpp
graphlab_toolkit_ports/lda/cgs_lda_vertexprogram.hpp
src/api/chifilenames.hpp
src/api/dynamicdata/chivector.hpp
src/api/functional/functional_api.hpp
src/api/functional/functional_bulksync.hpp
src/api/functional/functional_defs.hpp
src/api/functional/functional_semisync.hpp
src/api/graph_objects.hpp
src/api/graphchi_context.hpp
src/api/graphchi_program.hpp
src/api/graphlab2_1_GAS_api/assertions.hpp
src/api/graphlab2_1_GAS_api/graphchi_graphlabv2_1.hpp
src/api/graphlab2_1_GAS_api/graphlab.hpp
src/api/graphlab2_1_GAS_api/random.cpp
src/api/graphlab2_1_GAS_api/random.hpp
src/api/ischeduler.hpp
src/api/vertex_aggregator.hpp
src/engine/auxdata/degree_data.hpp
src/engine/auxdata/dynamicdata/vertex_data_dynamic.hpp
src/engine/auxdata/vertex_data.hpp
src/engine/bitset_scheduler.hpp
src/engine/dynamic_graphs/edgebuffers.hpp
src/engine/dynamic_graphs/graphchi_dynamicgraph_engine.hpp
src/engine/functional/functional_engine.hpp
src/engine/graphchi_engine.hpp
src/external/vpiotr-mongoose-cpp/examples/chat.c
src/external/vpiotr-mongoose-cpp/main.c
src/external/vpiotr-mongoose-cpp/mongcpp.cpp
src/external/vpiotr-mongoose-cpp/mongcpp.h
src/external/vpiotr-mongoose-cpp/mongoose.c
src/external/vpiotr-mongoose-cpp/mongoose.h
src/external/vpiotr-mongoose-cpp/test/embed.c
src/external/vpiotr-mongoose-cpp/test/mongotest.cpp
src/graphchi_basic_includes.hpp
src/graphchi_types.hpp
src/httpadmin/chi_httpadmin.hpp
src/httpadmin/plotter.hpp
src/io/stripedio.hpp
src/logger/logger.hpp
src/metrics/imetrics_reporter.hpp
src/metrics/metrics.hpp
src/metrics/reps/basic_reporter.hpp
src/metrics/reps/file_reporter.hpp
src/metrics/reps/html_reporter.hpp
src/metrics/reps/null_reporter.hpp
src/preprocessing/blocksplitter.cpp
src/preprocessing/conversions.hpp
src/preprocessing/formats/binary_adjacency_list.hpp
src/preprocessing/sharder.hpp
src/preprocessing/sharder_basic.cpp
src/shards/dynamicdata/dynamicblock.hpp
src/shards/dynamicdata/memoryshard.hpp
src/shards/dynamicdata/slidingshard.hpp
src/shards/memoryshard.hpp
src/shards/slidingshard.hpp
src/tests/basic_dynamicengine_smoketest.cpp
src/tests/basic_dynamicengine_smoketest2.cpp
src/tests/basic_smoketest.cpp
src/tests/bulksync_functional_test.cpp
src/tests/dynamicdata_smoketest.cpp
src/tests/test_dynamicedata_loader.cpp
src/util/atomic.hpp
src/util/cmdopts.hpp
src/util/configfile.hpp
src/util/dense_bitset.hpp
src/util/ioutil.hpp
src/util/labelanalysis.hpp
src/util/merge.hpp
src/util/pthread_tools.hpp
src/util/qsort.hpp
src/util/readdeg.cpp
src/util/synchronized_queue.hpp
src/util/toplist.hpp
toolkits/collaborative_filtering/als.cpp
toolkits/collaborative_filtering/als_tensor.cpp
toolkits/collaborative_filtering/baseline.cpp
toolkits/collaborative_filtering/biassgd.cpp
toolkits/collaborative_filtering/biassgd2.cpp
toolkits/collaborative_filtering/common.hpp
toolkits/collaborative_filtering/cosamp.hpp
toolkits/collaborative_filtering/distance.hpp
toolkits/collaborative_filtering/eigen_wrapper.hpp
toolkits/collaborative_filtering/gensgd.cpp
toolkits/collaborative_filtering/getline.hpp
toolkits/collaborative_filtering/implicit.hpp
toolkits/collaborative_filtering/io.hpp
toolkits/collaborative_filtering/itemcf.cpp
toolkits/collaborative_filtering/itemcf2.cpp
toolkits/collaborative_filtering/itemcf3.cpp
toolkits/collaborative_filtering/itemsim2rating.cpp
toolkits/collaborative_filtering/libfm.cpp
toolkits/collaborative_filtering/math.hpp
toolkits/collaborative_filtering/metric_eval.cpp
toolkits/collaborative_filtering/metrics.hpp
toolkits/collaborative_filtering/nmf.cpp
toolkits/collaborative_filtering/pmf.cpp
toolkits/collaborative_filtering/printouts.hpp
toolkits/collaborative_filtering/prob.hpp
toolkits/collaborative_filtering/rating.cpp
toolkits/collaborative_filtering/rbm.cpp
toolkits/collaborative_filtering/rmse.hpp
toolkits/collaborative_filtering/rmse_engine.hpp
toolkits/collaborative_filtering/rmse_engine4.hpp
toolkits/collaborative_filtering/sgd.cpp
toolkits/collaborative_filtering/sparse_als.cpp
toolkits/collaborative_filtering/sparse_gensgd.cpp
toolkits/collaborative_filtering/sparse_gensgd2.cpp
toolkits/collaborative_filtering/svd.cpp
toolkits/collaborative_filtering/svd_onesided.cpp
toolkits/collaborative_filtering/svdpp.cpp
toolkits/collaborative_filtering/timer.hpp
toolkits/collaborative_filtering/timesvdpp.cpp
toolkits/collaborative_filtering/types.hpp
toolkits/collaborative_filtering/util.hpp
toolkits/collaborative_filtering/wals.cpp
toolkits/graph_analytics/connectedcomponents.cpp
toolkits/graph_analytics/inmemconncomps.cpp
toolkits/graph_analytics/kcores.cpp
toolkits/graph_analytics/label_analysis.hpp
toolkits/graph_analytics/subgraph.cpp
toolkits/parsers/adj.cpp
toolkits/parsers/aggregator.cpp
toolkits/parsers/cdr.cpp
toolkits/parsers/common.hpp
toolkits/parsers/consecutive_matrix_market.cpp
toolkits/parsers/ips2ids.cpp
toolkits/parsers/texttokens.cpp
toolkits/parsers/topk.cpp
toolkits/parsers/twitter.cpp
/usr/include/arpa/inet.h
/usr/include/assert.h
/usr/include/ctype.h
/usr/include/dirent.h
/usr/include/dlfcn.h
/usr/include/errno.h
/usr/include/fcntl.h
/usr/include/inttypes.h
/usr/include/limits.h
/usr/include/memory.h
/usr/include/netdb.h
/usr/include/netinet/in.h
/usr/include/pthread.h
/usr/include/pwd.h
/usr/include/sched.h
/usr/include/semaphore.h
/usr/include/signal.h
/usr/include/stdint.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/time.h
/usr/include/unistd.h
/usr/include/alloca.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/getopt.h
/usr/include/libio.h
/usr/include/rpc/netdb.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/gconv.h
/usr/include/wchar.h
/usr/include/wctype.h
